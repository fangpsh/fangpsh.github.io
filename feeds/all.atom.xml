<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>fangpsh's blog</title><link href="https://fangpsh.github.io/" rel="alternate"></link><link href="https://fangpsh.github.io/feeds/all.atom.xml" rel="self"></link><id>https://fangpsh.github.io/</id><updated>2025-12-30T00:00:00+08:00</updated><entry><title>ITåŸºç¡€å»ºè®¾-ä¸ºä»€ä¹ˆéœ€è¦ä¸‰å¥—åŸŸå</title><link href="https://fangpsh.github.io/posts/2025/2025-12-30.html" rel="alternate"></link><published>2025-12-30T00:00:00+08:00</published><updated>2025-12-30T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-12-30:/posts/2025/2025-12-30.html</id><summary type="html">&lt;p&gt;&lt;img alt="office-vpc" src="/assets/images/2025/office-vpc.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„ä¸­å°å…¬å¸åŸºç¡€è®¾æ–½ç¯å¢ƒå¦‚ä¸Šå›¾ï¼Œå¯èƒ½æ²¡æœ‰äº‘å•†çš„Office VPCï¼ˆåŠå…¬VPCï¼‰ï¼Œè½¬è€Œä½¿ç”¨çº¿ä¸‹å°æœºæˆ¿ï¼Œä½†éƒ½å¤§å·®ä¸å·®ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¯´ç»“è®ºï¼Œå¯¹ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="office-vpc" src="/assets/images/2025/office-vpc.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå…¸å‹çš„ä¸­å°å…¬å¸åŸºç¡€è®¾æ–½ç¯å¢ƒå¦‚ä¸Šå›¾ï¼Œå¯èƒ½æ²¡æœ‰äº‘å•†çš„Office VPCï¼ˆåŠå…¬VPCï¼‰ï¼Œè½¬è€Œä½¿ç”¨çº¿ä¸‹å°æœºæˆ¿ï¼Œä½†éƒ½å¤§å·®ä¸å·®ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¯´ç»“è®ºï¼Œå¯¹äºä¸€ä¸ªåŸºç¡€ITç¯å¢ƒï¼Œè‡³å°‘éœ€è¦å‡†å¤‡ä¸‰å¥—åŸŸåï¼ˆäºŒçº§åŸŸåSLDï¼‰ï¼ŒæŒ‰ä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¥å…¥åŸŸå/å¤–ç½‘åŸŸåï¼Œa.com&lt;ol&gt;
&lt;li&gt;å®šä¹‰ï¼šç”¨äºå¤–éƒ¨å®¢æˆ·è®¿é—®ï¼Œä»…ç”¨äºæ¥å…¥ï¼Œæš´éœ²ç»™å¤–ç½‘&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼šä¸å¯ç”¨äºæœåŠ¡é—´è°ƒç”¨ï¼ŒæœåŠ¡é—´è°ƒç”¨ä½¿ç”¨æœåŠ¡åŸŸå/å†…ç½‘åŸŸå&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸šåŠ¡æœ‰å‡ºæµ·éœ€æ±‚ï¼Œæµ·å¤–è¯·å•ç‹¬å‡†å¤‡ä¸€å¥—é¡¶çº§åŸŸåï¼Œç”šè‡³åˆ†åœ°åŒºå‡†å¤‡ï¼›&lt;ol&gt;
&lt;li&gt;è‡³å°‘éœ€è¦å°†å¢ƒå†…å’Œå¢ƒå¤–åŸŸåæ‹†åˆ†ï¼Œå¹¶ä¸”æ³¨æ„æ‹†åˆ†åŸŸåæ³¨å†Œå±€å’Œæƒå¨æ‰˜ç®¡å•†ã€‚&lt;/li&gt;
&lt;li&gt;æµ·å¤–çš„åˆ°æµ·å¤–æ³¨å†Œï¼Œæ‰˜ç®¡åˆ°æµ·å¤–å»ï¼Œå¹¶ä¸”ç”¨æµ·å¤–ä¸»ä½“ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æœåŠ¡åŸŸå/å†…ç½‘åŸŸåï¼Œ b.com&lt;ol&gt;
&lt;li&gt;å®šä¹‰ï¼šç”¨äºå†…éƒ¨æœåŠ¡ä¹‹é—´è°ƒç”¨ï¼Œä¸é¢å‘å…¬ä¼—æš´éœ²ï¼›&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼šä¸å¯ç”¨äºåŠå…¬åŸŸåï¼Œä¸å¯ç”¨äºå†…éƒ¨è¿è¥ç³»ç»Ÿï¼›&lt;/li&gt;
&lt;li&gt;ç”¨äºæœåŠ¡é—´è°ƒç”¨ï¼ŒæœåŠ¡é—´è‡ªåŠ¨æ³¨å†Œç­‰ï¼›&lt;/li&gt;
&lt;li&gt;å½“æ¥å…¥åŸŸåé‡åˆ°ç‰¹æ®Šäº‹ä»¶ï¼Œä¾‹å¦‚clientholdï¼Œåº”å½“é¿å…å½±å“åˆ°å†…ç½‘åŸŸåå’ŒåŠå…¬è¿è¥æ´»åŠ¨ï¼Œå¯ä»¥é€šè¿‡æ›¿æ¢å¤–éƒ¨åŸŸåæ¢å¤ï¼Œæˆ–è€…åœ¨æ—¥å¸¸å°±å‡†å¤‡å¤šå¥—æ¥å…¥åŸŸåï¼Œé‡äº‹é¡¶ä¸Šã€‚å¦‚æœæ··ç”¨ï¼Œå„ç±»ç³»ç»Ÿç˜«ç—ªï¼Œä¸€é”…ç²¥ï¼Œççœ¼çï¼Œæ¢å¤èµ·æ¥æ‰‹å¿™è„šä¹±ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;åŠå…¬åŸŸåï¼Œc.com&lt;ol&gt;
&lt;li&gt;å®šä¹‰ï¼šä»…ç”¨äºåŠå…¬ç³»ç»Ÿï¼Œé¢å‘å†…éƒ¨å‘˜å·¥çš„è¿è¥å¹³å°ä¸æœåŠ¡&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸€å®šè¦çœåŸŸåï¼Œæœ€å¤šä¹Ÿå°±æ˜¯å°†æœåŠ¡åŸŸåå’ŒåŠå…¬åŸŸåæ··ç”¨ä¸€å¥—ï¼Œå¤–ç½‘åŸŸåéœ€è¦ç‹¬ç«‹ã€‚&lt;/li&gt;
&lt;li&gt;è¿è¥ç³»ç»ŸåŸŸåå¿…é¡»å’Œçº¿ä¸ŠåŸŸåï¼Œå†…ç½‘åŸŸååˆ†å¼€ï¼Œç”šè‡³åœ¨æµé‡è·¯å¾„ä¸Šä¹Ÿéœ€è¦æ‹†åˆ†ã€‚ä»¥é¿å…é‡åˆ°æ•…éšœæ—¶ï¼Œäº’ç›¸å½±å“ï¼Œå‚è€ƒ&lt;a href="https://www.bilibili.com/opus/681869046739632212"&gt;Bç«™æ•…éšœæ€»ç»“&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;BTWï¼Œæ—¢ç„¶åŸŸåå·²ç»æ‹†å¼€äº†ï¼Œè¯ä¹¦ä¹Ÿæ‹†å¼€å§ï¼Œä¸è¦ä¸ºäº†çœé’±/çœäº‹ï¼Œææˆä¸€å¥—Multi SANã€‚&lt;/p&gt;</content><category term="2025"></category><category term="dns"></category></entry><entry><title>Authentik é›†æˆåä¸ºäº‘è®¤è¯ç™»å½•</title><link href="https://fangpsh.github.io/posts/2025/2025-12-13.html" rel="alternate"></link><published>2025-12-23T00:00:00+08:00</published><updated>2025-12-23T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-12-23:/posts/2025/2025-12-13.html</id><summary type="html">&lt;p&gt;æŠŠå‡ ä¸ªäº‘éƒ½å¯¹æ¥å®Œäº†ï¼Œéœ€è¦ä¸ºåä¸ºäº‘å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ï¼Œå› ä¸ºå®ƒä¸å¤ªä¸€æ ·ï¼Œâ€œé¥é¥é¢†å…ˆâ€ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªä¸åŒç‚¹ï¼Œåä¸ºäº‘æ²¡æœ‰è§’è‰²çš„æ¦‚å¿µï¼Œéœ€ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æŠŠå‡ ä¸ªäº‘éƒ½å¯¹æ¥å®Œäº†ï¼Œéœ€è¦ä¸ºåä¸ºäº‘å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ï¼Œå› ä¸ºå®ƒä¸å¤ªä¸€æ ·ï¼Œâ€œé¥é¥é¢†å…ˆâ€ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªä¸åŒç‚¹ï¼Œåä¸ºäº‘æ²¡æœ‰è§’è‰²çš„æ¦‚å¿µï¼Œéœ€è¦é…ç½®ä¸€ä¸ªèº«ä»½è½¬æ¢è§„åˆ™ï¼Œå°†SAMLå¸¦è¿‡æ¥çš„è§’è‰²è½¬æ¢ä¸ºåä¸ºäº‘çš„ç”¨æˆ·ç»„ã€‚&lt;a href="https://support.huaweicloud.com/usermanual-iam/iam_08_0006.html"&gt;è½¬æ¢è§„åˆ™&lt;/a&gt;çœ‹èµ·æ¥è®¾è®¡çš„å¾ˆå¼ºå¤§ï¼Œå®é™…æ²¡å•¥ç”¨ï¼Œå¾’è´¹å¿ƒæ™ºã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰ç½‘å‹æ‡’å¾—çœ‹è§„åˆ™ï¼Œå¯ä»¥ç›´æ¥æŠ„è¿™ä¸ªï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[
          {
                    &amp;quot;remote&amp;quot;: [
                              {
                                        &amp;quot;type&amp;quot;: &amp;quot;http://schemas.goauthentik.io/2021/02/saml/username&amp;quot;
                              },
                              {
                                        &amp;quot;type&amp;quot;: &amp;quot;huaweiIAMGroupName&amp;quot;
                              }
                    ],
                    &amp;quot;local&amp;quot;: [
                              {
                                        &amp;quot;user&amp;quot;: {
                                                  &amp;quot;name&amp;quot;: &amp;quot;{0}&amp;quot;
                                        }
                              },
                              {
                                        &amp;quot;groups&amp;quot;: &amp;quot;{1}&amp;quot;
                              }
                    ]
          }
]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;type: http://schemas.goauthentik.io/2021/02/saml/username å¯ä»¥æ”¹æˆä½ è‡ªå®šä¹‰çš„RoleSessionName Attribute Nameã€‚è¿™å°±å¼•å‡ºç¬¬äºŒä¸ªä¸åŒç‚¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒä¸ªä¸åŒç‚¹ï¼Œå®ƒæ²¡æœ‰ç±»ä¼¼å…¶ä»–äº‘çš„æ˜¾å¼RoleSessionNameï¼Œéœ€è¦ä½ è‡ªå®šä¹‰ï¼Œä¹ æƒ¯ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬ä¸‰ä¸ªä¸åŒç‚¹ï¼Œå¦‚æœä½ çš„ç”¨æˆ·æœ‰å¤šä¸ªè§’è‰²ï¼Œæ¯ä¸ªè§’è‰²éƒ½ä¸ä¸€æ ·ï¼Œåä¸ºäº‘æ˜¯å°†æ‰€æœ‰è§’è‰²è½¬æ¢ä¸ºç»„ï¼Œç„¶åå°†ç»„æƒé™åšå¹¶é›†ã€‚æ˜¯çš„ï¼Œç›®å‰æ²¡æ³•é€‰æ‹©ç‰¹å®šè§’è‰²ç™»å½•ã€‚å‡ å¹´å‰åœ¨ç”¨shibbolethåšç¬¬ä¸€ç‰ˆIdPçš„æ—¶å€™åé¦ˆè¿‡ï¼Œæ²¡ç†æˆ‘ã€‚è¿™æ¬¡å’Œå”®åæ‹‰ç ”å‘ä¸Šä¼šåé¦ˆäº†ï¼Œè¯´ä¼šå®‰æ’ã€‚ä½†æ˜¯åæ¥åˆè¯´ä¸åšäº†ï¼Œç»™äº†ä¸€ä¸ª&lt;a href="https://support.huaweicloud.com/productdesc-identitycenter/iic_01_0002.html"&gt;æ–°æ–¹æ¡ˆ&lt;/a&gt;ï¼Œ&lt;a href="https://bbs.huaweicloud.com/blogs/429838"&gt;IAMèº«ä»½ä¸­å¿ƒå¦‚ä½•å¯¹æ¥Okta
&lt;/a&gt;çœ‹å¾—æˆ‘å¤´å¤§ï¼Œå…ˆä¸æäº†ã€‚å‡‘åˆç”¨å§ï¼Œæœ‰å…´è¶£çš„ç½‘å‹å¯ä»¥è¯•ä¸€è¯•ã€‚ä¼°è®¡ç°åœ¨ç»´æŠ¤çš„ç ”å‘ä¹Ÿæ˜¯åœ¨ç»´æŠ¤å†å²é¡¹ç›®ï¼Œä¸æƒ³åŠ¨ğŸ’©â›°ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬å››ä¸ªä¸åŒç‚¹ï¼Œä»ç»Ÿä¸€è®¤è¯IAMå‘èµ·ç™»å½•ï¼Œå’Œä»IdPå‘èµ·ç™»å½•ä¼šå†²çªã€‚å‰è€…ç™»å½•ä¹‹åå†™å…¥çš„cookies ä¼šå¯¼è‡´IdPå‘èµ·çš„ç™»å½•å‡ºé”™ï¼ŒæœåŠ¡ç«¯è¿”å›ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;The application has malfunctioned.
Please contact technical support to solve this issue.
Error code: E0019
Error message: No InResponseTo attribute in SAMLResponse, please troubleshoot on IdP side
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿå°±æ˜¯åªèƒ½äºŒé€‰ä¸€ï¼Œå’Œå”®ååé¦ˆäº†è¯´ä¼šä¿®ï¼Œä»Šå¤©é—®äº†ä¸‹è¯´å‘å¸ƒé‡åˆ°bugåˆå›é€€äº†ï¼Œä¸çŸ¥é“å•¥æ—¶å€™èƒ½ä¿®å¥½ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äº”ä¸ªä¸åŒç‚¹ï¼Œå¦‚æœä½ åœ¨åŒä¸ªå‚å•†æœ‰å¤šä¸ªä¸»ä½“è´¦å·ï¼Œåœ¨å…¶ä»–äº‘å¯ä»¥ä¼ é€’å¤šä¸ªarnæ‹¼å‡‘èµ·æ¥ï¼Œç™»å½•ä¹‹åäº‘å‚å•†ä¼šåˆ—å‡ºå¤šä¸ªä¸»ä½“è´¦å·ä¸‹ä¸åŒè§’è‰²ä¾›ä½ é€‰æ‹©ã€‚åä¸ºäº‘çš„huaweiIAMGroupName å±æ€§å’Œå…¶ä»–å‚å•†çš„ä¸ä¸€æ ·ï¼Œä¸æºå¸¦account ä¿¡æ¯ï¼Œä»&lt;a href="https://bbs.huaweicloud.com/blogs/266721"&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;é‡Œçœ‹åˆ°ä¸€ä¸ªå‚æ•°ï¼š&lt;code&gt;IAM_SAML_Attributes_identityProviders&lt;/code&gt;ï¼Œåˆ›å»ºä¸€ä¸ªSAML Provider Property Mappingï¼Œå¯ä»¥è¾¾åˆ°ç±»ä¼¼æ•ˆæœï¼Œè¿”å›æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;return [ &amp;quot;iam::{domain_id_1}:identityProvider:{idp_id_1}&amp;quot;,
         &amp;quot;iam::{domain_id_2}:identityProvider:{idp_id_2}&amp;quot;,
         &amp;quot;iam::{domain_id_3}:identityProvider:{idp_id_3}&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‡‘åˆç”¨å§ã€‚&lt;/p&gt;</content><category term="2025"></category><category term="authentik"></category></entry><entry><title>Authentik ç”¨æˆ·åŒæ­¥é£ä¹¦å‘˜å·¥å±æ€§</title><link href="https://fangpsh.github.io/posts/2025/2025-10-14.html" rel="alternate"></link><published>2025-10-14T00:00:00+08:00</published><updated>2025-10-14T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-10-14:/posts/2025/2025-10-14.html</id><summary type="html">&lt;p&gt;å‰é¢æ–‡ç« æå®šäº†é£ä¹¦ä½œä¸ºoauth2 sourceï¼Œé›†æˆåˆ°äº†authentikï¼Œä½†æ˜¯é»˜è®¤èƒ½æ‹¿åˆ°çš„ä¿¡æ¯éå¸¸æœ‰é™ï¼Œ&lt;a href="https://open.feishu.cn/document/deprecated-guide/app-login/api-reference/get-user-info"&gt;å°±è¿™ä¹ˆå‡ ä¸ª&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
    &amp;quot;sub&amp;quot;: &amp;quot;ou_caecc734c2e3328a62489fe0648c4b98779515d3&amp;quot;,
    &amp;quot;name&amp;quot;: &amp;quot;æé›·&amp;quot;,
    &amp;quot;picture&amp;quot;: &amp;quot;https://www.feishu.cn/avatar&amp;quot;,
    &amp;quot;open_id&amp;quot;: &amp;quot;ou_caecc734c2e3328a62489fe0648c4b98779515d3 â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;å‰é¢æ–‡ç« æå®šäº†é£ä¹¦ä½œä¸ºoauth2 sourceï¼Œé›†æˆåˆ°äº†authentikï¼Œä½†æ˜¯é»˜è®¤èƒ½æ‹¿åˆ°çš„ä¿¡æ¯éå¸¸æœ‰é™ï¼Œ&lt;a href="https://open.feishu.cn/document/deprecated-guide/app-login/api-reference/get-user-info"&gt;å°±è¿™ä¹ˆå‡ ä¸ª&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
    &amp;quot;sub&amp;quot;: &amp;quot;ou_caecc734c2e3328a62489fe0648c4b98779515d3&amp;quot;,
    &amp;quot;name&amp;quot;: &amp;quot;æé›·&amp;quot;,
    &amp;quot;picture&amp;quot;: &amp;quot;https://www.feishu.cn/avatar&amp;quot;,
    &amp;quot;open_id&amp;quot;: &amp;quot;ou_caecc734c2e3328a62489fe0648c4b98779515d3&amp;quot;,
    &amp;quot;union_id&amp;quot;: &amp;quot;on_d89jhsdhjsajkda7828enjdj328ydhhw3u43yjhdj&amp;quot;,
    &amp;quot;en_name&amp;quot;: &amp;quot;Lilei&amp;quot;,
    &amp;quot;tenant_key&amp;quot;: &amp;quot;736588c92lxf175d&amp;quot;,
    &amp;quot;avatar_url&amp;quot;: &amp;quot;www.feishu.cn/avatar/icon&amp;quot;,
...
    &amp;quot;email&amp;quot;: &amp;quot;zhangsan@feishu.cn&amp;quot;,
    &amp;quot;user_id&amp;quot;: &amp;quot;5d9bdxxx&amp;quot;,
    &amp;quot;employee_no&amp;quot;: &amp;quot;111222333&amp;quot;,
    &amp;quot;mobile&amp;quot;: &amp;quot;+86130xxxx0000&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ€é‡è¦çš„ï¼Œå‘˜å·¥æ‰€åœ¨çš„ç»„ç»‡æ¶æ„ï¼Œleaderèº«ä»½éƒ½æ²¡æœ‰ï¼Œå†…éƒ¨åº”ç”¨æ°æ°å¸¸å¸¸è¿™äº›ä¿¡æ¯è¿›è¡Œæƒé™é…ç½®å’Œå®¡æ‰¹æµç¨‹å†…çš„å®¡æ ¸ç­‰ç­‰ã€‚ä¸‹æ¸¸åº”ç”¨æ¥å…¥authentikä¹‹åï¼Œå¦‚æœè¿˜éœ€è¦å•ç‹¬å»é£ä¹¦æ‹¿è¿™äº›ä¿¡æ¯ï¼Œå¤ªéº»çƒ¦äº†ã€‚&lt;/p&gt;
&lt;p&gt;é£ä¹¦æˆ–è€…ä¼ä¸šå¾®ä¿¡è¿”å›çš„ç»„ç»‡æ¶æ„éœ€è¦é‡å»ºæˆæ ‘ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒè€—æ—¶ï¼Œå¦‚æœåœ¨authentik å†…éƒ¨è„šæœ¬åšä¸å¤ªåˆé€‚ï¼Œåªèƒ½ç”¨å¤–éƒ¨æœåŠ¡å‘¨æœŸæ€§åŒæ­¥å’Œç”Ÿæˆä¾›æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³äº†ä¸ªåŠæ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;1. æœåŠ¡A å®šæ—¶å‘¨æœŸæ€§ä»é£ä¹¦åŒæ­¥ç»„ç»‡æ¶æ„ï¼Œé‡å»ºæ ‘çŠ¶çš„ç»„ç»‡æ¶æ„ï¼Œä¿å­˜åˆ°æœ¬åœ°ï¼Œä¾›authentik æŸ¥è¯¢ç”¨æˆ·æ—¶ï¼Œå°†ç»„ç»‡å±‚çº§ä¿¡æ¯å†™å…¥ç”¨æˆ·ä¿¡æ¯ï¼›
2. Authentik å†… Property Mappingsåˆ›å»ºä¸€ä¸ªScope Mappingï¼Œå‡è®¾scope_name ä¸ºfeishu_attributeã€‚
  è„šæœ¬ä¸»è¦é€»è¾‘ï¼š
     1. æ£€æŸ¥å½“å‰request.user.attributes æ˜¯å¦åŒ…å«feishu_attributeï¼Œè‹¥å¦ï¼Œè¯·æ±‚æœåŠ¡Aæ›´æ–°é£ä¹¦å±æ€§ï¼›
     2. æ£€æŸ¥ç”¨æˆ·å½“å‰feishu_attribute_last_updated æ˜¯å¦è¿‡æœŸï¼Œè‹¥æ˜¯ï¼Œæ›´æ–°é£ä¹¦å±æ€§ã€‚
3. åˆ›å»ºçš„Providerï¼ŒAdvanced protocol settings -&amp;gt; Scopesï¼Œé€‰æ‹©åŠ å…¥è¿™ä¸ªscopeã€‚
4. å†…éƒ¨åº”ç”¨æ¥è®¤è¯æ—¶ç”³è¯·çš„scopeå¢åŠ ä¸€ä¸ª: feishu_attributeã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;feishu_attribute scope mapping ç®€åŒ–å¦‚ä¸‹ï¼Œ å¤–éƒ¨æœåŠ¡è¿”å›çš„user å†…å®¹æŒ‰éœ€è‡ªå®šä¹‰:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;import json
from datetime import datetime, timedelta

TIME_FORMAT=&amp;quot;%Y-%m-%d %H:%M:%S.%f&amp;quot;

def update_user_feishu_attribute():
  url = &amp;#39;https://xxxxx.oa.com/api/feishu/user/info&amp;#39;
  params = {&amp;#39;user_id&amp;#39;: request.user.username,
            &amp;#39;with_department_list_info&amp;#39;: True,
            &amp;#39;token&amp;#39;: &amp;#39;XXXXXXX&amp;#39;
            }
  resp = requests.get(url,params=params,timeout=3).json()
  if resp.get(&amp;#39;code&amp;#39;) == 0:
    user_data = resp.get(&amp;#39;data&amp;#39;).get(&amp;#39;user&amp;#39;)
    attributes = request.user.attributes
    attributes[&amp;#39;feishu_attribute&amp;#39;] = user_data
    attributes[&amp;#39;feishu_attribute_last_updated&amp;#39;] = datetime.now().strftime(TIME_FORMAT)
    request.user.update_attributes({})



if &amp;#39;feishu_attribute&amp;#39; in request.user.attributes and &amp;#39;feishu_attribute_last_updated&amp;#39; in request.user.attributes:
  now = datetime.now()
  last_updated = datetime.strptime(request.user.attributes[&amp;#39;feishu_attribute_last_updated&amp;#39;], TIME_FORMAT)
  seconds_diff = (now - last_updated).total_seconds()
  if seconds_diff &amp;gt; 24 * 60 * 60:
    update_user_feishu_attribute()    
else:
  update_user_feishu_attribute()

return {
  &amp;quot;feishu_attribute&amp;quot;: request.user.attributes.get(&amp;#39;feishu_attribute&amp;#39;, None),
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;scope mapping çš„è„šæœ¬è‡ªç”±åº¦å¾ˆå¤§ï¼Œå¯ä»¥å®Œæˆå„ç±»éœ€æ±‚ï¼Œé™¤äº†ç”¨æˆ·åŒæ­¥ï¼Œè¿˜æœ‰ä¾‹å¦‚è‡ªå®šä¹‰çš„ç™»å½•åˆ¤æ–­ç­‰ç­‰ï¼Œå¯ç©æ€§å¾ˆé«˜ã€‚&lt;/p&gt;</content><category term="2025"></category><category term="authentik"></category></entry><entry><title>Authentikå¯¹ç‰¹å®šåº”ç”¨å¼€å¯MFA</title><link href="https://fangpsh.github.io/posts/2025/2025-08-21.html" rel="alternate"></link><published>2025-08-21T00:00:00+08:00</published><updated>2025-08-21T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-08-21:/posts/2025/2025-08-21.html</id><summary type="html">&lt;p&gt;MFAï¼ˆå¤šå› ç´ è®¤è¯ï¼‰ä¸€èˆ¬ç”¨åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ã€‚ä½†æ˜¯ä½œä¸ºå†…ç½‘ç»Ÿä¸€ç™»å½•æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·åœ¨ç™»å½•éƒ¨åˆ†æ•æ„Ÿç³»ç»Ÿçš„æ—¶å€™è¿›è¡ŒäºŒ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;MFAï¼ˆå¤šå› ç´ è®¤è¯ï¼‰ä¸€èˆ¬ç”¨åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ã€‚ä½†æ˜¯ä½œä¸ºå†…ç½‘ç»Ÿä¸€ç™»å½•æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·åœ¨ç™»å½•éƒ¨åˆ†æ•æ„Ÿç³»ç»Ÿçš„æ—¶å€™è¿›è¡ŒäºŒæ¬¡è®¤è¯ï¼Œä¾‹å¦‚ç»©æ•ˆç³»ç»Ÿï¼ŒBOSSç³»ç»Ÿç­‰ï¼Œè€Œä¸æ˜¯åˆæ¬¡ç™»å½•SSOçš„æ—¶å€™ã€‚æ‰€ä»¥ä¸æ˜¯è¦Authentication çš„æ—¶å€™åŠ MFAï¼Œè€Œæ˜¯åœ¨Authorization çš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;p&gt;ç‚¹å¼€ç®¡ç†åå°-&amp;gt;Flow and Stages-&amp;gt;Authorizationç±»åˆ«çš„default-provider-authorization-implicit-consentï¼Œä»¿é€ è¿™ä¸ªcopyä¸€ä¸ªä¸€æ¨¡ä¸€æ ·ï¼Œä¾‹å¦‚å°±å«  &lt;br&gt;
provider-authorization-implicit-consent-mfaã€‚&lt;br&gt;
ç‚¹å¼€  provider-authorization-implicit-consent-mfa-&amp;gt;Stage Bindingsï¼Œåˆ›å»ºä¸€ä¸ªAuthenticator Validation Stage Typeçš„stageï¼ŒNot configured action é…ç½®ä¸ºForce the user to configure an authenticatorï¼Œç´§æ¥ç€ Configuration stages é€‰æ‹©default-authticator-totp-setupç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œè¿”å›éœ€è¦å¼€å¯mfa è®¤è¯çš„Application çš„Providerï¼ŒAuthorization flow ä¿®æ”¹ä¸ºåˆšåˆšåˆ›å»ºçš„provider-authorization-implicit-consent-mfa å³å¯ã€‚&lt;/p&gt;</content><category term="2025"></category><category term="authentik"></category></entry><entry><title>Authentikå…³è”é£ä¹¦ç™»å½•</title><link href="https://fangpsh.github.io/posts/2025/2025-07-24.html" rel="alternate"></link><published>2025-07-24T00:00:00+08:00</published><updated>2025-07-24T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-07-24:/posts/2025/2025-07-24.html</id><summary type="html">&lt;p&gt;Authentik çš„oauth2 source æ²¡æœ‰é£ä¹¦ï¼Œä¸è¿‡å¯ä»¥ä½¿ç”¨é€šç”¨çš„OpenID OAuth Sourceï¼ˆLogin using a Generic OpenID-Connect compliant provider.ï¼‰è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç½‘å‹çš„&lt;a href="https://github.com/goauthentik/authentik/issues/6577"&gt;issue&lt;/a&gt; æåˆ°ç”¨github çš„æ¨¡æ¿ï¼Œæ„Ÿè§‰åº” â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Authentik çš„oauth2 source æ²¡æœ‰é£ä¹¦ï¼Œä¸è¿‡å¯ä»¥ä½¿ç”¨é€šç”¨çš„OpenID OAuth Sourceï¼ˆLogin using a Generic OpenID-Connect compliant provider.ï¼‰è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªç½‘å‹çš„&lt;a href="https://github.com/goauthentik/authentik/issues/6577"&gt;issue&lt;/a&gt; æåˆ°ç”¨github çš„æ¨¡æ¿ï¼Œæ„Ÿè§‰åº”è¯¥ä¸å¤ªå¯¹ï¼Œå‚è€ƒ&lt;a href="https://github.com/goauthentik/authentik/blob/main/authentik/sources/oauth/types/github.py"&gt;type/github.py&lt;/a&gt;çš„å®ç°ï¼Œget_base_user_properties() æ–¹æ³•é‡Œé¢username å–å€¼ä¸å¤ªå¯¹ã€‚ä½†æ˜¯è¿™ä¸ªç½‘å‹issue ä¸­é‚£ä¸ªâ€Profile urlâ€œå¾ˆæœ‰ç”¨ã€‚æˆ‘ä¸€å¼€å§‹ç”¨çš„é…ç½®æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Authorize url: https://accounts.feishu.cn/open-apis/authen/v1/authorize&lt;/li&gt;
&lt;li&gt;Token url: https://open.feishu.cn/open-apis/authen/v2/oauth/token&lt;/li&gt;
&lt;li&gt;Profile url: https://open.feishu.cn/open-apis/authen/v1/user_info&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ›å»ºfeishu oauth2 sourceçš„æ—¶å€™ï¼Œscopeä¸º&lt;code&gt;* contact:user.email:readonly contact:user.employee_id:readonly&lt;/code&gt;ï¼Œé£ä¹¦å¼€å‘åå°å¯¹åº”åº”ç”¨è®°å¾—ç”³è¯·æƒé™ã€‚é£ä¹¦çš„callback url å¡«oauth2 sourceåˆ›å»ºä¹‹åçš„callback urlã€‚&lt;/p&gt;
&lt;p&gt;å‘ç°ç™»å½•æ—¶å‡ºé”™ï¼šâ€Authentication failed: Could not determine id.â€œï¼Œçœ‹äº†ä¸‹ä»£ç ï¼Œ
è¿™ä¸ªé”™è¯¯åœ¨&lt;a href="https://github.com/goauthentik/authentik/blob/6c56d612cfcff64f090279fb0e65ffe2ce8c620e/authentik/sources/oauth/views/callback.py#L63"&gt;callback.py&lt;/a&gt;ï¼Œget_user_id() å‡½æ•°å°è¯•åœ¨info é‡Œé¢æ‰¾id è¿™ä¸ªkeyï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªProfile url çš„body æ ¼å¼ä¸å¤ªå¯¹ï¼ˆä¸æ ‡å‡†ï¼‰ï¼Œè€Œä¸”ç¼ºå°‘äº†â€idâ€œï¼Œæœ‰ç½‘å‹è¯´å¯ä»¥ç”¨&lt;a href="https://github.com/dexidp/dex"&gt;dex&lt;/a&gt;è¿›è¡Œè½¬æ¢ã€‚å«Œå¼ƒéº»çƒ¦ã€‚ä¸è¿‡å¯ä»¥çœ‹åˆ°åœ¨&lt;a href="https://github.com/goauthentik/authentik/blob/6c56d612cfcff64f090279fb0e65ffe2ce8c620e/authentik/sources/oauth/types/oidc.py#L45"&gt;types/oidc.py&lt;/a&gt;é‡Œé¢ï¼Œget_user_id()é‡è½½æˆå–â€subâ€œäº†ã€‚æ°å¥½çœ‹åˆ°äº†è¿™ä¸ª&lt;a href="https://open.feishu.cn/document/deprecated-guide/app-login/api-reference/get-user-info"&gt;è€API&lt;/a&gt;ç¬¦åˆæ ‡å‡†ï¼Œèƒ½ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®æ›¿æ¢ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Authorize url: https://accounts.feishu.cn/open-apis/authen/v1/authorize&lt;/li&gt;
&lt;li&gt;Token url: https://open.feishu.cn/open-apis/authen/v2/oauth/token&lt;/li&gt;
&lt;li&gt;Profile url: https://passport.feishu.cn/suite/passport/oauth/userinfo&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªProperty Mappingsï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;return {
  &amp;quot;username&amp;quot;: info.get(&amp;quot;user_id&amp;quot;),
  &amp;quot;email&amp;quot;: info.get(&amp;quot;email&amp;quot;),
  &amp;quot;name&amp;quot;: info.get(&amp;quot;name&amp;quot;),
  &amp;quot;attributes&amp;quot;: {
    &amp;quot;avatar&amp;quot;: info.get(&amp;quot;avatar_url&amp;quot;),
    &amp;quot;employee_no&amp;quot;: info.get(&amp;quot;employee_no&amp;quot;),  
  },
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°†è¿™ä¸ªproperty mapping ç»‘å®šåˆ°ä¹‹å‰åˆ›å»ºçš„é£ä¹¦ OAuth2 Sourceã€‚
å°†default-authentication-flow è¿™ä¸ªflowçš„stage-&amp;gt;default-authentication-identification -&amp;gt;source setting -&amp;gt; å¢åŠ feishu oauth2 sourceã€‚
ä¿®æ”¹  default-source-enrollment -&amp;gt;stage-&amp;gt;default-source-enrollment-writeï¼Œåˆ›å»ºå†…éƒ¨è´¦æˆ·ï¼Œé€‰æ‹©ç”¨æˆ·ç±»å‹ï¼Œç”¨æˆ·ç»„ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§å‰é¢çš„mappingï¼Œæ‹¿åˆ°äº†é£ä¹¦çš„å¤´åƒï¼Œè¿˜éœ€è¦åœ¨System-&amp;gt;Setting-&amp;gt;Avatar ä¿®æ”¹ä¸º&lt;code&gt;attributes.avatar,initials&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¤§åŠŸå‘Šæˆã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥æœåˆ°æœ‰ä¸€ä¸ªç½‘å‹æäº¤äº†&lt;a href="https://github.com/goauthentik/authentik/pull/13773/files"&gt;pr&lt;/a&gt;ï¼Œå¢åŠ äº†&lt;code&gt;types/lark&lt;/code&gt; çš„æ”¯æŒï¼Œä½†æ˜¯ä¸€ç›´æ²¡åˆå¹¶ã€‚æ‰€ä»¥æ‹‰åˆ°æœ€æ–°releaseï¼Œå•ç‹¬patch ä¸‹è¿™ä¸ªprï¼Œbuildä¸€ä¸‹ä¹Ÿå¯ä»¥ã€‚åœ¨è¿™ä¸ªpr ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°é‡è½½çš„get_user_id() å’Œget_base_user_properties ()ç­‰å‡½æ•°ï¼Œå¯ä»¥æŒ‰éœ€ä¿®æ”¹ã€‚&lt;/p&gt;</content><category term="2025"></category><category term="authentik"></category><category term="oauth2"></category></entry><entry><title>è°¨æ…ä½¿ç”¨çˆ±å¿«åè®®åˆ†æµ</title><link href="https://fangpsh.github.io/posts/2025/2025-03-11.html" rel="alternate"></link><published>2025-03-11T00:00:00+08:00</published><updated>2025-03-11T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-03-11:/posts/2025/2025-03-11.html</id><summary type="html">&lt;p&gt;æŸä¸ªå‘¨ä¸€ä¸Šåˆï¼ŒåŠå…¬ç½‘ä¸€å°å‡ºå£è·¯ç”±ï¼ˆå€æ§+çˆ±å¿«3.7.11ï¼‰ä¸æ ¸å¿ƒçš„lanå¤§é‡å£ä¸¢åŒ…ï¼ŒCPUæ¯›åˆºï¼Œå‡ºç°é—®é¢˜æ—¶è¿æ¥æ•°å¼‚å¸¸é£™å‡ï¼Œç›¸å…³ç”¨æˆ·æ–­ç½‘ï¼ŒæŒç»­å‡ åˆ† â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æŸä¸ªå‘¨ä¸€ä¸Šåˆï¼ŒåŠå…¬ç½‘ä¸€å°å‡ºå£è·¯ç”±ï¼ˆå€æ§+çˆ±å¿«3.7.11ï¼‰ä¸æ ¸å¿ƒçš„lanå¤§é‡å£ä¸¢åŒ…ï¼ŒCPUæ¯›åˆºï¼Œå‡ºç°é—®é¢˜æ—¶è¿æ¥æ•°å¼‚å¸¸é£™å‡ï¼Œç›¸å…³ç”¨æˆ·æ–­ç½‘ï¼ŒæŒç»­å‡ åˆ†é’Ÿåå¯è‡ªè¡Œæ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;ç–‘é—®ï¼šè¿æ¥æ•°å¼‚å¸¸æ˜¯å› è¿˜æ˜¯æœï¼Ÿæ˜¯å› ä¸ºæ€§èƒ½å¼‚å¸¸å¯¼è‡´çš„è¿æ¥æ•°å¤„ç†ä¸åŠæ—¶è€Œå †ç§¯å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥æ ¸å¿ƒç›¸å…³ç«¯å£ï¼Œæœªè§‚å¯Ÿåˆ°æ˜æ˜¾çªå‘æµé‡ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒå¤©ï¼Œåˆå‡ºç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰çˆ±å¿«è®¾å¤‡å‡ºç°è¿‡å‡æ­»ï¼ˆæ— æ³•æ¢å¤ï¼‰ï¼Œé…åˆå‡æ­»æ—¶é—´çš„æ—¥å¿—å‘ç°æœ‰wanå£åœ¨æ‹¨å·ã€‚
ä¹‹å‰è¿è¥å•†å…‰çŒ«å¶å°”ä¼šå‡æ­»ï¼Œç«¯å£ä¸downï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸Šå…‰çŒ«é…ç½®äº†å‘¨æœŸæ€§é‡å¯ã€‚æ€€ç–‘æ˜¯å¤šä¸ªwanå£çŠ¶æ€å˜åŒ–+ç«¯å£åˆ†æµå†…ç­–ç•¥è¾ƒå¤šï¼Œè§¦å‘äº†ç­–ç•¥è®¡ç®—çš„bugï¼Œå¯¼è‡´å¼‚å¸¸ï¼Œé‡æ–°è°ƒæ•´åˆ†é…äº†å¤šä¸ªwanå£çš„é‡å¯æ—¶åˆ»ï¼Œé¿å…åŒæ—¶è§¦å‘ã€‚&lt;/p&gt;
&lt;p&gt;ç–‘é—®ï¼šæ˜¯ä¸æ˜¯æŸè¿è¥å•†çº¿è·¯å¼‚å¸¸ï¼Œå¯¼è‡´wanå£çº¿è·¯æ£€æµ‹é¢‘ç¹å¤±è´¥ï¼Œä»è€Œè§¦å‘çˆ±å¿«ç­–ç•¥è®¡ç®—ï¼ŒæŸäº›ä»£ç bugå¯¼è‡´cpuå¼‚å¸¸ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åˆ é™¤äº†éƒ¨åˆ†ç«¯å£åˆ†æµç­–ç•¥ã€‚
å…³é—­è¿è¥å•†wanå£çº¿è·¯æ£€æŸ¥ï¼Œè§‚å¯Ÿï¼Œåˆå‡ºç°äº†ï¼Œè¿æ¥æ•°æœ‰çªå‘ï¼Œä½†æ˜¯cpu å³°å€¼ä¸‹é™ï¼Œå½±å“ç¨å¾®å‡å¼±ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œè®¾å¤‡æ²¡ä»»ä½•å˜æ›´ï¼Œå“ªé‡Œæœ‰å˜åŒ–ï¼Ÿæ£€æŸ¥æ—¥å¿—å‘ç°çˆ±å¿«æ›´æ–°äº†åè®®åº“ã€‚æ˜¯ä¸æ˜¯åè®®åº“çš„é—®é¢˜ï¼ŒæŸäº›ç±»ä¼¼æ­£åˆ™çš„è§„åˆ™å¼‚å¸¸ï¼Ÿä¾‹å¦‚cloudflare ä¹‹å‰çš„&lt;a href="https://blog.cloudflare.com/details-of-the-cloudflare-outage-on-july-2-2019/"&gt;æ­£åˆ™è¡¨è¾¾å¼å¼•å‘cpuè€—å°½çš„æ•…éšœ&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åè®®åº“ä¼¼ä¹æ²¡æ³•å›æ»šã€‚å†³å®šå…³é—­åè®®åº“ç‰¹å¾åº“æ›´æ–°ï¼Œå‡çº§çˆ±å¿«ç‰ˆæœ¬ï¼Œåˆ é™¤åè®®åˆ†æµç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;åˆ é™¤åè®®åˆ†æµç­–ç•¥ä¹‹åï¼Œå…³é—­å¢å¼ºåˆ†æµï¼ŒCPUåŒæ¯”éª¤å‡50%ã€‚ä½†æ˜¯æ²¡å‡ å¤©ï¼Œè¿æ¥æ•°çªå‘åˆæ¥äº†ã€‚ä¸è¿‡cpu èµ·ä¼ä¸å¤§ã€‚è‡³æ­¤å¾—åˆ°2ä¸ªç»“è®ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è¿æ¥æ•°çªå¢æ˜¯å› ï¼Œä¸æ˜¯æœï¼›&lt;/li&gt;
&lt;li&gt;åè®®åˆ†æµæå…¶è€—è´¹CPUï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å’Œå®˜æ–¹åé¦ˆåï¼Œæç¤ºå…³é—­&lt;a href="https://bbs.ikuai8.com/thread-160444-1-1.html"&gt;å¢å¼ºåˆ†æµ&lt;/a&gt;ã€‚
å¦å¤–æŸ¥åˆ°å¢å¼ºåˆ†æµå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š&lt;a href="https://github.com/XIU2/CloudflareSpeedTest/issues/464"&gt;iKuaiçˆ±å¿«æ‹¨å·ä¸‹ï¼Œæ‰€æœ‰tcpingå¯¹ç«¯æ— æ³•æ­£å¸¸è¿”å›FINACK #464&lt;/a&gt;ã€‚æˆ‘ä»¬ä¹‹å‰å†…ç½‘ç¡®å®é‡åˆ°è¿‡æŸä¸ªæœåŠ¡é•¿æ—¶é—´ä¸Šä¼ æ•°æ®ä¹‹åï¼Œtcpä¼šè¯æ‹¿ä¸åˆ° finackåŒ…ï¼Œå¯¼è‡´ä¸šåŠ¡é€»è¾‘å¼‚å¸¸ï¼Œä¸€ç›´ä»¥ä¸ºæ˜¯å“ªä¸ªåœ°æ–¹NATè¡¨è¿‡æœŸæ·˜æ±°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;åæ¥ï¼Œè¿æ¥æ•°åˆçªå¢äº†ï¼Œè¿™æ¬¡åœ¨IDSç³»ç»Ÿä¸­æŸ¥çœ‹ï¼ˆä¹‹å‰å‡ æ¬¡ä¹Ÿçœ‹è¿‡ï¼Œç”±äºå¤´éƒ¨å‡ ä¸ªå¸¸è§çš„é«˜è¿æ¥æ•°ipï¼Œå¿½ç•¥äº†ï¼‰ï¼Œå–å¯¹åº”æ—¶é—´è¿æ¥æ•°top10ï¼Œå‘ç°æœ‰ä¸€ä¸ªåŠå…¬è®¾å¤‡æ®µçš„å¼‚å¸¸IPï¼š35.223.238.178ï¼Œä¸€åˆ†é’Ÿå‡ ä¸‡æ¡æ–°å»ºè¿æ¥ã€‚åœ¨tiä¸­æŸ¥åˆ°æ˜¯codeiumçš„ipï¼Œè”ç³»å¯¹åº”è®¾å¤‡è´Ÿè´£äººå‘ç°æ˜¯ä½¿ç”¨äº†windsurfï¼Œæœ€è¿‘æœ‰æ›´æ–°ç‰ˆæœ¬ã€‚
å€’æŸ¥è¯¥IPåœ¨IDSç³»ç»Ÿä¸­çš„è¿æ¥æ´»åŠ¨æƒ…å†µï¼Œä¸æ•…éšœæ—¶é—´å»åˆã€‚è‡³æ­¤ï¼Œç¡®å®šæ˜¯æœ€æ–°ç‰ˆæœ¬windsurf çš„bug å¯¼è‡´è¿æ¥æ•°å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;ç»“è®ºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è°¨æ…å¼€å¯åè®®åˆ†æµ&lt;ol&gt;
&lt;li&gt;æ”¶ç›Šä¸é«˜ï¼Œæ¶ˆè€—è¾ƒå¤§ï¼›&lt;/li&gt;
&lt;li&gt;çŒœæµ‹panabit å’Œfortinet æ€§èƒ½ä¼°è®¡æ›´å¥½ä¸€ç‚¹ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;è°¨æ…å¼€å¯åè®®åº“ä¸ç‰¹å¾åº“æ›´æ–°&lt;ol&gt;
&lt;li&gt;ç”±äºæ˜¯å®˜æ–¹è‡ªåŠ¨æ›´æ–°ï¼Œç­‰äºéšæ—¶å¯¹ç½‘ç»œè®¾å¤‡è¿›è¡Œå˜æ›´ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ç½‘ç»œè®¾å¤‡æ›´æ–°æ˜¯è¦æœ‰ä¸¥æ ¼å˜æ›´æµç¨‹ï¼Œå¦‚æœå¼•å…¥å¼‚å¸¸æ•°æ®å¯¼è‡´å¼‚å¸¸ï¼Œæ— æ³•é¢„è®¡æ— æ³•å›æ»šã€‚&lt;/li&gt;
&lt;li&gt;æ˜¯ä¸æ˜¯å› å™åºŸé£Ÿï¼Œå°±çœ‹åœºæ™¯äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å…³é—­å¢å¼ºåˆ†æµ&lt;ol&gt;
&lt;li&gt;å®˜æ–¹æå‡ºçš„å»ºè®®æ€è·¯ï¼Œè¯´æ˜å®¢æˆ·ä¸­å‡ºç°è¿‡å¯¼è‡´æ€§èƒ½å¼‚å¸¸çš„caseï¼›&lt;/li&gt;
&lt;li&gt;å­˜åœ¨finack å›åŒ…ä¸¢å¤±é—®é¢˜ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å¯¹å®¢æˆ·ç«¯è¿æ¥æ•°é™åˆ¶ï¼Ÿè¿˜åœ¨è€ƒè™‘ï¼Œä½†æ˜¯å¬è¯´åˆæœ‰bugã€‚&lt;/li&gt;
&lt;/ol&gt;</content><category term="2025"></category><category term="network"></category></entry><entry><title>AIæ—¶ä»£çš„åŸºç¡€è®¾æ–½</title><link href="https://fangpsh.github.io/posts/2025/2025-01-09.html" rel="alternate"></link><published>2025-01-09T00:00:00+08:00</published><updated>2025-01-09T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-01-09:/posts/2025/2025-01-09.html</id><summary type="html">&lt;p&gt;è¯»åˆ°ä¸€ç¯‡PRç¨¿ï¼Œå£°ç½‘è¦åšAIæ—¶ä»£çš„åŸºç¡€è®¾æ–½ã€‚è‚¡æ°‘ä¿¡ä¸ä¿¡æˆ‘ä¸çŸ¥é“ï¼Œæˆ‘ä¿¡æˆ‘ä¿¡ï¼å€Ÿç€AIå¹ä¸€æ³¢ï¼Œä½œä¸ºå‹å•†å‘˜å·¥æˆ‘æ‰‹é‡Œçš„æœŸæƒåˆèƒ½å€¼é’±äº†å§ğŸ¤‘ã€‚&lt;/p&gt;
&lt;p&gt;æ¯«ä¸æ€€ç–‘ï¼Œè¯­éŸ³ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¯»åˆ°ä¸€ç¯‡PRç¨¿ï¼Œå£°ç½‘è¦åšAIæ—¶ä»£çš„åŸºç¡€è®¾æ–½ã€‚è‚¡æ°‘ä¿¡ä¸ä¿¡æˆ‘ä¸çŸ¥é“ï¼Œæˆ‘ä¿¡æˆ‘ä¿¡ï¼å€Ÿç€AIå¹ä¸€æ³¢ï¼Œä½œä¸ºå‹å•†å‘˜å·¥æˆ‘æ‰‹é‡Œçš„æœŸæƒåˆèƒ½å€¼é’±äº†å§ğŸ¤‘ã€‚&lt;/p&gt;
&lt;p&gt;æ¯«ä¸æ€€ç–‘ï¼Œè¯­éŸ³äº¤äº’å’Œè§†é¢‘äº¤äº’ä¸€å®šæ˜¯æœªæ¥AIä¸»æµçš„äº¤äº’æ–¹å¼ï¼Œæ¯•ç«Ÿæ²¡æœ‰æ¯”è¿™æ›´è‡ªç„¶å’Œé«˜æ•ˆçš„æ–¹å¼ï¼ŒéŸ³è§†é¢‘çš„äº¤äº’æ–¹å¼ä¼šåƒiPhoneçš„è§¦æ‘¸å±ä¸€æ ·æ¨ªæ‰«ä¸–ç•Œå˜æˆé»˜è®¤å¼ã€‚ &lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼Œæˆ‘ä¸€ç›´è®¤ä¸ºï¼Œç¬¦åˆç›´è§‰æ˜¯ä¸€ä¸ªäº§å“æœ€ä½³çš„ç”Ÿé•¿æ–¹å¼ï¼Œè€Œäº§å“ç»ç†å°±æ˜¯è¦æ‰¾å‡ºæœ€ç¬¦åˆç”¨æˆ·ç›´è§‰çš„äº¤äº’æ–¹å¼ã€äº¤äº’é¡µé¢ã€‚ï¼ˆç”¨æˆ·ä¸ä¸€å®šæ˜¯ç»ˆç«¯ç”¨æˆ·ï¼Œä¾‹å¦‚ä½œä¸ºå£°ç½‘è¿™ç§ToBå‚å•†ï¼Œç”¨æˆ·å°±æ˜¯æœåŠ¡çš„å¼€å‘è€…ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äººè¯´ï¼Œä¸ºå•¥ä¸€å®šå¾—æ˜¯å®æ—¶éŸ³è§†é¢‘ï¼Œä¸èƒ½å’ŒAIä½ ä¸€å¥æˆ‘ä¸€å¥ï¼Œä¸€ä¸ªwebsocketï¼ˆopenapi ç›®å‰çš„realtime api çœ‹èµ·æ¥æ˜¯è¿™æ ·ï¼‰æˆ–è€…SSE æå®šï¼è¿™æ ·çš„è¯ï¼Œä½ æ°¸è¿œä¼šæ„Ÿè§‰å¯¹æ–¹æ˜¯ä¸ªæœºå™¨äººï¼Œä»–æ²¡æ³•ï¼ˆå®æ—¶ï¼‰æ„ŸçŸ¥ä½ ï¼Œä½ ä¹Ÿæ²¡æ³•æ‰“æ–­ä»–ã€‚&lt;/p&gt;
&lt;p&gt;é‚£æ¥ç€é—®é¢˜å°±æ˜¯ï¼Œä¼šä¸ä¼šæ˜¯å£°ç½‘ï¼Ÿä¸ªäººè§‰å¾—ä¸ä¸€å®šã€‚ï¼ˆæœ‰äººä¸€å®šè¦éª‚ï¼Œä½ è¯´çš„æ˜¯åºŸè¯ï¼è¦ä¸€å®šè‚¡ä»·è¿˜èƒ½è¶´åœ°ä¸Šï¼Ÿï¼‰
è¦åˆ¤æ–­è¿™ä¸ªé—®é¢˜ï¼Œç­‰äºåˆ¤æ–­å£°ç½‘æ˜¯å¦æœ‰å…ˆå‘ä¼˜åŠ¿ã€‚
å£°ç½‘ç­‰ä¸€ä¼—RTCå‚å•†åŸæ¥æ ‡æ¦œè‡ªå·±èƒ½åŠ›ï¼Œæ— éæ˜¯è¿™ä¹ˆå‡ ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç«¯åˆ°ç«¯å‡ msï¼›&lt;/li&gt;
&lt;li&gt;å¼±ç½‘ä¸‹ä¾æ—§ç‰›é€¼ï¼›&lt;/li&gt;
&lt;li&gt;é™å™ªã€çº é”™ã€å›å£°æ¶ˆé™¤ä¹‹ç±»ç­‰ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç¬¬1ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ï¼Œåœ¨åŸæ¥rtcçš„åœºæ™¯ï¼Œaå’Œb 2ä¸ªå®¢æˆ·ç«¯é€šä¿¡ï¼ŒæœåŠ¡ä¾›åº”å•†è¦åœ¨aå’Œbä¹‹é—´è§„åˆ’é€‰å‡ºä¸€æ¡æœ€ä½³è·¯å¾„ï¼šåŒ…æ‹¬aåˆ°æœåŠ¡å™¨xçš„æœ€ä½³è·¯å¾„ï¼Œbåˆ°æœåŠ¡å™¨yçš„æœ€ä½³è·¯å¾„ï¼ŒæœåŠ¡å™¨xåˆ°yçš„æœ€ä½³è·¯å¾„ã€‚ä½†æ˜¯åœ¨å’Œaiäº¤äº’æ—¶ï¼Œè¿™ä¸ªé—®é¢˜å˜æˆäº†åœ¨aå’ŒAIä¹‹é—´è§„åˆ’ä¸€æ¡è·¯å¾„ï¼ŒAIè‚¯å®šæ˜¯åœ¨IDCæ•°æ®ä¸­å¿ƒã€‚é—®é¢˜ä¸€ä¸‹å­é™çº§æˆåªéœ€è¦è§£å†³æˆä¸€ç«¯çš„æ¥å…¥è´¨é‡é—®é¢˜ï¼Œè§„åˆ’çš„å¤æ‚åº¦ç¬é—´å¡Œé™·æˆå°å­¦ç”Ÿçº§åˆ«ï¼Œå’ŒCDNçš„è°ƒåº¦æ²¡å•¥å·®åˆ«ï¼Œå£°ç½‘è¿™å—ç§¯ç´¯çš„ä¼˜åŠ¿æ— äº†ã€‚ç¬¬2ç‚¹å’Œç¬¬3ç‚¹ç»éªŒ/ä¼˜åŠ¿èƒ½å¤ç”¨ï¼Œä½†æ˜¯å¯èƒ½ä¼šå› ä¸ºä¸‹é¢è¿™ä¸ªçŒœæƒ³æ¶ˆæ•£ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨äººå’Œäººçš„RTCäº¤äº’ä¸­ï¼Œç›¸å½“äºæœ‰2æ¡æµï¼Œaæ‹‰å–bçš„å£°éŸ³å’Œç”»é¢ï¼Œbæ‹‰å–açš„å£°éŸ³å’Œç”»é¢ã€‚RTCäº¤äº’ä¸­æœ€å¤§çš„æˆæœ¬æ¶ˆè€—åœ¨äºè¿™äº›å£°éŸ³ç”»é¢çš„ä¼ è¾“ã€‚
RTCåœºæ™¯ä¸­ï¼Œä¾›åº”å•†å…³æ³¨å¸§ç‡ï¼Œç”»é¢ã€å£°éŸ³æµç•…åº¦ç­‰ã€‚
ä½†æ˜¯åœ¨å’ŒAIçš„äº¤äº’ä¸­ï¼Œç”¨æˆ·ç»™åˆ°AIçš„ä¿¡æ¯ï¼Œæ¯”å¦‚è§†é¢‘ï¼Œæ˜¯ä¸æ˜¯ä¸å†éœ€è¦é‚£ä¹ˆé«˜çš„å¸§ç‡äº†ï¼Ÿåªä¼ å…³é”®å¸§æ˜¯å¦å¯ä»¥ï¼Ÿå› ä¸ºæ˜¯ç»™AIè¯»å–çš„ï¼Œé‚£å£°éŸ³å’Œç”»é¢æ˜¯å¦å¯ä»¥å‹ç¼©ï¼Œç²¾ç®€çš„æ›´åŠ æœºåˆ¶ï¼Œä¸ä»…æœ‰åˆ©äºAIæ¶ˆåŒ–ï¼Œä¹Ÿèƒ½å¤§å¹…é™ä½ä¸Šè¡Œå¸¦å®½æˆæœ¬ã€‚
å¦‚æœæœªæ¥ç«¯ä¸Šçš„è®¡ç®—èƒ½åŠ›ç»§ç»­åŠ å¼ºï¼ŒAIçš„ä¸‹è¡Œè¯­éŸ³èƒ½ä¸èƒ½å˜æˆç«¯ä¸Šçš„TTSæ¨¡å‹è‡ªåŠ¨ç”Ÿæˆï¼Œä¸‹è¡Œçš„æµé‡å˜æˆäº†ç‰¹æ®Šçš„ä¿¡ä»¤ä¿¡æ¯ã€‚
è¿™æ ·æƒ³çš„è¯ï¼Œæœªæ¥AIå’Œäººçš„äº¤äº’å‘ˆç°å½¢å¼ä¼šæ˜¯éŸ³è§†é¢‘ï¼Œä½†äº¤äº’åè®®ææœ‰å¯èƒ½ä¼šåŸºäºæ•ˆç‡ã€æˆæœ¬ç­‰åŸå› è¢«é‡æ–°è®¾è®¡ã€‚&lt;/p&gt;
&lt;p&gt;å£°ç½‘è¦æˆä¸ºåŸºç¡€è®¾æ–½ï¼Œé™¤éä»–åˆ¶å®šå’Œæ¨å¹¿äº†æ–°çš„åè®®ï¼Œå‡­å€Ÿç›®å‰çš„é¢†å…ˆèº«ä½å°†ä»–çš„â€ç§æœ‰åè®®â€œå˜æˆäº‹å®æ ‡å‡†ã€‚ä½†ç›®å‰AIè¿˜åœ¨ç™¾å›¢å¤§æˆ˜ï¼Œé¹¿æ­»è°æ‰‹è¿˜æœªå¯çŸ¥ã€‚ä¸ªäººè§‰å¾—openapi ç°åœ¨çš„&lt;a href="https://platform.openai.com/docs/api-reference/introduction"&gt;api&lt;/a&gt; ç¦»ç†æƒ³çš„å®æ—¶äº¤äº’åè®®è¿˜å¾ˆè¿œï¼Œå›½å†…è®¿é—®ä¸äº†çš„æœ‹å‹å¯ä»¥çœ‹è¿™ä¸ª&lt;a href="https://juejin.cn/post/7420272008146321434"&gt;ç¿»è¯‘æ–‡æ¡£ç‰‡æ®µ&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2025"></category><category term="ai"></category><category term="rtc"></category></entry><entry><title>çœé—´ç»“ç®—å¯¹ä¸šåŠ¡çš„å¯èƒ½å½±å“</title><link href="https://fangpsh.github.io/posts/2025/2025-01-03.html" rel="alternate"></link><published>2025-01-03T00:00:00+08:00</published><updated>2025-01-03T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2025-01-03:/posts/2025/2025-01-03.html</id><summary type="html">&lt;p&gt;23å¹´å°¾å·´çš„æ—¶å€™ï¼Œå‚åŠ äº†è€éŸ©ç»„ç»‡çš„äº†ä¸€æ¬¡çº¿ä¸‹èšä¼šï¼Œåœ¨é‚£ä¸ªä¼šä¸Šå¬åˆ°äº†è¿è¥å•†ç›¸å…³äººå‘˜åˆ†äº«çœé—´ç»“ç®—ï¼Œè¿™äº‹å…¶å®å¯¹ç°åœ¨å…¬å¸çš„ä¸šåŠ¡æœ‰ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;23å¹´å°¾å·´çš„æ—¶å€™ï¼Œå‚åŠ äº†è€éŸ©ç»„ç»‡çš„äº†ä¸€æ¬¡çº¿ä¸‹èšä¼šï¼Œåœ¨é‚£ä¸ªä¼šä¸Šå¬åˆ°äº†è¿è¥å•†ç›¸å…³äººå‘˜åˆ†äº«çœé—´ç»“ç®—ï¼Œè¿™äº‹å…¶å®å¯¹ç°åœ¨å…¬å¸çš„ä¸šåŠ¡æœ‰ç‚¹å½±å“ã€‚å¬è¯´å‡ ä¸ªæœˆä¹‹åæŸäº›åœ°åŒºçš„æœºå™¨äº’é€šé‡åˆ°äº†QoSï¼Œå½±å“äº†ä¸šåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;12æœˆä»½ç½‘ä¸Šçƒ­ä¼ æ·±åœ³è”é€šè¦å®¢æˆ·ç­¾è®¢åè®®ä¿è¯ä¹¦ï¼Œæ˜ç›®å¼ èƒ†ã€éœ¸ç‹æ¡æ¬¾ã€‚æˆ‘ä»¬ä¸€æ¡è”é€šçš„å•†å®½ä¸Šè¡Œä¸€ç›´å¾ˆæ»¡ï¼Œå®¢æˆ·ç»ç†ä¹Ÿæ‰¾è¿‡æˆ‘ä»¬å‡ æ¬¡ï¼Œè§£é‡Šäº†æ˜¯æ­£å¸¸ä¸šåŠ¡ï¼Œä¹Ÿæš‚æ—¶æ²¡ä¸ºéš¾ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘åšé¥­çš„æ—¶å€™å¬äº†ä¸€æœŸè€éŸ©åœ¨&lt;a href="https://www.xiaoyuzhoufm.com/episode/676833509e0c2b849ceb9973"&gt;æ´¥æ´¥ä¹é“&lt;/a&gt;çš„èŠ‚ç›®ï¼Œè®²pcdnå’Œçœé—´ç»“ç®—çš„äº‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›æ€»ç»“å’Œå‘æ•£çš„çŒœæƒ³ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;çœé—´ç»“ç®—å®è¡Œä¸€å¹´åå‡ ä¸ªåæœï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æµé‡æµå‡ºå¤§çœï¼Œè¿è¥å•†é€æ­¥å¼€å§‹æä»·ï¼›&lt;/li&gt;
&lt;li&gt;è·¨çœæµé‡ä¼šè¢«è¿è¥å•†ä¸»åŠ¨QoSï¼Œè´¨é‡ä¸‹é™ï¼›&lt;/li&gt;
&lt;li&gt;éƒ¨åˆ†å®¢æˆ·è§„é¿çœé—´è´¹ç”¨ä¸QoSï¼Œä¸»åŠ¨èµ°ï¼ˆæŒ¤ï¼‰ä¸‰ç½‘äº¤æ¢ä¸­å¿ƒï¼Œå¯¼è‡´ä¸‰ç½‘äº¤æ¢è´¨é‡åŠ£åŒ–ï¼›&lt;ol&gt;
&lt;li&gt;å¬è¯´å£°ç½‘åŸæ¥çš„è°ƒåº¦ç­–ç•¥ï¼Œä¼¼ä¹æ˜¯å…¨å±€çš„è´¨é‡æ¢æµ‹å½¢å¼ï¼Œåˆ©ç”¨äº†åŸæ¥è·¨ç½‘çš„è´¨é‡ä¿è¯ï¼Œé™ä½æˆæœ¬ï¼Œä¾‹å¦‚ç”¨ç§»åŠ¨å’Œè”é€šæ¥è¦†ç›–ç”µä¿¡ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å·¥ä¿¡éƒ¨çº¦è°ˆå¤´éƒ¨ä¼ä¸šç¦æ­¢é‡‡è´­pcdn&lt;ol&gt;
&lt;li&gt;å¦‚æœä¾›éœ€ä¸å˜çš„æƒ…å†µä¸‹ï¼Œcdnéœ€æ±‚å˜å¤§ï¼Œå¯èƒ½å¯¼è‡´å¸¦å®½äº§å“æ¶¨ä»·ï¼Ÿï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹ä¸šåŠ¡çš„å¯èƒ½å½±å“ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æå‡æœ¬çœè¦†ç›–ç‡ï¼Œä¸èƒ½å†ä»¥æˆæœ¬ä¼˜å…ˆè°ƒåº¦ï¼›&lt;ol&gt;
&lt;li&gt;ä¸ä»…ä¸èƒ½æˆæœ¬ä¼˜å…ˆè°ƒåº¦ï¼ŒåŸæ¥ä¸€äº›æŒ‰å¤§åŒºçš„è°ƒåº¦ç­–ç•¥ï¼Œä¾‹å¦‚å•ç‹¬å»ºç«‹çš„é«˜å¸¦å®½æ³„æ´ªèŠ‚ç‚¹ï¼Œéœ€è¦å¦å¤–è¯„ä¼°QoSé£é™©ã€‚åˆ«å¸¦å®½å‡†å¤‡å¥½äº†ï¼Œè¢«è¿è¥å•†æ‹¦ä½äº†ğŸ¤¡ï¼›&lt;/li&gt;
&lt;li&gt;è°ƒåº¦ä¸Šï¼Œå¯¹IPåº“çš„å‡†ç¡®æ€§è¦æ±‚æé«˜ï¼Œçœä»½è¯†åˆ«é”™è¯¯ï¼Œæˆ–è€…é™çº§è°ƒåº¦ï¼Œå¯èƒ½éœ€è¦æ›´åŠ ä¿å®ˆï¼›&lt;/li&gt;
&lt;li&gt;çœé—´ç»“ç®—ï¼Œçœ‹ä¸€äº›é€šçŸ¥ï¼Œå¥½åƒä¸€å®šçº§åˆ«çš„æœºæˆ¿ä¸å—å½±å“ï¼Œå…·ä½“è¿˜å¾—å’Œè¿è¥å•†æ²Ÿé€šäº†ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;è·¨çœè´¨é‡ç›‘æµ‹ï¼ŒQoSç›‘æµ‹ï¼›&lt;ol&gt;
&lt;li&gt;RTCæœºå™¨ä¹‹é—´çš„çº§è”æ¨æ‹‰æµï¼ŒCDNçš„å¤šçº§è·¨åŒºå›æºï¼Œéƒ½å¾—æ³¨æ„äº†ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;é¢ç²‰å³å°†æ¶¨ä»·ï¼Œé¢åŒ…ä¹Ÿè·‘ä¸äº†ï¼Œå‰å‡ å¹´ä»·æ ¼æˆ˜æå‡ºæ¥çš„äº§å“æ·±åº¦æŠ˜æ‰£å¯èƒ½è¦æ”¶ç´§ï¼Œæ–°ç­¾ç»­ç­¾å®¢æˆ·è¿›è¡Œé¢„é˜²å¼ä¸Šè°ƒä»·æ ¼ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœæœ‰è½¬å”®ä¸šåŠ¡ï¼Œä¾‹å¦‚äº‘å•†CDNç±»ç­‰äº§å“å¯èƒ½ä¼šæ¶¨ä»·ï¼ŒèƒŒé èƒŒåè®®å¾—å°å¿ƒï¼›&lt;ol&gt;
&lt;li&gt;å› ä¸ºè¿‡å»å‡ å¹´ä»–ä»¬è°ƒåº¦ä¸€ç›´æ˜¯æŒ‰ç…§æˆæœ¬ä¼˜å…ˆï¼Œä¾‹å¦‚æ·±åœ³è°ƒåº¦åˆ°è¥¿å®‰ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å¤šåœ°åŠå…¬åŒºäº’è”çš„QoSé—®é¢˜ï¼›&lt;ol&gt;
&lt;li&gt;è¿™ä¸ªæˆ‘ä»¬å½±å“ä¸åˆ°ï¼Œå› ä¸ºæ˜¯æ˜ŸçŠ¶ç»„ç½‘ï¼Œä¸­å¿ƒç‚¹åœ¨äº‘ä¸ŠBGPï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼Œè¿™æœŸèŠ‚ç›®ä¸­ä¸»æŒäººå’Œå˜‰å®¾å¯¹pcdnçš„è§‚ç‚¹ä¸å¤ªæ­£é¢ï¼Œä½†æ˜¯æˆ‘åœ¨&lt;a href="https://dao.fm/%e4%b9%b1%e7%82%96%e6%96%b0%e9%b2%9c%e4%ba%8b%e5%84%bf/"&gt;æ´¥æ´¥ä¹é“å®˜ç½‘&lt;/a&gt;æµè§ˆæ—¶ç‚¹å‡»äº†ä¸‹è½½èŠ‚ç›®ï¼Œå‘ç°è°ƒåˆ°äº†è¿™ä¹ˆä¸ªçš„åœ°å€ï¼Œé‡‘å±±äº‘CDNçš„åŸŸåï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;https://153-99-2-115-adfc9a47.ksyungslb.com:8043/media-dao.wavpub.com/85/31/09/20241130010146-UMRLmZHwZfcQpZnG.mp3?kstype=L&amp;amp;ksnode=dgct63&amp;amp;kssessionid=9ab878e59fb640d5fbd85f3e7181f23e&amp;amp;ksmark=LXxMU3wtfC18LXwtfC18LXwtfC18S0Y&amp;amp;kslunar=haun21

ip: 153.99.2.115
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™çœ‹èµ·æ¥æœ‰ç‚¹åƒæ˜¯pcdnçš„èŠ‚ç‚¹ï¼Œç»“åˆ&lt;a href="https://x.threatbook.com/v5/ip/153.99.2.115"&gt;å¾®æ­¥&lt;/a&gt;æç¤ºæ˜¯ä½å®…ç”¨æˆ·ï¼Œæ›´åƒäº†ã€‚ã€‚ã€‚
é‡‘å±±äº‘å‰å‡ å¹´æ”¶è´­äº†äº‘å¸†åŠ é€Ÿï¼Œ&lt;a href="https://mp.weixin.qq.com/s/GjtmeLh1OTAmSmrft-9qAw"&gt;åŸåˆ› Paper | å¤±æ§çš„ PCDNï¼šè§‚å¯Ÿ PCDN æŠ€æœ¯ç°çŠ¶ä¸æ¡ˆä¾‹åˆ†æ&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2025"></category><category term="isp"></category></entry><entry><title>å†æ¬¡è¸©åˆ°r8169çš„å‘</title><link href="https://fangpsh.github.io/posts/2024/2024-10-30.html" rel="alternate"></link><published>2024-10-30T00:00:00+08:00</published><updated>2024-10-30T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-10-30:/posts/2024/2024-10-30.html</id><summary type="html">&lt;p&gt;æœ‰ä¸€å°Linuxæœºå™¨ï¼ŒåŒç½‘å¡ï¼Œç½‘å¡1ï¼ˆæ¿è½½çš„åƒå…† Realtek RTL8111/8168/8411ï¼‰æ¥å†…ç½‘ï¼Œç½‘å¡2ï¼ˆPCIEæ‰©å±•ï¼Œä¹Ÿæ˜¯åƒå…†Realtek RTL8111/8168/8411ï¼‰æ¥ç‰¹å®šWANå‡ºå£ï¼Œç›˜è·¯ä¸€ä¸ªIPã€‚è·‘äº†å‡ å¤©ï¼Œå‘ç°é€Ÿ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æœ‰ä¸€å°Linuxæœºå™¨ï¼ŒåŒç½‘å¡ï¼Œç½‘å¡1ï¼ˆæ¿è½½çš„åƒå…† Realtek RTL8111/8168/8411ï¼‰æ¥å†…ç½‘ï¼Œç½‘å¡2ï¼ˆPCIEæ‰©å±•ï¼Œä¹Ÿæ˜¯åƒå…†Realtek RTL8111/8168/8411ï¼‰æ¥ç‰¹å®šWANå‡ºå£ï¼Œç›˜è·¯ä¸€ä¸ªIPã€‚è·‘äº†å‡ å¤©ï¼Œå‘ç°é€Ÿåº¦ç‰¹åˆ«æ…¢ï¼Œå‹åœ¨500KB/s ä»¥ä¸‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ethtool çœ‹ç½‘å¡é€Ÿåº¦éƒ½æ˜¯åƒå…†ï¼Œæ²¡é™é€Ÿï¼›çœ‹ç«¯å£æ²¡è·‘æ»¡ï¼›&lt;/li&gt;
&lt;li&gt;å…³é—­ç½‘å¡1ï¼Œæµé‡ç›´æ¥å…¨éƒ¨èµ°ç½‘å¡2ï¼Œç°è±¡ä¾æ—§ï¼›&lt;/li&gt;
&lt;li&gt;é•¿pingï¼Œä¸ä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å…¶ä»–æœºå™¨åŒwanå‡ºå£ï¼Œæµ‹é€Ÿï¼Œæ­£å¸¸ï¼Œæ’é™¤å‡ºå£é—®é¢˜ï¼›&lt;/li&gt;
&lt;li&gt;ç§»é™¤æ‰€æœ‰ç­–ç•¥è·¯ç”±å’Œé˜²ç«å¢™è§„åˆ™ï¼Œç°è±¡ä¾æ—§ï¼›&lt;/li&gt;
&lt;li&gt;å¼€å§‹æ€€ç–‘æ˜¯ç½‘å¡é©±åŠ¨é—®é¢˜æˆ–è€…ç½‘çº¿é—®é¢˜ï¼Œå†…ç½‘scp åˆ°æœºå™¨ï¼Œé€Ÿåº¦å´æ­£å¸¸ï¼Œèƒ½ä¸Šåƒå…†ï¼Œå¥‡æ€ªäº†ï¼ï¼&lt;/li&gt;
&lt;li&gt;æ€€ç–‘æ˜¯è¿™ä¸ªä¾¿å®œçš„PCIE ç½‘å¡2çš„é—®é¢˜ï¼Œåˆ‡æ¢åˆ°ç½‘å¡1ï¼Œç°è±¡ä¾æ—§ï¼›&lt;/li&gt;
&lt;li&gt;æŒ‰debian 12+ slow internet speed æœç´¢äº†ä¸€ä¸‹ï¼Œçœ‹åˆ°r8169ï¼Œæ­»å»çš„è®°å¿†åˆå¤æ´»äº†ï¼Œä¹‹å‰æŠ˜è…¾è¿‡ä¸€å°ä¸»æœºï¼Œä¹Ÿæ˜¯é»˜è®¤è£…äº†r8169é©±åŠ¨ï¼Œæ­»æ´»å¼‚å¸¸ï¼Œæ‰‹å·¥æçš„r8168 é©±åŠ¨ï¼Œå±è”½r8169åºŸäº†åŠå¤©åŠ²ã€‚&lt;/li&gt;
&lt;li&gt;ä¿®å¤ï¼š&lt;ol&gt;
&lt;li&gt;apt-get install r8168-dkms&lt;/li&gt;
&lt;li&gt;echo "blacklist r8169" | sudo tee -a /etc/modprobe.d/blacklist.conf&lt;/li&gt;
&lt;li&gt;reboot&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åæ€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ²¡æƒ³éƒ½åˆ°debian12 äº†ï¼Œè¿™ä¸ªå‘è¿˜èƒ½å­˜åœ¨ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æƒ³åˆ°å¼‚å¸¸ç°è±¡æ˜¯å¤–ç½‘é™åˆ¶åœ¨400~500KBä»¥ä¸‹ï¼Œå†…ç½‘å´æ­£å¸¸ï¼Œå¥‡äº†æ€ªã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# lshw -C network
  *-network
       description: Ethernet interface
       product: RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller
       vendor: Realtek Semiconductor Co., Ltd.
       physical id: 0
       bus info: pci@0000:03:00.0
       logical name: enp3s0
       version: 15
       serial: 70:...
       size: 1Gbit/s
       capacity: 1Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi pciexpress msix bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=r8168 driverversion=8.051.02-NAPI duplex=full ip=192.168... latency=0 link=yes multicast=yes port=twisted pair speed=1Gbit/s
       resources: irq:16 ioport:4000(size=256) memory:c2304000-c2304fff memory:c2300000-c2303fff
  *-network
       description: Ethernet interface
       product: RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller
       vendor: Realtek Semiconductor Co., Ltd.
       physical id: 0
       bus info: pci@0000:04:00.0
       logical name: enp4s0
       version: 15
       serial: 00:...
       size: 1Gbit/s
       capacity: 1Gbit/s
       width: 64 bits
       clock: 33MHz
       capabilities: pm msi pciexpress msix bus_master cap_list ethernet physical tp 10bt 10bt-fd 100bt 100bt-fd 1000bt-fd autonegotiation
       configuration: autonegotiation=on broadcast=yes driver=r8168 driverversion=8.051.02-NAPI duplex=full ip=192.168... latency=0 link=yes multicast=yes port=twisted pair speed=1Gbit/s
       resources: irq:17 ioport:3000(size=256) memory:c2204000-c2204fff memory:c2200000-c2203fff
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;2024-11-22æ›´æ–°ï¼šæœŸé—´é‡å¯äº†ä¸€æ¬¡ç³»ç»Ÿä¹‹åï¼Œåˆæ¢å¤å¼‚å¸¸åŸæ ·äº†ã€‚
æœäº†ä¸€åœˆï¼Œå…³é—­ç½‘å¡2çš„TSO ä¹‹åï¼Œæ¢å¤æ­£å¸¸ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt; ethtool  --show-offload   enp3s0  # æŸ¥çœ‹tsoæ˜¯å¦å¼€å¯
&amp;gt; ethtool  -K enp3s0 tso off        # å…³é—­tso
&amp;gt; ethtool  -K enp3s0 gso off        # é¡ºä¾¿å…³äº†gso
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#æŒä¹…åŒ–ï¼Œä¿®æ”¹/etc/network/interfaces, æ·»åŠ ï¼š
auto enp3s0
  iface enp3s0 inet dhcp
  metric 100
  offload-tso off
  offload-gso off
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2024"></category><category term="linux"></category><category term="network"></category></entry><entry><title>Systemd Restart=alwaysä¸ä¸€å®šalways</title><link href="https://fangpsh.github.io/posts/2024/2024-05-14.html" rel="alternate"></link><published>2024-05-14T00:00:00+08:00</published><updated>2024-05-14T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-05-14:/posts/2024/2024-05-14.html</id><summary type="html">&lt;p&gt;æ•´ç†ç¬”è®°ï¼Œå‘ç°ä¹‹å‰é—ç•™çš„todoï¼Œå¥½åƒæ˜¯ 5ã€6 å¹´å‰ä¸€æ¬¡æ•…éšœï¼ŒæœåŠ¡æ²¡æœ‰è‡ªåŠ¨æ‹‰èµ·ï¼Œå› ä¸ºå¤§å®¶éƒ½è¯¯è§£ï¼ˆä¸å¤Ÿäº†è§£ï¼‰ Systemd çš„ Restartã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œä¸ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ•´ç†ç¬”è®°ï¼Œå‘ç°ä¹‹å‰é—ç•™çš„todoï¼Œå¥½åƒæ˜¯ 5ã€6 å¹´å‰ä¸€æ¬¡æ•…éšœï¼ŒæœåŠ¡æ²¡æœ‰è‡ªåŠ¨æ‹‰èµ·ï¼Œå› ä¸ºå¤§å®¶éƒ½è¯¯è§£ï¼ˆä¸å¤Ÿäº†è§£ï¼‰ Systemd çš„ Restartã€‚&lt;/p&gt;
&lt;p&gt;ç®€å•æ¥è¯´ï¼Œä¸èƒ½ç®€å•çš„ è®¤ä¸ºåœ¨ Systemd Service Unit  ä¸­é…ç½®ä¸€ä¸ª&lt;code&gt;Restart=always&lt;/code&gt; åï¼ŒæœåŠ¡èƒ½å¤Ÿåœ¨ä»»ä½•å¤±è´¥çš„æƒ…å†µä¸‹è‡ªåŠ¨é‡å¯ã€‚è¿™æ ·é…ç½®ï¼Œå¦‚æœé‡åˆ°é…ç½®é”™è¯¯ã€æœåŠ¡ä¾èµ–ç­‰å„ç§æƒ…å†µï¼Œå‡ ç§’å†…é‡å¯å¤±è´¥ï¼Œç›´æ¥è¿›å…¥å¤±è´¥çŠ¶æ€ï¼Œæ—¥å¿—æ˜¾ç¤ºï¼š&lt;code&gt;repeated too quickly&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸ºè¿˜æœ‰å¦å¤–å‡ ä¸ªå‚æ•°ï¼Œå³ systemd çš„é»˜è®¤è¡Œä¸ºï¼Œä¸å…è®¸æ— é™é‡å¯çš„æƒ…å†µå‡ºç°ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;RestartSecï¼šé‡å¯å‰æš‚åœå‡ ç§’ï¼‰&lt;/li&gt;
&lt;li&gt;StartLimitIntervalSec  å’ŒStartLimitBurst è”åˆæ§åˆ¶ï¼Œåœ¨ StartLimitIntervalSec æœ€å¤šå¯åŠ¨å’ŒStartLimitBurstæ¬¡ï¼Œå¦‚æœå¤±è´¥ï¼Œç›´æ¥è¿›å…¥ failed çŠ¶æ€ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šè¯´å—ï¼Œéƒ½æ²¡è®¾ç½®è¿™äº›å‘€ï¼Œå¯¹äº†ï¼Œå°±æ˜¯å› ä¸ºæ²¡é…ç½®ï¼ˆä¸çŸ¥é“é…ç½®ï¼‰ï¼Œsystemd æœ‰é»˜è®¤å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;DefaultRestartSec=100ms
DefaultStartLimitInterval=10s
DefaultStartLimitBurst=5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯æ¬¡é‡å¯å‰å°±ç­‰å¾… 100msï¼Œè¿›å…¥å¤±è´¥ï¼Œå†æ¬¡å°è¯•ï¼Œå†å¤±è´¥ï¼Œå†ç­‰å¾…ã€‚å¦‚æœå¯åŠ¨åè¿›å…¥å¤±è´¥çš„é€Ÿåº¦éå¸¸å¿«ï¼ˆé…ç½®é”™è¯¯ã€å¾ªåä¾èµ–ç­‰æƒ…å†µï¼‰ï¼Œç­‰äº 100ms é‡è¯•ä¸€æ¬¡ï¼Œ5æ¬¡æœºä¼šåœ¨ 1s å†… è‚¯å®šå°±è€—å®Œäº†ã€‚è¿™ä¹‹åï¼Œsystemd ä¸ä¼šå†å°è¯•é‡å¯æœåŠ¡ï¼Œé™¤éç»è¿‡äº†&lt;code&gt;StartLimitInterval&lt;/code&gt;ä¹‹åï¼Œä½ æ‰‹å·¥é‡å¯äº†æœåŠ¡ã€‚æˆ–è€…&lt;code&gt;systemctl reset-failed&lt;/code&gt; æ¸…ç©ºè®¡æ•°å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¯èƒ½æˆ‘ä»¬ç†æƒ³çš„æ˜¯ systemd  å‡ ç§’é’Ÿå°è¯•é‡å¯ä¸€æ¬¡æˆ‘ä»¬çš„æœåŠ¡ï¼Œæ°¸è¿œå°è¯•ä¸‹å»ï¼Œç›´åˆ°æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;å‡ ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨é»˜è®¤systemdé…ç½®ä¸‹ï¼Œ æŒ‡å®šRestartSecï¼Œä¾‹å¦‚ç­‰äº 3 ç§’ï¼Œ&lt;code&gt;3*5&amp;gt;DefaultStartLimitInterval(10s)&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç²¾ç»†åŒ–æ§åˆ¶æ¯ä¸ª æœåŠ¡çš„RestartSecã€StartLimitBurstã€StartLimitInterval&lt;ol&gt;
&lt;li&gt;ä¾‹å¦‚å°†StartLimitIntervalè®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼Œæ— é™æ—¶é—´å†…å°è¯•é‡å¯&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹å…¨å±€é»˜è®¤çš„ 3 ä¸ªå‚æ•°ï¼ˆè°¨æ…ï¼‰ï¼›&lt;ol&gt;
&lt;li&gt;DefaultRestartSecå¤ªå¤§ï¼ŒæœåŠ¡å¯èƒ½æ— æ³•ç«‹å³æ¢å¤ï¼ŒSLA æ˜¯æŒ‰ç§’è®¡ç®—çš„ï¼›&lt;/li&gt;
&lt;li&gt;ç›´æ¥å°†DefaultStartLimitIntervalè®¾ç½®ä¸º 0ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡CPU æ—¶é—´æµªè´¹åœ¨é‡å¯æœåŠ¡ä¸Šï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹å®ŒHacker News ä¸Šçš„è®¨è®º&lt;a href="https://news.ycombinator.com/item?id=39032752"&gt;Systemd: Enable indefinite service restarts (stapelberg.ch)&lt;/a&gt;ï¼Œæˆ‘å€¾å‘äºè®¤ä¸ºè¿™ç§é»˜è®¤è®¾ç½®æ˜¯å¯¹çš„ï¼Œsystemd é¦–å…ˆè¦ä¿è¯é‡å¯æ—¶ï¼ŒæœåŠ¡è¦å°½å¿«æ‹‰èµ·ï¼ŒRestartSec éœ€è¦å°½å¯èƒ½å°ã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œå¦‚æœå­˜åœ¨é»˜è®¤æ— é™é‡å¯çš„ç­–ç•¥ï¼Œå¯èƒ½å¯¼è‡´ CPUèµ„æºè€—è´¹åœ¨é‡å¯ä¸Šã€‚ä¾‹å¦‚è®¨è®ºä¸­æåˆ°çš„ç§»åŠ¨ç«¯ç”µæ± çš„é—®é¢˜ã€‚&lt;br&gt;
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒæœåŠ¡å¯åŠ¨ï¼Œå¯èƒ½è¿˜ä¼´éšç€ä¸€ç³»åˆ—çš„ IO è¡Œä¸ºï¼ˆæ¸…ç†æ—¥å¿—ã€å‡†å¤‡ç¼“å­˜ç­‰ï¼‰ï¼Œæˆ–ä¸å…¶ä»–æœåŠ¡é€šä¿¡ï¼ˆä»å¤–éƒ¨æ‹‰å–é…ç½®ï¼Œå‘é€ä¿¡æ¯ç­‰ï¼‰ï¼Œæ§åˆ¶ä¸å¥½ï¼Œéå¸¸å®¹æ˜“å˜æˆ DoSã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‰€ä»¥å½“æˆ‘ä»¬ä¸»åŠ¨è®¾ç½®ä¸ºæ— é™é‡å¯æ—¶ï¼Œä¹Ÿéœ€è¦æ³¨æ„æ˜¯å¦ä¼šå¸¦æ¥å‰¯ä½œç”¨ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åœ¨äº’è”ç½‘ä¸Šæœç´¢ï¼Œæœ‰å¤§é‡çš„ç”¨æˆ·è½å…¥è¿™ä¸ªæƒ³å½“ç„¶çš„é€»è¾‘ï¼Œæˆ‘æ€€ç–‘è¿™ä¸ªè®¾è®¡ä¸Šä¸ç¬¦åˆç”¨æˆ·ç›´è§‰ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çŒœæƒ³ä½œè€…è¿™ä¹ˆè®¾è®¡ï¼Œæ˜¯å› ä¸ºåº•å±‚çš„æµæ§ç®—æ³•æ€ç»´ä¹ æƒ¯ï¼Œå¾€ä¸Šå˜æˆäº†äº§å“é€»è¾‘ï¼Œä»ä¸‹å¾€ä¸Šæ€è€ƒï¼Œè€Œä¸æ˜¯ä»ç”¨æˆ·è§’åº¦å€’æ¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ Systemd é‡‡ç”¨å¦å¤–ä¸€ç§é€»è¾‘ï¼šåœ¨StartLimitInterval æ—¶é—´å°è¯•StartLimitBurst ä¹‹åï¼Œä¸è¿›å…¥æ°¸ä¹…å¤±è´¥çŠ¶æ€ï¼Œè€Œæ˜¯ç­‰å¾…StartLimitInterval ç»“æŸä¹‹åï¼Œåœ¨æ–°çš„ä¸€è½®ä¸­ï¼Œå†æ¬¡å°è¯•å‘¢ï¼Ÿæˆ–è€…è¯´ç»è¿‡ä¸€è½®é‡å¯å¤±è´¥åï¼Œç­‰å¾…çš„æ—¶é—´é—´éš”å¯ä»¥è®©ç”¨æˆ·æŒ‡å®šï¼Œæ˜¯ç­‰å¾…å›ºå®šé—´éš”ï¼Œè¿˜æ˜¯é€’å¢ï¼Œäº¦æˆ–æŒ‡æ•°å¢é•¿ã€‚&lt;/p&gt;
&lt;p&gt;å³å½“ç”¨æˆ·æŒ‡å®š &lt;code&gt;Restart=&lt;/code&gt; æ—¶ï¼Œéœ€è¦å†é…åˆä¸Šè¿°é—´éš”ç­‰å¾…æ—¶é—´æ‰å¯ç”Ÿæ•ˆã€‚&lt;/p&gt;</content><category term="2024"></category><category term="systemd"></category></entry><entry><title>å‡ºæµ·å¢ƒå¤–äº‘è®¡ç®—ã€IDCå‚å•†æ¨è</title><link href="https://fangpsh.github.io/posts/2024/2024-05-13.html" rel="alternate"></link><published>2024-05-13T00:00:00+08:00</published><updated>2024-05-13T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-05-13:/posts/2024/2024-05-13.html</id><summary type="html">&lt;p&gt;ä¹‹å‰å†™è¿‡ä¸€ç¯‡å¦‚ä½•&lt;a href="https://fangpsh.github.io/posts/2022/2022-10-14.html"&gt;é¡ºç€ç½‘çº¿æ‰¾ä¾›åº”å•†&lt;/a&gt;ã€‚è¿™æ¬¡ç½—åˆ—ä¸‹å¸¸è§çš„ï¼Œåœ¨å¢ƒå†…å¯æ¥è§¦åˆ°æœ‰å¢ƒå¤–è®¡ç®—èµ„æºçš„å‚å•†ã€‚&lt;/p&gt;
&lt;p&gt;ç­›é€‰æ ‡å‡†ï¼šæœ‰å¢ƒå¤–è®¡ç®— â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¹‹å‰å†™è¿‡ä¸€ç¯‡å¦‚ä½•&lt;a href="https://fangpsh.github.io/posts/2022/2022-10-14.html"&gt;é¡ºç€ç½‘çº¿æ‰¾ä¾›åº”å•†&lt;/a&gt;ã€‚è¿™æ¬¡ç½—åˆ—ä¸‹å¸¸è§çš„ï¼Œåœ¨å¢ƒå†…å¯æ¥è§¦åˆ°æœ‰å¢ƒå¤–è®¡ç®—èµ„æºçš„å‚å•†ã€‚&lt;/p&gt;
&lt;p&gt;ç­›é€‰æ ‡å‡†ï¼šæœ‰å¢ƒå¤–è®¡ç®—ã€å¸¦å®½èµ„æºï¼Œå›½å†…ä¸»ä½“æˆ–è€…è‡³å°‘æœ‰å¢ƒå†…ä»£ç†ï¼ˆæ–¹ä¾¿å¤„ç†å‘ç¥¨ã€ä»˜æ¬¾ã€å”®åé—®é¢˜ï¼‰ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é˜¿é‡Œã€è…¾è®¯ã€åä¸ºã€Ucloudã€ç«å±±ã€é‡‘å±±ç­‰ï¼›&lt;ol&gt;
&lt;li&gt;å­˜åœ¨å¢ƒå¤–ä¸»ä½“ï¼šä¾‹å¦‚åä¸ºå›½é™…ï¼Œåä¸ºåœ¨æŸäº›åœ°åŒºæœ‰èµ„æºä¼˜åŠ¿ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ç”µä¿¡ã€ç§»åŠ¨ã€è”é€šï¼›&lt;ol&gt;
&lt;li&gt;å¯è”ç³»å›½é™…å…¬å¸ï¼Œä¾‹å¦‚ç”µä¿¡æœ‰å•ç‹¬çš„ç”µä¿¡å›½é™…ï¼Œå¯æƒœå¾ˆè´µï¼Œæ— æ€§ä»·æ¯”ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;AWSã€GCPã€Azureç­‰ä¸å¤šè¯´ï¼›&lt;/li&gt;
&lt;li&gt;ç™¾åº¦ï¼šç™¾åº¦è¾¹ç¼˜æ‚ç³…äº†å¤šå®¶è®¡ç®—èµ„æºï¼Œä¹ŸåŒ…å«è‡ªå»ºçš„ï¼›&lt;/li&gt;
&lt;li&gt;IBM/Softlayer&lt;/li&gt;
&lt;li&gt;Oracleï¼Œäº‘é‡Œé¢æˆæœ¬ç›¸å¯¹ä¾¿å®œï¼Œçº¯è®¡ç®—æµåª’ä½“æ¨èï¼›&lt;/li&gt;
&lt;li&gt;å±‚å³°/Zenlayerï¼Œå‡ºæµ·ç¬¬ä¸€é€‰æ‹©ï¼›&lt;/li&gt;
&lt;li&gt;ç½‘å®¿è¾¹ç¼˜äº‘ï¼šç½‘å®¿å›½é™… CDN æœºæˆ¿æ”¹é€ è€Œæ¥ï¼Œå¯ç”¨äºè¡¥å……å±‚å³°çš„èŠ‚ç‚¹ï¼Œæœ‰çŠ„è§’æ—®æ—¯èµ„æºï¼Œå¹³å°ç¨³å®šæ€§ä¸€èˆ¬ï¼›&lt;ol&gt;
&lt;li&gt;å¯è”ç³»ç½‘å®¿å›½é™…ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;é è°±äº‘ï¼šå±‚å³°ç«äº‰å¯¹æ‰‹ï¼Œè¿‘äº›å¹´é“ºèŠ‚ç‚¹å¾ˆå¿«ï¼›&lt;ol&gt;
&lt;li&gt;åœ¨å—ç¾å’Œedgeunoåˆä½œï¼Œä¸Šç‚¹éå¸¸å¿«ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;é¦–éƒ½åœ¨çº¿ï¼šæµ·å¤–å¤§åŒºæœ‰èŠ‚ç‚¹ï¼ŒæŠ€æœ¯è½åï¼Œæ€§ä»·æ¯”é«˜ï¼›&lt;/li&gt;
&lt;li&gt;Linodeï¼šè¢«akamai æ”¶è´­åï¼Œå›½å†…æ²¿ç”¨ akamai ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;digitaloceanï¼šå›½å†…ä¹Ÿå¼€å§‹æœ‰ä»£ç†ï¼Œè¾¹ç¼˜äº‘çš„æ›¿ä»£ï¼›&lt;/li&gt;
&lt;li&gt;FDC Serverï¼šå›½é™…å¤§å‚ï¼Œå›½å†…æœ‰ä»£ç†ï¼Œå¾®åšå’Œå¾®ä¿¡å¯ä»¥æ‰¾åˆ°å®˜æ–¹å·ï¼Œä¾¿å®œé‡å¤§ï¼›&lt;/li&gt;
&lt;li&gt;ows.usï¼šå…«çˆªç« é±¼äº‘è®¡ç®—ï¼ˆä¸Šæµ·ï¼‰ï¼Œæ¥è§¦è¿‡ï¼Œæ²¡åˆä½œï¼Œæ–°å…¬å¸ï¼Œèƒ½æåˆ°ä¸€äº›çŠ„è§’æ—®æ—¯å›½å®¶çš„èŠ‚ç‚¹ï¼›&lt;/li&gt;
&lt;li&gt;gcoreï¼šå¥½åƒæœ‰ä»£ç†è®°ä¸æ¸…äº†ï¼Œå¿˜è®°æ˜¯å¢ƒå†…çš„ï¼Œè¿˜æ˜¯åœ¨æ–°åŠ å¡ï¼›&lt;/li&gt;
&lt;li&gt;æœ—æ¡¥ç»´è§†ï¼šé¦™æ¸¯æœºæˆ¿ï¼Œå¯èƒ½æœ‰ä¸€å®šæˆæœ¬ä¼˜åŠ¿ï¼›&lt;/li&gt;
&lt;li&gt;å¥¥é£å›½é™…ï¼šä»·æ ¼å’Œç¨³å®šæ€§è¿˜å¯ä»¥ï¼Œå¹¿å·è¿˜æœ‰ä¸€å † IDC å‚å•†ï¼Œä¾‹å¦‚äº‘ä¸‹æ±‡é‡‘ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;å…¶ä»–ï¼šå¤ªå¹³æ´‹ç”µä¿¡ã€Equinix å…¶å®ä¹Ÿæœ‰è®¡ç®—èµ„æºå–ï¼Œä½†æ˜¯æ¯”è¾ƒå°‘ï¼Œä¸å ä¼˜åŠ¿ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ‰ç½‘å‹éœ€è¦è®¡ç®—èµ„æºï¼Œå¯é‚®ä»¶è”ç³»å¼•èã€‚&lt;/p&gt;</content><category term="2024"></category><category term="IDC"></category><category term="cloud"></category></entry><entry><title>é™æ€åšå®¢æ·»åŠ  Newsletter æœ€ç®€å•çš„æ–¹æ¡ˆ</title><link href="https://fangpsh.github.io/posts/2024/2024-05-12.html" rel="alternate"></link><published>2024-05-12T00:00:00+08:00</published><updated>2024-05-12T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-05-12:/posts/2024/2024-05-12.html</id><summary type="html">&lt;p&gt;æƒ³ç»™åšå®¢åŠ ä¸€ä¸ª newsletterï¼Œè¯»ç½‘å‹22 å¹´çš„æ–‡ç« ï¼š&lt;a href="https://irithys.com/blog-newsletter/"&gt;é™æ€åšå®¢æ·»åŠ  Newsletter çš„å‡ ç§æ¨èæ–¹æ¡ˆ&lt;/a&gt; æåˆ°çš„æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Mailchimp å…è´¹é…é¢æœ‰ç‚¹ä½ï¼Œä¸æƒ³æŠ˜è…¾ï¼ˆè™½ç„¶æ â€¦&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;æƒ³ç»™åšå®¢åŠ ä¸€ä¸ª newsletterï¼Œè¯»ç½‘å‹22 å¹´çš„æ–‡ç« ï¼š&lt;a href="https://irithys.com/blog-newsletter/"&gt;é™æ€åšå®¢æ·»åŠ  Newsletter çš„å‡ ç§æ¨èæ–¹æ¡ˆ&lt;/a&gt; æåˆ°çš„æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Mailchimp å…è´¹é…é¢æœ‰ç‚¹ä½ï¼Œä¸æƒ³æŠ˜è…¾ï¼ˆè™½ç„¶æå¤§å¯èƒ½æˆ‘è§¦ç¢°ä¸åˆ° ğŸ˜‚ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;Tinyletterï¼Œè¢«å…³äº†ï¼›&lt;/li&gt;
&lt;li&gt;Substackï¼Œ ä¸èƒ½è‡ªåŠ¨æ‹‰å– RSSæ›´æ–°ï¼Œæ¯æ¬¡æ‰‹å·¥import ä¹Ÿå¤ªçƒ¦äº†ï¼›&lt;/li&gt;
&lt;li&gt;Revueï¼Œè¢«å…³äº†ï¼›&lt;/li&gt;
&lt;li&gt;Briefcakeï¼Œä½œè€…æåˆ°ä¼šæ’å¹¿å‘Šï¼Œæœ‰ç‚¹çƒ¦ï¼›&lt;/li&gt;
&lt;li&gt;ç«¹ç™½ï¼Œå†…å®¹è‚¯å®šæœ‰å®¡æŸ¥ï¼Œå¤–åŠ ä¸æ”¯æŒæ”¯æŒæ³¨å†Œï¼Œè¦ç”³è¯·ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹æ¥çœ‹å»ï¼Œ 24 å¹´ï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯æ³¨å†Œ &lt;a href="https://hashnode.com/"&gt;hashnode&lt;/a&gt; ä½œä¸ºè·³æ¿ï¼Œå°† RSS è½¬ä¸ºnewsletter ã€‚ ç®¡ç†é¢æ¿ä¸­å…ˆæ‰“å¼€NewsletteråŠŸèƒ½ï¼Œå†&lt;a href="https://support.hashnode.com/en/articles/6701069-import"&gt;å¯¼å…¥RSSï¼šImport-&amp;gt;RSS Importer&lt;/a&gt;ï¼Œè®°å¾—å‹¾ä¸Šï¼š&lt;code&gt;Import automatically: Allow my future posts to be parsed and imported automatically&lt;/code&gt;ã€‚ æ•ˆæœè§ï¼š&lt;a href="https://fangpsh.eu.org/newsletter"&gt;newsletter&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;2ä¸ªç¼ºæ†¾ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ²¡æœ‰å¤–æŒ‚ç»„ä»¶ï¼ŒåµŒå…¥åˆ°åŸåšå®¢ï¼Œè¯»è€…éœ€è¦ç‚¹å‡»è½¬åˆ° hashnodeï¼›&lt;/li&gt;
&lt;li&gt;Newsletter é¡µé¢æ²¡çœ‹åˆ°å¯¼å‡ºåŠŸèƒ½ï¼Œå¥½åƒ&lt;a href="https://townhall.hashnode.com/hashnode-newsletter-feature-for-busy-developers"&gt;æœ‰è®¡åˆ’&lt;/a&gt;ï¼Œä¸è¿‡21 å¹´è§„åˆ’ 24 å¹´è¿˜æ²¡å®ç° ğŸ¶ï¼›&lt;/li&gt;
&lt;/ol&gt;</content><category term="2024"></category><category term="blog"></category><category term="newsletter"></category></entry><entry><title>saltsatck åŠ¨æ€slsç»„ç»‡æ–¹å¼</title><link href="https://fangpsh.github.io/posts/2024/2024-05-11.html" rel="alternate"></link><published>2024-05-11T00:00:00+08:00</published><updated>2024-05-11T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-05-11:/posts/2024/2024-05-11.html</id><summary type="html">&lt;p&gt;å‡è®¾åœ¨ CMDB ä¸­ï¼Œæœ‰ç±»ä¼¼å¦‚ä¸‹çš„æ ‘çŠ¶ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;- ä¸­å¿ƒ/center
    - å¹³å°/platform
        - æœåŠ¡/service
                - é›†ç¾¤/cluster
                    - æœåŠ¡å™¨
- CDN ä¸­å¿ƒ
    - é™æ€åˆ†å‘å¹³å°
        - è¾¹ç¼˜è°ƒåº¦æœåŠ¡
                - é›†ç¾¤ A
                    - server101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å‡è®¾åœ¨ CMDB ä¸­ï¼Œæœ‰ç±»ä¼¼å¦‚ä¸‹çš„æ ‘çŠ¶ç»“æ„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;- ä¸­å¿ƒ/center
    - å¹³å°/platform
        - æœåŠ¡/service
                - é›†ç¾¤/cluster
                    - æœåŠ¡å™¨
- CDN ä¸­å¿ƒ
    - é™æ€åˆ†å‘å¹³å°
        - è¾¹ç¼˜è°ƒåº¦æœåŠ¡
                - é›†ç¾¤ A
                    - server101
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥ä½¿ç”¨&lt;a href="https://docs.saltproject.io/en/latest/ref/file_server/all/salt.fileserver.gitfs.html"&gt;gitfs&lt;/a&gt; å°† sls æ–‡ä»¶éƒ½æ‰˜ç®¡åœ¨å†…éƒ¨ä»“åº“ä¸­ï¼Œè¿›è¡Œè·¨éƒ¨é—¨åä½œï¼Œå…±åŒç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;å½“ salt-minion state.highstate åº”ç”¨æ—¶ï¼Œå¯ä»¥æŒ‰ç…§å½“å‰æœºå™¨åœ¨ CMDB ä¸­æ‰€å±çš„å±‚æ¬¡/è§’è‰²ï¼Œè¿›è¡Œ åŠ¨æ€åº”ç”¨ slsã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ä¸Šæ–‡ä¸­çš„ server101ï¼Œå…ˆåº”ç”¨CDN ä¸­å¿ƒä¸‹çš„ slsï¼Œå†åº”ç”¨é™æ€åˆ†å‘å¹³å°ä¸‹çš„ slsï¼Œä¸€å±‚ä¸€å±‚å¾€ä¸‹ï¼ˆå¯ä»¥æŒ‰éœ€åŠ æ›´å¤šçš„å±‚çº§ï¼Œä¾‹å¦‚ é›†ç¾¤å±‚çº§ä¸‹å†åŠ è§’è‰²ç­‰ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¦åšåˆ°è¿™ä¸ªæ•ˆæœï¼Œé¦–å…ˆCMDB éœ€è¦èƒ½è¾“å‡ºæœºå™¨çš„åŠ¨æ€ pillarï¼Œåœ¨ salt-master é…ç½®å¥½&lt;a href="https://docs.saltproject.io/en/latest/ref/configuration/master.html#ext-pillar"&gt;ext_pillar&lt;/a&gt; ï¼Œå¯ä»¥æŒ‡å®šshell è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ext_pillar:
  - cmd_json: /path/get_cmdb_pillar.sh %s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœºå™¨çš„ pillar è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
  &amp;quot;center&amp;quot;: [
  cdn,
  ...
  ],
  &amp;quot;platform&amp;quot;: [
  &amp;quot;cdn/static_cdn&amp;quot;,
  ...
  ],
  &amp;quot;service&amp;quot;: [
  &amp;quot;cdn/static_cdn/dispatch&amp;quot;
  ],
  &amp;quot;cluster&amp;quot;: [
  &amp;quot;cdn/static_cdn/dispatch/mainland&amp;quot;
  ],
  ....
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¨å±€çš„ &lt;a href="https://docs.saltproject.io/en/latest/ref/states/top.html"&gt;top.sls&lt;/a&gt; æŒ‰ç…§å¦‚ä¸‹å†™æ³•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;base:
  &amp;#39;*&amp;#39;:
    - base
  {% set center_list = salt.pillar.get(&amp;#39;center&amp;#39;, [])-%}
  {% if center_list -%}
  {% for c in center_list -%}
  {% if salt[&amp;#39;state.sls_exists&amp;#39;](&amp;#39;{0}.base&amp;#39;.format(c)) %}
  &amp;#39;center:{{ c }}&amp;#39;:
    - match: pillar
    - {{ c }}.base
  {% endif -%}
  {% endfor -%}
  {% endif -%}

  {% set platform_list = salt.pillar.get(&amp;#39;platform&amp;#39;, [])-%}
  {% if platform_list -%}
  {% for p in platform_list -%}
  {% if salt[&amp;#39;state.sls_exists&amp;#39;](&amp;#39;{0}.base&amp;#39;.format(p)) %}
  &amp;#39;platform:{{ p }}&amp;#39;:
    - match: pillar
    - {{ p }}.base
  {% endif -%}
  {% endfor -%}
  {% endif -%}

   ..... 

  {% endif -%}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“ç„¶ï¼ŒæŒ‰å¦‚ä¸Šå†™æ³•ï¼Œè¦å¯¹ sls ä»“åº“ç›®å½•è¿›è¡Œä¸€äº›çº¦å®šï¼ŒæŒ‰æ¯ä¸€ä¸ªå±‚çº§ç»„ç»‡æ”¾ç½® slsï¼Œbase ç›®å½•æ”¾æ¯ä¸€å±‚çš„å…¬å…±åŸºç¡€ sls ã€‚å…¬å…±å¤ç”¨çš„ sls æŠ½è±¡å‡ºæ¥ï¼Œä¾‹å¦‚æ”¾åœ¨ addon/ ä¹‹ç±»çš„ç›®å½•ä¸­ã€‚åˆ¶å®šåä½œå…¬çº¦ï¼Œåœ¨ä»“åº“ pr æµç¨‹ä¸­code reviewã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.
â”œâ”€â”€ addon                   addon slsï¼Œä¾›å…¶ä»–sls includeï¼Œåˆ†ç›®å½•ç»„ç»‡
â”‚   â”œâ”€â”€ x1
â”‚   â””â”€â”€ x2
â”œâ”€â”€ base                    å…¨å±€åŸºç¡€åˆå§‹åŒ–sls
â”‚   â”œâ”€â”€ init.sls
â”‚   â”œâ”€â”€ c1.sls
â”‚   â””â”€â”€ ...
â”œâ”€â”€ cdn                    CDN ä¸­å¿ƒ
â”‚   â”œâ”€â”€ base               CDN ä¸­å¿ƒçš„å…¨å±€åˆå§‹åŒ–/åŸºç¡€sls
â”‚   â”‚   â””â”€â”€ init.sls
â”‚   â””â”€â”€ static_cdn         é™æ€ CDN å¹³å°
â”‚       â”œâ”€â”€ base           å¹³å°çš„å…¨å±€åˆå§‹åŒ–/åŸºç¡€sl s
â”‚       â””â”€â”€ dispatch       è°ƒåº¦æœåŠ¡
|          â”œâ”€â”€ base        è°ƒåº¦æœåŠ¡çš„sls
|          â”‚   â””â”€â”€ init.sls
|          â””â”€â”€ mainland     å¤§é™†é›†ç¾¤
|              |            å¤§é™†é›†ç¾¤ä¸‹çš„sls
|              â””â”€â”€ init.sls
|

â””â”€â”€ top.sls                å…¨å±€è·¯ç”±æ–‡ä»¶
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ€åè¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼Œå½“è¿ç»´äººå‘˜ç»™ç‰¹å®šé›†ç¾¤ï¼Œæˆ–ç‰¹å®šæœåŠ¡çš„æœºå™¨å®‰è£…æŸäº›è½¯ä»¶åŒ…ï¼Œæˆ–è€…æ¸²æŸ“ç”Ÿæˆé…ç½®ç­‰ï¼Œå†™å¥½ sls æ”¾åœ¨çº¦å®šå¥½çš„ç›®å½•ï¼Œå°±èƒ½è‡ªåŠ¨å…³è”ä¸Šï¼Œéå¸¸ç®€å•ã€‚&lt;/p&gt;</content><category term="2024"></category><category term="saltstack"></category></entry><entry><title>å°å‹IDCè™šæ‹ŸåŒ–cloudpodsä½“éªŒä¸ç•…æƒ³</title><link href="https://fangpsh.github.io/posts/2024/2024-05-10.html" rel="alternate"></link><published>2024-05-10T00:00:00+08:00</published><updated>2024-05-10T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-05-10:/posts/2024/2024-05-10.html</id><summary type="html">&lt;p&gt;åŠå…¬æœºæˆ¿ï¼Œç”±äºå»ºè®¾æ—¶é—´ä¸åŒï¼Œå­˜åœ¨å¥½å‡ å¥—ä¸åŒçš„ PVEï¼ˆProxmox VEï¼‰ï¼ŒPVE ç®€å•ï¼Œä¼˜é›…ï¼Œç¨³å®šï¼Œå®åœ¨æ˜¯å°å‹è™šæ‹ŸåŒ–ä¸Šä¸Šä¹‹é€‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬æœ‰å‡ ä¸ªéœ€ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åŠå…¬æœºæˆ¿ï¼Œç”±äºå»ºè®¾æ—¶é—´ä¸åŒï¼Œå­˜åœ¨å¥½å‡ å¥—ä¸åŒçš„ PVEï¼ˆProxmox VEï¼‰ï¼ŒPVE ç®€å•ï¼Œä¼˜é›…ï¼Œç¨³å®šï¼Œå®åœ¨æ˜¯å°å‹è™šæ‹ŸåŒ–ä¸Šä¸Šä¹‹é€‰ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘ä»¬æœ‰å‡ ä¸ªéœ€æ±‚ï¼Œæ²¡æ³•è¢«å¾ˆå¥½çš„æ»¡è¶³ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·¨ PVE é›†ç¾¤çš„ä¸»æœºæŸ¥è¯¢ï¼ˆå½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª CMDB/DCIMï¼Œä½†æ˜¯é‚£ä¼šè¿˜æ²¡æœ‰ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿå¼€æœºï¼ŒPVE åˆ›å»ºä¸»æœºè¿˜æ˜¯å¤ªæ…¢ï¼ˆå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ æ‰‹æ“ APIï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;é›†æˆå¿…è¦çš„ç›‘æ§ï¼ˆå½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå»ºä¸€å¥—ç›‘æ§ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¿™å¥—è™šæ‹ŸåŒ–ä¸å¤Ÿç¨³å®šï¼Œéƒ¨åˆ†æœºå™¨æˆ‘ä»¬å¸Œæœ›ä¿ç•™ PVEï¼Œå³è¿™å¥—è™šæ‹ŸåŒ–ç³»ç»Ÿèƒ½å¤Ÿæ¥ç®¡ PVEï¼›&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿæ¥ç®¡å¼‚åœ°åŠå…¬å®¤çš„PVEï¼›&lt;/li&gt;
&lt;li&gt;æ¥ç®¡ç‰©ç†æœºï¼ˆè£¸é‡‘å±ï¼‰ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸€äº›æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç»§ç»­PVEï¼Œå¯¹æ¥ APIï¼Œå†™ä¸ªç®€å•çš„æ§åˆ¶å°ï¼›&lt;/li&gt;
&lt;li&gt;é˜¿é‡Œè…¾è®¯ç§æœ‰åŒ–éƒ¨ç½²ï¼Œé—®è¯¢ä¸‹äº†ä»·æ ¼ï¼Œå¤ªè´µäº†ï¼Œå› ä¸ºæˆ‘ä»¬æœºæˆ¿å°±æ˜¯ä¸€å †æ—§ï¼ˆåƒåœ¾ï¼‰ä¸»æœºã€‚&lt;/li&gt;
&lt;li&gt;é˜¿é‡Œï¼Œè…¾è®¯ç±»ä¼¼ aws outposts çš„æ–¹æ¡ˆï¼Œå¾ˆç¾å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯æƒ³ä¹°äºŒæ‰‹ä¸»æœºï¼Œå­˜é‡æœºå™¨ä¹Ÿæ²¡æ³•å¤„ç†ï¼›&lt;/li&gt;
&lt;li&gt;openstack å¤ªå¤æ‚äº†ï¼›&lt;/li&gt;
&lt;li&gt;zstack å…è´¹ç‰ˆå¤ªé¸¡è‚‹ï¼›&lt;/li&gt;
&lt;li&gt;é£è‡´äº‘ CloudExplorer å¤šäº‘ç®¡ç†å¹³å°ï¼Œæ²¡æœ‰ç§æœ‰äº‘åŠŸèƒ½ï¼›&lt;/li&gt;
&lt;li&gt;oVirtï¼Œçœ‹èµ·æ¥ä¸é”™ï¼Œä½†æ˜¯å·²æ­»ï¼Œ&lt;a href="https://www.reddit.com/r/ovirt/comments/z4abr6/about_ovirts_future/"&gt;About oVirtâ€™s future&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;li&gt;xcp-ngï¼Œçœ‹èµ·æ¥ä¸é”™ï¼ŒæŒºæ´»è·ƒï¼›&lt;/li&gt;
&lt;li&gt;opennebulaï¼Œçœ‹èµ·æ¥ä¸é”™ï¼Œè€Œä¸”æŒºæ´»è·ƒï¼Œä½†æ˜¯ä½“éªŒäº†ä¸‹ï¼Œæœ‰äº›æ¦‚å¿µå¤ªå¥‡æ€ªäº†ï¼ˆæ„Ÿè§‰åƒæ˜¯ä» openstack æ—¶ä»£é—ç•™ä¸‹æ¥çš„ï¼‰ï¼Œè€Œä¸”å†…éƒ¨ä½¿ç”¨ï¼Œé¡µé¢éœ€è¦äºŒæ¬¡å¼€å‘ï¼›&lt;/li&gt;
&lt;li&gt;cloudpodsï¼Œçœ‹èµ·æ¥ä¸é”™ï¼Œall-in-oneï¼Œå¼€ç®±å³ç”¨ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€äº›å¼€æº KVM é¢æ¿ï¼Œæˆ–è€…åŸºäºlibkvmè‡ªå·±å¼€å‘ï¼Œä½†æ˜¯è¿™æ ·ä¸å¦‚é€‰æ‹©æ–¹æ¡ˆ 1ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç»¼åˆä¸‹æ¥ï¼Œå¤‡é€‰æ–¹æ¡ˆæ˜¯ 1ï¼Œ8ï¼Œ9ï¼Œ10ã€‚æœ€ç»ˆï¼ŒåŸºäºæ€§ä»·æ¯”ï¼ˆæ‡’ï¼‰ã€é€Ÿåº¦ï¼ˆKPIï¼‰ï¼Œé€‰æ‹©äº† cloudpodsã€‚&lt;/p&gt;
&lt;p&gt;è¯´ä¸‹ä½“éªŒï¼Œ
ç›®å‰å¤§æ¦‚è·‘äº†æ¥è¿‘1å¹´å·¦å³ï¼Œè™šæ‹Ÿæœºæ¥è¿‘ 200 å°ï¼Œå®¿ä¸»æœº20 å°ï¼Œä¼šé‡åˆ°ä¸€äº›å°æ¯›ç—…ï¼Œæ•´ä½“è¿˜ç®—ç¨³å®šã€‚å° bug å…¶å®ä¸å°‘ï¼Œå¦å¤–ä½¿ç”¨ç»éªŒå’Œç¤¾åŒºèµ„æ–™ PVE éƒ½æ›´å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹ç¨³å®šæ€§æ¯”è¾ƒé«˜çš„ä¸€å¥—è™šæ‹ŸåŒ–ï¼Œ è¿˜æ˜¯ç”¨äº† PVE 7ï¼Œå¥½å¤„æ˜¯ cloudpods å¯ä»¥ç»Ÿä¸€æ¥ç®¡ï¼Œéå¸¸èµã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹å¼€å‘æ´»è·ƒï¼ŒåŸºæœ¬ä¸€ä¸ªæœˆ release ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿„ä»Šä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¹Ÿä¸€ç›´ä¿æŒåœ¨è¿½ï¼Œå‡çº§ä¸æ»‘ï¼Œå½“ç„¶ä¼šé‡åˆ°å¼•å…¥çš„å‡ ä¸ªå° bugã€‚&lt;/p&gt;
&lt;p&gt;é«˜å¯ç”¨ç‰ˆæœ¬éƒ¨ç½²éœ€è¦å¼•å…¥ MySQL ä¸»ä¸»ç»“æ„ï¼Œä½†æ˜¯ç§æœ‰åŒ–åœºæ™¯ï¼ŒæŠŠMySQL ä¸»ä¸»è¿ç»´å¥½ï¼Œæœºå™¨åº•åº§ä¸ä»…è¦å¯é ï¼Œä½œä¸ºé DBA çš„è¿ç»´ï¼Œæˆ‘è¿˜æ˜¯æœ‰ç‚¹çŠ¯æ€µï¼Œä¸è¿‡å¥½æ­¹ç¨³å®šå¥½äº†ä¸€å¹´ã€‚æˆ‘åœ¨æƒ³ï¼Œç›´æ¥ç”¨&lt;a href="https://pigsty.cc/"&gt;pigsty&lt;/a&gt; æ‹‰èµ·ä¸€ä¸ªé›†ç¾¤æ˜¯ä¸æ˜¯æ›´ç®€å•å¯é ï¼Œæˆ–è€…æœ‰æ²¡æœ‰å…¶ä»– mysql é›†ç¾¤åŒ–æ–¹æ¡ˆï¼Œæš‚æ—¶æ²¡è°ƒç ”ã€‚opennebula çš„&lt;a href="https://docs.opennebula.io/6.6/installation_and_configuration/ha/frontend_ha.html"&gt;é«˜å¯ç”¨&lt;/a&gt;åŸºäº raftè‡ªå·±åšäº†äº‹åŠ¡åŒæ­¥ï¼Œæ„Ÿè§‰ç›¸æ¯” cloudpodsè®©ç”¨æˆ·è‡ªå»ºmariadb ä¸»ä¸»ï¼Œå¿ƒæ™ºè´Ÿæ‹…æ›´ä½ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨é«˜å¯ç”¨æ–¹æ¡ˆçš„ keepalived ç›¸æ¯”kubesphere çš„æ–¹æ¡ˆå·®ä¸€ç‚¹ï¼Œæè¿‡ä¸€ä¸ª &lt;a href="https://github.com/yunionio/cloudpods/issues/17570"&gt;issue&lt;/a&gt;ï¼Œä¸è¿‡æ”¹é€ å·¥ä½œé‡æ¯”è¾ƒå¤§ï¼Œè¿˜æœªæœ‰è¿›åº¦ã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹æ–‡æ¡£è¿˜ç®—ä¸°å¯Œï¼Œè¦æ‰¾çš„æŒ‡å—åŸºæœ¬éƒ½æœ‰ï¼Œä½†æ˜¯å¶å°”ä¼šç¼ºå°‘ä¸€äº›ç»†èŠ‚ï¼Œè¿˜æ˜¯å»ºè®®æœ‰ä¸€å®šçš„è¿ç»´ç»éªŒçš„åŒå­¦æ¥é©¾é©­ï¼Œä¸ç„¶å¯èƒ½ä¼šæœ‰ä¸€äº›åƒåŠ›ã€‚ä¸ä»…éœ€è¦äº†è§£ cloudpods åŸºç¡€ç»„ä»¶ï¼Œè¿˜éœ€è¦æœ‰åº•åº§ k8s çš„è¿ç»´æ’é”™èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå®šä¹‰ç›‘æ§ï¼Œä¸å¤ªå®¹æ˜“ï¼Œèµ·ç æ²¡æ³•åœ¨ cloudpods çš„  WebUI å†… å®Œæˆï¼Œèƒ½è‡ªå·±ç”¨ grafana æ¥ cloudpods çš„vmã€‚åŠ æŒ‡æ ‡ï¼Œéœ€è¦ä¿®æ”¹ telegrafã€‚ä¸ºäº†åç»­å‡çº§çš„å¹³æ»‘ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¾µå…¥æ€§çš„æ”¹ã€‚ä¸è¿‡ï¼Œå®˜æ–¹çš„åŸºç¡€æŒ‡æ ‡ï¼Œå¤§éƒ¨åˆ†åœºæ™¯éƒ½æ˜¯å¤Ÿç”¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªå¼€æºï¼ˆå…è´¹ï¼‰çš„æ–¹æ¡ˆï¼Œè™½ç„¶ç¤¾åŒºèµ„æ–™ï¼ˆç»éªŒï¼‰ä¸åƒ PVE é‚£ä¹ˆä¸°å¯Œï¼Œä½†æ˜¯å®˜æ–¹æ”¯æŒï¼ˆissue é—®ç­”ï¼‰è¿˜ç®—åŠæ—¶ï¼Œç€æ€¥çš„è¯åŠ å¾®ä¿¡ç¾¤å‚¬ issueï¼Œå“åº”ä¹ŸæŒºå¿«çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»å®˜æ–¹ä»“åº“çœ‹ï¼Œè´¡çŒ®è€…å¤§éƒ¨åˆ†æ˜¯å…¬å¸å‘˜å·¥ï¼Œç¤¾åŒºçš„çƒ­åº¦å’ŒåŠ›é‡è¿˜ä¸å¤ªå¼ºï¼Œä½†æ˜¯å›¢é˜Ÿèƒ½åŠ›éå¸¸å¼ºï¼ˆåŸç¾å›¢äº‘å›¢é˜Ÿï¼‰ï¼Œä»£ç ä¼˜é›…ï¼ŒåŠŸåŠ›æ·±åšï¼Œç»éªŒä¸°å¯Œï¼Œéå¸¸å¸Œæœ›å…¬å¸è¥æ”¶èƒ½è·‘çš„è¶Šæ¥è¶Šå¥½ï¼Œå¸¦åŠ¨cloudpods èµ°çš„æ›´è¿œã€‚ä½†æˆ‘ä¸ªäººä»ä¸€äº›è¿¹è±¡çœ‹ï¼Œå›¢é˜Ÿä¼¼ä¹è¿˜æŒºè¾›è‹¦çš„ã€‚å›¢é˜Ÿä¼¼ä¹ä¹Ÿæ˜¯ä»å¤šäº‘ç®¡ç†ï¼Œè½¬å‘æŠ•å…¥åˆ°ç§æœ‰äº‘ã€‚&lt;/p&gt;
&lt;p&gt;å¤šäº‘ç®¡ç†ï¼ˆCMPï¼‰çš„å¸‚åœºå…¶å®å·²éå¸¸ç«çƒ­ï¼Œåœ¨ onecloud ä¹‹å‰å°±å·²ç»æœ‰ä¸€äº›å…¬å¸è·‘äº†ä¸€æ®µæ—¶é—´ï¼Œ ä¾‹å¦‚ZStack è‡ªå·±ä¹Ÿåšï¼Œå¤§ä¸€ç‚¹çš„å…¬å¸è‡ªå·±å†…éƒ¨ç›´æ¥å»ºè®¾ï¼Œçœ‹çœ‹ B ç«™çš„&lt;a href="https://mp.weixin.qq.com/s/qsAve3D8RBW46Htzked0NA"&gt;Bç«™å¤šäº‘ç®¡ç†å¹³å°å»ºè®¾
&lt;/a&gt;ï¼Œå¯çŸ¥è¿™ä¸ªæŠ•å…¥è¦å¤šå¤§ï¼Œä»¥åŠå’Œå†…éƒ¨ä¸šåŠ¡å»ºè®¾å‘å±•ç»‘å®šçš„éå¸¸æ·±ã€‚
å¤šäº‘ç®¡ç†å¤§æ¦‚ç‡åªèƒ½åƒåˆ°è…°éƒ¨ä»¥ä¸‹çš„å°å®¢æˆ·ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å®¢æˆ·æœ¬èº«ä¸šåŠ¡å‘å±•è¿˜æ²¡åˆ°æˆç†ŸæœŸï¼Œå¯¹å¤šäº‘éƒ¨ç½²çš„éœ€æ±‚åˆæœ‰å¤šå°‘å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç±»ä¼¼ zstack è¿™æ ·ä»è™šæ‹ŸåŒ–å æœ‰ç‡ï¼Œä¸Šäº‘ï¼Œåƒåˆ°å¤šäº‘ç®¡ç†ï¼Œè¿™æ¡è·¯å¾„æ˜¯é€šçš„ï¼›ç”šè‡³å…¬æœ‰äº‘å‚å•†ï¼ˆé˜¿é‡Œï¼Œè…¾è®¯ï¼‰è‡ªå·±ä¸‹åœºåšå¤šäº‘ç®¡ç†ï¼Œä¹Ÿæ˜¯é€šçš„ã€‚ä½†æ˜¯ä»å¤´å¼€å§‹åªåšå¤šäº‘ç®¡ç†ï¼Œè¥æ”¶æ¨å¹¿æœ‰äº›å›°éš¾ã€‚&lt;/p&gt;
&lt;p&gt;ä»å®˜æ–¹ç¤¾åŒº&lt;a href="https://github.com/yunionio/cloudpods/issues/11427"&gt;ç»Ÿè®¡çš„ç”¨æˆ·&lt;/a&gt;ï¼Œä¸ç¼ºä¸€äº›å¤§ä¼ä¸šï¼Œåœºæ™¯å¤§éƒ½ç§æœ‰äº‘ï¼Œæˆ‘çŒœæƒ³å¤§éƒ¨åˆ†éƒ½æ˜¯å†…éƒ¨æµ‹è¯•ï¼ˆéä¸¥è‚ƒï¼‰åœºæ™¯ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒè™šæ‹ŸåŒ–ï¼Œè¯´å®è¯ä¸Š cloudpods æˆ‘æ˜¯æ²¡ä¿¡å¿ƒçš„ï¼Œé™¤éä¹°å®˜æ–¹æœåŠ¡ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™é˜¿é‡Œè…¾è®¯ vmwareã€zstackç­‰çš„æ–¹æ¡ˆä¸€å®šä¼šè¢«æ‹‰åˆ°ä¸€ä¸ªå¹³é¢ PKï¼Œæˆç†Ÿå’Œç¨³å®šæ€§åæ°”ç­‰ï¼Œcloudpods å¯èƒ½æ— æ³•å ä¼˜é€šè¿‡è¯„å®¡ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œä¹‹å‰åœ¨ç¾¤å†…å’Œå®˜æ–¹è®¨è®ºè¿‡ï¼Œå»ºè®®ä»–ä»¬åšå¤šäº‘çš„åˆè§„åŸºçº¿æ‰«æã€‚ç±»ä¼¼selefraï¼Œ Cloud Custodianï¼Œé£è‡´çš„cloudexplorer-liteã€‚å…¬å¸åˆ°ä¸€å®šé˜¶æ®µï¼Œåˆè§„æ˜¯å¼ºéœ€æ±‚ï¼Œä½†æ˜¯å‰æœŸå»ºè®¾èµ·æ¥çš„ CMDB ä¸ä¸€å®šèƒ½å¤Ÿå“åº”ç¬¦åˆåˆè§„éœ€æ±‚ã€‚å¤šäº‘åˆè§„ï¼Œæˆæƒå¡æ¥å…¥æ‰«æçš„å®ä¾‹æ•°ã€è§„åˆ™æ•°ã€è‡ªå®šä¹‰è§„åˆ™åŠŸèƒ½ç­‰ï¼Œéƒ½æ˜¯éå¸¸å¥½çš„å¡ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬å…¬å¸å®‰å…¨åˆè§„å›¢é˜Ÿçš„å¹³å°å»ºè®¾ç¼–ç èƒ½åŠ›ä¼šåå¼±ä¸€ç‚¹ï¼Œè·¨å¤šäº‘ã€è‡ªå®šä¹‰è§„åˆ™çš„åˆè§„æ£€æŸ¥ï¼Œæ˜¯å¤§æ¦‚ç‡ä¼šé‡åˆ°çš„éœ€æ±‚ã€‚æˆ‘ä»¬å°ç»„åŒå­¦æœ€è¿‘å°±åšäº†ä¸€ä¸ªå¤šäº‘çš„åˆè§„å·¡æ£€ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”è¿™ç§ç³»ç»Ÿæ˜¯æ—è·¯å·¡æ£€ç³»ç»Ÿï¼Œå¯¹å·²æœ‰ç³»ç»Ÿçš„å…¥ä¾µæ¯”è¾ƒå°ï¼Œå»ºè®¾ä¸Šçº¿æˆæœ¬é˜»åŠ›ä¹Ÿä¼šå°å¾ˆå¤šã€‚å®˜æ–¹ä¹Ÿä¸€ç›´åœ¨æ¨å¹¿ cloudpods å•†ä¸šç‰ˆè´¦å•åˆå¹¶åˆ†æçš„èƒ½åŠ›ï¼Œå…¶å®ä¸åˆè§„ä¹Ÿéå¸¸åƒï¼Œéƒ½æ˜¯åˆ°ä¸€å®šé˜¶æ®µéœ€è¦æ²»ç†çš„é—®é¢˜ã€‚å¥½å¤„æ˜¯ï¼Œéœ€è¦åˆè§„çš„å…¬å¸è‡³å°‘ä¸æ˜¯å°é±¼äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼Œcloudpods æ»¡è¶³äº†æˆ‘ä»¬IT ç°å½“ä¸‹çš„å¤§éƒ¨åˆ†éœ€æ±‚ï¼ŒæŒºå¥½çš„ï¼Œä½†æ˜¯ä¸¥è‚ƒç¯å¢ƒéœ€è°¨æ…ï¼ˆå»ºè®®è´­ä¹°å®˜æ–¹ä¼ä¸šæœåŠ¡ï¼‰ã€‚&lt;/p&gt;</content><category term="2024"></category><category term="cloudpods"></category></entry><entry><title>ä¸»æœºæ‰ç”µ lvm å¼‚å¸¸å¤„ç†</title><link href="https://fangpsh.github.io/posts/2024/2024-05-09.html" rel="alternate"></link><published>2024-05-09T00:00:00+08:00</published><updated>2024-05-09T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-05-09:/posts/2024/2024-05-09.html</id><summary type="html">&lt;p&gt;äº”ä¸€æœŸé—´ï¼Œç”µåŠ›ç»´æŠ¤ï¼Œæœºæˆ¿UPS å¼‚å¸¸ï¼Œå¯¼è‡´ä¸€æ‰¹æœåŠ¡å™¨æ‰ç”µã€‚é€ç”µåï¼Œå…¶ä»–æœºå™¨åŸºæœ¬éƒ½èƒ½æ­£å¸¸ç»´æŠ¤ï¼Œå°± 2 å° DELL R420 å¼‚å¸¸ï¼Œæ•´åˆ—å¡æ˜¯&lt;code&gt;PERC H310 â€¦&lt;/code&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;äº”ä¸€æœŸé—´ï¼Œç”µåŠ›ç»´æŠ¤ï¼Œæœºæˆ¿UPS å¼‚å¸¸ï¼Œå¯¼è‡´ä¸€æ‰¹æœåŠ¡å™¨æ‰ç”µã€‚é€ç”µåï¼Œå…¶ä»–æœºå™¨åŸºæœ¬éƒ½èƒ½æ­£å¸¸ç»´æŠ¤ï¼Œå°± 2 å° DELL R420 å¼‚å¸¸ï¼Œæ•´åˆ—å¡æ˜¯&lt;code&gt;PERC H310 Mini&lt;/code&gt;ï¼Œä¸å¸¦ BBUï¼ˆç”µæ± ï¼‰ï¼Œå…¶ä»–æ‰ç”µçš„æœºå™¨ä¹Ÿéƒ½æ˜¯ RAID5+lvmcacheï¼ˆJBODï¼‰ï¼Œä½†æ˜¯åªæœ‰è¿™ 2 å° R420 å‡ºé—®é¢˜ï¼Œéš¾é“æ˜¯å› ä¸ºå…¶ä»–çš„ BBU è®©å†™å…¥æ•°æ®æ­£å¸¸è½ç›˜äº†ï¼Œæ‰€ä»¥æ²¡å¼‚å¸¸ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯ä¸å»ºè®®åœ¨ä¸å¸¦ BBU çš„æ•´åˆ—ä¸Šå¼€å¯ lvmcache äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¯´è¯´æ€ä¹ˆæ¢å¤ï¼Œå’Œä¹‹å‰çš„&lt;a href="https://fangpsh.github.io/posts/2023/2023-09-26.html"&gt;ssd æ•…éšœæ‰ç›˜æ¢å¤&lt;/a&gt;ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ä¹‹åï¼Œç›´æ¥æŠ¥é”™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dracut-initqueue timeout - starting timeout scripts
....
Warning: /dev/mapper/centos-root does not exist
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨&lt;code&gt;dracutï¼š/#&lt;/code&gt; ä¸‹è¯†åˆ«ä¸åˆ° lvmï¼Œ&lt;code&gt;/dev/mapper&lt;/code&gt; çœ‹ä¸åˆ°ä»»ä½•ä¿¡æ¯ï¼Œåƒæ˜¯åˆ†åŒºå¼‚å¸¸ï¼Œä½†æ˜¯æ•°æ®ç›˜å¤§æ¦‚ç‡æ²¡æŸåã€‚äºæ˜¯å°è¯•æ’U ç›˜ç”¨ livecd è¿›å…¥ï¼ŒçœŸä¸è¡ŒæŒ‰ç…§&lt;a href="https://zhuanlan.zhihu.com/p/620846286"&gt;lvmåˆ†åŒºä¿¡æ¯ä¸¢äº†è¿˜èƒ½è¿™æ ·æ¢å¤ï¼Ÿ
&lt;/a&gt; æ‰‹å·¥ç»´æŠ¤ã€‚&lt;/p&gt;
&lt;p&gt;xfs çš„å»ºè®®ç”¨ centos çš„ livecdï¼Œ ä¸€å¼€å§‹ç”¨äº†ubuntu ï¼Œå‘ç°ä¸å¸¦ xfs_repairã€‚&lt;/p&gt;
&lt;p&gt;è¿›å…¥ä¹‹åï¼Œlvm èƒ½æ­£å¸¸è¯†åˆ«åˆ°ï¼Œç§»é™¤ cacheï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;lvconvert --uncache centos/root
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å›åˆ·æ•°æ®ç”¨äº†æŒºä¹…æ—¶é—´ï¼Œç»“æŸä¹‹å&lt;code&gt;xfs_repair&lt;/code&gt;ä¸€ä¸‹ï¼Œæ²¡å¼‚å¸¸ï¼Œå¯ä»¥å°è¯•å¯åŠ¨äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡å¯åŠ¨åˆæŠ¥é”™ï¼š&lt;code&gt;DMAR: DRHD: hangling fault status req xxx...PTE Read access is not set&lt;/code&gt;ï¼Œæ²¡å¤´ç»ªï¼Œgoogle äº†ä¸‹ï¼Œåœ¨grub é¡µé¢æŒ‰&lt;code&gt;e&lt;/code&gt; ç¼–è¾‘&lt;code&gt;intel_iommu=off&lt;/code&gt;ï¼Œ  okäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ä¹‹åï¼Œåˆä¸å¾—ä¸æŠŠ&lt;code&gt;lvmcache&lt;/code&gt;åŠ ä¸Šäº†ï¼Œè°è®©è¿™ğŸŒ¶ï¸ğŸ” å¡è¿ç¼“å­˜éƒ½æ²¡æœ‰ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;åç»­ï¼šç¬¬äºŒä¸ªå¯åŠ¨æŠ¥é”™é—®é¢˜ï¼Œ&lt;a href="https://github.com/yunionio/cloudpods/issues/20242"&gt;[BUG] DELL R420 å¼€å¯iommuå¯åŠ¨å¼‚å¸¸ #20242
&lt;/a&gt;ï¼Œå‚è€ƒ&lt;a href="https://access.redhat.com/solutions/183373"&gt;redhat/183373&lt;/a&gt; ç¡®å®šæ˜¯&lt;code&gt;LSI MegaRAID SAS 2008&lt;/code&gt;çš„é—®é¢˜ã€‚&lt;/p&gt;</content><category term="2024"></category><category term="lvm"></category></entry><entry><title>æ³¨æ„DNS æ‚¬æŒ‚è®°å½•é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2024/2024-03-30.html" rel="alternate"></link><published>2024-03-30T00:00:00+08:00</published><updated>2024-03-30T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-03-30:/posts/2024/2024-03-30.html</id><summary type="html">&lt;p&gt;æœ€è¿‘å¸¸å¸¸ä¼šæ”¶åˆ°è¿™æ ·çš„é€šçŸ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ç»åä¸ºäº‘æ ¸æŸ¥ï¼Œæ‚¨çš„åŸŸåï¼šxxx.cnå¹¶æœªè¿›è¡Œå¤‡æ¡ˆï¼ŒäºŒçº§åŸŸåxh.xxx.cnå®é™…è§£æåä¸ºäº‘å¤§é™†æœåŠ¡å™¨IPï¼š139.159.xxx.xxxæ®å·¥ä¿¡éƒ¨ã€Šäº’è”ç½‘ä¿¡æ¯æœåŠ¡ç®¡ç†åŠæ³•ã€‹(å›½åŠ¡é™¢292å·ä»¤ â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;æœ€è¿‘å¸¸å¸¸ä¼šæ”¶åˆ°è¿™æ ·çš„é€šçŸ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ç»åä¸ºäº‘æ ¸æŸ¥ï¼Œæ‚¨çš„åŸŸåï¼šxxx.cnå¹¶æœªè¿›è¡Œå¤‡æ¡ˆï¼ŒäºŒçº§åŸŸåxh.xxx.cnå®é™…è§£æåä¸ºäº‘å¤§é™†æœåŠ¡å™¨IPï¼š139.159.xxx.xxxæ®å·¥ä¿¡éƒ¨ã€Šäº’è”ç½‘ä¿¡æ¯æœåŠ¡ç®¡ç†åŠæ³•ã€‹(å›½åŠ¡é™¢292å·ä»¤)å’Œå·¥ä¿¡éƒ¨ä»¤ç¬¬33å·ã€Šéç»è¥æ€§äº’è”ç½‘ä¿¡æ¯æœåŠ¡å¤‡æ¡ˆç®¡ç†åŠæ³•ã€‹è§„å®šï¼Œå›½å®¶å¯¹ç»è¥æ€§äº’è”ç½‘ä¿¡æ¯æœåŠ¡å®è¡Œè®¸å¯åˆ¶åº¦...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è®©æˆ‘æƒ³èµ·æ¥è¿™ä¸ªå‡ å¹´å‰çœ‹è¿‡çš„ DNS æ‚¬æŒ‚è®°å½•ï¼ˆdangling DNS recordï¼‰çš„é—®é¢˜ï¼Œè®©å°ç»„åŒå­¦åœ¨äº‘èµ„äº§åˆè§„å¹³å°æ‰«æå¤„ç†äº†ä¸‹æ‚¬æŒ‚è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯ DNS æ‚¬æŒ‚è®°å½•ï¼Œå¯ä»¥çœ‹è¿™ 2 ä¸ªé“¾æ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/30786805"&gt;çŸ¥ä¹ï¼šUnderstanding the Security Threats of Dangling DNS Records - Week 8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://learn.microsoft.com/en-us/azure/security/fundamentals/subdomain-takeover"&gt;Prevent dangling DNS entries and avoid subdomain takeover&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DNS æ‚¬æŒ‚è®°å½•çš„å±å®³é™¤äº†ä¸Šé¢å¾®è½¯æ–‡æ¡£ä¸­æåˆ°çš„ï¼Œå¯¹å­åŸŸåè®°å½•å¤±å»æ§åˆ¶æƒï¼ˆè¢«ç½®å…¥å¹¿å‘Šï¼‰ã€é’“é±¼ã€Cookieæ³„éœ²ã€CSRF ç­‰ç­‰ã€‚åœ¨å¤§é™†ç¯å¢ƒä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªè®©ç³»ç»Ÿç®¡ç†å‘˜æ— æ¯”æƒŠæçš„å¯èƒ½æ€§ï¼Œè¢«ç”µè¯ˆåˆ©ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¤§é™†æœ‰åç”µè¯ˆçš„å›½æƒ…å­˜åœ¨ï¼Œå¯¼è‡´æˆä¿¡æˆ–è€…å¤‡æ¡ˆè¿‡çš„åŸŸå ï¼Œèƒ½è¢«åˆ©ç”¨å·²ç»æ˜¯ä¸€ç§èµ„æºã€‚ç”¨æˆ‘ä»¬å·²ç»å¤‡æ¡ˆè¿‡çš„åŸŸåä½œä¸ºæ¡¥æ¢ï¼Œç»•è¿‡ä¸€äº›åœ°æ–¹çš„æ£€æµ‹ï¼Œæˆ–å¢åŠ è¯ˆéª—æˆåŠŸçš„å¯èƒ½æ€§ã€‚å¦‚æœè¢«åˆ©ç”¨ï¼Œç›¸å…³æœºæ„å¯ä»¥ç›´æ¥å‘æŒ‡ä»¤ç»™åŸŸåæœåŠ¡å•† clienthold æˆ–è€…çœçº§è¿è¥å•†è¿›è¡Œå±è”½åŸŸåï¼Œå¨èƒåˆ°æ•´ä¸ªäºŒçº§åŸŸåç©ºé—´çš„å®‰å…¨ã€‚
ä»å„ç±»æ¶ˆæ¯æ¥çœ‹ï¼Œå„ä¸ªåœ°æ–¹çš„ç›¸å…³æœºæ„æƒåˆ©éå¸¸å¤§ã€‚&lt;/p&gt;
&lt;p&gt;æ›¾ç»å‘ç”Ÿè¿‡çš„æœ‰è…¾è®¯äº‘ COS åŸŸåè¢«å¤šä¸ªçœå°ç¦ã€LeanCloud åŸŸåè¢«ç¦äº‹ä»¶ç­‰ã€‚æ‰€ä»¥ç›®å‰å›½å†…äº‘Pass å‚å•†ï¼ŒåŸºæœ¬åªè®©å®¢æˆ·è‡ªå¸¦åŸŸåï¼Œ CNAMEæ¥å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œ DNS æ‚¬æŒ‚è®°å½•æ˜¯ä¸€æ¡éå¸¸å®¹æ˜“æ¼ç½‘çš„é±¼ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„åšæ³•æ˜¯å®šæœŸæ‰«ææ‰€æœ‰åŸŸåè®°å½•ï¼ŒA /AAAA ç­‰è®°å½•ï¼ŒæŒ‡å‘æ£€æŸ¥æ˜¯å¦åœ¨ èµ„äº§ç³»ç»Ÿï¼ˆCMDB ï¼‰ä¸­ã€‚CNAME è®°å½•ï¼Œå…ˆæ£€æŸ¥æŒ‡å‘çš„äºŒçº§åŸŸåæ˜¯å¦åœ¨ç»´æŠ¤çš„ç™½åå•ï¼ˆåŒ…å«å„ç±» CDNå¤§å‚ åŠ é€ŸåŸŸåï¼‰ä¸­ï¼Œå¦‚æœä¸æ˜¯ï¼Œå†æ£€æŸ¥æ˜¯å¦åœ¨ èµ„äº§ç³»ç»Ÿä¸­ï¼ˆå­˜åœ¨ AWS ELB ç­‰åŸŸåçš„æƒ…å†µï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ”»å‡»è€…åœ¨äº‘å¹³å°æ‰¹é‡ç”³è¯·IPï¼Œå¦‚ä½•çŸ¥é“æ˜¯å¦æœ‰åŸŸåæŒ‡å‘è¯¥åœ°å€ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¼€ä¸ª nginxï¼Œæ”¶é›†ä¸€æ®µæ—¶é—´è®¿é—®æ—¥å¿—ï¼Œçœ‹è¯·æ±‚hostå¤´ï¼›&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢ IP çš„è§£æè®°å½•ï¼šhttp://viewdns.info ï¼Œä»¥åŠå„ç±» TI å¹³å°å†å²è§£æï¼Œå†åšéªŒè¯ã€‚&lt;/li&gt;
&lt;/ol&gt;</content><category term="2024"></category><category term="dns"></category><category term="hack"></category></entry><entry><title>å…³äºç£ç›˜UREçš„æ‹…å¿§</title><link href="https://fangpsh.github.io/posts/2024/2024-03-19.html" rel="alternate"></link><published>2024-03-19T00:00:00+08:00</published><updated>2024-03-19T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-03-19:/posts/2024/2024-03-19.html</id><summary type="html">&lt;p&gt;ç½‘ç»œä¸Šå¸¸è§å…³äº  ç£ç›˜UREï¼ˆUnrecoverable Read Error ï¼‰çš„æ‹…å¿§ï¼ŒæŒ‰ç…§å‚å•†ç»™å‡ºçš„ UREæ•°æ®è®¡ç®— RAID5 ä¹‹ç±»çš„é‡å»ºå¤±è´¥æ¦‚ç‡éå¸¸ä¹‹é«˜ï¼Œä¾‹å¦‚è¿™ä½çŸ¥ä¹ç½‘å‹çš„å›ç­”&lt;a href="https://www.zhihu.com/question/20164654"&gt;raid5 â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç½‘ç»œä¸Šå¸¸è§å…³äº  ç£ç›˜UREï¼ˆUnrecoverable Read Error ï¼‰çš„æ‹…å¿§ï¼ŒæŒ‰ç…§å‚å•†ç»™å‡ºçš„ UREæ•°æ®è®¡ç®— RAID5 ä¹‹ç±»çš„é‡å»ºå¤±è´¥æ¦‚ç‡éå¸¸ä¹‹é«˜ï¼Œä¾‹å¦‚è¿™ä½çŸ¥ä¹ç½‘å‹çš„å›ç­”&lt;a href="https://www.zhihu.com/question/20164654"&gt;raid5 ç£ç›˜é˜µåˆ—çœŸçš„ä¸å®‰å…¨ä¹ˆï¼Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ¦‚ç‡å’Œæˆ‘è‡ªèº«åœ¨è¿™ä¹ˆå¤šå¹´çš„è¿ç»´å·¥ä½œä¸­ï¼Œraid5 é‡å»ºå¤±è´¥çš„äº‹ä»¶å‡ ä¹æ²¡é‡åˆ°çš„æ„Ÿè§‰ä¸ç¬¦ã€‚ä¸è¿‡äººçš„æ„Ÿè§‰æ˜¯ä¸å‡†ç¡®çš„ï¼Œæ•°å­¦æ‰ä¸ä¼šæ’’è°ï¼Œä¾‹å¦‚ç”Ÿæ—¥æ‚–è®ºã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæå‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;30 åˆ†é’Ÿå†…è¯»å–äº† 12TB å’Œ 300 å¤©è¯»å–äº† 12TBï¼ŒURE çš„æ¦‚ç‡ä¸€æ ·å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¾ªç¯è¯»å–ä¸€ä¸ª 10G çš„æ–‡ä»¶è¾¾åˆ° 12TBï¼Œå’Œéå†è¯»ç›˜è¾¾åˆ° 12TBï¼Œ UREæ¦‚ç‡ ä¸€æ ·å—ï¼Ÿ&lt;/li&gt;
&lt;li&gt;åœ¨æ— å°˜æœºæˆ¿è¯»å– 12TBï¼Œå’Œåœ¨å‡ºç§Ÿè½¦ä¸Šè¯»å– 12TBï¼ŒURE æ¦‚ç‡ä¸€æ ·å—&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªç¡¬ç›˜æ–­ç”µæ”¾ 1å¹´è¯»å– 12TBï¼Œå’Œä¸€ä¸ªç¡¬ç›˜ä¸Šæœº1å¹´åè¯»å– 12TBï¼ŒURE æ¦‚ç‡ä¸€æ ·å—ï¼Ÿ&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ—¢ç„¶å‡ºå‘ç‚¹æ˜¯ UREï¼Œé‚£æˆ‘ä»¬éœ€è¦äº†è§£ä¸‹ URE çš„æ˜¯ä»€ä¹ˆï¼Œæ˜¯å¦‚ä½•è®¡ç®—å¾—å‡ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;æœç´¢å¼•æ“ç¿»äº†åŠå¤©éƒ½æ²¡æ‰¾åˆ°ï¼Œchatgpt ç»™å‡ºçš„ç­”å¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Vendors typically calculate the Unrecoverable Read Error (URE) based on extensive testing and statistical analysis. While the specific calculation method may vary among vendors, here is a general overview of how URE is typically calculated:

The vendor conducts large-scale tests where they read a significant amount of data from the disk and record the number of errors encountered during the read process.

The recorded error count is then compared to the total amount of data read.

By dividing the error count by the total data read, the vendor can determine the rate or probability of Unrecoverable Read Errors. This is often expressed as the number of errors per a certain amount of data read, such as one error per 10^14 (or 10^15) bits read.

The calculated rate or probability is then provided as the URE value by the vendor, which helps users assess the disk&amp;#39;s reliability and error tolerance.

It&amp;#39;s important to note that the URE calculation is an estimation based on statistical samples and test data. The specific URE value and calculation method can vary depending on the vendor, disk model, and technology. Additionally, the URE value is typically calculated over the entire lifespan of the disk or during a specific amount of data read.

For specific disk models and vendors, it&amp;#39;s recommended to refer to their technical specifications and documentation for more detailed information on URE values and calculation methods.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½œä¸ºä¸€ä¸ªç»Ÿè®¡æŒ‡æ ‡ï¼Œçœ‹èµ·æ¥å’Œæ—¶é—´æ— å…³ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.reddit.com/r/zfs/comments/3gpkm9/statistics_on_realworld_unrecoverable_read_error/"&gt;reddit:statistics_on_realworld_unrecoverable_read_error&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The spec does not mean that after every 12.5TB you will get an error, it means that on average across the lifespan of the drive's reads it will get that number of errors. It is possible and indeed very likely that you could read 100's of TB and get no errors, and then all of a sudden get a bunch of errors all together, averaging to 1 in 12.5TB. It's just statistics as to why they seem more reliable that the datasheet.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªæŒ‡æ ‡æ˜¯ä¸æ˜¯åŒ…å«ç£ç›˜å‡ºç°æ•…éšœçš„é‚£ä¸€åˆ»ï¼Œå‡ºç°å¤§é‡çš„é”™è¯¯ï¼Œåˆå¹¶å…¨ç”Ÿå‘½å‘¨æœŸï¼Œç´¯è®¡å¹³å‡å‡ºæ¥çš„ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œæœ€åå¤§é‡çš„ é”™è¯¯ä¼šæ€¥å‰§æ‹‰é«˜å¹³å‡å€¼ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾ä¸€æ¶é£æœºæ°¸ä¹…æ‰§é£ä¸‹å»ï¼Œ30 å¹´åå‡ºç©ºéš¾æ­»äº† 300 ä¸ªäººã€‚ä¸èƒ½è¯´è¿™ä¸ªé£æœºä¸Šæ¯é£1å¹´éƒ½å¯èƒ½ä¼šæ­»10ä¸ªäººï¼Ÿ&lt;/p&gt;
&lt;p&gt;åˆæœ‰ä¸€äº›è¯´æ³•ï¼Œ å‚å•†çš„UREæ˜¯æœ€ç³Ÿç³•/æç«¯çš„æƒ…å†µä¸‹æµ‹è¯•çš„ï¼Œå®é™…æ²¡è¿™ä¹ˆç³Ÿç³•ï¼›URE æ˜¯ä¸€ä¸ªæ¦‚ç‡ï¼Œä¸ä»£è¡¨ä¸€å®šä¼šé‡åˆ°ï¼Œä¾‹å¦‚æŠ›ç¡¬å¸å¯èƒ½ 10 æ¬¡éƒ½æ˜¯æ­£é¢ï¼›
&lt;a href="https://www.enricobassetti.it/2022/03/raid5-ure-and-the-probability/"&gt;RAID5, URE and the probability&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;- the URE probability is the max value declared by the constructor (worst case scenario - usually disks perform far better)
- the URE can happen with the same probability among the whole disk (which is not true)
- the URE will happen after 10^14 bits (which will not - again, itâ€™s a probability)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†æ˜¯å½’æ ¹ç»“åº•ï¼ŒURE åˆ°åº•å’Œä»€ä¹ˆæœ‰å…³ï¼Œæ˜¯æ€ä¹ˆè®¡ç®—äº§ç”Ÿçš„ï¼Œéƒ½æœ‰å“ªäº›åŸå› ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸Šé¢çŸ¥ä¹ç½‘å‹ç­”æ¡ˆä¸­æåˆ°çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;è¿™ä¸ªè¯»é”™è¯¯äº§ç”Ÿçš„åŸå› å¯èƒ½åœ¨äºï¼š

æ•°æ®å†™å…¥ç¡¬ç›˜æ—¶ï¼Œæ•°å­—ä¿¡å·è½¬æ¢ä¸ºç›˜ç‰‡ä¸Šçš„æ¨¡æ‹Ÿç£åœºä¿¡å·è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼›
æ•°æ®å­˜æ”¾è¿‡ç¨‹ä¸­ï¼Œå› ä¸ºå¤–ç•Œçš„ç”µç£å¹²æ‰°/å®‡å®™å°„çº¿/å†™å…¥å‘¨å›´å•å…ƒæ—¶ç£å¤´ä½ç½®åç¦»å¯¼è‡´çš„ç£å•å…ƒä¸­éƒ¨åˆ†ç£æ€§ææ–™ææ€§ç¿»è½¬ï¼›
è¯»å–æ•°æ®æ—¶ï¼Œç£åœºä¿¡å·è½¬æ¢ä¸ºæ•°å­—ä¿¡å·è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼›
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™é‡Œé¢å…¶å®è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå«&lt;a href="https://en.wikipedia.org/wiki/Data_degradation"&gt;bit rot: æ¯”ç‰¹è¡°å‡&lt;/a&gt;ï¼Œbit rot å¯èƒ½ä¼šå¯¼è‡´ UREï¼Œä½†å¹¶ä¸ä¸€å®šã€‚&lt;/p&gt;
&lt;p&gt;å°±å®‡å®™å°„çº¿æ¥è¯´ï¼Œä¸€å—ç£ç›˜ 30 åˆ†é’Ÿè¯» 12TB è¢«å®‡å®™å°„çº¿å½±å“çš„æ¦‚ç‡å’Œ 30å¤©è¯» 12TB ä¸€æ ·å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;a href="https://heremystuff.wordpress.com/2020/08/25/the-case-of-the-12tb-ure/"&gt;The case of the 12TB URE: Explained and debunked&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Another name for the unrecoverable read error is:

LSE â€“ Latent Sector Error
Latent, because you donâ€™t know it is there, until you try to read it.
bad sector â€“ the colloquial name for the same thing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;URE å°±æ˜¯LSEã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://pages.cs.wisc.edu/~remzi/OSTEP/Chinese/44.pdf"&gt;ç¬¬ 44 ç«  æ•°æ®å®Œæ•´æ€§å’Œä¿æŠ¤&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;å½“ç£ç›˜æ‰‡åŒºï¼ˆæˆ–æ‰‡åŒºç»„ï¼‰ä»¥æŸç§æ–¹å¼è®¹è¯¯æ—¶ï¼Œä¼šå‡ºç° LSEã€‚ä¾‹å¦‚ï¼Œå¦‚æœç£å¤´ç”±äºæŸç§
åŸå› æ¥è§¦åˆ°è¡¨é¢ï¼ˆç£å¤´ç¢°æ’ï¼Œhead crashï¼Œåœ¨æ­£å¸¸æ“ä½œæœŸé—´ä¸åº”å‘ç”Ÿçš„æƒ…å†µï¼‰ï¼Œåˆ™å¯èƒ½ä¼šè®¹è¯¯
è¡¨é¢ï¼Œä½¿å¾—æ•°æ®ä½ä¸å¯è¯»ã€‚å®‡å®™å°„çº¿ä¹Ÿä¼šå¯¼è‡´æ•°æ®ä½ç¿»è½¬ï¼Œä½¿å†…å®¹ä¸æ­£ç¡®ã€‚å¹¸è¿çš„æ˜¯ï¼Œé©±
åŠ¨å™¨ä½¿ç”¨ç£ç›˜å†…çº é”™ç ï¼ˆError Correcting Codeï¼ŒECCï¼‰æ¥ç¡®å®šå—ä¸­çš„ç£ç›˜ä½æ˜¯å¦è‰¯å¥½ï¼Œå¹¶ä¸”
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¿®å¤å®ƒä»¬ã€‚å¦‚æœå®ƒä»¬ä¸å¥½ï¼Œå¹¶ä¸”é©±åŠ¨å™¨æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥ä¿®å¤é”™è¯¯ï¼Œåˆ™åœ¨
å‘å‡ºè¯·æ±‚è¯»å–å®ƒä»¬æ—¶ï¼Œç£ç›˜ä¼šè¿”å›é”™è¯¯ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¹äº†ï¼Œå£°éŸ³ä¹Ÿä¼šå½±å“åˆ°ç£ç›˜ï¼Œå› ä¸ºå£°éŸ³ä¹Ÿæ˜¯ä¸€ç§éœ‡åŠ¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.youtube.com/watch?v=tDacjrSCeq4"&gt;Gregg 15 å¹´å‰çš„æµ‹è¯•ï¼šShouting in the Datacenter&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.vice.com/en/article/8q8dqg/a-loud-sound-just-shut-down-a-banks-data-center-for-10-hours"&gt;A Loud Sound Just Shut Down a Bank's Data Center for 10 Hours&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯´å›æ­£é¢˜ï¼ŒLSE å’Œè¯»å–æ•°æ®é‡æœ‰å…³å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.usenix.org/event/fast10/tech/full_papers/schroeder.pdf"&gt;ã€ŠUnderstanding latent sector errors and how to protect against themã€‹&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;3.5 What causes LSEs?  &lt;/p&gt;
&lt;p&gt;This is obviously a broad question that we cannot hope to answer with the data we have. Nevertheless, we want to address this question briefly, since our observations in Section 3.3 might lead to hasty conclusions. In particu- lar, a possible explanation for the concentration of errors in certain parts of the drive might be that these areas see a higher utilization. While we do not have access to work- load data for NetAppâ€™s systems, we have been able to obtain two years of data on workload, environmental fac- tors and LSE rates for five large (&amp;gt; 50,000 drives each) clusters at Google containing five different drive models. None of the clusters showed a correlation between either the number of reads or the number of writes that a drive sees (as reported by the driveâ€™s SMART parameters) and the number of LSEs it develops. We plan a detailed study of workload and environmental factors and how they im- pact LSEs as part of future work.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç»“è®ºï¼šè¯»å†™é‡å’Œ LSE æ— å…³ã€‚å¦å¤–è®ºæ–‡ä¸­æåˆ°ï¼ŒLSE çš„å‡ºç°åœ¨æ—¶é—´å’Œç©ºé—´ä¸Šå…·æœ‰ï¼ˆèšé›†æ€§ï¼‰å…³è”æ€§ï¼Œå³å¾ˆå¯èƒ½æ˜¯åŒä¸€äº‹ä»¶è§¦å‘çš„ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;These observations indicate that the errors in most bursts are likely caused by the same event and hence occurred at the same time.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½çš„ç†è§£ï¼ŒURE æè¿°çš„æ˜¯ç£ç›˜ä¸€æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸‹çš„ç»Ÿè®¡å€¼ï¼Œä¸æ˜¯æŸä¸ªä¸€æ—¶åˆ»æˆ–è€…å¤šå°‘è¯»å†™é‡çš„æ¦‚ç‡ã€‚&lt;/p&gt;
&lt;p&gt;å†çœ‹å¾®è½¯å›¢é˜Ÿçš„è®ºæ–‡ï¼š&lt;a href="https://arxiv.org/pdf/cs/0701166"&gt;ã€ŠEmpirical Measurements of Disk Failure Rates and Error Ratesã€‹&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We also conclude that UER (uncorrectable error rate) is not the relevant metric for our needs. When an uncorrectable read error happens, there are typically several damaged storage blocks (and many uncorrectable read errors.) Also, some uncorrect- able read errors may be masked by the operating system. The more meaningful metric for data architects is Mean Time To Data Loss (MTTDL.)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;URE ä¼šå‡ºç°ï¼Œä½†æ˜¯å’Œ å‚å•†çš„UER å…³è”æ€§ä¸å¼ºï¼Œæ›´å»ºè®®å‚è€ƒ MTTDLã€‚è¿™å¯èƒ½æ˜¯ç½‘å‹æ‰€è¯´çš„å°½é‡é€‰æ‹©ä¸åŒæ‰¹æ¬¡ã€ä¸åŒå¹³å°ç£ç›˜ç»„ RAID çš„åŸå› ï¼ŸåŒæ‰¹æ¬¡çš„ç£ç›˜ MTTDL æ€»æ˜¯ç›¸è¿‘ï¼Ÿ&lt;/p&gt;
&lt;p&gt;MTTDL=MTBFï¼Œé…·ç‹¼çš„ MTBF æ˜¯100ä¸‡å°æ—¶ï½114 å¹´ã€‚å¦‚æœéšç€æ—¶é—´æ¨ç§»ï¼Œå‡ºç°LSEçš„æ¦‚ç‡ä¼šè¶Šæ¥è¶Šé«˜ã€‚å‰ 10 å¹´çš„æ¦‚ç‡åº”è¯¥è¿œå°äºåé¢100å¹´ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç½‘å‹ä¹°äºŒæ‰‹ç£ç›˜è¦çœ‹ SMART é€šç”µæ—¶é—´å’Œå†™å…¥æ•°æ®é‡çš„åº•å±‚åŸå› ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;UREç¡®å®ä¼šå½±å“åˆ° RAID é‡å»ºæˆåŠŸç‡ï¼Œä½†æ˜¯é‡å»ºè¿‡ç¨‹ä¸­ LSE çš„å‡ºç°çš„æ¦‚ç‡å¹¶ä¸èƒ½ç®€å•çš„ç”¨å‚å•†çš„ URE å’Œç£ç›˜å®¹é‡æ¥æ¨ç®—ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;LSE é‚£ç¯‡è®ºæ–‡ä¸­ä¹Ÿæåˆ°ï¼Œå¼€å¯é˜µåˆ—çš„å·¡è¯»ï¼ˆpatrol readingã€å·¡æ£€ã€scrub  ç­‰ï¼‰å¯¹äºè‡ªåŠ¨ä¿®å¤ bit rotå’Œæå‰ å‘ç° LSE éå¸¸é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è§è¿‡å¤ªå¤šè¿ç»´æœºå™¨ä¸Šæ¶ï¼Œé…ç½®å®Œ RAID å°±ä¸ç®¡äº†ã€‚è‡³å°‘è¿˜åº”è¯¥åšå¥½ä»¥ä¸‹å·¥ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é…ç½®å¥½å·¡è¯»å‘¨æœŸï¼Œè½¯ raid ä¹Ÿæœ‰å¯¹åº”çš„åŠŸèƒ½ï¼›&lt;/li&gt;
&lt;li&gt;åšå¥½é˜µåˆ—çŠ¶æ€æ£€æŸ¥&lt;/li&gt;
&lt;li&gt;åšå¥½é˜µåˆ—ä¸­ç£ç›˜çš„çŠ¶æ€ç›‘æ§ï¼ŒåŒ…æ‹¬ SMARTã€LSI PD MediaError ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;æœºæˆ¿å·¡æ£€&lt;/li&gt;
&lt;li&gt;BBU ç›‘æ§&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™äº›å·¥ä½œéƒ½æ²¡åšå¥½ï¼ŒRAID10 ä¹Ÿç™½æ‰¯ã€‚&lt;/p&gt;
&lt;p&gt;RAID5 æˆ‘è¿˜æ˜¯ä¼šç”¨ï¼Œåªæ˜¯ä¸ºäº†è®¡ç®—èŠ‚ç‚¹æ¢ç›˜ä¸ç”¨åœæœºã€‚æ•°æ®åº“èŠ‚ç‚¹ä¸ç”¨RAID5ã€‚ &lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªæ§åˆ¶å­˜å‚¨æ± å¤§å°çš„åŸå› æ˜¯ï¼Œé‡å»ºè¿‡ç¨‹ä¼šæœ‰æ€§èƒ½ä¸‹é™çš„é—®é¢˜ï¼Œç”Ÿäº§ç¯å¢ƒè¦å°½é‡ç¼©çŸ­é‡å»ºæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ï¼Œé‡è¦æ•°æ®åšå¤‡ä»½ï¼ŒRAID ä¸æ˜¯å¤‡ä»½ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;2025-06-12 è¡¥å……æ›´æ–°ï¼Œè¿™ä½å­˜å‚¨ä¸“å®¶upä¸»æå‡ºæ¥ä¸€ä¸ªè§‚ç‚¹ï¼šç”±äºECCç­‰ç£ç›˜è‡ªåŠ¨çº é”™æœºåˆ¶çš„å­˜åœ¨ï¼Œå¤§éƒ¨åˆ†é”™è¯¯èƒ½è¢«è‡ªåŠ¨çº æ­£ã€‚ä½•å†µè¿˜æœ‰è‡ªåŠ¨é‡æ˜ å°„ç­‰æœºåˆ¶ï¼Ÿ
å¦å¤–å³ä½¿å¤šç›˜å‡ºç°å¤šä¸ªUREï¼Œåªè¦ä¸è½åˆ°ä¸€ä¸ªæ¡å¸¦ä¸Šï¼Œèƒ½è¢«RAIDç®—æ³•è‡ªåŠ¨çº æ­£ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°é˜µåˆ—æ•´ä½“å¥åº·ã€‚å¬èµ·æ¥æœ‰ç‚¹é“ç†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.bilibili.com/video/BV1RUVdzPEPi"&gt;æ·±åº¦èŠä¸€èŠï¼ŒUREåˆ°åº•æ˜¯ä¸ªå•¥ï¼Œç¡¬ç›˜åé“å¹¶ä¸ç­‰äºç¡¬ç›˜æ•…éšœï¼è¿™é‡Œæ˜¯ã€Šå­˜å‚¨é“²å±å®˜ã€‹ï¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.bilibili.com/video/BV1zFJJzXEfy"&gt;ç¡¬ç›˜çˆ†å‘26ä¸ªUREåé“ï¼ŒRAID5æˆåŠŸå¯¹æŠ—ï¼å®‰å…¨åœ¨æœ‰äº›æ—¶å€™æ¯”é€Ÿåº¦å¾ˆé‡è¦ï¼è¿™é‡Œæ˜¯LRAIDã€Šå­˜å‚¨é“²å±å®˜ã€‹ï¼&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2024"></category><category term="diskï¼Œraid"></category></entry><entry><title>é«˜è´¨é‡4Gä»£ç†æ± </title><link href="https://fangpsh.github.io/posts/2024/2024-02-02.html" rel="alternate"></link><published>2024-02-02T00:00:00+08:00</published><updated>2024-02-02T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-02-02:/posts/2024/2024-02-02.html</id><summary type="html">&lt;p&gt;&lt;img alt="rasproxy" src="/assets/images/2024/20240218145733.jpg"&gt;&lt;/p&gt;
&lt;p&gt;åˆšåˆšå‚åŠ å·¥ä½œæ—¶ï¼Œåœ¨æŸå…¬å¸è´Ÿè´£è¿ç»´ï¼Œå¸¸å¸¸è¦ç»™çˆ¬è™«ç»„çš„åŒäº‹æ‰¾å„ç§äº‘çš„æœºå™¨ï¼Œucloudã€é’äº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€awsç­‰ï¼Œåæ¥è¿™äº›æ®µè¢«å°çš„ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="rasproxy" src="/assets/images/2024/20240218145733.jpg"&gt;&lt;/p&gt;
&lt;p&gt;åˆšåˆšå‚åŠ å·¥ä½œæ—¶ï¼Œåœ¨æŸå…¬å¸è´Ÿè´£è¿ç»´ï¼Œå¸¸å¸¸è¦ç»™çˆ¬è™«ç»„çš„åŒäº‹æ‰¾å„ç§äº‘çš„æœºå™¨ï¼Œucloudã€é’äº‘ã€é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€awsç­‰ï¼Œåæ¥è¿™äº›æ®µè¢«å°çš„å·®ä¸å¤šäº†ï¼Œå°±å¼€å§‹ç”¨å¿«ä»£ç†ä¹‹ç±»çš„æœåŠ¡ï¼Œä¸è¿‡é€Ÿåº¦æ…¢ï¼ŒIP ä¹Ÿå®¹æ˜“è¢«å°ã€‚é‚£ä¼šåœ¨ç©æ ‘è“æ´¾ï¼Œå¤–åŠ å…¬å¸ç»™å‘äº†ä¸€ä¸ªç§»åŠ¨3Gæ— çº¿ç½‘å¡ï¼Œ æœ‰ä¸€å¤©çªç„¶æƒ³åˆ°ä¸å¦‚ç”¨æ ‘è“æ´¾+æ— çº¿ç½‘å¡åšä¸ªä»£ç†æ± ã€‚&lt;/p&gt;
&lt;p&gt;å¥½å¤„æ˜¯åªè¦é‡å¯å°±èƒ½æ¢ IPï¼Œ IP æ¥è‡ªæœ¬åœ°è¿è¥å•†çœŸå®ç”¨æˆ· IP è¶…å¤§æ± ï¼Œä¸å®¹æ˜“è¢«å°ï¼Œæˆ–è€…æ˜¯è¯´ä½ è¦æ•¢æŒ‰æ®µå°ï¼Œå°±ä¼šè¯¯ä¼¤ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸Šé¢å›¾ç‰‡å½“æ—¶åº”è¯¥æäº†å¿« 100 ä¸ªæ ‘è“æ´¾ã€‚æ— çº¿ç½‘å¡ç”¨åä¸º EC8201å’ŒE8231ï¼Œä¸éœ€è¦ ppp æ‹¨å·ï¼Œè¿˜æœ‰ web æ¥å£å¯ä»¥è¯»å–ç»Ÿè®¡æµé‡ã€‚æ’åˆ° usb å£ä¸Šï¼Œå†™ä¸€ä¸ªç±»ä¼¼è¿™ç§udev rulesï¼Œæ·»åŠ åŠå…¬ç½‘è·¯ç”±ï¼Œåˆ é™¤é»˜è®¤è·¯ç”±ï¼Œå¤–ç½‘æµé‡èµ°æ— çº¿ç½‘å¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#Huawei E8231
ATTRS{idVendor}==&amp;quot;12d1&amp;quot;, ATTRS{idProduct}==&amp;quot;14db&amp;quot;, RUN+=&amp;quot;usb_modeswitch &amp;#39;%b/%k&amp;#39;&amp;quot;
ACTION==&amp;quot;add&amp;quot;, SUBSYSTEM==&amp;quot;usb&amp;quot;,ATTRS{idVendor}==&amp;quot;12d1&amp;quot;, ATTRS{idProduct}==&amp;quot;14db&amp;quot;, RUN+=&amp;quot;/sbin/route add -net 10.0.0.0/8 dev eth0&amp;quot;
ACTION==&amp;quot;add&amp;quot;, SUBSYSTEM==&amp;quot;usb&amp;quot;,ATTRS{idVendor}==&amp;quot;12d1&amp;quot;, ATTRS{idProduct}==&amp;quot;14db&amp;quot;, RUN+=&amp;quot;/sbin/route del default gw 10.0.1.1 dev eth0&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹ä¸Šè·‘ä¸ªtinyproxy æˆ– &lt;code&gt;ssh -D&lt;/code&gt;ï¼Œä½¿ç”¨ supervisord æˆ–systemd ç®¡ç†å¥½æœåŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å†ç”¨ flask å†™äº†ä¸€ä¸ªé’æ¶©çš„æœåŠ¡ç«¯ï¼Œåœ¨æ¯ä¸ªæ ‘è“æ´¾ä¸Šè·‘ä¸€äº›å®šæ—¶è„šæœ¬ï¼Œä¸ŠæŠ¥ç»Ÿè®¡ä¿¡æ¯ã€‚ä¸€äº›åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æµé‡ä¸å¤Ÿäº†å°±è‡ªåŠ¨ä¸‹çº¿ï¼›&lt;/li&gt;
&lt;li&gt;ä»£ç†å¥åº·æ£€æŸ¥ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡ç«¯åå‡ºå¯ç”¨çš„ä»£ç†åˆ—è¡¨æ¥å£ï¼›&lt;ul&gt;
&lt;li&gt;æŒ‰æµé‡è®¡ç®—ï¼ŒæŒ‰é“¾æ¥æ•°æœ€å°åˆ†é…ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹è¿œç¨‹é‡å¯ç®¡ç†ç­‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚ä»Šæœç´¢äº†ä¸‹ 19 å¹´ä¹Ÿæœ‰ä¸€äº›æœ‹å‹åœ¨ç©ç±»ä¼¼çš„ï¼Œè€Œä¸”æ›´çœæœºå™¨ã€‚å½“æ—¶åšæ³•æ˜¯ä¸€ä¸ªæœºå™¨æ’ä¸€ä¸ªæ— çº¿ç½‘å¡ï¼Œæ²¡æƒ³åˆ°å¯ä»¥ç”¨ docker +è™šæ‹Ÿç½‘å¡çš„æ–¹å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://mp.weixin.qq.com/s/xlm8biaUinNlNS5hBO7uLw"&gt;éœ‡æƒŠï¼Œå•†ä¸šçº§4Gä»£ç†å±…ç„¶åªéœ€è¦ç”¨è¿™äº›...&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://mp.weixin.qq.com/s/YHLko6nw3AcPEaU_H15esQ"&gt;Dockerç«Ÿç„¶è¿˜èƒ½è¿™ä¹ˆç©ï¼Ÿå•†ä¸šçº§4Gä»£ç†æ­å»ºå®æˆ˜ï¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/NightTeam/cellular-network-proxy_docker/"&gt;é¡¹ç›®ä»£ç &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœè¿˜è¦åšç±»ä¼¼é¡¹ç›®ï¼Œåº”è¯¥ä¼šç”¨ä¸Šé¢ç½‘å‹çš„å®¹å™¨æ–¹å¼ï¼Œæˆ–è€…ç›´æ¥ç”¨äºŒæ‰‹å®‰å“æœºæ”¹é€ ï¼Œæˆæœ¬æ›´ä½ã€‚&lt;/p&gt;</content><category term="2024"></category><category term="proxy"></category><category term="raspberrypi"></category></entry><entry><title>Type65 çš„æœªæ¥</title><link href="https://fangpsh.github.io/posts/2024/2024-01-22.html" rel="alternate"></link><published>2024-01-22T00:00:00+08:00</published><updated>2024-01-22T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-01-22:/posts/2024/2024-01-22.html</id><summary type="html">&lt;p&gt;æ³¨ï¼šè¿™æ˜¯ä¸€ç¯‡ 23 å¹´8æœˆçš„ç¬”è®°ï¼Œç›®å‰æŸ¥çœ‹å¯¹åº”çš„&lt;a href="https://datatracker.ietf.org/doc/rfc9460/?include_text=1"&gt;RFC 9460&lt;/a&gt; å·²ç»å‘å¸ƒã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å‰äº›æ—¥å­åœ¨æŸ¥çœ‹å†…ç½‘åŸŸåè§£ææœåŠ¡å™¨æ—¶ï¼Œå‘ç°æ–°å¢äº†ä¸å°‘type65 çš„è®°å½•ï¼Œå â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ³¨ï¼šè¿™æ˜¯ä¸€ç¯‡ 23 å¹´8æœˆçš„ç¬”è®°ï¼Œç›®å‰æŸ¥çœ‹å¯¹åº”çš„&lt;a href="https://datatracker.ietf.org/doc/rfc9460/?include_text=1"&gt;RFC 9460&lt;/a&gt; å·²ç»å‘å¸ƒã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;å‰äº›æ—¥å­åœ¨æŸ¥çœ‹å†…ç½‘åŸŸåè§£ææœåŠ¡å™¨æ—¶ï¼Œå‘ç°æ–°å¢äº†ä¸å°‘type65 çš„è®°å½•ï¼Œåå‘æŸ¥åˆ°è®¾å¤‡å‡æ˜¯ iPhone å’Œ MacBookï¼Œè‹¹æœæ‹¥æŠ±éšç§ä¿æŠ¤æ€»æ˜¯èµ°åœ¨å‰åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;type65æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œä½œè€…å¨“å¨“é“æ¥ï¼Œå†™çš„éå¸¸å¥½ï¼š&lt;a href="https://taoshu.in/dns/dns-svcb-https.html"&gt;DNS SVCB/HTTPS è®°å½•ä»‹ç»&lt;/a&gt;ã€‚å’Œä½œè€…åœ¨ç»“å°¾è¡¨è¾¾çš„éšæƒ³ä¸åŒï¼Œä½œè€…è®¤ä¸ºæœªæ¥å¤§æ±Ÿå¤§æ¹–ï¼ŒåŠ¿ä¸å¯æŒ¡ï¼Œæˆ‘å´åæ‚²è§‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä»Šå®¶å®½å¤§å¤šç›´æ¥ä¸¢å¼ƒå…¥å‘ç‰¹å®šç«¯å£ï¼ˆ80ã€443ï¼‰ï¼Œè€Œäº‘å•†å¤§å¤šå®¡æŸ¥ httpã€https sni é˜»æ–­æœªæ¥å…¥å¤‡æ¡ˆçš„åŸŸåæµé‡ã€‚&lt;/p&gt;
&lt;p&gt;æœªæ¥iOSã€Androidã€Chrome ç­‰é˜µè¥ä¸€å®šä¼šå¤§åŠ›æ”¯æŒ SVCB/HTTPS ï¼Œéšç€æ”¯æŒç‰ˆæœ¬çš„è¦†ç›–ï¼Œé»‘ç°äº§ç­‰æµé‡åŠ¿å¿…å…ˆå¼€å§‹æ¨è¡Œæ­¤é¡¹æ–°æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;éšæœºçš„QUICç«¯å£åˆ†å‘ï¼Œå†å åŠ ECHï¼Œæ™®é€šå®¶åº­å’ŒIDCçš„å®¡æŸ¥ æˆæœ¬æ— é™å¢å¤§ï¼Œé˜»æ–­ç­–ç•¥åªèƒ½æ›´åŠ æ¿€è¿›ã€‚
ç°åœ¨https sni æ˜æ–‡è¿˜å¯ä»¥é˜»æ–­ï¼Œä»¥åä¸å¤‡æ¡ˆï¼Œ ä¸­é—´äººæ— æ³•è¯†åˆ«ï¼Œé‚£äº‘å‚å•†è¯¥å¦‚ä½•ï¼Ÿé™åˆ¶ä¸ªäººç”¨æˆ·æ³¨å†Œï¼Œä»…æ”¯æŒä¼ä¸šç”¨æˆ·ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å®¶åº­ç”¨æˆ·æˆ–IDCç­‰æµé‡ï¼Œé»˜è®¤ drop æ‰å…¥å‘ tcp æµé‡ï¼Ÿä½†æ˜¯ udpçš„ quic å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ–è®¸ï¼Œæœ€ååªèƒ½å¯¹åŸŸåè§£æä¸‹æ‰‹ï¼Œå¹²æ‰°æ±¡æŸ“æ­¤ç±»è®°å½•ç±»å‹ï¼Œä¸¢å¼ƒæ‰æµ·å¤–å¤§å‹å…¬å¼€ dns æµé‡ã€‚è€Œç‰¹è‰²çš„å¾®ä¿¡æµè§ˆå™¨ç­‰ï¼Œä¹Ÿææœ‰å¯èƒ½é»˜è®¤é˜‰å‰²ä¸æ”¯æŒã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºä¼ä¸š IT è¿ç»´ï¼Œå‡ å¹´å‰å°±åº”å°†å¢ƒå†…ã€å¢ƒå¤–è¿è¥åŸŸåå‰¥ç¦»ï¼Œç‹¬ç«‹è¿è¥ã€‚å¦‚æœè¿˜æ²¡åšï¼Œè¦æŠ“ç´§äº†ã€‚
å¯¹äºå¤§é™†è¿è¥çš„åŸŸåï¼Œå¦‚æœæ³¨å†Œå•†è¿˜åœ¨å¢ƒå¤–ï¼Œå»ºè®®å°½å¿«è½¬ç§»åˆ°å¤§é™†ï¼›å¦‚æœæƒå¨è§£æåœ¨å¢ƒå¤–ï¼Œä¹Ÿå»ºè®®å°½å¿«è¿åˆ°å¤§é™†ã€‚&lt;/p&gt;</content><category term="2024"></category><category term="dns"></category><category term="https"></category></entry><entry><title>ä¸ºä½•æ— æ³•æ€æ­»é˜¿é‡Œäº‘ç›¾</title><link href="https://fangpsh.github.io/posts/2024/2024-01-11.html" rel="alternate"></link><published>2024-01-11T00:00:00+08:00</published><updated>2024-01-11T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-01-11:/posts/2024/2024-01-11.html</id><summary type="html">&lt;p&gt;è¾“é”™ PIDï¼Œç»™äº‘ç›¾è¿›ç¨‹å‘é€äº†kill signalï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root     26689  0.3  0.1 113180  9420 ?        S&amp;lt;sl 10:34   0:08 /usr/local/aegis/aegis_client/aegis_11_83/AliYunDun
...

# kill -9 26689
-bash: kill: (26689) - Operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å’¦ï¼Œæ€ä¹ˆå•¥ä¸æ­»ï¼Œæˆ‘æ˜¯ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¾“é”™ PIDï¼Œç»™äº‘ç›¾è¿›ç¨‹å‘é€äº†kill signalï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root     26689  0.3  0.1 113180  9420 ?        S&amp;lt;sl 10:34   0:08 /usr/local/aegis/aegis_client/aegis_11_83/AliYunDun
...

# kill -9 26689
-bash: kill: (26689) - Operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å’¦ï¼Œæ€ä¹ˆå•¥ä¸æ­»ï¼Œæˆ‘æ˜¯ root å‘€ã€‚å†å°è¯•ä¸‹&lt;code&gt;systemctl stop aegis&lt;/code&gt;ï¼ŒçŠ¶æ€æ˜¯&lt;code&gt;inactive&lt;/code&gt;äº†ï¼Œä½†æ˜¯è¿›ç¨‹è¿˜åœ¨ ğŸ‘»ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;â— aegis.service - Aegis Service
   Loaded: loaded (/etc/systemd/system/aegis.service; enabled; vendor preset: disabled)
   Active: inactive (dead) since Wed 2024-01-10 14:46:43 HKT; 24h ago
   CGroup: /system.slice/aegis.service
           â”œâ”€26627 /usr/local/aegis/aegis_update/AliYunDunUpdate
           â”œâ”€26689 /usr/local/aegis/aegis_client/aegis_11_83/AliYunDun
           â””â”€26700 /usr/local/aegis/aegis_client/aegis_11_83/AliYunDunMonitor
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¥½å¥‡å¿ƒæ¥äº†ï¼Œå’‹å®ç°çš„å‘¢ï¼ŸğŸ˜¯&lt;/p&gt;
&lt;p&gt;strace ä¸€ä¸‹ &lt;code&gt;strace kill -9 26689&lt;/code&gt; æ²¡ä»€ä¹ˆæ”¶è·ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;open(&amp;quot;/usr/lib/locale/UTF-8/LC_CTYPE&amp;quot;, O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
kill(26689, SIGKILL)                    = -1 EPERM (Operation not permitted)
write(2, &amp;quot;kill: &amp;quot;, 6kill: )                   = 6
write(2, &amp;quot;sending signal to 26689 failed&amp;quot;, 30sending signal to 26689 failed) = 30
write(2, &amp;quot;: &amp;quot;, 2: )                       = 2
write(2, &amp;quot;Operation not permitted\n&amp;quot;, 24Operation not permitted
) = 24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;äº‘ç›¾çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¹Ÿåˆ ä¸æ‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# rm -f /usr/local/aegis/aegis_client/aegis_11_81/AliYunDun
rm: cannot remove &amp;#39;AliYunDun&amp;#39;: Operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿå¯¹ï¼Œè¿™æ˜¯ä¸ªå®‰å…¨è½¯ä»¶ï¼ˆHIDSï¼‰ï¼Œè¦æ˜¯èƒ½è¿™ä¹ˆç®€å•è¢«å¹²æ‰ï¼Œä¹Ÿå¤ªå¼±äº†ã€‚
æƒ³èµ·æœ‰ç½‘å‹ä»‹æ„è¿™ç±»ç¨‹åºçš„ï¼Œé‚£æˆ‘çœ‹å¤§å®¶çš„å¸è½½æ¸…ç†æŒ‡å—ä¸å°±å¯ä»¥äº†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ‰¾åˆ°å¸è½½è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://update.aegis.aliyun.com/download/uninstall.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;stop_aegis_pkill()&lt;/code&gt; å°±æ˜¯æ™®é€šçš„ kill å‘ä¸ªä¿¡å·ï¼Œä¸è¿‡æ¥ç€æ‰§è¡Œçš„&lt;code&gt;wait_aegis_exit()&lt;/code&gt; é‡Œé¢çš„è¯­å¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;    echo &amp;quot;wait AliYunDun process exit fail, possibly due to self-protection, please uninstall aegis or disable self-protection from the aegis console.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ„æ€å°±æ˜¯åœ¨æ§åˆ¶å°å…³é—­æ‰å°±å¯ä»¥è¢« kill äº†ï¼Œé‚£è¿™åº”è¯¥æ˜¯äº‘ç›¾è¿›ç¨‹è‡ªå·±æ§åˆ¶çš„ã€‚
å†å¾€ä¸‹çœ‹å¦‚ä½•æ¸…ç†æ–‡ä»¶ï¼Œçœ‹åˆ°äº†kprobeï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;    kprobeArr=(
        &amp;quot;/sys/kernel/debug/tracing/instances/aegis_do_sys_open/set_event&amp;quot;
        &amp;quot;/sys/kernel/debug/tracing/instances/aegis_inet_csk_accept/set_event&amp;quot;
        &amp;quot;/sys/kernel/debug/tracing/instances/aegis_tcp_connect/set_event&amp;quot;
        &amp;quot;/sys/kernel/debug/tracing/instances/aegis/set_event&amp;quot;
        &amp;quot;/sys/kernel/debug/tracing/instances/aegis_/set_event&amp;quot;
        &amp;quot;/sys/kernel/debug/tracing/instances/aegis_accept/set_event&amp;quot;
        &amp;quot;/sys/kernel/debug/tracing/kprobe_events&amp;quot;
        &amp;quot;/usr/local/aegis/aegis_debug/tracing/set_event&amp;quot;
        &amp;quot;/usr/local/aegis/aegis_debug/tracing/kprobe_events&amp;quot;
    )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹ç€çœ¼ç†Ÿï¼Œä¹‹å‰çœ‹åŠ¨æ€è°ƒè¯•ç›¸å…³çš„æ–‡ç« è§è¿‡ï¼Œæ²¡æ·±å…¥äº†è§£å¿˜è®°äº†ï¼ŒåŸæ¥å¦‚æ­¤ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# lsmod  |grep -i ali
AliSecGuard            22400  2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœç„¶æœ‰ä¸€ä¸ªé…å¥—çš„å†…æ ¸æ¨¡å—ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥ä¸€ä¸‹eventï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# trace-cmd list   |grep -i aegis
kprobes:aegis_cn_netlink_send
kprobes:aegis_sys_execve
kprobes:aegis_proc_fork_connector
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://fast.v2ex.com/t/869181"&gt;v2exè¿™ä¸ªå¸–å­&lt;/a&gt;ä¸­ï¼Œç½‘å‹æåˆ°äº†ç”¨kprobe æ£€æµ‹ç³»ç»Ÿè°ƒç”¨æ˜¯HIDS çš„ä¸»æµå®ç°æ–¹å¼ï¼Œæ˜¯æˆ‘èœé¸¡äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æ‰¾ä¸€ä¸ªå¼€æºçš„ HIDS å­¦ä¹ ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°äº†å­—èŠ‚å¼€æºçš„ï¼š&lt;a href="https://github.com/bytedance/Elkeid"&gt;elkeid&lt;/a&gt;ï¼Œçœ‹è¿™ä¸ª&lt;a href="https://mp.weixin.qq.com/s/rm_hXHb_YBWQqmifgAqfaw"&gt;åŸç†ä»‹ç»&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;AgentSmithæ˜¯LKMï¼ˆå¯åŠ è½½å†…æ ¸æ¨¡å—ï¼‰çš„æ–¹å¼hookä½Linuxå†…æ ¸ä¸€äº›å‡½æ•°ã€‚ç”±äºå®ƒæ˜¯ä½¿ç”¨kprobeçš„æ–¹å¼ï¼Œå®ƒhookçš„å‡½æ•°ä¸åªæ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œè¿˜å¯ä»¥hookå†…æ ¸å†…éƒ¨ä¸€äº›å‡½æ•°ï¼Œè€Œè¿™äº›å†…éƒ¨å‡½æ•°æ˜¯æŸäº›ç³»ç»Ÿè°ƒç”¨çš„å…³é”®ç‚¹è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;kill
å¯¹kill/tkillç³»ç»Ÿè°ƒç”¨æŒ‚é’©ï¼Œè®°å½•ç¨‹åºç»ˆæ­¢æŸä¸ªè¿›ç¨‹æ“ä½œï¼Œ
è®°å½•ä¿¡æ¯ï¼š
æ‰§è¡Œç¨‹åº
ç›®æ ‡è¿›ç¨‹
ä¿¡å·&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆçœ‹è¿™ç¯‡æ–‡ç« å­¦ä¹ äº†ä¸‹æ€ä¹ˆå†™ä¸€ä¸ªç®€å•çš„ kprobe ä¾‹å­ï¼Œä»¥ä¾¿èƒ½ç•¥å¾®çœ‹æ‡‚ä»£ç ï¼š&lt;br&gt;
&lt;a href="https://blog.csdn.net/luckyapple1028/article/details/52972315"&gt;ã€ŠLinuxå†…æ ¸è°ƒè¯•æŠ€æœ¯â€”â€”kprobeä½¿ç”¨ä¸å®ç°ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç¿»äº†ä¸‹&lt;code&gt;Elkeid/driver/LKM/src/&lt;/code&gt;  æ‰¾åˆ°äº† &lt;a href="https://github.com/bytedance/Elkeid/blob/93a44936de68f351d967a66deca574fa0f8ea091/driver/LKM/src/smith_hook.c#L3895,L3903"&gt;kill_kprobe&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;struct kprobe kill_kprobe = {
        .symbol_name = P_GET_SYSCALL_NAME(kill),
        .pre_handler = kill_pre_handler,
};

struct kprobe tkill_kprobe = {
        .symbol_name = P_GET_SYSCALL_NAME(tkill),
        .pre_handler = tkill_pre_handler,
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†é¡ºç€å°±å¯ä»¥æ‰¾åˆ°&lt;code&gt;register_kill_kprobe&lt;/code&gt;ã€&lt;code&gt;kill_pre_handler()&lt;/code&gt;  ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;å¤§æ¦‚æ˜ç™½äº†é€»è¾‘ï¼Œäº‘ç›¾æ˜¯hook äº† kill çš„ç³»ç»Ÿè°ƒç”¨ï¼Œåœ¨é‡Œé¢å®ç°äº†è‡ªä¿çš„é€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªæ–‡ç« &lt;a href="https://www.gentoo.site/viewtopic.php?id=455"&gt;ã€Š linuxæºç è§£è¯»ï¼ˆåä¸‰ï¼‰ï¼šå†…æ ¸é©±åŠ¨moduleåŠ è½½kprobe&amp;amp;å­—èŠ‚è·³åŠ¨Elkiedç®€è¦åˆ†æã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ç¯‡è¯‘æ–‡å†™çš„ä¹Ÿéå¸¸å¥½ï¼Œå¯ä»¥è¡¥å……ä¸‹ ftrace çš„æŠ€èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://linux.cn/article-13752-1.html"&gt;ã€Šé€šè¿‡ ftrace æ¥åˆ†æ Linux å†…æ ¸ã€‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://linux.cn/article-13852-1.html"&gt;ã€Šä½¿ç”¨ trace-cmd è¿½è¸ªå†…æ ¸ã€‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;GUI å·¥å…·ï¼š&lt;a href="https://github.com/cunctator/traceshark"&gt;traceshark&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2024"></category><category term="linux"></category><category term="sec"></category></entry><entry><title>è™šæ‹Ÿæœºä¸‹USB Tokenä½¿ç”¨é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2024/2024-01-08.html" rel="alternate"></link><published>2024-01-08T00:00:00+08:00</published><updated>2024-01-08T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2024-01-08:/posts/2024/2024-01-08.html</id><summary type="html">&lt;p&gt;23 å¹´ 6 æœˆ1 æ—¥ä¹‹åï¼Œä»£ç ç­¾åè¯ä¹¦åªèƒ½é€šè¿‡ USB Tokenç­‰å®‰å…¨è®¾å¤‡åˆ†å‘ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As of June 1, 2023, all publicly trusted code signing certificates' keys must be stored on cryptographically secure hardware (USB tokens, hardware security modules [HSMs], etc.). The goal here is â€¦&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;23 å¹´ 6 æœˆ1 æ—¥ä¹‹åï¼Œä»£ç ç­¾åè¯ä¹¦åªèƒ½é€šè¿‡ USB Tokenç­‰å®‰å…¨è®¾å¤‡åˆ†å‘ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As of June 1, 2023, all publicly trusted code signing certificates' keys must be stored on cryptographically secure hardware (USB tokens, hardware security modules [HSMs], etc.). The goal here is to help organizations better secure their code signing certificates and keys against cybercriminals.
https://codesigningstore.com/how-to-set-up-code-signing-hardware-token&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨çš„æ˜¯ epass2003ï¼ŒåŸæ¥çš„CICD ç­¾åç”¨çš„è™šæ‹Ÿæœºï¼Œä¹‹å‰ä» PVE è¿ç§»åˆ°äº† cloudpodsï¼Œéœ€è¦å…ˆé…ç½®ä¸‹ USB ç›´é€šï¼š&lt;a href="https://www.cloudpods.org/docs/guides/onpremise/vminstance/passthrough/usb-passthrough"&gt;USB é€ä¼ &lt;/a&gt;ï¼ŒæŒ‰æ–‡æ¡£åšå³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…å®Œå‚å•†ç»™çš„é©±åŠ¨ä¹‹åï¼ŒRDP è¿œç¨‹æ¡Œé¢ä¸‹ï¼Œè¯ä¹¦åº“æ‰¾ä¸åˆ°è¯ä¹¦ï¼Œ
cloudpods æ¯”è¾ƒå°ä¼—ï¼Œç”¨ å…³é”®è¯ï¼š proxmox+USB Token æœç´¢ï¼Œæ‰¾åˆ°ä¸€ä¸ªå¸–å­ï¼š
&lt;a href="https://pve-user.pve.proxmox.narkive.com/t14b5XO7/pass-through-usb-etoken-device-on-px-5-2"&gt;[PVE-User] Pass through usb eToken device on PX 5.2&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Resolved it - GlobalSign tech support couldn't figure it out, eventually
found the answer on a German forum via google translate. The client
software only works when you are conneced via a console, it fails to
load under a RDP session. Fortunately a Spice or noVNC consle works.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç±»ä¼¼é—®é¢˜ï¼š&lt;a href="https://stackoverflow.com/questions/27299106/why-is-remote-smartcard-not-found-when-using-rdp"&gt;Why is remote SmartCard not found when using RDP&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ cloudpods å¸¦çš„ vnc è¿›å…¥ï¼Œæœç„¶èƒ½æ­£å¸¸æ‰¾åˆ°è¯ä¹¦ã€‚
åˆ‡æ¢åˆ°SPICEï¼Œæˆ–è€…å†å®‰è£…ä¸ªnovnc æ¥æ›¿æ¢ RDP å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æ›´è¿›ä¸€æ­¥æ‰©å±•æ€§ã€çµæ´»æ€§çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨&lt;a href="https://www.eltima.com/smart-card-reader-remote-access/"&gt;USB Network Gate&lt;/a&gt;ã€&lt;a href="https://www.virtualhere.com/"&gt;virtualhere&lt;/a&gt;ç­‰æ–¹æ¡ˆï¼Œæˆ–è€…è€ƒè™‘ä¸Š&lt;a href="https://www.digi.com/products/networking/infrastructure-management/usb-connectivity/usb-over-ip/anywhereusb"&gt;Digi USB-Over-IP | AnywhereUSB Plus&lt;/a&gt;ã€&lt;a href="https://www.forwave.com/UkeyManager.html"&gt;å›½å†…ç‰¹è‰²ï¼šæœå¤©æ¤’ USB Server&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å•ç‹¬è¿™ä¸ª code signing çš„åœºæ™¯ï¼Œè¿˜æœ‰&lt;a href="https://www.ihuandu.com/product/101.html"&gt;DigiCert KeyLocker &lt;/a&gt;ï¼Œ &lt;a href="https://www.ssl.com/guide/supported-cloud-hsms-document-signing-ev-code-signing/"&gt;CloudHSM&lt;/a&gt; ã€‚&lt;/p&gt;</content><category term="2024"></category><category term="cloudpods"></category><category term="pki"></category></entry><entry><title>ç®€æ˜“æŠ—DDoSæ€»ç»“</title><link href="https://fangpsh.github.io/posts/2023/2023-12-19.html" rel="alternate"></link><published>2023-12-19T00:00:00+08:00</published><updated>2023-12-19T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-12-19:/posts/2023/2023-12-19.html</id><summary type="html">&lt;p&gt;ä»¥ä¸‹æ‰€è¯´çš„æ–¹æ³•åªèƒ½åº”å¯¹å°æ‰“å°é—¹ï¼Œéªšæ‰°å‹ã€æµé‡å‹ DDoS æ”»å‡»ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¸å¿ƒæ€è·¯ï¼šæœåŠ¡é™çº§ï¼Œç™½å«–èµ„æºï¼›&lt;/li&gt;
&lt;li&gt;å¥—CDN ä¹‹åï¼Œ&lt;a href="https://fangpsh.github.io/posts/2023/2023-10-02.html"&gt;åšå¥½æºIP éšè—&lt;/a&gt;ï¼Œæºç«™é¿å… â€¦&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;ä»¥ä¸‹æ‰€è¯´çš„æ–¹æ³•åªèƒ½åº”å¯¹å°æ‰“å°é—¹ï¼Œéªšæ‰°å‹ã€æµé‡å‹ DDoS æ”»å‡»ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ ¸å¿ƒæ€è·¯ï¼šæœåŠ¡é™çº§ï¼Œç™½å«–èµ„æºï¼›&lt;/li&gt;
&lt;li&gt;å¥—CDN ä¹‹åï¼Œ&lt;a href="https://fangpsh.github.io/posts/2023/2023-10-02.html"&gt;åšå¥½æºIP éšè—&lt;/a&gt;ï¼Œæºç«™é¿å…æš´éœ²ï¼Œæ³¨æ„è¯ä¹¦å¯¼è‡´çš„æºç«™æ³„éœ²ï¼›&lt;/li&gt;
&lt;li&gt;è‹¥ä¸šåŠ¡ä¸€å®šè¦ä¸Šç§æœ‰åè®®ï¼Œåšå¥½é™çº§çš„è®¾è®¡ï¼Œä¾‹å¦‚é™çº§åˆ° websocketï¼Œç„¶åèµ° CDNï¼Œä¸šåŠ¡è§‰å¾—æ”¹é€ åè®®éº»çƒ¦é‚£å°±åœ¨å®¢æˆ·ç«¯åŸ‹ä¸ªåŸºäº websocket çš„ä»£ç†ï¼›&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨å¥½å…è´¹èµ„æºï¼Œè¿›è¡Œé™çº§å¤„ç†ï¼Œä¾‹å¦‚å›½å†…ä½¿ç”¨ AWS CN çš„basic shield å…è´¹æŠ—ä¸€ä¸‹3 å±‚ 4 å±‚ï¼Œæµ·å¤–awsã€gcpã€azure ç­‰éƒ½æœ‰ä¸€å®šçš„å…è´¹é¢åº¦ã€‚è™½ç„¶å‚å•†ä¿ç•™å°ç¦æƒåˆ©ï¼Œä½†æ˜¯ç›¸æ¯”å›½å†…å‚å•†çš„é»‘æ´ï¼Œå¯¹ç”¨æˆ·æ›´å‹å¥½ï¼Œæ›´ä¸ç”¨è¯´å¤§è©è¨ cloudflare äº†ï¼›&lt;/li&gt;
&lt;li&gt;é˜¿é‡Œã€è…¾è®¯ã€åä¸ºç­‰ï¼Œå¯æ‰¾å®¢æˆ·ç»ç†ï¼ˆTAMã€BPï¼‰ ç›´æ¥è¦æ±‚ä¸´æ—¶ï¼ˆå…è´¹ï¼‰æ‹‰é«˜åŸç”Ÿé˜²æŠ¤é˜ˆå€¼ï¼›&lt;/li&gt;
&lt;li&gt;æŠ—Däº§å“æˆæœ¬å¤ªé«˜ï¼Œä¸å¦‚ä¸“æ³¨é™çº§ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯é¢„åŸ‹å‡ ä¸ªå…¨é“¾è·¯åŠ é€ŸæœåŠ¡çš„ SDKï¼Œä¸šåŠ¡æ”¹é€ æˆæœ¬ä½ï¼Œç”¨ä½œç´§æ€¥æƒ…å†µé™çº§ï¼Œè¿™ç±»äº§å“ä¹Ÿæœ‰æŒ‰é‡ä»˜è´¹ï¼Œç›¸æ¯”ä¹°æŠ— Dï¼Œæˆæœ¬æ›´ä½ï¼›&lt;/li&gt;
&lt;li&gt;çœŸå†³å®šè¦é‡‡è´­DDoSäº§å“ï¼Œå¯¹æŠ˜å†å¯¹æŠ˜ï¼Œå¤§åˆ€ç ï¼Œè¿™ç±»äº§å“å‚å•†åˆ©æ¶¦ç‡è´¼é«˜ï¼›&lt;/li&gt;
&lt;/ol&gt;</content><category term="2023"></category><category term="ddos"></category></entry><entry><title>éƒ¨åˆ†æœç´¢å¼•æ“çˆ¬è™«IP</title><link href="https://fangpsh.github.io/posts/2023/2023-11-10.html" rel="alternate"></link><published>2023-11-10T00:00:00+08:00</published><updated>2023-11-10T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-11-10:/posts/2023/2023-11-10.html</id><summary type="html">&lt;p&gt;æœ‰ä¸ªå°é¡¹ç›®å¥—äº†ä¸€ä¸ª&lt;a href="https://waf-ce.chaitin.cn/"&gt;é›·æ± WAF&lt;/a&gt;ï¼Œæ‹…å¿ƒä¼šå½±å“åˆ°æœç´¢å¼•æ“çš„çˆ¬è™«ï¼Œéœ€è¦å•ç‹¬ç»´æŠ¤ä¸€ä¸ªIPç»„ï¼Œç¤¾åŒºå…³è”issueï¼š&lt;a href="https://github.com/chaitin/SafeLine/issues/374"&gt;[å»ºè®®] å†…ç½®å„å¤§æœç´¢å¼•æ“èœ˜ â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;æœ‰ä¸ªå°é¡¹ç›®å¥—äº†ä¸€ä¸ª&lt;a href="https://waf-ce.chaitin.cn/"&gt;é›·æ± WAF&lt;/a&gt;ï¼Œæ‹…å¿ƒä¼šå½±å“åˆ°æœç´¢å¼•æ“çš„çˆ¬è™«ï¼Œéœ€è¦å•ç‹¬ç»´æŠ¤ä¸€ä¸ªIPç»„ï¼Œç¤¾åŒºå…³è”issueï¼š&lt;a href="https://github.com/chaitin/SafeLine/issues/374"&gt;[å»ºè®®] å†…ç½®å„å¤§æœç´¢å¼•æ“èœ˜è››çˆ¬è™«çš„ IP åº“ #374&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;360èœ˜è››IPæ®µ&lt;/h2&gt;
&lt;p&gt;æ¥æºï¼šhttps://www.so.com/help/spider_ip.html&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;180.153.232.0/24
180.153.234.0/24
180.153.236.0/24
180.163.220.0/24
42.236.101.0/24
42.236.102.0/24
42.236.103.0/24
42.236.10.0/24
42.236.12.0/24
42.236.13.0/24
42.236.14.0/24
42.236.15.0/24
42.236.16.0/24
42.236.17.0/24
42.236.46.0/24
42.236.48.0/24
42.236.49.0/24
42.236.50.0/24
42.236.51.0/24
42.236.52.0/24
42.236.53.0/24
42.236.54.0/24
42.236.55.0/24
42.236.99.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Googleæ®µ&lt;/h2&gt;
&lt;p&gt;æ¥æºï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;https://developers.google.com/search/apis/ipranges/googlebot.json&lt;/li&gt;
&lt;li&gt;https://www.gstatic.com/ipranges/goog.json&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;104.154.0.0/15
104.196.0.0/14
104.237.160.0/19
107.167.160.0/19
107.178.192.0/18
108.170.192.0/18
108.177.0.0/17
108.59.80.0/20
130.211.0.0/16
142.250.0.0/15
146.148.0.0/17
162.216.148.0/22
162.222.176.0/21
172.110.32.0/21
172.217.0.0/16
172.253.0.0/16
173.194.0.0/16
173.255.112.0/20
192.158.28.0/22
192.178.0.0/15
192.178.5.0/27
193.186.4.0/24
199.192.112.0/22
199.223.232.0/21
199.36.154.0/23
199.36.156.0/24
207.223.160.0/20
208.117.224.0/19
208.65.152.0/22
208.68.108.0/22
208.81.188.0/22
209.85.128.0/17
216.239.32.0/19
216.58.192.0/19
216.73.80.0/20
23.236.48.0/20
23.251.128.0/19
34.0.0.0/15
34.100.182.96/28
34.101.50.144/28
34.118.254.0/28
34.118.66.0/28
34.126.178.96/28
34.128.0.0/10
34.146.150.144/28
34.147.110.144/28
34.151.74.144/28
34.152.50.64/28
34.154.114.144/28
34.155.98.32/28
34.16.0.0/12
34.165.18.176/28
34.175.160.64/28
34.176.130.16/28
34.2.0.0/16
34.22.85.0/27
34.3.0.0/23
34.3.128.0/17
34.3.16.0/20
34.3.3.0/24
34.3.32.0/19
34.3.4.0/24
34.3.64.0/18
34.3.8.0/21
34.32.0.0/11
34.4.0.0/14
34.64.0.0/10
34.64.82.64/28
34.65.242.112/28
34.8.0.0/13
34.80.50.80/28
34.88.194.0/28
34.89.10.80/28
34.89.198.80/28
34.96.162.48/28
35.184.0.0/13
35.192.0.0/14
35.196.0.0/15
35.198.0.0/16
35.199.0.0/17
35.199.128.0/18
35.200.0.0/13
35.208.0.0/12
35.224.0.0/12
35.240.0.0/13
35.247.243.240/28
64.15.112.0/20
64.233.160.0/19
66.102.0.0/20
66.22.228.0/23
66.249.64.0/19
66.249.64.0/27
66.249.64.128/27
66.249.64.160/27
66.249.64.192/27
66.249.64.224/27
66.249.64.32/27
66.249.64.64/27
66.249.64.96/27
66.249.65.0/27
66.249.65.160/27
66.249.65.192/27
66.249.65.224/27
66.249.65.32/27
66.249.65.64/27
66.249.65.96/27
66.249.66.0/27
66.249.66.128/27
66.249.66.160/27
66.249.66.192/27
66.249.66.32/27
66.249.66.64/27
66.249.66.96/27
66.249.68.0/27
66.249.68.32/27
66.249.68.64/27
66.249.69.0/27
66.249.69.128/27
66.249.69.160/27
66.249.69.192/27
66.249.69.224/27
66.249.69.32/27
66.249.69.64/27
66.249.69.96/27
66.249.70.0/27
66.249.70.128/27
66.249.70.160/27
66.249.70.192/27
66.249.70.224/27
66.249.70.32/27
66.249.70.64/27
66.249.70.96/27
66.249.71.0/27
66.249.71.128/27
66.249.71.160/27
66.249.71.192/27
66.249.71.224/27
66.249.71.32/27
66.249.71.64/27
66.249.71.96/27
66.249.72.0/27
66.249.72.128/27
66.249.72.160/27
66.249.72.192/27
66.249.72.224/27
66.249.72.32/27
66.249.72.64/27
66.249.72.96/27
66.249.73.0/27
66.249.73.128/27
66.249.73.160/27
66.249.73.192/27
66.249.73.224/27
66.249.73.32/27
66.249.73.64/27
66.249.73.96/27
66.249.74.0/27
66.249.74.128/27
66.249.74.32/27
66.249.74.64/27
66.249.74.96/27
66.249.75.0/27
66.249.75.128/27
66.249.75.160/27
66.249.75.192/27
66.249.75.224/27
66.249.75.32/27
66.249.75.64/27
66.249.75.96/27
66.249.76.0/27
66.249.76.128/27
66.249.76.160/27
66.249.76.192/27
66.249.76.224/27
66.249.76.32/27
66.249.76.64/27
66.249.76.96/27
66.249.77.0/27
66.249.77.128/27
66.249.77.160/27
66.249.77.192/27
66.249.77.224/27
66.249.77.32/27
66.249.77.64/27
66.249.77.96/27
66.249.78.0/27
66.249.78.32/27
66.249.79.0/27
66.249.79.128/27
66.249.79.160/27
66.249.79.192/27
66.249.79.224/27
66.249.79.32/27
66.249.79.64/27
66.249.79.96/27
70.32.128.0/19
72.14.192.0/18
74.125.0.0/16
8.34.208.0/20
8.35.192.0/20
8.8.4.0/24
8.8.8.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ç™¾åº¦&lt;/h2&gt;
&lt;p&gt;ä»&lt;a href="https://www.pdflibr.com/crawler/baidu-bot"&gt;å„ä¸ªç½‘ç«™å¸–å­&lt;/a&gt;ä¸­ï¼Œæ‰¾åˆ°ä¼ è¯´ä¸­çš„ç™¾åº¦èœ˜è››çˆ¬è™«æ®µï¼Œæ•´ç†å»é‡åï¼Œä½¿ç”¨&lt;code&gt;host {ip}&lt;/code&gt; åå‘æŸ¥è¯¢PTRè®°å½•ï¼Œç•™ä¸‹æœ‰æ˜ç¡®æŒ‡æ˜æ˜¯ç™¾åº¦çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;host 220.181.108.75
75.108.181.220.IN-ADDR.ARPA domain name pointer baiduspider-220-181-108-75.crawl.baidu.com.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;116.179.32.103
116.179.32.107
116.179.32.12
116.179.32.134
116.179.32.149
116.179.32.152
116.179.32.162
116.179.32.17
116.179.32.18
116.179.32.218
116.179.32.241
116.179.32.39
116.179.32.99
116.179.37.122
116.179.37.173
116.179.37.202
116.179.37.225
116.179.37.242
116.179.37.36
116.179.37.44
116.179.37.79
116.179.37.84
116.179.37.99
119.63.198.104
119.63.198.69
119.63.198.85
123.125.71.102
123.125.71.106
123.125.71.111
123.125.71.21
123.125.71.24
123.125.71.26
123.125.71.30
123.125.71.33
123.125.71.36
123.125.71.38
123.125.71.40
123.125.71.45
123.125.71.48
123.125.71.52
123.125.71.73
123.125.71.74
123.125.71.75
123.125.71.77
123.125.71.90
123.125.71.96
123.125.71.97
123.125.71.98
220.181.108.100
220.181.108.102
220.181.108.107
220.181.108.108
220.181.108.109
220.181.108.110
220.181.108.111
220.181.108.112
220.181.108.142
220.181.108.144
220.181.108.146
220.181.108.147
220.181.108.156
220.181.108.162
220.181.108.168
220.181.108.178
220.181.108.179
220.181.108.183
220.181.108.184
220.181.108.81
220.181.108.93
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;å¾®è½¯Bing&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;13.66.139.0
13.66.139.102
13.66.139.128
13.66.139.43
13.66.139.79
13.66.139.83
13.66.139.98
131.253.24.10
131.253.24.2
131.253.24.7
157.55.116.65
157.55.116.71
157.55.116.79
157.55.116.82
157.55.36.139
157.55.39.111
157.55.39.125
157.55.39.129
157.55.39.136
157.55.39.149
157.55.39.150
157.55.39.166
157.55.39.172
157.55.39.176
157.55.39.198
157.55.39.201
157.55.39.202
157.55.39.205
157.55.39.219
157.55.39.227
157.55.39.237
157.55.39.245
157.55.39.28
157.55.39.32
157.55.39.39
157.55.39.43
157.55.39.5
157.55.39.51
157.55.39.58
157.55.39.60
157.55.39.7
157.55.39.81
157.55.39.82
157.55.39.86
157.55.39.9
157.55.39.98
157.56.0.190
157.56.0.207
157.56.1.64
157.56.2.60
157.56.2.63
157.56.4.187
157.56.5.147
157.56.92.147
199.30.16.12
199.30.16.16
199.30.16.189
199.30.16.42
199.30.20.128
199.30.20.201
199.30.20.44
199.30.20.67
199.30.26.160
199.30.28.137
207.46.13.102
207.46.13.104
207.46.13.107
207.46.13.111
207.46.13.114
207.46.13.115
207.46.13.12
207.46.13.129
207.46.13.134
207.46.13.141
207.46.13.147
207.46.13.149
207.46.13.154
207.46.13.168
207.46.13.177
207.46.13.215
207.46.13.217
207.46.13.218
207.46.13.228
207.46.13.236
207.46.13.237
207.46.13.249
207.46.13.250
207.46.13.3
207.46.13.36
207.46.13.4
207.46.13.40
207.46.13.51
207.46.13.54
207.46.13.62
207.46.13.64
207.46.13.69
207.46.13.77
207.46.13.79
207.46.13.83
207.46.13.91
207.46.13.93
207.46.193.69
207.46.193.73
207.46.193.75
207.46.193.77
207.46.193.89
207.46.193.94
207.46.195.116
207.46.195.117
207.46.195.118
40.77.167.116
40.77.167.126
40.77.167.20
40.77.167.211
40.77.167.241
40.77.167.247
40.77.167.26
40.77.167.30
40.77.167.45
40.77.167.64
40.77.188.101
40.77.188.241
40.77.189.16
40.77.189.178
40.77.189.234
40.77.189.249
40.77.190.104
40.77.190.158
40.77.190.55
40.77.190.70
65.52.104.213
65.52.104.214
65.52.104.215
65.52.104.216
65.55.208.114
65.55.208.118
65.55.208.147
65.55.208.16
65.55.208.196
65.55.208.210
65.55.208.88
65.55.209.1
65.55.209.197
65.55.209.198
65.55.209.199
65.55.209.200
65.55.209.201
65.55.209.202
65.55.209.203
65.55.209.204
65.55.209.205
65.55.210.247
65.55.210.45
65.55.211.194
65.55.212.97
65.55.213.193
65.55.213.241
65.55.213.243
65.55.213.244
65.55.213.245
65.55.213.7
65.55.214.149
65.55.215.111
65.55.215.212
65.55.215.213
65.55.215.67
65.55.219.178
65.55.219.91
65.55.3.170
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä»–æ›´å¤šæœç´¢å¼•æ“ï¼ˆé›…è™ã€æœç‹—ç­‰ï¼‰å¯ä»¥å‚è€ƒï¼šhttps://www.pdflibr.com/crawler/list/search-engine  &lt;/p&gt;
&lt;p&gt;è‡ªå·±å†è°ƒç”¨&lt;code&gt;host&lt;/code&gt; äºŒæ¬¡ç¡®è®¤ä¸‹å³å¯ï¼Œè¿™ä¸ªç½‘ç«™è¿˜æ˜¯æŒºå‡†çš„ã€‚ä¸Šçº¿ä¸€ä¸ªæœˆï¼Œè¿è¥äººå‘˜è¯´SEOæ²¡å¼‚å¸¸ã€‚&lt;/p&gt;</content><category term="2023"></category><category term="waf"></category><category term="seo"></category></entry><entry><title>æºç«™IP ACLç»•è¿‡çš„é£é™©</title><link href="https://fangpsh.github.io/posts/2023/2023-10-02.html" rel="alternate"></link><published>2023-10-02T00:00:00+08:00</published><updated>2023-10-02T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-10-02:/posts/2023/2023-10-02.html</id><summary type="html">&lt;p&gt;å¥—ä¸ŠCDN ä¹‹åï¼ŒCDNå‚å•†ä¸€èˆ¬ä¼šåœ¨å›æºæ—¶ï¼Œå°†çœŸå®çš„å®¢æˆ·ç«¯åœ°å€å†™å…¥header ä¸­ï¼Œä¾‹å¦‚cloudflare æ˜¯&lt;a href="https://developers.cloudflare.com/fundamentals/reference/http-request-headers/#cf-connecting-ip"&gt;CF-Connecting-IP&lt;/a&gt;ï¼Œé˜¿é‡Œäº‘æ˜¯&lt;a href="https://help.aliyun.com/zh/cdn/user-guide/configure-custom-request-headers"&gt;Ali-Cdn-Real-Ip&lt;/a&gt;ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»X-Forwarded-For ä¸­å–ã€‚å¦å¤–7å±‚çš„è´Ÿè½½å‡è¡¡æœåŠ¡åœ¨è½¬å‘æ—¶ï¼Œä¹Ÿä¼šæºå¸¦æ­¤ç±»headerã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å¥—ä¸ŠCDN ä¹‹åï¼ŒCDNå‚å•†ä¸€èˆ¬ä¼šåœ¨å›æºæ—¶ï¼Œå°†çœŸå®çš„å®¢æˆ·ç«¯åœ°å€å†™å…¥header ä¸­ï¼Œä¾‹å¦‚cloudflare æ˜¯&lt;a href="https://developers.cloudflare.com/fundamentals/reference/http-request-headers/#cf-connecting-ip"&gt;CF-Connecting-IP&lt;/a&gt;ï¼Œé˜¿é‡Œäº‘æ˜¯&lt;a href="https://help.aliyun.com/zh/cdn/user-guide/configure-custom-request-headers"&gt;Ali-Cdn-Real-Ip&lt;/a&gt;ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä»X-Forwarded-For ä¸­å–ã€‚å¦å¤–7å±‚çš„è´Ÿè½½å‡è¡¡æœåŠ¡åœ¨è½¬å‘æ—¶ï¼Œä¹Ÿä¼šæºå¸¦æ­¤ç±»headerã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæºç«™æ˜¯æŒ‰ç…§æ­¤ç±»header è¿›è¡ŒACL åˆ¤å®šçš„è¯ï¼Œå®¹æ˜“è¢«ç¯¡æ”¹ç»•è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ”»å‡»è€…å…ˆç”¨censys è¿‡æ»¤è¯ä¹¦ä¿¡æ¯ï¼Œæ‰¾å¯»åˆ°å¯èƒ½çš„æºç«™ã€‚&lt;/li&gt;
&lt;li&gt;æŒ‰ç…§ç›®æ ‡ç«™ç‚¹cname æŒ‡å‘çš„åŸŸåæ‰¾å‡ºå¯¹åº”çš„CDNå‚å•†ï¼Œæ‰¾åˆ°å¯¹åº”çš„header å¤´ï¼›&lt;/li&gt;
&lt;li&gt;ä¼ªé€ header å¤´å¯¹æºç«™å‘èµ·æ¢æµ‹ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ€ä¿é™©çš„æ˜¯åœ¨æºç«™é…ç½®é˜²ç«å¢™æˆ–ACLï¼Œåªè®©CDNå‚å•†çš„å›æºæœåŠ¡å™¨æ®µè®¿é—®ï¼Œå‚è€ƒ&lt;a href="https://developers.cloudflare.com/fundamentals/setup/allow-cloudflare-ip-addresses/"&gt;Allow Cloudflare IP addresses&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼ŒNGINX 1.19.4 æœ‰ä¸ªæ–°ç‰¹æ€§ &lt;a href="http://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_reject_handshake"&gt;ssl_reject_handshake on;&lt;/a&gt;ï¼Œå¼€å¯åï¼ŒIP è®¿é—®æ—¶ä¼šç»ˆæ­¢ TLS æ¡æ‰‹ï¼Œé™ä½è¯ä¹¦æš´éœ²çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¥½æ–‡æ¨èï¼š&lt;a href="https://tech-blog.cymetrics.io/posts/seadog007/dangers-in-cdn/"&gt;é‚£äº›éš±è—åœ¨ CDN ä¸­çš„å±éšªï¼šç‚ºä»€éº¼ CDN å¯èƒ½æ²’æœ‰ä½ æƒ³çš„é‚£éº¼å®‰å…¨&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åŒæ ·çš„é£é™©ï¼Œä¹Ÿå­˜åœ¨ä¸&lt;a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/using-proxy-protocol/"&gt;ProxyProtocol&lt;/a&gt;åè®®ï¼Œä»¥åŠ&lt;a href="https://developer.aliyun.com/article/849252"&gt;TOA&lt;/a&gt;ç­‰æ‰©å±•åè®®ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç±»åè®®ï¼Œå¤§å¤šæ•°éƒ½è¿è¡Œä¸å†…ç½‘ä¹‹ä¸­ã€‚å¦‚æœä½ çš„Nginx åœ¨å…¬ç½‘æ¥æ”¶ä¸€ä¸ªå›ºå®šæ¥æºçš„ProxyProtocolï¼Œè¯·åŠ¡å¿…å¼€å¯ç½‘ç»œå±‚IPç™½åå•ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–çœ‹äº§å“ä»‹ç»ï¼Œé˜¿é‡Œäº‘çš„å…¨ç«™åŠ é€ŸDCDNã€ä»¥åŠ&lt;a href="https://help.aliyun.com/document_detail/52477.html"&gt;DDoSé«˜é˜²&lt;/a&gt; ï¼Œè…¾è®¯&lt;a href="https://cloud.tencent.com/document/product/297/94816"&gt;DDoSé˜²æŠ¤&lt;/a&gt;å‡æ”¯æŒäº†TOAï¼ŒTOAæœ¬èº«å¹¶æ— ç­¾åæœºåˆ¶ï¼Œæ‰€ä»¥å¦‚æœä½ ä¾èµ– TOA ä¼ é€’çš„åœ°å€åš ACLï¼Œä¹Ÿéœ€è¦å°½å¯èƒ½å¼€å¯ç½‘ç»œå±‚ç™½åå•ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒé¡¹ç›®ï¼š&lt;a href="https://github.com/passwa11/FakeToa/tree/master"&gt;BeichenDream/FakeToa&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œä½ å¯èƒ½ä¼šé—®ï¼Œåœ°å€ç©ºé—´é‚£ä¹ˆå¤§ï¼Œæ”»å‡»è€…å¦‚ä½•èƒ½çŒœæµ‹å‡ºæˆ‘çš„æ¥æºåœ°å€ç™½åå•ã€‚&lt;/p&gt;
&lt;p&gt;è¯•æƒ³ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬åœ¨å†™ACL çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯éƒ½å–œæ¬¢æŠŠä¿ç•™åœ°å€æ®µå’Œå›ç¯åœ°å€å†™å…¥ï¼›&lt;/li&gt;
&lt;li&gt;æŸäº›æœºæ„å‡ºå£ç™½åå•å¹¶æ²¡é‚£ä¹ˆéšç§˜ï¼Œä¾‹å¦‚é€šè¿‡åœ°å€åº“æˆ–è€…å…³è”ä¸»ä½“çš„ASNå·æ”¶é›†ï¼Œæˆ–å…¶ä»–èµ„äº§æ”¶é›†æ–¹å¼ï¼›&lt;/li&gt;
&lt;/ol&gt;</content><category term="2023"></category><category term="hack"></category></entry><entry><title>lvmcacheæ€§èƒ½ç®€å•æµ‹è¯•</title><link href="https://fangpsh.github.io/posts/2023/2023-09-27.html" rel="alternate"></link><published>2023-09-27T00:00:00+08:00</published><updated>2023-09-27T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-09-27:/posts/2023/2023-09-27.html</id><summary type="html">&lt;p&gt;æµ‹è¯•å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=fiotest --filename=testfio --bs=4k --iodepth=64 --size=8G --readwrite=randrw --rwmixread=75
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•°æ®ç»å¯¹å€¼ä¸å…·å¤‡å‚è€ƒä»·å€¼ï¼Œä»…ä¾›å¨±ä¹ï¼Œä¸€äº›ç»“è®ºåœ¨æœ«å°¾ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æµ‹è¯•å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fio --randrepeat=1 --ioengine=libaio --direct=1 --gtod_reduce=1 --name=fiotest --filename=testfio --bs=4k --iodepth=64 --size=8G --readwrite=randrw --rwmixread=75
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•°æ®ç»å¯¹å€¼ä¸å…·å¤‡å‚è€ƒä»·å€¼ï¼Œä»…ä¾›å¨±ä¹ï¼Œä¸€äº›ç»“è®ºåœ¨æœ«å°¾ã€‚&lt;/p&gt;
&lt;h3&gt;HDD&lt;/h3&gt;
&lt;p&gt;3å—7200è½¬HDDç»„çš„RAID5ï¼Œå¡æ˜¯H730ã€‚&lt;/p&gt;
&lt;p&gt;read: IOPS=799, BW=3198KiB/s (3274kB/s)(259MiB/82977msec)&lt;br&gt;
  write: IOPS=265, BW=1061KiB/s (1087kB/s)(86.0MiB/82977msec)     &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Jobs: 1 (f=1): [m(1)][3.8%][r=2598KiB/s,w=856KiB/s][r=649,w=214 IOPS][eta 31m:04s]
fiotest: Laying out IO file (1 file / 8192MiB)
^Cbs: 1 (f=1): [m(1)][4.2%][r=2660KiB/s,w=924KiB/s][r=665,w=231 IOPS][eta 31m:24s]
fio: terminating on signal 2
Jobs: 1 (f=1): [m(1)][4.2%][r=2614KiB/s,w=776KiB/s][r=653,w=194 IOPS][eta 31m:28s]
fiotest: (groupid=0, jobs=1): err= 0: pid=33271: Wed Jul 12 19:44:23 2023
   read: IOPS=799, BW=3198KiB/s (3274kB/s)(259MiB/82977msec)
   bw (  KiB/s): min= 1136, max= 5904, per=100.00%, avg=3200.67, stdev=1344.41, samples=165
   iops        : min=  284, max= 1476, avg=800.12, stdev=336.10, samples=165
  write: IOPS=265, BW=1061KiB/s (1087kB/s)(86.0MiB/82977msec)
   bw (  KiB/s): min=  296, max= 2184, per=100.00%, avg=1064.34, stdev=460.66, samples=165
   iops        : min=   74, max=  546, avg=266.03, stdev=115.20, samples=165
  cpu          : usr=1.08%, sys=3.63%, ctx=81548, majf=0, minf=471
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=99.9%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=66332,22020,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64
Run status group 0 (all jobs):
   READ: bw=3198KiB/s (3274kB/s), 3198KiB/s-3198KiB/s (3274kB/s-3274kB/s), io=259MiB (272MB), run=82977-82977msec
  WRITE: bw=1061KiB/s (1087kB/s), 1061KiB/s-1061KiB/s (1087kB/s-1087kB/s), io=86.0MiB (90.2MB), run=82977-82977msec
Disk stats (read/write):
    dm-0: ios=66332/22040, merge=0/0, ticks=5244735/48626, in_queue=5298771, util=99.95%, aggrios=66332/22039, aggrmerge=0/5, aggrticks=5251175/48560, aggrin_queue=5299680, aggrutil=99.92%
  sda: ios=66332/22039, merge=0/5, ticks=5251175/48560, in_queue=5299680, util=99.92%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;900G  ä¸‰æ˜ŸSSD&lt;/h3&gt;
&lt;p&gt;read: IOPS=20.9k, BW=81.7MiB/s (85.6MB/s)(972MiB/11896msec)&lt;br&gt;
   write: IOPS=6988, BW=27.3MiB/s (28.6MB/s)(325MiB/11896msec)  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fiotest: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=64
fio-3.7
Starting 1 process
^Cbs: 1 (f=1): [m(1)][16.0%][r=75.0MiB/s,w=24.6MiB/s][r=19.2k,w=6305 IOPS][eta 01m:03s]
fio: terminating on signal 2

fiotest: (groupid=0, jobs=1): err= 0: pid=33739: Wed Jul 12 19:54:38 2023
   read: IOPS=20.9k, BW=81.7MiB/s (85.6MB/s)(972MiB/11896msec)
   bw (  KiB/s): min=37812, max=228392, per=100.00%, avg=83671.26, stdev=37193.76, samples=23
   iops        : min= 9453, max=57098, avg=20917.78, stdev=9298.43, samples=23
  write: IOPS=6988, BW=27.3MiB/s (28.6MB/s)(325MiB/11896msec)
   bw (  KiB/s): min=12742, max=76160, per=100.00%, avg=27995.91, stdev=12419.04, samples=23
   iops        : min= 3185, max=19040, avg=6998.96, stdev=3104.79, samples=23
  cpu          : usr=9.49%, sys=43.70%, ctx=12196, majf=0, minf=621
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=248744,83135,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=81.7MiB/s (85.6MB/s), 81.7MiB/s-81.7MiB/s (85.6MB/s-85.6MB/s), io=972MiB (1019MB), run=11896-11896msec
  WRITE: bw=27.3MiB/s (28.6MB/s), 27.3MiB/s-27.3MiB/s (28.6MB/s-28.6MB/s), io=325MiB (341MB), run=11896-11896msec

Disk stats (read/write):
    dm-0: ios=248608/83097, merge=0/0, ticks=394513/131551, in_queue=526846, util=99.13%, aggrios=102971/47765, aggrmerge=0/0, aggrticks=199210/108608, aggrin_queue=308689, aggrutil=99.19%
    dm-1: ios=308914/83135, merge=0/0, ticks=597630/123595, in_queue=722465, util=99.19%, aggrios=268795/83135, aggrmerge=40117/0, aggrticks=459858/123656, aggrin_queue=583529, aggrutil=99.12%
  sdb: ios=268795/83135, merge=40117/0, ticks=459858/123656, in_queue=583529, util=99.12%
  dm-2: ios=0/0, merge=0/0, ticks=0/0, in_queue=0, util=0.00%
    dm-3: ios=0/60162, merge=0/0, ticks=0/202230, in_queue=203603, util=78.29%, aggrios=0/20043, aggrmerge=0/40108, aggrticks=0/64418, aggrin_queue=65072, aggrutil=78.16%
  sda: ios=0/20043, merge=0/40108, ticks=0/64418, in_queue=65072, util=78.16%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;240G SSD&lt;/h3&gt;
&lt;p&gt;ç¬”è®°æœ¬æ‹†æœºsata ssdï¼Œå¿˜è®°å‹å·äº†ã€‚&lt;/p&gt;
&lt;p&gt;read: IOPS=4783, BW=18.7MiB/s (19.6MB/s)(2155MiB/115315msec)&lt;br&gt;
   write: IOPS=1601, BW=6406KiB/s (6559kB/s)(721MiB/115315msec)  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fiotest: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=64
fio-3.7
Starting 1 process
fiotest: Laying out IO file (1 file / 8192MiB)
^Cbs: 1 (f=1): [m(1)][35.3%][r=17.3MiB/s,w=5788KiB/s][r=4432,w=1447 IOPS][eta 03m:33s]
fio: terminating on signal 2

fiotest: (groupid=0, jobs=1): err= 0: pid=42122: Thu Jul 13 11:38:30 2023
   read: IOPS=4783, BW=18.7MiB/s (19.6MB/s)(2155MiB/115315msec)
   bw (  KiB/s): min= 1248, max=53032, per=99.99%, avg=19133.55, stdev=14855.41, samples=230
   iops        : min=  312, max=13258, avg=4783.33, stdev=3713.85, samples=230
  write: IOPS=1601, BW=6406KiB/s (6559kB/s)(721MiB/115315msec)
   bw (  KiB/s): min=  224, max=18216, per=99.98%, avg=6403.90, stdev=5020.15, samples=230
   iops        : min=   56, max= 4554, avg=1600.93, stdev=1255.04, samples=230
  cpu          : usr=2.83%, sys=11.27%, ctx=129066, majf=0, minf=767
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=551663,184667,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=18.7MiB/s (19.6MB/s), 18.7MiB/s-18.7MiB/s (19.6MB/s-19.6MB/s), io=2155MiB (2260MB), run=115315-115315msec
  WRITE: bw=6406KiB/s (6559kB/s), 6406KiB/s-6406KiB/s (6559kB/s-6559kB/s), io=721MiB (756MB), run=115315-115315msec

Disk stats (read/write):
    dm-0: ios=551623/184671, merge=0/0, ticks=5374110/1917689, in_queue=7304893, util=100.00%, aggrios=238513/116210, aggrmerge=0/0, aggrticks=3435302/2513779, aggrin_queue=5955870, aggrutil=99.65%
    dm-1: ios=659752/228622, merge=0/0, ticks=6014019/7467533, in_queue=13501921, util=99.65%, aggrios=571964/193540, aggrmerge=87781/35177, aggrticks=5206035/3300917, aggrin_queue=8507150, aggrutil=99.63%
  sdb: ios=571964/193540, merge=87781/35177, ticks=5206035/3300917, in_queue=8507150, util=99.63%
  dm-2: ios=0/97, merge=0/0, ticks=0/12583, in_queue=12583, util=3.20%
    dm-3: ios=55787/119912, merge=0/0, ticks=4291889/61221, in_queue=4353107, util=50.01%, aggrios=20645/32180, aggrmerge=35142/87732, aggrticks=1399374/15630, aggrin_queue=1414952, aggrutil=49.93%
  sda: ios=20645/32180, merge=35142/87732, ticks=1399374/15630, in_queue=1414952, util=49.93%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;128G SSD&lt;/h3&gt;
&lt;p&gt;ç¬”è®°æœ¬æ‹†æœºsata ssdã€‚&lt;/p&gt;
&lt;p&gt;read: IOPS=4714, BW=18.4MiB/s (19.3MB/s)(2494MiB/135421msec)&lt;br&gt;
   write: IOPS=1579, BW=6319KiB/s (6470kB/s)(836MiB/135421msec  &lt;/p&gt;
&lt;p&gt;read: IOPS=4805, BW=18.8MiB/s (19.7MB/s)(6141MiB/327175msec&lt;br&gt;
   write: IOPS=1604, BW=6419KiB/s (6573kB/s)(2051MiB/327175msec  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fiotest: Laying out IO file (1 file / 8192MiB)
Jobs: 1 (f=1): [m(1)][100.0%][r=23.2MiB/s,w=7975KiB/s][r=5948,w=1993 IOPS][eta 00m:00s]
fiotest: (groupid=0, jobs=1): err= 0: pid=57813: Thu Jul 13 11:58:49 2023
   read: IOPS=4805, BW=18.8MiB/s (19.7MB/s)(6141MiB/327175msec)
   bw (  KiB/s): min= 6248, max=48080, per=99.93%, avg=19205.78, stdev=12598.96, samples=654
   iops        : min= 1562, max=12020, avg=4801.42, stdev=3149.73, samples=654
  write: IOPS=1604, BW=6419KiB/s (6573kB/s)(2051MiB/327175msec)
   bw (  KiB/s): min= 1976, max=16280, per=99.93%, avg=6413.59, stdev=4223.81, samples=654
   iops        : min=  494, max= 4070, avg=1603.38, stdev=1055.95, samples=654
  cpu          : usr=3.06%, sys=12.80%, ctx=661831, majf=0, minf=1063
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=1572145,525007,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=18.8MiB/s (19.7MB/s), 18.8MiB/s-18.8MiB/s (19.7MB/s-19.7MB/s), io=6141MiB (6440MB), run=327175-327175msec
  WRITE: bw=6419KiB/s (6573kB/s), 6419KiB/s-6419KiB/s (6573kB/s-6573kB/s), io=2051MiB (2150MB), run=327175-327175msec

Disk stats (read/write):
    dm-0: ios=1569860/524263, merge=0/0, ticks=15852577/4869021, in_queue=20730282, util=100.00%, aggrios=601264/252260, aggrmerge=0/0, aggrticks=7045989/1734373, aggrin_queue=8781558, aggrutil=99.39%
    dm-1: ios=1773240/544227, merge=0/0, ticks=18694929/5185817, in_queue=23884327, util=99.39%, aggrios=1664287/532332, aggrmerge=108953/11972, aggrticks=16974042/4996891, aggrin_queue=21970715, aggrutil=99.39%
  sdb: ios=1664287/532332, merge=108953/11972, ticks=16974042/4996891, in_queue=21970715, util=99.39%
  dm-2: ios=0/79, merge=0/0, ticks=0/419, in_queue=419, util=0.04%
    dm-3: ios=30553/212475, merge=0/0, ticks=2443039/16883, in_queue=2459928, util=10.99%, aggrios=19527/107630, aggrmerge=11026/104845, aggrticks=1467981/9068, aggrin_queue=1476936, aggrutil=10.87%
  sda: ios=19527/107630, merge=11026/104845, ticks=1467981/9068, in_queue=1476936, util=10.87%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;890G Intel SSD&lt;/h3&gt;
&lt;p&gt;ä¼ä¸šçº§intel sata ssd&lt;/p&gt;
&lt;p&gt;read: IOPS=19.5k, BW=76.3MiB/s (80.0MB/s)(2778MiB/36395msec)&lt;br&gt;
   write: IOPS=6536, BW=25.5MiB/s (26.8MB/s)(929MiB/36395msec  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Starting 1 process
fiotest: Laying out IO file (1 file / 8192MiB)
^Cbs: 1 (f=1): [m(1)][46.2%][r=15.1MiB/s,w=5005KiB/s][r=3871,w=1251 IOPS][eta 00m:43s] 00m:47s]
fio: terminating on signal 2

fiotest: (groupid=0, jobs=1): err= 0: pid=20853: Wed Jul 19 11:42:14 2023
   read: IOPS=19.5k, BW=76.3MiB/s (80.0MB/s)(2778MiB/36395msec)
   bw (  KiB/s): min=12072, max=135128, per=100.00%, avg=78829.97, stdev=32979.49, samples=72
   iops        : min= 3018, max=33782, avg=19707.47, stdev=8244.85, samples=72
  write: IOPS=6536, BW=25.5MiB/s (26.8MB/s)(929MiB/36395msec)
   bw (  KiB/s): min= 3816, max=45560, per=100.00%, avg=26372.75, stdev=11117.47, samples=72
   iops        : min=  954, max=11390, avg=6593.17, stdev=2779.35, samples=72
  cpu          : usr=9.61%, sys=45.24%, ctx=52541, majf=0, minf=313
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=711127,237910,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=76.3MiB/s (80.0MB/s), 76.3MiB/s-76.3MiB/s (80.0MB/s-80.0MB/s), io=2778MiB (2913MB), run=36395-36395msec
  WRITE: bw=25.5MiB/s (26.8MB/s), 25.5MiB/s-25.5MiB/s (26.8MB/s-26.8MB/s), io=929MiB (974MB), run=36395-36395msec

Disk stats (read/write):
    dm-3: ios=711127/237928, merge=0/0, ticks=1039387/303713, in_queue=1343100, util=99.76%, aggrios=241532/83797, aggrmerge=0/0, aggrticks=391189/204710, aggrin_queue=595900, aggrutil=99.24%
    dm-1: ios=1/9, merge=0/0, ticks=2/9, in_queue=11, util=0.02%, aggrios=736859/238847, aggrmerge=7/6, aggrticks=1295458/300504, aggrin_queue=1361540, aggrutil=99.42%
  sda: ios=736859/238847, merge=7/6, ticks=1295458/300504, in_queue=1361540, util=99.42%
    dm-2: ios=683/13026, merge=0/0, ticks=302/313396, in_queue=313698, util=70.16%, aggrios=1171/25992, aggrmerge=0/0, aggrticks=521/598100, aggrin_queue=589389, aggrutil=71.17%
  sdb: ios=1171/25992, merge=0/0, ticks=521/598100, in_queue=589389, util=71.17%
  dm-0: ios=723914/238356, merge=0/0, ticks=1173265/300727, in_queue=1473992, util=99.24%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;M2 è½¬SATAï¼ŒLITE256G&lt;/h3&gt;
&lt;p&gt;read: IOPS=14.8k, BW=57.9MiB/s (60.7MB/s)(6141MiB/106067msec)&lt;br&gt;
   write: IOPS=4949, BW=19.3MiB/s (20.3MB/s)(2051MiB/106067msec)  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Jobs: 1 (f=1): [m(1)][100.0%][r=70.9MiB/s,w=23.8MiB/s][r=18.2k,w=6088 IOPS][eta 00m:00s]
fiotest: (groupid=0, jobs=1): err= 0: pid=31276: Tue Jul 25 18:07:34 2023
   read: IOPS=14.8k, BW=57.9MiB/s (60.7MB/s)(6141MiB/106067msec)
   bw (  KiB/s): min= 3568, max=132568, per=100.00%, avg=60133.22, stdev=20903.83, samples=209
   iops        : min=  892, max=33142, avg=15033.25, stdev=5225.97, samples=209
  write: IOPS=4949, BW=19.3MiB/s (20.3MB/s)(2051MiB/106067msec)
   bw (  KiB/s): min= 1264, max=44216, per=100.00%, avg=20079.80, stdev=6936.10, samples=209
   iops        : min=  316, max=11054, avg=5019.90, stdev=1734.01, samples=209
  cpu          : usr=8.36%, sys=36.47%, ctx=268925, majf=0, minf=1319
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=1572145,525007,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=57.9MiB/s (60.7MB/s), 57.9MiB/s-57.9MiB/s (60.7MB/s-60.7MB/s), io=6141MiB (6440MB), run=106067-106067msec
  WRITE: bw=19.3MiB/s (20.3MB/s), 19.3MiB/s-19.3MiB/s (20.3MB/s-20.3MB/s), io=2051MiB (2150MB), run=106067-106067msec

Disk stats (read/write):
    dm-0: ios=1571473/524811, merge=0/0, ticks=5559849/416907, in_queue=5976756, util=99.94%, aggrios=555099/206074, aggrmerge=0/0, aggrticks=2011526/221758, aggrin_queue=2233284, aggrutil=99.44%
    dm-1: ios=1665053/525143, merge=0/0, ticks=6031197/411037, in_queue=6442234, util=99.44%, aggrios=1665050/525149, aggrmerge=3/18, aggrticks=6019563/408492, aggrin_queue=5488645, aggrutil=99.44%
  sdb: ios=1665050/525149, merge=3/18, ticks=6019563/408492, in_queue=5488645, util=99.44%
  dm-2: ios=0/24, merge=0/0, ticks=0/17, in_queue=17, util=0.01%
    dm-3: ios=244/93055, merge=0/0, ticks=3382/254221, in_queue=257603, util=70.01%, aggrios=244/93050, aggrmerge=0/0, aggrticks=3371/253941, aggrin_queue=231400, aggrutil=70.01%
  sda: ios=244/93050, merge=0/0, ticks=3371/253941, in_queue=231400, util=70.01%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;M2 è½¬ SATAï¼ŒHFS128ï¼ŒLITE256&lt;/h3&gt;
&lt;p&gt;HFS128&lt;br&gt;
  read: IOPS=5392, BW=21.1MiB/s (22.1MB/s)(1652MiB/78403msec)&lt;br&gt;
  write: IOPS=1807, BW=7229KiB/s (7402kB/s)(553MiB/78403msec);   &lt;/p&gt;
&lt;p&gt;LITE256&lt;br&gt;
  read: IOPS=7093, BW=27.7MiB/s (29.1MB/s)(1503MiB/54254msec)&lt;br&gt;
 write: IOPS=2376, BW=9505KiB/s (9733kB/s)(504MiB/54254msec);  &lt;/p&gt;
&lt;h3&gt;æ·˜å®20å…ƒM2è½¬SATAï¼ŒLITE128&lt;/h3&gt;
&lt;p&gt;read: IOPS=10.2k, BW=39.0MiB/s (41.9MB/s)(6141MiB/153649msec)&lt;br&gt;
   write: IOPS=3416, BW=13.3MiB/s (13.0MB/s)(2051MiB/153649msec)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fiotest: (g=0): rw=randrw, bs=(R) 4096B-4096B, (W) 4096B-4096B, (T) 4096B-4096B, ioengine=libaio, iodepth=64
fio-3.7
Starting 1 process
fiotest: Laying out IO file (1 file / 8192MiB)
Jobs: 1 (f=1): [m(1)][99.4%][r=50.5MiB/s,w=16.0MiB/s][r=12.9k,w=4350 IOPS][eta 00m:01s]
fiotest: (groupid=0, jobs=1): err= 0: pid=9475: Mon Aug 28 18:17:58 2023
   read: IOPS=10.2k, BW=39.0MiB/s (41.9MB/s)(6141MiB/153649msec)
   bw (  KiB/s): min=   16, max=58200, per=100.00%, avg=41310.11, stdev=16748.03, samples=304
   iops        : min=    4, max=14550, avg=10327.51, stdev=4187.01, samples=304
  write: IOPS=3416, BW=13.3MiB/s (13.0MB/s)(2051MiB/153649msec)
   bw (  KiB/s): min=   40, max=19256, per=100.00%, avg=13840.74, stdev=5542.56, samples=303
   iops        : min=   10, max= 4814, avg=3460.16, stdev=1385.63, samples=303
  cpu          : usr=6.09%, sys=18.46%, ctx=204245, majf=0, minf=26
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=1572145,525007,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=39.0MiB/s (41.9MB/s), 39.0MiB/s-39.0MiB/s (41.9MB/s-41.9MB/s), io=6141MiB (6440MB), run=153649-153649msec
  WRITE: bw=13.3MiB/s (13.0MB/s), 13.3MiB/s-13.3MiB/s (13.0MB/s-13.0MB/s), io=2051MiB (2150MB), run=153649-153649msec

Disk stats (read/write):
  sdb: ios=1571481/527350, merge=0/48, ticks=8488777/1080773, in_queue=9568096, util=100.00%

fiotest: Laying out IO file (1 file / 8192MiB)
Jobs: 1 (f=1): [m(1)][99.2%][r=49.8MiB/s,w=16.6MiB/s][r=12.8k,w=4248 IOPS][eta 00m:01s]
fiotest: (groupid=0, jobs=1): err= 0: pid=9501: Mon Aug 28 18:27:02 2023
   read: IOPS=12.4k, BW=48.4MiB/s (50.8MB/s)(6141MiB/126811msec)
   bw (  KiB/s): min=11672, max=58432, per=99.96%, avg=49571.25, stdev=4673.00, samples=253
   iops        : min= 2918, max=14608, avg=12392.81, stdev=1168.25, samples=253
  write: IOPS=4140, BW=16.2MiB/s (16.0MB/s)(2051MiB/126811msec)
   bw (  KiB/s): min= 4176, max=19736, per=99.96%, avg=16553.93, stdev=1554.00, samples=253
   iops        : min= 1044, max= 4934, avg=4138.45, stdev=388.50, samples=253
  cpu          : usr=7.32%, sys=21.91%, ctx=194103, majf=0, minf=26
  IO depths    : 1=0.1%, 2=0.1%, 4=0.1%, 8=0.1%, 16=0.1%, 32=0.1%, &amp;gt;=64=100.0%
     submit    : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.0%, &amp;gt;=64=0.0%
     complete  : 0=0.0%, 4=100.0%, 8=0.0%, 16=0.0%, 32=0.0%, 64=0.1%, &amp;gt;=64=0.0%
     issued rwts: total=1572145,525007,0,0 short=0,0,0,0 dropped=0,0,0,0
     latency   : target=0, window=0, percentile=100.00%, depth=64

Run status group 0 (all jobs):
   READ: bw=48.4MiB/s (50.8MB/s), 48.4MiB/s-48.4MiB/s (50.8MB/s-50.8MB/s), io=6141MiB (6440MB), run=126811-126811msec
  WRITE: bw=16.2MiB/s (16.0MB/s), 16.2MiB/s-16.2MiB/s (16.0MB/s-16.0MB/s), io=2051MiB (2150MB), run=126811-126811msec

Disk stats (read/write):
  sdb: ios=1568831/523974, merge=0/25, ticks=6819307/982445, in_queue=7801866, util=100.00%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;ç®€å•æ€»ç»“&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;lvmcache æ•ˆæœä¸é”™ï¼›&lt;/li&gt;
&lt;li&gt;intelå’Œä¸‰æ˜Ÿçš„ssd æ€§èƒ½ä¸é”™ï¼Œssd ä¸€åˆ†é’±ä¸€åˆ†è´§ï¼Œå·®è·æ˜æ˜¾ï¼›&lt;/li&gt;
&lt;li&gt;m2è½¬sataï¼ŒåŸºæœ¬æ— æ€§èƒ½æŸå¤±ï¼Œåˆ©æ—§m2 ssdçš„è¯ï¼Œå¤Ÿç”¨ï¼›&lt;/li&gt;
&lt;li&gt;æ·˜å®çš„m2è½¬sataï¼Œç›¸æ¯”ç»¿è”çš„è½¬ç›’ï¼Œæ€§èƒ½æ²¡å•¥å·®åˆ«ï¼Œä¾¿å®œ3å€+ï¼›&lt;/li&gt;
&lt;li&gt;ssd lvmcache çªå‘/å¹³å‡æ€§èƒ½ä¸é”™ï¼Œä½†æ˜¯æ–¹å·®æå¤§ï¼Œå¯èƒ½å‡ºç°æ¯›åˆºé˜»å¡ã€æ€§èƒ½æ¯›åˆºï¼›&lt;/li&gt;
&lt;li&gt;ä¸ºé˜²æ­¢ssdæ‰ç›˜ï¼Œæ§½ä½æœ‰ç©ºé—´çš„è¯ï¼Œå»ºè®®ç»™cacheåšraid1ï¼›&lt;/li&gt;
&lt;/ol&gt;</content><category term="2023"></category><category term="lvm"></category></entry><entry><title>lvmcache ç¼“å­˜ç›˜æ‰ç›˜å¤„ç†</title><link href="https://fangpsh.github.io/posts/2023/2023-09-26.html" rel="alternate"></link><published>2023-09-26T00:00:00+08:00</published><updated>2023-09-26T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-09-26:/posts/2023/2023-09-26.html</id><summary type="html">&lt;p&gt;ä¸€å—è€æ—§çš„SSDï¼Œä½¿ç”¨lvmcache ä½œä¸ºè¯»å†™ç¼“å­˜ï¼Œä»Šå¤©æ‰ç›˜äº†ï¼Œç³»ç»Ÿhang ä½ï¼Œé‡å¯åä¸€å †æŠ¥é”™ï¼š&lt;code&gt;Warning: dracut-initqueue timeout - starting timeout scripts&lt;/code&gt;ï¼Œå¯åŠ¨å¤±è´¥ï¼Œè‡ªåŠ¨è¿›å…¥äº†æ•‘æ´æ¨¡å¼ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸€å—è€æ—§çš„SSDï¼Œä½¿ç”¨lvmcache ä½œä¸ºè¯»å†™ç¼“å­˜ï¼Œä»Šå¤©æ‰ç›˜äº†ï¼Œç³»ç»Ÿhang ä½ï¼Œé‡å¯åä¸€å †æŠ¥é”™ï¼š&lt;code&gt;Warning: dracut-initqueue timeout - starting timeout scripts&lt;/code&gt;ï¼Œå¯åŠ¨å¤±è´¥ï¼Œè‡ªåŠ¨è¿›å…¥äº†æ•‘æ´æ¨¡å¼&lt;code&gt;dracut:/#&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ•‘æ´æ¨¡å¼ä¸­ï¼Œlvm çš„å˜æ›´æ“ä½œéƒ½ä¼šæŠ¥è­¦ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Read-only locking type set. Write locks are prohibited.
Can&amp;#39;t get lock for...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;éœ€è¦æ‰‹å·¥ç¼–è¾‘ä¸‹&lt;code&gt;/etc/lvm/lvm.conf&lt;/code&gt; å°†&lt;code&gt;locking_type=4&lt;/code&gt; ä¿®æ”¹ä¸º&lt;code&gt;locking_type=1&lt;/code&gt;ï¼Œå†ç»§ç»­ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆå°è¯•å¼ºåˆ¶ç§»é™¤cacheï¼Œå¤±è´¥äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dracut:/# lucomvert -uncache centos/root --force
Couldn&amp;#39;t find device with unid Buatb2-rxoc-8B6f -cf8y-3XR3-JTer-WNS6tJ.
WARNING: Cache pool data. logical wolume centos/cache_ cdata is missing.
WARNING: Cache pool metadata logical volume centos/cache_cmeta is missing.
WARMING: Uncaching of partially missi ng writethrough cache volume centos/root might destroy your date
Do you really want to uncache centos/root with missing LUs? lym]:y
t 1366 4737991 Buffer I&amp;#39;d error on dey dm-3, logical block async page read
devmapper centos -cache_cmeta: read failed: Input / output error
Failed to active cache locally centos/root.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†è¯•ä¸€è¯•&lt;code&gt;lvm unreduce --removemiss centos --force&lt;/code&gt;ï¼Œä¹Ÿå¤±è´¥äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Couldn&amp;#39;t find device with unid BuatbZ-rxoc-8B6r -cf8y-3XR3-JTer-uNS6tj.
WARNING:_ Removing partial LU centos/root:
1388 5592321 Buffer Iro error on dey dm-3, logical block 8, async page read
devmapper/centos-cache, cmeta: read failed: imput/output error
failed to active cache locally centosroot.
Failed to uncache centos/root.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹åˆ°æœ‰è¯´å¯ä»¥å†ç”¨ä¸€å—ç›˜ï¼Œ&lt;a href="https://unix.stackexchange.com/questions/489182/lvm-pv-missing-after-reboot"&gt;æ›¿æ¢ä¸ºç›¸åŒçš„UUID&lt;/a&gt;ï¼Œæ²¡æŠ˜è…¾ï¼Œæœ€ç»ˆç”¨&lt;a href="https://github.com/lvmteam/lvm2/issues/35"&gt;è¿™ä¸ªissue&lt;/a&gt;çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;At this point, the only way I found this can be fixed is to take the /etc/lvm/backup/lvmgroup file, modify it to remove the cache entries, rename the disk_corig back to disk, add "VISIBLE" flag back, and then run vgcfgrestore -f on the modified file.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆä¿å­˜ä¸‹åŸé…ç½®ï¼ˆ/etc/lvm/backup/centosï¼‰ï¼Œä¾‹å¦‚åŸé…ç½®æ˜¯&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...
centos {
        id = &amp;quot;cPeVKa-nu1q-wuPJ-bcXB-1tYT-12aG-ALYYoT&amp;quot;
        seqno = 8
        format = &amp;quot;lvm2&amp;quot;                 # informational
        status = [&amp;quot;RESIZEABLE&amp;quot;, &amp;quot;READ&amp;quot;, &amp;quot;WRITE&amp;quot;]
        flags = []
        extent_size = 8192              # 4 Megabytes
        max_lv = 0
        max_pv = 0
        metadata_copies = 0

        physical_volumes {

                pv0 {
                        id = &amp;quot;aJVnc3-w0xI-7WkX-Ejww-ROnQ-V1br-dsz6VX&amp;quot;
                        device = &amp;quot;/dev/sda2&amp;quot;    # Hint only

                        status = [&amp;quot;ALLOCATABLE&amp;quot;]
                        flags = []
                        dev_size = 3902797824   # 1.81738 Terabytes
                        pe_start = 2048
                        pe_count = 476415       # 1.81738 Terabytes
                }

                pv1 {
                        id = &amp;quot;i6BCMc-GcML-GO3g-UISN-83fg-39Cg-rTZFe8&amp;quot;
                        device = &amp;quot;/dev/sdb&amp;quot;     # Hint only

                        status = [&amp;quot;ALLOCATABLE&amp;quot;]
                        flags = []
                        dev_size = 248774656    # 118.625 Gigabytes
                        pe_start = 2048
                        pe_count = 30367        # 118.621 Gigabytes
                }
        }
        logical_volumes {

                root {
                        id = &amp;quot;rmdkDt-zyEW-i9UX-VLch-jzLr-154x-57Si74&amp;quot;
                        status = [&amp;quot;READ&amp;quot;, &amp;quot;WRITE&amp;quot;, &amp;quot;VISIBLE&amp;quot;]
                        flags = []
                        creation_time = 1693208343      # 2023-08-28 15:39:03 +0800
                        creation_host = &amp;quot;localhost.localdomain&amp;quot;
                        segment_count = 1

                        segment1 {
                                start_extent = 0
                                extent_count = 476415   # 1.81738 Terabytes

                                type = &amp;quot;cache&amp;quot;
                                cache_pool = &amp;quot;cache&amp;quot;
                                origin = &amp;quot;root_corig&amp;quot;
                        }
                }
                cache {
                ...
                }
                cache_cdata {
                ...
                }
                cache_cmeta {
                ...
                }
                lvol0_pmspare {
                ...
                }
                root_corig {
                        id = &amp;quot;12gqfI-5f9u-SRkw-yTtc-PE12-x38t-h4lYUa&amp;quot;
                        status = [&amp;quot;READ&amp;quot;, &amp;quot;WRITE&amp;quot;]
                        flags = []
                        creation_time = 1693276572      # 2023-08-29 10:36:12 +0800
                        creation_host = &amp;quot;sz-node-8-12&amp;quot;
                        segment_count = 1

                        segment1 {
                                start_extent = 0
                                extent_count = 476415   # 1.81738 Terabytes

                                type = &amp;quot;striped&amp;quot;
                                stripe_count = 1        # linear

                                stripes = [
                                        &amp;quot;pv0&amp;quot;, 0
                                ]
                        }
                }
        }

}                                                                                   
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°†cache ç›¸å…³çš„lv é…ç½®éƒ½åˆ é™¤ï¼Œæ‰ç›˜çš„pv1 ä¹Ÿå¯ä»¥åˆ äº†ï¼Œæ›´æ–°ä¸‹&lt;code&gt;lv root&lt;/code&gt; ï¼Œä¸»è¦æ˜¯ä¿®æ”¹segment æ®µé…ç½® ï¼ŒæŠŠroot_corig é‡Œé¢çš„æŒªè¿‡æ¥å³å¯ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;        logical_volumes {

                root {
                        id = &amp;quot;rmdkDt-zyEW-i9UX-VLch-jzLr-154x-57Si74&amp;quot;
                        status = [&amp;quot;READ&amp;quot;, &amp;quot;WRITE&amp;quot;, &amp;quot;VISIBLE&amp;quot;]
                        flags = []
                        creation_time = 1693208343      # 2023-08-28 15:39:03 +0800
                        creation_host = &amp;quot;localhost.localdomain&amp;quot;
                        segment_count = 1

                        segment1 {
                                start_extent = 0
                                extent_count = 476415   # 1.81738 Terabytes

                                type = &amp;quot;striped&amp;quot;
                                stripe_count = 1        # linear

                                stripes = [
                                        &amp;quot;pv0&amp;quot;, 0
                                ]
                        }
                }
        }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ€åæ‰§è¡Œ &lt;code&gt;lvm vgcfgrestore -f é…ç½®æ–‡ä»¶ vgåç§°&lt;/code&gt; ç”Ÿæ•ˆã€‚&lt;/p&gt;</content><category term="2023"></category><category term="lvm"></category></entry><entry><title>DNS CacheæŠ•æ¯’äº‹ä»¶å¤„ç†</title><link href="https://fangpsh.github.io/posts/2023/2023-09-05.html" rel="alternate"></link><published>2023-09-05T00:00:00+08:00</published><updated>2023-09-05T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-09-05:/posts/2023/2023-09-05.html</id><summary type="html">&lt;p&gt;æœ€è¿‘åŒäº‹åœ¨åŠå…¬ç½‘ç™»å½• aws æ§åˆ¶å°ï¼ˆap-southeast-1.console.aws.amazon.comï¼‰ï¼Œæµè§ˆå™¨æç¤ºè¯ä¹¦å¼‚å¸¸ï¼Œæ€€ç–‘ITåšäº†åŠ«æŒï¼ˆæˆ‘ä»¬åšè¿‡ä¸€äº›ç½‘ç«™çš„åŠ«æŒï¼ŒåŠ«æŒåˆ°sniproxyï¼Œè¿›è¡Œé€æ˜ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æœ€è¿‘åŒäº‹åœ¨åŠå…¬ç½‘ç™»å½• aws æ§åˆ¶å°ï¼ˆap-southeast-1.console.aws.amazon.comï¼‰ï¼Œæµè§ˆå™¨æç¤ºè¯ä¹¦å¼‚å¸¸ï¼Œæ€€ç–‘ITåšäº†åŠ«æŒï¼ˆæˆ‘ä»¬åšè¿‡ä¸€äº›ç½‘ç«™çš„åŠ«æŒï¼ŒåŠ«æŒåˆ°sniproxyï¼Œè¿›è¡Œé€æ˜ä»£ç†ï¼‰ï¼š
&lt;img alt="aws è¢«åŠ«æŒ" src="/assets/images/2023/20230905171716.jpg"&gt;&lt;/p&gt;
&lt;p&gt;é‡Œé¢çš„åŸŸåæ˜¯ djfidicjmwos.comï¼Œ
æœç´¢è¿™ä¸ªåŸŸåï¼Œæœ‰ä¸€ä¸ªç±»ä¼¼çš„å¸–å­ï¼š&lt;a href="http://www.0818tuan.com/xbhd/1733117.html"&gt;éƒ¨åˆ†ç½‘ç«™ç™»å½•æ—¶ä¸æ—¶æç¤ºâ€œä½ çš„è¿æ¥ä¸æ˜¯ä¸“ç”¨è¿æ¥â€ï¼Œç„¶åè¿›ä¸å»åï¼Œç­‰ä¼šåˆå¯ä»¥è¿›&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹åŠå…¬ç½‘çš„localdnsï¼Œä¸Šæ¸¸æ˜¯æ·±åœ³ç”µä¿¡è¿”å›ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="localdns-log" src="/assets/images/2023/20230905172052.png"&gt;&lt;/p&gt;
&lt;p&gt;å¯ç–‘IPï¼š156.234.127.142&lt;/p&gt;
&lt;p&gt;ç›´æ¥è®¿é—®è¿™ä¸ªIP çš„httpsç«¯å£ï¼Œè¿”å›è¯ä¹¦å’ŒåŠ«æŒä¸€è‡´ï¼š
&lt;img alt="è¯ä¹¦æŠ¥è­¦" src="/assets/images/2023/20230905171559.jpeg"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;åºåˆ—å· 9F87F0D7AA5DAD293B3FAB5ADAE9606
æ ¹è¯ä¹¦ å¦
ç®—æ³•  SHA384WithRSA
è¯ä¹¦ç±»å‹    DV
è¯ä¹¦å“ç‰Œ    Comodo
ç§é’¥é•¿åº¦    2048 Bits
SHA1æŒ‡çº¹  6BB71F0A72CD9DC0E51117373957DB4036B475F5
SHA256æŒ‡çº¹    F3B1564D750EFE874AC166D427BC5ACF7E4554BEFCF3988B7F0EE069905A0B02
å…¬é’¥PIN-SHA256    aSE+RSj9ELhDFz+sK8mVtlJQ0gUX2j0sTRHQa69sjco=
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŒ‰è¿™ä¸ªIPæŸ¥è¯¢ti.360.net ï¼Œçœ‹èµ·æ¥å’Œåšå½©ç›¸å…³ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="ip ä¿¡æ¯" src="/assets/images/2023/20230905172306.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;ç›´æ¥å¯¹202.96.128.166 å‘èµ·è¯·æ±‚ï¼Œä¼šé—´æ­‡æ€§è¿”å›è¿™ä¸ªIPï¼Œå¯èƒ½åªæ˜¯é›†ç¾¤ä¸­æŸå°æœåŠ¡å™¨å¼‚å¸¸ ï¼Œ
è¿™æ¡è®°å½•çš„TTLç‰¹åˆ«é•¿ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dig  @202.96.128.166 ap-southeast-1.console.aws.amazon.com

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.10.6 &amp;lt;&amp;lt;&amp;gt;&amp;gt; @202.96.128.166 ap-southeast-1.console.aws.amazon.com
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 42939
;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 4, ADDITIONAL: 8

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;ap-southeast-1.console.aws.amazon.com. IN A

;; ANSWER SECTION:
ap-southeast-1.console.aws.amazon.com. 600 IN CNAME gr.console-geo.ap-southeast-1.amazonaws.com.
gr.console-geo.ap-southeast-1.amazonaws.com. 600 IN CNAME a299197c08ba4f000.awsglobalaccelerator.com.
a299197c08ba4f000.awsglobalaccelerator.com. 2206 IN A 156.234.127.142

;; AUTHORITY SECTION:
awsglobalaccelerator.com. 46274 IN      NS      ns-1484.awsdns-57.org.
awsglobalaccelerator.com. 46274 IN      NS      ns-409.awsdns-51.com.
awsglobalaccelerator.com. 46274 IN      NS      ns-609.awsdns-12.net.
awsglobalaccelerator.com. 46274 IN      NS      ns-1949.awsdns-51.co.uk.

;; ADDITIONAL SECTION:
ns-1949.awsdns-51.co.uk. 2130   IN      A       205.251.199.157
ns-409.awsdns-51.com.   42961   IN      A       205.251.193.153
ns-609.awsdns-12.net.   67319   IN      A       205.251.194.97
ns-1484.awsdns-57.org.  85695   IN      AAAA    2600:9000:5305:cc00::1
ns-1949.awsdns-51.co.uk. 2130   IN      AAAA    2600:9000:5307:9d00::1
ns-409.awsdns-51.com.   42961   IN      AAAA    2600:9000:5301:9900::1
ns-609.awsdns-12.net.   47034   IN      AAAA    2600:9000:5302:6100::1

;; Query time: 1113 msec
;; SERVER: 202.96.128.166#53(202.96.128.166)
;; WHEN: Mon Sep 04 17:09:16 CST 2023
;; MSG SIZE  rcvd: 486
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¯·æ±‚114.114.114.114 ï¼Œè¿”å›çš„æ˜¯ï¼š156.234.127.138ï¼Œä¸€ä¸ªCæ®µï¼Œç›´æ¥è¿”å›https 443ç«¯å£ï¼Œè¿”å›ä¸€æ ·çš„è¯ä¹¦ã€‚é˜¿é‡Œçš„223.5.5.5ï¼Œè¿˜æœ‰ä¸€ä¸ªCæ®µIPï¼š156.234.127.27ã€‚&lt;/p&gt;
&lt;p&gt;DNSPod çš„119.29.29.29 å¤šæ¬¡æµ‹è¯•ï¼Œæ²¡å‘ç°å¼‚å¸¸ã€‚
1.1.1.1 å’Œ 8.8.8.8å¤šæ¬¡æµ‹è¯•ï¼Œä¹Ÿæ— å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¸¸å“åº”æ˜¯3.3.15.1 å’Œ3.3.14.1:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ap-southeast-1.console.aws.amazon.com. 126 IN CNAME gr.console-geo.ap-southeast-1.amazonaws.com.
gr.console-geo.ap-southeast-1.amazonaws.com. 126 IN CNAME a299197c08ba4f000.awsglobalaccelerator.com.
a299197c08ba4f000.awsglobalaccelerator.com. 186 IN A 3.3.15.1
a299197c08ba4f000.awsglobalaccelerator.com. 186 IN A 3.3.14.1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="fofaä¸€ä¸‹" src="/assets/images/2023/20230905174026.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ‰äººè¯´å¯èƒ½aws çš„ç³»ç»Ÿå‡ºé—®é¢˜äº†ï¼Œæˆ‘è§‰å¾—å¯èƒ½æ€§ä¸å¤§ã€‚çŒœæµ‹å‡ ä¸ªå¯èƒ½çš„åŸå› ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”µä¿¡æŸä¸€ç»„æœåŠ¡å™¨è¢«å…¥ä¾µï¼Ÿä¸å¤ªå¯èƒ½ï¼Œ114 ä¹Ÿå‡ºç°äº†ç±»ä¼¼æƒ…å†µï¼›&lt;/li&gt;
&lt;li&gt;è·¨å¢ƒçš„ä¸­é—´é“¾è·¯ä¸Šæœ‰dns æŠ¢ç­”ï¼Œæ³¨å…¥äº†æ¶æ„åœ°å€ï¼Ÿå¥½åƒå¯èƒ½æ€§ä¹Ÿä¸å¤§ï¼›&lt;/li&gt;
&lt;li&gt;æƒå¨æœåŠ¡å™¨çš„æŸä¸ªIPåœ¨æŸä¸ªåŸŸå†…BGP Leak äº†ï¼Ÿ ç‰µå¼•äº†éƒ¨åˆ†æƒå¨æœåŠ¡å™¨çš„æµé‡ï¼Œç„¶åè¿›è¡ŒæŠ¢ç­”ï¼›&lt;/li&gt;
&lt;li&gt;DNS ç¼“å­˜æŠ•æ¯’ï¼ˆDNS cache poisoningï¼‰ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;s&gt;
ä¸ªäººè§‰å¾—å¯èƒ½æ€§æ¯”è¾ƒå¤§çš„æ˜¯ dns ç¼“å­˜æŠ•æ¯’äº† ï¼Œæœ‰äººçŒœæµ‹äº†dnsæŸ¥è¯¢äº‹åŠ¡idï¼Œè¿›è¡Œäº†æŠ¢ç­”ã€‚ 
&lt;/s&gt;&lt;/p&gt;
&lt;p&gt;ç”±äºæ­¤åŠ«æŒæ—¶é—´è¶…é•¿ï¼Œå½±å“èŒƒå›´è¶…å¹¿ï¼Œè®©æˆ‘æ€€ç–‘ä¸æ˜¯é»‘å®¢æ‰€è°“ï¼Œæ›´å€¾å‘äºåŸå›  2ï¼Œæ˜¯çš„ï¼Œå°±æ˜¯ä½ æƒ³çš„é‚£ä¸ªã€‚@20240315&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯DNS ç¼“å­˜æŠ•æ¯’ï¼Œå¯å‚è€ƒï¼š&lt;a href="https://www.cloudflare.com/learning/dns/dns-cache-poisoning/"&gt;cloudflare: What is DNS cache poisoning? | DNS spoofing &lt;/a&gt;ï¼Œè¿™ä¸ªå¹»ç¯ç‰‡è®²è§£çš„æ¯”è¾ƒè¯¦ç»† &lt;a href="https://owasp.org/www-pdf-archive/DNS_Cache_Poisoning(OWASP_GHANA).pdf"&gt;Anatomy  of a DNS Cache Poisoning Attack&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è§„é¿æ–¹æ³•ï¼Œä½¿ç”¨DNSSECï¼Œæˆ–è€…ä¸ä½¿ç”¨å›ºå®šçš„æºåœ°å€ï¼Œéšæœºæºåœ°å€+éšæœºäº‹åŠ¡IDï¼Œè®©æ”»å‡»è€…æ›´éš¾çŒœæµ‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;- UDP Source Port Randomization (UDP SPR): What this does is setting the UDP
source port randomly, so an attacker would have to guess both the transaction ID
and the source port in a short time window - which is usually not feasible (since they
would need to make 232 combinations).
- DNS Security Extensions (DNSSEC): It is a protocol designed to create a unique
cryptographic signature and store it alongside other DNS records. Thus, DNSSEC
provides DNS with an additional methods of verification by digitally signing the DNS
information. This is done on all levels of the DNS Resolution process. 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»&lt;a href="https://www.163.com/dy/article/GQ3FFVMO0552KI0B.html"&gt;è¿™ç¯‡æ–‡ç« &lt;/a&gt;çœ‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;è¯¥å˜ç§æ”»å‡»æ¼æ´å½±å“ Linux å†…æ ¸ä»¥åŠæµè¡Œçš„ DNS è½¯ä»¶ï¼ŒåŒ…æ‹¬åœ¨ Linux ä¸Šè¿è¡Œçš„ BINDã€Unbound å’Œ dnsmasqï¼Œä½†åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿå¦‚ FreeBSD æˆ– Windows ä¸Šè¿è¡Œçš„è¿™äº›DNSè½¯ä»¶åˆ™ä¸ä¼šã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;éš¾é“æ˜¯å› ä¸ºDNSPod æ˜¯è‡ªç ”ï¼Œæ‰€ä»¥æ²¡å—å½±å“ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœ€åï¼š
æ·±åœ³ç”µä¿¡æœ‰3ç»„å†…éƒ¨DNSæœåŠ¡å™¨ï¼Œå¦å¤–2ç»„æ²¡å—å½±å“ï¼Œæ³¨é‡Šæ‰æœ‰é—®é¢˜çš„è¿™ä¸ªåœ°å€ä¸´æ—¶è§„é¿äº†ã€‚&lt;/p&gt;
&lt;p&gt;IOCsï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;156.234.127.142&lt;/li&gt;
&lt;li&gt;156.234.127.138&lt;/li&gt;
&lt;li&gt;156.234.127.27&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–å‚è€ƒé“¾æ¥ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.secrss.com/articles/18219"&gt;å…³äºå›½å†…éƒ¨åˆ†åœ°åŒºä¸€äº›ç½‘ç«™httpsè¯ä¹¦å‡ºç°é—®é¢˜çš„æƒ…å†µåˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://v2ex.com/t/656367?p=2"&gt;Github pages çš„ HTTPS æ˜¯ä¸æ˜¯å‡ºé—®é¢˜äº†ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://arthurchiao.art/blog/bgp-leaks-and-crypto-currencies-zh/"&gt;[è¯‘] BGP æ³„éœ²å’ŒåŠ å¯†è´§å¸ï¼ˆ2018ï¼‰&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://zhuanlan.zhihu.com/p/92899876"&gt;ä¸€æ¬¡å‡ºäººæ„æ–™è€Œåç•™é’å²çš„DNSæŠ•æ¯’æ”»å‡»&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2023"></category><category term="dns"></category><category term="hack"></category></entry><entry><title>å†æ¬¡é‡åˆ°OCSPå¼•å‘çš„å¡é¡¿è¶…æ—¶é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2023/2023-08-18.html" rel="alternate"></link><published>2023-08-18T00:00:00+08:00</published><updated>2023-08-18T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-08-18:/posts/2023/2023-08-18.html</id><summary type="html">&lt;p&gt;å¥½å‡ å¹´å‰åœ¨iOS ä¸Šé‡åˆ°è¿‡ï¼Œæœ€è¿‘åˆé‡åˆ°äº†ã€‚ä¹‹å‰BigSur æ›´æ–°ï¼Œå¥½åƒä¹Ÿæœ‰è¿‡ä¸€æ¬¡OCSP è¶…æ—¶çš„é—®é¢˜ï¼Œå‚è€ƒ &lt;a href="https://sspai.com/post/63649"&gt;OCSPï¼Œä¼´éšè‹¹æœéšç§æ”¶é›†ä¸æ³„æ¼çš„å° â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;å¥½å‡ å¹´å‰åœ¨iOS ä¸Šé‡åˆ°è¿‡ï¼Œæœ€è¿‘åˆé‡åˆ°äº†ã€‚ä¹‹å‰BigSur æ›´æ–°ï¼Œå¥½åƒä¹Ÿæœ‰è¿‡ä¸€æ¬¡OCSP è¶…æ—¶çš„é—®é¢˜ï¼Œå‚è€ƒ &lt;a href="https://sspai.com/post/63649"&gt;OCSPï¼Œä¼´éšè‹¹æœéšç§æ”¶é›†ä¸æ³„æ¼çš„å°å°äº‰è®®
&lt;/a&gt;ã€‚
è¿™ä¸€æ¬¡é‡åˆ°æ˜¯åœ¨QWebengineView ä¸‹åŠ è½½è¶…æ—¶ï¼Œ
ç”±äºGodaddy  OCSP ä½¿ç”¨çš„akamai cdnï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œåœ¨å¤§é™†è®¿é—®å¼‚å¸¸æ¦‚ç‡éå¸¸é«˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dig ocsp.godaddy.com

; &amp;lt;&amp;lt;&amp;gt;&amp;gt; DiG 9.10.6 &amp;lt;&amp;lt;&amp;gt;&amp;gt; ocsp.godaddy.com
;; global options: +cmd
;; Got answer:
;; -&amp;gt;&amp;gt;HEADER&amp;lt;&amp;lt;- opcode: QUERY, status: NOERROR, id: 33808
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 8, ADDITIONAL: 14

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;ocsp.godaddy.com.              IN      A

;; ANSWER SECTION:
ocsp.godaddy.com.       600     IN      A       31.13.95.17

;; AUTHORITY SECTION:
godaddy.com.            2884    IN      NS      cns2.godaddy.com.
godaddy.com.            2884    IN      NS      a11-64.akam.net.
godaddy.com.            2884    IN      NS      a6-66.akam.net.
godaddy.com.            2884    IN      NS      a9-67.akam.net.
godaddy.com.            2884    IN      NS      a1-245.akam.net.
godaddy.com.            2884    IN      NS      cns1.godaddy.com.
godaddy.com.            2884    IN      NS      a20-65.akam.net.
godaddy.com.            2884    IN      NS      a8-67.akam.net.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è§£å†³åŠæ³•æ˜¯è¦ä¹ˆæ¢ä¸€ä¸ªå¤§é™†çš„CAï¼Œè¦ä¹ˆå¼€OCSP Staplingã€‚å¼€OCSP Stapling çš„è¯ï¼Œå¯ä»¥è‡ªå·±åœ¨Nginx ä¸ŠæŠ˜è…¾ï¼Œæˆ–è€…æ‰“å¼€CDN çš„OCSP Stapling å¼€å…³ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Nginx ä¸ŠæŠ˜è…¾çš„è¯ï¼Œç”±äºNginx åœ¨å¤§é™†ï¼ŒNginx æ‰€åœ¨æœºå™¨è®¿é—®ocsp.godaddy.com ä¹Ÿå—å¹²æ‰°ï¼Œ2ä¸ªè§£å†³åŠæ³•ï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨ç½‘å‹åˆ¶ä½œçš„&lt;a href="https://jhuo.ca/post/ocsp-stapling-letsencrypt/"&gt;ocsp-proxy&lt;/a&gt;ä¸€ä¸ªæ˜¯å‘¨æœŸæ€§ä»å¤–éƒ¨è·å–ocsp ä¿¡æ¯ï¼Œä½¿ç”¨ngx_ssl_stapling_file æŒ‡å®šã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºæ˜¯å“ªç§åŠæ³•ï¼Œéƒ½å¾—æä¸€ä¸ªä»£ç†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¦ä½¿ç”¨åè€…ï¼Œéœ€è¦å°†è¯ä¹¦å¤„ç†ä¸€ä¸‹ï¼š
å°†åŸŸåè¯ä¹¦ã€ä¸­é—´è¯ä¹¦ã€æ ¹è¯ä¹¦æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºä¿å­˜ä¸ºfullchains.pem ï¼Œä¸­é—´è¯ä¹¦å•ç‹¬ä¿å­˜ä¸ºintermediate.pemï¼Œå­è¯ä¹¦ä¿å­˜ä¸º site.pemï¼Œä½¿ç”¨&lt;code&gt;openssl ocsp&lt;/code&gt;ï¼Œå‘½ä»¤å‰å¯èƒ½éœ€è¦ä½¿ç”¨&lt;code&gt;proxychains&lt;/code&gt;ä¹‹ç±»èµ°ä¸‹ä»£ç†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl ocsp -no_nonce -text \
-issuer intermediate.pem \  # ä¸­é—´è¯ä¹¦
-cert site.pem \            # åŸŸåè¯ä¹¦
-CAfile fullchains.pem \    # å®Œæ•´è¯ä¹¦é“¾
-url http://ocsp.godaddy.com \
-header &amp;quot;HOST&amp;quot; &amp;quot;ocsp.godaddy.com&amp;quot; \
-respout ocsp.resp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»å“ªé‡Œå–ä¸­é—´è¯ä¹¦å’Œæ ¹è¯ä¹¦ï¼Ÿå¤§å¤šæ•°æ—¶å€™ä»CA å¤„ä¸‹è½½çš„æ—¶å€™ï¼Œä¼šå¸¦ä¸€ä¸ªCA Bundleæ–‡ä»¶ï¼Œé‡Œé¢åŒ…å«æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦ï¼Œæ‹†åˆ†ä¸€ä¸‹ã€‚æˆ–è€…å¯ä»¥ç›´æ¥ä»CAå®˜ç½‘ï¼Œæˆ–è€…ç”¨ç½‘ä¸Šçš„è¯ä¹¦é“¾ä¿®å¤å·¥å…·æ¥è·å–ã€‚&lt;/p&gt;
&lt;p&gt;æ£€æŸ¥æ˜¯å¦æˆåŠŸå¼€å¯ï¼Œå¤–ç½‘çš„è¯ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨myssl.com ã€ssllabs.com æ£€æµ‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;openssl s_client -connect ç›®æ ‡åœ°å€:443 -servername  ç›®æ ‡åŸŸå  -status -tlsextdebug &amp;lt; /dev/null 2&amp;gt;&amp;amp;1 |grep OCSP -B 3 -A 10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://jhuo.ca/post/ocsp-stapling-letsencrypt/"&gt;Ocsp Stapling å’ŒiOSç•Œé¢å¡é¡¿é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://c4ys.com/archives/2148"&gt;letsencrypt httpsè¯ä¹¦å¢åŠ OCSP Staplingè§£å†³iOSå…¬ä¼—å·H5é¦–æ¬¡æ‰“å¼€æ…¢é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://holmesian.org/OCSP-Stapling"&gt;è®°å½•OCSP Staplingçš„ä¸¤ä¸ªé—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://imququ.com/post/why-can-not-turn-on-ocsp-stapling.html"&gt;ä»æ— æ³•å¼€å¯ OCSP Stapling è¯´èµ·&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2023"></category><category term="https"></category><category term="tls"></category></entry><entry><title>æ— æ³•æ·»åŠ cloudpods è®¡ç®—èŠ‚ç‚¹çš„é—®é¢˜æ’æŸ¥</title><link href="https://fangpsh.github.io/posts/2023/2023-07-24.html" rel="alternate"></link><published>2023-07-24T00:00:00+08:00</published><updated>2023-07-24T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-07-24:/posts/2023/2023-07-24.html</id><summary type="html">&lt;p&gt;ç»™cloudpods æ·»åŠ ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œå‡ºé”™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;TASK [worker-node : Use &amp;#39;ocadm join 192.168.x.x:6443 --token howsjs.XXX --discovery-token-unsafe-skip-ca-verification --enable-host-agent --node-ip 192.168.x.x --enable-hugepage &amp;#39;] ***
fatal: [192.168.x.x]: FAILED! =&amp;gt;
 {&amp;quot;changed&amp;quot;: true, &amp;quot;cmd&amp;quot;: [&amp;quot;/opt/yunion/bin/ocadm&amp;quot;, &amp;quot;join&amp;quot;, &amp;quot;192.168.x â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;ç»™cloudpods æ·»åŠ ä¸€ä¸ªè®¡ç®—èŠ‚ç‚¹ï¼Œå‡ºé”™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;TASK [worker-node : Use &amp;#39;ocadm join 192.168.x.x:6443 --token howsjs.XXX --discovery-token-unsafe-skip-ca-verification --enable-host-agent --node-ip 192.168.x.x --enable-hugepage &amp;#39;] ***
fatal: [192.168.x.x]: FAILED! =&amp;gt;
 {&amp;quot;changed&amp;quot;: true, &amp;quot;cmd&amp;quot;: [&amp;quot;/opt/yunion/bin/ocadm&amp;quot;, &amp;quot;join&amp;quot;, &amp;quot;192.168.x.x:6443&amp;quot;, &amp;quot;--token&amp;quot;, &amp;quot;howsjs.XXXXXXX&amp;quot;, &amp;quot;--discovery-token-unsafe-skip-ca-verification&amp;quot;, &amp;quot;--enable-host-agent&amp;quot;, &amp;quot;--node-ip&amp;quot;, &amp;quot;192.168.8.6&amp;quot;, &amp;quot;--enable-hugepage&amp;quot;], &amp;quot;delta&amp;quot;: &amp;quot;0:05:00.667016&amp;quot;, &amp;quot;end&amp;quot;: &amp;quot;2023-07-21 15:08:32.106642&amp;quot;, &amp;quot;msg&amp;quot;: &amp;quot;non-zero return code&amp;quot;, &amp;quot;rc&amp;quot;: 1, &amp;quot;start&amp;quot;: &amp;quot;2023-07-21 15:03:31.439626&amp;quot;, &amp;quot;stderr&amp;quot;: &amp;quot;\t[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 20.10.5. Latest validated version: 18.09\nerror execution phase preflight: couldn&amp;#39;t validate the identity of the API Server: abort connecting to API servers after timeout of 5m0s&amp;quot;, &amp;quot;stderr_lines&amp;quot;: [&amp;quot;\t[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 20.10.5. Latest validated version: 18.09&amp;quot;, &amp;quot;error execution phase preflight: couldn&amp;#39;t validate the identity of the API Server: abort connecting to API servers after timeout of 5m0s&amp;quot;], &amp;quot;stdout&amp;quot;: &amp;quot;[preflight] Running pre-flight checks&amp;quot;, &amp;quot;stdout_lines&amp;quot;: [&amp;quot;[preflight] Running pre-flight checks&amp;quot;]}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å’Œé‚£ä¸ªDocker version å¼‚å¸¸æ²¡å•¥å…³ç³»ï¼Œä½†æ˜¯è¿™æ®µé”™è¯¯ä¹Ÿè®©äººçœ‹ä¸æ‡‚ï¼ŒAPI Server æ˜¯æ­£å¸¸çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;error execution phase preflight: couldn't validate the identity of the API Server: abort connecting to API servers after timeout of 5m0s&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;åœ¨ocboot æ‰¾åˆ°å¯¹åº”çš„roleï¼Œå°†&lt;a href="https://github.com/yunionio/ocboot/blob/master/onecloud/roles/worker-node/tasks/main.yml#L106"&gt;join&lt;/a&gt; å‘½ä»¤æ—¥å¿—ç­‰çº§æå‡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-command: &amp;quot;/opt/yunion/bin/ocadm {{ join_args }}&amp;quot;
+command: &amp;quot;/opt/yunion/bin/ocadm {{ join_args }} -v 5&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†æ‰§è¡Œ&lt;code&gt;add-node&lt;/code&gt;ï¼Œè¾“å‡ºå¤šä¸€äº›äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.... [discovery] Failed to connect to API Server \&amp;quot;192.168.x.x:6443\&amp;quot;: token id \&amp;quot;qqrnpr\&amp;quot; is invalid for this cluster or it has expired. Use \&amp;quot;kubeadm token create\&amp;quot; on the control-plane node to create a new valid token&amp;quot;, &amp;quot;I0721 17:02:24.772935   37384 token.go:199] [discovery] Trying to connect to API Server \&amp;quot;192.168.x.x:6443\&amp;quot;&amp;quot;, &amp;quot;I0721 17:02:24.773719   37384 token.go:74] [discovery] Created cluster-info discovery client, requesting info from \&amp;quot;https://192.168.8.8:6443\&amp;quot;&amp;quot;, &amp;quot;I0721 17:02:24.776478   37384 token.go:202] [discovery] Failed to connect to API Server \&amp;quot;192.168.x.x:6443\&amp;quot;: token id \&amp;quot;xxxx\&amp;quot; is invalid for this cluster or it has expired. Use \&amp;quot;kubeadm token create\&amp;quot; on the control-plane node to create a new valid token&amp;quot;, &amp;quot;I0721 17:02:29.502523   37384 token.go:219] [discovery] abort connecting to API servers after timeout of 5m0s&amp;quot;, &amp;quot;error execution phase preflight: couldn&amp;#39;t validate the identity of the API Server: abort connecting to API servers after timeout of 5m0s&amp;quot;], &amp;quot;stdout&amp;quot;: &amp;quot;[preflight] Running pre-flight checks&amp;quot;, &amp;quot;stdout_lines&amp;quot;: [&amp;quot;[preflight] Running pre-flight checks
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸Šè®¡ç®—èŠ‚ç‚¹çœ‹çœ‹kublet æœåŠ¡çŠ¶æ€&lt;code&gt;systemctl status kubelet&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.285975   44259 reflector.go:125] k8s.io/kubernetes/pkg/kubelet/kubelet.go:445: Failed to list *v1.Service: Unauthorized
Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.289409   44259 kubelet.go:2252] node &amp;quot;sz-node-8-6&amp;quot; not found
Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.389659   44259 kubelet.go:2252] node &amp;quot;sz-node-8-6&amp;quot; not found
Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.460715   44259 file_linux.go:61] Unable to read config path &amp;quot;/etc/kubernetes/manifests&amp;quot;: path does not exist, ignoring
Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.486273   44259 reflector.go:125] k8s.io/kubernetes/pkg/kubelet/kubelet.go:454: Failed to list *v1.Node: Unauthorized
Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.489897   44259 kubelet.go:2252] node &amp;quot;sz-node-8-6&amp;quot; not found
Jul 21 17:11:12 localhost kubelet: E0721 17:11:12.590123   44259 kubelet.go:2252] node &amp;quot;sz-node-8-6&amp;quot; not found
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Node æ— æ³•æ³¨å†ŒæˆåŠŸï¼Œçœ‹ä¸‹kublet çš„é…ç½®åœ¨å“ªé‡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Unit]
Description=kubelet: The Kubernetes Node Agent
Documentation=https://kubernetes.io/docs/

[Service]
ExecStart=/usr/bin/kubelet
Restart=always
StartLimitInterval=0
RestartSec=10

[Install]
WantedBy=multi-user.target

# /usr/lib/systemd/system/kubelet.service.d/10-kubeadm.conf
# Note: This dropin only works with kubeadm and kubelet v1.11+
[Service]
Environment=&amp;quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&amp;quot;
Environment=&amp;quot;KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml&amp;quot;
# This is a file that &amp;quot;kubeadm init&amp;quot; and &amp;quot;kubeadm join&amp;quot; generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically
EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env
# This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use
# the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file.
EnvironmentFile=-/etc/sysconfig/kubelet
ExecStart=
ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¹æ¯”äº†å‡ ä¸ªé…ç½®ï¼Œå’Œå…¶ä»–è®¡ç®—èŠ‚ç‚¹æ²¡å•¥å·®åˆ«ï¼Œéƒ½æ˜¯é‡è£…è¿‡çš„æœºå™¨éƒ¨ç½²çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/etc/kubernetes/kubelet.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...
preferences: {}
users:
- name: default-auth
  user:
    client-certificate: /var/lib/kubelet/pki/kubelet-client-current.pem
    client-key: /var/lib/kubelet/pki/kubelet-client-current.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ£€æŸ¥ä¸‹è¯ä¹¦ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl x509 -in /var/lib/kubelet/pki/kubelet-client-current.pem  -noout -text
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            6f:58:0f:41:fb:....
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=kubernetes
        Validity
            Not Before: Jul 21 10:47:00 2023 GMT
            Not After : Jul 20 10:47:00 2024 GMT
        Subject: O=system:nodes, CN=system:node:sz
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ğŸ¤”å‘ç°Not  Before æ€ä¹ˆæ˜¯50åˆ†é’Ÿä¹‹åï¼ˆGMT+8ï¼‰ï¼Œæ£€æŸ¥æ‰€æœ‰masterï¼Œå‘ç°æœ‰ä¸€å°master æ—¶é—´å¼‚å¸¸ï¼Œä¿®æ­£è¿™å°master æ—¶é—´ã€‚é‡æ–°joinï¼Œç»ˆäºæˆåŠŸäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¥‡æ€ªçš„ntpd è¿›ç¨‹æ€ä¹ˆæŒ‚äº†ï¼Œå»ºè®®cloudpods ä¸»æœºç›‘æ§é¡¹é‡Œé¢å¢åŠ ä¸€ä¸ªæ—¶é—´ç›‘æ§ï¼Ÿ&lt;/p&gt;</content><category term="2023"></category><category term="kubernetes"></category><category term="cloudpods"></category></entry><entry><title>å¨è”é€šRAID1 ç£ç›˜æ•°æ®å¯¼å‡º</title><link href="https://fangpsh.github.io/posts/2023/2023-06-12.html" rel="alternate"></link><published>2023-06-12T00:00:00+08:00</published><updated>2023-06-12T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-06-12:/posts/2023/2023-06-12.html</id><summary type="html">&lt;p&gt;å…¬å¸ç”¨äº†å¤šå¹´çš„&lt;a href="https://www.qnap.com/en/product/ts-651"&gt;TS-651&lt;/a&gt; åäº†ï¼Œä¿®äº†æ²¡è·‘å‡ å¤©åˆåï¼ˆæ·±åœ³å¸‚å—å±±èµ›æ ¼æ–°è”åˆ›ç”µè„‘ç»è¥éƒ¨ ğŸ‘ ï¼‰ï¼Œ
æœ€å¼€å§‹æœç´¢&lt;code&gt;qnap ç¡¬ç›˜å¯¼å‡º&lt;/code&gt;ï¼Œé¦–å…ˆçœ‹åˆ°&lt;a href="https://post.smzdm.com/p/301806/"&gt;smzdm&lt;/a&gt;çš„å¸– â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å…¬å¸ç”¨äº†å¤šå¹´çš„&lt;a href="https://www.qnap.com/en/product/ts-651"&gt;TS-651&lt;/a&gt; åäº†ï¼Œä¿®äº†æ²¡è·‘å‡ å¤©åˆåï¼ˆæ·±åœ³å¸‚å—å±±èµ›æ ¼æ–°è”åˆ›ç”µè„‘ç»è¥éƒ¨ ğŸ‘ ï¼‰ï¼Œ
æœ€å¼€å§‹æœç´¢&lt;code&gt;qnap ç¡¬ç›˜å¯¼å‡º&lt;/code&gt;ï¼Œé¦–å…ˆçœ‹åˆ°&lt;a href="https://post.smzdm.com/p/301806/"&gt;smzdm&lt;/a&gt;çš„å¸–å­ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Qnapçš„ç£ç›˜åˆ†åŒºé‡‡ç”¨çš„æ˜¯md RAID+LVM2çš„ä¸¤å±‚ç»„ç»‡ç»“æ„ï¼Œå³ä½¿æˆ‘ä½¿ç”¨çš„æ˜¯Singleæ¨¡å¼åˆ†åŒºä¹Ÿæ˜¯ä¸€æ ·çš„ç»“æ„ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;çœ‹èµ·æ¥æœ‰æˆï¼Œå°è¯•ä¸€ä¸‹æ•°æ®å¯¼å‡ºï¼Œä¸»è¦å‚è€ƒè¿™ç¯‡æ–‡ç« &lt;a href="https://ripcaster.co.uk/Data_Recovery_from_Failed_QNAP_RAID_1"&gt;Data Recovery from Failed QNAP RAID 1 on a PC using Linux&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šåœ¨QNAP å®˜ç½‘&lt;a href="https://www.qnap.com.cn/zh-cn/nas-migration"&gt;æ•°æ®è¿ç§»å…¼å®¹æ€§æ£€æŸ¥&lt;/a&gt;å·¥å…·ä¸­ï¼ŒARM å’Œx86 çš„ç³»ç»Ÿæ˜¯ä¸èƒ½äº’ç›¸è¿ç§»çš„ï¼Œé‚£å¯èƒ½æ„å‘³ç€ARM çš„ç£ç›˜ï¼Œåœ¨x86 çš„æœåŠ¡å™¨ä¸Šæ˜¯ä¸æ˜¯ä¹Ÿä¸èƒ½å¯¼å‡º ğŸ¤”ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é£é™©æç¤ºï¼šç¡¬ç›˜æœ‰ä»·ï¼Œæ•°æ®æ— ä»·ï¼Œä»¥ä¸‹ä»…ä»£è¡¨ä¸ªäººæƒ…å†µã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…¬å¸çš„ç£ç›˜æ˜¯2å—ç›˜ï¼Œåšäº†RAID1ï¼Œé‚£ä¹ˆå•ç‹¬ä¸€å—ç›˜å®Œå…¨æ˜¯é•œåƒï¼Œå…ˆæ‹¿ä¸€å—ç›˜åšä¸‹å®éªŒï¼Œæåçš„è¯ï¼Œè¿˜å‰©ä½™ä¸€ä¸ªå†æä¸ªQNAPï¼ˆQuTScloudï¼‰ ä¹Ÿèƒ½è¯»å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;åŒäº‹å¸®å¿™å¼„äº†ä¸€å°Dell R430ï¼Œè£…äº†ä¸ªCentOS7ï¼Œå¸¦çš„é˜µåˆ—å¡æ˜¯&lt;code&gt;PERC H730 Mini&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿç›˜åœ¨Slot0ï¼ŒQnap æ‹†ä¸‹çš„ç£ç›˜åœ¨Slot1ï¼Œå…ˆå®‰è£…&lt;a href="https://docs.broadcom.com/docs-and-downloads/raid-controllers/raid-controllers-common-files/8-07-14_MegaCLI.zip"&gt;megacli&lt;/a&gt;ã€‚é¢˜å¤–è¯ï¼Œä¸Šæ¬¡å¸®åŒå­¦æŠ˜è…¾æ‰å‘ç°æ–°çš„å¡å·²ç»è¦ç”¨&lt;code&gt;storcli64&lt;/code&gt; äº†ã€‚&lt;/p&gt;
&lt;p&gt;ç¯å¢ƒå‡†å¤‡ï¼šå®‰è£…&lt;code&gt;lvm2&lt;/code&gt;ï¼Œ&lt;code&gt;mdadm&lt;/code&gt; &lt;/p&gt;
&lt;p&gt;æ’å…¥ç£ç›˜ï¼Œå†å°†å¯¹åº”slot ç£ç›˜è®¾ç½®ä¸º&lt;code&gt;JBOD&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./MegaCli64 -PDMakeJBOD -PhysDrv[32:1] -a0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;fdisk èƒ½çœ‹åˆ°è®¾å¤‡äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Disk /dev/sdb: 8001.6 GB, 8001563222016 bytes, 15628053168 sectors
Units = sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disk label type: gpt
Disk identifier: FDF2182D-83DC-47B6-8B39-01ECAF78BCEC


#         Start          End    Size  Type            Name
 1           40      1060289  517.7M  Microsoft basic primary
 2      1060296      2120579  517.7M  Microsoft basic primary
 3      2120584  15610264109    7.3T  Microsoft basic primary
 4  15610264112  15611324399  517.7M  Microsoft basic primary
 5  15611324408  15628031999      8G  Microsoft basic primary
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰«æä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mdadm --examine --scan
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;cat /proc/mdstat&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;md123 : inactive sdb4[27](S)
      530128 blocks super 1.0

md124 : inactive sdb5[0](S)
      8353780 blocks super 1.0

md125 : inactive sdb3[0]
      7804071616 blocks super 1.0

md126 : inactive sdb1[27](S)
      530108 blocks super 1.0

md127 : inactive sdb2[2](S)
      530124 blocks super 1.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•°æ®åœ¨sdb3/md125ã€‚å‚è€ƒsmzdmé‚£ä¸ªæ•™ç¨‹ï¼Œæ‰§è¡Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mdadm -A --verbose --run ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è®°å¾—æœ‰ä¸ªerrorï¼Œæç¤ºè®¾å¤‡åœ¨ä½¿ç”¨ä¸­ï¼Œè¿˜æ˜¯ä»€ä¹ˆé”™è¯¯ï¼ˆåå°åœ¨è‡ªåŠ¨æŒ‚è½½äº†ï¼Ÿï¼‰ï¼Œæ‰‹å·¥stop ä¸€ä¸‹ï¼Œå†æŒ‚è½½å°±å¥½äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mdadm --stop /dev/md125
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mdadm --run /dev/md125
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæ—¶å€™å†&lt;code&gt;cat /proc/mdstat&lt;/code&gt; èƒ½çœ‹åˆ°&lt;code&gt;active&lt;/code&gt; äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Personalities : [raid1]
md125 : active raid1 sdb3[0]
      7804071616 blocks super 1.0 [2/1] [U_]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¥ç€æ‰§è¡Œ&lt;code&gt;pvdisplay&lt;/code&gt;ï¼Œä½†æ˜¯æˆ‘å¹¶æœªçœ‹åˆ°&lt;code&gt;/dev/md125&lt;/code&gt; è¿™ä¸ªPVï¼Œ&lt;/p&gt;
&lt;p&gt;æœäº†ä¸‹ï¼Œéœ€è¦æ‰§è¡Œ&lt;code&gt;pvscan --cache&lt;/code&gt; (Updates the runtime state for all lvm devices)ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  --- Physical volume ---
  PV Name               /dev/md125
  VG Name               vg289
  PV Size               &amp;lt;7.27 TiB / not usable 1.65 MiB
  Allocatable           yes (but full)
  PE Size               4.00 MiB
  Total PE              1905290
  Free PE               0
  Allocated PE          1905290
  PV UUID               hkvib9-WQfS-iyOu-b2U9-1LNa-5I2e-O2Vjwb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;lvscan çœ‹ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  inactive          &amp;#39;/dev/vg289/lv546&amp;#39; [74.42 GiB] inherit
  inactive            &amp;#39;/dev/vg289/lv3&amp;#39; [&amp;lt;7.20 TiB] inherit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæ—¶å€™å°è¯•å»æŒ‚è½½&lt;code&gt;/dev/vg289/lv3&lt;/code&gt; å‘ç°è®¾å¤‡ä¸å­˜åœ¨ï¼Œéœ€è¦å†æ‰§è¡Œä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;lvchange -ay /dev/vg289/lv3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†&lt;code&gt;mount&lt;/code&gt; å°±å¯ä»¥äº†ï¼Œå¤‡ä»½å®Œæ•°æ®åï¼Œå¸è½½çš„è¯æŒ‰ ripcaster æ•™ç¨‹æ–‡æœ«è„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;LUKS åŠ å¯†ç›˜çš„æŒ‚è½½å‰é¢æ­¥éª¤ä¸€æ ·ï¼Œå¢åŠ ä¸€ä¸ªè§£å¯†è¿‡ç¨‹ï¼š
å‚è€ƒ &lt;a href="https://www.linux-howto.info/mount-qnap-encrypted-volume/"&gt;mount-qnap-encrypted-volume&lt;/a&gt;ï¼Œ
æ–‡ä¸­  storage_util é‚£ä¸ªå·¥å…·æ˜¯qnap ä¸“æœ‰çš„ï¼Œå¯ä»¥ç”¨openssl ä»£æ›¿ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl passwd -1 -salt YCCaQNAP &amp;#39;å¯†ç &amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2023"></category><category term="nas"></category><category term="qnap"></category><category term="raid"></category></entry><entry><title>è¯·ç»™åŸŸåè§£æGEOçº¿è·¯é…ç½®å…œåº•çº¿è·¯</title><link href="https://fangpsh.github.io/posts/2023/2023-06-09.html" rel="alternate"></link><published>2023-06-09T00:00:00+08:00</published><updated>2023-06-09T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-06-09:/posts/2023/2023-06-09.html</id><summary type="html">&lt;p&gt;é˜¿é‡Œäº‘äº‘è§£æã€è…¾è®¯DNSPodã€AWS Route53 ç­‰å‡æ”¯æŒGEOçº¿è·¯è§£æï¼Œå¯ä»¥çœ‹é˜¿é‡Œè¿™ä¸ª&lt;a href="https://help.aliyun.com/document_detail/29730.html"&gt;æ–‡æ¡£&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®ç°åŸç†&lt;br&gt;
äº‘è§£ææ˜¯é€šè¿‡è¯†åˆ«LocalDNSçš„å‡ºå£IPï¼Œæ¥åˆ¤æ–­è®¿é—®è€…æ¥æºã€‚&lt;br&gt;
å¦‚æœLocalDNSæ”¯æŒEDNS  &lt;br&gt;
å›  â€¦&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;é˜¿é‡Œäº‘äº‘è§£æã€è…¾è®¯DNSPodã€AWS Route53 ç­‰å‡æ”¯æŒGEOçº¿è·¯è§£æï¼Œå¯ä»¥çœ‹é˜¿é‡Œè¿™ä¸ª&lt;a href="https://help.aliyun.com/document_detail/29730.html"&gt;æ–‡æ¡£&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å®ç°åŸç†&lt;br&gt;
äº‘è§£ææ˜¯é€šè¿‡è¯†åˆ«LocalDNSçš„å‡ºå£IPï¼Œæ¥åˆ¤æ–­è®¿é—®è€…æ¥æºã€‚&lt;br&gt;
å¦‚æœLocalDNSæ”¯æŒEDNS  &lt;br&gt;
å› ä¸ºäº‘è§£æDNSæ”¯æŒ edns-client-subnetï¼Œæ‰€ä»¥åœ¨è·å–è®¿é—®è€…æ¥æºIPæ—¶ï¼Œä¼˜å…ˆè·å– edns-client-subnet æ‰©å±•é‡Œæºå¸¦çš„IPï¼Œå¦‚æœedns-client-subnet æ‰©å±•é‡Œå­˜åœ¨IPï¼Œäº‘è§£æDNSä¼šä»¥è¯¥IPæ¥åˆ¤æ–­è®¿é—®è€…çš„åœ°ç†ä½ç½® ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»¥LocalDNSå‡ºå£IPæ¥åˆ¤æ–­è®¿é—®è€…çš„åœ°ç†ä½ç½®ã€‚&lt;br&gt;
å¦‚æœLocalDNSä¸æ”¯æŒEDNS    &lt;br&gt;
LocalDNSä¼šè¿­ä»£è¯·æ±‚è‡³äº‘è§£æDNSï¼Œäº‘è§£æDNSæ ¹æ®è®¿é—®è€…LocalDNSå‡ºå£IPæ¥åˆ¤æ–­è®¿é—®è€…çš„åœ°å€ä½ç½®ï¼Œå®ç°æ™ºèƒ½è§£æã€‚  &lt;br&gt;
å¦‚æœLocalDNSå˜ç›¸æ”¯æŒEDNS    &lt;br&gt;
ç”¨æˆ·å‘èµ·DNSè¯·æ±‚ï¼Œé€’å½’åˆ°LocalDNSï¼Œåˆ™LocalDNSå°†æœ¬æ¬¡è¯·æ±‚å‘é€åˆ°äºŒçº§èŠ‚ç‚¹ï¼Œé€šè¿‡äºŒçº§èŠ‚ç‚¹å‘äº‘è§£æDNSå‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶äº‘è§£æDNSä¼šæ ¹æ®LocalDNSäºŒçº§èŠ‚ç‚¹çš„åœ°åŸŸä½ç½®è¿”å›å…·ä½“
çš„ç»†åˆ†çº¿è·¯è§£æç»“æœã€‚  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸Šé¢è°ƒåº¦é çš„å°±æ˜¯IPåº“ï¼Œè°ƒåº¦çš„å‡†ç¡®æ€§å®Œå…¨ä¾èµ–è¿™ä¸ªåº“ã€‚
èƒ½ä¸èƒ½å‡†ç¡®çš„å°†ä½ æƒ³è¦çš„ç”¨æˆ·è°ƒåº¦åˆ°å¯¹åº”çš„èŠ‚ç‚¹ï¼Œè¿™é‡Œé¢ä¼šæœ‰2ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‚å•†çš„IPåº“å‡†ä¸å‡†ï¼›&lt;/li&gt;
&lt;li&gt;å‚å•†çš„ç ”å‘æ€ä¹ˆå¤„ç†IPåº“å­—æ®µå’ŒGEO åŒ¹é…é€»è¾‘ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;IPIP.NETåˆ›å§‹äººé«˜æ˜¥æ™–å†™è¿‡ä¸€ä¸ªç³»åˆ—ï¼š&lt;a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzA4NDMzODY1MQ==&amp;amp;action=getalbum&amp;amp;album_id=2292580962339192832&amp;amp;scene=173&amp;amp;from_msgid=2247484081&amp;amp;from_itemidx=1&amp;amp;count=3&amp;amp;nolastread=1#wechat_redirect"&gt;DNSæ™ºèƒ½è§£æåŠŸèƒ½è¯„æµ‹&lt;/a&gt;ï¼Œè¯»å®Œè¿™ä¸ªç³»åˆ—æ–‡æ¡£ï¼Œæˆ‘ä»¬å°±èƒ½å‘ç°ï¼Œé™¤äº†ä½¿ç”¨äº†IPIP çš„çš„DNSPodå’ŒDNS.COMï¼Œå…¶ä»–å‚å•†éƒ½ä¸€å¡Œç³Šæ¶‚ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ è®¤ä¸ºé«˜æ˜¥æ™–æ˜¯è‡ªå–è‡ªå¤¸ï¼Œé‚£å¤§å¯å®é™…æµ‹è¯•ä¸€ä¸‹ã€‚ä»æˆ‘çš„ä½“éªŒæ¥çœ‹ï¼Œä»–è¯´çš„æ²¡é”™ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œçš„æœ¬è´¨é—®é¢˜å°±æ˜¯IPIPçš„æ•°æ®å’Œå‡†ç¡®æ€§å¥½äº†ä¸€å¤§æˆªã€‚å°è±¡é˜¿é‡Œæ˜¯æœ‰é‡‡è´­IPIPï¼Œä½†æ˜¯ä¼¼ä¹æ˜¯åªç»™äº†CDN ä¸šåŠ¡ç”¨ï¼Œé˜¿é‡Œäº‘è§£æè¿˜è‡ªå·±æäº†ä¸€ä¸ªIPåº“ï¼Œå’ŒIPIP.NET é—¹äº†ä¸€æ®µå®˜å¸åé“æ­‰ä¸‹çº¿äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šé—®AWS æ˜¯ä¸æ˜¯å¥½ä¸€ç‚¹ï¼Œå¤´éƒ¨å¤§å‚ï¼Œåšå›½å¤–ä¸šåŠ¡çš„ï¼Œå¯¹å›½å¤–åˆ†å›½å®¶åœ°åŒºè§£æç”¨Route53æ›´å¥½ä¸€ç‚¹ï¼Ÿ å®é™…çš„æƒ…å†µæ˜¯Route53 ç”¨çš„æ˜¯Maxmindï¼Œè€ŒMaxmind çš„æ•°æ®ä»æˆ‘è¿‡å¾€çš„ç»éªŒæ¥çœ‹ï¼ŒåŠæ—¶æ€§å’Œå‡†ç¡®æ¯”IPIP å·®å¾ˆå¤šï¼Œæœ‰æ—¶å€™ç”šè‡³æ¯”IP2Location è¿˜å·®ã€‚ï¼ˆè‡³äºRoute53 æƒå¨èŠ‚ç‚¹çš„ç½‘ç»œæ€§èƒ½ï¼Œæš‚ä¸è®¨è®ºï¼Œåªè®¨è®ºçº¿è·¯çš„å‡†ç¡®æ€§çš„ã€‚å¯¹äº†ï¼ŒRoute53 æŒ‰è§£ææ¬¡æ•°æ”¶è´¹ï¼Œä¹Ÿå¤ªè´µäº†ã€‚ã€‚åˆ«ä¸Šè´¼èˆ¹ï¼‰&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œæˆ‘ä¸ªäººæ„Ÿè§‰å¦‚æœIPIP.NET æ‰“90åˆ†ï¼Œé‚£Maxmind å’ŒIP2Location å°±å¤§æ¦‚60~70åˆ†ï¼ŒåŸºäºä»–ä»¬åšå‡ºæ¥çš„äº§å“ä¹Ÿå°±å·®ä¸å¤šã€‚&lt;/p&gt;
&lt;p&gt;å›åˆ°DNSè§£æè¿™ä¸ªå…œåº•çº¿è·¯é—®é¢˜ï¼Œå¦‚æœDNS çš„IPåº“ä¸å‡†ï¼Œç‰¹åˆ«æ˜¯å¯¹ä¸€äº›localdns çš„å‡ºå£ipï¼ˆå›çœ‹ä¸‹ä¸Šé¢é˜¿é‡Œäº‘çš„çš„åŸç†ï¼‰è¯†åˆ«ä¸å‡†ï¼Œ&lt;/p&gt;
&lt;h4&gt;ä¾‹1&lt;/h4&gt;
&lt;p&gt;ä¾‹å¦‚ä¸€ä¸ªå¹¿ä¸œ è”é€šçš„å‡ºå£IPï¼ŒIPåº“è¯†åˆ«å‡ºæ¥å¯èƒ½æ˜¯ &lt;code&gt;ä¸­å›½ è”é€š&lt;/code&gt;ï¼Œæˆ–è€…åªæœ‰&lt;code&gt;è”é€š&lt;/code&gt;ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœä½ çš„çº¿è·¯æ˜¯è¿™ä¹ˆé…ç½®çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤ -&amp;gt; x.y.z.0&lt;/li&gt;
&lt;li&gt;ååŒ— ç”µä¿¡ -&amp;gt; x.y.z.1&lt;/li&gt;
&lt;li&gt;åå— è”é€š -&amp;gt; x.y.z.2&lt;/li&gt;
&lt;li&gt;ååŒ— ç§»åŠ¨ -&amp;gt; x.y.z.3&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é‚£ä¹ˆå°±ä¼šåŒ¹é…åˆ° &lt;code&gt;é»˜è®¤ x.y.z.0&lt;/code&gt;ï¼Œå¦‚æœè¿™ä¸ªIP ä¸æ˜¯BGP çº¿è·¯ï¼Œå°±è·¨ç½‘ç»•äº†ä¸€åœˆã€‚
åŠ ä¸€ä¸ª&lt;code&gt;è”é€š -&amp;gt; x.y.z.4&lt;/code&gt; å¯ä»¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚&lt;/p&gt;
&lt;h4&gt;ä¾‹2&lt;/h4&gt;
&lt;p&gt;å¦‚æœä½ çš„è§£æçº¿è·¯æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”µä¿¡ -&amp;gt; x.y.z.0&lt;/li&gt;
&lt;li&gt;è”é€š -&amp;gt; x.y.z.1&lt;/li&gt;
&lt;li&gt;ç§»åŠ¨ -&amp;gt; x.y.z.2&lt;/li&gt;
&lt;li&gt;å¹¿ç”µ -&amp;gt; x.y.z.3&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;li&gt;å¢ƒå¤– -&amp;gt; x.y.z.101&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ˜¯çš„ï¼Œä½ æ˜¯æŠŠå‚å•†æ”¯æŒçš„åˆ†è¿è¥å•†çº¿è·¯éƒ½åŠ ä¸Šäº†ï¼Œä½†æ˜¯å°±æ²¡åŠ &lt;code&gt;é»˜è®¤&lt;/code&gt;çº¿è·¯ï¼Œ&lt;strong&gt;ä½†æ˜¯ä¹Ÿä¼šæœ‰å°‘æ•°å›½å†…ç”¨æˆ·çš„IPï¼ŒIPåº“è¯»å‡ºæ¥ä¸å¸¦ISP ä¿¡æ¯&lt;/strong&gt;ï¼Œé‚£è¿™éƒ¨åˆ†ç”¨æˆ·è¿™ä¸ªæ—¶å€™ä¼šæ‹¿ä¸åˆ°è§£æç»“æœã€‚&lt;/p&gt;
&lt;h4&gt;ä¾‹3&lt;/h4&gt;
&lt;p&gt;æŒ‰æ´²é…ç½®äº†è§£æçº¿è·¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é»˜è®¤-&amp;gt; è…¾è®¯åŒ—äº¬IP&lt;/li&gt;
&lt;li&gt;äºšæ´²-&amp;gt; é˜¿é‡Œé¦™æ¸¯IP&lt;/li&gt;
&lt;li&gt;æ¬§æ´²-&amp;gt; AWS å¾·å›½IP&lt;/li&gt;
&lt;li&gt;å¤§æ´‹æ´²..&lt;/li&gt;
&lt;li&gt;åŒ—ç¾æ´²..&lt;/li&gt;
&lt;li&gt;..æ´²&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªå¢ƒå¤–IP è¯†åˆ«å‡ºæ¥æ˜¯ç©ºï¼Œä¼šç›´æ¥èµ°åˆ°&lt;code&gt;é»˜è®¤ è…¾è®¯åŒ—äº¬&lt;/code&gt;ï¼Œè¿™ä¸ªæ—¶å€™ä¿é™©ä¸€ç‚¹åŠ ä¸Š&lt;code&gt;å¢ƒå¤–çº¿è·¯&lt;/code&gt;ã€‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“DNSçš„ç ”å‘ä¼šå¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µï¼Œ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¢ƒå¤–çº¿è·¯ï¼Œæ˜¯åŒ¹é…æ˜ç¡®äº†å¢ƒå¤–åœ°åŒºå›½å®¶çš„ï¼Ÿå¯¹äºæ— å›½å®¶çš„ï¼Œèµ°é»˜è®¤çº¿è·¯ï¼›&lt;/li&gt;
&lt;li&gt;å¢ƒå¤–çº¿è·¯ï¼Œæ˜¯åŒ¹é…æ‰€æœ‰é™¤äº†ä¸­å›½å¤§é™†æ„å¤–çš„IPï¼Ÿå¯¹äºæ— å›½å®¶çš„ï¼Œå¦‚æœæœ‰å¢ƒå¤–çº¿è·¯ï¼Œèµ°å¢ƒå¤–çº¿è·¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;BTW. å¦‚æœä¸Šé¢è¿™ç§æƒ…å†µï¼Œä½ æ€•è‡ªå·±ä¸€ä¸å°å¿ƒæ²¡æœ‰æŠŠ&lt;code&gt;æ´²&lt;/code&gt;çº¿è·¯åŠ å…¨ï¼Œé‚£æ›´åº”è¯¥åŠ ä¸€ä¸ª&lt;code&gt;å¢ƒå¤–&lt;/code&gt;çº¿è·¯å…œåº•ã€‚&lt;/p&gt;
&lt;p&gt;BTW2. Route53 æ²¡æœ‰å¢ƒå¤–çº¿è·¯ï¼Œä»–çš„é»˜è®¤æ˜¯å…¨çƒï¼Œä½ éœ€è¦å•ç‹¬æ·»åŠ ä¸­å›½çº¿è·¯ï¼Œé€»è¾‘å’Œå›½å†…å‚å•†ç›¸åã€‚&lt;/p&gt;
&lt;h4&gt;ä¾‹4&lt;/h4&gt;
&lt;p&gt;ä½ å†™äº†ä¸€å †è„šæœ¬ï¼ŒæŒ‰æ¯ä¸ªå›½å®¶åˆ†çº¿è·¯é…ç½®äº†ï¼Œä½†æ˜¯å“ªå¤©è„šæœ¬å‡ºé”™ï¼Œå°‘æ·»åŠ äº†ä¸€ä¸ªå›½å®¶æˆ–è€…è¿ç»´è¯¯åˆ äº†ä¸€ä¸ªå›½å®¶ï¼Œè¿™ä¸ªå›½å®¶ç›´æ¥èµ°åˆ°é»˜è®¤çº¿è·¯ï¼Œé»˜è®¤çº¿è·¯æŒ‡å‘çš„å¯èƒ½æ˜¯åŒ—äº¬ã€‚ ï¼ˆå¦‚æœæ²¡æœ‰é»˜è®¤çº¿è·¯ï¼Œå°±æ›´æƒ¨äº†ï¼‰&lt;/p&gt;
&lt;p&gt;ä½ å†™äº†ä¸€å †è„šæœ¬ï¼ŒæŒ‰æ¯ä¸ªå›½å®¶åˆ†çº¿è·¯é…ç½®äº†ï¼Œä½†æ˜¯IPåº“çš„å¯¹äºä¸€äº›å°å›½å®¶å’Œäº‰è®®åœ°åŒºçš„ä»£ç å’ŒDNSè°ƒåº¦ç³»ç»Ÿä¸ä¸€è‡´ï¼ŒDNS ç ”å‘æ²¡å¤„ç†æˆ–è€…ä¸æƒ³å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå›½å®¶ä¹Ÿä¼šèµ°åˆ°é»˜è®¤çº¿è·¯ã€‚&lt;/p&gt;
&lt;h4&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;è¿™æ˜¯å°æ¦‚ç‡äº‹ä»¶ï¼Œå‡ºé”™å½±å“çš„åŠ¿å¿…æ˜¯å°éƒ¨åˆ†ç”¨æˆ·ï¼Œåˆæéš¾å‘ç°ã€‚&lt;br&gt;
å•°å”†äº†è¿™ä¹ˆå¤šï¼Œå¾ˆç®€å•çš„ä¸€ä»¶äº‹ï¼Œæ—¶åˆ»ç‰¢è®°é…ä¸Šé»˜è®¤çº¿è·¯å…œåº•ã€‚&lt;br&gt;
å½“æ·»åŠ äº†æŒ‰å›½å®¶ï¼ŒæŒ‰åœ°åŒº+è¿è¥å•†åˆ†çº¿è·¯è§£æï¼Œè®°å¾—æŒ‰æƒ…å†µé…ç½®å¤§æ´²çº¿è·¯ï¼Œè¿è¥å•†çº¿è·¯ï¼Œå¢ƒå¤–çº¿è·¯å…œåº•ã€‚  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;IP åº“å‚å•†åœ¨åšIP  å®šä½æ—¶ï¼Œç†æƒ³çš„ä¹Ÿåº”è¯¥æ˜¯å‡†ç¡®åº¦ä¼˜å…ˆï¼Œè€Œä¸æ˜¯è¦†ç›–åº¦ä¼˜å…ˆã€‚
ä»€ä¹ˆæ˜¯å‡†ç¡®åº¦ä¼˜å…ˆå‘¢? å³å¦‚æœä½ åƒä¸å‡†ä¸€ä¸ªIPæ˜¯ä¸æ˜¯å¹¿ä¸œçš„ï¼Œå°±ä¸è¦çæ ‡ï¼Œåªæ ‡åˆ°ä¸­å›½å°±å¥½äº†ã€‚æˆ‘è®°å¾—IPIP.NET æ˜¯è¿™ä¹ˆåšï¼Œå¾ˆæ—©ä¹‹å‰è·‘è¿‡ä¸€ä¸ªæµ‹è¯•ï¼Œå½“æ—¶çœ‹åˆ°å¯¹äºæ•™è‚²ç½‘çš„IPï¼ŒIPIP.NETæ ‡çš„éƒ½æ˜¯å‡†ç¡®åº¦ä¼˜å…ˆï¼Œä¸ä¼šçæ ‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å›½å†…æœ‰ä¸€äº›IPåº“å‚å•†ï¼Œé€‰æ‹©è¦†ç›–åº¦ä¼˜å…ˆï¼Œä»–ä¸€å®šè¦æ ‡åˆ°åŸå¸‚æˆ–è€…ä¸€çº§è¡Œæ”¿åŒºï¼Œå³ä½¿ä»–åƒä¸å‡†åé¢æ˜¯ä¸æ˜¯å¯¹çš„ã€‚æ ‡ä¸Šå†è¯´ï¼Œç„¶åå¹å˜˜è‡ªå·±è¦†ç›–åº¦99.999%ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‡è®¾DNS å‚å•†ç”¨çš„æ˜¯å‡†ç¡®åº¦ä¼˜å…ˆçš„ï¼Œé‚£æˆ‘ä»¬å°±æ›´åº”è¯¥è®¾ç½®å…œåº•ç­–ç•¥ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯è¦†ç›–åº¦ä¼˜å…ˆçš„çš„å‘¢ï¼Ÿåªèƒ½è¯´å°‘ç”¨ï¼Œèƒ½ç”¨å°½é‡åªåŠ é»˜è®¤çº¿è·¯ã€å¤§è¿è¥çº¿è·¯ï¼Œä¸šåŠ¡ä¸Šå°‘ä¾èµ–DNS è°ƒåº¦çš„å‡†ç¡®æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ğŸ´åğŸ§¨&lt;/p&gt;
&lt;p&gt;ç°åœ¨å…¬å¸éƒ¨åˆ†ä¸šåŠ¡éƒ¨é—¨ä½¿ç”¨äº†å¤§é‡åˆ†çº¿è·¯è§£æçš„æƒ…å†µï¼Œåˆ†å›½å®¶ã€åœ°åŒºï¼Œå°†ç”¨æˆ·å¼•å¯¼åˆ°ä¸åŒèŠ‚ç‚¹ä¸Šã€‚å»å¹´æé†’äº†ä¸šåŠ¡éƒ¨é—¨å’Œæ€»ç›‘ï¼Œæ·»åŠ å’Œæ£€æŸ¥åŠ æ´²çº¿è·¯ã€é»˜è®¤çº¿è·¯å…œåº•è¢«æ— è§†ï¼Œä»Šå¹´å°±æ¼äº†ä¸ªå›½å®¶çº¿è·¯è¢«å®¢æˆ·æŠ•è¯‰ ğŸ¤¦â€â™‚ï¸ã€‚&lt;/p&gt;</content><category term="2023"></category><category term="dns"></category></entry><entry><title>è½»é‡çº§åŠå…¬å®¤æ— æ„ŸçŸ¥è·¨å¢ƒåŠ é€Ÿæ–¹æ¡ˆ</title><link href="https://fangpsh.github.io/posts/2023/2023-04-23.html" rel="alternate"></link><published>2023-04-23T00:00:00+08:00</published><updated>2023-04-23T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-04-23:/posts/2023/2023-04-23.html</id><summary type="html">&lt;p&gt;ä¹‹å‰é€›V2EX çœ‹åˆ°ä¸€ä¸ªç½‘å‹çš„å¸–å­ï¼šâ€œ&lt;a href="https://www.v2ex.com/t/928907"&gt;è¯·æ•™å…¬å¸å†…éƒ¨å¦‚ä½•å®ç°æ— æ„ŸçŸ¥è·¨å¢ƒåŠ é€Ÿ&lt;/a&gt;â€ï¼ŒæŠŠæµ·å¤–IP å…¨éƒ¨èµ°åˆ°ä»£ç†ç½‘å…³ï¼Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒé«˜ã€‚å¦‚ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¹‹å‰é€›V2EX çœ‹åˆ°ä¸€ä¸ªç½‘å‹çš„å¸–å­ï¼šâ€œ&lt;a href="https://www.v2ex.com/t/928907"&gt;è¯·æ•™å…¬å¸å†…éƒ¨å¦‚ä½•å®ç°æ— æ„ŸçŸ¥è·¨å¢ƒåŠ é€Ÿ&lt;/a&gt;â€ï¼ŒæŠŠæµ·å¤–IP å…¨éƒ¨èµ°åˆ°ä»£ç†ç½‘å…³ï¼Œç»´æŠ¤æˆæœ¬æ¯”è¾ƒé«˜ã€‚å¦‚æœåªæ˜¯ç®€å•çš„Web åŠ é€Ÿï¼ŒDNS åŠ«æŒ+SNIProxy æ˜¯æ›´è½»é‡çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;~~æœ‰&lt;a href="https://docs.fortinet.com/document/fortigate/6.2.14/cookbook/80739/dynamic-application-steering-with-lowest-cost-and-best-quality-strategies"&gt;Fortinet&lt;/a&gt;ã€&lt;a href="https://bbs.panabit.com/thread-12376-1-1.html"&gt;Panabit&lt;/a&gt;çš„åœŸè±ªæ— é¡»æ¥ç€çœ‹ ğŸ¤‘~~&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ¡ˆçš„å±€é™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åªèƒ½åŠ é€Ÿhttpã€https æµé‡ï¼›&lt;/li&gt;
&lt;li&gt;github.comï¼ˆhttp2ï¼‰ä¼¼ä¹æœ‰å¼‚å¸¸ï¼Œè§ä¸‹æ–‡è§£å†³æ–¹æ³•ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æŒ‰ç½‘å‹è¯´çš„è”é€š/ç”µä¿¡çš„MPLSï¼Œ1000å…ƒ/M/(æœˆ?)ï¼Œå¦‚æœæ˜¯æˆ‘çš„è¯ï¼Œå°±ä¼šæå‡ ä¸ªæœºåœºè´¦å·ï¼Œä¸€ä¸ªæœˆæˆæœ¬ç™¾æ¥å—è§£å†³ã€‚  &lt;/p&gt;
&lt;p&gt;å½“ç„¶æˆ‘ç‰¢è®°å‰è¾ˆä»¬çš„è¡€æ³ªæ•™è®­ï¼šåœ¨å·¥ä½œåœºåˆä¸­ï¼Œèƒ½ç”¨é’±è§£å†³çš„ï¼Œå°½é‡ç”¨é’±ï¼ˆä¹™æ–¹ï¼‰è§£å†³ï¼Œè¦ä¸ç„¶å°±æ˜¯ç»™è‡ªå·±æ‰¾äº‹äº†ğŸ•ã€‚  &lt;/p&gt;
&lt;p&gt;è¯´å›æ­£äº‹ï¼Œç”»ä¸ªè‰å›¾ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   query:www.google.com â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º           â”‚
             â”‚  client  â”‚                        â”‚ local dns â”‚
             â”‚          â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
             â””â”€â”€â”€â”¬â”€â”€â”€â–²â”€â”€â”˜    A:192.168.11.11     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚   â”‚
                 â”‚   â”‚
                 â”‚   â”‚
         http reqâ”‚   â”‚ http rsp
                 â”‚   â”‚                      â”¼
                 â”‚   â”‚
                 â”‚   â”‚
             â”Œâ”€â”€â”€â–¼â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                  â”‚
             â”‚    proxy         â”‚
             â”‚  192.168.11.11   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                             â”‚
                             â”‚internal
                             â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                          â”‚
       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
       â”‚ â”‚ SNIPROXY  â”‚  OUTPUT â”‚            â”‚     â”‚
       â”‚ â”‚ http:80   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   CLASH    â”‚     â”‚
       â”‚ â”‚ https:443 â”‚ IPTABLESâ”‚   TPROXY   â”‚     â”‚
       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
       â”‚                                          â”‚
       â”‚                                          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰¾ä¸€å°æœºå™¨è£…ä¸Šclash/v2ray/sing-box ç­‰ï¼Œä¸‹é¢ä»¥clashä¸ºä¾‹ã€‚&lt;/p&gt;
&lt;p&gt;local dns ç”¨adguard-homeã€bindã€dnsmasqã€pdns-recursoréƒ½å¯ï¼ŒæŠŠè¦åŠ é€Ÿçš„å­åŸŸååŠ«æŒè§£æåˆ°ä»£ç†æœºIPã€‚&lt;/p&gt;
&lt;h2&gt;SNIProxy é…ç½®&lt;/h2&gt;
&lt;p&gt;ä»&lt;a href="https://github.com/dlundquist/sniproxy"&gt;å®˜æ–¹ä»“åº“&lt;/a&gt;æ‹‰ä»£ç ç¼–è¯‘å®‰è£…ï¼Œæˆ–è€…å‘è¡Œç‰ˆä»“åº“å†…æ‰¾æ‰¾ã€‚é…ç½®å°±ä¸€å¥è¯ï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå¦‚æœä¸æƒ³æœ‰äººéšæ„æœ¬åœ°host ä¸‹åŸŸåå°±èƒ½èµ°è¿™ä¸ªä»£ç†ä¼ é€å‡ºå»ï¼Œå°±å†™ä¸‹å…·ä½“åŸŸåï¼Œè¯­æ³•å®˜æ–¹æ‰‹å†Œã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨clash é‚£é‡Œæ§åˆ¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;table http_hosts {
    .* *:80
}

table https_hosts {
    .* *:443
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Clash é…ç½®&lt;/h2&gt;
&lt;p&gt;å°±ä¸€å¥è¯ï¼Œå…¶ä»–å’Œæ—¥å¸¸é…ç½®æ²¡å·®åˆ«ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tproxy-port: 7891
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è‹¥ç”¨éç‰¹æƒç”¨æˆ·èµ·ï¼Œclash.serviceè®°å¾—è®¾ç½®Capabilityã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_SYS_PTRACE CAP_DAC_READ_SEARCH
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_SYS_PTRACE CAP_DAC_READ_SEARCH
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–åœ¨éƒ¨ç½²æ­¤ç±»ä»£ç†æ—¶ï¼Œå»ºè®®æ‹’ç»æ‰å†…ç½‘åŸŸåï¼ˆå†…ç½‘åœ°å€ï¼‰ï¼Œä»¥å…å¢åŠ è¿½è¸ªå®¡è®¡å¤æ‚åº¦ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;- GEOIP,LAN,REJECT
- DOMAIN-SUFFIX,oa.com,REJECT
- ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ä¸»æœºé…ç½®&lt;/h2&gt;
&lt;p&gt;ä¸»è¦æ¶‰åŠç­–ç•¥è·¯ç”±å’Œiptablesï¼Œæ­£å¸¸åªéœ€è¦è®¾ç½®OUTPUT chain å³å¯ï¼Œä½†æ˜¯ä¸ºäº†è§£å†³ä¸‹æ–‡githubçš„é—®é¢˜ï¼Œä¹Ÿé…ç½®ä¸‹FORWARDã€‚&lt;/p&gt;
&lt;p&gt;è®©ç‰¹æ®Šæ ‡è®°çš„åŒ…æµå‘æœ¬æœºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# è®°å¾—é…ç½®å¼€å¯å¯åŠ¨ç”Ÿæ•ˆ
ip route flush table 100
ip route add local default dev lo table 100
ip rule add fwmark 1 table 100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;iptablesï¼ŒæŠ„ç½‘å‹çš„ï¼Œè®°å¾—åšæŒä¹…åŒ–ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;iptables -F
iptables -X
iptables -t nat -F
iptables -t mangle -F
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT

iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

iptables -A INPUT -s 127.0.0.1 -j ACCEPT
iptables -A INPUT -s 192.168.0.0/16 -p tcp  -j ACCEPT

# RETURN LOCAL AND LANS
iptables -t mangle -A clash -d 0.0.0.0/8 -j RETURN
iptables -t mangle -A clash -d 10.0.0.0/8 -j RETURN
iptables -t mangle -A clash -d 127.0.0.0/8 -j RETURN
iptables -t mangle -A clash -d 169.254.0.0/16 -j RETURN
iptables -t mangle -A clash -d 172.16.0.0/12 -j RETURN
iptables -t mangle -A clash -d 192.168.0.0/16 -j RETURN
iptables -t mangle -A clash -d 192.0.0.0/24 -j RETURN
iptables -t mangle -A clash -d 192.0.2.0/24 -j RETURN
iptables -t mangle -A clash -d 198.18.0.0/15 -j RETURN
iptables -t mangle -A clash -d 198.51.100.0/24 -j RETURN
iptables -t mangle -A clash -d 203.0.113.0/24 -j RETURN
iptables -t mangle -A clash -d 255.255.255.255/32 -j RETURN
iptables -t mangle -A clash -d 100.64.0.0/10 -j RETURN
iptables -t mangle -A clash -d 224.0.0.0/4 -j DROP
iptables -t mangle -A clash -d 240.0.0.0/4 -j RETURN
# FORWARD ALL
iptables -t mangle -A clash -p udp -j TPROXY --on-port 7891 --tproxy-mark 1
iptables -t mangle -A clash -p tcp -j TPROXY --on-port 7891 --tproxy-mark 1

#iptables -t mangle -A OUTPUT -j clash
iptables -t mangle -A PREROUTING -j clash


iptables -t mangle -N LOCAL_DIVERT
iptables -t mangle -A LOCAL_DIVERT -d 192.168.0.0/16 -j RETURN
iptables -t mangle -A LOCAL_DIVERT -p tcp -j MARK --set-mark 1
iptables -t mangle -A LOCAL_DIVERT -p udp -j MARK --set-mark 1

iptables -t mangle -A OUTPUT -m owner ! --gid-owner { è¿è¡Œclash ç¨‹åºçš„GID}  -j LOCAL_DIVERT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœå°è¯•å†™ï¼š&lt;code&gt;iptables -t mangle -A OUTPUT -j clash&lt;/code&gt; ä¼šå‡ºç°é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;iptables v1.8.7 (nf_tables):  RULE_APPEND failed (Invalid argument): rule in chain OUTPUT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç½‘å‹è§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç”±äº tproxy åªèƒ½å·¥ä½œåœ¨ PREROUTING é“¾ï¼Œä»æœ¬æœºå‘å‡ºå»çš„æ•°æ®åŒ…ä¼šç›´æ¥é€šè¿‡ OUTPUT é“¾å‡ºå»äº†ï¼Œæœ¬æœºæ•°æ®åŒ…æ²¡æœ‰æœºä¼šèµ°ä¸€ä¸‹ PREROUTING é“¾ã€‚ ä½œè€…ï¼šé›é’K https://www.bilibili.com/read/cv14088928/ å‡ºå¤„ï¼šbilibili&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;sysctl å¼€å¯ipv4åŒ…è½¬å‘ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo &amp;quot;1&amp;quot; &amp;gt; /proc/sys/net/ipv4/ip_forward
#å»ºè®®é…ç½®/etc/sysctl.confä¸­ï¼Œå¼€æœºç”Ÿæ•ˆã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;github.com çš„é—®é¢˜&lt;/h2&gt;
&lt;p&gt;å¦‚æœæŠŠgithub.com åŠ«æŒåˆ°sniproxyï¼Œä¸ä¹…æµè§ˆå™¨å°±ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Fastly error: unknown domain: github.com. Please check that this domain has been added to a service.
Details: cache-hkg17926-HKG
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœåˆ°çš„ä¸€äº›issueï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/dlundquist/sniproxy/issues/178"&gt;http2 clients being proxied to wrong host. #178&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/snail007/goproxy/issues/422"&gt;HTTPä»£ç†è®¿é—®Githubä¼šç»å¸¸å‡ºç° Fastly error: unknown domain: github.com. #422
&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/dlundquist/sniproxy/issues/242#issuecomment-302831849"&gt;NIproxy doesn't support http2 or SPDY explicitly,&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹èµ·æ¥å’Œhttp2 é•¿è¿æ¥æœ‰å…³ï¼Œæš‚æ—¶æ²¡ç²¾åŠ›ï¼ˆèƒ½åŠ›ï¼‰ç»†ç©¶ï¼Œçœ‹åˆ°æœ‰ä¸€ä¸ª&lt;a href="https://github.com/dlundquist/sniproxy/pull/98"&gt;PR&lt;/a&gt;æ˜¯èƒ½é’ˆå¯¹ç‰¹å®šåŸŸåæŒ‡å®šä¸€äº›ï¼Œä½†æ˜¯æ²¡åˆã€‚&lt;/p&gt;
&lt;p&gt;é‚£å°±åªèƒ½å€’å›å»ç”¨ç½‘å…³çš„æ¨¡å¼è§£å†³äº†ã€‚&lt;/p&gt;
&lt;p&gt;dig äº†ä¸‹github.com çš„åŸŸåï¼Œé›†ä¸­åœ¨è¿™2ä¸ªæ®µï¼Œæ·»åŠ ç­–ç•¥è·¯ç”±ï¼ŒæŠŠä¸‹ä¸€æ¡æŒ‡åˆ°ä»£ç†æœºã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;140.82.112.0/22
20.205.192.0/18
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†…ç½‘æ­å»ºä¸€ä¸ªuptime kuma æˆ–è€…megaease/easeprobeï¼Œå¯¹github.com è¿›è¡Œcurl æ¢æµ‹ï¼Œå‘ç°å¼‚å¸¸å†åŠ æ–°çš„IPã€‚&lt;/p&gt;
&lt;h2&gt;sniproxy+v2ray+redirect&lt;/h2&gt;
&lt;p&gt;v2rayï¼ˆdokodemo-doorï¼‰+ redirect ä¹Ÿè¡Œï¼Œç®€å•è´´ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
    &amp;quot;log&amp;quot;: {
        &amp;quot;loglevel&amp;quot;: &amp;quot;warning&amp;quot;,
        &amp;quot;access&amp;quot;: &amp;quot;/var/log/v2ray/access.log&amp;quot;,
        &amp;quot;error&amp;quot;: &amp;quot;/var/log/v2ray/error.log&amp;quot;
    },
    &amp;quot;inbounds&amp;quot;: [
        {
            &amp;quot;tag&amp;quot;:&amp;quot;transparent&amp;quot;,
            &amp;quot;port&amp;quot;: 12345,
            &amp;quot;protocol&amp;quot;: &amp;quot;dokodemo-door&amp;quot;,
            &amp;quot;settings&amp;quot;: {
                &amp;quot;network&amp;quot;: &amp;quot;tcp,udp&amp;quot;,
                &amp;quot;followRedirect&amp;quot;: true
            },
            &amp;quot;sniffing&amp;quot;: {
                &amp;quot;enabled&amp;quot;: true,
                &amp;quot;destOverride&amp;quot;: [
                    &amp;quot;http&amp;quot;,
                    &amp;quot;tls&amp;quot;
                ]
            },
            &amp;quot;streamSettings&amp;quot;: {
                &amp;quot;sockopt&amp;quot;: {
                  &amp;quot;tproxy&amp;quot;: &amp;quot;redirect&amp;quot;
                }
            }
        }
    ],
    &amp;quot;outbounds&amp;quot;: [
        {
            &amp;quot;protocol&amp;quot;: &amp;quot;vmess&amp;quot;,
            &amp;quot;settings&amp;quot;: {
                ...
            },
            &amp;quot;streamSettings&amp;quot;: {
                &amp;quot;sockopt&amp;quot;: {
                    &amp;quot;mark&amp;quot;: 255
                }
            },
            &amp;quot;tag&amp;quot;: &amp;quot;proxy&amp;quot;
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/bin/bash

iptables -F
iptables -t nat -F
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT


iptables -t nat -N V2RAY
iptables -t nat -A OUTPUT -p tcp -j V2RAY

iptables -t nat -A V2RAY -d 192.168.0.0/16 -j RETURN
iptables -t nat -A V2RAY -d 10.0.0.0/8 -j RETURN
iptables -t nat -A V2RAY -p tcp -j RETURN -m mark --mark 0xff
iptables -t nat -A V2RAY -p tcp -j REDIRECT --to-ports 12345

iptables -t nat -A PREROUTING -p tcp -j V2RAY
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;å®¹ç¾&lt;/h2&gt;
&lt;p&gt;è¿™äº›ç½‘ç«™æœ¬æ¥å°±ä¸å­˜åœ¨ï¼Œå®¹ä»€ä¹ˆç¾ï¼ŸğŸ˜‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.linuxvirtualserver.org/"&gt;LVS&lt;/a&gt; ä¼ ç»Ÿåšæ³•&lt;ul&gt;
&lt;li&gt;æˆ–è€…åœŸè±ªæœ‰F5ä¹‹ç±»&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é…ç½®å¤šä¸ªä»£ç†æœºï¼Œlocal dns é‚£é‡Œè¿”å›å¤šä¸ªAè®°å½•ï¼ŒChrome è‡ªå·±ä¼šé‡è¯•ï¼›&lt;ul&gt;
&lt;li&gt;æˆ‘é€‰è¿™ä¸ª&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://guide.v2fly.org/app/tproxy.html#%E8%AE%BE%E7%BD%AE%E7%BD%91%E5%85%B3"&gt;é€æ˜ä»£ç†(TPROXY)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.bilibili.com/read/cv14088928/"&gt;ä½¿ç”¨ iptables çš„ tproxy å®Œæˆæœ¬æœºè®¿é—®å®¶é‡Œå†…ç½‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://moecm.com/something-about-v2ray-with-tproxy/"&gt;ç¬¬ä¸€ç¯‡ä¸‡å­—é•¿æ–‡ï¼šå›´ç»•é€æ˜ä»£ç†çš„åˆä¸€æ¬¡æ¢ç©¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://blog.mmf.moe/post/tproxy-investigation/"&gt;TProxy æ¢ç§˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.kernel.org/doc/Documentation/networking/tproxy.txt"&gt;tproxy.txt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2023"></category><category term="proxy"></category><category term="iptables"></category></entry><entry><title>é€†å‘åŠå…¬å¤§æ¥¼é—¨ç¦APKï¼ŒæˆåŠŸç”Ÿæˆé€šè¡ŒäºŒç»´ç </title><link href="https://fangpsh.github.io/posts/2023/2023-04-20.html" rel="alternate"></link><published>2023-04-20T00:00:00+08:00</published><updated>2023-04-20T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-04-20:/posts/2023/2023-04-20.html</id><summary type="html">&lt;p&gt;è„±å£³é€†å‘ï¼Œä¸å¿…ç¡¬ç¢°ç¡¬ã€‚å¤§å¤šæ•°ä¸šåŠ¡ï¼Œè¿­ä»£æ›´æ–°åªæ˜¯æ›´æ–°ä¸šåŠ¡ï¼Œä½†æ˜¯åŠ å¯†çš„é€»è¾‘å¹¶æ— å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ”»å‡»æ–¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸å°‘ä¸šåŠ¡ä¸ä¼šåœ¨ä¸€å¼€å§‹ â€¦&lt;/p&gt;&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;è„±å£³é€†å‘ï¼Œä¸å¿…ç¡¬ç¢°ç¡¬ã€‚å¤§å¤šæ•°ä¸šåŠ¡ï¼Œè¿­ä»£æ›´æ–°åªæ˜¯æ›´æ–°ä¸šåŠ¡ï¼Œä½†æ˜¯åŠ å¯†çš„é€»è¾‘å¹¶æ— å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ”»å‡»æ–¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸å°‘ä¸šåŠ¡ä¸ä¼šåœ¨ä¸€å¼€å§‹å°±åŠ å›ºï¼š
å¯ä»¥ç›´æ¥æ‰¾åˆ°å†å²åŒ…ï¼Œæœ€è¿‘ä¸€æ¬¡æœªåŠ å›ºç‰ˆæœ¬ã€‚
ç±»ä¼¼ä¸šåŠ¡ä¸ä¼šä¸€å¼€å§‹å¥—CDNï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢åŸŸåè§£æå†å²æ‰¾åˆ°å¯èƒ½çš„æºç«™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‰¾åŠ å›ºåè¾ƒæ—§çš„ç‰ˆæœ¬ï¼š
å„ç±»åŠ å›ºä¸æ–­æ›´æ–°ï¼Œé€†å‘æ€è·¯/å·¥å…·ä¹Ÿä¸æ–­å‡çº§ã€‚å¦‚æœæŒæœ‰çš„å·¥å…·èƒ½åº”å¯¹è€ç‰ˆæœ¬çš„åŠ å›ºï¼Œä½•ä¸æ‰¾è€ç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹äºä¸šåŠ¡æ–¹ï¼š&lt;br&gt;
é™¤äº†è¦ä¿æŒæ›´æ–°åŠ å›ºè½¯ä»¶ï¼Œè¿˜éœ€è¦æŒ‰ç‰ˆæœ¬ä¸æ–­æ›´æ¢å…³é”®ä¸šåŠ¡çš„AES  KEYã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯é€†å‘è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2&gt;æ‰¾å†å²åŒ…&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;apkpureã€apkimirror ä¹‹ç±»&lt;/li&gt;
&lt;li&gt;å®˜æ–¹è½¯ä»¶ä¸‹è½½é“¾æ¥ï¼šå¯çŒœæµ‹å†å²ç‰ˆæœ¬å·çš„é“¾æ¥ï¼Œæˆ–æŠŠURL å‰åŠéƒ¨åˆ†ä¸¢æœç´¢å¼•æ“é‡Œé¢&lt;/li&gt;
&lt;li&gt;è±Œè±†èšï¼šå›½å†…è½¯ä»¶ï¼Œè±Œè±†èšçš„å†å²åŒ…éå¸¸å…¨&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨è±Œè±†èšæ‰¾åˆ°è¯¥è½¯ä»¶å†å²åŒ…ï¼Œ2åˆ†æ³•ä¸‹è½½apkæ”¹zipï¼Œè§£å‹æŸ¥çœ‹assetså’Œlibç­‰å†…å®¹åˆ¤æ–­æ˜¯å¦è¿›è¡ŒåŠ å›ºå’Œé‡‡ç”¨çš„åŠ å›ºå‚å•†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;6.5.0: æœ€åä¸€ä¸ªæœªåŠ å›ºçš„ç‰ˆæœ¬ï¼›&lt;/li&gt;
&lt;li&gt;7.0.0: ç¬¬ä¸€ä¸ªä½¿ç”¨360 åŠ å›ºçš„ç‰ˆæœ¬ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;è„±å£³&lt;/h2&gt;
&lt;p&gt;å®‰è£…7.0 ç‰ˆæœ¬ï¼Œç”ŸæˆäºŒç»´ç ï¼Œå¯æ­£å¸¸é€šè¡Œï¼Œè¡¨æ˜7.0 ç‰ˆé€»è¾‘æ­£å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¯•ä¸€è¯•ç”¨&lt;a href="https://github.com/CodingGay/BlackDex/"&gt;BlackDex&lt;/a&gt; è„±å£³ï¼Œä¸€æ¬¡æ€§æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå¦‚æœå®‰è£…BlackDex ä¹‹åæœªçœ‹åˆ°APPï¼Œè¡¨æ˜é€‰æ‹©çš„ç‰ˆæœ¬é”™äº†ï¼Œæ¢å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ï¼ŒBlackDex32æˆ–è€…64ã€‚&lt;/p&gt;
&lt;p&gt;è„±å£³æ‹¿åˆ°çš„dex æ–‡ä»¶ï¼Œä½¿ç”¨d2j-dex2jar è½¬ä¸ºjarã€‚&lt;/p&gt;
&lt;p&gt;apktoolã€dex2jarã€jd-gui çš„å®‰è£…ï¼Œå„ä½å¸ˆå‚…å†™çš„éƒ½éå¸¸å¤šäº†ï¼Œæ²¡å•¥å¥½è¯´çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šmacOS å¦‚æœæ‰“å¼€jd-gui æç¤ºJAVAç‰ˆæœ¬é—®é¢˜ï¼ŒGoogle æœç´¢â€œJavaåç¼–è¯‘åˆ©å™¨JD-GUI(è§£å†³æŠ¥é”™This program requires Java 1.8+)â€ï¼Œä¹Ÿå¯ä»¥æ‰¾åˆ°å¾ˆå¤šå¸ˆå‚…å†™çš„æ–‡ç« ã€‚&lt;/p&gt;
&lt;h2&gt;æ”¶é›†å¿…è¦ä¿¡æ¯&lt;/h2&gt;
&lt;p&gt;å¼€å§‹é€†å‘çœ‹ä»£ç ä¹‹å‰ï¼Œç”¨proxyman æˆ–è€…charlesï¼Œèµ°ä¸€éå®Œæ•´çš„ä¸šåŠ¡æµç¨‹ï¼ŒæŠ“å–åˆ°æ‰€éœ€çš„ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿçœ‹ä¸€éå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯äº¤äº’çš„ä¿¡æ¯ï¼Œä¼šæœ‰ä¸ªæ€è·¯ï¼Œç‰¹åˆ«æ˜¯å¯¹ä¸€äº›å…³é”®å‚æ•°åã€æ¥å£åï¼Œæ–¹ä¾¿æˆ‘ä»¬åéèµ°è¯»ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;proxyman çš„ä½¿ç”¨ï¼Œä¹Ÿæœ‰éå¸¸å¤šå¸ˆå‚…çš„æ–‡ç« ï¼ŒGoogle å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚è·å–åˆ°çš„ç™»å½•åçš„ä¸ªäººä¿¡æ¯ï¼Œç•™ä½œå¤‡ç”¨ï¼Œåç»­è‚¯å®šä¼šç”¨åˆ°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
  &amp;quot;code&amp;quot;: &amp;quot;000&amp;quot;,
  &amp;quot;describe&amp;quot;: &amp;quot;Operation succeed!&amp;quot;,
  &amp;quot;data&amp;quot;: {
    &amp;quot;id&amp;quot;: &amp;quot;A5D00B33819E458B8XXXXXXXX&amp;quot;,
    &amp;quot;account&amp;quot;: &amp;quot;1091XXXX&amp;quot;,
    &amp;quot;nickName&amp;quot;: &amp;quot;&amp;quot;,
    &amp;quot;userName&amp;quot;: &amp;quot;é™ˆXX&amp;quot;,
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„è¿™ä¸ªIDï¼šA5D00B33819E458B8XXXXXXXXï¼Œåæ–‡ä¼šå‡ºç°ã€‚&lt;/p&gt;
&lt;h2&gt;é€†å‘ä»£ç &lt;/h2&gt;
&lt;p&gt;dex æ‹–å…¥jd-gui ä¹‹åï¼Œä»å“ªé‡Œå¼€å§‹çœ‹å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç”¨apktool ç›´æ¥é€†å‘åˆ°apk åŒ…è™½ç„¶æ²¡æœ‰å…³é”®ä»£ç ï¼Œä½†æ˜¯ä¼šåŒ…å«ä¸€äº›å˜é‡åï¼Œå¯ä»¥ä½œä¸ºçº¿ç´¢ã€‚
ä¾‹å¦‚APP ä¸Šæ˜¾ç¤ºâ€œæ‰«ç é€šè¡Œï¼Œç‚¹å‡»åˆ·æ–°â€ï¼Œæˆ‘ä»¬ç›´æ¥grepï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="grep" src="/assets/images/2023/20230420143707.png"&gt;&lt;/p&gt;
&lt;p&gt;å…³é”®è¯ &lt;code&gt;passcode&lt;/code&gt;ï¼Œå¦å¤–è¿™æ˜¯ä¸ªäºŒç»´ç ï¼Œä¹Ÿå¯ä»¥ä»å…ˆæ‰¾&lt;code&gt;qrcode&lt;/code&gt; ç›¸å…³å‡½æ•°ï¼Œç„¶åçœ‹çœ‹é‚£äº›åœ°æ–¹è°ƒç”¨äº†å®ƒï¼Œå€’ç€çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="createQRCode" src="/assets/images/2023/20230420143726.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="QrCodeFragment" src="/assets/images/2023/20230420143814.png"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°å…³é”®è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;param1String = EncodeUtil.encodeKey(CacheUtils.getUserId(), QrCodeFragment.this.mPassCode, &amp;quot;A&amp;quot;, CacheUtils.getAppVersion());
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="encodeKey" src="/assets/images/2023/20230420143840.png"&gt;&lt;/p&gt;
&lt;p&gt;å‡ºç°ä¸€ä¸ªå…³é”®ä¿¡æ¯ï¼šqrCodeKeyï¼Œ
æœ€åè¿›è¡Œäº†AES åŠ å¯†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;return AESUtil.Encrypt(stringBuilder3.toString(), qrCodeKey, qrCodeKey);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…ˆçœ‹ä¸€ä¸‹AES çš„åŠ å¯†æ¨¡å¼å’Œå¡«å……ç®—æ³•ç­‰ï¼Œå†å›è¿‡æ¥çœ‹è¿™ä¸ªstrç”Ÿæˆé€»è¾‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="AESUtil" src="/assets/images/2023/20230420143904.png"&gt;&lt;/p&gt;
&lt;p&gt;okï¼Œæˆ‘ä»¬å¾—åˆ°äº†ï¼Œ&lt;code&gt;AES/CBC/PKCS5Padding&lt;/code&gt;ï¼Œä¹Ÿæœ‰å¯†é’¥ï¼ˆqrCodeKeyï¼‰äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ‰“å¼€å®‰è£…çš„APPï¼Œè¿ç»­ç”Ÿæˆ2ï¼Œ3å¼ é€šè¡ŒäºŒç»´ç ï¼Œè§£æå‡ºäºŒç»´ç è¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;l/YKQnk8F/JcCXI3k4uvf05a1hcpnZSmdgBV...ak9A/xPh7KsgPhUffKRjajLi/2u5IIOA==
l/YKQnk8F/JcCXI3k4uvf3Ekfg1dzyTiTp+D...AhSGF3bqW2OjWiaCZDU/IbFQ9di9af3wUew==
l/YKQnk8F/JcCXI3k4uvf1VsKs6lu...3AtHsxb9I16t2vXJ0qpK+7DmEgADVBdw==
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰¾ä¸€ä¸ª&lt;a href="https://tool.lmeee.com/jiami/aes"&gt;AES åœ¨çº¿åŠ è§£å¯†&lt;/a&gt;çš„ç½‘ç«™ï¼Œè¯•ä¸€è¯•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="aes-decrypt" src="/assets/images/2023/20230420143926.png"&gt;&lt;/p&gt;
&lt;p&gt;okï¼Œæå®šäº†sign_strï¼Œæœ‰äº†è¿™ä¸ªsign_str èƒ½æ–¹ä¾¿æˆ‘ä»¬åç»­æ ¡å¯¹sign_str ç”Ÿæˆé€»è¾‘å’Œç¼–å†™pocã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶åœ¨è¿™ä¸€æ­¥ï¼Œå¯ä»¥å‘ç°å‰åŠéƒ¨åˆ†å­—ç¬¦ä¸²å’Œä¸Šæ–‡å‡ºç°UserID æœ‰ç±»ä¼¼çš„åœ°æ–¹ã€‚æ¥ä¸‹æ¥å°±æ˜¯è¯»æ‡‚å‰é¢encodeKey å‡½æ•°çš„é€»è¾‘ï¼Œä»¥åŠä¼ å…¥mCode çš„ç”Ÿæˆè½ã€‚&lt;/p&gt;
&lt;p&gt;UserID+mPassCode+md5_16(mPassCode)+"B"+ç‰ˆæœ¬å·ã€‚
UserIDå’ŒmPassCode ä¸æ˜¯ç›´æ¥æ‹¼å‡‘ï¼Œè€Œæ˜¯é—´éš”äº¤å‰æ‹¼åœ¨ä¸€èµ·ã€‚&lt;/p&gt;
&lt;p&gt;å†çœ‹ä¸‹mPassCodeçš„ç”Ÿæˆé€»è¾‘ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="mPassCode" src="/assets/images/2023/20230420144057.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»ä»£ç æ¥çœ‹ï¼Œåªæ˜¯ç®€å•çš„é€’å¢ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå†å»ç”Ÿæˆå‡ ä¸ªå®é™…çš„äºŒç»´ç ï¼Œç”¨AESåœ¨çº¿è§£å¯†å‡ºï¼Œæ‹¿åˆ°mPassCode çš„md5_16ï¼Œä¸¢åˆ°cmd5.com é‡Œé¢çœ‹çœ‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="cmd5" src="/assets/images/2023/20230420144121.png"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;e6e61673edb05342 -&amp;gt; 00000171
7a56b435986b1611 -&amp;gt;  00000172
651bac14cc8b1285 -&amp;gt;  00000173
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¡®å®šåªæ˜¯ç®€å•é€’å¢ï¼Œé‚£ä¹ˆè¿™ä¸ªcode ä¸æ˜¯åŸºäºæ—¶é—´çš„OTPç®—æ³•ï¼ŒçŒœæµ‹æœåŠ¡ç«¯ä¼šè®°å½•å½“å‰ç”¨åˆ°æœ€å¤§çš„codeï¼Œä»¥ä½¿ä¹‹å‰çš„code å¤±æ•ˆï¼ˆåç»­å®é™…éªŒè¯ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œï¼ŒåŸºæœ¬å°±æ¸…æ™°äº†ï¼š
mPassCode å•è°ƒé€’å¢ï¼ŒUserID æŒ‰4ä¸ªåˆ†éš”ï¼Œï¼ŒmPassCodeæŒ‰2ä¸ªåˆ†å‘ï¼Œä¸¤è€…äº¤å‰æ‹¼åœ¨ä¸€èµ·ï¼Œå†åŠ ä¸ŠmPassCode çš„MD5-16ï¼ŒåŠ å­—ç¬¦â€œBâ€ï¼Œå†åŠ ç‰ˆæœ¬å·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¾‹ï¼š
UserID ä¸ºï¼š&lt;code&gt;A12345678910ABCEED6A474E79AA4FF6&lt;/code&gt;
å½“å‰mPassCodeä¸ºï¼š&lt;code&gt;00000123&lt;/code&gt;ï¼Œmd5_16å€¼ä¸º&lt;code&gt;c9b62e572837d1b9&lt;/code&gt;
ç‰ˆæœ¬å·ä¸ºï¼š&lt;code&gt;7.1.2&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‹¼å‡‘å­—ç¬¦ä¸²ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;A123    4567  8910   ABCE  ED6A   474E79AA4FF6
     00     00     00    01     23             c9b62e572837d1b9  B7.1.2
ç»“æœä¸ºï¼š
A12300456700891001ABCE23ED6A474E79AA4FF6c9b62e572837d1b9B7.1.2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;PoC&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;import hashlib
import random
import string

from Crypto.Cipher import AES  
from base64 import b64decode, b64encode

BLOCK_SIZE = AES.block_size
pad = lambda s: s + (BLOCK_SIZE - len(s.encode()) % BLOCK_SIZE) * chr(BLOCK_SIZE - len(s.encode()) % BLOCK_SIZE)
unpad = lambda s: s[:-ord(s[len(s) - 1:])]


class AESCipher:
    def __init__(self, secretkey: str):
        self.key = secretkey
        self.iv = secretkey[0:16]  # åç§»é‡

    def encrypt(self, text):
        &amp;quot;&amp;quot;&amp;quot;
        åŠ å¯† ï¼šå…ˆè¡¥ä½ï¼Œå†AESåŠ å¯†ï¼Œåbase64ç¼–ç 
        :param text: éœ€åŠ å¯†çš„æ˜æ–‡
        :return:
        &amp;quot;&amp;quot;&amp;quot;
        # text = pad(text) åŒ…pycryptoçš„å†™æ³•ï¼ŒåŠ å¯†å‡½æ•°å¯ä»¥æ¥å—strä¹Ÿå¯ä»¥æ¥å—bytess
        text = pad(text).encode()  # åŒ…pycryptodome çš„åŠ å¯†å‡½æ•°ä¸æ¥å—str
        cipher = AES.new(key=self.key.encode(), mode=AES.MODE_CBC, IV=self.iv.encode())
        encrypted_text = cipher.encrypt(text)
        # è¿›è¡Œ64ä½çš„ç¼–ç ,è¿”å›å¾—åˆ°åŠ å¯†åçš„bytesï¼Œdecodeæˆå­—ç¬¦ä¸²
        return b64encode(encrypted_text).decode(&amp;#39;utf-8&amp;#39;)

    def decrypt(self, encrypted_text):
        &amp;quot;&amp;quot;&amp;quot;
        è§£å¯† ï¼šåç§»é‡ä¸ºkey[0:16]ï¼›å…ˆbase64è§£ï¼Œå†AESè§£å¯†ï¼Œåå–æ¶ˆè¡¥ä½
        :param encrypted_text : å·²ç»åŠ å¯†çš„å¯†æ–‡
        :return:
        &amp;quot;&amp;quot;&amp;quot;
        encrypted_text = b64decode(encrypted_text)
        cipher = AES.new(key=self.key.encode(), mode=AES.MODE_CBC, IV=self.iv.encode())
        decrypted_text = cipher.decrypt(encrypted_text)
        return unpad(decrypted_text).decode(&amp;#39;utf-8&amp;#39;)


code=&amp;#39;00000123&amp;#39;
c1=code[0:2]
c2=code[2:4]
c3=code[4:6]
c4=code[6:8]

md5_16=hashlib.md5(code.encode(&amp;#39;utf-8&amp;#39;)).hexdigest()[8:-8]

uid=&amp;#39;A12345678910ABCEED6A474E79AA4FF6&amp;#39;

u1=uid[0:4]
u2=uid[4:8]
u3=uid[8:12]
u4=uid[12:16]
u5=uid[16:]
sign_str=f&amp;quot;{u1}{c1}{u2}{c2}{u3}{c3}{u4}{c4}{u5}{md5_16}B7.1.2&amp;quot;
print(sign_str)

encrypted_text = AESCipher(&amp;quot;ç•¥&amp;quot;).encrypt(sign_str)
print(encrypted_text)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†å°†encrypted_text ç”ŸæˆäºŒç»´ç å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘æ˜¯ä¸šåŠ¡æ–¹ï¼Œå¯ä»¥æ€ä¹ˆæ”¹è¿›ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘çš„æ€è·¯æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªæ–°ç‰ˆï¼Œé‡‡ç”¨æœ€æ–°çš„åŠ å¯†å›ºä»¶ï¼ŒåŒæ—¶æ›´æ¢AES Keyã€‚
ç”Ÿæˆçš„äºŒç»´ç åŒ…å«å½“å‰ç‰ˆæœ¬çš„æ˜æ–‡ä¿¡æ¯å’ŒåŠ å¯†ä¸²ï¼Œåœ¨æœåŠ¡ç«¯å…ˆæŒ‰æ˜æ–‡åæŸ¥å¯¹äºAES Keyï¼Œå†è§£å¯†éªŒè¯åŠ å¯†ä¸²ã€‚
è¿™æ ·æ—¢èƒ½ä¿æŒå‘åå…¼å®¹ï¼Œå¿…è¦æ—¶å€™å¼ºåˆ¶ç”¨æˆ·å‡çº§ï¼Œé€æ­¥åŠé”€ä¸å®‰å…¨ç‰ˆæœ¬çš„AES Keyã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢å„ä½å¸ˆå‚…è§‚çœ‹ï¼ŒçŒ®ä¸‘äº†ï¼Œé¢„ç¥å¤§å®¶äº”ä¸€å¿«ä¹ã€‚&lt;/p&gt;</content><category term="2023"></category><category term="hack"></category></entry><entry><title>é˜¿é‡Œäº‘å…±äº«æµé‡åŒ…å•ä»·å¯¹æ¯”</title><link href="https://fangpsh.github.io/posts/2023/2023-03-17.html" rel="alternate"></link><published>2023-03-17T00:00:00+08:00</published><updated>2023-03-17T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-03-17:/posts/2023/2023-03-17.html</id><summary type="html">&lt;p&gt;é˜¿é‡Œäº‘çš„å…±äº«æµé‡åŒ…å®šä»·ï¼Œä¸å®Œå…¨ç¬¦åˆæµé‡åŒ…è¶Šå¤§å•ä»·è¶Šä½ï¼Œæœ‰æ•ˆæœŸè¶Šé•¿å•ä»·è¶Šä½çš„æ€ç»´å®šå¼ï¼Œé˜¿é‡Œäº‘äº§å“ç»ç†æ˜¯æ•…æ„çš„ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;é˜¿é‡Œäº‘çš„å…±äº«æµé‡åŒ…å®šä»·ï¼Œä¸å®Œå…¨ç¬¦åˆæµé‡åŒ…è¶Šå¤§å•ä»·è¶Šä½ï¼Œæœ‰æ•ˆæœŸè¶Šé•¿å•ä»·è¶Šä½çš„æ€ç»´å®šå¼ï¼Œé˜¿é‡Œäº‘äº§å“ç»ç†æ˜¯æ•…æ„çš„è¿˜æ˜¯ä¸å°å¿ƒçš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¹‹å‰å‡ å¹´è´Ÿè´£äº‘èµ„æºé‡‡è´­æ—¶ï¼Œç®—è¿‡é˜¿é‡Œäº‘&lt;code&gt;300TB-6æœˆ&lt;/code&gt;çš„åŒ…å•ä»·æ˜¯æœ€ä½çš„ï¼Œæ‰€ä»¥éƒ½é€‰æ‹©é‡‡è´­è¿™ä¸ªè§„æ ¼ã€‚ä»Šå¤©å†ç®—ä¸€éï¼Œå‘ç°åˆæœ‰ä¸€äº›æ–°çš„å˜åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;å£°æ˜ï¼šä»¥ä¸‹æ•°æ®2023-03-17é‡‡é›†ï¼Œä¸ªäººå¸å·ç™»å½•&lt;a href="https://www.aliyun.com/price/product?#/flowbag/detail/flowbag"&gt;äº‘å•†æ§åˆ¶å°&lt;/a&gt;è·å–ã€‚å‚å•†å¯èƒ½éšæ—¶è°ƒæ•´ï¼Œè¯·æ ¹æ®è‡ªèº«æƒ…å†µå†æ¬¡æ ¸å¯¹ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆåˆ—ç»“è®ºï¼š &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;12æœˆä»¥ä¸Šçš„å¤§åŒ…æ²¡å¿…è¦è´­ä¹°ï¼Œå•ä»·æ— ä¼˜åŠ¿ï¼›&lt;/li&gt;
&lt;li&gt;åŒä¸€ç±»å‹ã€æœ‰æ•ˆæœŸä¸‹çš„æµé‡åŒ…ï¼Œå¹¶ä¸æ˜¯è§„æ ¼è¶Šå¤§è¶Šä¾¿å®œï¼š&lt;ol&gt;
&lt;li&gt;äºšå¤ªå…¨æ—¶ï¼Œ128G-1æœˆå¼‚å¸¸ï¼Œæ¯”50G-1æœˆè¿˜é«˜&lt;/li&gt;
&lt;li&gt;äºšå¤ªå…¨æ—¶ï¼Œ10T-1æœˆå¼‚å¸¸ï¼Œæ¯”5T-1æœˆè¿˜é«˜&lt;/li&gt;
&lt;li&gt;äºšå¤ªå…¨æ—¶ï¼Œ600G-6æœˆå¼‚å¸¸ï¼Œæ¯”300GB-6æœˆè¿˜é«˜&lt;/li&gt;
&lt;li&gt;äºšå¤ªé—²æ—¶ï¼Œ10T-1æœˆå¼‚å¸¸ï¼Œæ¯”5T-1æœˆè¿˜é«˜&lt;/li&gt;
&lt;li&gt;äºšå¤ªé—²æ—¶ï¼Œ60T-6æœˆå¼‚å¸¸ï¼Œæ¯”30T-6æœˆè¿˜é«˜&lt;/li&gt;
&lt;li&gt;æ¬§ç¾å…¨æ—¶ï¼Œ10T-1æœˆå¼‚å¸¸ï¼Œæ¯”5T-1æœˆè¿˜é«˜&lt;/li&gt;
&lt;li&gt;æ¬§ç¾å…¨æ—¶ï¼Œ60T-6æœˆå¼‚å¸¸ï¼Œæ¯”30T-6æœˆè¿˜é«˜&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;ä»¥äºšå¤ªå…¨æ—¶ä¸ºä¾‹ï¼ŒæŒ‰æµé‡æƒ…å†µï¼Œå»ºè®®åœ¨ä¸‰ç±»åŒ…é‡Œé¢é€‰ï¼š&lt;ol&gt;
&lt;li&gt;50G-1æœˆ&lt;/li&gt;
&lt;li&gt;5T-1æœˆ&lt;/li&gt;
&lt;li&gt;30T-6æœˆï¼ˆå•ä»·å’Œ5T-6æœˆä¸€æ ·ï¼Œä½†æ˜¯æœ‰æ•ˆæœŸæ›´é•¿ï¼Œé€‚åˆä¸å‡è¡¡çš„æƒ…å†µï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;äºšå¤ªé—²æ—¶å’Œæ¬§ç¾å…¨æ—¶ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹è¡¨æ ¼è‡ªè¡ŒæŠ‰æ‹©ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‡è®¾äºšå¤ªå…¨æ—¶ æœˆå¹³å‡æµé‡æ¶ˆè€—æ˜¯300Tï¼Œé‚£æœ€ä½³åšæ³•æ˜¯å†™ä¸€ä¸ªè„šæœ¬ï¼Œç›‘æ§ä½™é‡ï¼Œè‡ªåŠ¨è¡¥30T-6æœˆåŒ…ï¼Œè€Œä¸æ˜¯ç›´æ¥æä¸€ä¸ª300T-6æœˆåŒ…ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="äºšå¤ªå…¨æ—¶" src="/assets/images/2023/20230317142005.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="äºšå¤ªé—²æ—¶" src="/assets/images/2023/20230317142040.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="æ¬§ç¾å…¨æ—¶" src="/assets/images/2023/20230317142125.png"&gt;&lt;/p&gt;
&lt;p&gt;é¡ºä¾¿çœ‹äº†ä¸‹ï¼Œè…¾è®¯ä¸Šæµ·å…¨æ—¶çš„æµé‡åŒ…æƒ…å†µï¼Œæ¯”è¾ƒç¬¦åˆæ€ç»´å®šå¼ï¼Œæ—¶é—´è¶Šé•¿ï¼ŒåŒ…è¶Šå¤§ï¼Œå•ä»·è¶Šä½ï¼š
&lt;img alt="è…¾è®¯ä¸Šæµ·å…¨æ—¶" src="/assets/images/2023/20230317142156.png"&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœéœ€è¦è·å–è¿™ä¸ªè¡¨æ ¼ï¼Œè¯·ç‚¹å‡» &lt;a href="https://docs.google.com/spreadsheets/d/1U4cff_GZILOqMl9ApcdmLjzQYIr_wWoY/edit?usp=sharing&amp;amp;ouid=118315519688232626252&amp;amp;rtpof=true&amp;amp;sd=true"&gt;é˜¿é‡Œäº‘æµé‡&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2023"></category><category term="cloud"></category><category term="aliyun"></category></entry><entry><title>MTR UDPæ¨¡å¼å›ºå®šä¸¢åŒ…ç‡çš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2023/2023-03-15.html" rel="alternate"></link><published>2023-03-15T00:00:00+08:00</published><updated>2023-03-15T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-03-15:/posts/2023/2023-03-15.html</id><summary type="html">&lt;p&gt;ä¸æ„¿æ„é€éœ²å§“åçš„åŒäº‹åé¦ˆï¼Œåœ¨ä»»ä½•ä¸€å°A æœåŠ¡å™¨ä¸Šï¼Œmtr å¦å¤–ä¸€å°B æœåŠ¡å™¨ï¼ŒUDP æ¨¡å¼ï¼Œå‘åŒ…é¢‘ç‡åªè¦å¤§äº &lt;code&gt;1s/æ¬¡&lt;/code&gt;ï¼Œä¼šå‡ºç°å›ºå®šä¸¢ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸æ„¿æ„é€éœ²å§“åçš„åŒäº‹åé¦ˆï¼Œåœ¨ä»»ä½•ä¸€å°A æœåŠ¡å™¨ä¸Šï¼Œmtr å¦å¤–ä¸€å°B æœåŠ¡å™¨ï¼ŒUDP æ¨¡å¼ï¼Œå‘åŒ…é¢‘ç‡åªè¦å¤§äº &lt;code&gt;1s/æ¬¡&lt;/code&gt;ï¼Œä¼šå‡ºç°å›ºå®šä¸¢åŒ…ï¼Œå¹¶ä¸”ä¸¢åŒ…æ€»æ˜¯åœ¨æœ€åä¸€è·³ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mtr -u {ip} -nz --interval 0.5
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†æ˜¯ä½¿ç”¨mtr é»˜è®¤çš„æ¨¡å¼ï¼Œicmpä¸ä¼šä¸¢åŒ…ã€‚åŒäº‹åé¦ˆä¸åŒå‚å•†çš„æœºå™¨ï¼Œè¡Œä¸ºä¸€è‡´ï¼Œé‚£åº”è¯¥å°±ç³»ç»Ÿå†…åšçš„é™åˆ¶ï¼Œæ‰€ä»¥æ€€ç–‘æˆ‘åœ¨æœºå™¨ä¸Šé’ˆå¯¹UDP åšäº†é™é€Ÿã€‚&lt;/p&gt;
&lt;p&gt;äº¤å‰æµ‹è¯•äº†ä¸‹ï¼Œ
1. é€‰æ‹©2å°åŒæœºæˆ¿çš„Aï¼ŒB ï¼ŒA mtr Bï¼ˆå…¬ç½‘IPï¼‰ï¼Œå’Œåé¦ˆç°è±¡ä¸€è‡´
2. A mtr B ï¼ˆå†…ç½‘IPï¼‰ï¼Œå’Œåé¦ˆç°è±¡ä¸€è‡´&lt;/p&gt;
&lt;p&gt;å½“interval æ˜¯0.5 çš„æ—¶å€™ï¼Œä¸¢åŒ…ç‡æ°å¥½æ˜¯50%ï¼Œåœ¨B ä¸ŠæŠ“åŒ…ï¼š
&lt;img alt="udp-loss" src="/assets/images/2023/20230315173621.jpeg"&gt;&lt;/p&gt;
&lt;p&gt;B çš„å›ICMP: Destination Unreachable æ˜¯é—´éš”æ€§çš„ã€‚
æŒ‰ç…§icmp ratelist æœåˆ°äº†ï¼Œæ‰¾åˆ°äº†&lt;a href="https://man7.org/linux/man-pages/man7/icmp.7.html"&gt;ç­”æ¡ˆ&lt;/a&gt;ã€‚
ç³»ç»Ÿé»˜è®¤çš„&lt;code&gt;icmp_ratelimit&lt;/code&gt;æ˜¯&lt;code&gt;1000&lt;/code&gt;ï¼Œæ°å¥½æ˜¯1sï¼Œé‚£ä¸ºä½•mtr ICMP æ¨¡å¼ä¸ä¼šä¸¢å‘¢ï¼Ÿ
å› ä¸ºè¿˜æœ‰ä¸€ä¸ªå‚æ•°&lt;code&gt;icmp_ratemask&lt;/code&gt; ï¼Œé»˜è®¤ä¸ºä»¥ä¸‹å‡ ç±»åŒ…è¢«é™åˆ¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;       icmp_ratemask (integer; default: see below; since Linux 2.4.10)
              Mask made of ICMP types for which rates are being limited.

              Significant bits: IHGFEDCBA9876543210
              Default mask:     0000001100000011000 (0x1818)

              Bit definitions (see the Linux kernel source file
              include/linux/icmp.h):

                   0 Echo Reply
                   3 Destination Unreachable *
                   4 Source Quench *
                   5 Redirect
                   8 Echo Request
                   B Time Exceeded *
                   C Parameter Problem *
                   D Timestamp Request
                   E Timestamp Reply
                   F Info Request
                   G Info Reply
                   H Address Mask Request
                   I Address Mask Reply
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;IMCP æ¨¡å¼ä¸‹å›çš„åŒ…æ˜¯&lt;code&gt;G Info Reply&lt;/code&gt;ï¼Œæœªåœ¨&lt;code&gt;icmp_ratemask&lt;/code&gt; æ ‡è®°èŒƒå›´å†…ã€‚
&lt;img alt="icmp-reply" src="/assets/images/2023/20230315174413.png"&gt;&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢ç»†å¿ƒçš„åŒäº‹ï¼Œåˆå­¦ä¹ åˆ°äº†ã€‚&lt;/p&gt;</content><category term="2023"></category><category term="linux"></category><category term="network"></category></entry><entry><title>é¿å…innerHTML è‡ªåŠ¨æ¸²æŸ“ç‰¹æ®Šå­—ç¬¦</title><link href="https://fangpsh.github.io/posts/2023/2023-03-06.html" rel="alternate"></link><published>2023-03-06T00:00:00+08:00</published><updated>2023-03-06T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2023-03-06:/posts/2023/2023-03-06.html</id><summary type="html">&lt;p&gt;æˆ‘åœ¨å†…ç½‘éƒ¨ç½²äº†ä¸€ä¸ª &lt;a href="http://json.parser.online.fr/beta"&gt;json.parser.online.fr&lt;/a&gt; çš„ç ´è§£ç‰ˆï¼š&lt;a href="https://github.com/hklcf/Json-Parser-Online-Nulled"&gt;Json-Parser-Online-Nulled&lt;/a&gt;ï¼Œä»Šå¤©æœ‰åŒäº‹åé¦ˆï¼Œæ ¼å¼åŒ–åçš„æ–‡æœ¬å‘ç”Ÿäº†å˜åŒ–ï¼Œå‘ç°æ˜¯å°†&lt;code&gt;&amp;amp;region&lt;/code&gt; å˜æˆäº†&lt;code&gt;Â®ion&lt;/code&gt;
å¤ç°ä¸€ä¸‹ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æˆ‘åœ¨å†…ç½‘éƒ¨ç½²äº†ä¸€ä¸ª &lt;a href="http://json.parser.online.fr/beta"&gt;json.parser.online.fr&lt;/a&gt; çš„ç ´è§£ç‰ˆï¼š&lt;a href="https://github.com/hklcf/Json-Parser-Online-Nulled"&gt;Json-Parser-Online-Nulled&lt;/a&gt;ï¼Œä»Šå¤©æœ‰åŒäº‹åé¦ˆï¼Œæ ¼å¼åŒ–åçš„æ–‡æœ¬å‘ç”Ÿäº†å˜åŒ–ï¼Œå‘ç°æ˜¯å°†&lt;code&gt;&amp;amp;region&lt;/code&gt; å˜æˆäº†&lt;code&gt;Â®ion&lt;/code&gt;
å¤ç°ä¸€ä¸‹ï¼š
&lt;img alt="reg" src="/assets/images/2023/20230306184830.png"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼š&lt;a href="https://toolstud.io/web/charmap.php?encoded=reg"&gt;HTML character: Â® = &amp;reg;&lt;/a&gt;ï¼Œé‚£æ˜¯å“ªé‡Œå¼•å…¥çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;èµ°è¯»äº†ä¸€éä»£ç ï¼Œå¤–åŠ &lt;code&gt;console.log&lt;/code&gt; å¤§æ³•ï¼Œ&lt;code&gt;parse()&lt;/code&gt;å‡½æ•°æœ€åè¿”å›çš„åœ°æ–¹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nx"&gt;html&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="nx"&gt;parseObject&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;snatch&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;&lt;span class="nx"&gt;valid&lt;/span&gt;&lt;span class="o"&gt;:!&lt;/span&gt;&lt;span class="nx"&gt;hasError&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰“å°&lt;code&gt;result&lt;/code&gt;ä¸€åˆ‡æ­£å¸¸ï¼Œ
æ¥ç€æ˜¯&lt;a href="https://github.com/hklcf/Json-Parser-Online-Nulled/blob/master/script.js#L493,L494"&gt;$result.innerHTML&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;setTimeout&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;json&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/&amp;lt;/g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;lt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;json&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;json&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/&amp;gt;/g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;json&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;$result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;innerHTML&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;result&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;valid&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;changeFavicon&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;valid&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é—®é¢˜å°±å‡ºåœ¨è¿™é‡Œï¼ŒinnerHTML èµ‹å€¼çš„æ—¶å€™ï¼Œè‡ªåŠ¨å¯¹&lt;a href="https://toolstud.io/web/charmap.php?filter=*"&gt;ç‰¹æ®Šå­—ç¬¦&lt;/a&gt;è¿›è¡Œäº†æ¸²æŸ“ï¼š&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæœºåˆ¶ä¼¼ä¹æ— æ³•ç»•è¿‡ï¼Œæˆ‘çš„è§£å†³åŠæ³•æ˜¯å¯¹åœ¨æœ€å&lt;code&gt;&amp;amp;&lt;/code&gt; å­—ç¬¦è¿›è¡Œæå‰æ›¿æ¢ï¼Œå°†&lt;code&gt;&amp;amp;&lt;/code&gt;å­—ç¬¦æ›¿æ¢ä¸º&lt;code&gt;&amp;amp;amp;&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;html: parseObject(snatch).toString().replaceAll(&amp;#39;&amp;amp;&amp;#39;,&amp;#39;&amp;amp;amp;&amp;#39;), valid: !hasError
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•ˆæœå¦‚ä¸‹
&lt;img alt="reg01" src="/assets/images/2023/20230306190041.png"&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–å‘ç°å¦‚æœè¾“å…¥&lt;code&gt;&amp;lt;&lt;/code&gt;å’Œ&lt;code&gt;&amp;gt;&lt;/code&gt; ä¹Ÿä¼šè¢«è½¬æ¢ä¸º&lt;code&gt;&amp;amp;lt;&lt;/code&gt; å’Œ&lt;code&gt;&amp;amp;gt;&lt;/code&gt;ï¼Œæ˜¯ç”±äºä½œè€…çš„&lt;a href="https://github.com/hklcf/Json-Parser-Online-Nulled/blob/master/script.js#L491,L492"&gt;è½¬æ¢&lt;/a&gt;ï¼Œä¸è¿‡æˆ‘ä¸å¤ªç†è§£è¿™ä¸ªç›®çš„ï¼Œæ³¨é‡Šæ‰è¿™2è¡Œä¹Ÿä¸€åˆ‡æ­£å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;æä¸ª&lt;a href="https://github.com/hklcf/Json-Parser-Online-Nulled/pull/1"&gt;PR&lt;/a&gt;ï¼Œä¸‹ç­å›å®¶ã€‚&lt;/p&gt;</content><category term="2023"></category><category term="html"></category></entry><entry><title>é¡ºç€ç½‘çº¿æ‰¾ä¾›åº”å•†</title><link href="https://fangpsh.github.io/posts/2022/2022-10-14.html" rel="alternate"></link><published>2022-10-14T00:00:00+08:00</published><updated>2022-10-14T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2022-10-14:/posts/2022/2022-10-14.html</id><summary type="html">&lt;p&gt;å…¬å¸åœ¨é€æ¸å¼€å±•å›½é™…ä¸šåŠ¡ï¼ŒæŸäº›å›½å®¶è¦†ç›–éœ€è¦è¡¥ç‚¹ï¼Œæ¶‰åŠåˆ°æ‰¾ä¾›åº”å•†ã€‚
å›½é™…ä¾›åº”å•†åœ¨äº¤æµå’Œå•†åŠ¡æ–¹å¼å’Œå’Œå›½å†…ä¾›åº”å•†éƒ½æœ‰ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å…¬å¸åœ¨é€æ¸å¼€å±•å›½é™…ä¸šåŠ¡ï¼ŒæŸäº›å›½å®¶è¦†ç›–éœ€è¦è¡¥ç‚¹ï¼Œæ¶‰åŠåˆ°æ‰¾ä¾›åº”å•†ã€‚
å›½é™…ä¾›åº”å•†åœ¨äº¤æµå’Œå•†åŠ¡æ–¹å¼å’Œå’Œå›½å†…ä¾›åº”å•†éƒ½æœ‰æ¯”è¾ƒå¤§çš„åŒºåˆ«ï¼Œæ¯”è¾ƒç†æƒ³çš„æ˜¯èƒ½æ‰¾åˆ°å›½å†…å»å›½å¤–åšå‡ºæµ·çš„ä¾›åº”å•†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å¸¸ç”¨çš„ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ç½‘çº¿æ‰¾ï¼Œå’±ä»¬æ‹¿åŸƒåŠä¸¾ä¾‹ã€‚&lt;/p&gt;
&lt;h2&gt;ç¬¬ä¸€æ­¥ï¼šç›®æ ‡å›½å®¶çš„ä¸»æµè¿è¥å•†&lt;/h2&gt;
&lt;p&gt;åŸƒåŠï¼šTEï¼ˆåŸƒåŠç”µä¿¡ï¼‰ï¼Œæ²ƒè¾¾ä¸°vodafoneç­‰ã€‚&lt;br&gt;
ä¸»æµè¿è¥å•†ï¼Œä½ å¯ä»¥Googleï¼Œæˆ–è€…çœ‹å›½å®¶çš„AS ï¼Œç„¶åæŒ‰ç½‘æ®µæ’åºï¼ŒIP çº¦å¤šä¸€èˆ¬å¸‚åœºä»½é¢è¶Šå¤§ï¼š
http://whois.ipip.net/countries/EG&lt;/p&gt;
&lt;p&gt;&lt;img alt="åŸƒåŠIPåœ°å€" src="/assets/images/2023/20230305202935.png"&gt;&lt;/p&gt;
&lt;p&gt;åŸƒåŠç”µä¿¡No.1
â€¨&lt;/p&gt;
&lt;h2&gt;ç¬¬äºŒæ­¥ï¼šä»¥æŸä¸ªä¸»æµè¿è¥å•†æ‰¾åˆ°å…³é”®AS å·&lt;/h2&gt;
&lt;p&gt;ä¾‹å¦‚åŸƒåŠç”µä¿¡æ˜¯AS8452 ï¼Œç‚¹è¿›å»ï¼š&lt;br&gt;
http://whois.ipip.net/AS8452&lt;br&gt;
æˆ‘ä¸€èˆ¬æ›´å–œæ¬¢çœ‹cidr-report&lt;br&gt;
https://www.cidr-report.org/cgi-bin/as-report?as=AS8452&amp;amp;view=2.0&lt;br&gt;
&lt;/p&gt;
&lt;h2&gt;ç¬¬ä¸‰æ­¥ï¼šæŒ‰AS æŸ¥è¯¢ Downstreamï¼Œä¸€èˆ¬ä»¥.HK .US ç»“å°¾çš„å›½åˆ«&lt;/h2&gt;
&lt;p&gt;downstream å°±æ˜¯å¾—ä¹°transitï¼Œåœ¨ä¸€ä¸ªå›½å®¶æ­£å¸¸å¼€å±•ä¸šåŠ¡ï¼Œä¸€èˆ¬ä¹Ÿç»•ä¸å¼€topN çš„è¿è¥å•†ã€‚
ä¸è¿‡ä¸€äº›æƒ…å†µæ˜¯å‘ç°ä¸äº†çš„ï¼Œä¾‹å¦‚åªèƒ½ç”¨è¿è¥å•†çš„IP ï¼Œåƒä¸­å›½ä¸‰å¤§è¿è¥å•†çš„æƒ…å†µï¼Œé‚£å°±é€šè¿‡å…¶ä»–è·¯å­äº†ã€‚&lt;/p&gt;
&lt;p&gt;å›½å†…å‡ºæµ·çš„å…¬å¸ï¼Œä¸€èˆ¬éƒ½æœ‰ä¸ªç¾å›½ã€é¦™æ¸¯ã€æ–°åŠ å¡ä¹‹ç±»çš„ä¸»ä½“ï¼Œæ‰€ä»¥é‡ç‚¹çœ‹downstream é‡Œé¢æ˜¯è¿™ç±»å›½åˆ«çš„ASã€‚â€¨&lt;/p&gt;
&lt;p&gt;&lt;img alt="downstream " src="/assets/images/2023/20230305203530.png"&gt;
ä»¥TE AS8452 ä¸ºä¾‹ï¼Œçœ¼ç†Ÿçš„è€æœ‹å‹æœ‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AS138915Â KAOPU-HK Kaopu Cloud HK Limited, HKï¼šé è°±äº‘&lt;/li&gt;
&lt;li&gt;AS54994Â QUANTILNETWORKS, USï¼šç½‘å®¿æµ·å¤–&lt;/li&gt;
&lt;li&gt;AS21859  ZEN-ECN, USï¼šå±‚å³°&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ç¬¬å››æ­¥ï¼šé¡ºè—¤æ‘¸ç“œ&lt;/h2&gt;
&lt;p&gt;æŒ‰ç…§ç¬¬ä¸‰æ­¥çš„AS çº¿ç´¢ï¼Œæµè§ˆä¸‹AS çš„æ³¨å†Œdomainï¼ŒGoogle åç§°ï¼Œä¼æŸ¥æŸ¥ï¼Œæ‰¾æ‰¾è”ç³»æ–¹å¼ã€å®˜ç½‘ç­‰ï¼Œä¸€èˆ¬éƒ½èƒ½æ‰¾åˆ°äº†ã€‚&lt;/p&gt;</content><category term="2022"></category><category term="BGP"></category><category term="IDC"></category></entry><entry><title>Python requests é«˜çº§ç”¨æ³•ï¼štimeoutsã€retriesã€hooks</title><link href="https://fangpsh.github.io/posts/2020/2020-10-04.html" rel="alternate"></link><published>2020-10-04T00:00:00+08:00</published><updated>2020-10-04T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2020-10-04:/posts/2020/2020-10-04.html</id><summary type="html">&lt;p&gt;&lt;img alt="python-requests" src="/assets/images/2023/20230228185617.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href="https://findwork.dev/blog/advanced-usage-python-requests-timeouts-retries-hooks/"&gt;findwork.dev&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€…ï¼šDani Hodovic&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æˆ‘ä½¿ç”¨çš„æ‰€æœ‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒPython çš„HTTP åº“ &lt;a href="https://requests.readthedocs.io/en/master/"&gt;requests&lt;/a&gt; æ˜¯æˆ‘æœ€å–œæ¬¢çš„HTTP å·¥å…·ã€‚å®ƒç®€å•ï¼Œç›´è§‚ï¼Œåœ¨Python ç¤¾åŒºä¸­æ— å¤„ä¸åœ¨ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="python-requests" src="/assets/images/2023/20230228185617.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href="https://findwork.dev/blog/advanced-usage-python-requests-timeouts-retries-hooks/"&gt;findwork.dev&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€…ï¼šDani Hodovic&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æˆ‘ä½¿ç”¨çš„æ‰€æœ‰ç¼–ç¨‹è¯­è¨€ä¸­ï¼ŒPython çš„HTTP åº“ &lt;a href="https://requests.readthedocs.io/en/master/"&gt;requests&lt;/a&gt; æ˜¯æˆ‘æœ€å–œæ¬¢çš„HTTP å·¥å…·ã€‚å®ƒç®€å•ï¼Œç›´è§‚ï¼Œåœ¨Python ç¤¾åŒºä¸­æ— å¤„ä¸åœ¨ã€‚å¤§å¤šæ•°ä¸HTTP äº¤äº’çš„ç¨‹åºè¦ä¹ˆä½¿ç”¨å®ƒï¼Œè¦ä¹ˆä½¿ç”¨æ ‡å‡†åº“çš„urllib3ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºç®€å•çš„API ï¼Œrequests éå¸¸å®¹æ˜“ä¸Šæ‰‹ï¼Œä¸ä»…å¦‚æ­¤ï¼Œåœ¨é«˜çº§ä½¿ç”¨åœºæ™¯ï¼Œå®ƒä¹Ÿæœ‰éå¸¸å¼ºçš„å¯æ‰©å±•æ€§ã€‚å¦‚æœä½ åœ¨ç¼–å†™ä¸€ä¸ªé¢‘ç¹è°ƒç”¨APIçš„å®¢æˆ·ç«¯ï¼Œæˆ–è€…ä¸€ä¸ªç½‘ç»œçˆ¬è™«ï¼Œä½ éœ€è¦èƒ½å®¹å¿ç½‘ç»œå¼‚å¸¸ï¼Œéœ€è¦æœ‰æ•ˆçš„debug è·Ÿè¸ªä¿¡æ¯ï¼Œè¿˜éœ€è¦ä¸€äº›è¯­æ³•ç³–ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æˆ‘åœ¨ç¼–å†™å¤§é‡è°ƒç”¨JSON API çš„ç½‘ç»œçˆ¬è™«æˆ–è€…ç¨‹åºæ—¶ï¼Œä»requests ä¸­å‘æ˜å‡ºçš„ä¸€äº›æœ‰ç”¨çš„åŠŸèƒ½ç‰¹æ€§æ±‡æ€»ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#è¯·æ±‚é’©å­"&gt;è¯·æ±‚é’©å­&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#è®¾ç½®baseurl"&gt;è®¾ç½®BaseUrl&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#è®¾ç½®é»˜è®¤è¶…æ—¶"&gt;è®¾ç½®é»˜è®¤è¶…æ—¶&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#å¤±è´¥æ—¶é‡è¯•"&gt;å¤±è´¥æ—¶é‡è¯•&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#ç»“åˆè¶…æ—¶å’Œé‡è¯•"&gt;ç»“åˆè¶…æ—¶å’Œé‡è¯•&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#è°ƒè¯•-http-è¯·æ±‚"&gt;è°ƒè¯• HTTP è¯·æ±‚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#æ‰“å°http-header"&gt;æ‰“å°HTTP Header&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#æ‰“å°æ‰€æœ‰ä¿¡æ¯"&gt;æ‰“å°æ‰€æœ‰ä¿¡æ¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#æµ‹è¯•å’Œä¼ªè£…è¯·æ±‚"&gt;æµ‹è¯•å’Œä¼ªè£…è¯·æ±‚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#æ¨¡ä»¿æµè§ˆå™¨è¡Œä¸º"&gt;æ¨¡ä»¿æµè§ˆå™¨è¡Œä¸º&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;è¯·æ±‚é’©å­&lt;/h2&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹APIæ¥å£çš„æ—¶å€™ï¼Œä½ é€šå¸¸éƒ½æƒ³è¦éªŒè¯è¿”å›å“åº”æ˜¯å¦æœ‰æ•ˆã€‚Requests æä¾›äº†ä¸€ä¸ªå¿«æ·çš„æ–¹æ³• &lt;code&gt;raise_for_status()&lt;/code&gt;ï¼Œå®ƒç¡®ä¿å“åº”çš„HTTP çŠ¶æ€ç ä¸æ˜¯4xx æˆ–è€…5xxï¼Œå³è¯·æ±‚æœªè§¦å‘å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.github.com/user/repos?page=1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# ç¡®ä¿æ­¤å¤„æ— é”™è¯¯&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raise_for_status&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦è°ƒç”¨&lt;code&gt;raise_for_status()&lt;/code&gt;ï¼Œå¤ªç¹å¤äº†ã€‚å¹¸è¿çš„æ˜¯ï¼Œrequests åº“æä¾›äº†ä¸€ä¸ªç±»ä¼¼â€œé’©å­â€çš„æ¥å£ï¼Œä½ å¯ä»¥åœ¨è¯·æ±‚çš„å„ä¸ªé˜¶æ®µæ·»åŠ å›è°ƒã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç”¨é’©å­æ¥ç¡®ä¿æ¯ä¸ªå“åº”å¯¹è±¡éƒ½è°ƒç”¨&lt;code&gt;raise_for_status()&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„requests å¯¹è±¡ï¼Œä¿®æ”¹å…¨å±€æ¨¡å—æŠ›å‡ºå¼‚å¸¸&lt;/span&gt;

&lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;assert_status_hook&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;raise_for_status&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hooks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;response&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;assert_status_hook&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://api.github.com/user/repos?page=1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;HTTPError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;401&lt;/span&gt; &lt;span class="n"&gt;Client&lt;/span&gt; &lt;span class="n"&gt;Error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Unauthorized&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;api&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;github&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;repos&lt;/span&gt;&lt;span class="err"&gt;?&lt;/span&gt;&lt;span class="n"&gt;page&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;è®¾ç½®BaseUrl&lt;/h2&gt;
&lt;p&gt;å‡è®¾ä½ ä»…ä½¿ç”¨api.org ä¸Šçš„APIã€‚æ¯æ¬¡http è°ƒç”¨ï¼Œä½ éƒ½éœ€è¦é‡å¤å†™åè®®å’ŒåŸŸåï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.org/list/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://api.org/list/3/item&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨&lt;a href="https://toolbelt.readthedocs.io/en/latest/sessions.html#baseurlsession"&gt;BaseUrlSession&lt;/a&gt; å°‘æ‰“ä¸€äº›å­—ã€‚å®ƒå…è®¸ä½ ä¸ºHTTP å®¢æˆ·ç«¯æŒ‡å®šåŸºç¡€çš„urlï¼Œè¿™æ ·æ¯æ¬¡è¯·æ±‚æ—¶å€™åªéœ€è¦æŒ‡å®šèµ„æºè·¯å¾„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;requests_toolbelt&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;sessions&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;sessions&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseUrlSession&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;base_url&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://api.org&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/list&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/list/item&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„é»˜è®¤å®‰è£…çš„requests ä¸åŒ…å«&lt;a href="https://github.com/requests/toolbelt"&gt;requests toolbelt&lt;/a&gt;ï¼Œä½ éœ€è¦å•ç‹¬å®‰è£…å®ƒã€‚&lt;/p&gt;
&lt;h2&gt;è®¾ç½®é»˜è®¤è¶…æ—¶&lt;/h2&gt;
&lt;p&gt;requests æ–‡æ¡£&lt;a href="https://requests.readthedocs.io/en/master/user/quickstart/#timeouts"&gt;å»ºè®®&lt;/a&gt; ä½ åœ¨æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒçš„ä»£ç ä¸­éƒ½è®¾ç½®è¶…æ—¶ã€‚å¦‚æœå¿˜è®°è®¾ç½®è¶…æ—¶ï¼Œå¼‚å¸¸çš„å¤–éƒ¨æœåŠ¡ä¼šå¯¼è‡´ä½ çš„åº”ç”¨hang ä½ï¼Œå°¤å…¶å¤§å¤šæ•°çš„Python ä»£ç æ˜¯åŒæ­¥çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;https://github.com/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.001&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½†æ˜¯è¿™æ ·åšéå¸¸é‡å¤ï¼Œå®¹æ˜“é—æ¼ã€‚æœªæ¥æŸä¸€å¤©å½“ä½ å‘ç°æ˜¯ç”±äºæŸäººå¿˜è®°è®¾ç½®è¶…æ—¶å¯¼è‡´ç”Ÿäº§ç¯å¢ƒçš„ç¨‹åºåœæ­¢æ—¶ï¼Œä½ ä¼šå¤§å‘é›·éœ†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="giphy" src="https://media.giphy.com/media/6IZzimIQN8guI/giphy.gif"&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;a href="https://requests.readthedocs.io/en/master/user/advanced/#transport-adapters"&gt;Transport Adapters&lt;/a&gt; ä¸ºæ¯ä¸ªHTTP è¯·æ±‚è®¾ç½®é»˜è®¤è¶…æ—¶æ—¶é—´ã€‚
å®ƒå¯ä»¥ç¡®ä¿å³ä½¿å¼€å‘äººå‘˜å¿˜è®°åœ¨ä»–çš„è°ƒç”¨ä¸­è®¾ç½® timeout=1 å‚æ•°ï¼Œä¹Ÿè®¾ç½®äº†ä¸€ä¸ªåˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨éƒ½å¯ä»¥è¦†ç›–å®ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ–‡æ˜¯ä¸€ä¸ªé…ç½®äº†é»˜è®¤è¶…æ—¶çš„è‡ªå®šä¹‰ Transport Adapter  ä¾‹å­ï¼Œçµæ„Ÿæ¥è‡ª&lt;a href="https://github.com/kennethreitz/requests/issues/3070#issuecomment-205070203"&gt;è¿™æ¡Github è¯„è®º&lt;/a&gt;ã€‚åœ¨æ„å»ºhttp å®¢æˆ·ç«¯å’Œsend() æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬é‡å†™äº†æ„é€ å‡½æ•°ï¼Œæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥ç¡®ä¿å½“æœªä¼ é€’timeout å‚æ•°æ—¶ ä¼šä½¿ç”¨é»˜è®¤çš„è¶…æ—¶æ—¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;requests.adapters&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;HTTPAdapter&lt;/span&gt;

&lt;span class="n"&gt;DEFAULT_TIMEOUT&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt; &lt;span class="c1"&gt;# seconds&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TimeoutHTTPAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;HTTPAdapter&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DEFAULT_TIMEOUT&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;timeout&amp;quot;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;timeout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="k"&gt;del&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;timeout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;timeout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="kc"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;timeout&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;

&lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="c1"&gt;# æŒ‚è½½åˆ° httpã€https &lt;/span&gt;
&lt;span class="n"&gt;adapter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;TimeoutHTTPAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mf"&gt;2.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# ä½¿ç”¨é»˜è®¤è¶…æ—¶ï¼š 2.5s &lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://api.twilio.com/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# ä¸ºç‰¹å®šè¯·æ±‚è¦†ç›–è¶…æ—¶æ—¶é—´&lt;/span&gt;
&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://api.twilio.com/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;timeout&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;å¤±è´¥æ—¶é‡è¯•&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å¸¸å¸¸ä¼šé‡åˆ°ç½‘ç»œè¿æ¥ä¸­æ–­ï¼Œæ‹¥å¡ï¼Œæˆ–è€…æœåŠ¡å™¨æ•…éšœã€‚å¦‚æœæƒ³ç¼–å†™ä¸€ä¸ªå¼ºå¤§çš„è½¯ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»è€ƒè™‘åˆ°å¤±è´¥çš„æƒ…å†µï¼Œå¹¶æŒ‡å®šé‡è¯•ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;ç»™HTTP å®¢æˆ·ç«¯æ·»åŠ é‡è¯•ç­–ç•¥éå¸¸ç®€å•ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª HTTPAdapterï¼Œä¼ å…¥æˆ‘ä»¬çš„é‡è¯•ç­–ç•¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;requests.packages.urllib3.util.retry&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Retry&lt;/span&gt;

&lt;span class="n"&gt;retry_strategy&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Retry&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;status_forcelist&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;429&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
    &lt;span class="n"&gt;method_whitelist&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HEAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;OPTIONS&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;adapter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;HTTPAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_retries&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;retry_strategy&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;adapter&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://en.wikipedia.org/w/api.php&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é»˜è®¤çš„Retry ç±»å·²ç»æœ‰åˆç†çš„é»˜è®¤å€¼ï¼Œä¸è¿‡å®ƒæ˜¯&lt;strong&gt;æ·±åº¦&lt;/strong&gt;å¯å®šåˆ¶åŒ–çš„ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘å¸¸ç”¨åˆ°çš„å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹å‚æ•°ä¹ŸåŒ…å«requests åº“çš„é»˜è®¤å‚æ•°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡è¯•æ€»æ¬¡æ•°ã€‚å¦‚æœå¤±è´¥çš„è¯·æ±‚æ•°æˆ–é‡å®šå‘æ¬¡æ•°è¾¾åˆ°è¯¥å€¼ï¼Œå®¢æˆ·ç«¯ä¼šæŠ›å‡º&lt;code&gt;urllib3.exceptions.MaxRetryError&lt;/code&gt; å¼‚å¸¸ã€‚æˆ‘ä¼šæ ¹æ®æˆ‘è°ƒç”¨çš„API æ¥è°ƒæ•´è¿™ä¸ªå‚æ•°ï¼Œä¸è¿‡æˆ‘é€šå¸¸å°†å…¶è®¾ç½®ä¸ºå°äº10ï¼Œä¸€èˆ¬3æ¬¡é‡è¯•å°±è¶³å¤Ÿäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;status_forcelist&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;413&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;429&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡è¯•çš„HTTP å“åº”çŠ¶æ€ç ã€‚ä½ å¯èƒ½æƒ³å¯¹&lt;strong&gt;å¸¸è§çš„æœåŠ¡å™¨é”™è¯¯ï¼ˆ500ï¼Œ502ï¼Œ503ï¼Œ504ï¼‰&lt;/strong&gt; éƒ½è¿›è¡Œé‡è¯•ï¼Œå› ä¸ºæœåŠ¡å™¨æˆ–è€…åå‘ä»£ç†ä¸éµå¾ªHTTP è§„èŒƒã€‚429 è¶…å‡ºé¢‘ç‡é™åˆ¶æ—¶æ€»é‡è¯•çš„åŸå› æ˜¯ï¼Œurllib åº“å¯¹äºå¤±è´¥è¯·æ±‚ä¼šæœ‰æ¸è¿›æ€§çš„é€€é¿ç­–ç•¥ï¼Œæ‰€ä»¥æ— ç¢ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;method_whitelist&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;HEAD&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;GET&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PUT&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;DELETE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;OPTIONS&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;TRACE&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡è¯•çš„HTTP æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°åŒ…å«é™¤äº†POST ä¹‹å¤–çš„æ‰€æœ‰HTTP æ–¹æ³•ï¼Œå› ä¸ºPOST ä¼šå¯¼è‡´æ–°å¢ã€‚&lt;strong&gt;ä¿®æ”¹è¯¥å‚æ•°å¢åŠ POST&lt;/strong&gt; æ˜¯å› ä¸ºå¤§å¤šæ•°æˆ‘æ¥è§¦è¿‡çš„API éƒ½éƒ½ä¸ä¼šè¿”å›é”™è¯¯ç ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨ç›¸åŒçš„è°ƒç”¨ä¸­æ‰§è¡Œæ–°å¢ã€‚å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œä½ æœ€å¥½ç»™ä»–ä»¬æä¸ªbugã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;backoff_factor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªå‚æ•°å¾ˆæœ‰è¶£ã€‚å®ƒå…è®¸ä½ ä¿®æ”¹è¿›ç¨‹åœ¨å¤±è´¥è¯·æ±‚ä¹‹é—´çš„ä¼‘çœ æ—¶é—´ã€‚ç®—æ³•æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{backoff factor} * (2 ** ({number of total retries} - 1))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœé€€é¿å› å­è®¾ç½®ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1ç§’ï¼Œä¼‘çœ æ—¶é—´ä¾æ¬¡ä¸º&lt;code&gt;0.5, 1, 2, 4, 8, 16, 32, 64, 128, 256&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;2ç§’ - &lt;code&gt;1, 2, 4, 8, 16, 32, 64, 128, 256, 512&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;10ç§’ - &lt;code&gt;5, 10, 20, 40, 80, 160, 320, 640, 1280, 2560&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å€¼å‘ˆæŒ‡æ•°å¢é•¿ï¼Œæ˜¯&lt;a href="https://stackoverflow.com/a/28732630/2966951"&gt;é‡è¯•ç­–ç•¥&lt;/a&gt; çš„åˆç†å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå‚æ•°é»˜è®¤æ˜¯0ï¼Œæ„å‘³ç€ä¸ä¼šè®¾ç½®æŒ‡æ•°é€€é¿ï¼Œé‡è¯•ä¼šç«‹å³æ‰§è¡Œã€‚&lt;strong&gt;ç¡®ä¿å®ƒè¢«è®¾ç½®ä¸º1ï¼Œä»¥å…å‡»å®ä½ çš„æœåŠ¡å™¨ï¼&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é‡è¯•æ¨¡å—çš„å®Œæ•´æ–‡æ¡£åœ¨&lt;a href="https://urllib3.readthedocs.io/en/latest/reference/urllib3.util.html#module-urllib3.util.retry"&gt;è¿™é‡Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;ç»“åˆè¶…æ—¶å’Œé‡è¯•&lt;/h3&gt;
&lt;p&gt;å› ä¸ºHTTPAdapter æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé‡è¯•å’Œè¶…æ—¶åƒä¸‹é¢è¿™æ ·ç»“åˆèµ·æ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;retries&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Retry&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;total&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;backoff_factor&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;status_forcelist&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;429&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mount&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;TimeoutHTTPAdapter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;max_retries&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;retries&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;è°ƒè¯• HTTP è¯·æ±‚&lt;/h2&gt;
&lt;p&gt;æœ‰æ—¶è¯·æ±‚å¤±è´¥ï¼Œä½†æ˜¯ä½ æ— æ³•æ‰¾å‡ºåŸå› ã€‚è®°å½•è¯·æ±‚å’Œå“åº”æˆ–è®¸èƒ½å¸®åŠ©ä½ æŸ¥æ˜å¤±è´¥åŸå› ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼Œä½¿ç”¨å†…ç½®çš„debug æ—¥å¿—é…ç½®ï¼Œæˆ–è€…ä½¿ç”¨è¯·æ±‚é’©å­ã€‚&lt;/p&gt;
&lt;h3&gt;æ‰“å°HTTP Header&lt;/h3&gt;
&lt;p&gt;å°†æ—¥å¿—è°ƒè¯•ç­‰çº§è°ƒæ•´åˆ°å¤§äº0ï¼Œå°±ä¼šè®°å½•å“åº”çš„HTTP Headerã€‚è¿™æ˜¯æœ€ç®€å•çš„é€‰é¡¹ï¼Œä½†æ˜¯å®ƒæ²¡æ³•è®©ä½ çœ‹åˆ°HTTP è¯·æ±‚å’Œå“åº”çš„åŒ…ä½“ã€‚å¦‚æœä½ è°ƒç”¨çš„APIä¼šè¿”å›è¶…å¤§çš„åŒ…ä½“æˆ–ä¸åˆé€‚æ‰“å°å‡ºæ¥ï¼Œä¾‹å¦‚åŒ…å«äºŒè¿›åˆ¶å†…å®¹ï¼Œè¿™ä¸ªé€‰é¡¹å¾ˆæœ‰ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;ä»»ä½•å¤§äº0 çš„æ—¥å¿—ç­‰çº§ï¼Œéƒ½ä¼šå¼€å¯è°ƒåˆ¶æ—¥å¿—ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;http&lt;/span&gt;

&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;HTTPConnection&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debuglevel&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://www.google.com/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# è¾“å‡º&lt;/span&gt;
&lt;span class="n"&gt;send&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="sa"&gt;b&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;GET / HTTP/1.1&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s1"&gt;Host: www.google.com&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s1"&gt;User-Agent: python-requests/2.22.0&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s1"&gt;Accept-Encoding: gzip, deflate&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s1"&gt;Accept: */*&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s1"&gt;Connection: keep-alive&lt;/span&gt;&lt;span class="se"&gt;\r\n\r\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;reply&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;HTTP/1.1 200 OK&lt;/span&gt;&lt;span class="se"&gt;\r\n&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Fri&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;28&lt;/span&gt; &lt;span class="n"&gt;Feb&lt;/span&gt; &lt;span class="mi"&gt;2020&lt;/span&gt; &lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt; &lt;span class="n"&gt;GMT&lt;/span&gt;
&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Expires&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;header&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Cache&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Control&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;private&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;max&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;age&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;æ‰“å°æ‰€æœ‰ä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ æƒ³æ‰“å°æ•´ä¸ªHTTP ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬è¯·æ±‚å’Œå“åº”å†…å®¹çš„æ–‡æœ¬å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨è¯·æ±‚é’©å­å’Œrequests_toolbelt ä¸­çš„dump å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;å½“æˆ‘è°ƒç”¨ä¸ä¼šè¿”å›å¾ˆå¤šçš„å“åº”å†…å®¹çš„REST API æ—¶ï¼Œæˆ‘æ›´å–œæ¬¢ç”¨è¿™ä¸ªé€‰é¡¹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;requests_toolbelt.utils&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;dump&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;logging_hook&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;dump&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dump_all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="nb"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;decode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hooks&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;response&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;logging_hook&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://api.openaq.org/v1/cities&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;params&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;BA&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;

&lt;span class="c1"&gt;# å‚è€ƒ&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;GET&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;v1&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;cities&lt;/span&gt;&lt;span class="err"&gt;?&lt;/span&gt;&lt;span class="n"&gt;country&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;BA&lt;/span&gt; &lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;Host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;api&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;openaq&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;org&lt;/span&gt;

&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="n"&gt;OK&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Content&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;application&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="n"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;utf&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;8&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Transfer&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;Encoding&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;chunked&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Connection&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;keep&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;alive&lt;/span&gt;
&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
   &lt;span class="s2"&gt;&amp;quot;meta&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;openaq-api&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;license&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;CC BY 4.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;website&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://docs.openaq.org/&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;page&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;limit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="s2"&gt;&amp;quot;found&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
   &lt;span class="p"&gt;},&lt;/span&gt;
   &lt;span class="s2"&gt;&amp;quot;results&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;
      &lt;span class="p"&gt;{&lt;/span&gt;
         &lt;span class="s2"&gt;&amp;quot;country&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;BA&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s2"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;GoraÅ¾de&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s2"&gt;&amp;quot;city&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;GoraÅ¾de&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s2"&gt;&amp;quot;count&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;70797&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
         &lt;span class="s2"&gt;&amp;quot;locations&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
   &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‚è€ƒ https://toolbelt.readthedocs.io/en/latest/dumputils.html&lt;/p&gt;
&lt;h2&gt;æµ‹è¯•å’Œä¼ªè£…è¯·æ±‚&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ç¬¬ä¸‰æ–¹API ä¼šç»™å¼€å‘äººå‘˜å¸¦æ¥ä¸€ä¸ªç—›ç‚¹ï¼Œå®ƒä»¬å¾ˆéš¾è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚&lt;a href="https://sentry.io/"&gt;Sentry&lt;/a&gt; çš„å·¥ç¨‹å¸ˆé€šè¿‡å†™äº†ä¸€ä¸ªåº“æ¥ä¼ªè£…è¯·æ±‚ï¼Œå‡è½»äº†å¼€å‘è¿‡ç¨‹ä¸­çš„ç—›è‹¦ã€‚&lt;/p&gt;
&lt;p&gt;æ— éœ€å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œ&lt;a href="https://github.com/getsentry/responses"&gt;getsentry/responses&lt;/a&gt; æˆªè·äº†HTTP è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªä½ çš„æµ‹è¯•è¿‡ç¨‹ä¸­æ·»åŠ çš„é¢„å…ˆå®šä¹‰å¥½çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;unittest&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;responses&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TestAPI&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;unittest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;TestCase&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nd"&gt;@responses&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;activate&lt;/span&gt;  &lt;span class="c1"&gt;# intercept HTTP calls within this method&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_simple&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;response_data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;ch_1GH8so2eZvKYlo2CSMeAfRqt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="s2"&gt;&amp;quot;object&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;charge&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="s2"&gt;&amp;quot;customer&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;id&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;cu_1GGwoc2eZvKYlo2CL2m31GRn&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;object&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;customer&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="c1"&gt;# mock the Stripe API&lt;/span&gt;
        &lt;span class="n"&gt;responses&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
            &lt;span class="n"&gt;responses&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="s2"&gt;&amp;quot;https://api.stripe.com/v1/charges&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;response_data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;)&lt;/span&gt;

        &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://api.stripe.com/v1/charges&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;assertEqual&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt; &lt;span class="n"&gt;response_data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœå‘å‡ºä¸€ä¸ªå’Œä¼ªè£…çš„å“åº”ä¸ä¸€è‡´çš„è¯·æ±‚ï¼Œåˆ™ä¼šå¼•å‘ ConnectionErrorã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;TestAPI&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;unittest&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;TestCase&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nd"&gt;@responses&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;activate&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;test_simple&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;responses&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;responses&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;GET&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;https://api.stripe.com/v1/charges&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;https://invalid-request.com&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¾“å‡º&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;requests.exceptions.ConnectionError: Connection refused by Responses - the call doesn&amp;#39;t match any registered mock.

Request:
- GET https://invalid-request.com/

Available matches:
- GET https://api.stripe.com/v1/charges
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;æ¨¡ä»¿æµè§ˆå™¨è¡Œä¸º&lt;/h2&gt;
&lt;p&gt;å¦‚æœä½ ç¼–å†™è¿‡è¶³å¤Ÿå¤šçš„web çˆ¬è™«ä»£ç ï¼Œä½ ä¼šæ³¨æ„åˆ°æŸäº›ç½‘ç«™ä¼šé’ˆå¯¹ä½ æ˜¯é€šè¿‡æµè§ˆå™¨è¿˜æ˜¯ä»£ç è®¿é—®ä¼šè¿”å›ä¸åŒçš„HTMLã€‚æœ‰æ—¶è¿™æ˜¯ä¸€ç§é˜²çˆ¬è™«çš„ç­–ç•¥ï¼Œä½†æ˜¯é€šå¸¸æ˜¯ç”±äºæœåŠ¡å™¨ä¼šå±…äºUser-Agent å—…æ¢ï¼Œæ‰¾å‡ºæœ€é€‚åˆè®¿é—®è®¾å¤‡çš„å†…å®¹ï¼ˆä¾‹å¦‚æ¡Œé¢ç«¯æˆ–ç§»åŠ¨ç«¯ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³è¦æœåŠ¡å™¨è¿”å›æµè§ˆå™¨ä¸€æ ·çš„å†…å®¹ï¼Œä½ å¯ä»¥é‡å†™è¯·æ±‚çš„ User-Agent å¤´ä¿¡æ¯ä¸ºFIrefoxæˆ–Chromeã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;requests&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Session&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;User-Agent&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2020"></category><category term="Python"></category><category term="Requests"></category></entry><entry><title>ä¸€ä¸ªåŒå‘MTRä»…å•å‘ä¸¢åŒ…çš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2020/2020-09-09.html" rel="alternate"></link><published>2020-09-09T00:00:00+08:00</published><updated>2020-09-09T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2020-09-09:/posts/2020/2020-09-09.html</id><summary type="html">&lt;p&gt;ç°è±¡:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A æœºå™¨ping B æœºå™¨ä¸¢åŒ…ï¼Œè§¦å‘A MTR Bï¼Œæœ€åä¸€è·³ä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;li&gt;B æœºå™¨ping A æœºå™¨ä¸¢åŒ…ï¼Œè§¦å‘B MTR Aï¼Œæœ€åä¸€è·³ä¸ä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img alt="mtr-a2b" src="/assets/images/2023/20230228185207.png"&gt;
&lt;img alt="mtr-b2a" src="/assets/images/2023/20230228185227.png"&gt;&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§ä¹‹å‰çš„ç†è§£ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç°è±¡:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A æœºå™¨ping B æœºå™¨ä¸¢åŒ…ï¼Œè§¦å‘A MTR Bï¼Œæœ€åä¸€è·³ä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;li&gt;B æœºå™¨ping A æœºå™¨ä¸¢åŒ…ï¼Œè§¦å‘B MTR Aï¼Œæœ€åä¸€è·³ä¸ä¸¢åŒ…ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img alt="mtr-a2b" src="/assets/images/2023/20230228185207.png"&gt;
&lt;img alt="mtr-b2a" src="/assets/images/2023/20230228185227.png"&gt;&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§ä¹‹å‰çš„ç†è§£ï¼ŒA MTR B å’Œ B MTR ï¼Œæœ€åä¸€è·³åº”è¯¥æ˜¯é•œåƒå¯¹ç­‰çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;A  MTR B :

A                   B
|---------&amp;gt;---------|  &amp;lt; icmp request  package1
|--------&amp;lt;----------|  &amp;lt; icmp reply    package2

B MTR A:

B                   A
|---------&amp;gt;---------|  &amp;lt; icmp request  package3
|--------&amp;lt;----------|  &amp;lt; icmp reply    package4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœA MTR Bå‡ºç°ä¸¢åŒ…ï¼Œé‚£ä¹ˆå¯èƒ½å‡ºç°åœ¨ å»ç¨‹ï¼Œä¹Ÿå¯èƒ½æ˜¯å›ç¨‹ï¼Œæ‰€ä»¥æ‰éœ€è¦B MTR A æ¥åˆ¤æ–­æ–­ç‚¹ã€‚
å¯ä»¥è®¤ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;package1 èµ°çš„è·¯å¾„ == package4 èµ°çš„è·¯å¾„
package2 èµ°çš„è·¯å¾„ == package3 èµ°çš„è·¯å¾„
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;A MTR B ä¸¢åŒ…ï¼Œæ„å‘³ç€package1 æˆ–è€…package2 å‡ºç°äº†ä¸¢ï¼Œé‚£ä¹ˆB MTR A ä¹Ÿåº”è¯¥ä¼šå½±å“æ‰å¯¹ã€‚
æ—¢ç„¶äº‹å®ä¸ç¬¦åˆè¿™ä¸ªå‡è®¾ï¼Œé‚£ä¹ˆè¯´æ˜è¿™ä¸ªå‡è®¾æ˜¯é”™çš„ã€‚é‚£ä¹ˆæ˜¯ä»€ä¹ˆå½±å“åˆ°äº†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;çŒœæƒ³ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº¤æ¢æœºä¼šé’ˆå¯¹äº”å…ƒç»„è´Ÿè½½å‡è¡¡å¯¼è‡´ï¼Ÿï¼Œå¯æ˜¯ICMPä¸å¸¦ç«¯å£ï¼ŒMTR é»˜è®¤æ˜¯ICMPï¼›  &lt;/li&gt;
&lt;li&gt;äº¤æ¢æœºå¯¹icmp request å’Œreply åŒ…çš„ç­–ç•¥ä¸åŒï¼ŸB Ping A ä¹Ÿæ˜¯ä¸¢åŒ…ï¼Œæ’é™¤è¿™ä¸ªçŒœæƒ³ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ—¢ç„¶B ping A å’Œ B MTR A è¡¨ç°ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆPing å’ŒMTR æœ‰ä»€ä¹ˆå·®å¼‚ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åŒ…å¤§å°ï¼Ÿmtr çœ‹äº†ä¸‹icmp åŒ…å¤§å°ï¼Œping æŒ‡å®šäº†ä¸‹ï¼ŒB ping Aï¼Œè¿˜æ˜¯ä¸¢åŒ…ã€‚&lt;br&gt;
TTLï¼Ÿping é»˜è®¤ttl = 64ï¼Œmtr çš„ttl æ˜¯ä»1 å¼€å§‹é€æ¸æ¢æµ‹ï¼Œæ‹¿åˆ°å¯¹ç«¯åœ°å€å›åŒ…ä¸ºæ­¢ï¼Œåœ¨è¿™ä¸ªåœºæ™¯é‡Œï¼ŒB MTR A ï¼Œæœ€åä¸€è·³ttl = 15ã€‚&lt;/p&gt;
&lt;p&gt;ping -t æŒ‡å®šttl = 15ï¼Œæœç„¶ä¸ä¸¢ï¼Œttl &amp;gt; 15ï¼Œå³ä¸¢åŒ…ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;package1 çš„ttl = å»ç¨‹æœ€å¤§ï¼Œpackage4 çš„ttl = 64ï¼›
package2 çš„ttl = 64ï¼Œpackage3 çš„ttl = å›ç¨‹æœ€å¤§ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ€€ç–‘æ˜¯ICMP åŒ…çš„TTL  å½±å“åˆ°äº†QoS ç­–ç•¥ã€‚ç”¨å…³é”®è¯æœç´¢äº†ä¸‹ï¼Œå‘ç°äº†å¥½åƒå¯ä»¥åŸºäºTTL è®¾ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst9400/software/release/16-8/configuration_guide/qos/b_168_qos_9400_cg/b_168_qos_9400_cg_chapter_01.html"&gt;cisco:QoS&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Time-to-Live Classification
You can classify packets based on the ACL map. You can set Time-to_live (TTL) as a criterion in the ACL list and perform a TTL check on the incoming packet. The access control entry is used to check the IPv4 TTL to match the value on the incoming packet. The classified packet is either marked or policed based on the policy-map action. Queueing cannot be configured on this classification.

The following is an example of TTL classification:

policy-map TTL_MATCH
    class IPV4_TTL
        police rate 6000000000
        set dscp af23

ip access-list extended IPV4_TTL
    permit ip any any ttl eq 100
    permit tcp any any ttl ne 150
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸äº†è§£è·¯ç”±å™¨å’Œäº¤æ¢æœºçš„é…ç½®ï¼Œå’¨è¯¢ä¸‹ä¸¤ä¸ªäº‘/IDC å‚å•†çš„ç½‘å·¥ï¼Œæ²¡æœ‰å¾—åˆ°å¾ˆå¤šä¿¡æ¯ï¼Œå§‘ä¸”è¿™ä¹ˆæ€€ç–‘å§ã€‚&lt;/p&gt;</content><category term="2020"></category><category term="MTR"></category><category term="Network"></category></entry><entry><title>Azure ä¸ŠSalt Minionå¼‚å¸¸æ–­çº¿çš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2020/2020-04-25.html" rel="alternate"></link><published>2020-04-25T00:00:00+08:00</published><updated>2020-04-25T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2020-04-25:/posts/2020/2020-04-25.html</id><summary type="html">&lt;p&gt;åœ¨å‡ å°Azure çš„æœºå™¨ä¸Šå‘ç°salt minionä¸€ç›´åœ¨åˆ‡æ¢èŠ‚ç‚¹ï¼Œä»¥ä¸ºæ˜¯åˆ°é˜¿é‡Œäº‘é¦™æ¸¯çš„æŠ–åŠ¨é—®é¢˜ï¼ŒåŠ äº†ä¸€ä¸ªé˜¿é‡Œäº‘ç¡…è°·èŠ‚ç‚¹ï¼ŒæŠŠAzure ç¾å›½å¢ƒå†…çš„èŠ‚ç‚¹éƒ½åˆ†é…è¿‡ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åœ¨å‡ å°Azure çš„æœºå™¨ä¸Šå‘ç°salt minionä¸€ç›´åœ¨åˆ‡æ¢èŠ‚ç‚¹ï¼Œä»¥ä¸ºæ˜¯åˆ°é˜¿é‡Œäº‘é¦™æ¸¯çš„æŠ–åŠ¨é—®é¢˜ï¼ŒåŠ äº†ä¸€ä¸ªé˜¿é‡Œäº‘ç¡…è°·èŠ‚ç‚¹ï¼ŒæŠŠAzure ç¾å›½å¢ƒå†…çš„èŠ‚ç‚¹éƒ½åˆ†é…è¿‡å»ï¼Œè¿˜æ˜¯å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ—¶å€™ç›‘æ§ä¹Ÿå‘ç°å‡ æ¬¡Azure åˆ°é˜¿é‡Œäº‘å¢ƒå†…Ping å¼‚å¸¸ä¸¢å¤±ï¼Œä»¥ä¸ºæ˜¯ç½‘ç»œé—®é¢˜ï¼ŒæŠ“MTRæŠ¥éšœå¤„ç†ä¸­ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘ç»œæ¢å¤ä¹‹åï¼Œè¿˜æ˜¯å¸¸å¸¸åˆ‡æ¢masterï¼Œåˆ‡å°±åˆ‡å§ï¼Œé—®é¢˜æ˜¯åˆ‡æ¢ä¹‹åï¼Œä¼¼ä¹è¿›å…¥äº†ä¸€ç§å¼‚å¸¸çŠ¶æ€ï¼Œåªèƒ½é‡å¯salt minion æ‰èƒ½è§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;å¥½åƒç¿»åˆ°ä¸€ä¸ªissue è¯´æ˜¯master list çš„é—®é¢˜ï¼Œåˆ‡æ¢æˆå•masterï¼Œè§‚å¯Ÿä¸€æ™šä¸Šï¼Œè¿˜æ˜¯å¼‚å¸¸ã€‚&lt;/p&gt;
&lt;p&gt;åˆæ€€ç–‘æ˜¯zeromq çš„é—®é¢˜ï¼Œæ¢åˆ°tcp transportï¼Œè¿˜æ˜¯æœ‰é—®é¢˜ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Feb 27 14:51:07 ... salt-minion[18665]: AttributeError: &amp;#39;NoneType&amp;#39; object has no attribute &amp;#39;add_callback&amp;#39;
Feb 27 15:07:35 ... salt-minion[18665]: [WARNING ] Master ip address changed from 47.8 to 18.1
Feb 27 15:07:35 ... salt-minion[18665]: [WARNING ] Master ip address changed from 47.8 to 18.1
Feb 27 15:07:36 ... salt-minion[18665]: [WARNING ] Master ip address changed from 47.8 to 18.1
Feb 27 15:07:36 ... salt-minion[18665]: [ERROR   ] Exception in callback &amp;lt;function SaltMessageClient.connect.&amp;lt;locals&amp;gt;.handle_future at 0x7f6283dac1e0&amp;gt; for &amp;lt;salt.ext.
Feb 27 15:07:36 ... salt-minion[18665]: Traceback (most recent call last):
Feb 27 15:07:36 ... salt-minion[18665]: File &amp;quot;/usr/lib/python3.6/site-packages/salt/ext/tornado/concurrent.py&amp;quot;, line 326, in _set_done
Feb 27 15:07:36 ... salt-minion[18665]: cb(self)
Feb 27 15:07:36 ... salt-minion[18665]: File &amp;quot;/usr/lib/python3.6/site-packages/salt/transport/tcp.py&amp;quot;, line 1043, in handle_future
Feb 27 15:07:36 ... salt-minion[18665]: self.io_loop.add_callback(self.connect_callback, response)
Feb 27 15:07:36 ... salt-minion[18665]: AttributeError: &amp;#39;NoneType&amp;#39; object has no attribute &amp;#39;add_callback&amp;#39;
Feb 27 15:23:55 ... salt-minion[18665]: [WARNING ] Master ip address changed from 18.1 to 47.8
Feb 27 15:23:56 ... salt-minion[18665]: [ERROR   ] Exception in callback &amp;lt;function SaltMessageClient.connect.&amp;lt;locals&amp;gt;.handle_future at 0x7f6284bf1b70&amp;gt; for &amp;lt;salt.ext.
Feb 27 15:23:56 ... salt-minion[18665]: Traceback (most recent call last):
Feb 27 15:23:56 ... salt-minion[18665]: File &amp;quot;/usr/lib/python3.6/site-packages/salt/ext/tornado/concurrent.py&amp;quot;, line 326, in _set_done
Feb 27 15:23:56 ... salt-minion[18665]: cb(self)
Feb 27 15:23:56 ... salt-minion[18665]: File &amp;quot;/usr/lib/python3.6/site-packages/salt/transport/tcp.py&amp;quot;, line 1043, in handle_future
Feb 27 15:23:56 ... salt-minion[18665]: self.io_loop.add_callback(self.connect_callback, response)
Feb 27 15:23:56 ... salt-minion[18665]: AttributeError: &amp;#39;NoneType&amp;#39; object has no attribute &amp;#39;add_callback&amp;#39;
Feb 27 15:40:15 ... salt-minion[18665]: [WARNING ] Master ip address changed from ... to ...
Feb 27 15:40:16 ... salt-minion[18665]: [WARNING ] Master ip address changed from ... to ...
Feb 27 15:40:16 ... salt-minion[18665]: [ERROR   ] Exception in callback &amp;lt;function SaltMessageClient.connect.&amp;lt;locals&amp;gt;.handle_future at 0x7f6280447e18&amp;gt; for &amp;lt;salt.ext.
Feb 27 15:40:16 ... salt-minion[18665]: Traceback (most recent call last):
Feb 27 15:40:16 ... salt-minion[18665]: File &amp;quot;/usr/lib/python3.6/site-packages/salt/ext/tornado/concurrent.py&amp;quot;, line 326, in _set_done
Feb 27 15:40:16 ... salt-minion[18665]: cb(self)
Feb 27 15:40:16 ... salt-minion[18665]: File &amp;quot;/usr/lib/python3.6/site-packages/salt/transport/tcp.py&amp;quot;, line 1043, in handle_future
Feb 27 15:40:16 ... salt-minion[18665]: self.io_loop.add_callback(self.connect_callback, response)
Feb 27 15:40:16 ... salt-minion[18665]: AttributeError: &amp;#39;NoneType&amp;#39; object has no attribute &amp;#39;add_callback&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åˆç¿»äº†å‡ ä¸ªissueï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/saltstack/salt/issues/26888"&gt;salt-minion error on unstable tcp connection #26888&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/saltstack/salt/issues/20240"&gt;Minion did not return #20240&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/saltstack/salt/issues/6231"&gt;Minion losing connection and not returning without a restart of service #6231&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/saltstack/salt/issues/40794"&gt;Master (EC2) connectivity issues with Minion (Azure) with tcp transport #40794&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/43343245/online-saltstack-minions-on-azure-losses-connection-with-master-on-digitalocean"&gt;Online Saltstack Minions on Azure losses connection with Master on DigitalOcean&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;If Azure isn't respecting keepalive, that could definitely be causing your problems. As of right now, the minions will not attempt to reconnect outside of the ZMQ keepalive routines. (We recognize that this is a problem -- the biggest blocker is the fact that ZMQ is not very good at reporting that connections are dead. We've been trying to find a good way around this problem)
basepi commented on Dec 6, 2013&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åŸæ¥Azure æœ‰ä¸ªé»˜è®¤çš„ç½‘ç»œé“¾æ¥è¶…æ—¶æ—¶é—´ï¼Œ&lt;a href="https://docs.microsoft.com/en-us/azure/load-balancer/load-balancer-outbound-connections#idletimeout"&gt;Use keepalives to reset the outbound idle timeout&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Outbound connections have a 4-minute idle timeout. This timeout is adjustable via Outbound rules. You can also use transport (for example, TCP keepalives) or application-layer keepalives to refresh an idle flow and reset this idle timeout if necessary.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Azure é»˜è®¤æ˜¯240sï¼Œå°äºSalt minion é»˜è®¤çš„300sï¼Œç›¸å½“äºé•¿è¿æ¥ä¼šè¢«Azure ä»ä¸­é—´æ–­å¼€ã€‚
çŒœæµ‹salt å¯¹è¿™ç§closed æƒ…å†µä»£ç ä¸Šå¯èƒ½å¤„ç†çš„ä¸å¤Ÿå¥½ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‡å®šä¸‹&lt;a href="https://docs.saltstack.com/en/latest/ref/configuration/minion.html#tcp-keepalive-idle"&gt;tcp_keepalive_idle&lt;/a&gt;ï¼Œé»˜è®¤æ˜¯300sï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tcp_keepalive_idle: 60
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡å¯ï¼Œç»ˆäºè§£å†³äº†ã€‚&lt;/p&gt;</content><category term="2020"></category><category term="azure"></category><category term="saltstack"></category></entry><entry><title>æ­å»ºIPv6 Only æµ‹è¯•ç¯å¢ƒ</title><link href="https://fangpsh.github.io/posts/2020/2020-03-12.html" rel="alternate"></link><published>2020-03-12T00:00:00+08:00</published><updated>2020-03-12T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2020-03-12:/posts/2020/2020-03-12.html</id><summary type="html">&lt;p&gt;&lt;img alt="baidu.com" src="/assets/images/2023/20230228184346.png"&gt;&lt;/p&gt;
&lt;p&gt;macOS å¯ä»¥å¼€å¯&lt;a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/UnderstandingandPreparingfortheIPv6Transition/UnderstandingandPreparingfortheIPv6Transition.html"&gt;DNS64/NAT64&lt;/a&gt;ï¼Œ
ç®€å•å¿«æ·ã€‚ä½†æ˜¯mac mini ä¿¡å·ä¸å¤ªå¥½ï¼Œå¼€å‘åŒå­¦æŠ±æ€¨å¸¸å¸¸è¿ä¸ä¸Šï¼Œè€Œä¸”æœ‰å¤šä¸ªç»„çš„åŒå­¦è¦æµ‹è¯•ï¼Œå†ä¹°å‡ å°mac mini å¥½ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="baidu.com" src="/assets/images/2023/20230228184346.png"&gt;&lt;/p&gt;
&lt;p&gt;macOS å¯ä»¥å¼€å¯&lt;a href="https://developer.apple.com/library/archive/documentation/NetworkingInternetWeb/Conceptual/NetworkingOverview/UnderstandingandPreparingfortheIPv6Transition/UnderstandingandPreparingfortheIPv6Transition.html"&gt;DNS64/NAT64&lt;/a&gt;ï¼Œ
ç®€å•å¿«æ·ã€‚ä½†æ˜¯mac mini ä¿¡å·ä¸å¤ªå¥½ï¼Œå¼€å‘åŒå­¦æŠ±æ€¨å¸¸å¸¸è¿ä¸ä¸Šï¼Œè€Œä¸”æœ‰å¤šä¸ªç»„çš„åŒå­¦è¦æµ‹è¯•ï¼Œå†ä¹°å‡ å°mac mini å¥½åƒæœ‰ç‚¹è´¹é’±ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æ¥äº†ä¸ªæ´»ï¼Œç”¨&lt;a href="https://openwrt.org/"&gt;OpenWrt&lt;/a&gt; æ­å»ºå‡ ä¸ªIPv6 Only æµ‹è¯•ç¯å¢ƒã€‚&lt;/p&gt;
&lt;h2&gt;é€‰è·¯ç”±&lt;/h2&gt;
&lt;p&gt;çœ‹äº†ä¸‹ï¼ŒNewifi  D2ã€æ–è®¯K2P ã€æè·¯ç”±ä»¥åŠå°ç±³éƒ¨åˆ†ç‰ˆæœ¬å‡å¯ä»¥åˆ·OpenWrtã€‚å…ˆæ˜¯åœ¨äº¬ä¸œä¸‹å•äº†ä¸€ä¸ªå°ç±³R3Gï¼Œåˆ°æ‰‹åå‘ç°æ˜¯R3G V2ï¼Œå…¶å®æ˜¯4Aï¼Œå‘çˆ¹ï¼Œåˆ·æœºè¿˜å¾—æ¥TTLã€‚
è½¬å»å’¸é±¼ï¼ŒæŒ‘äº†ä¸€ä¸ªäºŒæ‰‹çš„&lt;a href="https://openwrt.org/toh/xiaomi/mir3g"&gt;å°ç±³R3G&lt;/a&gt;ï¼ˆV1ï¼Œå¸¦USBï¼‰å’Œ &lt;a href="https://openwrt.org/toh/hwdata/d-team/d-team_newifi_d2"&gt;Newifi D2&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;åˆ·æœº&lt;/h2&gt;
&lt;p&gt;å°ç±³R3Gåˆ°æ‰‹éœ€è¦å…ˆåˆ·&lt;a href="https://breed.hackpascal.net/"&gt;Breed&lt;/a&gt;ï¼Œå†åˆ·OpenWrtï¼ŒåŸºæœ¬æŒ‰ç…§ç½‘ä¸Šçš„æ•™ç¨‹æ²¡å•¥é—®é¢˜ï¼Œå‚è€ƒ&lt;a href="https://blog.csdn.net/dvd_sun/article/details/89737513"&gt;å°ç±³è·¯ç”±å™¨3Gåˆ·å…¥OpenWrt&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åˆ·å®Œbreedé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ— æ³•å¯åŠ¨ï¼Œç”µè„‘çº¿è¿WANå£ï¼Œåªèƒ½è¿›å…¥breedï¼Œæœæ¥æœå»ï¼Œçœ‹åˆ°ä¸¤ä¸ªå¸–å­:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.right.com.cn/forum/thread-255438-2-1.html"&gt;æˆ‘å·²ç»è§£å†³å°ç±³è·¯ç”±å™¨3Gåˆ·breedåæ— æ³•åˆ·å›ºä»¶çš„é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.bilibili.com/read/cv796610/"&gt;å°ç±³è·¯ç”±å™¨3Gï¼ˆR3Gï¼‰åˆ·å…¥BREEDæ— æ³•åˆ·å›ºä»¶&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨breedç¯å¢ƒè®¾ç½®ç•Œé¢åˆ é™¤normal_firmware_md5ï¼Œä¿å­˜é‡å¯ï¼Œæœç„¶å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;Newifi D2 åˆ°æ‰‹ï¼Œå–å®¶å·²ç»åˆ·å¥½breed å’Œå®šåˆ¶ç‰ˆæœ¬çš„OpenWrtï¼Œä¸å¤ªå–œæ¬¢ï¼Œä»openwrt.org ä¸‹è½½äº†ä¸€ä¸ªå‡çº§åŒ…ï¼Œè¦†ç›–å³å¯ã€‚&lt;/p&gt;
&lt;h2&gt;DNS64/NAT64&lt;/h2&gt;
&lt;p&gt;åŸºæœ¬æ˜¯å‚è€ƒè¿™ç¯‡å¸–å­ï¼š&lt;a href="https://blog.csdn.net/dengxinfa/article/details/104218997"&gt;openwrtä½¿ç”¨tayga/totdå®ç°NAT64/DNS64&lt;/a&gt;ï¼ŒNAT64 å®‰è£…tayga ç…§ç€é…ç½®æ²¡å•¥é—®é¢˜ã€‚é™¤äº†taygaï¼Œè¿˜æœ‰ä¸€ä¸ªæ–°çš„é¡¹ç›®&lt;a href="https://www.jool.mx/en/openwrt.html"&gt;Jool&lt;/a&gt;ä¹Ÿå¯ä»¥å®ç°NAT64ã€‚&lt;/p&gt;
&lt;p&gt;æ¢æº&lt;code&gt;/etc/opkg/distfeeds.conf&lt;/code&gt;ï¼Œä¸­ç§‘å¤§æºæœ€è¿‘å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œæ¢æˆæ¸…åï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;src/gz openwrt_core http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/targets/ramips/mt7621/packages
src/gz openwrt_kmods http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/targets/ramips/mt7621/kmods/4.14.171-1-2e88863ccdd594fb8e842df3c25842ee
src/gz openwrt_base http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/packages/mipsel_24kc/base
src/gz openwrt_luci http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/packages/mipsel_24kc/luci
src/gz openwrt_packages http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/packages/mipsel_24kc/packages
src/gz openwrt_routing http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/packages/mipsel_24kc/routing
src/gz openwrt_telephony http://mirrors.tuna.tsinghua.edu.cn/openwrt/releases/19.07.2/packages/mipsel_24kc/telephony
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‚è€ƒå‰é¢æ•™ç¨‹è®¾ç½®å®Œæˆåï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tayga-nat64 Link encap:UNSPEC  HWaddr 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
          inet6 addr: fe80::xxx:xxx:xxx:1fea/64 Scope:Link
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:36077 errors:0 dropped:0 overruns:0 frame:0
          TX packets:36793 errors:0 dropped:3 overruns:0 carrier:0
          collisions:0 txqueuelen:500
          RX bytes:15494186 (14.7 MiB)  TX bytes:15679087 (14.9 MiB)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@OpenWrt:~# ping6  qq.com
PING qq.com (fd2e:f49a:9639:1111::7b97:8912): 56 data bytes
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=0 ttl=50 time=37.958 ms
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=1 ttl=50 time=37.962 ms
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=2 ttl=50 time=38.267 ms
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=3 ttl=50 time=37.821 ms
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=4 ttl=50 time=37.260 ms
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=5 ttl=50 time=37.530 ms
64 bytes from fd2e:f49a:9639:1111::7b97:8912: seq=6 ttl=50 time=37.828 ms
^C
--- qq.com ping statistics ---
7 packets transmitted, 7 packets received, 0% packet loss
round-trip min/avg/max = 37.260/37.803/38.267 ms
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;DNS64 éœ€è¦totdï¼Œä¸è¿‡è¿™è½¯ä»¶åœ¨ä»“åº“ä¸­æ²¡äº†ï¼Œéœ€è¦äº¤å‰ç¼–è¯‘ï¼Œæœ‰ç‚¹éº»çƒ¦ã€‚åæ¥çœ‹åˆ°&lt;a href="https://microcai.org/2019/02/13/nat64.html"&gt;unbound&lt;/a&gt;ï¼Œä»“åº“é‡Œé¢ä¹Ÿæ²¡æœ‰ã€‚é‚£åªèƒ½ç”¨&lt;a href="https://openwrt.org/docs/guide-user/services/dns/bind"&gt;bind&lt;/a&gt; äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;opkg install bind-server
/etc/init.d/named enable
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¿®æ”¹é…ç½®&lt;code&gt;/etc/bind/named.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;options {
        directory &amp;quot;/tmp&amp;quot;;
        listen-on port 53  { any; };
        listen-on-v6 port 53 { any; };

        recursion yes;
        allow-recursion { any; };
        allow-query { any; };
        allow-query-cache { any; };


        forwarders {
                202.96.134.133;
                223.5.5.5;
                114.114.114.114;
        };

        auth-nxdomain no;
        dns64 fd2e:f49a:9639:1111::/96 {}; #å‚è€ƒtayga ä¸­é…é¢çš„å‰ç¼€
};
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;openwrt æœ¬èº«è·‘ç€ä¸€ä¸ªdnsmasqï¼Œç”¨ä½œDNS å’ŒDHCP ç­‰æœåŠ¡ï¼Œæœ¬æ¥æƒ³é€šè¿‡&lt;a href="https://openwrt.org/docs/guide-user/base-system/dhcp"&gt;server=&lt;/a&gt; é…ç½®ï¼ŒæŠŠè¯·æ±‚è½¬ç»™bindï¼Œbindè®¾ç½®ä¸€ä¸ªé53ç«¯å£ï¼Œ
ä¸è¿‡å°è¯•äº†ä¸‹å¥½åƒæœ‰ç‚¹é—®é¢˜ï¼Œé‚£å°±ç›´æ¥å…³æ‰dnsmasq çš„dns æœåŠ¡å¥½äº†(è®¾ç½®portä¸º0)ï¼š
&lt;code&gt;/etc/config/dhcp&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;config dnsmasq
        option port &amp;#39;0&amp;#39;
        option domainneeded &amp;#39;1&amp;#39;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡å¯ç½‘ç»œå’Œnamedåï¼Œdig(&lt;code&gt;opkg install bind-tools&lt;/code&gt;)æµ‹è¯•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;root@OpenWrt:~# dig qq.com AAAA +short
fd2e:f49a:9639:1111::b703:e223
fd2e:f49a:9639:1111::3d81:72f
fd2e:f49a:9639:1111::7b97:8912
root@OpenWrt:~#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®Œç¾ã€‚&lt;/p&gt;
&lt;p&gt;å†å…³é—­ä¸‹Lanå£çš„DHCP å³å¯ï¼Œå¯ä»¥åœ¨ç½‘é¡µä¸Šç‚¹ç‚¹ç‚¹ï¼Œæˆ–è€…ä¿®æ”¹ä¸‹é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...
config dhcp &amp;#39;lan&amp;#39;
        option interface &amp;#39;lan&amp;#39;
        option dhcpv6 &amp;#39;server&amp;#39;
        option ra &amp;#39;server&amp;#39;
        option ra_management &amp;#39;1&amp;#39;
        option ignore &amp;#39;1&amp;#39;
        option ra_default &amp;#39;1&amp;#39;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é…ç½®é¡¹è§£é‡Šï¼Œå¯å‚è€ƒ&lt;a href="https://www.douban.com/note/618429634/"&gt;DHCPv6 over PPPoE on OpenWrt / LEDE&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæ„Ÿè°¢å„ä½ç½‘å‹çš„æ•™ç¨‹:) ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;2023å¹´-06-27 æ›´æ–°ï¼š  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœULA æ˜¯å†…ç½‘æ®µï¼ˆfd,fc ï¼‰åˆå…³é—­äº†dhcpv4ï¼Œå®‰å“è®¾å¤‡ä¼šæ— æ³•è¿æ¥ï¼Œå°†ULAæ›¿æ¢ä¸ºå…¬ç½‘æ®µå³å¯è§£å†³ã€‚  &lt;/li&gt;
&lt;li&gt;ç°åœ¨ï¼Œä½¿ç”¨Jool æ˜¯æœ€ä½³é€‰æ‹©ï¼š&lt;ol&gt;
&lt;li&gt;https://openwrt.org/docs/guide-user/network/ipv6/nat64&lt;/li&gt;
&lt;li&gt;https://nicmx.github.io/Jool/en/openwrt.html&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;</content><category term="2020"></category><category term="OpenWrt"></category><category term="IPv6"></category><category term="DNS64"></category><category term="NAT64"></category></entry><entry><title>å…³äºOpenSSH AuthorizedKeysCommand çš„å‡ ä¸ªå°é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2020/2020-03-03.html" rel="alternate"></link><published>2020-03-03T00:00:00+08:00</published><updated>2020-03-03T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2020-03-03:/posts/2020/2020-03-03.html</id><summary type="html">&lt;p&gt;åˆ†äº«å‡ ä¸ªä½¿ç”¨AuthorizedKeysCommand é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h1&gt;å…³é—­SELinux&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;... error: AuthorizedKeysCommand ...  returned status 126
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæ²¡æœ‰å…³é—­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¥‡æ€ªçš„é—®é¢˜ï¼Œæ‰‹åŠ¨è°ƒç”¨è„šæœ¬èƒ½æˆåŠŸï¼Œå®é™…sshd æ—¥å¿— â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åˆ†äº«å‡ ä¸ªä½¿ç”¨AuthorizedKeysCommand é‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h1&gt;å…³é—­SELinux&lt;/h1&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;... error: AuthorizedKeysCommand ...  returned status 126
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæ²¡æœ‰å…³é—­ï¼Œå¯èƒ½ä¼šé‡åˆ°å¥‡æ€ªçš„é—®é¢˜ï¼Œæ‰‹åŠ¨è°ƒç”¨è„šæœ¬èƒ½æˆåŠŸï¼Œå®é™…sshd æ—¥å¿—æŠ¥error status 126ã€‚
å¦‚æœå®‰è£…äº†&lt;a href="https://docs.pagure.org/setroubleshoot/SETroubleShootOverview.html"&gt;setroubleshoot&lt;/a&gt;ï¼Œå¯ä»¥çœ‹åˆ°è¯¦ç»†çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h1&gt;å…¬é’¥åˆ—è¡¨ä¼¼ä¹æœ‰å¤§å°é™åˆ¶ï¼Ÿ&lt;/h1&gt;
&lt;p&gt;åº”è¯¥æ˜¯å››äº”å¹´å‰äº†ï¼Œåœ¨ä¹‹å‰å…¬å¸ä¸€å¼€å§‹è„šæœ¬é‡Œé¢é€šè¿‡&lt;code&gt;curl&lt;/code&gt; æ‹¿åˆ°ç»“æœç›´æ¥è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚æœ‰ä¸€å¤©æŸäº›åŒå­¦ååº”ç™»å½•ä¸ä¸ŠæŸå°æœºå™¨ï¼Œç™»å½•å…¶ä»–æœºå™¨æ­£å¸¸ã€‚
å¼€å§‹äº†æ¼«é•¿çš„æ’æŸ¥è¿‡ç¨‹ï¼Œåæ¥æœç´¢åˆ°ä¸€å°é‚®ä»¶&lt;a href="https://groups.google.com/forum/#!topic/mailing.unix.openssh-dev/0kYCFOyla3w"&gt;AuthorizedKeysCommand size issue?&lt;/a&gt;ï¼Œä¸Šå¼‚å¸¸æœºå™¨æ‰§è¡Œäº†ä¸‹è„šæœ¬ï¼Œè¾“å‡ºçš„å…¬é’¥åˆ—è¡¨ç¡®å®å¾ˆé•¿ã€‚
æ”¹ä¸‹è„šæœ¬ï¼Œä¸‹æŠŠcurl æ‹¿åˆ°çš„å…¬é’¥åˆ—è¡¨å…ˆå­˜åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­(mktemp)ï¼Œå†catï¼Œæœç„¶å¥½äº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h1&gt;status 141&lt;/h1&gt;
&lt;p&gt;å†™shell è„šæœ¬ï¼Œå¼€å¤´æˆ‘ä¸€èˆ¬éƒ½ä¼šåŠ &lt;code&gt;set -e&lt;/code&gt;ï¼Œè¿™ä¸ªè„šæœ¬ä¹Ÿä¸ä¾‹å¤–ã€‚å‘ç°ä¸€ä¸ªè¯§å¼‚çš„é—®é¢˜ï¼Œåœ¨æŸäº‘å•†æŸå¯ç”¨åŒºï¼ŒæŸäº›åŒå­¦ç™»å½•æœºå™¨ä¼šé—´æ­‡æ€§å¤±è´¥ã€‚
æ—¥å¿—æ˜¾ç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...error: AuthorizedKeysCommand ... failed, status 141
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;141 çš„æ„æ€æ˜¯ï¼š&lt;code&gt;141 is SIGPIPE (128 indicating signal + SIGPIPE)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æœåˆ°ä¸€ä¸ªç›¸å…³çš„é“¾æ¥:&lt;/p&gt;
&lt;p&gt;&lt;a href="https://lists.pld-linux.org/mailman/pipermail/pld-cvs-commit/Week-of-Mon-20131028/380095.html"&gt;packages/openssh  ignore SIGPIPE from ldap-helper. ssh server does not read whole input if matching key is found&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;"ignore SIGPIPE from ldap-helper. ssh server does not read whole input if matching key is found"&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¼€å¯debug æ¨¡å¼ï¼Œå‘ç°OpenSSH åœ¨åŒ¹é…AuthorizedKeysCommand è¿”å›çš„å…¬é’¥åˆ—è¡¨æ—¶ï¼Œåªè¦ä¸€è¯»åˆ°åŒ¹é…çš„å…¬é’¥ï¼Œå°±ä¸ä¼šç»§ç»­è¯»äº†ï¼Œåº”è¯¥æ˜¯è¿™ä¸ªæ—¶å€™å‘é€äº†ä¸€ä¸ªä¿¡å·ï¼Œå¯¼è‡´è„šæœ¬é€€å‡ºçŠ¶æ€å¼‚å¸¸ã€‚
æ³¨é‡Šæ‰&lt;code&gt;set -e&lt;/code&gt;å°±æ­£å¸¸äº†ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºä¸ºä»€ä¹ˆå°±è¿™ä¸ªåŒºåŸŸçš„æœºå™¨éƒ¨åˆ†æœºå™¨æœ‰é—®é¢˜ï¼Œèƒ½åŠ›å’Œç²¾åŠ›éƒ½ä¸è¶³ï¼Œæä¸æ¸…æ¥šäº†:(&lt;/p&gt;</content><category term="2020"></category><category term="OpenSSH"></category></entry><entry><title>ç›‘æ§è§’åº¦</title><link href="https://fangpsh.github.io/posts/2020/2020-02-22.html" rel="alternate"></link><published>2020-02-22T00:00:00+08:00</published><updated>2020-02-22T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2020-02-22:/posts/2020/2020-02-22.html</id><summary type="html">&lt;p&gt;ç›‘æ§å“ªäº›æŒ‡æ ‡ï¼Œä¸€èˆ¬æ˜¯ç ”å‘æ‹è„‘è¢‹å†³å®šï¼Œè¦ä¹ˆæ˜¯æŒ‡æ ‡å¤ªå¤šæŠ“ä¸ä½é‡ç‚¹ï¼Œç»™ç›‘æ§ç³»ç»Ÿå’Œè¿ç»´äººå‘˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ã€‚
è¦ä¹ˆæ˜¯é—æ¼å…³ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ç›‘æ§å“ªäº›æŒ‡æ ‡ï¼Œä¸€èˆ¬æ˜¯ç ”å‘æ‹è„‘è¢‹å†³å®šï¼Œè¦ä¹ˆæ˜¯æŒ‡æ ‡å¤ªå¤šæŠ“ä¸ä½é‡ç‚¹ï¼Œç»™ç›‘æ§ç³»ç»Ÿå’Œè¿ç»´äººå‘˜å¸¦æ¥å¾ˆå¤§å‹åŠ›ã€‚
è¦ä¹ˆæ˜¯é—æ¼å…³é”®æŒ‡æ ‡ï¼Œä¸èƒ½æå‰æ„ŸçŸ¥å¼‚å¸¸ï¼Œæˆ–åœ¨æ•…éšœå‡ºç°æ—¶æä¾›çº¿ç´¢ã€‚&lt;/p&gt;
&lt;p&gt;é¢è¯•æ—¶å¶å°”ä¼šé—®çš„ä¸€é“é¢˜ï¼Œå€™é€‰äººå¯¹æŸæœåŠ¡è¿›è¡Œç›‘æ§çš„è¯è¦è€ƒè™‘å“ªäº›æŒ‡æ ‡ã€‚å¸Œæœ›å¬åˆ°çš„å›ç­”ï¼Œä¸ä»…å…¨é¢ï¼Œè€Œä¸”æœ‰ä½“ç³»ï¼Œä½†æ˜¯ç­”æ¡ˆé€šå¸¸éƒ½æ‚ä¹±æ— ç« ã€æƒ³ä¸€ä¸ªæ˜¯ä¸€ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;åˆ†äº«ä¸‹ä¸ªäººçš„æ€»ç»“ã€‚&lt;/p&gt;
&lt;h2&gt;å¯¹è±¡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿç›‘æ§&lt;ul&gt;
&lt;li&gt;Linux ç³»ç»ŸçŠ¶æ€ï¼ŒåŒ…æ‹¬è½¯ä»¶ã€ç¡¬ä»¶ï¼Œä¾‹å¦‚CPUã€å†…å­˜ã€Raidå¡ã€æ¸©åº¦ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹ç›‘æ§&lt;ul&gt;
&lt;li&gt;è¿›ç¨‹çŠ¶æ€ï¼Œä¾‹å¦‚è¿›ç¨‹çŠ¶æ€ï¼Œè¿›ç¨‹Crashäº‹ä»¶ã€JVM FULL GCæ¬¡æ•°å’Œè€—æ—¶ï¼ŒJVM    å„ç±»å †æ ˆå¤§å°ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;è¿™é‡Œçš„è¿›ç¨‹ï¼Œä¸ä¸€å®šç»å¯¹æ˜¯è¿›ç¨‹ï¼Œè€Œæ˜¯è¿›ç¨‹è„±ç¦»å…·ä½“ä¸šåŠ¡çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚nginx ä¸¢å¼ƒè¿æ¥æ•°ï¼Œæ¡†æ¶ä¾‹å¦‚tomcatä¼šæš´éœ²å‡ºä¸ä¸šåŠ¡æ— å…³çš„æŒ‡æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡ç›‘æ§&lt;ul&gt;
&lt;li&gt;å’Œå…·ä½“ä¸šåŠ¡ç›¸å…³&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ å„ç±»http è¯·æ±‚å æ¯”ã€è€—æ—¶&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç³»ç»Ÿç›‘æ§ï¼Œä¸€èˆ¬ç³»ç»Ÿè¿ç»´ä¼šåšå¥½ã€‚ä¸è¿‡åœ¨äº‘ä¸Šï¼Œè¿™å—ç»†èŠ‚å˜å°‘ï¼Œè‡³å°‘æ²¡æœ‰é‚£ä¹ˆå¤šç¡¬ä»¶è¦ç›‘æ§ã€‚
ä¸šåŠ¡ç›‘æ§çš„è§’åº¦ä¸€èˆ¬ä¸ä¼šæ¼ï¼Œä½†æ˜¯è¿›ç¨‹ç›‘æ§è§’åº¦å¸¸å¸¸è¢«å¿½ç•¥ï¼Œæˆ–è€…ä¹Ÿæ˜¯å› ä¸ºä¸¤è€…ç•Œé™ä¸æ˜¯å¾ˆå¼ºã€‚
æ˜¯â€œè¿›ç¨‹â€è¿˜æ˜¯â€œä¸šåŠ¡â€ï¼Œå…·ä½“æƒ…å†µå…·ä½“åˆ†æï¼Œä¾‹å¦‚ä¸€ä¸ªåŸºç¡€æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒçš„ä¸€äº›åŸºç¡€æŒ‡æ ‡å°±æ˜¯ä¸šåŠ¡ï¼Œä¾‹å¦‚Redisé›†ç¾¤ã€‚&lt;/p&gt;
&lt;h2&gt;é»„é‡‘æŒ‡æ ‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿï¼ˆè¯·æ±‚å¤„ç†æ—¶é—´ã€å“åº”æ—¶é—´ï¼‰&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨å¤„ç†æŸä¸ªè¯·æ±‚æ‰€éœ€è¦çš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;å‰”é™¤éæ­£å¸¸è¯·æ±‚ï¼ˆé™æµã€é”™è¯¯è¯·æ±‚ï¼‰ä»¥å…è¯¯å¯¼ï¼Œæ—¢ç„¶è¦å‰”é™¤ï¼Œé‚£å°±ä¹Ÿéœ€è¦ç›‘æ§&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ http è¯·æ±‚æ—¶é—´99å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æµé‡ï¼ˆè¯·æ±‚qpsã€å¸¦å®½é€Ÿç‡ã€ioé€Ÿç‡ã€iopsï¼‰&lt;ul&gt;
&lt;li&gt;é’ˆå¯¹ç³»ç»Ÿè´Ÿè½½é”æ‰€è¿›è¡Œåº¦é‡çš„æŒ‡æ ‡&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é”™è¯¯&lt;ul&gt;
&lt;li&gt;å•ä½æ—¶é—´å†…çš„å¤±è´¥é‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ä»…åŒ…å«åè®®å±‚é¢çš„ï¼Œä¾‹å¦‚http 500ï¼Œä¹ŸåŒ…å«ä¸šåŠ¡å±‚é¢çš„ï¼Œä¾‹å¦‚ç™»å½•å¤±è´¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¥±å’Œåº¦&lt;ul&gt;
&lt;li&gt;é’ˆå¯¹ç³»ç»Ÿå†…~~æœ€ä¸º~~å—é™èµ„æºçš„åº¦é‡æŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;å¯ä»¥æ˜¯ç³»ç»Ÿå±‚é¢çš„ï¼Œä¾‹å¦‚ç£ç›˜å®¹é‡ã€å¸¦å®½å®¹é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸šåŠ¡å±‚é¢çš„ï¼Œä¾‹å¦‚å¹¶å‘æ‹‰æµæ•°ï¼Œå¹¶å‘åœ¨çº¿äººæ•°ã€‚&lt;/li&gt;
&lt;li&gt;ä¹¦é‡Œé¢é’ˆå¯¹é¥±å’Œåº¦æœ‰â€œæœ€ä¸ºâ€2ä¸ªå­—ï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºâ€œæœ€ä¸ºâ€æ˜¯æ¯”è¾ƒéš¾ä»¥è¡¡é‡çš„ï¼Œå¯¹äºä¸€ä¸ªè´Ÿè½½çš„ç³»ç»Ÿæ¥è¯´ï¼Œå—é™çš„èµ„æºæ–¹æ–¹é¢é¢ï¼Œä¸åŒåœºæ™¯ä¸‹è§¦å‘çš„ä¸Šé™å¯èƒ½ä¸åŒã€‚è¿™é‡Œçš„æŒ‡æ ‡ï¼Œæˆ‘è®¤ä¸ºå…¶å®åªæ˜¯ä¸€ç§è§’åº¦ï¼Œæˆ‘ä»¬è¦åšçš„åªæ˜¯éœ€è¦é’ˆå¯¹é¥±å’Œåº¦è¿›è¡Œè®¾ç½®ç›‘æ§æŒ‡æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å»¶è¿Ÿè¿™ä¸ªæŒ‡æ ‡éå¸¸æœ‰ç”¨ï¼Œé™¤äº†å‘ç°å¼‚å¸¸ï¼Œè¿˜å¯ç”¨äºé¢„æŠ¥å¼‚å¸¸ï¼ˆé¥±å«åº¦ï¼‰ï¼Œï¼Œå½“å»¶è¿Ÿå˜é«˜ï¼Œå¾€å¾€ä»¥ä¸ºæ¥è¿‘æ€§èƒ½æ‹ç‚¹ï¼Œé¥±å«åº¦å¼‚å¸¸ã€‚
å»¶è¿ŸæŒ‡æ ‡è¿˜å¯ç”¨äºæ€§èƒ½ç›‘æ§ï¼Œä¾‹å¦‚æ›´æ–°ç‰ˆæœ¬ä¹‹åï¼Œå»¶è¿Ÿï¼ˆhttp å“åº”æ—¶é—´99å€¼ï¼‰çš„å˜åŒ–ã€‚
æ‰€ä»¥ï¼Œä¸è¦å¿˜è®°é’ˆå¯¹å»¶è¿Ÿè®¾è®¡ç›‘æ§ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href="https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/"&gt;ã€ŠGoogle SRE ç¬¬å…­ç« ã€‹&lt;/a&gt;#The Four Golden Signals&lt;/p&gt;
&lt;h2&gt;ç¤ºä¾‹&lt;/h2&gt;
&lt;p&gt;æŸNginx é™æ€æ–‡ä»¶æœåŠ¡ï¼ŒæŒ‰ä»¥ä¸Šè§’åº¦ï¼Œè®¾ç½®çš„éƒ¨åˆ†æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;h4&gt;å¯¹è±¡&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ç³»ç»Ÿç›‘æ§&lt;ul&gt;
&lt;li&gt;CPU åˆ©ç”¨ç‡ã€ç£ç›˜å æœ‰ç‡ã€å¸¦å®½ã€å…¨è¿æ¥é˜Ÿåˆ—ã€åŠè¿æ¥é˜Ÿåˆ—ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è¿›ç¨‹ç›‘æ§&lt;ul&gt;
&lt;li&gt;æ—¥å¿—ï¼šnginx error.log &lt;/li&gt;
&lt;li&gt;Nginx statusæ¨¡å—æš´éœ²çš„æŒ‡æ ‡ï¼šä¸¢å¼ƒè¿æ¥æ•°ã€å¹¶å‘è¿æ¥æ•°&lt;/li&gt;
&lt;li&gt;ä¾‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Active connections: 291
server accepts handled requests
16630948 16630948 31070465
Reading: 6 Writing: 179 Waiting: 106    
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;ä¸šåŠ¡ç›‘æ§&lt;ul&gt;
&lt;li&gt;è®¿é—®æ—¥å¿—åˆ†æï¼ŒçŠ¶æ€ç ã€å“åº”æ—¶é—´ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;é»„é‡‘æŒ‡æ ‡&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿ&lt;ul&gt;
&lt;li&gt;2xx è¯·æ±‚å“åº”æ—¶é—´99å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æµé‡&lt;ul&gt;
&lt;li&gt;å½“å‰æ´»è·ƒè¿æ¥æ•°ï¼Œhttp è¯·æ±‚qps&lt;/li&gt;
&lt;li&gt;å½“å‰æœºå™¨å¸¦å®½&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é”™è¯¯&lt;ul&gt;
&lt;li&gt;5xx è¯·æ±‚qpsï¼Œè¯¥æœåŠ¡ä¸‹ä¸€èˆ¬ä¸ä¼šå‡ºç°&lt;/li&gt;
&lt;li&gt;404 è¯·æ±‚qpsï¼Œå¯èƒ½æ„å‘³ç€æ–‡ä»¶åŒæ­¥å¤±è´¥&lt;/li&gt;
&lt;li&gt;nginx æ‹’ç»è¿æ¥æ•°&lt;/li&gt;
&lt;li&gt;å‘¨æœŸæ£€æµ‹error.log æ–°æ—¥å¿—&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¥±å’Œåº¦&lt;ul&gt;
&lt;li&gt;ç£ç›˜å®¹é‡ï¼Œé™æ€æ–‡ä»¶è¾ƒå¤š&lt;/li&gt;
&lt;li&gt;å½“å‰æ´»è·ƒè¿æ¥æ•°ï¼Œè·ç¦»nginx è®¾ç½®çš„æœ€å¤§è¿æ¥æ•°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content><category term="2020"></category><category term="monitor"></category></entry><entry><title>ç¬¬äºŒå±Šä¸­å›½SD-WAN å¹¿å‘Šå³°ä¼šå‚ä¼šæ„Ÿæƒ³</title><link href="https://fangpsh.github.io/posts/2019/2019-11-16.html" rel="alternate"></link><published>2019-11-16T00:00:00+08:00</published><updated>2019-11-16T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-11-16:/posts/2019/2019-11-16.html</id><summary type="html">&lt;p&gt;&lt;img alt="sd-wan-define" src="/assets/images/2023/20230301162425.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»&lt;a href="https://www.sdnlab.com/"&gt;SDNLAB&lt;/a&gt; çŸ¥é“&lt;a href="https://www.bagevent.com/event/5443171/p/314542"&gt;ç¬¬äºŒå±Š 2019 ä¸­å›½SD-WANå³°ä¼š&lt;/a&gt;ï¼ŒæŠ¥åäº†ä¼šå‰çš„åŸ¹è®­ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºä»äº‹è¿ç»´å·¥ä½œï¼Œä¸€ç›´å’Œç½‘ç»œæ‰“äº¤é“ï¼Œå¯¹BGPã€éª¨å¹²ç½‘ã€PoPã€PEã€SDNã€SD-WANç­‰åç§°çŸ¥é“ä¸€äº›ï¼Œä½†æ˜¯ç»ˆç©¶å› ä¸º â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="sd-wan-define" src="/assets/images/2023/20230301162425.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»&lt;a href="https://www.sdnlab.com/"&gt;SDNLAB&lt;/a&gt; çŸ¥é“&lt;a href="https://www.bagevent.com/event/5443171/p/314542"&gt;ç¬¬äºŒå±Š 2019 ä¸­å›½SD-WANå³°ä¼š&lt;/a&gt;ï¼ŒæŠ¥åäº†ä¼šå‰çš„åŸ¹è®­ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºä»äº‹è¿ç»´å·¥ä½œï¼Œä¸€ç›´å’Œç½‘ç»œæ‰“äº¤é“ï¼Œå¯¹BGPã€éª¨å¹²ç½‘ã€PoPã€PEã€SDNã€SD-WANç­‰åç§°çŸ¥é“ä¸€äº›ï¼Œä½†æ˜¯ç»ˆç©¶å› ä¸ºæ²¡æœ‰å®æ“è¿‡ï¼Œä¸å¤ªäº†è§£ã€‚
åº•å±‚ç½‘ç»œåº”è¯¥å±äºé€šä¿¡ï¼Œå’Œè®¡ç®—æœºéš”ç€ä¸€é“é—¨ï¼Œå€Ÿè¿™æ¬¡å¤§ä¼šçœ‹çœ‹å¦å¤–ä¸€ä¸ªè¡Œä¸šçš„äººéƒ½åœ¨ç©ä»€ä¹ˆã€‚&lt;/p&gt;
&lt;p&gt;åˆ†äº«ä¸‹åŸ¹è®­å¹»ç¯ç‰‡ï¼š&lt;a href="https://drive.google.com/file/d/1SjBeD5gkb6rfpFwAFK-7nTxWzKM7F2Uh/view?usp=share_link"&gt;2019 SD WANæŠ€æœ¯ä¸åº”ç”¨åŸ¹è®­è¯¾ä»¶&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¥è‡ªæœªæ¥ç½‘ç»œåˆ›æ–°ç ”ç©¶é™¢çš„å¼ æ™¨è®²çš„ç¡®å®ä¸é”™ï¼Œå®å®åœ¨åœ¨çš„å¹²è´§ï¼Œä»–çš„åˆ†äº«å†…å®¹å¯¹æˆ‘æ¥è¯´æœ‰æ·±æœ‰æµ…ï¼Œæµ…æ˜¯å› ä¸ºç†Ÿæ‚‰ï¼Œæ€»çš„æ¥è¯´ï¼Œå¬å®Œèƒ½çŸ¥é“SD-WAN çš„æ¦‚å¿µã€ç°çŠ¶ã€ç¼ºç‚¹ã€ä¼˜åŠ¿ã€åº”ç”¨åœºæ™¯ç­‰ã€‚
å…¶ä»–ä¸¤ä½ï¼Œå¯å¿½ç•¥ï¼Œçº¯ç²¹çš„æ¥æ‰“å¹¿å‘Šçš„ã€‚ä¸»åŠæ–¹å¤ªä¸è¦è„¸ï¼Œ1200å…ƒ/å¤©çš„åŸ¹è®­ï¼Œè¿˜æ’åŠå¤©çš„å¹¿å‘Šã€‚&lt;/p&gt;
&lt;p&gt;SD-WAN æ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå¡è¿›äº†å¤ªå¤šçš„ä¸œè¥¿ã€‚ç½‘ç»œè™šæ‹ŸåŒ–ï¼Œè¿˜æ˜¯æœ€åä¸€ä¸ªå…¬é‡ŒIPSecï¼Œæœ‰ç‚¹æ–°ç“¶æ—§é…’çš„æ„æ€ï¼Ÿã€‚å½“ç„¶ä¹Ÿä¸æ˜¯æ²¡æ–°çš„ä¸œè¥¿ï¼Œåªæ˜¯åœ¨æˆ‘ä¸€ä¸ªå¤–äººçœ‹æ¥ï¼Œä¼¼ä¹æ²¡é‚£ä¹ˆæƒŠè‰³ï¼Œä¹Ÿå¯èƒ½æˆ‘ç†è§£ä¸åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;éå¸¸æœŸå¾…çš„æœ€åä¸€å…¬é‡Œè§£å†³æ–¹æ¡ˆï¼Œçœ‹èµ·æ¥ä¹Ÿåªä¸è¿‡æ˜¯IPSec+ç™½ç›’çš„ç©æ³•ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è½¯ä»¶å·¥ç¨‹å¸ˆä¸è‡ªå·±åšå‘¢ï¼Ÿåè€Œè¦åœ¨ä¸­é—´åŠ ä¸€ä¸ªâ€œoverlayâ€çš„è¿è¥å•†ï¼ŒæŠŠç½‘ç»œæ ¹åŸºå»ºåœ¨è¿™ç¾¤ä¸­å°å‹çš„åˆåˆ›å…¬å¸ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;éå¸¸è®¤å¯SD-WAN ä¸­å¤§é‡çš„â€œè½¯ä»¶åŒ–â€ã€â€œè™šæ‹ŸåŒ–â€ï¼Œä¹Ÿéå¸¸è®¤å¯è®²å¸ˆè¯´çš„æœªæ¥å°†â€œä»¥äº‘ä¸ºä¸­å¿ƒâ€è¿›è¡Œç»„ç½‘ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒå¤©çš„ä¼šåœºï¼Œæœ‰å–è®¾å¤‡ï¼Œæœ‰å–è½¯ä»¶çš„ï¼Œä¹Ÿæœ‰å–æœåŠ¡çš„ï¼Œâ€œç”šè‡³â€æœ‰å–æµé‡çš„ã€‚å¯¹äºæŸäº›å…¬å¸æ¥è¯´ï¼Œç½‘ç»œå¯ç”¨æ€§æ˜¯æ ¹åŸºï¼Œè®²å¸ˆä¹Ÿæåˆ°ï¼Œä¸ŠSD-WANè¦éå¸¸è°¨æ…ï¼Œå› ä¸ºä¸Šè½¦å®¹æ˜“ä¸‹è½¦éš¾ï¼Œéœ€è¯„ä¼°çš„ä¸œè¥¿æ–¹æ–¹é¢é¢ï¼Œæ¶‰åŠå¤ªå¤šã€‚
ç„¶è€Œç°åœºçš„ä¸­å›½æœ¬åœŸå…¬å¸ï¼Œè§„æ¨¡ä¼¼ä¹éƒ½ä¸å¤§ï¼ˆæˆç«‹æ—¶é—´&amp;lt;=5å¹´ï¼Œå‘˜å·¥&amp;lt;500äººï¼‰ã€‚å›½å¤–çš„é‚£å‡ ä¸ªå·¨å¤´ï¼Œç°åœºåªæœ‰Versa å’ŒAryakaï¼Œå”®åæœåŠ¡æœåŠ¡ä¸å¤ªå¥½çš„æ ·å­ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘ä¸¤å¹´åšä¼šè®®è§£å†³æ–¹æ¡ˆçš„å‚å•†è¶Šæ¥è¶Šå¤šï¼Œåœ¨çº¿ä¼šè®®éœ€è¦è§£å†³å®æ—¶æ€§å’Œå¯ç”¨æ€§ï¼Œå¦‚æœä¸€å®¶è¿™æ ·çš„äº’è”ç½‘å…¬å¸æ˜¯å»ºç«‹åœ¨å¤–éƒ¨çš„SD-WANæ–¹æ¡ˆä¸Šï¼Œé‚£ä¹ˆæœªæ¥å¯èƒ½è¢«æ£è‚˜ï¼Œå› ä¸ºå®ƒå¯¹ä½ æ¥è¯´æ˜¯â€œunderlayâ€ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼ŒSD-WANé‡Œé¢ä¸ä»…ä»…åªæ˜¯ç»„ç½‘å’Œé€šä¿¡é€‰è·¯çš„äº‹ï¼Œè¿˜æœ‰å¤§é‡åº•å±‚çš„å·¥ä½œï¼Œè€Œé€šä¿¡/ç½‘ç»œè¿™ä¸ªè¡Œä¸šæ˜¯æœ‰æ¯”è¾ƒé«˜çš„å£å’ï¼Œè¿™å¯èƒ½æ˜¯è¿™äº›SD-WANå…¬å¸çš„å¤§ä½¬å¤§éƒ½æ˜¯æ¥è‡ªè¿™2ä¸ªè¡Œä¸šçš„åŸå› ï¼Œè¿™äº›è¡Œä¸šç»éªŒä¹Ÿæ˜¯å®ƒä»¬çš„ä»·å€¼ä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æƒ³è¦çš„å…¶å®æ˜¯ä¸€ä¸ªæ›´å¼ºçš„&lt;a href="https://github.com/slackhq/nebula"&gt;slack/nebula&lt;/a&gt;ã€&lt;a href="https://www.tinc-vpn.org/"&gt;tinc&lt;/a&gt;ã€&lt;a href="https://github.com/zerotier"&gt;ZeroTier&lt;/a&gt;ï¼Œ
é™¤äº†ç»„ç½‘ï¼ŒåŒæ—¶è¿˜èƒ½æ™ºèƒ½é€‰è·¯ã€çº¿è·¯å®¹ç¾ç­‰é«˜çº§åŠŸèƒ½ï¼Œé€‰è·¯èµ·ç å¾—å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="transport" src="/assets/images/2023/20230301162504.png"&gt;&lt;/p&gt;
&lt;p&gt;æ€»ç»“æ„Ÿå—ï¼šå¹¿å‘ŠçœŸå¤šï¼Œéš”è¡Œå¦‚éš”å±±ï¼Œé›¾éœ¾è¿˜æ˜¯å¾ˆå‰å®³ ğŸ˜‚&lt;/p&gt;</content><category term="2019"></category><category term="SD-WAN"></category></entry><entry><title>ç¬¬ä¸€å°NAS</title><link href="https://fangpsh.github.io/posts/2019/2019-09-22.html" rel="alternate"></link><published>2019-09-22T00:00:00+08:00</published><updated>2019-09-22T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-09-22:/posts/2019/2019-09-22.html</id><summary type="html">&lt;p&gt;&lt;img alt="qnap" src="/assets/images/2023/20230306162325.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤å¹´å‰åœ¨è…¾è®¯çš„æ—¶å€™ï¼Œå†…éƒ¨ç¦åˆ©é¢†å–äº†ä¸€å¹´çš„å¾®äº‘ä¼šå‘˜ï¼Œå°±å°†å¥³å‹æ—§ç”µè„‘çš„ä¸€ç™¾å¤šGçš„èµ„æºå…¨éƒ¨ä¸Šä¼ å¤‡ä»½ï¼Œç„¶åå¤„ç†æ‰äº†æ—§ç”µè„‘ã€‚
è™½ç„¶å½“æ—¶çŸ¥é“ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="qnap" src="/assets/images/2023/20230306162325.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä¸¤å¹´å‰åœ¨è…¾è®¯çš„æ—¶å€™ï¼Œå†…éƒ¨ç¦åˆ©é¢†å–äº†ä¸€å¹´çš„å¾®äº‘ä¼šå‘˜ï¼Œå°±å°†å¥³å‹æ—§ç”µè„‘çš„ä¸€ç™¾å¤šGçš„èµ„æºå…¨éƒ¨ä¸Šä¼ å¤‡ä»½ï¼Œç„¶åå¤„ç†æ‰äº†æ—§ç”µè„‘ã€‚
è™½ç„¶å½“æ—¶çŸ¥é“æ—¥åä¼šç¦»èŒä¼šå‘˜ä¼šè¿‡æœŸï¼Œä¸è¿‡çœ‹äº†äº§å“åè®®è®°å¾—æ˜¯ä¼šå‘˜è¿‡æœŸå­˜å‚¨ç©ºé—´ä¸å›æ”¶ï¼Œåªæ˜¯æ— æ³•å†ä¸Šä¼ ç½¢äº†ï¼Œç±»ä¼¼Dropboxã€‚&lt;/p&gt;
&lt;p&gt;æœˆåˆå´æ”¶åˆ°äº†å¦‚ä¸‹&lt;a href="https://www.weiyun.com/2019-announcement.html"&gt;é€šçŸ¥&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è‡ª2019å¹´10æœˆ24æ—¥é›¶æ—¶èµ·ï¼Œå¾®äº‘å°†ä¸Šçº¿è¶…é¢å­˜å‚¨ç®¡ç†è§„åˆ™ã€‚å·²ç”¨å®¹é‡è¶…å‡ºå¯ç”¨é¢åº¦çš„ç”¨æˆ·ï¼Œéœ€è¦åœ¨180å¤©å†…å‡çº§å­˜å‚¨ç©ºé—´æˆ–å¯¹å®¹é‡è¶…é¢éƒ¨åˆ†è¿›è¡Œæ¸…ç†ã€‚è‹¥è¶…æœŸæœªä½œå¤„ç†ï¼Œå¸å·å°†è¢«å†»ç»“ï¼Œå†»ç»“æœŸé—´å¾®äº‘ä¿ç•™æ¸…ç†è¶…é¢ç©ºé—´çš„æƒåˆ©ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¥½å§ï¼Œæ²¡æ³•â€œç™½å«–â€äº†ï¼Œä¹Ÿé•¿ä¸ªè®°æ€§ï¼Œå›½å†…è¿™äº›äº‘å­˜å‚¨çš„å‚å•†ï¼Œå¤§å¤šæ•°ä¸é è°±ï¼Œè¿˜æ˜¯ä¹°å°NASå§ï¼Œä¹Ÿé•¿è‰å¾ˆä¹…äº†ã€‚&lt;/p&gt;
&lt;h2&gt;è‡ªå·±ç»„è¿˜æ˜¯ä¹°æˆå“ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¹°ä¸‡ç”±æˆ–è€…èœ—ç‰›æ˜Ÿé™…ï¼Œæˆ–è€…è‡ªå·±ä¹°æœºç®±ã€é…ä»¶ç»„è£…ï¼Œåˆ·FreeNAS æˆ–é»‘ç¾¤æ™–ï¼Œå¦‚æœæ˜¯äº”å¹´å‰æˆ‘ä¼°è®¡è¿˜æ˜¯ä¼šè‡ªå·±æŠ˜è…¾ï¼Œç°åœ¨ç›´æ¥è€ƒè™‘ä¹°æˆå“äº†ï¼Œå°‘äº†æŠ˜è…¾çš„çƒ­æƒ…ï¼Œæ•°æ®é‡è¦ï¼Œé€‰ä¸“ä¸šçš„æ–¹æ¡ˆå§ã€‚&lt;/p&gt;
&lt;h2&gt;ç¾¤æ™–è¿˜æ˜¯å¨è”é€šï¼Ÿ&lt;/h2&gt;
&lt;p&gt;&lt;img alt="qnap-web" src="/assets/images/2023/20230306162404.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å…¬å¸åœ¨ç”¨å¨è”é€šï¼Œç™»å½•åå°ä½“éªŒè¿‡ï¼ŒUIæ„Ÿè§‰æ˜¯æœ‰ç‚¹æŒ«ã€‚åœ¨ç¾¤æ™–å®˜ç½‘ä½“éªŒäº†ç¾¤æ™–çš„æ§åˆ¶å°ï¼Œçœ‹èµ·æ¥ç¡®å®é«˜å¤§ä¸Šä¸€äº›ã€‚å¯æ˜¯ç›¸åŒé…ç½®ï¼Œç¾¤æ™–ä»·æ ¼æ˜¯å¨è”é€šçš„ä¸¤å€å·¦å³ï¼Œ
ä¸¤å®¶å……åˆ†ç«äº‰ï¼Œåœ¨å­˜å‚¨çš„åŠŸèƒ½ä¸Šå·®åˆ«ä¸ä¼šå¤ªå¤§ã€‚å¨è”é€šå¸¦æœ‰HDMI è¾“å‡ºï¼Œå¯ä»¥å……å½“HTPC çš„è§’è‰²ï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘éå¸¸éœ€è¦ï¼Œä¸è€ƒè™‘äº†ï¼Œé€‰å¨è”é€šï¼Œä»¥åç¬¬äºŒå°å†ä¹°ç¾¤æ™–ç©ã€‚  &lt;/p&gt;
&lt;p&gt;&lt;img alt="QNAP-HybridDesk" src="/assets/images/2023/20230306162425.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;TS-453Bmini è¿˜æ˜¯ TS-551ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;å¨è”é€šçš„å‹å·ï¼Œå¯¹äºæ™®é€šç©å®¶ï¼ŒTS-453Bmini æ˜¯æ€§ä»·æ¯”æœ€é«˜çš„é€‰æ‹©ï¼Œåœ¨å®˜æ–¹æ——èˆ°åº—ï¼Œè¿™æ¬¾çš„é”€é‡ä¹Ÿç”©å…¶ä»–å‹å·å‡ æ¡è¡—ã€‚
ä¸è¿‡æˆ‘æ„Ÿè§‰TS-453Bmini æœ‰ç‚¹ä¸‘ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨æ‰¾ç›¸è¿‘çš„å‹å·ï¼Œçœ‹åˆ°äº†TS-551ã€‚
å®˜æ–¹å¯ä»¥å¿«æ·&lt;a href="https://www.qnap.com/zh-cn/product/compare?products=ts-453bmini,ts-551&amp;amp;ref=product_overview"&gt;å¯¹æ¯”&lt;/a&gt;ï¼Œæœ€æ˜¾è‘—çš„å·®åˆ«æ˜¯CPUï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;IntelÂ® CeleronÂ® J3455 å››æ ¸å¿ƒ 1.5 GHz å¤„ç†å™¨ (å¯é«˜è¾¾ 2.3 GHz)&lt;/li&gt;
&lt;li&gt;IntelÂ® CeleronÂ® J3355 åŒæ ¸å¿ƒ 2.0 GHz å¤„ç†å™¨ (å¯é«˜è¾¾ 2.5 GHz)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–TS-551çš„å”®ä»·æ¯”TS-453Bmini å¤§æ¦‚ä½400å…ƒã€‚æ¿è½½CPUæ²¡æ³•æ›´æ¢ï¼Œå› ä¸ºæˆ‘æœ‰HTPC çš„åŠŸèƒ½éœ€æ±‚ï¼Œå¹¶ä¸”è¿™å°NAS é¢„è®¡ä½¿ç”¨3å¹´+ï¼Œ551 çš„5ç›˜ä½æœ‰ç‚¹é¸¡è‚‹ï¼Œé€‰æ‹©äº†453Bminiã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TS-453Bmini å‚è€ƒä»·æ ¼ï¼š1999&lt;/li&gt;
&lt;li&gt;TS-551 å‚è€ƒä»·æ ¼ï¼š1599&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é«˜äºè¿™ä¸ªä»·æ ¼ï¼Œéƒ½ä¸ç®—å¥½ä»·ï¼Œæ·˜å®è´­ä¹°JD Eå¡ï¼Œå¤–åŠ Plus ä¼˜æƒ åˆ¸ï¼Œå¯ä»¥åšåˆ°1900ï¼Œå¦‚æœé‡ä¸ŠåŒ11 ä¹‹ç±»æ´»åŠ¨åº”è¯¥èƒ½æ›´ä½ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡è´­ä¹°ä¹‹åä¸€æ®µæ—¶é—´ï¼Œå‡ºäº†æ–°é—»ï¼š&lt;a href="https://news.mydrivers.com/1/645/645646.htm"&gt;Intelä½åŠŸè€—å¥”è…¾/èµ›æ‰¬â€œå˜ç –â€ï¼šç´§æ€¥é€€å¸‚ã€å‡çº§&lt;/a&gt;ï¼ŒQNAPå’Œç¾¤æ™–éƒ½æœ‰äº”å¹´å”®åè´¨ä¿ï¼Œæˆ‘è®¤ä¸ºå¤Ÿç”¨äº†ï¼Œ
çœŸå‡ºäº‹äº†ï¼Œå†æ‰¾å”®åã€‚&lt;/p&gt;
&lt;h2&gt;é…·ç‹¼è¿˜æ˜¯çº¢ç›˜ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;ä¹°å¥½äº†NASï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¹°ç›˜äº†ã€‚æ·˜å®ä¸Šä¹°NAS çš„å•†å®¶æ ‡é…éƒ½æ˜¯å¸Œæ·é…·ç‹¼4Tç›˜ï¼Œé€›äº†ä¸€åœˆï¼Œå‘ç°è¿˜æ˜¯è¿™æ¬¾åˆé€‚ï¼Œè¥¿æ•°çš„NASä¸“ç”¨çº¢ç›˜å£ç¢‘éå¸¸ç³Ÿç³•ï¼Œè¿˜ä¸å¦‚é…·é¹°ã€‚
å•ç›˜4T æ˜¯æ¯”è¾ƒåˆé€‚çš„è§„æ ¼ã€‚&lt;/p&gt;
&lt;h2&gt;å†…å­˜16G è¿˜æ˜¯10Gï¼Ÿ&lt;/h2&gt;
&lt;p&gt;453Bmini å‡ºå‚2G*2ï¼ŒåŒé€šé“ã€‚å®é™…æœ€å¤§æ”¯æŒ8G*2ï¼Œä¸è¿‡æ„Ÿè§‰æ—¥å¸¸10G åº”è¯¥å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥ä¹°äº†ä¸€æ¡8Gï¼Œ2G+8Gï¼Œåº”è¯¥æ˜¯æ¯”è¾ƒé«˜æ€§ä»·æ¯”çš„æ–¹æ¡ˆï¼Œæ¢ä¸‹çš„2Gè¿˜èƒ½å‡ºæ‰ã€‚
å†…å­˜æ¡çš„é€‰æ‹©ä¸Šï¼Œè€ƒè™‘æ€§ä»·æ¯”å¯ä»¥é€‰åé“¨å’Œå…‰å¨ï¼Œæˆ–è€…å¯ä»¥é€‰è‹±ç¿è¾¾ï¼Œåå¾·è¿˜æ˜¯åˆ«ä¹°äº†ï¼Œæœ€åä¸ºäº†ç¨³å®šå’Œç¨³å®šæ€§ï¼ˆå¿ƒå®‰ï¼‰ï¼Œä¹°äº†æ¡é‡‘å£«é¡¿éª‡å®¢ç¥æ¡ï¼Œ289å…ƒã€‚&lt;/p&gt;
&lt;h2&gt;Raid è¿˜æ˜¯RTRRï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æœ¬æ¥æƒ³ä¹°2*4Té…·ç‹¼ï¼ŒåšRaid1ï¼Œç„¶åå†åŠ ä¸€ä¸ªä¾¿å®œçš„4Té…·é¹°åšä»“åº“ç›˜ã€‚åæ¥çœ‹åˆ°QNAP æœ‰RTRRåŠŸèƒ½ï¼Œè€Œä¸”Raid 1 å•ç›˜æŸåä¹‹åçš„é‡å»ºä¹Ÿæœ‰é£é™©ï¼Œè¿™ä¹ˆå¤§å®¹é‡ã€‚
2ä¸ª4Tç›˜ç›´æ¥ç‹¬ç«‹ä½¿ç”¨ï¼Œé€šè¿‡RTRR åŠŸèƒ½å®æ—¶å¤‡ä»½é‡è¦æ–‡ä»¶å¤¹ï¼Œå¯¹äºå®¶åº­ç”¨æˆ·æ¥è¯´ï¼Œæ˜¯æ›´å…·æ€§ä»·æ¯”å’Œå¯é çš„æ–¹æ¡ˆã€‚
åˆå†ä¹°äº†ä¸€å—ä¾¿å®œçš„é—ªè¿ªSSD 240GBï¼Œ230å…ƒï¼Œç”¨æ¥åšç³»ç»Ÿç›˜ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åçš„æ–¹æ¡ˆæ˜¯ï¼Œç›˜1 240GB SSDï¼Œç›˜2 4Té…·ç‹¼ï¼Œç›˜3 4Té…·ç‹¼ï¼Œç›˜4 ç©ºä½™æœºåŠ¨ã€‚ç›˜1 å’Œç›˜2ï¼ŒQtierã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="qnap-disk" src="/assets/images/2023/20230306162511.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;Transmission è¿˜æ˜¯Rtorrentï¼Ÿ&lt;/h2&gt;
&lt;p&gt;æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„éœ€æ±‚ï¼Œå°±æ˜¯æŒ‚PTã€‚ä¹‹å‰çœ‹å¸–å­å‘ç°QTS 4.3 ç§»é™¤äº†Trasnmissionï¼Œè™½ç„¶åœ¨qnapclub.eu å¯ä»¥ä¸‹åˆ°ï¼Œä¸è¿‡ä½¿ç”¨ä½“éªŒä¸ŠçœŸæ˜¯ååˆ†ç³Ÿç³•ã€‚
ç›¸æ¯”rtorrent å¼ºå¤§å¾ˆå¤šï¼Œæ¯•ç«Ÿæ”¶è´¹ã€‚
&lt;img alt="qnap-rtorrent" src="/assets/images/2023/20230306162540.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿˜å¯ä»¥åœ¨Container Station é‡Œå®‰è£…&lt;a href="https://hub.docker.com/r/oldiy/rrshare64"&gt;äººäººå½±è§†å®¢æˆ·ç«¯&lt;/a&gt;ï¼Œéå¸¸èµã€‚
ä¾é Dockerï¼Œæœ‰éå¸¸å¤šçš„ç©æ³•ï¼Œå‚è€ƒ&lt;a href="https://odcn.top/2019/02/13/2509/%E6%95%B4%E7%90%86%E6%B1%87%E6%80%BB%E4%B8%80%E4%B8%8B%E6%9C%80%E8%BF%91%E6%9B%B4%E6%96%B0%E7%9A%84%E4%B8%80%E4%BA%9Bdocker%E9%95%9C%E5%83%8F/"&gt;è¿™ä½ç½‘å‹çš„åˆ†äº«&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;END&lt;/h2&gt;
&lt;p&gt;èŠ±äº†æŒºå¤§çš„åŠŸå¤«ä»å¾®äº‘ä¸Šä¸‹è½½äº†æ›¾ç»â€œå¤‡ä»½â€ä¸Šå»çš„æ–‡ä»¶ï¼Œå¯¼å…¥NASã€‚é…ç½®å¥½æ‰‹æœºå®¢æˆ·ç«¯ï¼Œé…ç½®å¥½Plexï¼Œé…ç½®å¥½PhotoStationã€‚ç›®å‰æ¥è¯´è¿˜æŒºæ»¡æ„ï¼Œä¹ŸæŒºå®‰é™ã€‚
å¶å°”CPU ä¼šåƒç´§ï¼Œçœ‹æ¥æˆ‘çš„ä½¿ç”¨åœºæ™¯ä¸‹ä¹°4æ ¸å¿ƒæ˜¯å¯¹çš„ï¼Œè‡³äºç¡¬ç›˜ä¸èƒ½ä¼‘çœ çš„é—®é¢˜ï¼Œæ— æ‰€è°“äº†ï¼Œå¼€äº†HybridDesk å’Œä¸€å †åŠŸèƒ½ï¼Œæƒ³ä¼‘çœ éƒ½éš¾ã€‚&lt;br&gt;
æœ€è¿‘æ¨äº†4.4 ç³»ç»Ÿï¼Œå†è§‚æœ›ä¸€ä¸‹ï¼Œæ–°ç³»ç»Ÿæœ€å¥½åˆ«ç¬¬ä¸€æ—¶é—´å‡ã€‚&lt;/p&gt;</content><category term="[Life]"></category><category term="nas"></category><category term="qnap"></category></entry><entry><title>å¤ºå›resolv.conf çš„æ§åˆ¶æƒ</title><link href="https://fangpsh.github.io/posts/2019/2019-06-23.html" rel="alternate"></link><published>2019-06-23T00:00:00+08:00</published><updated>2019-06-23T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-06-23:/posts/2019/2019-06-23.html</id><summary type="html">&lt;p&gt;ä¸Šå‘¨åœ¨çº¿ä¸Šä¿®æ”¹äº†ä¸€æ‰¹æœºå™¨çš„hostnameï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hostnamectl set-hostname xxx&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åæ¥æœ‰åŒå­¦åé¦ˆ2å°æœºå™¨çš„/etc/resolv.conf è¢«æ¸…ç©ºäº†ï¼Œresolv.conf çš„å†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Generated by NetworkManager
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®Œäº†ï¼Œç¬¬ä¸€æ„Ÿè§‰æ˜¯è¿™ä¸¤ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸Šå‘¨åœ¨çº¿ä¸Šä¿®æ”¹äº†ä¸€æ‰¹æœºå™¨çš„hostnameï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hostnamectl set-hostname xxx&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åæ¥æœ‰åŒå­¦åé¦ˆ2å°æœºå™¨çš„/etc/resolv.conf è¢«æ¸…ç©ºäº†ï¼Œresolv.conf çš„å†…å®¹ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Generated by NetworkManager
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®Œäº†ï¼Œç¬¬ä¸€æ„Ÿè§‰æ˜¯è¿™ä¸¤ä¸ªäº‹æƒ…ä¸€å®šæœ‰ç›¸å…³ï¼Œæˆ‘å­˜åœ¨çŸ¥è¯†ç›²åŒºï¼Œç®€å•æœç´¢ï¼Œæœç„¶å‘ç°ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;a href="Bug 1344303 - hostnamectl set-hostname over-writes existing resolv.conf entries"&gt;Bug 1344303 - hostnamectl set-hostname over-writes existing resolv.conf entries&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹å‡ºé—®é¢˜çš„è¿™2å°æœºå™¨çš„&lt;code&gt;/var/log/message&lt;/code&gt; ä¹Ÿå­˜åœ¨ä¸Šè¿°è¿æ¥ç±»ä¼¼çš„æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Jun 22 13:48:46 test NetworkManager[605]: &amp;lt;info&amp;gt;  Setting system hostname to &amp;#39;test&amp;#39; (from system configuration)
Jun 22 13:48:46 test dbus[610]: [system] Activating via systemd: service name=&amp;#39;org.freedesktop.nm_dispatcher&amp;#39; unit=&amp;#39;dbus-org.freedesktop.nm-dispatcher.service&amp;#39;
Jun 22 13:48:46 test dbus-daemon[610]: dbus[610]: [system] Activating via systemd: service name=&amp;#39;org.freedesktop.nm_dispatcher&amp;#39; unit=&amp;#39;dbus-org.freedesktop.nm-dispatcher.service&amp;#39;
Jun 22 13:48:46 test systemd[1]: Starting Network Manager Script Dispatcher Service...
Jun 22 13:48:46 test dbus[610]: [system] Successfully activated service &amp;#39;org.freedesktop.nm_dispatcher&amp;#39;
Jun 22 13:48:46 test dbus-daemon[610]: dbus[610]: [system] Successfully activated service &amp;#39;org.freedesktop.nm_dispatcher&amp;#39;
Jun 22 13:48:46 test systemd[1]: Started Network Manager Script Dispatcher Service.
Jun 22 13:48:46 test nm-dispatcher[3006]: Dispatching action &amp;#39;hostname&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Networkmanager æœåŠ¡ä¹Ÿç¡®å®åœ¨è¿è¡Œä¹‹ä¸­ï¼Œå­˜åœ¨ç›¸å…³æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;settings: hostname changed from &amp;quot;&amp;quot; to &amp;quot;&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸è¿‡å¾ˆå¥‡æ€ªï¼Œå½“æ—¶æ€»å…±ä¿®æ”¹äº†æœ‰å‡ åå°æœåŠ¡å™¨ï¼ŒNetworkManager åœ¨è¿è¡Œçš„ä¹Ÿæœ‰å‡ åå°ï¼Œå…¶ä»–çš„å¥½åƒéƒ½æ²¡é—®é¢˜ï¼Œåæ¥ä¸ºäº†å¤ç°ï¼Œåœ¨è¿™2å°æœºå™¨ä¸Šå†æ¬¡æ‰‹åŠ¨ä¿®æ”¹hostnameï¼Œå¤ç°ä¸äº†ã€‚ã€‚orzï¼ŒçŒœæµ‹å¯èƒ½å’Œresolv.conf åŸæ¥çš„å†…å®¹æœ‰å…³ï¼Œç»†èŠ‚å¯èƒ½éœ€è¦è¯»æºç æ‰çŸ¥é“ã€‚&lt;/p&gt;
&lt;h2&gt;Bug 1344303&lt;/h2&gt;
&lt;p&gt;è¯è¯´å›æ¥ï¼Œé™¤äº†æ„Ÿè§‰è‡ªå·±å­˜åœ¨çŸ¥è¯†ç›²åŒºï¼Œâ€œæƒ³å½“ç„¶â€ä¹‹å¤–ï¼Œè¿™ä¸ªBug å®åœ¨æ˜¯æœ‰ç‚¹è«åå…¶å¦™ï¼Œå°±å¦‚åŒè¿™ä¸ªBug ä¸­çš„ç½‘å‹è¯´çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;My point is still, that hostnamectl does not look like you are editing resolv.conf. but I'm with you that there is a relation of the domain name and the FQDN. &lt;/p&gt;
&lt;p&gt;I'll update NetworkManager.conf with main/dns=none - no problem. I just wished I knew earlier howto disable the management of resolv.conf&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç„¶è€Œä½œè€…çš„æ€åº¦ä¹Ÿæ˜¯éå¸¸åšæŒï¼Œè¯»èµ·æ¥æœ‰ç‚¹çˆ±ç”¨ç”¨ï¼Œä¸ç”¨æ»šçš„å‘³é“ã€‚åªèƒ½è¯´æˆ‘ä½œä¸ºè¿ç»´ï¼Œå¯¹äº¤ä»˜å‡ºæ¥çš„æœºå™¨ï¼Œåˆå§‹åŒ–ä¸å¤Ÿç»Ÿä¸€ï¼Œæ‰ä¼šé‡åˆ°è¿™ç§å‘ã€‚okï¼Œåœ¨åˆå§‹åŒ–è„šæœ¬ä¸­å¢åŠ ï¼ˆé’ˆå¯¹CentOS 7.xï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;- name: Disable NetworkManager
  systemd:
    name: NetworkManager
    state: stopped
    enabled: false
  ignore_errors: true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç½‘å‹æŒ‡å‡º:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ RHEL8 ä¸­ï¼Œå·²ç»å–æ¶ˆäº† network.serviceï¼Œæ‰€æœ‰çš„ç½‘ç»œé…ç½®éƒ½å½’å±äº NetworkManagerï¼Œè¿™é‡Œå¯èƒ½ä¸æ˜¯å¾ˆé€‚ç”¨ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…·ä½“å¯å‚è€ƒï¼š&lt;a href="https://zhuanlan.zhihu.com/p/56892392"&gt;åŸºäºRHEL8/CentOS8çš„ç½‘ç»œIPé…ç½®è¯¦è§£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¼¼ä¹Linux çš„ä¸–ç•Œå°±æ˜¯æœ‰è¿™ä¹ˆå¤šè½®å­ï¼Œæ›¾ç»æƒ³ï¼ŒSystemd èƒ½ä¸€ç»Ÿå¤©ä¸‹ï¼Œå¸¦æ¥çš„å´æ˜¯æ›´å¤šè½®å­ï¼Œ23333ã€‚&lt;/p&gt;
&lt;h2&gt;å¤ºå›æ§åˆ¶æƒ&lt;/h2&gt;
&lt;p&gt;è¯»åˆ°ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href="https://www.ctrl.blog/entry/resolvconf-tutorial.html"&gt;How to take back control of /etc/resolv.conf on Linux&lt;/a&gt;ï¼Œå¦‚ä½•å¤ºå›Linux ä¸Š/etc/resolv.conf çš„æ§åˆ¶æƒï¼
åŸæ¥è¿˜æœ‰è¿™ä¹ˆå¤šç©æ„ï¼Œè¯¦æƒ…å‚è€ƒæ–‡ç« é“¾æ¥ï¼Œä½œè€…ä¸€ç›´åœ¨æ›´æ–°ï¼Œå¾ˆç”¨å¿ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NetworkManager&lt;/li&gt;
&lt;li&gt;/etc/sysconfig/network/config: NETCONFIG_DNS_POLICY&lt;/li&gt;
&lt;li&gt;resolvconf, rdnssd&lt;/li&gt;
&lt;li&gt;systemd-resolved&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äº†ï¼Œ&lt;a href="https://www.cyberciti.biz/faq/dhclient-etcresolvconf-hooks/"&gt;DHCP ä¹Ÿå¯èƒ½ä¼šç¢°ä½ çš„resolv.conf å“¦&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å­¦æ— æ­¢å¢ƒï¼Œå‘å¤–æœ‰å‘ã€‚&lt;/p&gt;</content><category term="2019"></category><category term="linux"></category><category term="resolv.conf"></category></entry><entry><title>è§£å†³Mac OS ä¸‹Alt-fã€Alt-b å¤±æ•ˆçš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2019/2019-04-14.html" rel="alternate"></link><published>2019-04-14T00:00:00+08:00</published><updated>2019-04-14T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-04-14:/posts/2019/2019-04-14.html</id><summary type="html">&lt;p&gt;æˆ‘ç®—æ˜¯åŠä¸ªEmacs ç”¨æˆ·ï¼ŒMac OS å¸å¼•æˆ‘çš„ä¸€ä¸ªåœ°æ–¹æ˜¯å®ƒå‡ ä¹æ‰€æœ‰è¾“å…¥æ¡†éƒ½èƒ½ä½¿ç”¨åŸºæœ¬çš„Emacs è¡Œæ“ä½œå¿«æ·é”®ï¼Œå› ä¸ºGNU Redlineã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘çœ‹åˆ°&lt;a href="https://twitter.com/linuxtoy/status/957225197928525824"&gt;Linuxtoy â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;æˆ‘ç®—æ˜¯åŠä¸ªEmacs ç”¨æˆ·ï¼ŒMac OS å¸å¼•æˆ‘çš„ä¸€ä¸ªåœ°æ–¹æ˜¯å®ƒå‡ ä¹æ‰€æœ‰è¾“å…¥æ¡†éƒ½èƒ½ä½¿ç”¨åŸºæœ¬çš„Emacs è¡Œæ“ä½œå¿«æ·é”®ï¼Œå› ä¸ºGNU Redlineã€‚&lt;/p&gt;
&lt;p&gt;æœ€è¿‘çœ‹åˆ°&lt;a href="https://twitter.com/linuxtoy/status/957225197928525824"&gt;Linuxtoy æ¨æ–‡&lt;/a&gt;é‡Œé¢çš„è¿™å¼ å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="moving_cli" src="https://clementc.github.io/figures/moving_cli.png"&gt;&lt;/p&gt;
&lt;p&gt;æƒ³èµ·è‡ªä»å½¢æˆè‚Œè‚‰è®°å¿†ä¹‹åï¼Œåœ¨æµè§ˆå™¨åœ°å€æ ç­‰åœ°æ–¹å¸¸å¸¸æ‰“&lt;code&gt;Alt-f&lt;/code&gt;,&lt;code&gt;Alt-b&lt;/code&gt; è¿™å‡ ä¸ªå¿«æ·é”®ï¼Œä¼šå‘ç°æ‰“å‡ºæ¥çš„æ˜¯å¥‡æ€ªçš„å­—ç¬¦ï¼š&lt;code&gt;Æ’&lt;/code&gt;,&lt;code&gt;âˆ«&lt;/code&gt;ï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="ffffff" src="/assets/images/2023/20230301162114.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸ºæ˜¯ç³»ç»Ÿé™åˆ¶ï¼Œå¿å—äº†å¾ˆä¹…ã€‚ä»Šå¤©æœç´¢ä¸‹ï¼Œç¿»åˆ°ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href="https://blog.sensible.io/2012/10/19/mac-os-x-emacs-style-keybindings-everywhere.html"&gt;Mac OS X: Emacs-like keybindings everywhere&lt;/a&gt;ï¼Œ æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š&lt;code&gt;~/Library/KeyBindings/DefaultKeyBinding.dict&lt;/code&gt; ï¼ˆå¦‚æœä¸å­˜åœ¨è¿™ä¸ª&lt;code&gt;KeyBindings&lt;/code&gt; ç›®å½•ï¼Œå°±æ–°å»ºä¸€ä¸ªï¼‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;{
    &amp;quot;~d&amp;quot; = &amp;quot;deleteWordForward:&amp;quot;;
    &amp;quot;~f&amp;quot; = &amp;quot;moveWordForward:&amp;quot;;
    &amp;quot;~b&amp;quot; = &amp;quot;moveWordBackward:&amp;quot;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡å¯ä¸‹ç›¸å…³App ï¼Œä¾‹å¦‚Chrome æµè§ˆå™¨ï¼Œå†è¯•ä¸€è¯•ï¼Œå‘ç°OKäº†ï¼Œå±…ç„¶è¿™ä¹ˆç®€å•ï¼&lt;/p&gt;
&lt;p&gt;éšååœ¨GitHub å‘ç°ä¸€ä¸ªå¾ˆå¼ºå¤§çš„é¡¹ç›®&lt;a href="https://github.com/ttscoff/KeyBindings"&gt;ttscoff/KeyBindings&lt;/a&gt;ï¼Œæœ‰ç©ºå†æŠ˜è…¾ï¼Œå…¶ä»–é”®ç”¨çš„ä¸å¤šã€‚&lt;/p&gt;</content><category term="2019"></category><category term="æ•ˆç‡"></category><category term="MacOS"></category></entry><entry><title>ç³Ÿç³•çš„æ–‘é©¬æ—…æ¸¸</title><link href="https://fangpsh.github.io/posts/2019/horrible-bmtrip.html" rel="alternate"></link><published>2019-03-10T00:00:00+08:00</published><updated>2019-03-10T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-03-10:/posts/2019/horrible-bmtrip.html</id><summary type="html">&lt;p&gt;2018 å¹´çš„å…ƒæ—¦å’Œå¥³å‹åˆå»äº†ä¸€æ¬¡æ³°å›½ï¼Œè¿™æ¬¡ç”±äºæˆ‘å·¥ä½œæ¯”è¾ƒå¿™ï¼Œæ²¡ç²¾åŠ›åšæ”»ç•¥ï¼Œé€›äº†ä¸€åœˆæºç¨‹ã€é£çŒªï¼Œé€‰äº†&lt;a href="https://bmtrip.com/"&gt;æ–‘é©¬æ—…æ¸¸&lt;/a&gt;ï¼ˆä¸Šæµ·æ­Œæ™¨ä¿¡ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;2018 å¹´çš„å…ƒæ—¦å’Œå¥³å‹åˆå»äº†ä¸€æ¬¡æ³°å›½ï¼Œè¿™æ¬¡ç”±äºæˆ‘å·¥ä½œæ¯”è¾ƒå¿™ï¼Œæ²¡ç²¾åŠ›åšæ”»ç•¥ï¼Œé€›äº†ä¸€åœˆæºç¨‹ã€é£çŒªï¼Œé€‰äº†&lt;a href="https://bmtrip.com/"&gt;æ–‘é©¬æ—…æ¸¸&lt;/a&gt;ï¼ˆä¸Šæµ·æ­Œæ™¨ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸ï¼‰çš„äº§å“ã€‚&lt;/p&gt;
&lt;p&gt;æºç¨‹ä¸Šä¸€ç‰‡äº”æ˜Ÿå¥½è¯„ï¼Œå®˜ç½‘å’Œäº§å“ä»‹ç»ä¸Šâ€œé«˜å“è´¨â€ã€â€œè½»å¥¢å“è´¨â€ã€â€œç²¾å“â€ã€â€œç®¡å®¶æœåŠ¡â€ç­‰å­—çœ¼ï¼Œä¿ƒä½¿è®©æˆ‘å¿«é€Ÿä¸‹å•ï¼Œç»§ç»­åŸ‹å¤´å·¥ä½œï¼Œåç­‰å‡ºå‘ï¼Œç›¸ä¿¡æ–‘é©¬æ—…æ¸¸ä¼šå¯¹æœ¬æ¬¡æœåŠ¡æä¾›ä¸€ä¸ªé«˜å“è´¨ï¼Œå’Œæˆ‘ä»¬ä»˜å‡ºä»·æ ¼ç›¸ç¬¦çš„æœåŠ¡ï¼Œæ²¡æƒ³åˆ°å…¥äº†ä¸ªå¤§å‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmstrip-1" src="/assets/images/2023/20230307111242.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;ä¸è¿æ³•çš„æ–‘é©¬æ—…æ¸¸&lt;/h2&gt;
&lt;p&gt;ç”±äºæ³°å›½å…ç­¾ï¼Œå¯¼è‡´è½åœ°ç­¾äººæ•°æš´å¢ï¼Œæ’é˜Ÿç­‰äº†å¿«2ä¸ªå°æ—¶ï¼Œæ‰€è°“çš„ç®¡å®¶æœåŠ¡ï¼Œå…¶å®å°±æ˜¯æŒ‰ç…§äº‹å…ˆå‡†å¤‡å¥½çš„ææ–™ï¼Œå®æ—¶åœ¨ç¾¤é‡Œæ’­æŠ¥è€Œå·²ï¼Œå¾®ä¿¡å®¢æœäººå‘˜ï¼Œè¯´çš„éš¾å¬ä¸€äº›ï¼Œå°±æ˜¯ä¸ªå»‰ä»·æœºå™¨äººï¼Œå¹¶ä¸ä¼šä»å…·ä½“è¡Œç¨‹çš„è§’åº¦ï¼Œä¸ºæ¸¸å®¢è€ƒè™‘ä¸€äº›ç»†èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;ç»ˆäºæ’å®Œé˜Ÿï¼Œå‡ºå…³äº†ï¼Œæ–‘é©¬æ—…æ¸¸é‡‡è´­çš„æ¥æœºæœåŠ¡ï¼Œè®©æˆ‘ä»¬åœ¨è¯­è¨€ä¸é€šçš„æƒ…å†µï¼Œåœ¨æœºåœºç­‰äº†åŠå°æ—¶ï¼Œæ¥å›å¾˜å¾Šï¼Œæ‰¾ä¸åˆ°æ¥æœºäººã€‚
å¥½ä¸å®¹æ˜“åˆ°è¾¾ å…¥ä½çš„é…’åº—ï¼šæ›¼è°·è´ç´ å¤é€¸12ç²¾å“é…’åº—(12th Avenue Hotel Bangkok)ï¼Œè¯¥é…’åº—åœ¨å··å­æ·±å¤„ï¼Œå··å­å››å¤„ä¸€å †åƒåœ¾ï¼Œå‡ºè¡Œéå¸¸ä¸æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;12æœˆ31æ—¥ï¼Œå¤œé—´11ç‚¹ï¼Œæˆ¿é—´æ­£å¯¹æ³³æ± ï¼Œæ³³æ± åœ¨æ”¾æ¿€çƒˆçš„éŸ³ä¹ï¼Œè”ç³»äº§å“ä¸­æåˆ°çš„â€œ24å°æ—¶ç®¡å®¶â€ï¼Œååº”æƒ…å†µï¼Œæ–‘é©¬ä¾§æœåŠ¡äººå‘˜è¡¨ç¤ºæ— æ³•è§£å†³ï¼Œä¸¥é‡å½±å“ä¼‘æ¯ã€‚&lt;/p&gt;
&lt;p&gt;1æœˆ1æ—¥ï¼Œå‰å¾€ç¬¬äºŒä¸ªé…’åº—ï¼ŒèŠ­å ¤é›…è«æœæ–¯æµ·æ»¨åº¦å‡æ‘(Pattaya Modus Beachfront Resort) ï¼Œæ‰å‘ç°é…’åº—å¤„äºè’é‡ä¹‹ä¸­ï¼Œæ­¥è¡Œ10åˆ†é’Ÿä¹‹å†…éƒ½æ˜¯ä¸€ç‰‡è’åœ°ï¼Œåƒåœ¾æˆå †ï¼Œé‡ç‹—å‡ºæ²¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmstrip-03" src="/assets/images/2023/20230307120254.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä¹‹å‰æ‰¿è¯ºçš„é…’åº—å…è´¹ç­è½¦ï¼Œæ–‘é©¬æ²¡æœ‰äº‹å…ˆæä¾›ç›¸å…³è¯¦æƒ…ã€‚ç´¢è¦ç­è½¦å•ä¹‹åï¼Œåç»­ä¹˜åæ‰€è°“çš„é…’åº—å…è´¹ç­è½¦ï¼Œé…’åº—äººå‘˜ä¾ç„¶å¯¹æˆ‘ä»¬è¿›è¡Œäº†æ”¶è´¹ï¼Œå¹³å‡éƒ½åœ¨150æ³°é“¢+ï¼Œå’Œæ–‘é©¬å®¢æœäººå‘˜è”ç³»ï¼Œè¯·æ±‚å¸®å¿™å’Œé…’åº—æ²Ÿé€šï¼Œæ— æœã€‚
&lt;strong&gt;æ–‘é©¬æ—…æ¸¸å¹¶æœªå¯¹è¯¥é…’åº—è¿›è¡Œç»†è‡´çš„è€ƒå¯Ÿ&lt;/strong&gt;ï¼Œé…’åº—çš„æ—©é¤æ¥¼å±‚éƒ½èƒ½å¼„é”™ï¼Œå’Œå®£ä¼ çš„é«˜å“è´¨æœåŠ¡å·®è·å¤ªå¤§ã€‚åç»­2å¤©ï¼Œæ¯æ¬¡åˆé¤ï¼Œæ™šé¤ï¼Œç”±äºé…’åº—é™„è¿‘ä¸€ç‰‡è’åœ°ï¼Œå¤–åŠ é‡ç‹—æˆç¾¤ï¼Œä¸å®‰å…¨ï¼Œéƒ½éœ€è¦æ‰“è½¦å¤–å‡ºå°±é¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmtrip-4" src="/assets/images/2023/20230307140854.jpg"&gt;&lt;/p&gt;
&lt;p&gt;1æœˆ3æ—¥ å›ç¨‹ï¼Œæ–‘é©¬æ—…æ¸¸å‘ŠçŸ¥å¸ˆå‚…ä¸‹åˆ3ç‚¹05 é€æœºï¼Œæˆ‘ä»¬2ç‚¹30åˆ†åœ¨å¤§å ‚ç­‰å€™ï¼Œå‘ŠçŸ¥æ–‘é©¬æˆ‘ä»¬å·²ç»åœ¨ç­‰å€™ã€‚ä¸€ç›´åˆ°3ç‚¹05åˆ†ï¼Œæ²¡äººä¸¾ç‰Œã€‚
è¯¢é—®æ–‘é©¬ã€‚æ–‘é©¬å’Œæœ¬åœ°é€æœºæœåŠ¡å•†æ²Ÿé€šä¹‹åï¼Œæ‰çŸ¥é“å¸ˆå‚…å¥½ä¹…ä¹‹å‰å·²ç»åˆ°äº†ï¼Œä½“éªŒç³Ÿç³•ã€‚&lt;/p&gt;
&lt;p&gt;ç»ˆäºå‘ç°æ‰€è°“çš„é«˜å“è´¨æ—…æ¸¸ï¼Œåªæ˜¯æ‹¼å‡‘å„ç±»äº§å“ï¼Œæ¥é€æœºã€æœºç¥¨é…’åº—ã€æœ¬åœ°å›¢ç­‰ç­‰ï¼Œä»–ä»¬çš„äº§å“ç»ç†ä¹Ÿä¸ä¼šæ•´ä¸ªè¡Œç¨‹çœŸçš„ä»äº§å“è§’åº¦ä¸Šè¿›è¡Œè€ƒé‡ã€‚&lt;br&gt;
åœ¨æˆ‘æå‡ºå’Œä»–ä»¬çš„äº§å“è´Ÿè´£äººæ²Ÿé€šçš„æ—¶å€™ï¼Œæ–‘é©¬çš„ç®¡å®¶äººå‘˜åªæ˜¯æƒ³å¤§äº‹åŒ–å°ï¼Œä¸€ç›´å¼ºè°ƒè‡ªå·±å®‰æ’çš„è¡Œç¨‹æ˜¯å‰å°æŠ«éœ²çš„è¡Œç¨‹å•ï¼Œ&lt;strong&gt;å¹¶ä¸è¿æ³•&lt;/strong&gt;ã€‚ã€‚ã€‚ã€‚ä¹Ÿæ˜¯éå¸¸æ— å¥ˆæ–‘é©¬æ—…æ¸¸çš„ç›®æ ‡å°±æ˜¯ä¸è¿æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="http://news.ifeng.com/a/20170809/51594943_0.shtml"&gt;ã€Šæ–‘é©¬æ—…æ¸¸ï¼šå®ƒä»¬â€œæ­»ç£•â€äº§å“å’ŒæœåŠ¡ï¼Œæ‰“é€ å‡ºäº†ä¸­å›½æœ€â€œè´´å¿ƒâ€ã€‹&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œåœ¨ä¸­å›½ä¼—å¤šæ—…æ¸¸å“ç‰Œä¸­ï¼Œæ–‘é©¬æ—…æ¸¸åº”è¯¥æ˜¯æœ€â€œç”¨å¿ƒâ€å®ƒçš„æ—…è¡Œçº¿è·¯å…¨ç”±äº§å“ç»ç†ç²¾å¿ƒè®¾è®¡è€Œæ¥ï¼ŒæœåŠ¡ç²¾ç»†åˆ°äº†ä½ æ‰€èƒ½æƒ³è±¡å¾—åˆ°çš„ä»»æ„ç»†ææœ«èŠ‚ã€‚äº¦æˆ–ï¼Œä½ ä»Šå¤©æå‡ºäº†å»ºè®®ï¼Œæ˜å¤©ï¼Œæ–°çš„ä¸“å±äºä½ çš„æ—…è¡Œçº¿è·¯å°±å‡ºç°äº†ï¼Œååº”é€Ÿåº¦å¿«çš„æƒŠäººâ€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å†™è¿™æ–‡ç« çš„äººçœŸæ˜¯å¯¹ä¸èµ·ä»–çš„è‰¯å¿ƒï¼Œä¸œå—äºšçº¿è¿˜æ˜¯ä»–ä»¬ä¸»åŠ›çš„äº§å“ï¼Œéƒ½ææˆè¿™æ ·ï¼Œå…¶ä»–çš„çº¿è·¯å¯æƒ³è€ŒçŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;å¹¿å‘Šå¾ˆç¾å¥½ï¼Œä½“éªŒå¾ˆæ®‹é…·ã€‚&lt;/p&gt;
&lt;h2&gt;æŠ•è¯‰æŠ•è¯‰&lt;/h2&gt;
&lt;p&gt;ä»ç¬¬ä¸‰å¤©å¼€å§‹ï¼Œå°±å¼€å§‹æƒ³ç€å›å®¶å¥½äº†ï¼Œæ–‘é©¬æ—…æ¸¸æ¯æ‰äº†æˆ‘å’Œå¥³æœ‹å‹çš„å¹´åº¦æ—…æ¸¸ï¼Œå›å®¶å†æŠ•è¯‰ã€‚å›å›½ä¹‹åï¼Œæå‡ºç»æµèµ”å¿ï¼Œå±å·²ç»è¸©äº†ï¼Œå‡æœŸä¹Ÿæ¯äº†ï¼Œæ–‘é©¬æ—…æ¸¸çš„è´Ÿè´£äººè¯´æœ€å¤šèµ”500ï¼Œç²¾ç¥æŸå¤±ã€‚ã€‚ã€‚å¹¶ä¸”ç¤ºæ„æˆ‘ä»¬æ‹¿äº†èµ”å¿ä¹‹åï¼Œé—­å˜´ã€‚æˆ‘ä¸€ä¸‡å¤šéƒ½èŠ±äº†ï¼Œä¸å·®ä½ è¿™å‡ ç™¾å—ï¼Œæ‹’ç»ã€‚&lt;/p&gt;
&lt;p&gt;å¤§è‡´å°±æ˜¯&lt;a href="https://zhidao.baidu.com/question/1370162280692029979.html"&gt;è¿™ä½ç½‘å‹&lt;/a&gt;çš„æ„Ÿè§‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmtrip-5" src="/assets/images/2023/20230307141001.jpg"&gt;&lt;/p&gt;
&lt;p&gt;éšåå‘æºç¨‹æŠ•è¯‰ï¼Œæºç¨‹å¤„ç†çš„å€’æŒºå¿«ï¼Œè¡¨ç¤ºä»–ä»¬å’Œæ–‘é©¬åªæ˜¯åˆä½œå•†çš„å…³ç³»ï¼Œä¸æ˜¯ä¸Šä¸‹çº§ï¼Œæ²¡æœ‰æƒé™ã€‚ã€‚ã€‚è¯´ç»™æˆ‘ä»¬400 çš„èµ”å¿ï¼Œä½œä¸ºç²¾ç¥æŸå¤±ã€‚&lt;/p&gt;
&lt;p&gt;å†å‘æ–‘é©¬æ—…æ¸¸æ‰€åœ¨çš„&lt;a href="http://lyw.sh.gov.cn/lyj_website/HTML/DefaultSite/lyj_zmhd_lyts/List/index.htm?mail=lyj_zmhd_lyts"&gt;ä¸Šæµ·å¸‚æ—…æ¸¸å±€æŠ•è¯‰&lt;/a&gt;ï¼Œè¿™æ¬¡å‘ç°æ–‘é©¬æ—…æ¸¸è¿‡å»æ¯ä¸ªæœˆå‡ ä¹ä¹Ÿéƒ½ä¼šè¢«æŠ•è¯‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmtrip-2" src="/assets/images/2023/20230307141028.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ä¸Šæµ·æ—…æ¸¸å±€è¡¨ç¤ºæˆ‘ä»¬æ˜¯å’Œæºç¨‹ç­¾çš„åˆåŒï¼ŒæŠ•è¯‰ä¸»ä½“ä¸å¯¹ã€‚å›å®¶ä¹‹åå¹´å‰å¾ˆå¿™ï¼Œå°±å½“å€’éœ‰äº†ï¼Œä»Šå¤©æ•´ç†èµ„æ–™ï¼Œçœ‹åˆ°è¡Œç¨‹å•ç­‰æ–‡ä»¶ï¼Œæ‰åˆæ°”ä¸Šå¿ƒå¤´ï¼Œååˆ†ä¸çˆ½ã€‚&lt;/p&gt;
&lt;p&gt;36Kr ä¸Šæœ‰ä¸€ç¯‡ä»–ä»¬çš„&lt;a href="https://36kr.com/p/5106337.html"&gt;å…¬å…³ç¨¿&lt;/a&gt;ï¼Œ17å¹´è·å¾—äº†Pre-Aè½®èèµ„ï¼Œçœ‹æ¥ä»–ä»¬çš„å¹¿å‘Šæ–‡æ¡ˆï¼Œè®²æ•…äº‹çš„èƒ½åŠ›è¿˜éª—åˆ°äº†ä¸€äº›å‚»å­ã€‚æ‰€è°“çš„å¥½è¯„ã€æ‰€è°“çš„æ•°æ®ï¼Œéƒ½èƒ½å¤Ÿé€ å‡ï¼Œéƒ½èƒ½åˆ·ï¼Œä½†æ˜¯çº¿ä¸‹çš„ä½“éªŒæ˜¯æ— æ³•é€ å‡çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ€»çš„æ¥è¯´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜ä»·æ ¼çš„ç³Ÿå¿ƒä¹‹æ—…&lt;/li&gt;
&lt;li&gt;ä½è´¨é‡çš„æœºå™¨äººå®¢æœ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸å¦‚è‡ªå·±åšæ”»ç•¥ï¼Œä¸€åˆ†é’±ä¸€åˆ†è´§ï¼Œäº«å—æ—…æ¸¸ã€‚&lt;br&gt;
æƒ³çœå¿ƒï¼Œè¿˜æ˜¯æŠ¥ä¸ªå¤§æ—…è¡Œç¤¾çš„å›¢å§ï¼Œè¿œç¦»è¿™ç§â€œçš®åŒ…â€å…¬å¸ã€‚&lt;/p&gt;
&lt;h2&gt;èŠ±çµ®&lt;/h2&gt;
&lt;p&gt;çŸ¥ä¹&lt;a href="https://www.zhihu.com/question/28105489/answer/173499903"&gt;è½¯å¹¿&lt;/a&gt;ï¼Œ&lt;a href="https://www.zhihu.com/people/yitiao-ban-ma-7"&gt;è¿™äºº&lt;/a&gt; çœ‹èµ·æ¥å¾ˆæ˜æ˜¾æ˜¯å‘˜å·¥ï¼Œä¹ŸæŒºä¸å®¹æ˜“çš„ï¼Œå†™è¿™ä¹ˆé•¿çš„å¸–å­ï¼Œå°±ä¸ºäº†è¿™å‡ å¥è¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmtrip-6" src="/assets/images/2023/20230307141348.jpg"&gt;&lt;/p&gt;
&lt;p&gt;åœ¨çŸ¥ä¹æœæ–‘é©¬ï¼Œå‘ç°ä¸€å †éª‚å…¬å¸çš„&lt;a href="https://www.zhihu.com/question/61230719"&gt;å¸–&lt;/a&gt;ï¼Œçœ‹èµ·æ¥ä¹ŒçƒŸç˜´æ°”ï¼Œå‹æ¦¨å‘˜å·¥ã€‚&lt;/p&gt;
&lt;p&gt;æƒ³èµ·å’Œæˆ‘å¯¹æ¥çš„å®¢æœå¦¹å­ï¼ŒæŒºä¸å®¹æ˜“çš„ï¼Œå¥¹èƒ½åšåˆ°çš„ï¼Œéƒ½å¸®æˆ‘äº†ï¼Œæ–‘é©¬æ—…æ¸¸æ‹¿å¥¹å½“å»‰ä»·æœºå™¨äººä½¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmtrip-9" src="/assets/images/2023/20230307141613.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å›æ¥å†ä»”ç»†çœ‹äº†ä¸€äº›æºç¨‹è¯„ä»·ï¼Œæœ‰äº›å¥½è¯„ä¼¼ä¹æ˜¯æ—…æ¸¸ç»“æŸä¹‹åï¼Œå®¢æœå¦¹å­â€œå‚¬â€ï¼Œæˆ–è€…è¯´æ˜¯â€œæ±‚â€å‡ºæ¥çš„ï¼Œç±»ä¼¼&lt;a href="https://www.dianping.com/review/355995485"&gt;è¿™ä½ç½‘å‹è¯´çš„æƒ…å†µ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmtrip-8" src="/assets/images/2023/20230307141542.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘å†™äº†ä¸€ä¸ªå·®è¯„ä¹‹åï¼Œæ–‘é©¬æ—…æ¸¸ç›´æ¥ä¸‹çº¿äº†ï¼Œ&lt;a href="http://vacations.ctrip.com/tour/detail/p19877402s30.html"&gt;ä¸‹çº¿çš„&lt;/a&gt;ï¼Œ&lt;a href="http://vacations.ctrip.com/tour/detail/p20446619s2.html"&gt;æ›¿æ¢ä¸Šçº¿çš„&lt;/a&gt;ï¼Œå†…å®¹è¡Œç¨‹ä¸€æ¨¡ä¸€æ ·ï¼ŒåŸæ¥å°±æ˜¯è¿™æ ·æ©ç›–çš„ã€‚ã€‚æˆ‘ä¸‹å›è¿˜æ˜¯è®¤çœŸçœ‹å·®è¯„å§ã€‚&lt;/p&gt;</content><category term="2019"></category><category term="trip"></category></entry><entry><title>ip_local_port_range å°é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2019/2019-03-01.html" rel="alternate"></link><published>2019-03-01T00:00:00+08:00</published><updated>2019-03-01T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-03-01:/posts/2019/2019-03-01.html</id><summary type="html">&lt;p&gt;å‘ç°ç³»ç»Ÿæ‰“å°äº†ä¸€æ¡æ—¥å¿—ï¼Œç±»ä¼¼&lt;a href="https://access.redhat.com/solutions/2887631"&gt;redhat solution:2887631&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Jan 23 14:37:22 localhost kernel: ip_local_port_range: prefer different parity for start/end values.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ„æ€æ˜¯å»ºè®®å°†&lt;code&gt;/proc/sys/net/ipv4/ip_local_port_range&lt;/code&gt; çš„ä¸¤ä¸ªæ•°è®¾ç½®ä¸€ä¸ª â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å‘ç°ç³»ç»Ÿæ‰“å°äº†ä¸€æ¡æ—¥å¿—ï¼Œç±»ä¼¼&lt;a href="https://access.redhat.com/solutions/2887631"&gt;redhat solution:2887631&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Jan 23 14:37:22 localhost kernel: ip_local_port_range: prefer different parity for start/end values.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ„æ€æ˜¯å»ºè®®å°†&lt;code&gt;/proc/sys/net/ipv4/ip_local_port_range&lt;/code&gt; çš„ä¸¤ä¸ªæ•°è®¾ç½®ä¸€ä¸ªå¥‡æ•°ï¼Œä¸€ä¸ªå¶æ•°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ip_local_port_range - 2 INTEGERS  
        Defines the local port range that is used by TCP and UDP to  
        choose the local port. The first number is the first, the
        second the last local port number.
        If possible, it is better these numbers have different parity.
        (one even and one odd values)
        The default values are 32768 and 60999 respectively.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å»ºè®®æ”¹ï¼Œé‚£å°±æ”¹ä¸€ä¸‹å’¯ã€‚å¯æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿèƒ½è®©ç³»ç»Ÿåˆ†é…ç«¯å£çš„æ—¶å€™æ›´é«˜æ•ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;æœç´¢ä¸€ä¸‹ï¼Œæ‰¾åˆ°2ä¸ªç›¸å…³çš„Patchï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.spinics.net/lists/netdev/msg330439.html"&gt;[PATCH net-next] tcp/dccp: try to not exhaust ip_local_port_range in connect()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.spinics.net/lists/netdev/msg330895.html"&gt;[PATCH net-next] tcp/dccp: warn user for preferred ip_local_port_range&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰¾ä¸‹ç¬¬ä¸€ä¸ªPatch é‡Œé¢çš„ &lt;code&gt;__inet_hash_connect&lt;/code&gt; å‡½æ•°çš„å®Œæ•´å†…å®¹çœ‹ä¸‹ï¼š&lt;a href="https://github.com/torvalds/linux/blob/07f4c90062f8fc7c8c26f8f95324cbe8fa3145a5/net/ipv4/inet_hashtables.c#L483,L595"&gt;linux/net/ipv4/inet_hashtables.c&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://linuxperf.com/?p=178"&gt;ä¸´æ—¶ç«¯å£å·(EPHEMERAL PORT)çš„åŠ¨æ€åˆ†é…&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://my.oschina.net/u/2310891/blog/652323"&gt;TCPä½ å­¦å¾—ä¼šï¼šä¹‹ TCPç«¯å£é€‰æ‹©é‚£äº›äº‹å„¿&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://vcpu.me/bind/"&gt;bind()å®ç°æºç åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.linuxtcpipstack.com/430.html"&gt;TCPå±‚bindç³»ç»Ÿè°ƒç”¨çš„å®ç°åˆ†æ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;çœ‹å®Œå¥½åƒæœ‰ç‚¹æ˜ç™½äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;diff --git a/net/ipv4/inet_hashtables.c b/net/ipv4/inet_hashtables.c
index 3766bddb3e8a7303123aa7e32507f6f7801c10d5..8c0fc6fbc1afa08baf07ca86e98aa966a3f8e826 100644
--- a/net/ipv4/inet_hashtables.c
+++ b/net/ipv4/inet_hashtables.c
@@ -501,8 +501,14 @@ int __inet_hash_connect(struct inet_timewait_death_row *death_row,
         inet_get_local_port_range(net, &amp;amp;low, &amp;amp;high);
         remaining = (high - low) + 1;

+        /* By starting with offset being an even number,
+         * we tend to leave about 50% of ports for other uses,
+         * like bind(0).
+         */
+        offset &amp;amp;= ~1;  // offset å§‹ç»ˆä¸ºå¶æ•°
+
         local_bh_disable();
-        for (i = 1; i &amp;lt;= remaining; i++) {
+        for (i = 0; i &amp;lt; remaining; i++) {
             port = low + (i + offset) % remaining;  // æ¯æ¬¡æ€»æ˜¯åŠ å¶æ•°å¼€å§‹æ‰¾ï¼Œå³i=0 çš„æ—¶å€™
             if (inet_is_local_reserved_port(net, port))
                 continue;
@@ -546,7 +552,7 @@ int __inet_hash_connect(struct inet_timewait_death_row *death_row,
         return -EADDRNOTAVAIL;

 ok:
-        hint += i;
+        hint += (i + 2) &amp;amp; ~1;  // æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œ offset = hint + port_offset; hint æ˜¯å…¨å±€é™æ€å˜é‡ï¼Œå§‹ç»ˆä¸ºå¶æ•°
                                // è¿™æ ·åœ¨åŒä¸€ä¸ªç›®åœ°åœ°å€+ç«¯å£ï¼Œé‡å¤è°ƒç”¨ï¼Œä¸”æ²¡å…¶ä»–connect è¯·æ±‚æ’å…¥çš„æ—¶å€™ï¼Œåˆ†é…çš„ç«¯å£å·æ˜¯åŠ 2é€’å¢

         /* Head lock still held and bh&amp;#39;s disabled */
         inet_bind_hash(sk, tb, port);
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;N ä¸ªç«¯å£ï¼Œæ¯æ¬¡ä»ç¬¬å¶æ•°ä¸ªå¼€å§‹æ‰¾ï¼Œçœ‹ä¸‹&lt;code&gt;bind(0)&lt;/code&gt; åˆ†é…ç«¯å£çš„&lt;a href="https://github.com/torvalds/linux/blob/29c6852602e259d2c1882f320b29d5c3fec0de04/net/ipv4/inet_connection_sock.c#L119"&gt;ç›¸å…³å‡½æ•°&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;smallest_rover = rover = prandom_u32() % remaining + low;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åè€…çœ‹æ„æ€æ˜¯å®Œå…¨éšæœºçš„ï¼Œæ‰€ä»¥æ„æ€æ˜¯&lt;code&gt;connect&lt;/code&gt;ä»å¶æ•°ä¸ªå¼€å§‹æ‰¾ï¼Œè®©å‡ºä¸€åŠçš„ç©ºé—´ç»™&lt;code&gt;bind(0)&lt;/code&gt;ï¼Œæé«˜&lt;code&gt;bind(0)&lt;/code&gt;çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œä¸ºä»€ä¹ˆå»ºè®®&lt;code&gt;ip_local_port_range&lt;/code&gt; å¯ç”¨çš„ç«¯å£æ˜¯å¶æ•°ï¼Œå³è¦æœ‰ä¸€ä¸ªå¥‡æ•°ã€ä¸€ä¸ªå¶æ•°å‘¢ï¼Ÿ&lt;code&gt;offset&lt;/code&gt; æ¯æ¬¡ä¹Ÿéƒ½æ˜¯æ— è®ºå“ªç§æƒ…å†µæ˜¯å¶æ•°ï¼Œ
remaining ä¸ºå¶æ•°ä¸ºå¥‡æ•°å¥½åƒéƒ½ä¸å½±å“é€»è¾‘ï¼Œåªå·®ä¸€ä¸ªè€Œå·²ï¼Œä¸€å®šè¦50%ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æ„šé’ï¼Œæ²¡æƒ³æ˜ç™½ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹äº†ä¸‹æ–°çš„&lt;a href="https://github.com/torvalds/linux/blob/1580ab63fc9a03593072cc5656167a75c4f1d173/net/ipv4/inet_hashtables.c#L562"&gt;__inet_hash_connect&lt;/a&gt;ï¼Œæ„Ÿè§‰æ›´åˆç†ä¸€äº›ï¼Œ
&lt;code&gt;connect&lt;/code&gt; ä¼˜å…ˆä»å¶æ•°ä¸ªå¼€å§‹ï¼Œå¦‚æœåˆ†é…å¤±è´¥ï¼Œæ¯æ¬¡æ‰¾ä¸‹ä¸€ä¸ªçš„æ—¶å€™ï¼Œä¹Ÿæ˜¯è·³åˆ°ä¸‹ä¸€ä¸ªå¶æ•°ä¸ªï¼Œå³&lt;code&gt;port+=2&lt;/code&gt;ï¼Œ&lt;code&gt;inet_csk_find_open_port&lt;/code&gt;åˆ™æ˜¯&lt;a href="https://github.com/torvalds/linux/blob/b71acb0e372160167bf6d5500b88b30b52ccef6e/net/ipv4/inet_connection_sock.c#L208"&gt;åè¿‡æ¥&lt;/a&gt;ï¼Œæ›´åŠ é«˜æ•ˆï¼Œå¤§å®¶éƒ½ä¼˜å…ˆç”¨ä¸€åŠï¼Œä¸è¡Œå†æ‰¾å¯¹æ–¹çš„ä¸€åŠã€‚&lt;/p&gt;</content><category term="2019"></category><category term="linux"></category><category term="kernel"></category><category term="tcp"></category></entry><entry><title>Python Switch å¤šæ¬¡è°ƒç”¨å°é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2019/2019-02-24.html" rel="alternate"></link><published>2019-02-24T00:00:00+08:00</published><updated>2019-02-24T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2019-02-24:/posts/2019/2019-02-24.html</id><summary type="html">&lt;p&gt;å¤§å®¶éƒ½çŸ¥é“Python ä¸­æ²¡æœ‰Switch å…³é”®è¯ï¼Œå¦‚æœå†™ä¸€å †if-elif-else éå¸¸ä¸ç¾è§‚ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨å­—å…¸ï¼Œä»Šå¤©é‡åˆ°ä¸€ä¸ªå°é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Recource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do â€¦&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;å¤§å®¶éƒ½çŸ¥é“Python ä¸­æ²¡æœ‰Switch å…³é”®è¯ï¼Œå¦‚æœå†™ä¸€å †if-elif-else éå¸¸ä¸ç¾è§‚ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨å­—å…¸ï¼Œä»Šå¤©é‡åˆ°ä¸€ä¸ªå°é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Recource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
       &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
         &lt;span class="s1"&gt;&amp;#39;aliyun&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;
             &lt;span class="s1"&gt;&amp;#39;create&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__create__&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
             &lt;span class="s1"&gt;&amp;#39;update&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__update__&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
             &lt;span class="o"&gt;...&lt;/span&gt;
             &lt;span class="p"&gt;},&lt;/span&gt;
         &lt;span class="s1"&gt;&amp;#39;aws&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;
        &lt;span class="p"&gt;}[&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å†™å®Œæµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°å­—å…¸é‡Œé¢æ¯ä¸ªå‡½æ•°éƒ½ä¼šè¢«æ‰§è¡Œä¸€éï¼Œå‘ç°è‡ªå·±å‚»é€¼äº†ï¼Œä½†æ˜¯ä¸€æ—¶ä¸çŸ¥é“è¯¥å¦‚ä½•è§£å†³ï¼ŒGoogle ä¸‹æ‰¾åˆ°äº†è§£å†³æ–¹å¼ï¼š
&lt;a href="https://stackoverflow.com/questions/46908510/pythonic-switch-within-class"&gt;Pythonic switch within class&lt;/a&gt;,&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Recource&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
       &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
         &lt;span class="s1"&gt;&amp;#39;aliyun&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:{&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt;            &lt;span class="s1"&gt;&amp;#39;create&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__create__&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt;            &lt;span class="s1"&gt;&amp;#39;update&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__update__&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;            &lt;span class="s1"&gt;&amp;#39;create&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__create__&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;            &lt;span class="s1"&gt;&amp;#39;update&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;lambda&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;__update__&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
             &lt;span class="o"&gt;...&lt;/span&gt;
             &lt;span class="p"&gt;},&lt;/span&gt;
         &lt;span class="s1"&gt;&amp;#39;aws&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt;
&lt;span class="o"&gt;-&lt;/span&gt;       &lt;span class="p"&gt;}[&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;+&lt;/span&gt;       &lt;span class="p"&gt;}[&lt;/span&gt;&lt;span class="n"&gt;provider&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="n"&gt;action&lt;/span&gt;&lt;span class="p"&gt;]()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŸæ¥å¦‚æ­¤ï¼Œlambda å®šä¹‰ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¿™ä¸ªå¯¹è±¡æŒ‡å‘å…·ä½“å‡½æ•°å¯¹è±¡çš„åœ°å€ï¼Œç±»ä¼¼&lt;a href="https://en.wikipedia.org/wiki/Branch_table"&gt;jump table&lt;/a&gt;ã€‚&lt;br&gt;
åˆä¸€æ¬¡é¢å‘Stack Overflow ç¼–ç¨‹ :Pã€‚&lt;/p&gt;</content><category term="2019"></category><category term="python"></category></entry><entry><title>ANAMEã€CNAMEã€DNAME</title><link href="https://fangpsh.github.io/posts/2018/2018-11-04.html" rel="alternate"></link><published>2018-11-04T00:00:00+08:00</published><updated>2018-11-04T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-11-04:/posts/2018/2018-11-04.html</id><summary type="html">&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/CNAME_record"&gt;CNAME&lt;/a&gt; å¾ˆå¸¸è§ï¼Œä¸€èˆ¬äººéƒ½å¾ˆç†Ÿæ‚‰ï¼Œå°†ä¸€ä¸ªåŸŸåæ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªåŸŸåã€‚ä½†æ˜¯CNAME æœ‰ä¸ªé™åˆ¶ï¼Œé¡¶çº§åŸŸåï¼ˆapex domainï¼‰ä¸å»ºè®®è®¾ç½®CNAMEï¼Œå› ä¸ºä¼šå’ŒMX è®° â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/CNAME_record"&gt;CNAME&lt;/a&gt; å¾ˆå¸¸è§ï¼Œä¸€èˆ¬äººéƒ½å¾ˆç†Ÿæ‚‰ï¼Œå°†ä¸€ä¸ªåŸŸåæ˜ å°„åˆ°å¦å¤–ä¸€ä¸ªåŸŸåã€‚ä½†æ˜¯CNAME æœ‰ä¸ªé™åˆ¶ï¼Œé¡¶çº§åŸŸåï¼ˆapex domainï¼‰ä¸å»ºè®®è®¾ç½®CNAMEï¼Œå› ä¸ºä¼šå’ŒMX è®°å½•å†²çªï¼Œè¯¦ç»†è§£é‡Šï¼š&lt;a href="https://www.v2ex.com/t/204489#26"&gt;ä¸ºä»€ä¹ˆè£¸åŸŸåä¸å¯ä»¥è®¾ç½® CNAMEï¼Ÿ#26&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.ietf.org/rfc/rfc1912.txt"&gt;RFC1912:2.4 CNAME records&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A CNAME record is not allowed to coexist with any other data.  In other words, if suzy.podunk.xx is an alias for sue.podunk.xx, you can't also have an MX record for suzy.podunk.edu, or an A record, or even a TXT record...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥å°±è¯ç”Ÿäº†&lt;a href="https://dnsmadeeasy.com/services/anamerecords/"&gt;ANAME&lt;/a&gt;ï¼Œæœ‰äº›DNS æœåŠ¡å•†å«åš&lt;a href="https://support.dnsimple.com/articles/alias-record/"&gt;ALIAS&lt;/a&gt;ï¼Œå¯ä»¥åœ¨apex domain ä¸Šå®ç°ç±»ä¼¼CNAME æ•ˆæœã€‚ç¬¬ä¸€æ¬¡è§åˆ°è¿™ä¸ªï¼Œæ˜¯åœ¨é…ç½®&lt;a href="https://blog.github.com/2014-01-07-faster-more-awesome-github-pages/#apex-domain-examplecom---with-alias-or-a"&gt;Github Pages&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç›®å‰åªæœ‰ä¸€äº›å›½å¤–çš„DNS æœåŠ¡å•†æ”¯æŒï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://help.iwantmyname.com/customer/portal/articles/1599947-do-you-support-alias-or-aname-dns-records-"&gt;Do you support ALIAS or ANAME DNS records?&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CloudFlare&lt;/li&gt;
&lt;li&gt;DNSMadeEasy&lt;/li&gt;
&lt;li&gt;DNSimple&lt;/li&gt;
&lt;li&gt;PointDNS&lt;/li&gt;
&lt;li&gt;Amazon Route 53 (only for hosting on AWS)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸è¿‡è¿™æ˜¯éæ ‡å‡†çš„å®ç°ï¼Œç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯å°‘ç”¨ä¸ºå¥½ã€‚&lt;/p&gt;
&lt;h2&gt;DNAME&lt;/h2&gt;
&lt;p&gt;é™¤äº†ANAMEï¼ŒCNAMEï¼Œè¿˜æœ‰ä¸€ä¸ª&lt;a href="https://www.ietf.org/rfc/rfc2672.txt"&gt;DNAME&lt;/a&gt;ã€‚DNAME å’ŒCNAME çš„åŒºåˆ«æ˜¯ï¼ŒCNAME åªæ˜¯æ˜ å°„ä¸€ä¸ªå­åŸŸåï¼ŒDNAME æ˜ å°„çš„æ˜¯æ•´ä¸ªå­åŸŸåç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;aaa.example.com CNAME bbb.example.org

è¿˜å¯ä»¥æ·»åŠ è®°å½•

a1.aaa.example.com CNAME  b1.bbb.example.org
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;aaa&lt;/code&gt; çš„CNAME åªæ˜¯è¡¨ç¤ºæŠŠ&lt;code&gt;aaa&lt;/code&gt;è¿™ä¸ªå­åŸŸåæ˜ å°„è¿‡å»ï¼Œå¹¶ä¸å½±å“&lt;code&gt;*.aaa&lt;/code&gt;ã€‚ä½†æ˜¯å¦‚æœDNAME çš„è¯ï¼Œå°±ä¸ä¸€æ ·äº†&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;aaa.example.com CNAME bbb.example.org
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæ—¶å€™ä½ å†è§£æ&lt;code&gt;a1.aaa.example.com&lt;/code&gt;ï¼Œå¾—åˆ°çš„å®é™…æ˜¯&lt;code&gt;a1.bbb.example.org&lt;/code&gt; çš„ç»“æœã€‚å› ä¸º&lt;code&gt;aaa.example.com&lt;/code&gt; èŠ‚ç‚¹åŒ…æ‹¬å…¶å­èŠ‚ç‚¹éƒ½æ˜ å°„åˆ°äº†&lt;code&gt;bbb.example.org&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ›´è¯¦ç»†çš„ä¾‹å­å¯ä»¥å‚è€ƒå°æ¹¾ç½‘å‹çš„è¿™ç¯‡æ–‡ç« ï¼š&lt;a href="https://ssorc.tw/994"&gt;DNSçš„CNAME/DNAMEå‚»å‚»åˆ†ä¸æ¸…æ¥š&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–DNAME è®°å½•ï¼Œå›½å†…çš„DNS æœåŠ¡å•†ä¹Ÿå‡ ä¹éƒ½ä¸æ”¯æŒâ•®(â•¯â–½â•°)â•­ ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="DNS"></category></entry><entry><title>IPv6-Test DNS æµ‹è¯•</title><link href="https://fangpsh.github.io/posts/2018/2018-11-3.html" rel="alternate"></link><published>2018-11-03T00:00:00+08:00</published><updated>2018-11-03T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-11-03:/posts/2018/2018-11-3.html</id><summary type="html">&lt;p&gt;&lt;img alt="ipv6-test" src="/assets/images/2023/20230228185431.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘åœ¨æŠ˜è…¾åŠå…¬å®¤çš„IPv6 ç¯å¢ƒï¼Œé€šè¿‡&lt;a href="http://ipv6-test.com/"&gt;ipv6-test.com&lt;/a&gt;æµ‹è¯•çš„æ—¶å€™ï¼Œå¯¹é¡µé¢å†…çš„â€œDNSâ€çš„æµ‹è¯•ç»“æœæœ‰ç‚¹ç–‘é—®ã€‚  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DNS4 + IP6&lt;ul&gt;
&lt;li&gt;Connectivity to an IPv6 address served by an IPv4-only name server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DNS6 â€¦&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="ipv6-test" src="/assets/images/2023/20230228185431.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘åœ¨æŠ˜è…¾åŠå…¬å®¤çš„IPv6 ç¯å¢ƒï¼Œé€šè¿‡&lt;a href="http://ipv6-test.com/"&gt;ipv6-test.com&lt;/a&gt;æµ‹è¯•çš„æ—¶å€™ï¼Œå¯¹é¡µé¢å†…çš„â€œDNSâ€çš„æµ‹è¯•ç»“æœæœ‰ç‚¹ç–‘é—®ã€‚  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DNS4 + IP6&lt;ul&gt;
&lt;li&gt;Connectivity to an IPv6 address served by an IPv4-only name server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DNS6 + IP4&lt;ul&gt;
&lt;li&gt;Connectivity to an IPv4 address served by an IPv6-only name server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DNS6 + IP6&lt;ul&gt;
&lt;li&gt;Connectivity to an IPv6 address served by an IPv6-only name server&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çœ‹ä¸‹é¡µé¢çš„ç½‘ç»œè¯·æ±‚ï¼Œä¸‰ç§æµ‹è¯•ç”¨ä¾‹åˆ†åˆ«è¯·æ±‚çš„åœ°å€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;DNS4 + IP6&lt;ul&gt;
&lt;li&gt;v6.zone4.ipv6-test.com&lt;/li&gt;
&lt;li&gt;AAAA è®°å½•ï¼š2001:41d0:8:e8ad::1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DNS6 + IP4&lt;ul&gt;
&lt;li&gt;v4.zone6.ipv6-test.com&lt;/li&gt;
&lt;li&gt;A è®°å½•ï¼š5.135.165.173&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DNS6 + IP6&lt;ul&gt;
&lt;li&gt;v6.zone6.ipv6-test.com&lt;/li&gt;
&lt;li&gt;AAAA è®°å½•ï¼š2001:41d0:8:e8ad::1&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…¶å®è¿˜æœ‰ä¸ª&lt;code&gt;DNS4 + IP4&lt;/code&gt;ï¼Œæ²¡å•¥å¥½æµ‹è¯•çš„å˜›ã€‚&lt;/p&gt;
&lt;p&gt;æ˜ç™½äº†ï¼Œä¸‰ç§æµ‹è¯•ç”¨ä¾‹ï¼ŒDNS4/6 è¡¨ç¤ºçš„æ˜¯æƒå¨æœåŠ¡å™¨çš„ç½‘ç»œç¯å¢ƒï¼Œè¦ä¹ˆæ˜¯IPv4ï¼Œè¦ä¹ˆæ˜¯IPv6ï¼›IP4/6 åªæ˜¯å…¶å®åˆ†åˆ«æ˜¯Aå’ŒAAAA è®°å½•ã€‚æµ‹è¯•çš„å…¶å®æ˜¯æœ¬åœ°local dns å¯¹&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æƒå¨æœåŠ¡å™¨æ‰˜ç®¡åœ¨IPv4 ç¯å¢ƒï¼Œé€šè¿‡AAAAè®°å½•ï¼ˆIPv6 ç½‘ç»œï¼‰è®¿é—®&lt;/li&gt;
&lt;li&gt;æƒå¨æœåŠ¡å™¨æ‰˜ç®¡åœ¨IPv6 ç¯å¢ƒï¼Œé€šè¿‡Aè®°å½•ï¼ˆIPv4 ç½‘ç»œï¼‰è®¿é—®&lt;/li&gt;
&lt;li&gt;æƒå¨æœåŠ¡å™¨æ‰˜ç®¡åœ¨IPv6 ç¯å¢ƒï¼Œé€šè¿‡AAAAï¼ˆIPv4 ç½‘ç»œï¼‰è®¿é—®&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœä½ æ˜¯IPv4 ç½‘ç»œçš„è¯ï¼Œ1ã€3 æµ‹è¯•è‚¯å®šæ˜¯å¤±è´¥çš„ï¼ŒIPv6 ä¸é€šå˜›ï¼Œä½†æ˜¯2 å¯èƒ½èƒ½å¤ŸæˆåŠŸï¼Œå› ä¸ºä½ çš„local dns å‡ºå£å¯èƒ½æ˜¯èƒ½å¤Ÿè®¿é—®IPv6 ç¯å¢ƒçš„ï¼Œå¦‚æœä¸è¡Œçš„è¯ï¼Œæ¢æˆ&lt;code&gt;8.8.8.8&lt;/code&gt; è¯•ä¸€è¯•ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨ç”µä¿¡çš„IPv6 ç¯å¢ƒä¸‹æµ‹è¯•å‘ç°3 å¤±è´¥äº†ï¼Œç”µä¿¡è¿˜æ²¡ç»™IPv6 çš„DNSï¼Œé»˜è®¤çš„IPv4 çš„DNS ä¹Ÿä¸èƒ½è®¿é—®åˆ°çº¯IPv6 ç¯å¢ƒçš„æƒå¨æœåŠ¡å™¨ï¼Œæ‰‹åŠ¨åŠ ä¸ªGoogle çš„&lt;code&gt;2001:4860:4860::8888&lt;/code&gt; å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;IPv6 è¦æ¨å¹¿äº†ï¼Œç›¸å…³çš„ä¸€å †åŸºç¡€çŸ¥è¯†å¾—æŠ“ç´§è¡¥äº†ï¼Œåœ°å€æ ¼å¼ã€SLAACã€DHCPv6ã€ICMPv6...æƒ³èµ·å¤§å­¦è®¡ç½‘è€å¸ˆå±…ç„¶è‡ªåŠ¨è·³è¿‡äº†IPv6 è¿™ä¸€ç« ï¼&lt;/p&gt;</content><category term="2018"></category><category term="ipv6"></category><category term="dns"></category><category term="network"></category></entry><entry><title>Airflow å¹¶å‘trigger DAG çš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2018/2018-10-25.html" rel="alternate"></link><published>2018-10-25T00:00:00+08:00</published><updated>2018-10-25T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-10-25:/posts/2018/2018-10-25.html</id><summary type="html">&lt;p&gt;æœ‰ä¸€ä¸ªå°æœåŠ¡ä½¿ç”¨äº†&lt;a href="http://airflow.apache.org"&gt;airflow&lt;/a&gt;ï¼Œä¼šæŠŠæ¯”è¾ƒè€—æ—¶çš„ç¦»çº¿ä»»åŠ¡ä¸¢åˆ°airflow å¤„ç†ã€‚
åœ¨éœ€è¦çš„æ—¶å€™è§¦å‘ï¼ˆtrigger_dagï¼‰è¿™äº›ä»»åŠ¡ã€‚æœ€è¿‘å‘ç°ä¸€å°éƒ¨åˆ†ä»»åŠ¡æ²¡ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æœ‰ä¸€ä¸ªå°æœåŠ¡ä½¿ç”¨äº†&lt;a href="http://airflow.apache.org"&gt;airflow&lt;/a&gt;ï¼Œä¼šæŠŠæ¯”è¾ƒè€—æ—¶çš„ç¦»çº¿ä»»åŠ¡ä¸¢åˆ°airflow å¤„ç†ã€‚
åœ¨éœ€è¦çš„æ—¶å€™è§¦å‘ï¼ˆtrigger_dagï¼‰è¿™äº›ä»»åŠ¡ã€‚æœ€è¿‘å‘ç°ä¸€å°éƒ¨åˆ†ä»»åŠ¡æ²¡æˆåŠŸï¼Œå¯¹åº”çš„dag ä¸‹ä¹Ÿæ²¡æ‰¾åˆ°æ—¥å¿—è®°å½•ï¼Œçœ‹èµ·æ¥æ˜¯æ²¡è§¦å‘æˆåŠŸã€‚
åœ¨airflow-web-server ä¸­å‘ç°äº†å¼‚å¸¸æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Run id ... already exists for dag id ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹äº†ä¸‹ä»£ç ï¼š&lt;a href="https://github.com/apache/incubator-airflow/blob/master/airflow/api/common/experimental/trigger_dag.py#L42,L55"&gt;incubator-airflow/airflow/api/common/experimental/trigger_dag.py&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœªæŒ‡å®šrun_id çš„æƒ…å†µä¸‹ï¼Œrun_id é»˜è®¤ä¸º&lt;code&gt;utcnow&lt;/code&gt;ï¼Œå¹¶ä¸”è¿˜é»˜è®¤å»æ‰äº†microsecondã€‚è¿™æ ·çš„è¯ï¼Œå¯¹åŒä¸€ä¸ªdag å¤§é‡å¹¶å‘trigger çš„æ—¶å€™ï¼Œrun_id å¾ˆå®¹æ˜“ç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸´æ—¶çš„è§£å†³æ–¹æ³•ï¼Œåœ¨trigger dag æ—¶æŒ‡å®šä¸‹run_idã€‚æˆ‘ä¸´æ—¶æ”¹æˆäº† utcnow+uuid4ï¼Œåº”è¯¥ä¸ä¼šå†æ’ä¸Šäº†å§ï¼Œä¸ç„¶å°±æ˜¯ä¸­å½©ç¥¨äº†ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="Airflow"></category></entry><entry><title>å…³é—­æœåŠ¡å™¨èŠ‚èƒ½æ¨¡å¼</title><link href="https://fangpsh.github.io/posts/2018/2018-09-20.html" rel="alternate"></link><published>2018-09-20T00:00:00+08:00</published><updated>2018-09-20T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-09-20:/posts/2018/2018-09-20.html</id><summary type="html">&lt;p&gt;ä¸å°‘æœåŠ¡å™¨å‡ºå‚é»˜è®¤æ˜¯å¼€å¯èŠ‚èƒ½æ¨¡å¼ï¼Œä¼šæœ‰å¾ˆå¤šâ€œå‘â€ï¼Œä¾‹å¦‚æ„å¤–å®•æœºã€‚æˆ‘ä¸æ¸…æ¥šè¿™äº›å‘ç°åœ¨è¿˜æ˜¯å¦å­˜åœ¨ï¼Œæˆ–è€…è¯¥æ€æ ·ç»•è¿‡å»ï¼Œä¹Ÿ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸å°‘æœåŠ¡å™¨å‡ºå‚é»˜è®¤æ˜¯å¼€å¯èŠ‚èƒ½æ¨¡å¼ï¼Œä¼šæœ‰å¾ˆå¤šâ€œå‘â€ï¼Œä¾‹å¦‚æ„å¤–å®•æœºã€‚æˆ‘ä¸æ¸…æ¥šè¿™äº›å‘ç°åœ¨è¿˜æ˜¯å¦å­˜åœ¨ï¼Œæˆ–è€…è¯¥æ€æ ·ç»•è¿‡å»ï¼Œä¹Ÿä¸æƒ³èŠ±è´¹è¿™ä¸ªç²¾åŠ›ã€‚
åæ­£éƒ½æ˜¯ç§Ÿç”¨çš„æœåŠ¡å™¨ï¼Œå®Œå…¨ä¸ç”¨æ“å¿ƒç”µè´¹ï¼›ç§ŸæœºæŸœæ‰˜ç®¡çš„ï¼Œå¥½åƒä¹Ÿä¸ä¼šå¦å¤–ç®—ç”µè´¹ã€‚æ²¡æœ‰BAT é‡çº§çš„æœºå™¨ï¼Œæ²¡å¿…è¦èŠ±åŠŸå¤«ç ”ç©¶ç»†èŠ‚ï¼Œå…³äº†å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è®©BIOS æ¥ç®¡ç”µæºç®¡ç†ï¼Œè·‘åœ¨æœ€ä½³æ€§èƒ½ï¼Œæ•´ç†ä¸‹å¸¸è§å‚å•†çš„å…³é—­æ­¥éª¤ã€‚&lt;/p&gt;
&lt;h2&gt;Dell&lt;/h2&gt;
&lt;p&gt;Dell çš„iDracï¼šBIOSã€‹System Profile Settingsã€‹Performance&lt;/p&gt;
&lt;p&gt;BIOS ä¸­è®¾ç½®ï¼š
&lt;img alt="idrac_bios" src="/assets/images/2023/20230301161317.png"&gt;&lt;/p&gt;
&lt;p&gt;iDrac Web ä¸­è®¾ç½®ï¼š
&lt;img alt="idrac_web1" src="/assets/images/2023/20230301161326.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="idrac_web2" src="/assets/images/2023/20230301161338.png"&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://jaseywang.me/2013/09/22/nix-ä¸‹-cpu-çš„èƒ½è€—æ§åˆ¶/"&gt;ã€Š*NIX ä¸‹ CPU çš„èƒ½è€—æ§åˆ¶ã€‹&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯´äº†è¿™ä¹ˆå¤šï¼Œå…¶å®å®Œå…¨æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšï¼Œå‰æçš„æ˜¯ä½ çš„æœºå™¨æ•°é‡åœ¨äº”ä½æ•°ä»¥ä¸‹ï¼Œæˆ‘ä¼°è®¡å¤§é™† p99 çš„äº’è”ç½‘éƒ½æ˜¯è¿™ä¸ªé‡çº§ä»¥ä¸‹çš„ï¼Œåˆ›ä¸šå…¬å¸å°±æ›´æ™®éäº†ã€‚&lt;br&gt;
 å› æ­¤ï¼Œæœ€ç®€å•çš„åŠæ³•æ˜¯ï¼Œå°† BIOS è®¾ç½®æˆ "Performance"(memory freq sets to max, memory patrol scrub sets to standard mode, memory fresh rate sets to 1x, memory operating voltage sets to auto, turbo boost enabled and C1E&amp;amp;C-states disabled) æ¨¡å¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="http://crtech.tips/performance-mode-omsa/"&gt;PERFORMANCE MODE â€“ OMSA&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æµªæ½®/åä¸º&lt;/h2&gt;
&lt;p&gt;æµªæ½®å’Œåä¸ºçš„æœåŠ¡å™¨å¤§å¤šç”¨çš„&lt;a href="https://ami.com/"&gt;AMI BIOS &lt;/a&gt;ï¼Œè®¾ç½®ä¸Šå·®ä¸å¤šï¼š
&lt;img alt="ami_bios1" src="/assets/images/2023/20230301161352.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="ami_bios2" src="/assets/images/2023/20230301161403.png"&gt;&lt;/p&gt;
&lt;p&gt;Power Techology é€‰ä¸­Performance ï¼Œæˆ–è€…é€‰ä¸­ Customï¼Œå†æ‰‹åŠ¨è°ƒæ•´ã€‚&lt;/p&gt;
&lt;p&gt;Power Policy Select ç”µæºç­–ç•¥é€‰æ‹©ï¼Œèœå•é€‰é¡¹ä¸ºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Efficiencyï¼ˆèŠ‚èƒ½æ¨¡å¼ï¼‰ï¼šæ•ˆç‡ä¼˜å…ˆï¼Œå¯ç”¨åæ˜¯ä½æ€§èƒ½ä½åŠŸè€—æ¨¡å¼ï¼Œæ­¤æ¨¡å¼å¯ç¡®ä¿é™ä½ç³»ç»Ÿçš„åŠŸè€—ã€‚&lt;/li&gt;
&lt;li&gt;Performanceï¼ˆæ€§èƒ½æ¨¡å¼ï¼‰ï¼šæ€§èƒ½ä¼˜å…ˆï¼Œå¯ç”¨åæ˜¯é«˜æ€§èƒ½é«˜åŠŸè€—æ¨¡å¼ã€‚&lt;/li&gt;
&lt;li&gt;Customï¼ˆè‡ªå®šä¹‰ï¼‰ï¼šç”¨æˆ·è‡ªå®šä¹‰æ¨¡å¼ï¼Œå…¼é¡¾æ€§èƒ½ã€å»¶è¿Ÿå’Œèƒ½è€—ã€‚å»ºè®®é…ç½®CPUè¿è¡Œåœ¨æ ‡å‡†é¢‘ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;BIOS -&amp;gt; chipset -&amp;gt; Energy Performance Tunning&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Energy Performance Tunning é€‰ä¸­BIOS&lt;/li&gt;
&lt;li&gt;Energy PerformanceBIAS é€‰ä¸­Performance&lt;/li&gt;
&lt;li&gt;Workload Configuration é€‰ä¸­Balanced&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CPU P State Control&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;EIST é€‰ä¸­Disabled&lt;/li&gt;
&lt;li&gt;Turbo Mode é€‰ä¸­Enable&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;CPU C State Control&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Package C State limit é€‰ä¸­C0/C1 state&lt;/li&gt;
&lt;li&gt;CPU C3 report é€‰ä¸­Disabled&lt;/li&gt;
&lt;li&gt;CPU C6 report é€‰ä¸­Disabled&lt;/li&gt;
&lt;li&gt;Enhanced Halt State (C1E) é€‰ä¸­Disabled&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ACPI T-States é€‰ä¸­Disbaled&lt;/p&gt;
&lt;p&gt;&lt;img alt="bmc" src="/assets/images/2023/20230301161415.png"&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://support.huawei.com/enterprise/zh/doc/EDOC1000039566?section=j014"&gt;åä¸ºæœåŠ¡å™¨ Bricklandå¹³å° BIOSï¼šAdvanced Power Management Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.4008600011.com/archives/3542"&gt;SA5212M4 BIOSè®¾ç½®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.4008600011.com/archives/12499#Advanced_Power_Management_Configuration"&gt;SA5212M5-BIOSè®¾ç½®&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;HP&lt;/h2&gt;
&lt;p&gt;&lt;img alt="hp" src="/assets/images/2023/20230301161426.png"&gt;&lt;/p&gt;
&lt;p&gt;System Profiles é€‰æ‹©ï¼šMaxium Performanceï¼ˆæœ€é«˜æ€§èƒ½ï¼‰&lt;/p&gt;
&lt;p&gt;iLo è®¾ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="iLo_2" src="/assets/images/2023/20230301161437.png"&gt;&lt;/p&gt;
&lt;p&gt;BIOS è®¾ç½®ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="hp_bios" src="/assets/images/2023/20230301161445.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="hp_bios2" src="/assets/images/2023/20230301161454.png"&gt;&lt;/p&gt;
&lt;h2&gt;IBM&lt;/h2&gt;
&lt;p&gt;IBM çš„æœåŠ¡å™¨æ²¡æ¥è§¦è¿‡ï¼Œä¸è¿‡éƒ½å·®ä¸å¤šï¼ŒIBM çš„ç®¡ç†å¡ä¼¼ä¹å«&lt;a href="https://www.ibm.com/support/knowledgecenter/TI0003N/p8hat/p8hat_partitioningwithanhmc.htm"&gt;HMC&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯ç”¨å›ºå®šæœ€å¤§é¢‘ç‡æ¨¡å¼ï¼šä½¿å¤„ç†å™¨é¢‘ç‡è®¾ç½®ä¸ºå¯ä»¥æŒ‡å®šçš„å›ºå®šå€¼ã€‚æ­¤é€‰é¡¹å…è®¸æ‚¨è®¾ç½®å¤„ç†å™¨é¢‘ç‡çš„æœ€å¤§é™åˆ¶å’Œç³»ç»Ÿçš„åŠŸè€—ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="hmc" src="/assets/images/2023/20230301161506.png"&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.ibm.com/support/knowledgecenter/zh/POWER8/p8ha1/11powermanagementtask.htm"&gt;IBM Knowledge Center - ç”µæºç®¡ç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/Power%20Systems/page/POWER9%20EnergyScale%20-%20Configuration%20&amp;amp;%20Management"&gt;POWER9 EnergyScale - Configuration &amp;amp; Management&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www-01.ibm.com/support/docview.wss?uid=isg3T1025318"&gt;Change Power Management settings&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2018"></category><category term="æœåŠ¡å™¨"></category></entry><entry><title>ä»€ä¹ˆæ˜¯Bogonï¼Ÿ</title><link href="https://fangpsh.github.io/posts/2018/2018-09-19.html" rel="alternate"></link><published>2018-09-19T00:00:00+08:00</published><updated>2018-09-19T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-09-19:/posts/2018/2018-09-19.html</id><summary type="html">&lt;p&gt;åœ¨&lt;a href="https://bgp.he.net/"&gt;BGP.HE.NET&lt;/a&gt; ä¸ŠæŸ¥è¯¢IP ä¿¡æ¯çš„æ—¶å€™ï¼ŒAnnounced By &lt;a href="https://bgp.he.net/AS4808"&gt;AS4808&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="AS4808" src="/assets/images/2023/20230301162304.png"&gt;&lt;/p&gt;
&lt;p&gt;æç¤ºï¼š&lt;a href="https://bgp.he.net/AS4808#_bogons"&gt;AS4808 announces bogons.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="AS4804_Bogon" src="/assets/images/2023/20230301162311.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="202.94.1.0" src="/assets/images/2023/20230301162324.png"&gt;&lt;/p&gt;
&lt;p&gt;æ„æ€è¿™ä¸ªæ®µè¿˜åœ¨APNIC æ‰‹é‡Œï¼Œæœªè¢«åˆ†é…ï¼Œä½†æ˜¯è”é€šçš„è¿™ä¸ªAS åŸŸå¹¿æ’­äº†è¿™ä¸ªæ®µ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åœ¨&lt;a href="https://bgp.he.net/"&gt;BGP.HE.NET&lt;/a&gt; ä¸ŠæŸ¥è¯¢IP ä¿¡æ¯çš„æ—¶å€™ï¼ŒAnnounced By &lt;a href="https://bgp.he.net/AS4808"&gt;AS4808&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="AS4808" src="/assets/images/2023/20230301162304.png"&gt;&lt;/p&gt;
&lt;p&gt;æç¤ºï¼š&lt;a href="https://bgp.he.net/AS4808#_bogons"&gt;AS4808 announces bogons.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="AS4804_Bogon" src="/assets/images/2023/20230301162311.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="202.94.1.0" src="/assets/images/2023/20230301162324.png"&gt;&lt;/p&gt;
&lt;p&gt;æ„æ€è¿™ä¸ªæ®µè¿˜åœ¨APNIC æ‰‹é‡Œï¼Œæœªè¢«åˆ†é…ï¼Œä½†æ˜¯è”é€šçš„è¿™ä¸ªAS åŸŸå¹¿æ’­äº†è¿™ä¸ªæ®µã€‚&lt;/p&gt;
&lt;p&gt;ç»§ç»­æŸ¥ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;202/8    APNIC    1993-05    whois.apnic.net    https://rdap.apnic.net/    ALLOCATED&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;202/8&lt;/code&gt; åˆ†é…ç»™äº†APNICã€‚æ—¢ç„¶æ˜¯è”é€šï¼Œé‚£å°±åˆ°CNNIC æŸ¥ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="CNNIC" src="/assets/images/2023/20230301162337.png"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹èµ·æ¥ç¡®å®æ²¡åˆ†ç»™è”é€šï¼Œä¸è¿‡åœ¨&lt;a href="https://www.ipip.net/ip.html"&gt;IPIP.NET&lt;/a&gt;æŸ¥è¯¢ï¼Œè¿™ä¸ªIP å½’å±æ˜¾ç¤ºæ˜¯è”é€šã€‚&lt;/p&gt;
&lt;p&gt;å°±åƒ&lt;code&gt;10.0.0.0/8&lt;/code&gt; è¿™ç±»ç§ç½‘ä¿ç•™åœ°å€ï¼Œå¹¿æ’­å‡ºå»ï¼Œå¤§å®¶åº”è¯¥éƒ½ä¼šä¸¢å¼ƒæ‰ã€‚ä¼°è®¡å¾—ç­‰ä»¥åAPNIC å¼€å§‹åˆ†é…ä½¿ç”¨è¿™æ®µåœ°å€ï¼Œè”é€šå°±ä¸èƒ½å¹¿æ’­äº†å§ã€‚  &lt;/p&gt;
&lt;p&gt;Bogon&lt;code&gt;['bÉ”É¡É™n]&lt;/code&gt; è¿™ä¸ªå•è¯å¥½å¤šè¯å…¸éƒ½æŸ¥ä¸åˆ°ï¼Œæ®è¯´èµ·æºäºbogus&lt;code&gt;bÉ™uÉ¡É™s&lt;/code&gt;ï¼šå‡å†’ï¼Œä¼ªé€ ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A bogon route is a type of route which shouldn't exist on the global Internet. More specifically, "bogon" (derived from the word "bogus") refers to an advertisement for a prefix within a reserved or otherwise unallocated IP network.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xhtml"&gt;IANA IPv4 Address Space Registry&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://ipwhois.cnnic.cn/bns/query/Query/ipwhoisQuery.do?queryOption=ipv4&amp;amp;txtquery=202.94.1.2&amp;amp;x=46&amp;amp;y=10"&gt;CNNIC&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://packetlife.net/blog/2009/jan/21/whats-bogon/"&gt;What's a bogon?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Bogon_filtering"&gt;Bogon filtering&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2018"></category><category term="BGP"></category></entry><entry><title>echo è¾“å‡ºå¯¼è‡´SCP å¤±æ•ˆçš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2018/2018-08-11.html" rel="alternate"></link><published>2018-08-11T00:00:00+08:00</published><updated>2018-08-11T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-08-11:/posts/2018/2018-08-11.html</id><summary type="html">&lt;p&gt;æ­å»ºäº†ä¸€ä¸ªè·³æ¿æœºï¼Œå¼ºåˆ¶ä½¿ç”¨å¯†é’¥å¯¹ç™»é™†æœºå™¨ï¼ŒåŒæ—¶éœ€è¦ç”¨æˆ·åœ¨æœ¬åœ°å¼€å¯&lt;code&gt;ForwardAgent&lt;/code&gt;ï¼Œè·³æ¿æœºä¸Šåˆ›å»º&lt;code&gt;SSH_AUTH_SOCK&lt;/code&gt;ï¼Œé€ä¼ ç§é’¥ã€‚ç„¶è€Œå¸¸å¸¸æœ‰ç”¨æˆ·åœ¨ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ­å»ºäº†ä¸€ä¸ªè·³æ¿æœºï¼Œå¼ºåˆ¶ä½¿ç”¨å¯†é’¥å¯¹ç™»é™†æœºå™¨ï¼ŒåŒæ—¶éœ€è¦ç”¨æˆ·åœ¨æœ¬åœ°å¼€å¯&lt;code&gt;ForwardAgent&lt;/code&gt;ï¼Œè·³æ¿æœºä¸Šåˆ›å»º&lt;code&gt;SSH_AUTH_SOCK&lt;/code&gt;ï¼Œé€ä¼ ç§é’¥ã€‚ç„¶è€Œå¸¸å¸¸æœ‰ç”¨æˆ·åœ¨æœ¬åœ°æ²¡æœ‰æ­£ç¡®é…ç½®ï¼Œå¯¼è‡´ä¸Šäº†è·³æ¿æœºä¹‹åï¼Œå†SSH å°±ä¼šå¤±è´¥ï¼Œäºæ˜¯æˆ‘åœ¨è·³æ¿æœºçš„&lt;code&gt;.bashrc&lt;/code&gt; ä¸Šå†™äº†ä¸€æ®µæ£€æµ‹è„šæœ¬ï¼Œå¦‚æœå˜é‡&lt;code&gt;$SSH_AUTH_SOCK&lt;/code&gt; ä¸å­˜åœ¨ï¼Œå°±å¼•å¯¼ç”¨æˆ·å»çœ‹Wikiï¼Œä¸è¦çƒ¦æˆ‘å•¦ï¼&lt;/p&gt;
&lt;p&gt;ç”¨äº†ä¸€æ®µæ—¶é—´ï¼Œæœ‰ç”¨æˆ·å‘ç°scp æ–‡ä»¶åˆ°è·³æ¿æœºæ—¶ä¼šå¤±è´¥ï¼ŒGoogle ä¸€ä¸‹ï¼š&lt;a href="https://stackoverflow.com/questions/12440287/scp-doesnt-work-when-echo-in-bashrc"&gt;SCP doesn't work when echo in .bashrc?&lt;/a&gt;ï¼Œæ€ä¹ˆåˆ¤æ–­å½“å‰ä¼šè¯æ˜¯scpï¼Ÿï¼š&lt;a href="https://superuser.com/questions/690735/can-i-tell-if-im-in-an-scp-session-in-my-bashrc"&gt;Can I tell if I'm in an scp session in my .bashrc?&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ”¹ä¸‹è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$PS1&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-z&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$SSH_AUTH_SOCK&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;åˆ›å»ºSSH_AUTH_SOCK å¤±è´¥ï¼&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;1.è¯·åœ¨æœ¬æœºæ‰§è¡Œ ssh-add æ·»åŠ ç§é’¥è‡³ ssh-agent&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;2.è¯·åœ¨~/.ssh/config é…ç½®ï¼šForwardAgent yes&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;è¯¦ç»†å¸®åŠ©ï¼šwiki...&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æå®šï¼&lt;/p&gt;</content><category term="2018"></category><category term="SSH"></category><category term="linux"></category></entry><entry><title>è¸©äº†Systemd 2ä¸ªå‘</title><link href="https://fangpsh.github.io/posts/2018/2018-08-10.html" rel="alternate"></link><published>2018-08-10T00:00:00+08:00</published><updated>2018-08-10T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-08-10:/posts/2018/2018-08-10.html</id><summary type="html">&lt;p&gt;æ‰‹å†™Systemd service çš„ç»éªŒä¸å¤šï¼Œéå¸¸å°´å°¬ï¼Œè¸©äº†Systemd 2ä¸ªå‘ï¼Œæµªè´¹äº†è¿‘1ä¸ªå°æ—¶ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Pythoné¡¹ç›®éƒ¨ç½²ä½¿ç”¨äº†&lt;a href="https://virtualenv.pypa.io/en/stable/"&gt;virtualenv&lt;/a&gt;ï¼Œæ·»åŠ ä¸€ä¸ªSystemd serviceï¼Œå‘ç°å¯åŠ¨å¤±è´¥ï¼Œæç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;File &amp;quot;/usr/lib64/python2.7/subprocess.py&amp;quot;, line â€¦&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;æ‰‹å†™Systemd service çš„ç»éªŒä¸å¤šï¼Œéå¸¸å°´å°¬ï¼Œè¸©äº†Systemd 2ä¸ªå‘ï¼Œæµªè´¹äº†è¿‘1ä¸ªå°æ—¶ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;Pythoné¡¹ç›®éƒ¨ç½²ä½¿ç”¨äº†&lt;a href="https://virtualenv.pypa.io/en/stable/"&gt;virtualenv&lt;/a&gt;ï¼Œæ·»åŠ ä¸€ä¸ªSystemd serviceï¼Œå‘ç°å¯åŠ¨å¤±è´¥ï¼Œæç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;File &amp;quot;/usr/lib64/python2.7/subprocess.py&amp;quot;, line 1327, in _execute_child
raise child_exception
OSError: [Errno 2] No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¿˜è®°è®¾ç½®ç¯å¢ƒäº†ï¼Œ&lt;code&gt;EnvironmentFile&lt;/code&gt; é‡Œè®¾ç½®&lt;code&gt;PATH&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;EXAMPLE_ENV=/home/www/example_env
PATH=${EXAMPLE_ENV}:$PATH
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‘ç°æ— è®ºå¦‚ä½•éƒ½æ— æ•ˆï¼ŒGoogleä¸€ä¸‹æ‰å‘ç°å‚»äº†ï¼š&lt;a href="https://stackoverflow.com/questions/35439123/systemd-environment-directive-to-set-path"&gt;systemd: â€œEnvironmentâ€ directive to set PATH&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can't use EnvVars in Environment directives. The whole Environment= will be ignored.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ”¹æˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;EXAMPLE_ENV=/home/www/example_env
PATH=/home/www/example_env/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç»ˆäºå¥½äº†ã€‚ä¸è¿‡åˆé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ExecStart=${EXAMPLE_ENV}/bin/example ....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Systemd æç¤ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Executable path is not absolute, ignoring:${EXAMPLE_ENV}/bin/example ...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å’¦ï¼Œå˜é‡æ€ä¹ˆæ²¡è§£æã€‚Google äº†ä¸‹ï¼Œæ”¹æˆä¸‹é¢è¿™æ ·å°±å¥½äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ExecStart=/usr/bin/env ${EXAMPLE_ENV}/bin/example
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd.service.html"&gt;man/systemd.service&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;For each of the specified commands, the first argument must be either an absolute path to an executable or a simple file name without any slashes.&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="2018"></category><category term="systemd"></category></entry><entry><title>ä¿®å¤Nintendo Switch Joycon æ‰‹æŸ„è‡ªåŠ¨æ¼‚ç§»é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2018/2018-06-23.html" rel="alternate"></link><published>2018-06-23T00:00:00+08:00</published><updated>2018-06-23T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-06-23:/posts/2018/2018-06-23.html</id><summary type="html">&lt;p&gt;&lt;img alt="joy-con" src="/assets/images/2023/20230306155958.jpg"&gt;&lt;br&gt;
å›¾ç‰‡æ¥æºï¼š&lt;a href="https://www.zhihu.com/question/263710934/answer/282957512"&gt;çŸ¥ä¹-è¥¿è£…æš´å¾’&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å»å¹´ä¹°çš„Switchï¼Œæœ€è¿‘å‘ç°å·¦æ‰‹æŸ„å‡ºç°è‡ªåŠ¨æ¼‚ç§»ï¼Œæ—å…‹æ—¶ä¸æ—¶è‡ªåŠ¨å¾€å·¦èµ°ã€‚æœç´¢äº†ä¸‹ï¼Œåœ¨è´´å§å’ŒçŸ¥ä¹å‘ç° â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="joy-con" src="/assets/images/2023/20230306155958.jpg"&gt;&lt;br&gt;
å›¾ç‰‡æ¥æºï¼š&lt;a href="https://www.zhihu.com/question/263710934/answer/282957512"&gt;çŸ¥ä¹-è¥¿è£…æš´å¾’&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å»å¹´ä¹°çš„Switchï¼Œæœ€è¿‘å‘ç°å·¦æ‰‹æŸ„å‡ºç°è‡ªåŠ¨æ¼‚ç§»ï¼Œæ—å…‹æ—¶ä¸æ—¶è‡ªåŠ¨å¾€å·¦èµ°ã€‚æœç´¢äº†ä¸‹ï¼Œåœ¨è´´å§å’ŒçŸ¥ä¹å‘ç°æŒºå¸¸è§çš„ï¼Œä¾‹å¦‚&lt;a href="https://www.zhihu.com/question/263710934"&gt;Nintendo Switchå·¦æ‰‹æŸ„Joy-conè‡ªåŠ¨æ¼‚ç§»é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰äººè¯´ç”¨ç³»ç»Ÿçš„æ ¡å‡†æ‘‡æ†çš„åŠŸèƒ½ï¼Œå®é™…ä¸Šæ²¡ç”¨ï¼Œé‚£ä¸ªæ ¡å‡†åªèƒ½åº”å¯¹ç”µç£å¹²æ‰°ã€‚&lt;/p&gt;
&lt;p&gt;ç½‘å‹åˆ†æåŸå› æ˜¯ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ‘‡æ†ä¸‹é¢ä¼šæœ‰ä¸€åœˆç™½è‰²çš„ç²‰æœ«ã€‚é‚£å°±æ˜¯æ‘‡æ†å’Œè¾¹ç¼˜æ‘©æ“¦é€ æˆç£¨æŸè€Œæ‰ä¸‹æ¥çš„ç²‰æœ«ã€‚è¿™æ˜¯æ— æ³•é¿å…çš„ã€‚è€Œè¿™ä¸ªç²‰æœ«å°±æ˜¯æ‘‡æ†æ¼‚ç§»çš„å…ƒå‡¶ã€‚å› ä¸ºç²‰æœ«æœ‰å¯èƒ½ä¼šé€šè¿‡æ‘‡æ†çš„ç¼éš™é£˜è¿›æ‰‹æŸ„å†…éƒ¨ï¼Œç„¶åé™„ç€åœ¨æ‘‡æ†çš„æ„Ÿåº”å…ƒä»¶ä¸Šï¼Œå¯¼è‡´è¯¯è§¦ã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„æ‘‡æ†æ¼‚ç§»ï¼Œæ‘‡æ†ä¼šä¸€ç›´å¾€åŒä¸€ä¸ªæ–¹å‘èµ°ï¼Œä¸èƒ½è‡ªåŠ¨å¤ä½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è´´å§å’ŒçŸ¥ä¹å¥½å¤šäººæ‹†æ‰‹æŸ„ï¼Œç„¶åæ¢å›½äº§çš„æ‘‡æ†æ¨¡å—ï¼Œå…¶å®å¦‚æœæ˜¯ä¸€èˆ¬çš„æ¼‚ç§»ï¼Œå®Œå…¨æ²¡å¿…è¦ã€‚æœ‰äººæåˆ°å¯ä»¥ç”¨å¹æ°”å¤§å‘ï¼Œç‰™ç­¾æŒ‘èµ·æ‘‡æ†ä¸‹é¢åŠçƒå½¢çš„æ©¡èƒ¶ï¼Œå¤§å¸ä¸€å£ï¼Œç„¶åå¹ã€‚æˆ‘è¯•äº†ä¸‹ï¼Œæœç„¶æœ‰ç‚¹å¥½ä½¿ï¼Œä¸è¿‡ä¸€æ®µæ—¶é—´ä¹‹ååˆå¤å‘ã€‚è¯æ˜äº†ç¡®å®æ˜¯ç²‰æœ«é€ æˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ç€çœ‹åˆ°è¯´å¯ä»¥å–·&lt;a href="http://www.wd40.com.cn/P_1.aspx"&gt;wd-40&lt;/a&gt;ï¼Œèƒ½æ´—å»ç°å°˜ã€‚çŸ¥ä¹æœ‰ä¸ªç­”æ¡ˆæåˆ°wd-40 ä¼šç¡¬åŒ–æ©¡èƒ¶ã€å¡‘æ–™ï¼ŒJoycon å…¨æ˜¯æ©¡èƒ¶å’Œå¡‘æ–™ï¼Œæ‰€ä»¥å…ˆå–·è“ç“¶çš„wd-40ï¼Œå†å–·ç²¾å¯†ç”µå™¨æ¸…æ´å‰‚æ´—å»wd-40ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="wd-40" src="/assets/images/2023/20230306160027.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘æŸ¥çœ‹äº†ä¸‹ç­”æ¡ˆäº†æåˆ°çš„wd-40ç²¾å¯†ä»ªå™¨æ¸…æ´å‰‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="wd-40-specialist" src="/assets/images/2023/20230306160044.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å’¦ï¼Œæœ‰æ¸…æ´åŠŸèƒ½å‘€ï¼Œè€Œä¸”æ³¨æ˜äº†å¯ç”¨äºæ©¡èƒ¶ã€å¡‘æ–™ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="wd40" src="/assets/images/2023/20230306160057.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å…ˆå–·è“ç“¶wd-40 æ˜¯ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾å‘¢ã€‚é‚£å°±ä¹°é»‘ç“¶çš„wd-40è¯•ä¸€è¯•ã€‚äº¬ä¸œè‡ªè¥æ²¡è´§ï¼Œåªèƒ½å»æ·˜å®æ‰¾ï¼Œæ·˜å®ä»·æ ¼éƒ½åœ¨41 å·¦å³ï¼Œå‘ç°æœ‰&lt;a href="https://m.tb.cn/h.eYWcgVg"&gt;ä¸€å®¶&lt;/a&gt;è¿˜å¯ä»¥é¢†-3å—é’±ä»£é‡‘åˆ¸+åŒ…é‚®ï¼Œé”€é‡è¿˜å¾ˆé«˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://m.tb.cn/h.eYWcgVg"&gt;&lt;img alt="wd-40-shop" src="/assets/images/2023/20230306160149.jpg"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;çœ‹ç“¶ä½“è¯´æ˜ä¼¼ä¹å¯¹äººä½“æœ‰å®³ï¼Œä¸è¿‡æŒ¥å‘æ€§å¥½ï¼Œå¦‚æœåœ¨å®¤å†…çš„è¯å–·ï¼Œå»ºè®®æ‰“å¼€é£æ‰‡ã€‚å–·å‰æ‘‡åŒ€ï¼Œç„¶åæ­èµ·æ‘‡æ†ä¸‹çš„æ©¡èƒ¶çš®ï¼Œå–·ä¸€å‘ï¼Œè½¬å‡ åœˆæ‘‡æ†ï¼Œç­‰å‡ åˆ†é’ŸæŒ¥å‘å¹²å‡€ã€‚&lt;/p&gt;
&lt;p&gt;æœç„¶å¥½äº†ï¼æ—å…‹ç»ˆäºä¸ä¼šè‡ªåŠ¨è·³å´–äº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çŒœæµ‹æ¸…ç†å®Œä¸€æ¬¡ä¹‹åï¼Œä»¥åå¯èƒ½è¿˜ä¼šå‡ºç°ç²‰æœ«å¯¼è‡´æ¼‚ç§»ï¼Œä¸è¿‡è¿™ä¸€ç“¶360ml åº”è¯¥å¤Ÿç”¨äº†ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="nintendo"></category></entry><entry><title>ã€Šæ—¶é—´ç®¡ç†--ç»™ç³»ç»Ÿç®¡ç†å‘˜ã€‹è¯»ä¹¦ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2018/2018-06-04.html" rel="alternate"></link><published>2018-06-04T00:00:00+08:00</published><updated>2018-06-04T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-06-04:/posts/2018/2018-06-04.html</id><summary type="html">&lt;p&gt;&lt;img alt="s2917003" src="https://img2.doubanio.com/view/subject/s/public/s2917003.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¬è¯´&lt;a href="https://book.douban.com/subject/2253513/"&gt;è¿™æœ¬ä¹¦&lt;/a&gt;æ˜¯2å¹´å‰ï¼Œæœ€è¿‘æ‰æƒ³èµ·çœ‹ï¼Œé€›äº†ä¸‹äº¬ä¸œäºšé©¬é€Šï¼Œå…¨éƒ¨æ²¡è´§ï¼Œæ·˜å®ä¸Šå€’æ˜¯æœ‰ä¸å°‘ç¿»å°çš„ç›—ç‰ˆã€‚07å¹´å‡ºç‰ˆçš„ï¼Œå·²ç»åå¹´å‰äº†ï¼Œè€Œæœ¬ä¹¦çš„å†… â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="s2917003" src="https://img2.doubanio.com/view/subject/s/public/s2917003.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¬è¯´&lt;a href="https://book.douban.com/subject/2253513/"&gt;è¿™æœ¬ä¹¦&lt;/a&gt;æ˜¯2å¹´å‰ï¼Œæœ€è¿‘æ‰æƒ³èµ·çœ‹ï¼Œé€›äº†ä¸‹äº¬ä¸œäºšé©¬é€Šï¼Œå…¨éƒ¨æ²¡è´§ï¼Œæ·˜å®ä¸Šå€’æ˜¯æœ‰ä¸å°‘ç¿»å°çš„ç›—ç‰ˆã€‚07å¹´å‡ºç‰ˆçš„ï¼Œå·²ç»åå¹´å‰äº†ï¼Œè€Œæœ¬ä¹¦çš„å†…å®¹æ„Ÿè§‰æ›´è€ã€‚ä½œè€…åˆ›ä½œè¿™æœ¬ä¹¦çš„æ—¶å€™ï¼ŒIBM è¿˜å¦‚æ—¥ä¸­å¤©ï¼ŒNetflix è¿˜åœ¨å‡ºç§ŸDVD å…‰ç›˜ğŸ’¿ å‘¢ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æƒ³çœ‹è¿™ä¹¦çš„å¤§å¤šæ•°éƒ½æ˜¯è¿ç»´åŒå­¦ï¼Œç„¶è€Œä»Šå¤©çš„è¿ç»´ï¼Œå·²ç»å’Œä½œè€…ä¹¦ä¸­çš„ç³»ç»Ÿç®¡ç†å‘˜çš„å·¥ä½œå†…å®¹å¤§ä¸ä¸€æ ·ã€‚ä½œè€…æ‰€åšçš„å·¥ä½œå†…å®¹ï¼Œä¸€å°éƒ¨åˆ†åœ¨å¦‚ä»Šä¹Ÿå·²ç»å½’å…¥åˆ°IT æ”¯æŒä¸€ç±»çš„èŒä½ä¸­äº†ã€‚ä¸è¿‡ä»Šå¤©çš„è¿ç»´ä¾ç„¶è¦é¢å¯¹ä¸€å †çäº‹ï¼Œä¸æ–­è¢«æ‰“æ–­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šå¤§å­¦çš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡å¬è¯´æ—¶é—´ç®¡ç†ã€&lt;a href="https://zh.wikipedia.org/wiki/å°½ç®¡å»åš"&gt;GTD&lt;/a&gt;ï¼Œæ˜¯ä»&lt;a href="https://miao.hu"&gt;Mapleå¸ˆå…„&lt;/a&gt;å£ä¸­ã€‚å·¥ä½œä¹‹åï¼Œæ¥è§¦å’Œå°è¯•äº†ä¸€äº›æ–¹æ³•ï¼Œç†è®ºï¼Œå·¥å…·ï¼Œä¸€ç›´è§‰å¾—æŒºç´¯çš„ã€‚å¦‚æœæˆ‘èŠ±é‚£ä¹ˆå¤§ç²¾åŠ›å»ç¼–æ’ï¼Œå»å­¦ä¹ ï¼Œå»åšæ—¶é—´ç®¡ç†ï¼Œæ˜¯ä¸æ˜¯æœ¬æœ«å€’ç½®äº†ï¼Ÿå°è¯•äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œæ—¥å¸¸åªä¼šåœ¨Reminders Appé‡Œé¢ç®€å•çš„è®°å½•ï¼Œæˆ–è€…åœ¨ç¬”è®°è½¯ä»¶å»ºä¸€é¡µ[TODO]æ ‡è®°æœªå®Œæˆçš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œæˆ‘å‘ç°ï¼Œæ›¾ç»å»å­¦ä¹ çš„ä¸€äº›æ–¹æ³•ï¼Œå·¥å…·ç»™æˆ‘ç•™ä¸‹äº†ä¸€äº›çœ‹èµ·æ¥è¿˜ä¸é”™çš„ä¹ æƒ¯ï¼Œä¾‹å¦‚å®‰æ’ä¼˜å…ˆçº§ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§åšäº‹ï¼›ä¼˜å…ˆå®Œæˆç®€å•å¿«é€Ÿçš„äº‹æƒ…ï¼›æ‹†åˆ†ä»»åŠ¡ï¼Œæ›´å¥½çš„è§„åˆ’è¿›åº¦ï¼›ç»´æŒTODO çŸ­ã€å°‘ï¼Œå…‹æœæ‹–å»¶ã€‚å¦å¤–å­¦ä¹ æ—¶é—´ç®¡ç†çš„è¿‡ç¨‹ï¼Œè¿˜è®©æˆ‘æ„è¯†åˆ°ä¸“æ³¨çš„é‡è¦æ€§ã€‚é¢‘ç¹æŸ¥é‚®ä»¶ã€å„ç±»IMå·¥å…·æŒ‚æœºã€å·¥ä½œæœŸé—´åˆ·è®ºå›ã€è¾¹å¬éŸ³ä¹è¾¹å·¥ä½œè¿™äº›ä¹ æƒ¯ï¼Œä¼šè®©å¤§è„‘é¢‘ç¹è¿›å…¥â€œä¸Šä¸‹æ–‡åˆ‡æ¢â€ï¼Œæ•ˆç‡å¤§å¤§é™ä½ï¼Œæ—¶é—´ä¸çŸ¥ä¸è§‰æºœèµ°ã€‚æ‰€ä»¥ï¼Œå¥½åƒä¹Ÿä¸æ˜¯æœ¬æœ«å€’ç½®å˜›ï¼Ÿæ‰€è°“æ—¶é—´ç®¡ç†ã€GTDã€å„ç±»å·¥ä½œæ³•ï¼Œå¯èƒ½åªæ˜¯ä¸ºäº†è®©å¤§å®¶å…»æˆæ›´å¥½çš„ä¹ æƒ¯ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦è¿˜æ˜¯éå¸¸å€¼å¾—ä¸€è¯»ï¼Œçœ‹çœ‹ä½œè€…æ˜¯æ€ä¹ˆåº”ä»˜ç¹å¤æ— æ¯”çš„ä¸Šå¤SA çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;å»ºç«‹å…±åŒå¹²æ‰°é˜²çº¿&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸åŒäº‹å®‰æ’å…±åŒå¹²æ‰°é˜²çº¿ï¼Œä»¥ä¾¿ä½ å¿…é¡»å®Œæˆé¡¹ç›®æ—¶å€™è®©åˆ«äººçš„å¹²æ‰°è½¬å‘ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é™¤äº†åšå¥½è‡ªåŠ¨åŒ–ï¼Œå‡å°‘ç¹å¤çš„å·¥ä½œï¼Œè¿ç»´è¿˜æ˜¯ä¼šè¢«ä¸æ–­çš„æ‰“æ–­ï¼Œæˆ‘ä»¬è¿˜æƒ³æœ‰ç™¾åˆ†ä¹‹äº”åçš„æ—¶é—´å†™ä»£ç å‘¢ï¼æ€ä¹ˆåŠï¼Ÿå®‰æ’oncall è½®å€¼ã€‚ä½œè€…è¿™æ¡æŒ‡å¯¼ï¼Œå’Œä»Šå¤©çš„oncall è½®å€¼ä¸è°‹è€Œåˆã€‚å½“ç„¶ï¼Œå®‰æ’oncallï¼Œè¿˜æœ‰æ›´å¤šå¥½å¤„ï¼Œä¾‹å¦‚ä¼šæ¨åŠ¨å¤§å®¶æ¢³ç†æ–‡æ¡£ï¼Œå·¥ä½œäº¤æ¥æ›´æ¸…æ™°ï¼Œç»„å‘˜å¯¹æ•´ä½“çš„å·¥ä½œæ›´ç†Ÿæ‚‰ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h2&gt;å°†è„‘åŠ›ç•™ç»™æœ€é‡è¦çš„äº‹&lt;/h2&gt;
&lt;p&gt;å°è¯•ä½¿ç”¨å„ç±»æ—¶é—´ç®¡ç†ã€GTDçš„å·¥å…·ï¼ŒçœŸä¸è¡Œï¼Œç”¨ä¸ªè®°äº‹æœ¬ä¹Ÿæˆã€‚ä¸è¿‡è®°ä½è¦ä¿æŒtodo list å°½é‡çš„çŸ­ï¼Œå¦‚æœå †ç§¯ï¼Œå°±æ˜¯ç¾éš¾ï¼Œä½ ä¼šæ›´æ²¡æ¿€æƒ…å»å®Œæˆã€‚&lt;/p&gt;
&lt;h2&gt;ä¸ºå…¶ä»–çš„äººç®¡ç†äº‹é¡¹&lt;/h2&gt;
&lt;p&gt;ä¾‹å¦‚åˆ«äººæ¥æ‰¾ä½ çš„æ—¶å€™ï¼Œå¦‚æœä¸æ˜¯éå¸¸ç´§æ€¥çš„äº‹æƒ…ï¼Œå¯ä»¥å‘ŠçŸ¥ä»–ä½ åœ¨ä»€ä¹ˆæ—¶å€™ä¼šåšï¼Œå¹¶ä¸”å‘Šè¯‰ä»–ä½ è®°å½•ä¸‹æ¥äº†ï¼Œç”šè‡³å¯ä»¥ç»™ä»–çœ‹ä½ TODO list ä¸Šä¸ºä»–åˆ›å»ºçš„è®°å½•ã€‚ä¹‹å‰åœ¨è…¾è®¯å·¥ä½œæ—¶å€™ï¼Œæˆ‘å‘ç°ï¼Œæœ‰æ—¶å€™æˆ‘ç¡®å®å¿™ä¸å¼€ï¼Œå¹¶ä¸”è¿™æ ·åšäº†ï¼Œå‘Šè¯‰SNG çš„åŒäº‹æˆ‘è®°å½•ä¸‹äº†ï¼Œä»–ä»¬ä¼šè¡¨ç¤ºéå¸¸ç†è§£ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªæ˜¯å§”æ´¾ç»™ä»–ä»¬çš„äº‹æƒ…ï¼Œä¹Ÿéœ€è¦è®°å½•ä¸‹æ¥ï¼å¯¹æ–¹å¹¶ä¸ä¸€å®šä¼šåšæ—¶é—´ç®¡ç†ï¼Œå¦‚æœè¦ä¿è¯ä½ å§”æ´¾çš„äº‹æƒ…é¡ºåˆ©æ¨è¿›ï¼Œæœ€å¥½ä¹Ÿåšå¥½è®°å½•ï¼Œè·Ÿè¸ªã€‚&lt;/p&gt;
&lt;h2&gt;ä¾‹è¡Œå…¬äº‹&lt;/h2&gt;
&lt;p&gt;ä½œè€…æŒ‡çš„ä¸€éƒ¨åˆ†æ˜¯å…»æˆä¹ æƒ¯ï¼Œå‡å°‘å‡ºé”™ï¼Œä¸è¦æµªè´¹ç²¾åŠ›ã€‚å¦å¤–ä¸€ç‚¹æˆ‘è§‰å¾—æŒºå¥½çš„ï¼Œå°±æ˜¯å’Œä¸Šå¸ã€åŒäº‹å®šæœŸæ²Ÿé€šï¼Œé™¤äº†å‘¨æŠ¥ä¹‹å¤–ï¼ŒæŒ‘ä¸ªæ—¶é—´å®šæœŸæ²Ÿé€šï¼ŒæŒºæœ‰æ„ä¹‰çš„ï¼Œæ— è®ºæ˜¯äº‹æƒ…æ¨è¿›ï¼Œè¿˜æ˜¯å·¥ä½œè€ƒæ ¸ç­‰æ–¹é¢ã€‚å¹¶ä¸”å¦‚æœæ˜¯å®šæœŸæ²Ÿé€šçš„ï¼Œä¹Ÿå¯ä»¥è®©ä½ çš„leader æˆ–è€…åŒäº‹å…»æˆè¿™ä¸ªä¹ æƒ¯:Pã€‚&lt;/p&gt;
&lt;h2&gt;å¾ªç¯ç³»ç»Ÿ&lt;/h2&gt;
&lt;p&gt;åé¢ä¸‰~ä¸ƒç« ï¼Œä½œè€…éƒ½åœ¨è¯´ä»–å‘æ˜çš„å¾ªç¯ç³»ç»Ÿï¼Œå¯èƒ½æœ‰æ„ä¹‰ï¼Œä¸è¿‡æˆ‘è§‰å¾—æ²¡å•¥æ„æ€ï¼Œå¯èƒ½æˆ‘è¿˜æ˜¯éš¾ä»¥å…»æˆè¿™æ ·çš„ä¹ æƒ¯ã€‚&lt;/p&gt;
&lt;h2&gt;ä¼˜å…ˆçº§&lt;/h2&gt;
&lt;p&gt;ä¸è¦æˆä¸ºä¸Šå¸è¾ƒå¤§é¡¹ç›®å»¶è¿Ÿçš„åŸå› æ‰€åœ¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç®¡ç†ä½ çš„ä¸Šå¸ï¼Œä½ å¿…é¡»åšä¸‰ä»¶äº‹ï¼šç¡®å®šä¸Šå¸çŸ¥é“ä½ çš„èŒæ¶¯ç›®æ ‡ï¼Œåªæœ‰å½“èƒ½å–„ç”¨ä»–çš„èŒæƒæ—¶æ‰ä½¿ç”¨å¾€ä¸Šå§”æ´¾ï¼Œä»¥åŠäº†è§£ä»–çš„ç›®æ ‡å¹¶æˆä¸ºå®Œæˆé‚£äº›ç›®æ ‡çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æŒºæœ‰é“ç†çš„ï¼Œä¸è¿‡å¥½åƒæœ‰ç‚¹è¶‹ç‚é™„åŠ¿ï¼Ÿåœ†æ»‘ä¸–æ•…ï¼Ÿ&lt;/p&gt;
&lt;h2&gt;æ’é™¤æµªè´¹æ—¶é—´çš„äº‹æƒ…&lt;/h2&gt;
&lt;p&gt;ä¸åˆ°ä¸ºä»€ä¹ˆåŠå…¬å®¤æ€»æ˜¯æœ‰äººåœ¨ä¸æ–­çš„é—²èŠï¼Œå¯¼è‡´æˆ‘å¸¸å¸¸å¾—æˆ´ç€é™å™ªè€³æœºã€‚ä¸æ–­çš„é—²èŠä¸ä»…æµªè´¹å‚ä¸è€…çš„æ—¶é—´ï¼Œè¿˜å¹²æ‰°é™„è¿‘å·¥ä½çš„åŒäº‹ã€‚&lt;/p&gt;
&lt;h2&gt;è¯´æ˜æ–‡ä»¶ã€è‡ªåŠ¨åŒ–&lt;/h2&gt;
&lt;p&gt;å»ºç«‹Wiki ç³»ç»Ÿï¼Œè¿™åœ¨ä»Šå¤©éå¸¸å¸¸è§ï¼Œä¸è¿‡ç»´æŠ¤å¥½Wikiï¼Œå¥½å¥½å†™æ–‡æ¡£ï¼Œä¾ç„¶è¿˜æ˜¯å°‘è§çš„ã€‚è‡ªåŠ¨åŒ–ï¼Œåšè¿ç»´çš„éƒ½æ‡‚ï¼Œä»Šå¤©å¤§å®¶åšçš„ï¼Œä¹Ÿä¸ä»…ä»…æ˜¯ä¹¦ä¸­é‚£ç§åˆçº§çš„è‡ªåŠ¨åŒ–ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªæ”¶è·ï¼Œå°±æ˜¯çŸ¥é“äº†RAID (Redundant Array of Independent Disks, originally Redundant Array of Inexpensive Disks)ï¼Œä¸€å¼€å§‹æ˜¯æŒ‡å»‰ä»·ç£ç›˜å†—ä½™é˜µåˆ—ï¼Œåæ¥æ‰å˜æˆç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—ï¼Œè§ï¼š&lt;a href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/1987/CSD-87-391.pdf"&gt;A Case for Redundant Arrays of Inexpensive Disks (RAID)&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="book"></category><category term="gtd"></category></entry><entry><title>OpenLDAP çš„SSHA</title><link href="https://fangpsh.github.io/posts/2018/2018-05-07.html" rel="alternate"></link><published>2018-05-07T00:00:00+08:00</published><updated>2018-05-07T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-05-07:/posts/2018/2018-05-07.html</id><summary type="html">&lt;p&gt;&lt;img alt="LDAPworm.gif" src="/assets/images/2023/20230301161613.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘æŠ˜è…¾äº†ä¸€ä¸‹&lt;a href="https://www.openldap.org"&gt;OpenLDAP&lt;/a&gt;ï¼Œå¯†ç ç”¨çš„å“ˆå¸Œç®—æ³•æ˜¯SSHAï¼ŒSSHA å…¶å®å°±æ˜¯åŠ ç›çš„&lt;a href="https://zh.wikipedia.org/zh/SHA-1"&gt;SHA1&lt;/a&gt;ï¼š&lt;code&gt;salted SHA1&lt;/code&gt;ï¼ŒåŠ ç›å¢åŠ äº†åˆ©ç”¨å½©è™¹è¡¨ç¢°æ’çš„éš¾åº¦ã€‚&lt;/p&gt;
&lt;p&gt;æ‘˜ä¸€æ®µå®˜ç½‘&lt;a href="https://www.openldap.org/faq/data/cache/347.html"&gt;FAQ â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="LDAPworm.gif" src="/assets/images/2023/20230301161613.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘æŠ˜è…¾äº†ä¸€ä¸‹&lt;a href="https://www.openldap.org"&gt;OpenLDAP&lt;/a&gt;ï¼Œå¯†ç ç”¨çš„å“ˆå¸Œç®—æ³•æ˜¯SSHAï¼ŒSSHA å…¶å®å°±æ˜¯åŠ ç›çš„&lt;a href="https://zh.wikipedia.org/zh/SHA-1"&gt;SHA1&lt;/a&gt;ï¼š&lt;code&gt;salted SHA1&lt;/code&gt;ï¼ŒåŠ ç›å¢åŠ äº†åˆ©ç”¨å½©è™¹è¡¨ç¢°æ’çš„éš¾åº¦ã€‚&lt;/p&gt;
&lt;p&gt;æ‘˜ä¸€æ®µå®˜ç½‘&lt;a href="https://www.openldap.org/faq/data/cache/347.html"&gt;FAQ&lt;/a&gt;çš„perlä»£ç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#! /usr/bin/perl&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# This small script generates an Seeded SHA1 hash of &amp;#39;secret&amp;#39;&lt;/span&gt;
&lt;span class="c1"&gt;# (using the seed &amp;quot;salt&amp;quot;) for use as a userPassword or rootpw value.&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;Digest::SHA1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;use&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;MIME::Base64&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;$ctx&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nn"&gt;Digest::SHA1&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="nv"&gt;$ctx&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;secret&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nv"&gt;$ctx&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;add&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;salt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nv"&gt;$hashedPasswd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;{SSHA}&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;encode_base64&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$ctx&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;digest&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;salt&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;#39;userPassword: &amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nv"&gt;$hashedPasswd&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;\n&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿‡ç¨‹å¾ˆç®€å•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;#39;{SSHA}&amp;#39; + base64_encode( SHA1(password + salt) + salt )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨OpenLDAP æä¾›çš„&lt;code&gt;slappasswd&lt;/code&gt; ç”Ÿæˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;slappasswd -h {SSHA} -s password

&amp;#39;{SSHA}0c0blFTXXNuAMHECS4uxrj3ZieMoWImr&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;éœ€è¦æ³¨æ„OpenLDAP SSHA çš„salt é•¿åº¦é»˜è®¤ä¸º4ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Python å¯ä»¥ç›´æ¥ç”¨PassLib è¿™ä¸ªåº“ï¼Œ&lt;a href="http://passlib.readthedocs.io/en/stable/lib/passlib.hash.ldap_std.html#passlib.hash.ldap_salted_sha1"&gt;class passlib.hash.ldap_salted_sha1&lt;/a&gt;ï¼Œç®€å•å¿«æ·ï¼Œä¹Ÿæœ‰å¯¹åº”çš„
verify å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;ğŸŒ° ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;passlib.hash&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;ldap_salted_sha1&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;ssha&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;encrypt_password&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;ssha&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;salt_size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;verify_password&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;password_hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get_user&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;ssha&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;verify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;password&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;password_hash&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;åœ¨ç»™&lt;a href="http://walle-web.io"&gt;walle&lt;/a&gt; æ·»åŠ LDAP æ”¯æŒçš„æ—¶å€™ï¼Œå‘ç°æ— è®ºå¦‚ä½•éƒ½æ˜¯ç”¨æˆ·åå’Œå¯†ç ä¸ä¸€è‡´ï¼Œè€å¿ƒçœ‹äº†ä¸‹ä»£ç ï¼Œå‘ç°ä½œè€…&lt;a href="https://github.com/meolu/walle-web/blob/03a8d848f398103a097bb79a1c4004062ec83705/models/LdapUser.php#L82,L90"&gt;å†™é”™äº†&lt;/a&gt;ï¼Œä¼¼ä¹æ˜¯ç›´æ¥æŠ„çš„phpldapadmin çš„&lt;a href="https://github.com/leenooks/phpLDAPadmin/blob/708bc5ed83cc92f42ec10ae621b39a799c0e3a61/lib/functions.php#L2199,L2209"&gt;ä»£ç &lt;/a&gt;ğŸŒšğŸŒï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;public function validatePassword($password) {
    $encryptionType = strstr(substr($this-&amp;gt;_password, 1), &amp;#39;}&amp;#39;, true);
    return self::generate_password($password, $encryptionType) == $this-&amp;gt;_password;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;generate_password&lt;/code&gt; é‡Œé¢ç”¨éšæœºçš„salt ç”Ÿæˆäº†ä¸€ä¸ªhashï¼Œæ¥æ ¡éªŒï¼Œæ€ä¹ˆå¯èƒ½ä¼šä¸€æ ·å˜›ã€‚è‡ªå·±æ”¹äº†æœ¬åœ°çš„ä»£ç ï¼Œæäº†ä¸€ä¸ª&lt;a href="https://github.com/meolu/walle-web/issues/426"&gt;issue&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯å–å‡ºuserPassword çš„saltï¼Œå’Œç”¨æˆ·è¾“å…¥çš„å¯†ç ç”Ÿæˆhashï¼Œå†åšå¯¹æ¯”ï¼Œå‚è€ƒ&lt;a href="https://github.com/leenooks/phpLDAPadmin/blob/708bc5ed83cc92f42ec10ae621b39a799c0e3a61/lib/functions.php#L2297,L2313"&gt;case ssha&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="x"&gt;case &amp;#39;ssha&amp;#39;:&lt;/span&gt;
&lt;span class="x"&gt;   # Check php mhash support before using it&lt;/span&gt;
&lt;span class="x"&gt;   if (function_exists(&amp;#39;mhash&amp;#39;)) {&lt;/span&gt;
&lt;span class="x"&gt;       $hash = base64_decode($cryptedpassword);&lt;/span&gt;

&lt;span class="x"&gt;       # OpenLDAP uses a 4 byte salt, SunDS uses an 8 byte salt - both from char 20.&lt;/span&gt;
&lt;span class="x"&gt;       $salt = substr($hash,20);&lt;/span&gt;
&lt;span class="x"&gt;       $new_hash = base64_encode(mhash(MHASH_SHA1,$plainpassword.$salt).$salt);&lt;/span&gt;

&lt;span class="x"&gt;       if (strcmp($cryptedpassword,$new_hash) == 0)&lt;/span&gt;
&lt;span class="x"&gt;           return true;&lt;/span&gt;
&lt;span class="x"&gt;       else&lt;/span&gt;
&lt;span class="x"&gt;           return false;&lt;/span&gt;
&lt;span class="x"&gt;    } else {&lt;/span&gt;
&lt;span class="x"&gt;        error(_(&amp;#39;Your PHP install does not have the mhash() function. Cannot do SHA hashes.&amp;#39;),&amp;#39;error&amp;#39;,&amp;#39;index.php&amp;#39;);&lt;/span&gt;
&lt;span class="x"&gt;        }&lt;/span&gt;

&lt;span class="x"&gt;break;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;æ–°çš„ä¸€å‘¨åˆå¼€å§‹å’¯ğŸ˜† ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="openldap"></category></entry><entry><title>å¦‚ä½•æ­å»ºä¸€ä¸ªé«˜åŒ¿åçš„å†…éƒ¨è®ºå›</title><link href="https://fangpsh.github.io/posts/2018/2018-04-25.html" rel="alternate"></link><published>2018-04-25T00:00:00+08:00</published><updated>2018-04-25T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-04-25:/posts/2018/2018-04-25.html</id><summary type="html">&lt;p&gt;å…¥èŒè…¾è®¯çš„æ—¶å€™ï¼ŒåŒå­¦ä»¬ç»™æˆ‘æ¨èäº†ä¸€ä¸ªAppï¼š&lt;a href="http://tongshiapp.com"&gt;åŒäº‹&lt;/a&gt;ï¼Œ
è¿™ä¸ªApp ä¸ºåŒäº‹ä¹‹é—´æä¾›äº†åŒ¿åäº¤æµçš„å¹³å°ï¼Œå„ç§é«˜å‹çº¿ã€æ±¡ç§½è‰²æƒ…çš„ä¿¡æ¯ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å…¥èŒè…¾è®¯çš„æ—¶å€™ï¼ŒåŒå­¦ä»¬ç»™æˆ‘æ¨èäº†ä¸€ä¸ªAppï¼š&lt;a href="http://tongshiapp.com"&gt;åŒäº‹&lt;/a&gt;ï¼Œ
è¿™ä¸ªApp ä¸ºåŒäº‹ä¹‹é—´æä¾›äº†åŒ¿åäº¤æµçš„å¹³å°ï¼Œå„ç§é«˜å‹çº¿ã€æ±¡ç§½è‰²æƒ…çš„ä¿¡æ¯ç»œç»ä¸ç»ï¼Œç›¸å½“åˆºæ¿€ã€‚  &lt;/p&gt;
&lt;p&gt;è¿™ä¸ªApp 17å¹´åæœŸå°±å‡ºç°HTTPS è¯ä¹¦è¿‡æœŸã€çŸ­ä¿¡é€šé“æ¬ è´¹æ”¶ä¸åˆ°çŸ­ä¿¡ç­‰é—®é¢˜ï¼Œçœ‹èµ·æ¥è¦å€’é—­ã€‚æœ‰æ—¶å€™åœ¨æƒ³å¦‚æœè¦æ­å»ºä¸€ä¸ªæ›¿ä»£å“ï¼Œè¯¥å¦‚ä½•å¹³è¡¡åŒ¿åæ€§ï¼Œåˆèƒ½éªŒè¯æ˜¯è…¾è®¯å‘˜å·¥ï¼Œæˆ‘ä¼šæ€ä¹ˆåšï¼Œæœ€åæƒ³äº†ä¸€ä¸ªæŠ˜ä¸­çš„åŠæ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="tongshiApp" src="/assets/images/2023/20230301165344.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‰æï¼šå‘˜å·¥ä¸ä¿¡ä»»è®ºå›ç®¡ç†å‘˜ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;é‚®ä»¶åˆ—è¡¨&lt;/h2&gt;
&lt;p&gt;ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯é€šè¿‡é‚®ä»¶åˆ—è¡¨ï¼Œå› ä¸ºé‚®ç®±è¿˜èƒ½åŒ¿åæ³¨å†Œï¼Œè€Œä¸”æœ‰å„ç§å„æ ·çš„ç§»åŠ¨å®¢æˆ·ç«¯ã€‚æ€ä¹ˆéªŒè¯å‘˜å·¥èº«ä»½ï¼Ÿæ— è®ºæ˜¯å·¥ä½œé‚®ç®±å‘éªŒè¯ç è¿˜æ˜¯ä»€ä¹ˆï¼Œåªè¦æ¶‰åŠå‘˜å·¥å·¥ä½œé‚®ç®±ï¼ŒæœåŠ¡ç«¯å°±æœ‰å¯èƒ½è®°å½•å¯¹åº”å…³ç³»ã€‚æˆ–è€…é€šè¿‡é‚€è¯·åˆ¶åº¦ï¼Ÿåˆæ„Ÿè§‰ä¸å¤Ÿæ”¶æ•›ã€‚åšä¸€ä¸ªç½‘ç«™ï¼Œåªæœ‰å†…ç½‘å¯ä»¥è®¿é—®ï¼Œç„¶åæ¯æ—¥ç”Ÿæˆé‚€è¯·ç ï¼ŸBingoï¼Œçªç„¶æƒ³åˆ°å¯ä»¥é™åˆ¶æ³¨å†Œçš„æ¥æºï¼Œé™åˆ¶å†…ç½‘æ³¨å†Œå³å¯ã€‚&lt;/p&gt;
&lt;h2&gt;Flarum&lt;/h2&gt;
&lt;p&gt;æ²¡åšé‚®ä»¶åˆ—è¡¨ï¼ŒåŸºäº&lt;a href="http://flarum.org"&gt;Flarum&lt;/a&gt;å¼€å§‹æ­å»ºã€‚&lt;/p&gt;
&lt;p&gt;åŸŸåï¼šå…è´¹çš„.tk åŸŸåç©ä¸€ç©ï¼Œå¼€éšç§ä¿æŠ¤ï¼Œtongshi.tkã€‚&lt;br&gt;
æœåŠ¡å™¨åœ°å€éšè—ï¼šcloudflare å…è´¹CDNï¼Œå…¨ç«™å¼€å¯ã€‚  &lt;/p&gt;
&lt;p&gt;æ”¶é›†è…¾è®¯å†…ç½‘å‡ºå£çš„IP åœ°å€èŒƒå›´ï¼Œä¸‰ä¸ªæ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;14.17.22.0/24
103.7.28.0/22
103.7.29.0/24
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¼€å¯HTTPS æ”¯æŒï¼Œé˜²æ­¢åœ¨å…¬å¸å†…ç½‘è®¿é—®ï¼Œè¢«ä¸­é—´äººç›‘å¬ ğŸ™ˆ  ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºä½¿ç”¨äº†CloudFlare åšå…¨ç«™CDNï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæ²¡æ³•æ ¡éªŒå®¢æˆ·ç«¯IPï¼Œ2ä¸ªè§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å‡çº§CloudFlare å¥—é¤ï¼Œä½¿ç”¨&lt;a href="https://support.cloudflare.com/hc/en-us/articles/115001595131-How-do-I-Lockdown-URLs-in-Cloudflare-"&gt;Zone lockdown&lt;/a&gt;åŠŸèƒ½ã€‚
&lt;img alt="cloudflare_zone_lockdown" src="/assets/images/2023/20230301165404.png"&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CloudFlare ä¼šæŠŠå®¢æˆ·ç«¯IP æ”¾åœ¨ &lt;code&gt;$http_cf_connecting_ip&lt;/code&gt; å¤´é‡Œé¢ï¼Œåœ¨Nginx é‡Œé¢æ ¡éªŒä¸€ä¸‹è¿™ä¸ªå¤´ã€‚å‚è€ƒï¼š&lt;a href="https://support.cloudflare.com/hc/en-us/articles/200170706-How-do-I-restore-original-visitor-IP-with-Nginx-"&gt;How do I restore original visitor IP with Nginx?&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;map $http_cf_connecting_ip $allowed {
    default deny;
    ~\s*14.17.22.*$ allow;
    ~\s*103.7.28.*$ allow;
    ~\s*103.7.29.*$ allow;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¼ªé€ è¿™ä¸ªå¤´ï¼Œæ— æ•ˆï¼Œè¿˜æ˜¯ä¼šè¢«CloudFlare é‡å†™ä¸ºæ­£ç¡®çš„å®¢æˆ·ç«¯IPã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…æ’ä»¶&lt;a href="https://gitlab.com/ReDevelopers/ReFlar/user-management"&gt;reflar/user-management&lt;/a&gt;ï¼Œå…³é—­é‚®ç®±æ³¨å†Œã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Disable email registration
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨æ³¨å†Œæ¥å£ä¸Šé™åˆ¶ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;location /api/reflar/usermanagement/register {
    if ( $allowed = &amp;#39;deny&amp;#39; ) {
        return 403;
    }
    try_files $uri $uri/ /api.php?$query_string;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æå®šã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="tongshi-tk" src="/assets/images/2023/20230301165416.png"&gt;&lt;/p&gt;
&lt;p&gt;è¯•éªŒä¸€ä¸‹æƒ³æ³•ï¼Œè¿‡ä¸‰å¤©è¿™å°æœºå™¨å°±åˆ°æœŸï¼Œå…³äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸€ä¸‹æ€è·¯ï¼Œé€šè¿‡åŠå…¬ç½‘å‡ºå£IP åšæ³¨å†Œé™åˆ¶ï¼Œè¾ƒå®½æ¾çš„å‘˜å·¥è®¤è¯æ‰‹æ®µï¼Œåˆä¿è¯äº†ä¸€å®šçš„åŒ¿åæ€§ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶å¦‚æœå…¬å¸è‡ªå·±æ„¿æ„åšçš„è¯ï¼Œåœ¨å†…ç½‘æ­å°±éå¸¸ç®€å•äº†ã€‚ç„¶è€Œè¿™ä¸œè¥¿å¯¹äºå…¬å¸æ¥è¯´æ˜¯æ´ªæ°´çŒ›å…½ï¼Œå®¡æŸ¥è¿˜æ¥ä¸åŠã€‚è…¾è®¯å†…ç½‘çš„ä¹é—®æœ‰åŒ¿åå‘å¸–åŠŸèƒ½ï¼Œç„¶è€Œåˆæœ‰å‡ ä¸ªäººä¿¡ä»»åŒ¿åçš„å®‰å…¨æ€§å‘¢ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="flarum"></category></entry><entry><title>è®°ä¸€æ¬¡æ— æ¯”å¿ƒç´¯çš„ä¸ªç¨ç”³æŠ¥è¿‡ç¨‹</title><link href="https://fangpsh.github.io/posts/2018/2018-03-20.html" rel="alternate"></link><published>2018-03-20T00:00:00+08:00</published><updated>2018-03-20T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-03-20:/posts/2018/2018-03-20.html</id><summary type="html">&lt;blockquote&gt;
&lt;p&gt;è‡ª2006å¹´1æœˆ1æ—¥èµ·ï¼Œåœ¨ä¸€ä¸ªçº³ç¨å¹´åº¦å†…å–å¾—ä¸ªäººæ‰€å¾—ç¨æ³•ä¸­è§„å®šçš„â€œå·¥èµ„ã€è–ªé‡‘æ‰€å¾—â€ã€â€œä¸ªä½“å·¥å•†æˆ·çš„ç”Ÿäº§ã€ç»è¥æ‰€å¾—â€ã€â€œå¯¹ä¼äº‹ä¸šå•ä½çš„æ‰¿åŒ…ç» â€¦&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;blockquote&gt;
&lt;p&gt;è‡ª2006å¹´1æœˆ1æ—¥èµ·ï¼Œåœ¨ä¸€ä¸ªçº³ç¨å¹´åº¦å†…å–å¾—ä¸ªäººæ‰€å¾—ç¨æ³•ä¸­è§„å®šçš„â€œå·¥èµ„ã€è–ªé‡‘æ‰€å¾—â€ã€â€œä¸ªä½“å·¥å•†æˆ·çš„ç”Ÿäº§ã€ç»è¥æ‰€å¾—â€ã€â€œå¯¹ä¼äº‹ä¸šå•ä½çš„æ‰¿åŒ…ç»è¥ã€æ‰¿ç§Ÿç»è¥æ‰€å¾—â€ã€â€œåŠ³åŠ¡æŠ¥é…¬æ‰€å¾—â€ç­‰11é¡¹åº”ç¨æ‰€å¾—åˆè®¡æ•°é¢è¾¾åˆ°12ä¸‡å…ƒä»¥ä¸Šçš„çº³ç¨äººï¼Œåº”åœ¨çº³ç¨å¹´åº¦ç»ˆäº†åä¸‰ä¸ªæœˆå†…ï¼Œå‘ä¸»ç®¡ç¨åŠ¡æœºå…³åŠç†è‡ªè¡Œçº³ç¨ç”³æŠ¥çš„ç›¸å…³äº‹å®œã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;åŸå¸‚æœåŠ¡-æ·±åœ³åœ°ç¨æœåŠ¡&lt;/h2&gt;
&lt;p&gt;è…¾è®¯çš„HR æ¯æ—¥å‚¬ç€æˆ‘ä»¬ç”³æŠ¥ä¸ªç¨ï¼Œä¸€å¼€å§‹è¯´æ˜¯å¯ä»¥åœ¨å¾®ä¿¡é’±åŒ…-åŸå¸‚æœåŠ¡-æ·±åœ³åœ°ç¨æœåŠ¡ ä¸­è¿›è¡Œç”³æŠ¥ï¼Œå¯æ˜¯è¾“å…¥èº«ä»½è¯å’Œå§“åä¹‹åï¼Œæ€»æ˜¯æç¤ºå®åéªŒè¯ä¸é€šè¿‡ï¼ŒæŸ¥è¯¢å†…ç½‘è®ºå›å‘ç°å¤§å®¶éƒ½è¿™æ ·ï¼Œè¡Œæ”¿åŒå­¦è§£é‡Šï¼šç”±äºæ‹›è¡Œçš„æ¥å£é—®é¢˜ï¼Œè¿”å›çš„ä¿¡æ¯æ²¡èº«ä»½è¯ä¿¡æ¯ï¼Œæ‰€ä»¥å®åè®¤è¯ä¸é€šè¿‡ï¼Œéœ€è¦å¾®ä¿¡é’±åŒ…ç»‘å®šéæ‹›è¡Œå¡æ‰è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åå¼€å§‹å€’è…¾äº†ï¼Œè§£ç»‘æ‹›è¡Œå¡ï¼Œç•™å»ºè¡Œã€ä¸­è¡Œï¼Œä¹Ÿè¿˜æ˜¯ä¸è¡Œã€‚æ€’ï¼&lt;/p&gt;
&lt;h2&gt;æ·±åœ³åœ°ç¨å…¬ä¼—å·-è‡ªåŠ©åŠç¨&lt;/h2&gt;
&lt;p&gt;é€›é€›å†…ç½‘ï¼Œå‘ç°æœ‰åŒäº‹è¯´å¯ä»¥å…³æ³¨ï¼šâ€œæ·±åœ³åœ°ç¨â€ å…¬ä¼—å·ï¼Œç‚¹å‡»â€œè‡ªåŠ©åŠç¨â€-â€œä¸ªäººä¸­å¿ƒâ€ è¿›è¡Œæ“ä½œã€‚è·³è½¬åˆ°å¼€æˆ·ç»‘å®šï¼Œå¡«å†™å®Œä¿¡æ¯ä¹‹åï¼Œæç¤ºæˆ‘çš„èº«ä»½è¯ä¿¡æ¯å·²ç»ç™»è®°åœ¨å†Œã€‚ã€‚ã€‚æ— æ³•ç»‘å®šï¼Œåè¡€ï¼&lt;/p&gt;
&lt;h2&gt;ç”µå­ç¨åŠ¡å±€&lt;/h2&gt;
&lt;p&gt;æœ€ååªèƒ½è¯•ä¸€è¯•åœ°ç¨å®˜ç½‘-&lt;a href="https://dzswj.szds.gov.cn/dzswj/"&gt;ç”µå­ç¨åŠ¡å±€&lt;/a&gt;ï¼ŒIE 10 æ‰“å¼€è¿™ç½‘ç«™ï¼Œé¡µé¢å¡æ­»ï¼Œå±¡è¯•ä¸çˆ½ï¼Œå¯ç”¨å…¼å®¹è§†å›¾ï¼Œè¿˜æ˜¯ä¸€æ‰“å¼€å°±å¡æ­»ï¼Œç»™è·ªï¼å†…ç½‘é€›é€›ï¼Œå‘ç°æœ‰åŒäº‹è¯´QQ æµè§ˆå™¨å¥½ä½¿ï¼Œé‚æ€’ä¸‹å®‰è£…ï¼Œæ‰“å¼€ï¼Œæœç„¶å¥½ä½¿ï¼ç„¶è€Œå¥½æˆæ‰åˆšåˆšå¼€å§‹ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;é€‰æ‹©è‡ªç„¶äººç”¨æˆ·æ ‡ç­¾ï¼Œç‚¹å‡»â€œæˆ‘è¦å¼€é€šâ€ï¼Œå¡«å†™ä¿¡æ¯ï¼Œå¼¹å‡ºé¡µé¢ï¼Œè·³è½¬åˆ°â€œæ·±åœ³é‡‘èç”µå­ç»“ç®—ä¸­å¿ƒâ€çš„è®¤è¯ç½‘å…³ï¼Œè¾“å…¥é“¶è¡Œçš„é¢„ç•™æ‰‹æœºå·ï¼Œ170xxxxï¼Œå’¦ï¼Œæ”¶ä¸åˆ°éªŒè¯ç ï¼Œæ‹”æ’æ‹”æ’ä¸€ä¸‹ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Ÿå¥‡æ€ªã€‚ã€‚æ¢ä¸€ä¸ªæ‰‹æœºå·ï¼Œ185xxxxï¼Œå’¦ï¼Œå¯ä»¥äº†æ”¶åˆ°éªŒè¯ç äº†ï¼å¯æ˜¯è¿™ä¸ªæ‰‹æœºå·ä¸æ˜¯æˆ‘é¢„ç•™çš„ï¼Œåªæ˜¯ä¸€å¼ â€œæµé‡å¡â€ã€‚&lt;br&gt;
æ‰“12366 å®¢æœï¼Œæè¿°é—®é¢˜ï¼Œâ€œç”©é”…â€ï¼Œè®©æˆ‘æ·»åŠ ä»–ä»¬çš„æŠ€æœ¯QQï¼šâ€œ800012366â€ã€‚&lt;br&gt;
å·¥å·1014 ä¸ºæˆ‘æœåŠ¡ï¼Œæè¿°é—®é¢˜ï¼Œâ€œç”©é”…â€ï¼Œâ€œè¿™ä¸æ˜¯åœ°ç¨çš„é—®é¢˜ï¼Œæ˜¯æ·±åœ³é‡‘èç”µå­ç»“ç®—ä¸­å¿ƒâ€çš„é—®é¢˜ï¼Œå¬èµ·æ¥æ²¡æ¯›ç—…ï¼Œâ€œèƒ½å¸®æˆ‘åé¦ˆä¸€ä¸‹è¿™ä¸ªé—®é¢˜å—â€ï¼Œâ€œä¸èƒ½ï¼Œä¸æ˜¯åœ°ç¨çš„é—®é¢˜â€ï¼Œmmpã€‚  &lt;/p&gt;
&lt;p&gt;æ‰“é˜¿é‡Œé€šä¿¡çš„å®¢æœç”µè¯10029ï¼Œæè¿°é—®é¢˜ï¼Œ
â€œé˜¿é‡Œé€šä¿¡åªæ”¯æŒæ·˜å®ã€å¾®åšï¼Œè¿˜æœ‰ä¸ªå•¥ï¼Œä¸‰ä¸ªå¹³å°ï¼Œå…¶ä»–å¹³å°ä¸ä¿è¯æ”¯æŒâ€ã€‚ã€‚ã€‚ã€‚&lt;br&gt;
ä¸Šäº†è´¼åºŠäº†ã€‚&lt;/p&gt;
&lt;p&gt;è‡ªå·±ç ”ç©¶ä¸€ä¸‹è¯·æ±‚ï¼š&lt;br&gt;
&lt;img alt="szfesc" src="/assets/images/2023/20230302151313.png"&gt;&lt;/p&gt;
&lt;p&gt;çŒœæµ‹å‘é€éªŒè¯ç æ¥å£çš„çŸ­ä¿¡ç½‘å…³ï¼Œ170 ç­‰è™šæ‹Ÿè¿è¥å•†çš„å‘é€å¤±è´¥ã€‚åœ°ç¨å±€çš„ç½‘ç«™è·³è½¬åˆ°è®¤è¯ç½‘å…³çš„æ—¶å€™ï¼Œä¼šå¸¦ä¸€ä¸ªmerChikBillSn å·ï¼Œè®¤è¯ç½‘å…³è¿™è¾¹å¯¹è¿™ä¸ªmerChikBillSn è¿›è¡Œè®¤è¯é€šè¿‡ä¹‹åï¼Œæ‰èƒ½åœ¨åœ°ç¨å±€é‚£è¾¹è¿›è¡Œå¼€é€šã€‚è¿™ä¸ªè®¤è¯çš„æ¥å£ï¼š&lt;br&gt;
&lt;code&gt;wyzf-gateway/RealNameVerification/checkConfim&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;merChkBillSn
acctID
phoneNm
smsCodeId
smsCodeValue
banType
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è®¤è¯ç½‘å…³ä¼šæ ¡éªŒé“¶è¡Œå¡å’Œé¢„ç•™çš„æ‰‹æœºå·ï¼ˆphoneNmï¼‰æ˜¯å¦ä¸€è‡´ï¼ŒåŒæ—¶ä¼šæ ¡éªŒsmsCodeId å’Œ smsCodeValue æ˜¯å¦åŒ¹é…æ­£ç¡®ï¼Œå˜¿å˜¿ï¼Œå®ƒä¸ä¼šæ ¡éªŒsmsCodeId å¯¹åº”çš„æ‰‹æœºå·æ˜¯å¦å’ŒphoneNm ä¸€è‡´ï¼Œæ‰€ä»¥å¯ä»¥ç®€å•çš„ç»•è¿‡ï¼Œç”¨ä¸€ä¸ªä¸‰å¤§è¿è¥å•†çš„æ‰‹æœºå·ï¼Œå¾—åˆ°ä¸€ä¸ªsmsCodeId å’ŒéªŒè¯ç ï¼Œç„¶åå†æ„é€ è¯·æ±‚å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯æƒœä¹Œäº‘ä¸åœ¨äº†ï¼Œä¸ç„¶è¿˜èƒ½å»æŠ¥ä¸ªæ¼æ´ã€‚&lt;/p&gt;
&lt;p&gt;å…´é«˜é‡‡çƒˆï¼Œè®¤è¯é€šè¿‡ï¼Œå›å»å¡«å†™å¼€é€šä¿¡æ¯ï¼Œç„¶è€Œæˆ‘è¿˜æ˜¯å¤ªå¹´è½»ã€‚&lt;/p&gt;
&lt;p&gt;å¡«å†™ç”µè¯ï¼Œåœ°å€ï¼Œç‚¹å‡»å¼€é€šï¼ &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œèº«ä»½è¯å·ç å¯¹åº”çš„è‡ªç„¶äººç™»è®°ä¿¡æ¯å·²å­˜åœ¨â€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ— æ³•å¼€é€šã€‚ã€‚ã€‚ã€‚å’Œå‰é¢åœ¨å…¬ä¼—å·é‡Œé¢å¼€é€šç»‘å®šçš„æç¤ºä¸€æ ·ï¼Œåè¡€ã€‚&lt;/p&gt;
&lt;p&gt;å†æ€’æ‰“å®¢æœç”µè¯ï¼Œåˆè¢«ç”©åˆ°æŠ€æœ¯å®¢æœQQï¼Œæè¿°é—®é¢˜ï¼Œå»ºè®®æˆ‘æ‰¾å›å¯†ç ã€‚  &lt;/p&gt;
&lt;p&gt;å»é¡µé¢ä¸Šæ‰¾å›å¯†ç ï¼Œè¾“å…¥ä¿¡æ¯ï¼Œæç¤ºâ€œè¿˜æ²¡æœ‰å¼€é€šè‡ªç„¶äººç”µå­ç¨åŠ¡å±€â€ï¼Œä»€ä¹ˆé¬¼ã€‚  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;â€œæä¾›ä¸€ä¸‹ä½ çš„å§“åå’Œèº«ä»½è¯â€ã€‚   &lt;/li&gt;
&lt;li&gt;â€œä½ çš„ä¿¡æ¯ä¼ä¸šç™»è®°é”™è¯¯â€ï¼Œæˆ‘çš„åå­—è¢«æ‰“é”™äº†ã€‚ã€‚ã€‚ &lt;/li&gt;
&lt;li&gt;â€œå»å‰å°æ›´æ­£ä¿¡æ¯ï¼Œå¼€é€šå§â€  ï¼Œåè¡€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å—å±±åœ°ç¨å±€&lt;/h2&gt;
&lt;p&gt;å–å·ï¼ŒAç±»ï¼Œå‰é¢è¿˜æœ‰23äººï¼Œé¢†è¡¨ï¼Œå¡«å†™ã€‚&lt;br&gt;
ç­‰å§ï¼Œé€›é€›ï¼š é‚£ä¸ªå¥³çš„æ€ä¹ˆåœ¨ç©æ‰‹æœºï¼Œä¸å«å·ï¼Œ é‚£ä¸ªèƒ–å­åœ¨å¹²å˜›ï¼Œæ€ä¹ˆä¸å«å·ã€‚&lt;/p&gt;
&lt;p&gt;å’Œå’¨è¯¢å°å°å¦¹åæ§½ï¼Œæ€ä¹ˆè¿™ä¹ˆæ…¢ï¼Œè¢«åé—®æ€ä¹ˆä¸åœ¨å¾®ä¿¡é‡Œæ“ä½œï¼Œç­”æ²¡æ“ä½œæˆåŠŸï¼Œä½ ä»¬åšçš„é—®é¢˜å¤ªå¤šï¼Œè¢«åæ€¼ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œé‚£ä¸ªæ˜¯ä½ ä»¬è…¾è®¯åšçš„â€ ï¼ˆä¸Šç­è·¯ä¸Šï¼Œæˆ´ç€å·¥ç‰Œï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åŠå°æ—¶åï¼Œç»ˆäºç­‰åˆ°äº†ï¼Œ16å·å°å§å§ï¼Œäº†è§£æ¸…æ¥šæƒ…å†µä¹‹åï¼Œå…ˆæŠŠä¸ªç¨ç”³æŠ¥åšäº†ï¼Œç„¶åå¸®æˆ‘å¼€é€šç”µå­ç¨åŠ¡å±€ï¼Œæ“ä½œå‡ æ¬¡ï¼Œå¤±è´¥ã€‚
ä»¥ä¸º170 æ‰‹æœºå·ä¸è¡Œï¼Œæ¢185ï¼Œä¹Ÿä¸è¡Œã€‚
å°å§å§å‘¼å«å¦å¤–ä¸€ä¸ªå°å§å§æ”¯æ´ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œå‡ ç•ªç”µè¯è”ç³»åå°æœåŠ¡äººå‘˜ï¼Œè¯´æˆ‘çš„ä¿¡æ¯å½•å…¥é”™è¯¯ï¼Œéœ€è¦æ›´æ­£ã€‚è®©æˆ‘ç•™ä¸€ä¸ªæ‰‹æœºå·ï¼Œå›å»ç­‰æ¶ˆæ¯ï¼Œå›å»ç­‰ï¼Œæµç¨‹å¾ˆæ…¢ã€‚&lt;/p&gt;
&lt;p&gt;æ€’æ€¼ï¼šä¸è¡Œï¼Œè¯·é©¬ä¸Šå¤„ç†ã€‚
å£°è°ƒæœ‰ç‚¹é«˜ï¼Œå¼•æ¥ä¸€ä¸ªç”·çš„ï¼Œä¸€ä¸ªå¥³é˜¿å§¨ï¼Œå’Œæˆ‘å¯¹æˆ˜ï¼šâ€œä½ ä»¬è…¾è®¯è‡ªå·±çš„é—®é¢˜ï¼Œä¿¡æ¯å½•é”™äº†â€ã€‚
æ‹’ç»ï¼Œä¸æƒ³å†è·‘ä¸€è¶Ÿï¼Œå¦å¤–ä¸€ä¸ªå°å§å§æ‰“äº†å‡ ä¸ªç”µè¯ï¼Œæäº¤å·¥å•ï¼Œåšä¿¡æ¯æ›´æ­£ã€‚ååˆ†é’Ÿåï¼Œæå®šï¼&lt;/p&gt;
&lt;p&gt;è”ç³»HR8008ï¼Œååº”+åæ§½ï¼ŒHR å°å§å§è¯´æ£€æŸ¥äº†ï¼Œæ²¡å‘ç°ç™»è®°æœ‰è¯¯ã€‚ã€‚ç®—äº†ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°å…¬å¸ï¼Œå·²ç»å¿«11ç‚¹ã€‚è€—è´¹2å°æ—¶ï¼Œorzã€‚&lt;/p&gt;</content><category term="2018"></category><category term="hack"></category></entry><entry><title>ã€ŠHTTP/2 åŸºç¡€æ•™ç¨‹ã€‹è¯»ä¹¦ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2018/2018-02-06.html" rel="alternate"></link><published>2018-02-06T00:00:00+08:00</published><updated>2018-02-06T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-02-06:/posts/2018/2018-02-06.html</id><summary type="html">&lt;p&gt;&lt;img alt="http2" src="/assets/images/2023/20230227141517.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘æ‹¿åˆ°ä¸€æœ¬æ–°ä¹¦ï¼š&lt;a href="https://book.douban.com/subject/27665112/"&gt;ã€ŠHTTP/2 åŸºç¡€æ•™ç¨‹ã€‹&lt;/a&gt;ï¼Œè–„è–„ä¸€æœ¬ï¼Œé™¤å»é™„å½•100é¡µä¸åˆ°ï¼Œå–çš„æŒºè´µï¼Œ49å…ƒã€‚ã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼ã€‹çš„è¯‘è€…ä½™æ™Ÿä¸ºè¿™ä¹¦å†™äº†åºï¼Œä¹Ÿåœ¨ä»–çš„ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="http2" src="/assets/images/2023/20230227141517.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘æ‹¿åˆ°ä¸€æœ¬æ–°ä¹¦ï¼š&lt;a href="https://book.douban.com/subject/27665112/"&gt;ã€ŠHTTP/2 åŸºç¡€æ•™ç¨‹ã€‹&lt;/a&gt;ï¼Œè–„è–„ä¸€æœ¬ï¼Œé™¤å»é™„å½•100é¡µä¸åˆ°ï¼Œå–çš„æŒºè´µï¼Œ49å…ƒã€‚ã€Šç²¾é€šæ­£åˆ™è¡¨è¾¾å¼ã€‹çš„è¯‘è€…ä½™æ™Ÿä¸ºè¿™ä¹¦å†™äº†åºï¼Œä¹Ÿåœ¨ä»–çš„ä¸ªäººå…¬ä¼—å·ä¸Šæ¨èï¼Œè¯»å®Œå´è§‰å¾—ä½œä¸ºåŸºç¡€æ•™ç¨‹è¿˜ä¸é”™ï¼Œç¿»è¯‘ä¸Šè§‰å¾—ç•¥ç”Ÿç¡¬ã€‚ä½œç‚¹ç®€å•çš„ç¬”è®°ï¼Œæ–¹ä¾¿ä»¥åâ€œæŒ‰å›¾ç´¢éª¥â€ã€‚&lt;/p&gt;
&lt;h2&gt;3.1.2 å…³é”®æ€§èƒ½æŒ‡æ ‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿ&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿæ˜¯åˆ¶çº¦Web æ€§èƒ½çš„ä¸»è¦ç“¶é¢ˆï¼Œåæ–‡è¿˜ä¼šæåˆ°ï¼Œä¸¢åŒ…ä¼šä¸¥é‡å½±å“HTTP/2 çš„æ€§èƒ½&lt;/li&gt;
&lt;li&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆCDN çš„è¾¹ç¼˜èŠ‚ç‚¹è¦è¿‘å¯èƒ½çš„é è¿‘ç›®æ ‡ç”¨æˆ·ï¼Œåšåˆ°æœ¬åœ°è¦†ç›–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¸¦å®½&lt;ul&gt;
&lt;li&gt;å¸¦å®½å¯èƒ½ä¼šæˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆï¼Œä¸è¿‡å¯¹äºæ™®é€šçš„ç½‘é¡µï¼Œç›®å‰å¤§å¤šæ•°ç”¨æˆ·çš„å¸¦å®½å·²ç»ä¸æ˜¯ç“¶é¢ˆï¼Œå»¶æ—¶å’Œä¸¢åŒ…æ›´åŠ é‡è¦&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;DNS æŸ¥è¯¢&lt;ul&gt;
&lt;li&gt;ç½‘å€çš„åŸŸåè§£æï¼Œç½‘é¡µå†…å„é¡¹èµ„æºçš„åŸŸåè§£ææ—¶é—´ï¼Œè¿™å—æŸ¥è¯¢æ—¶é—´å æ¯”è¾ƒå¤§ï¼Œç‰¹åˆ«æ˜¯åœ¨ç§»åŠ¨ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å»ºç«‹è¿æ¥çš„æ—¶é—´&lt;ul&gt;
&lt;li&gt;TCP ä¸‰æ¬¡æ¡æ‰‹&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TLS åå•†æ—¶é—´&lt;ul&gt;
&lt;li&gt;é‡‡ç”¨HTTPS ä¹‹åï¼ŒTLS æ¡æ‰‹ï¼ŒTLS 1.2 éœ€è¦æ¶ˆè€—2ä¸ªRTTï¼Œä¸è¿‡æ–°çš„TLS1.3 åªéœ€è¦1ä¸ªRTTã€‚&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹TLS æœ‰éå¸¸å¤šçš„ä¼˜åŒ–æ‰‹æ®µï¼Œå»ºè®®é˜…è¯»&lt;a href="https://book.douban.com/subject/25856314/"&gt;ã€ŠWeb æ€§èƒ½æƒå¨æŒ‡å—ã€‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é¦–å­—èŠ‚æ—¶é—´ï¼ˆTTFBï¼‰&lt;ul&gt;
&lt;li&gt;å®¢æˆ·ç«¯å¼€å§‹è®¿é—®ç½‘é¡µï¼Œåˆ°æ”¶åˆ°æœåŠ¡å™¨å“åº”çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æ—¶é•¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å†…å®¹ä¸‹è½½æ—¶é—´&lt;ul&gt;
&lt;li&gt;ä»å®¢æˆ·ç«¯å¼€å§‹è®¿é—®ï¼Œåˆ°æœ€åä¸€ä¸ªå“åº”å­—èŠ‚åˆ°è¾¾å®¢æˆ·ç«¯çš„æ—¶é•¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¼€å§‹æ¸²æŸ“æ—¶é—´&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·çœ‹åˆ°ç©ºç™½é¡µé¢çš„æ—¶é•¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£åŠ è½½å®Œæˆæ—¶é—´ï¼ˆåˆå«é¡µé¢åŠ è½½æ—¶é—´ï¼‰&lt;ul&gt;
&lt;li&gt;æµè§ˆå™¨è®¤ä¸ºé¡µé¢åŠ è½½å®Œæ¯•çš„æ—¶é•¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;äº’è”ç½‘å‘å±•ï¼Œé‡åˆ°çš„æŒ‘æˆ˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ›´å¤šçš„å­—èŠ‚ï¼šé¡µé¢èµ„æºçš„ä½“ç§¯å˜å¤§&lt;/li&gt;
&lt;li&gt;æ›´å¤šçš„èµ„æºï¼šé¡µé¢èµ„æºæ•°é‡å˜å¤š&lt;/li&gt;
&lt;li&gt;æ›´é«˜çš„å¤æ‚åº¦ï¼š é¡µé¢è¶Šæ¥è¶Šå¤æ‚ï¼Œæ¸²æŸ“å˜é•¿&lt;/li&gt;
&lt;li&gt;æ›´å¤šçš„åŸŸåï¼š ä¸€ä¸ªé¡µé¢åŒ…å«çš„åŸŸåè¶Šæ¥è¶Šå¤šï¼Œå¢åŠ äº†DNS æŸ¥è¯¢è€—æ—¶ã€å»ºç«‹è¿æ¥è€—æ—¶ã€TLS åå•†è€—æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;æ›´å¤šçš„TCP socketï¼šæµè§ˆå™¨ä¼šå¯¹åŒä¸€ä¸ªåŸŸåå¼€å¯å¤šä¸ªè¿æ¥ï¼Œè¿™å¢åŠ äº†æœåŠ¡å™¨åå•†è€—æ—¶ï¼ŒåŠ é‡è®¾å¤‡è´Ÿæ‹…ï¼Œæœ‰å¯èƒ½å¯¼è‡´ç½‘ç»œè¿‡è½½ç­‰é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;3.1.3 HTTP/1 çš„é—®é¢˜&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;é˜Ÿå¤´å µå¡&lt;ul&gt;
&lt;li&gt;HTTP/1 æœ‰ä¸ªç‰¹æ€§å«ç®¡é“åŒ–ï¼ˆpipeliningï¼‰ï¼Œå…è®¸ä¸€æ¬¡å‘é€ä¸€ç»„è¯·æ±‚ï¼Œå½“æ—¶åªèƒ½æŒ‰ç…§å‘é€é¡ºåºä¾æ¬¡æ¥æ”¶è¯·æ±‚ï¼Œ&lt;/li&gt;
&lt;li&gt;åœ¨åº”ç­”è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¯·æ±‚é˜»å¡äº†ï¼Œåç»­æ‰€æœ‰å·¥ä½œéƒ½ä¼šè¢«é˜»å¡ã€‚ç°ä»£æµè§ˆå™¨ä¼šå¯¹å•ä¸ªåŸŸåå¼€å¯6ä¸ªè¿æ¥ï¼Œå½“æ—¶æ¯ä¸ªè¿æ¥è¿˜æ˜¯ä¼šå—åˆ°â€œé˜Ÿå¤´é˜»å¡â€çš„å½±å“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½æ•ˆçš„TCP åˆ©ç”¨&lt;ul&gt;
&lt;li&gt;æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œæ…¢å¯åŠ¨ï¼Œä»¥åŠæ‹¥å¡é¿å…ï¼ŒTCP å¹¶ä¸é«˜æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è‡ƒè‚¿çš„æ¶ˆæ¯é¦–éƒ¨&lt;ul&gt;
&lt;li&gt;HTTP/1 æ¶ˆæ¯å¤´éƒ¨æ— æ³•è¢«å‹ç¼©ï¼Œå¦‚æœå†å¸¦ä¸Šcookiesï¼Œæœ‰ä¸ªå‡ åƒå­—èŠ‚å¾ˆå¸¸è§ã€‚å¤§é‡è¯·æ±‚ä¸‹ï¼Œæ¶ˆæ¯å¤´çš„å æ¯”ä¸å¯å¿½è§†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å—é™çš„ä¼˜å…ˆçº§è®¾ç½®&lt;ul&gt;
&lt;li&gt;å¤„ç†é«˜ä¼˜å…ˆçº§çš„èµ„æºæ—¶ï¼Œä¸ä¼šå¯¹ä½ä¼˜å…ˆçº§çš„èµ„æºå‘èµ·è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ–¹èµ„æº&lt;ul&gt;
&lt;li&gt;æ—¥ç›Šå¢å¤šçš„ç¬¬ä¸‰æ–¹èµ„æºå¼•ç”¨ï¼Œæ¶ˆè€—äº†å¤§é‡èµ„æºã€‚HTTP/2 å¯¹æ­¤ä¹ŸæŸæ‰‹æ— ç­–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;3.2.1 Web æ€§èƒ½çš„æœ€ä½³å®è·µ&lt;/h2&gt;
&lt;h3&gt;1. DNS æŸ¥è¯¢ä¼˜åŒ–&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é™åˆ¶ä¸åŒåŸŸåçš„æ•°é‡ã€‚&lt;/li&gt;
&lt;li&gt;ä¿è¯ä½é™åº¦çš„è§£æå»¶è¿Ÿï¼Œå®šæœŸç›‘æ§ç”¨æˆ·åˆ†å¸ƒæ‰€æœ‰åœ°åŒºçš„è§£ææ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä¸»ä½“é¡µé¢HTML æ´»å“åº”ä¸­åˆ©ç”¨&lt;a href="https://www.w3.org/TR/resource-hints/#dns-prefetch"&gt;DNS é¢„å–å‘½ä»¤&lt;/a&gt;ã€‚
 ä¾‹ï¼š
 &lt;code&gt;&amp;lt;link rel="dns-prefetch" hrefp="//ajax.googleapis.com"&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2. ä¼˜åŒ–TCP è¿æ¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨&lt;a href="https://www.w3.org/TR/resource-hints/#preconnect"&gt;preconnect&lt;/a&gt; æŒ‡ä»¤ã€‚
 ä¾‹ï¼š
 &lt;code&gt;&amp;lt;link rel="preconnect" href="//fonts.example.com" crossorigin&amp;gt;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å°½æ—©ç»ˆæ­¢å¹¶å“åº”ï¼Œå€ŸåŠ©CDNï¼Œé™ä½RTTï¼Œå°½å¿«å“åº”ã€‚&lt;/li&gt;
&lt;li&gt;å®æ–½æœ€æ–°çš„&lt;a href="https://istlsfastyet.com/"&gt;TLS æœ€ä½³å®è·µ&lt;/a&gt;æ¥ä¼˜åŒ–HTTPSã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3. é¿å…é‡å®šå‘&lt;/h3&gt;
&lt;p&gt;é‡å®šå‘é€šå¸¸ä¼šè§¦å‘ä¸é¢å¤–åŸŸåå»ºç«‹è¿æ¥ï¼Œç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å½»åº•æ¶ˆç­é‡å®šå‘ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨CDN ä»£æ›¿å®¢æˆ·ç«¯åœ¨äº‘ç«¯å®ç°é‡å®šå‘ï¼Œæ„æ€å°±æ˜¯è®©CDN é‡å®šå‘å»å–å›èµ„æºå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯åŒä¸€åŸŸåçš„é‡å®šå‘ï¼Œåˆ©ç”¨Web æœåŠ¡å™¨ä¸Šçš„rewrite è§„åˆ™ï¼Œé¿å…é‡å®šå‘ã€‚ä¾‹å¦‚Nginxã€Apache é‡Œé¢çš„rewriteï¼Œå®¢æˆ·ç«¯æ— éœ€å†å‘èµ·ä¸€æ¬¡è¯·æ±‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4. å®¢æˆ·ç«¯ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ˜¯æœ€å¿«çš„ã€‚å»ºè®®æ‰€æœ‰çš„é™æ€èµ„æºåç§°éƒ½å¸¦ä¸Šä¸€ä¸ªéšæœºçš„IDï¼Œç„¶åç»™ä¸€ä¸ªè¶…é•¿çš„ç¼“å­˜æ—¶é—´å³å¯ã€‚éƒ¨åˆ†éœ€è¦æ›´æ–°çš„èµ„æºï¼Œå¯ä»¥æŒ‰éœ€è°ƒæ•´ç¼“å­˜æ—¶é—´ã€‚&lt;/p&gt;
&lt;h3&gt;5. ç½‘ç»œè¾¹ç¼˜çš„ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;åˆ©ç”¨CDNï¼Œç¼“å­˜éƒ¨åˆ†æ•°æ®ã€‚å¦‚æœä¸€ä»½èµ„æºéœ€è¦ç¼“å­˜ï¼Œå®ƒå¿…é¡»æ»¡è¶³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨å¤šç”¨æˆ·é—´å¯å…±äº«ï¼Œå¹¶ä¸”&lt;/li&gt;
&lt;li&gt;èƒ½å¤Ÿæ¥å—ä¸€å®šç¨‹åº¦çš„æ—§æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”¨æˆ·çš„éšç§ä¿¡æ¯ã€ä»¥åŠè´µæ—¶é—´æ•æ„Ÿçš„å†…å®¹éƒ½ä¸å¯ä»¥ç¼“å­˜ã€‚&lt;/p&gt;
&lt;h3&gt;6. æ¡ä»¶ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;Last-Modified-Since&lt;/code&gt;ï¼Œ&lt;code&gt;ETag&lt;/code&gt; ç­‰å¤´éƒ¨æ£€æŸ¥æœåŠ¡ç«¯èµ„æºæ›´æ–°æƒ…å†µï¼Œå¦‚æœæ²¡æ›´æ–°ï¼ŒæœåŠ¡ç«¯è¿”å›304ï¼Œå¦åˆ™è¿”å›æ–°çš„èµ„æºã€‚&lt;/p&gt;
&lt;h3&gt;7. å‹ç¼©å’Œä»£ç æç®€åŒ–&lt;/h3&gt;
&lt;p&gt;å»é™¤å‰ç«¯ä»£ç é‡Œé¢å¤šä½™çš„æ³¨é‡Šã€ç©ºæ ¼ã€æ¢è¡Œï¼Œç‰ºç‰²å¯è¯»æ€§é™ä½ä½“ç§¯ï¼Œå†é€šè¿‡gzipã€deflateã€Brotliç­‰ç®—æ³•å‹ç¼©ä¼ è¾“ã€‚&lt;/p&gt;
&lt;h3&gt;8. é¿å…é˜»å¡CSS/JS&lt;/h3&gt;
&lt;p&gt;CSS è¦æ”¾åœ¨head æ ‡ç­¾é‡Œï¼Œåœ¨ä»»ä½•JS å’Œå›¾ç‰‡å‰é¢ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®šæœŸæ ¡éªŒJS èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œæ¸…æ¥šä¸å†éœ€è¦çš„èµ„æºã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœJS æ‰§è¡Œé¡ºåºæ— å…³ç´§è¦ï¼Œå¹¶ä¸”å¿…é¡»åœ¨onload äº‹ä»¶è§¦å‘ä¹‹å‰è¿è¡Œï¼Œå¯ä»¥è®¾ç½®&lt;a href="http://caniuse.com/#search=async"&gt;async å±æ€§&lt;/a&gt;ï¼Œ
 ä¾‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt; &amp;lt; script async src=&amp;quot;/js/myfile.js&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;å¦‚æœJS æ‰§è¡Œé¡ºåºå¾ˆé‡è¦ï¼Œå¹¶ä¸”ä¹Ÿèƒ½æ¥å—è„šæœ¬åœ¨DOM åŠ è½½å®Œä¹‹åè¿è¡Œï¼Œå¯ä»¥ä½¿ç”¨defer å±æ€§ï¼Œ
 ä¾‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt; &amp;lt;script defer src=&amp;quot;/js/myjs.js&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;å¯¹äºä¸è¡Œå½±å“åˆ°é¡µé¢åˆæ¬¡å±•ç¤ºçš„JSè„šæœ¬ï¼Œå¿…é¡»åœ¨onload äº‹ä»¶è§¦å‘ä¹‹åè¯·æ±‚ï¼ˆå¤„ç†ï¼‰å®ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;9. å›¾ç‰‡ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;å›¾ç‰‡è¶Šæ¥è¶Šå¤šï¼Œé’ˆå¯¹å›¾ç‰‡çš„2æ¡ä¼˜åŒ–å»ºè®®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ é™¤å›¾ç‰‡å…ƒä¿¡æ¯ï¼Œä¾‹å¦‚é¢˜æã€åœ°ç†ä¿¡æ¯ã€æ—¶é—´æˆ³ã€å°ºå¯¸å’Œåƒç´ ä¿¡æ¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹ä¸åŒè®¾å¤‡æä¾›ä¸åŒå°ºå¯¸çš„å›¾ç‰‡ï¼Œå¦å¤–ä¾‹å¦‚ä¸ƒç‰›ã€åˆæ‹äº‘ç­‰CDN å‚å•†éƒ½æä¾›å›¾ç‰‡å¤„ç†æœåŠ¡ï¼Œä½¿ç”¨èµ·æ¥ç®€å•å¿«æ·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºå›¾ç‰‡ä¼˜åŒ–å¯ä»¥é˜…è¯»ä¹¦ç±ï¼š&lt;a href="http://shop.oreilly.com/product/0636920039730.do"&gt;ã€ŠHigh Performance Imagesã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰ä¹Ÿæ•´ç†è¿‡ä¸€ç¯‡ï¼š[[../2017/170608 å›¾ç‰‡ä¼˜åŒ–ç¬”è®°]]ã€‚&lt;/p&gt;
&lt;h2&gt;3.2.2 åæ¨¡å¼&lt;/h2&gt;
&lt;h2&gt;4.3 æ’¤é”€é’ˆå¯¹HTTP/1.1 çš„ä¼˜åŒ–&lt;/h2&gt;
&lt;h2&gt;6.7 HTTP/2 åæ¨¡å¼&lt;/h2&gt;
&lt;p&gt;ä¸€äº›åœ¨HTTP/1.X ä¸Šä½¿ç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œè‹¥åº”ç”¨åˆ°HTTP/2 ä¸Šï¼Œä¼šé€‚å¾—å…¶åï¼Œä¹¦é‡Œæœ‰ä¸‰ä¸ªåœ°æ–¹éƒ½æåˆ°äº†â€œåæ¨¡å¼â€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”Ÿæˆç²¾çµå›¾å’Œèµ„æºåˆå¹¶/å†…è”ï¼šå¯¹äºHTTP/2 æ¥è¯´ï¼Œä½¿ç”¨ç²¾çµå›¾æ²¡æœ‰æ„ä¹‰ã€‚ä¹Ÿä¸è¦å°†èµ„æºè¿›è¡Œåˆå¹¶ï¼Œç¼“å­˜æ§åˆ¶ä¸Šä¼šä¸æ–¹ä¾¿ï¼Œç²’åº¦å¤ªç²—ã€‚&lt;/li&gt;
&lt;li&gt;åŸŸåæ‹†åˆ†ï¼šè¿ç§»åˆ°HTTP/2 éœ€è¦æ”¶æ‹¢åŸŸåã€‚&lt;/li&gt;
&lt;li&gt;ç¦ç”¨cookieçš„åŸŸåï¼šHTTP/2 ä¸­ï¼Œå¤´éƒ¨ä¿¡æ¯ä¼šè¢«å‹ç¼©ï¼Œæ— éœ€å†å¯¹ç‰¹å®šåŸŸåç¦ç”¨cookieã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="null" src="/assets/images/2023/20230227141750.png"&gt;&lt;/p&gt;
&lt;h2&gt;5. HTTP/2 åè®®&lt;/h2&gt;
&lt;p&gt;ç¬¬äº”ç« ä»‹ç»äº†HTTP/2 åè®®çš„ä¸€äº›ç»†èŠ‚ï¼Œå¸§ç»“æ„ã€æµã€æµé‡æ§åˆ¶ã€ä¼˜å…ˆçº§ã€æœåŠ¡ç«¯æ¨é€ã€é¦–éƒ¨å‹ç¼©ç­‰å†…å®¹ï¼Œå†…å®¹å¾ˆå¤šï¼Œæ¯ä¸€å—è¦ç†è§£é€å½»å†…å®¹å¾ˆå¤šï¼Œå…·ä½“è¿˜æ˜¯å¾—çœ‹ä¹¦ï¼Œå¤–åŠ æŸ¥è¯¢å…¶ä»–èµ„æ–™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developers.google.com/web/fundamentals/performance/htä½ tp2/?hl=zh-cn"&gt;HTTP/2 ç®€ä»‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/creeperyang/blog/issues/23"&gt;HTTP2ç®€ä»‹å’ŒåŸºäºHTTP2çš„Webä¼˜åŒ– #23&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.blogjava.net/yongboy/archive/2015/03/20/423655.html"&gt;HTTP/2ç¬”è®°ä¹‹å¸§&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://imququ.com/post/header-compression-in-http2.html"&gt;HTTP/2 å¤´éƒ¨å‹ç¼©æŠ€æœ¯ä»‹ç»&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.blogjava.net/yongboy/archive/2015/03/19/423611.html"&gt;HTTP/2ç¬”è®°ä¹‹æµå’Œå¤šè·¯å¤ç”¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://docs.google.com/presentation/d/1r7QXGYOLCh4fcUq0jDdDwKJWNqWK1o4xMtYpKZCJYjM/present?slide=id.gae999cde7_0_167"&gt;HTTP2 is here, let's optimize!&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://http2.github.io/http2-spec/"&gt;Hypertext Transfer Protocol Version 2 (HTTP/2)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;6. HTTP/2 æ€§èƒ½&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;å¹¶éæ‰€æœ‰è¯·æ±‚åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šä»HTTP/2 å—ç›Šï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å»¶è¿Ÿï¼šè¶…è¿‡ä¸€å®šå¸¦å®½ä¹‹åï¼ˆå®éªŒå€¼æ˜¯5Mbit/s ï¼‰ï¼Œå¢åŠ å¸¦å®½ä¸ä¼šå‡å°‘å»¶è¿Ÿï¼ŒRTT å¯¹æ€§èƒ½çš„å½±å“æ›´æ–°æ•æ„Ÿï¼›&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸¢åŒ…ï¼šä¸¢åŒ…å¯¹HTTP/2 å½±å“éå¸¸å¤§ï¼Œå› ä¸ºä¸€ä¸ªåŸŸåå°±ä¸€ä¸ªè¿æ¥ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ€§èƒ½ä¼˜åŒ–å› äººè€Œå¼‚&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ³¨é‡æµ‹è¯•ï¼Œè¦éµå¾ªä¸šç•Œæ¨èçš„æ–¹å¼ï¼Œä½†ä¹Ÿä¸è¦é™·å…¥è¿‡æ—©ä¼˜åŒ–çš„é™·é˜±ï¼Œåº”å½“è®©æ•°æ®ä¸ºä½ çš„ä¼˜åŒ–æŒ‡å¼•æ–¹å‘ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;8. HTTP/2 è°ƒè¯•&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Chrome å¼€å‘è€…å·¥å…·&lt;ul&gt;
&lt;li&gt;&lt;code&gt;chrome://net-internals&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Inspect -&amp;gt; Network&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Firefox å¼€å‘è€…å·¥å…·&lt;/li&gt;
&lt;li&gt;iOSï¼šCharles Proxy&lt;/li&gt;
&lt;li&gt;Androidï¼šæ‰‹æœºç«¯-å¼€å‘è€…æ¨¡å¼-USBè°ƒè¯•ï¼ˆUSB debuggingï¼‰ï¼ŒPC-Chrome-å¼€å‘è€…å·¥å…·-Remote devices&lt;/li&gt;
&lt;li&gt;WebPagetest&lt;/li&gt;
&lt;li&gt;OpenSSL&lt;/li&gt;
&lt;li&gt;&lt;a href="https://nghttp2.org"&gt;nghttp&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;curl -v --http2&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/bradfitz/http2/tree/master/h2i"&gt;h2i&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Wireshark&lt;/li&gt;
&lt;/ul&gt;</content><category term="2018"></category><category term="http"></category><category term="book"></category></entry><entry><title>Nginx ç›‘æ§</title><link href="https://fangpsh.github.io/posts/2018/2018-01-30.html" rel="alternate"></link><published>2018-01-30T00:00:00+08:00</published><updated>2018-01-30T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-01-30:/posts/2018/2018-01-30.html</id><summary type="html">&lt;p&gt;&lt;img alt="nginx" src="https://nginx.org/nginx.png"&gt;&lt;/p&gt;
&lt;p&gt;å‰å¹´è¯»è¿‡&lt;a href="https://www.scalyr.com/community/guides"&gt;Scalyr&lt;/a&gt; å‡ ç¯‡å…³äºç›‘æ§çš„æ–‡ç« ï¼Œå†™å¾—æŒºç»†è‡´ï¼Œä»Šå¤©ç¿»æ”¶è—å¤¹åˆå‘ç°è¿™ä¸ªé“¾æ¥ï¼Œé¡ºä¾¿æ•´ç†ä¸€ä¸‹ï¼Œä¸»è¦å‚è€ƒä»¥ä¸‹2 ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.scalyr.com/community/guides/how-to-monitor-nginx-the-essential-guide"&gt;How to â€¦&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="nginx" src="https://nginx.org/nginx.png"&gt;&lt;/p&gt;
&lt;p&gt;å‰å¹´è¯»è¿‡&lt;a href="https://www.scalyr.com/community/guides"&gt;Scalyr&lt;/a&gt; å‡ ç¯‡å…³äºç›‘æ§çš„æ–‡ç« ï¼Œå†™å¾—æŒºç»†è‡´ï¼Œä»Šå¤©ç¿»æ”¶è—å¤¹åˆå‘ç°è¿™ä¸ªé“¾æ¥ï¼Œé¡ºä¾¿æ•´ç†ä¸€ä¸‹ï¼Œä¸»è¦å‚è€ƒä»¥ä¸‹2 ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.scalyr.com/community/guides/how-to-monitor-nginx-the-essential-guide"&gt;How to Monitor Nginx: The Essential Guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.scalyr.com/community/guides/an-in-depth-guide-to-nginx-metrics"&gt;An In-Depth Guide to Nginx Metrics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;stub_status&lt;/h2&gt;
&lt;p&gt;å‚è€ƒ&lt;a href="http://nginx.org/en/docs/http/ngx_http_stub_status_module.html"&gt;ngx_http_stub_status_module&lt;/a&gt; é…ç½®&lt;code&gt;stub_status&lt;/code&gt;ï¼Œè®¿é—®é…ç½®å¥½çš„è·¯å¾„ï¼Œçœ‹åˆ°çš„é¡µé¢å†…å®¹å¦‚ä¸‹ï¼ˆå¦‚æœæ˜¯Tengine è¿˜ä¼šæœ‰&lt;code&gt;request_time&lt;/code&gt; ç­‰ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Active connections: 291
server accepts handled requests
16630948 16630948 31070465
Reading: 6 Writing: 179 Waiting: 106 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;active connections&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Active = Reading + Writing + Waiting
291    = 6       + 179     + 106
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸‰ç§è¿æ¥çŠ¶æ€çš„è§£é‡Šå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Reading
    Nginx åœ¨è¯»å–è¯·æ±‚å¤´ä¿¡æ¯
Writing
    Nginx åœ¨å‘é€å“åº”ä¿¡æ¯ç»™å®¢æˆ·ç«¯
Waiting
    ç©ºé—²çš„è¿æ¥ã€‚
    2ç§æƒ…å†µä¼šå‡ºç°Waiting çš„è¿æ¥ï¼š
    1.Nginx è¯»å–å®Œè¯·æ±‚ï¼Œè¿˜æœªå‘é€å“åº”ä¿¡æ¯ä¹‹å‰ï¼›
    2.å‘é€å®Œå“åº”ä¿¡æ¯ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚æ—¶ï¼ŒHTTP 1.1 çš„keep-alive å¸¸å¸¸ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™4 ä¸ªå€¼éƒ½åº”è¯¥é‡‡é›†ï¼Œå½“ active connection æ¥è¿‘äº  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é˜ˆå€¼ï¼š&lt;a href="http://nginx.org/en/docs/ngx_core_module.html#worker_connections"&gt;worker_connections&lt;/a&gt; * &lt;a href="http://nginx.org/en/docs/ngx_core_module.html#worker_processes"&gt;worker_processes&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è§¦å‘æŠ¥è­¦ã€‚&lt;/p&gt;
&lt;h3&gt;acceptsï¼Œhandledï¼Œrequestsï¼Œdropped&lt;/h3&gt;
&lt;p&gt;accepts æ˜¯Nginx ç´¯ç§¯æ¥å—çš„è¿æ¥æ•°ï¼Œhandled æ˜¯ç´¯è®¡å¤„ç†å®Œæˆçš„è¿æ¥æ•°ã€‚è¿™2ä¸ªæ•°å€¼ä¸€èˆ¬ç›¸ç­‰ï¼Œä½†æ˜¯å¶å°”ä¼šå‘ç°
handled å€¼ç•¥å°äºacceptsï¼Œè¿™è¯´æ˜æœ‰ä¸€éƒ¨åˆ†è¯·æ±‚è¢«droppedï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dropped = accepts - handled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‡ºç°dropped å¯èƒ½æ˜¯å› ä¸ºè¾¾åˆ°Nginx çš„å¤„ç†æé™ï¼Œæˆ–è€…ç”¨æˆ·é…ç½®çš„é™åˆ¶ï¼Œå‚è€ƒä¸Šæ–‡active connection çš„æŠ¥è­¦é˜ˆå€¼ã€‚åº”è¯¥é‡‡é›†accepts å’Œhandled çš„å€¼ï¼Œç›‘æ§å®ƒä»¬ä¹‹é—´çš„å·®å€¼ã€‚&lt;/p&gt;
&lt;p&gt;requests å¸¸å¸¸æ¯”accpts å¤§å¥½å‡ å€ï¼Œå› ä¸ºä¸€ä¸ªè¿æ¥å¯èƒ½äº§ç”Ÿå¤šä¸ªè¯·æ±‚ï¼Œå¯ä»¥é€šè¿‡é‡‡é›†requestsï¼Œæ±‚å‡ºä¸€å®šæ—¶é—´ä¹‹å†…çš„å·®å€¼ï¼Œå¾—åˆ°å½“å‰çš„RPSï¼ˆRequests Per Secondï¼‰ï¼Œæ¯ç§’è¯·æ±‚æ•°ï¼Œå½“è¯·æ±‚æ•°æš´æ¶¨æ—¶ï¼ˆæ´»åŠ¨æµé‡çªå‘ï¼Œè¢«æ”»å‡»ç­‰æƒ…å†µï¼‰èƒ½åŠæ—¶å‘ç°ã€‚&lt;/p&gt;
&lt;h3&gt;nginx-moduls-vts&lt;/h3&gt;
&lt;p&gt;Nginx è‡ªå¸¦çš„stub_status æ¯”è¾ƒç®€é™‹ï¼Œå¯ä»¥è€ƒè™‘åŠ å…¥æ¨¡å—ï¼š&lt;a href="https://github.com/vozlt/nginx-module-vts"&gt;nginx-module-vts&lt;/a&gt; ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="nginx-module-vts" src="https://cloud.githubusercontent.com/assets/3648408/23890539/a4c0de18-08d5-11e7-9a8b-448662454854.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾çœ‹åˆ°çš„è¿™äº›å€¼ï¼Œéƒ½å¯ä»¥é€šè¿‡æ¨¡å—æä¾›çš„æ¥å£é‡‡é›†åˆ°ï¼Œç»˜å›¾ã€ç›‘æ§ï¼Œå…·ä½“å‚è€ƒæ¨¡å—çš„&lt;a href="https://github.com/vozlt/nginx-module-vts/blob/master/README.md"&gt;README.md&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;æ—¥å¿—&lt;/h2&gt;
&lt;h3&gt;è®¿é—®æ—¥å¿—ï¼ˆaccess.logï¼‰&lt;/h3&gt;
&lt;p&gt;è®¿é—®æ—¥å¿—ä¸­æœ€é‡è¦çš„å°±æ˜¯ç›‘æ§HTTP çŠ¶æ€ç &lt;code&gt;$status&lt;/code&gt;ï¼Œ1xxï¼Œ2xxï¼Œ3xxï¼Œ4xxï¼Œ5xxã€‚æŒ‰æ—¶é—´æ®µåˆ‡å‰²è®¡ç®—ä¸ŠæŠ¥ã€‚5xx å¤§å®¶è‚¯å®šä¼šé‡è§†ï¼Œä¸è¿‡3xx å’Œ4xx ä¹Ÿéœ€è¦æ³¨æ„ï¼Œéƒ½æ˜¯è¡€çš„æ•™è®­ã€‚&lt;br&gt;
ç”±äºéœ€è¦ç›‘æ§4xx å’Œ3xxï¼Œè¦å’Œä¸šåŠ¡æ²Ÿé€šæ¸…æ¥šï¼Œä¸è¦æŠŠä¸šåŠ¡çŠ¶æ€ç å’ŒHTTP çŠ¶æ€ç æ··åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ç”¨æˆ·æŠ½å¥–çš„è¯·æ±‚ï¼Œæ²¡ä¸­å¥–éƒ½è¿”å›404ï¼Œè¯¯æŠ¥ä¸¥é‡ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿˜å¯ä»¥é‡‡é›†æ—¥å¿—ä¸­çš„&lt;code&gt;$upstream_response_time&lt;/code&gt;ï¼Œ&lt;code&gt;$request_time&lt;/code&gt; ç­‰æ•°å€¼ï¼Œä¸€æ®µæ—¶é—´å†…å‡ºç°å“åº”æ—¶é—´æ¬¡æ•°å¤§äºæŸä¸ªé˜ˆå€¼ï¼ŒæŠ¥è­¦ï¼Œå¯ä»¥åŠæ—¶å‘ç°åç«¯æœåŠ¡å¼‚å¸¸ã€è¿‡è½½ç­‰æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;æ›´è¿›ä¸€æ­¥ï¼Œå°±æ˜¯ç”¨&lt;a href="https://www.fluentd.org"&gt;fluentd&lt;/a&gt;æ”¶é›†è®¿é—®æ—¥å¿—ï¼Œé‡‡ç”¨&lt;a href="https://www.elastic.co/products"&gt;ELK&lt;/a&gt; ã€&lt;a href="https://www.graylog.org"&gt;Graylog&lt;/a&gt;ç­‰åšæ›´ç»†è‡´çš„åˆ†æã€‚&lt;/p&gt;
&lt;h3&gt;é”™è¯¯æ—¥å¿—ï¼ˆerror.logï¼‰&lt;/h3&gt;
&lt;p&gt;Nginx çš„é”™è¯¯æ—¥å¿—éå¸¸é‡è¦ï¼Œæˆ‘ä¹‹å‰çš„åšæ³•æ˜¯è¶…è¿‡N æ¡å°±æŠ¥è­¦ã€‚ç”±äºerror.log çš„å†…å®¹ç±»å‹éå¸¸å¤šï¼Œç›‘æ§è„šæœ¬éœ€è¦è¿‡æ»¤æ‰å¸¸è§çš„ã€å·²çŸ¥çš„é”™è¯¯ã€‚æŠ¥è­¦é˜ˆå€¼å°½é‡å°ï¼Œå½“æœ‰æ„æƒ³ä¸åˆ°çš„é”™è¯¯å‡ºç°æ—¶ï¼Œèƒ½åŠæ—¶å‘ç°ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;åœ¨å‰å…¬å¸çš„æ—¶å€™ï¼Œæœ‰ä¸€å›åŒäº‹é€šè¿‡&lt;code&gt;salt cmd.run&lt;/code&gt; è¿œç¨‹é‡å¯äº†Nginxï¼Œè·‘äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œerror.log ç‹‚åˆ·æ—¥å¿—ï¼Œå‘ç°è¿›ç¨‹çš„&lt;code&gt;Max open files&lt;/code&gt;æ˜¯1024ã€‚å…ˆä¸æå¦‚ä½•é¿å…è¿™ç§æƒ…å†µï¼Œæ–¹æ³•å¾ˆå¤šï¼Œä½†æ˜¯ç›‘æ§è¿˜æ˜¯å¯ä»¥åŠ ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ps è¿‡æ»¤å‡ºNginx è¿›ç¨‹ä»¬çš„PIDï¼Œå†é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‹¿åˆ°è¿›ç¨‹çš„&lt;code&gt;Max open files&lt;/code&gt; å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cat /proc/{PID}/limit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°†å¾—åˆ°çš„å€¼ å’Œè®¾å®šçš„å€¼å¯¹æ¯”ï¼Œä¸åŒ¹é…å³æŠ¥è­¦ã€‚&lt;/p&gt;
&lt;p&gt;Nginx æ˜¯å¤šè¿›ç¨‹æ¨¡å‹ï¼Œç›‘æ§ä¸‹è¿›ç¨‹çŠ¶æ€ï¼Œå½“æœ‰å¼‚å¸¸å‘ç”Ÿæ—¶èƒ½æ›´å¿«çš„å‘ç°ï¼Œè¿›ç¨‹è‹¥å¤„äº&lt;code&gt;D&lt;/code&gt;ï¼Œ&lt;code&gt;Z&lt;/code&gt;ï¼Œ&lt;code&gt;X&lt;/code&gt;ï¼Œ&lt;code&gt;T&lt;/code&gt;ç­‰çŠ¶æ€éœ€è¦æ³¨æ„ã€‚&lt;/p&gt;
&lt;h2&gt;å…¶ä»–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;CPU å„é¡¹æŒ‡æ ‡ï¼ˆsys,idle,iowait,si...ï¼‰&lt;/li&gt;
&lt;li&gt;ç³»ç»Ÿè´Ÿè½½ï¼ˆload)&lt;/li&gt;
&lt;li&gt;ç£ç›˜IO&lt;/li&gt;
&lt;li&gt;ç£ç›˜ç©ºé—´&lt;/li&gt;
&lt;li&gt;ç½‘å¡æµé‡ã€åŒ…é‡&lt;/li&gt;
&lt;li&gt;å…¨è¿æ¥é˜Ÿåˆ—ã€åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºç›‘æ§&lt;ul&gt;
&lt;li&gt;&lt;code&gt;netstat -s&lt;/code&gt;ï¼š"SYNs to LISTEN sockets droppedâ€ï¼Œ"times the listen queue of a socket overflowed"&lt;/li&gt;
&lt;li&gt;å‚è€ƒ&lt;a href="http://jm.taobao.org/2017/05/25/525-1/"&gt;å…³äºTCP åŠè¿æ¥é˜Ÿåˆ—å’Œå…¨è¿æ¥é˜Ÿåˆ—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åŸŸåè¿‡æœŸç›‘æ§ï¼Œéœ€è¦æ³¨æ„åŸŸåæœåŠ¡å•†æˆ–è€…DNSPod ä¹‹ç±»çš„è­¦å‘Šé‚®ä»¶ï¼Œæˆ–è€…å†™ä¸ªè„šæœ¬whois å®šæœŸæŸ¥è¯¢ï¼Œæˆ–è€…è®¾ä¸ªæ—¥å†ã€é—¹é’Ÿ&lt;/li&gt;
&lt;li&gt;SSL è¯ä¹¦æœ‰æ•ˆæœŸç›‘æ§ï¼Œå¯ä»¥è‡ªå·±å†™ä¸ªè„šæœ¬ç›‘æ§ï¼Œä½¿ç”¨&lt;code&gt;openssl&lt;/code&gt;å‘½ä»¤ï¼Œæˆ–è€…ç”¨ä¸‹é¢è¿™äº›åœ¨çº¿æœåŠ¡ï¼š&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.sslcloud.cn"&gt;SSL Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://certificatemonitor.org"&gt;Certificate Expiry Monitor&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å®šæœŸ&lt;code&gt;nginx -t&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.datadoghq.com/blog/how-to-monitor-nginx/"&gt;How to monitor NGINX&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2018"></category><category term="nginx"></category></entry><entry><title>drop_caches</title><link href="https://fangpsh.github.io/posts/2018/2018-01-25.html" rel="alternate"></link><published>2018-01-25T00:00:00+08:00</published><updated>2018-01-25T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-01-25:/posts/2018/2018-01-25.html</id><summary type="html">&lt;p&gt;&lt;img alt="atemyram" src="/assets/images/2023/20230228184158.png"&gt;
&lt;a href="https://www.linuxatemyram.com"&gt;Don't Panic! Your ram is fine!&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;é—®é¢˜æ’æŸ¥&lt;/h2&gt;
&lt;p&gt;ä¸€å°æœºå™¨çš„CPU iowait éå¸¸é«˜ï¼Œperf åˆ†æå‘ç°è€—æ—¶éƒ½åœ¨&lt;code&gt;isolate_freepages_block&lt;/code&gt; å‡½æ•°ï¼Œiostat çœ‹ç³»ç»Ÿç›˜çš„iops ä¹Ÿè¾¾åˆ°ç“¶é¢ˆï¼Œfree æŸ¥çœ‹æœºå™¨å†… â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="atemyram" src="/assets/images/2023/20230228184158.png"&gt;
&lt;a href="https://www.linuxatemyram.com"&gt;Don't Panic! Your ram is fine!&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;é—®é¢˜æ’æŸ¥&lt;/h2&gt;
&lt;p&gt;ä¸€å°æœºå™¨çš„CPU iowait éå¸¸é«˜ï¼Œperf åˆ†æå‘ç°è€—æ—¶éƒ½åœ¨&lt;code&gt;isolate_freepages_block&lt;/code&gt; å‡½æ•°ï¼Œiostat çœ‹ç³»ç»Ÿç›˜çš„iops ä¹Ÿè¾¾åˆ°ç“¶é¢ˆï¼Œfree æŸ¥çœ‹æœºå™¨å†…å­˜ buff/cache å äº†å¾ˆå¤§ä¸€éƒ¨åˆ†ï¼Œfree å¿«æ²¡äº†ã€‚ç½‘å‹çš„ç±»ä¼¼çŠ¶å†µï¼š &lt;a href="http://www.yangguanjun.com/2016/09/12/ceph-node-high-workload-issue/"&gt;CephèŠ‚ç‚¹loadå¾ˆé«˜é—®é¢˜çš„åˆ†æè§£å†³&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç¨‹åºå¯¹æ–‡ä»¶ç³»ç»Ÿå¤§é‡çš„éšæœºè¯»å†™ï¼Œ&lt;a href="https://en.wikipedia.org/wiki/Page_cache"&gt;page cache&lt;/a&gt; ä¸Šæ¶¨ï¼Œå†…å­˜åƒç´§ï¼Œpage cache ä¸æ–­æ¢å…¥æ¢å‡ºï¼Œç£ç›˜ç“¶é¢ˆï¼ŒCPU å µä½ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥ä¸´æ—¶drop æ‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo 1 &amp;gt; /proc/sys/vm/drop_caches
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æƒ³è¦ä¹Ÿé‡Šæ”¾è„é¡µï¼Œå…ˆæ‰§è¡Œ&lt;code&gt;sync&lt;/code&gt;ï¼Œå†dropã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This is a non-destructive operation and will not free any dirty objects.
To increase the number of objects freed by this operation, the user may run
`sync' prior to writing to /proc/sys/vm/drop_caches.  This will minimize the
number of dirty objects on the system and create more candidates to be
dropped.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦å¤–ä¸€ç§ç±»ä¼¼çš„æƒ…å†µæ˜¯reclaimable slab objects å ç”¨é«˜ï¼ˆdentriesï¼Œinodesï¼‰ï¼Œåˆ†æè¿‡ç¨‹å¯å‚è€ƒï¼š&lt;a href="http://colobu.com/2017/03/07/what-is-in-linux-cached/"&gt;è°åƒäº†æˆ‘çš„Linuxå†…å­˜?&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo 2 &amp;gt; /proc/sys/vm/drop_caches
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è§£å†³æ–¹æ³•ï¼Œæ¢å¤§å†…å­˜æœºå™¨ï¼Œæˆ–è€…æ…¢æ…¢è°ƒæ•´ç³»ç»Ÿçš„&lt;code&gt;proc/sys/vm/pagecache_limit*&lt;/code&gt; ç­‰å‚æ•°ï¼Œè¿˜æœ‰æ–‡ä»¶ç³»ç»Ÿçš„&lt;code&gt;/proc/sys/vm/dirty_*&lt;/code&gt;ï¼Œæ²¡å¤ªå¤šç»éªŒï¼Œçå­è¿‡æ²³ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;To free pagecache:
echo 1 &amp;gt; /proc/sys/vm/drop_caches
To free reclaimable slab objects (includes dentries and inodes):
echo 2 &amp;gt; /proc/sys/vm/drop_caches
To free slab objects and pagecache:
echo 3 &amp;gt; /proc/sys/vm/drop_caches
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é»˜è®¤å€¼æ˜¯0ï¼Œå†™å…¥1 drop pagecacheï¼Œå†™å…¥2 drop reclaimable slab objectsï¼Œå†™å…¥3 éƒ½é‡Šæ”¾ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;linux/fs/drop_caches.c&lt;/h2&gt;
&lt;h3&gt;é—®é¢˜ä¸€ï¼šecho å†™å…¥ä¹‹åï¼Œå€¼ä¸ä¼šå˜ï¼Œæ€ä¹ˆåŠï¼Ÿä¼šä¸ä¼šä¸€ç›´åœ¨dropï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ä¼šï¼Œçœ‹çœ‹ä»£ç ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/torvalds/linux/blob/master/fs/drop_caches.c#L39"&gt;linux/fs/drop_caches.c&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;drop_caches_sysctl_handler&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;struct&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;ctl_table&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;__user&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;loff_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;ppos&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;proc_dointvec_minmax&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;table&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;length&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ppos&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ret&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stfu&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sysctl_drop_caches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;iterate_supers&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;drop_pagecache_sb&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;count_vm_event&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DROP_PAGECACHE&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sysctl_drop_caches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;drop_slab&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;count_vm_event&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;DROP_SLAB&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;stfu&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="n"&gt;pr_info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;%s (%d): drop_caches: %d&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;comm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;task_pid_nr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;current&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="n"&gt;sysctl_drop_caches&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="n"&gt;stfu&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;|=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sysctl_drop_caches&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;write ä¸ºTrue çš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡Œdrop ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–&lt;a href="https://www.fsl.cs.sunysb.edu/kernel-api/re449.html"&gt;proc_dointvec_minmax()&lt;/a&gt; è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ£€æŸ¥ä¼ å…¥çš„å€¼ç¬¦åˆå¤§å°ï¼Œdrop_cache å…è®¸çš„å€¼æ˜¯1ï¼Œ2ï¼Œ3ï¼Œ4ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Reads/writes up to table-&amp;gt;maxlen/sizeof(unsigned int) integer values from/to the user buffer, treated as an ASCII string.&lt;br&gt;
This routine will ensure the values are within the range specified by table-&amp;gt;extra1 (min) and table-&amp;gt;extra2 (max).&lt;br&gt;
Returns 0 on success.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/torvalds/linux/blob/2ce079f04d5914dae14fdc8618f804cc0d2a1b8f/kernel/sysctl.c#L1399,L1407"&gt;linux/kernel/sysctl.c&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;procname&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;drop_caches&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;sysctl_drop_caches&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;maxlen&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mo"&gt;0644&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;proc_handler&lt;/span&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;drop_caches_sysctl_handler&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extra1&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;one&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extra2&lt;/span&gt;&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;four&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;},&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è™½ç„¶é»˜è®¤å€¼æ˜¯0ï¼Œä½†æ˜¯å¦‚æœä½ å°è¯•å†™å›0ï¼Œæ˜¯ä¼šå¤±è´¥çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-&amp;gt; echo 0 &amp;gt; /proc/sys/vm/drop_caches
echo: write error: invalid argument
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–å¯ä»¥çœ‹åˆ°&lt;code&gt;sysctl_drop_caches&lt;/code&gt; ä¸º3(11b) æ—¶ï¼Œå’Œ1ï¼Œ2 åš&amp;amp; æ“ä½œï¼Œéƒ½ä¸ºTrueï¼Œæ‰€ä»¥éƒ½ä¼šdropã€‚&lt;/p&gt;
&lt;h3&gt;é—®é¢˜äºŒï¼šecho å†™å…¥4ï¼Œæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ&lt;/h3&gt;
&lt;p&gt;4(100b)ï¼Œå’Œ1ï¼Œ2åš&amp;amp; æ“ä½œï¼Œéƒ½ä¸ºFalseï¼Œæ‰€ä»¥ä¸ä¼šdropï¼Œç›¸å½“äºå…³é—­äº†drop åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;stfu ä¸ºé™æ€å˜é‡ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡Œä¹‹åï¼Œstfu ä¸º4ï¼Œ&lt;code&gt;if (!stfu)&lt;/code&gt; ä¹Ÿå§‹ç»ˆä¸ºFalseã€‚ä¸è¿‡æ„Ÿè§‰è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œecho 4 ä¸€æ¬¡ä¹‹åï¼Œstfu ä¼šå§‹ç»ˆä¸º4ï¼Œå³ä½¿å†echo 1|2|3ï¼Œéƒ½æ— æ³•æ”¹å˜ï¼Œè™½ç„¶èƒ½æ­£å¸¸dropï¼Œä½†æ˜¯pr_info è¯­å¥æ— æ³•æ‰§è¡Œï¼Œdmesg çœ‹ä¸åˆ°æ—¥å¿—ï¼Œé™¤éé‡å¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;stfu |= sysctl_drop_caches &amp;amp; 4;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;h2&gt;å…¶ä»–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://hoytech.com/vmtouch/"&gt;vmtouch - the Virtual Memory Toucher&lt;/a&gt;ï¼Œè¿™ä¸ªå·¥å…·éå¸¸å¥½ç”¨&lt;/li&gt;
&lt;li&gt;&lt;a href="http://linuxperf.com/?p=142"&gt;/PROC/MEMINFOä¹‹è°œ&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« å¯¹ç³»ç»Ÿå†…å­˜ä»‹ç»çš„éå¸¸è¯¦ç»†&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å’Œè¿™ç¯‡ç¬”è®°ä¸»é¢˜æ— å…³çš„ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå€¼å¾—æ·±ç©¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://jaseywang.me/2012/10/21/numa-åœ¨-db-ä¸Šçš„ä¸€äº›é—®é¢˜/"&gt;NUMA åœ¨ DB ä¸Šçš„ä¸€äº›é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://cenalulu.github.io/linux/numa/"&gt;NUMAæ¶æ„çš„CPU -- ä½ çœŸçš„ç”¨å¥½äº†ä¹ˆï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://zhangliyong.github.io/posts/2014/04/09/mongodb-numa-dao-zhi-de-xing-neng-wen-ti.html"&gt;Mongodb NUMA å¯¼è‡´çš„æ€§èƒ½é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href="https://www.kernel.org/doc/Documentation/sysctl/vm.txt"&gt;kernel.org/doc/Documentation/sysctl/vm.txt&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;drop_caches

Writing to this will cause the kernel to drop clean caches, as well as
reclaimable slab objects like dentries and inodes.  Once dropped, their
memory becomes free.

To free pagecache:
echo 1 &amp;gt; /proc/sys/vm/drop_caches
To free reclaimable slab objects (includes dentries and inodes):
echo 2 &amp;gt; /proc/sys/vm/drop_caches
To free slab objects and pagecache:
echo 3 &amp;gt; /proc/sys/vm/drop_caches

This is a non-destructive operation and will not free any dirty objects.
To increase the number of objects freed by this operation, the user may run
`sync&amp;#39; prior to writing to /proc/sys/vm/drop_caches.  This will minimize the
number of dirty objects on the system and create more candidates to be
dropped.

This file is not a means to control the growth of the various kernel caches
(inodes, dentries, pagecache, etc...)  These objects are automatically
reclaimed by the kernel when memory is needed elsewhere on the system.

Use of this file can cause performance problems.  Since it discards cached
objects, it may cost a significant amount of I/O and CPU to recreate the
dropped objects, especially if they were under heavy use.  Because of this,
use outside of a testing or debugging environment is not recommended.

You may see informational messages in your kernel log when this file is
used:

cat (1234): drop_caches: 3

These are informational only.  They do not mean that anything is wrong
with your system.  To disable them, echo 4 (bit 3) into drop_caches.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2018"></category><category term="linux"></category></entry><entry><title>å…³äºBash ä½ éœ€è¦çŸ¥é“çš„åä»¶äº‹</title><link href="https://fangpsh.github.io/posts/2018/2018-01-22.html" rel="alternate"></link><published>2018-01-22T00:00:00+08:00</published><updated>2018-01-22T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-01-22:/posts/2018/2018-01-22.html</id><summary type="html">&lt;p&gt;è¯»åˆ°ä¸€ç¯‡æ–‡ç« &lt;a href="https://zwischenzugs.com/2018/01/06/ten-things-i-wish-id-known-about-bash/"&gt;ã€ŠTen Things I Wish Iâ€™d Known About bashã€‹&lt;/a&gt;ï¼Œæ‰€ä»¥æœ‰äº†è¿™ä¸ªç•…é”€ä¹¦å¼çš„æ ‡é¢˜ï¼Œä¸€äº›ç¬”è®°ã€‚&lt;br&gt;
æ„Ÿè§‰ä½œè€…å†™è¿™æœ¬ä¹¦ä¸»è¦æ˜¯ä¸ºäº†æ¨é”€ä»–çš„æ–° â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¯»åˆ°ä¸€ç¯‡æ–‡ç« &lt;a href="https://zwischenzugs.com/2018/01/06/ten-things-i-wish-id-known-about-bash/"&gt;ã€ŠTen Things I Wish Iâ€™d Known About bashã€‹&lt;/a&gt;ï¼Œæ‰€ä»¥æœ‰äº†è¿™ä¸ªç•…é”€ä¹¦å¼çš„æ ‡é¢˜ï¼Œä¸€äº›ç¬”è®°ã€‚&lt;br&gt;
æ„Ÿè§‰ä½œè€…å†™è¿™æœ¬ä¹¦ä¸»è¦æ˜¯ä¸ºäº†æ¨é”€ä»–çš„æ–°ä¹¦&lt;a href="https://leanpub.com/learnbashthehardway"&gt;ã€ŠLearn Bash the Hard Wayã€‹&lt;/a&gt;ï¼Œä¸è¿‡å…¶ä¸­åä¸ªå…³äºBash çš„ç‚¹ï¼Œå€’æ˜¯æŒºæœ‰è¶£ã€‚&lt;/p&gt;
&lt;h2&gt;1) ` ` vs $()&lt;/h2&gt;
&lt;p&gt;è¿™2ä¸ªç¬¦å·çš„æ•ˆæœä¸€æ ·ï¼Œå®ƒä»¬åŒ…å«çš„å†…å®¹éƒ½ä¼šè¢«æ‰§è¡Œï¼Œç„¶åå†æŠŠç»“æœèµ‹å€¼ç»™å˜é‡ï¼Œæˆ–è€…ä¼ é€’ç»™å…¶ä»–å‘½ä»¤ï¼Œå¾ˆå¸¸ç”¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo `ls`
$ echo $(ls)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä¸ªäººå¸¸ç”¨&lt;code&gt;` `&lt;/code&gt;ï¼Œ$() ä¸å¸¸ç”¨ï¼Œå®ƒä»¬2ä¸ªæœ‰å•¥åŒºåˆ«å‘¢ï¼Ÿçœ‹ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo `echo \`echo \\\`echo inside\\\`\``

$ echo $(echo $(echo $(echo inside)))
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;2æ¡è¯­å¥æ•ˆæœä¸€æ ·ï¼Œä¸è¿‡åè€…å¯è¯»æ€§æ˜æ˜¾å¥½å¤ªå¤šï¼Œä»¥åå†™è¿™ç§åµŒå¥—å‘½ä»¤çš„æ—¶å€™ï¼Œç”¨&lt;code&gt;$()&lt;/code&gt;å§ï¼Œä¸ç„¶debug èµ·æ¥å¾—ççœ¼ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://mywiki.wooledge.org/BashFAQ/082"&gt;Why is $(...) preferred over `...` (backticks)?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://stackoverflow.com/questions/4708549/what-is-the-difference-between-command-and-command-in-shell-programming"&gt;What is the difference between $(command) and `command` in shell programming?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸ªå°æ’æ›²ï¼Œæˆ‘ä¸çŸ¥é“æ€ä¹ˆç”¨Markdown å†™å‡ºåå¼•å·ï¼ˆbackticksï¼‰å†…ä¸€å¯¹åå¼•å·çš„æ•ˆæœ: &lt;code&gt;` `&lt;/code&gt; ï¼Œå‘äº†ä¸€æ¡tweetï¼Œå¾—åˆ°äº†ç­”æ¡ˆï¼Œè¿™ä¸ªç¬¦å·å¥½åƒä¹Ÿå¯ä»¥å«ï¼š&lt;a href="https://en.wikipedia.org/wiki/Double_grave_accent"&gt;grave accent&lt;/a&gt;ï¼Œæ²‰éŸ³ç¬¦ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;`` ` ` `` 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;2) é€šé…ç¬¦ vs æ­£åˆ™è¡¨è¾¾å¼&lt;/h2&gt;
&lt;p&gt;è¿™2ä¸ªæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ä¸œè¥¿ï¼Œä¸æ‡‚ä½œè€…è¯´å®¹æ˜“ææ··ã€‚ã€‚ã€‚ä½œè€…ç»™çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#è¾“å‡ºç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶&lt;/span&gt;
$&lt;span class="w"&gt; &lt;/span&gt;ls&lt;span class="w"&gt; &lt;/span&gt;*

&lt;span class="c1"&gt;#è¾“å‡ºç›®å½•ä¸‹æ‰€æœ‰ä»¥. å¼€å¤´çš„æ–‡ä»¶ï¼Œæ˜¯é€šé…ç¬¦ï¼Œä¸æ˜¯æ­£åˆ™&lt;/span&gt;
$&lt;span class="w"&gt; &lt;/span&gt;ls&lt;span class="w"&gt; &lt;/span&gt;.*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;3) è¿”å›ç ï¼ˆExit Codesï¼‰&lt;/h2&gt;
&lt;p&gt;Bash çš„ä¸–ç•Œï¼Œ0 æ˜¯æ­£å¸¸ï¼Œé0 æ˜¯å¼‚å¸¸ã€‚&lt;code&gt;echo $?&lt;/code&gt; å¯ä»¥å¾—åˆ°ä¸Šä¸€æ¡å‘½ä»¤çš„è¿”å›ç ã€‚å…¶å®æ˜¯ä¸æ˜¯åº”è¯¥æŒ‰ç…§ç¿»è¯‘å«é€€å‡ºç ï¼Œä¸è¿‡ç¼–è¯‘è¯­è¨€é‡Œ&lt;code&gt;return&lt;/code&gt; éƒ½å«è¿”å›ç å˜›ã€‚&lt;/p&gt;
&lt;p&gt;å¸¸å¸¸ç”¨grep çš„è¿”å›ç æ¥åˆ¤æ–­ç‰¹å®šå†…å®¹æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å› ä¸ºå¦‚æœå­˜åœ¨grep ä¼šè¿”å›0ï¼Œä¸å­˜åœ¨è¿”å›1ï¼Œæ”¾åœ¨if è¯­å¥é‡Œé¢ï¼Œéå¸¸ç›´è§‚ã€æ–¹ä¾¿ï¼è§ä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;h2&gt;4) if è¯­å¥ï¼Œ[ å’Œ [[&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;not_there&lt;span class="w"&gt; &lt;/span&gt;/dev/null
&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;hi
&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;lo
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸Šè„šæœ¬æ‰§è¡Œï¼Œè¾“å‡ºlo ï¼Œéå¸¸ç›´è§‚æœ‰æœ¨æœ‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;[&lt;/code&gt; å’Œ&lt;code&gt;[[&lt;/code&gt; çš„å·®åˆ«ï¼Œå‰è€…å¥½åƒæ˜¯å†…ç½®å‘½ä»¤ï¼Œåè€…æ˜¯å…³é”®è¯ï¼Œä¸€èˆ¬å°½é‡ç”¨åè€…å°±æ˜¯äº†ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚è¯¦ç»†åŒºåˆ«å¯¹æ¯”ï¼š&lt;a href="http://blog.csdn.net/hittata/article/details/8049665"&gt;BASH ä¸­å•æ‹¬å·å’ŒåŒæ‹¬å·&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;# ç›´æ¥æ‰§è¡Œä¼šå‡ºé”™ï¼Œ$(grep note_there /dev/null) è¾“å‡ºä¸ºç©ºï¼Œå°±å˜æˆäº†[ = &amp;#39;&amp;#39; ] ï¼Œ&lt;/span&gt;
&lt;span class="c1"&gt;# è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¸¸å¸¸åœ¨ä¸€äº›è€è„šæœ¬é‡Œé¢çœ‹åˆ°è¿™æ ·çš„è¯­å¥ï¼š [ x$(...) = &amp;#39;&amp;#39;]&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;not_there&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;hi
&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;lo
&lt;span class="k"&gt;fi&lt;/span&gt;


&lt;span class="c1"&gt;# [[ å°±æ²¡æœ‰ä»¥ä¸Šå›°æ‰°&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;not_there&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;hi
&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;lo
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;5) set&lt;/h2&gt;
&lt;p&gt;è„šæœ¬å¼€å¤´æˆ‘ä¸€èˆ¬éƒ½ä¼šåŠ ä¸Šï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;set -eu
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;-u è¡¨ç¤ºé‡åˆ°æ²¡å®šä¹‰çš„å˜é‡çš„æ—¶å€™ï¼Œç›´æ¥é€€å‡ºï¼Œå¯ä»¥é˜²æ­¢å¦‚ä¸‹çš„æ‚²å‰§ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;rm -rf ${ROOT}/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœ&lt;code&gt;${ROOT}&lt;/code&gt; æ²¡èµ‹å€¼ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;-e è¡¨ç¤ºæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°é0 çš„é€€å‡ºçŠ¶æ€ç ï¼Œç›´æ¥é€€å‡ºï¼Œç»“æŸæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥é˜²æ­¢æŸäº›å¼‚å¸¸æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;å®Œæ•´çš„é€‰æ‹©åˆ—è¡¨å’Œè§£é‡Šï¼š&lt;a href="http://tldp.org/LDP/abs/html/options.html"&gt;Advanced Bash-Scripting Guide: Chapter 33. Options&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;6) &amp;lt;()&lt;/h2&gt;
&lt;p&gt;ä½œè€…è¯´çš„è¿™ä¸ªæˆ‘å€’ä¸å¸¸ç”¨ï¼Œçœ‹èµ·æ¥æŒºæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;somestring&lt;span class="w"&gt; &lt;/span&gt;file1&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/tmp/a
$&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;somestring&lt;span class="w"&gt; &lt;/span&gt;file2&lt;span class="w"&gt; &lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/tmp/b
$&lt;span class="w"&gt; &lt;/span&gt;diff&lt;span class="w"&gt; &lt;/span&gt;/tmp/a&lt;span class="w"&gt; &lt;/span&gt;/tmp/b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥ç®€åŒ–ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;diff&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;&lt;span class="o"&gt;(&lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;somestring&lt;span class="w"&gt; &lt;/span&gt;file1&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&amp;lt;&lt;span class="o"&gt;(&lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;somestring&lt;span class="w"&gt; &lt;/span&gt;file2&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;7) Quoting&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;A=&amp;#39;123&amp;#39;
echo &amp;quot;$A&amp;quot;
echo &amp;#39;$A&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å•å¼•å·é‡Œé¢çš„å†…å®¹ä¸ä¼šå±•å¼€ï¼Œè¾“å‡ºç»“æœä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;123
$A
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½œè€…æ–‡ç« é‡Œé¢è¿™ä¸ªä¾‹å­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mkdir -p tmp
cd tmp
touch a
echo &amp;quot;*&amp;quot;
echo &amp;#39;*&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸çŸ¥é“æ˜¯å› ä¸ºç‰ˆæœ¬åŸå› è¿˜æ˜¯é…ç½®é—®é¢˜ï¼Œåœ¨æˆ‘çš„æœºå™¨ä¸Šæµ‹è¯•ï¼Œéƒ½æ˜¯è¾“å‡º &lt;code&gt;*&lt;/code&gt;ï¼Œä½œè€…è¯´çš„æ„æƒ³ä¸åˆ°çš„ç»“æœå¤§æ¦‚æ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo *
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¼šè¾“å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶åã€‚&lt;/p&gt;
&lt;h2&gt;8) æœ€å¸¸ç”¨çš„ä¸‰ä¸ªå¿«æ·æ“ä½œ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;!!&lt;/code&gt;,é‡å¤æ‰§è¡Œä¸Šä¸€æ¡å‘½ä»¤&lt;/li&gt;
&lt;li&gt;&lt;code&gt;~&lt;/code&gt;ï¼Œå±•å¼€ä¸ºå½“å‰ç”¨æˆ·çš„home ç›®å½•&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œè€…åˆ—äº†ä»–æœ€å¸¸ç”¨çš„3ä¸ªå¿«æ·æ“ä½œï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;!@&lt;/code&gt;ï¼Œå±•å¼€ä¸ºä¸Šä¸€æ¡å‘½ä»¤çš„æ‰€æœ‰å‚æ•°ï¼›&lt;/li&gt;
&lt;li&gt;&lt;code&gt;!:1-$&lt;/code&gt;ï¼šè¿™æ¡å‘½ä»¤çœ‹ç€æœ‰ç‚¹å¤æ‚ï¼Œ&lt;code&gt;!&lt;/code&gt;è¡¨ç¤ºä¸Šä¸€æ¡å‘½ä»¤ï¼Œ&lt;code&gt;:&lt;/code&gt;æ˜¯åˆ†éš”ç¬¦ï¼Œåé¢å°±æ˜¯è¡¨ç¤ºå–åˆ°ç¬¬å‡ ä½ã€‚&lt;ul&gt;
&lt;li&gt;&lt;code&gt;!:2-3&lt;/code&gt;ï¼Œå±•å¼€ä¸ºä¸Šä¸€æ¡å‘½ä»¤çš„å‚æ•°ä¸­çš„ç¬¬2åˆ°ç¬¬3ä½çš„å†…å®¹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;bash-3.2$ echo 1 2 3 4 5
1 2 3 4 5
bash-3.2$ echo !:2-3
2 3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:h&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;grep isthere /long/path/to/some/file/or/other.txt
cd !$:h
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;!$:h&lt;/code&gt; å±•å¼€ä¸º ä¸Šä¸€æ¡å‘½ä»¤æœ€åä¸€ä¸ªå‚æ•°çš„ç›®å½•è·¯å¾„ï¼š"/long/path/to/some/file/or"ã€‚&lt;/p&gt;
&lt;h2&gt;9) å¯åŠ¨é¡ºåº&lt;/h2&gt;
&lt;p&gt;&lt;img alt="shell-startup-actual" src="/assets/images/2023/20230228182436.png"&gt;&lt;/p&gt;
&lt;p&gt;ä½œè€…æ”¾äº†1ä¸ªå›¾ï¼Œå·¦è¾¹æ˜¯Bashï¼Œå³è¾¹æ˜¯Zshï¼Œæ¥æºæ˜¯ï¼š&lt;a href="https://blog.flowblok.id.au/2013-02/shell-startup-scripts.html"&gt;Shell startup scripts&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;éå¸¸æœ‰è¶£ã€ç›´è§‚ï¼Œé¡ºç€ä¸€ç§é¢œè‰²çœ‹ï¼ŒBash å¯åŠ¨è¿‡ç¨‹ï¼ŒæœŸé—´åŠ è½½çš„æ–‡ä»¶ï¼Œä¸€ç›®äº†ç„¶ã€‚è¯»è¿™ç¯‡æ–‡ç« ï¼Œæœ€å¤§çš„æ”¶è·å°±æ˜¯è§åˆ°è¿™å¼ å›¾ã€‚&lt;/p&gt;
&lt;h2&gt;10) getopts (cheapci)&lt;/h2&gt;
&lt;p&gt;ä½œè€…è¯´çš„&lt;a href="https://github.com/ianmiell/cheapci"&gt;chepci&lt;/a&gt; è¿™ä¸ªé¡¹ç›®æ²¡å’‹çœ‹ï¼Œä¸è¿‡è¿™æ®µè„šæœ¬é‡Œçš„ç‰‡æ®µ å¯ä»¥ä½œä¸ºå­¦ä¹ getopts çš„&lt;a href="https://github.com/ianmiell/cheapci/blob/master/cheapci#L33-L95"&gt;ä¾‹å­&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="bash"></category><category term="shell"></category><category term="linux"></category></entry><entry><title>HAProxy in 2018</title><link href="https://fangpsh.github.io/posts/2018/2018-01-17.html" rel="alternate"></link><published>2018-01-17T00:00:00+08:00</published><updated>2018-01-17T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-01-17:/posts/2018/2018-01-17.html</id><summary type="html">&lt;p&gt;&lt;img alt="haproxy_in_2018" src="https://raw.githubusercontent.com/roOtPasswd/test/public-images/images/2023/20230302145902.jpg"&gt;  &lt;/p&gt;
&lt;p&gt;ä¹‹å‰åœ¨Twitter ä¸Šæœ‰çœ‹åˆ°HAProxy å®˜æ–¹å·å‘&lt;a href="https://twitter.com/haproxy_tech/status/925760917614354434"&gt;tweet&lt;/a&gt;ï¼Œè¯´æ–°ç‰ˆæ”¯æŒHTTP/2 äº†ï¼Œå½“æ—¶æ²¡åœ¨æ„ï¼Œäººå®¶Nginx ä¸€å¹´å‰å°±æ”¯æŒäº†å¥½å§ï¼Œä½ æ‰æ¥ã€‚æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç«  â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="haproxy_in_2018" src="https://raw.githubusercontent.com/roOtPasswd/test/public-images/images/2023/20230302145902.jpg"&gt;  &lt;/p&gt;
&lt;p&gt;ä¹‹å‰åœ¨Twitter ä¸Šæœ‰çœ‹åˆ°HAProxy å®˜æ–¹å·å‘&lt;a href="https://twitter.com/haproxy_tech/status/925760917614354434"&gt;tweet&lt;/a&gt;ï¼Œè¯´æ–°ç‰ˆæ”¯æŒHTTP/2 äº†ï¼Œå½“æ—¶æ²¡åœ¨æ„ï¼Œäººå®¶Nginx ä¸€å¹´å‰å°±æ”¯æŒäº†å¥½å§ï¼Œä½ æ‰æ¥ã€‚æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼Œ&lt;a href="https://certsimple.com/blog/haproxy-http2-dynamic-load-balancing-ssl"&gt;CertSimple: HAProxy in 2018&lt;/a&gt;ï¼Œå¹äº†ä¸€å‘HAProxyã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.mail-archive.com/haproxy@formilux.org/msg28004.html"&gt;ANNOUNCE haproxy-1.8.0&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.haproxy.com/blog/whats-new-haproxy-1-8/"&gt;Whatâ€™s New in HAProxy 1.8&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.haproxy.com/blog/multithreading-in-haproxy/"&gt;Multithreading in HAProxy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.8 æä¾›äº†å®Œæ•´çš„ HTTP/2 æ”¯æŒï¼Œä¸çŸ¥é“bug å¤šä¸å¤šï¼Œè®°å¾—Nginx åˆšåˆšæ”¯æŒHTTP/2 æ—¶ä¿®äº†å¾ˆå¤šbugã€‚&lt;br&gt;
å¦å¤–ä¸€ä¸ªé‡å¤§çš„å˜åŒ–æ˜¯Multithreadingï¼Œå¤šçº¿ç¨‹æ”¯æŒã€‚HAProxy æ”¯æŒå¤šè¿›ç¨‹ï¼ˆnbprocï¼‰ï¼Œæœ‰å‡ ä¸ªé—®é¢˜ï¼Œç›‘æ§æ£€æŸ¥æ˜¯æ¯ä¸ªè¿›ç¨‹è‡ªå·±åšçš„ï¼Œç»Ÿè®¡é¡µé¢ä¹Ÿä¸å‡†ç¡®ï¼Œmaxconn å‚æ•°ä¹Ÿåªèƒ½é™åˆ¶å•ä¸ªè¿›ç¨‹ã€‚åœ¨å‰å…¬å¸ç”¨åˆ°HAProxy çš„æ—¶å€™ï¼Œå°±å› ä¸ºè¿™äº›é—®é¢˜ï¼ŒæŠŠå¤šè¿›ç¨‹å…³äº†ã€‚å¤šçº¿ç¨‹å°±å¥½äº†ï¼Œæ²¡äº†è¿™äº›é—®é¢˜ï¼Œä¾ç„¶èƒ½å……åˆ†åˆ©ç”¨CPUã€‚  &lt;/p&gt;
&lt;p&gt;1.8 è¿˜åŠ äº†ä¸€ä¸ªMaster/Worker Modeï¼Œç±»ä¼¼Nginx çš„è¿›ç¨‹æ¨¡å‹ï¼Œä¸€ä¸ªMaster + å¤šä¸ª Workerã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps axf -o pid,command
15012      \_ haproxy -f ./master.cfg -d
15013          \_ haproxy -f ./master.cfg -d
15014          \_ haproxy -f ./master.cfg -d
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ®è¯´æ˜¯ä¸ºäº†è§£å†³ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;But this wasnâ€™t really convenient in cases where 3rd party software was monitoring and controlling the HAProxy processes (e.g. needing to reload them) as it had to be aware of HAProxyâ€™s individual processes and control each one separately. One of the examples in this category was certainly systemd.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç®¡ç†è¿›ç¨‹çš„æ—¶å€™èƒ½æ–¹ä¾¿ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;CertSimple é‚£ç¯‡æ–‡ç« å¯¹æ¯”HAProxy å’ŒNginxï¼Œåæ§½Nginx é»˜è®¤çš„status é¡µé¢å¤ªç®€å•ï¼Œè¿™ä¸ªå€’æ˜¯çœŸçš„ã€‚HAProxy çš„ç»Ÿè®¡é¡µé¢ç¡®å®éå¸¸è¯¦ç»†ã€‚
&lt;img alt="haproxy_stats" src="https://raw.githubusercontent.com/roOtPasswd/test/public-images/images/2023/20230302145934.png"&gt;&lt;br&gt;
å›¾ç‰‡æ¥æº&lt;a href="https://www.datadoghq.com/blog/how-to-collect-haproxy-metrics/#stats-page"&gt;datadoghq.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HAProxy æä¾›äº†api æ¥åŠ¨æ€çš„ç®¡ç†ã€é…ç½®æœºå™¨ï¼ŒNginx çš„åŠ¨æ€Upstream è¿˜å¾—ç”¨æ’ä»¶æåŠå¤©ï¼Œå‚è€ƒ&lt;a href="http://haproxy.tech-notes.net/9-2-unix-socket-commands/"&gt;9.2. Unix Socket commands&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºHaproxy ç›‘æ§çš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href="https://www.datadoghq.com/blog/how-to-collect-haproxy-metrics/"&gt;How to collect HAProxy metrics&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;echo "show stat" | nc -U /var/run/haproxy.sock&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;HAProxy æ—¥å¿—è¾“å‡ºä¹Ÿæ¯”Nginx è¯¦ç»†å¾ˆå¤šï¼Œå¹¶éå¸¸ç²¾ç®€ï¼Œæ¯æ¬¡åˆ†æHAProxy çš„æ—¥å¿—ï¼Œéƒ½å¾—æ‰“å¼€å®ƒçš„æ–‡æ¡£ï¼Œä¸€ä¸ªå­—ç¬¦ä¸€ä¸ªå­—ç¬¦çš„æŸ¥çœ‹å¯¹æ¯”ï¼Œç‰¹åˆ«æ˜¯é‚£ä¸€å †Flagï¼Œéå¸¸æœ‰ç”¨ï¼ŒCCã€CDã€cDã€sQ ç­‰ï¼Œå› ä¸ºHaproxy åœ¨åç«¯å’Œå®¢æˆ·ä¸­é—´ï¼Œå‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œåˆ°åº•æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯çš„é—®é¢˜ï¼Œé€šè¿‡è¿™äº›æ ‡å¿—éå¸¸æ–¹ä¾¿ï¼Œå‚è€ƒ&lt;a href="https://cbonte.github.io/haproxy-dconv/1.7/configuration.html#8.5"&gt;Session state at disconnection&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;HAProxy ä½œä¸ºä¸€ä¸ªçº¯ç²¹çš„å‰ç«¯è´Ÿè½½å‡è¡¡å™¨ï¼Œå¯èƒ½æ¯”Nginx å‡ºè‰²å¾ˆå¤šï¼Œä¸è¿‡åœ¨Web Server æ–¹é¢ï¼ŒHAProxy éš¾ä»¥æœ›å…¶é¡¹èƒŒã€‚&lt;/p&gt;
&lt;p&gt;æœ‰æœºä¼šä¸€å®šè¦è¯•ä¸€è¯•HAProxy 1.8ã€‚&lt;/p&gt;</content><category term="2018"></category><category term="haproxy"></category></entry><entry><title>Ngxfmt</title><link href="https://fangpsh.github.io/posts/2018/2018-01-11.html" rel="alternate"></link><published>2018-01-11T00:00:00+08:00</published><updated>2018-01-11T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2018-01-11:/posts/2018/2018-01-11.html</id><summary type="html">&lt;p&gt;æ¥æ‰‹ä¸€å¨ç¼©è¿›ã€æ ¼å¼ä¹±ä¸ƒå…«ç³Ÿçš„Nginx é…ç½®ï¼Œç®€ç›´è¦å‘½ã€‚æƒ³èµ·golang æœ‰ä¸€ä¸ªgofmtï¼ŒåŠ¨æ‰‹åšä¸€ä¸ªç®€å•çš„ngxfmtã€‚&lt;/p&gt;
&lt;p&gt;Nginx çš„é…ç½®è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œåˆ†ä¸ºå—é… â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æ¥æ‰‹ä¸€å¨ç¼©è¿›ã€æ ¼å¼ä¹±ä¸ƒå…«ç³Ÿçš„Nginx é…ç½®ï¼Œç®€ç›´è¦å‘½ã€‚æƒ³èµ·golang æœ‰ä¸€ä¸ªgofmtï¼ŒåŠ¨æ‰‹åšä¸€ä¸ªç®€å•çš„ngxfmtã€‚&lt;/p&gt;
&lt;p&gt;Nginx çš„é…ç½®è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œåˆ†ä¸ºå—é…ç½®å’Œç®€å•é…ç½®ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;server { # simple reverse-proxy
    listen       80;
    server_name  domain2.com www.domain2.com;
    access_log   logs/domain2.access.log  main;

    # serve static files
    location ~ ^/(/images|javascript|js|css|flash|media|static)/  {
       root    /var/www/virtual/big.server.com/htdocs;
       expires 30d;
    }

    # pass requests for dynamic content to rails/turbogears/zope, et al
    location / {
        proxy_pass      http://127.0.0.1:8080;
    }
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;listen&lt;/code&gt;, &lt;code&gt;server_name&lt;/code&gt; è¿™ç§æ˜¯ç®€å•é…ç½®ï¼Œä»¥åˆ†å·ç»“å°¾ï¼›&lt;code&gt;server&lt;/code&gt;ï¼Œ&lt;code&gt;locaiton&lt;/code&gt; è¿™ç§ä¸ºå—é…ç½®ï¼Œå¸¦ä¸€å¯¹å°æ‹¬å·ã€‚å†™è¿‡nginx æ’ä»¶æˆ–è€…çœ‹è¿‡&lt;a href="http://lxr.nginx.org/source/src/core/ngx_conf_file.c"&gt;ngx_conf_parse&lt;/a&gt; å¯¹nginx çš„é…ç½®åŠ è½½ä¼šæ›´äº†è§£ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æ¯•ä¸šå¿«3å¹´ï¼Œå¿½ç„¶ååˆ†æƒ³å¿µç¼–è¯‘åŸç†è€å¸ˆï¼Œè¯­æ³•åˆ†æï¼Œè¯æ³•åˆ†æï¼ŒLRï¼Œyaccï¼Œlex  ä»€ä¹ˆçš„ã€‚ç„¶è€Œç¼–è¯‘åŸç†é¾™ä¹¦æ—©è¢«æˆ‘å–äº†ï¼Œä¹°é¸¡è‚‰å·åƒã€‚å¬è¯´å¿«ä¹åŸºå€’é—­äº†ï¼Ÿï¼Ÿå¯æƒœå¯æƒœã€‚&lt;/p&gt;
&lt;p&gt;åªèƒ½éå¸¸ä¸ä¼˜é›…çš„è§£å†³ï¼Œä»ä¸Šå¾€ä¸‹æ‰‹åŠ¨æ’¸ï¼Œå¤„ç†å¥½ç¼©è¿›ï¼Œæ¸…æ¥šå¤šä½™çš„ç©ºæ ¼ï¼Œå†æ•´ä¸€ä¸‹å·¦å¯¹é½å°±å¥½äº†ã€‚åƒä¸€ä¸ªé¸¡è‚‰å·çš„æ—¶é—´å°±èƒ½æ’¸å¥½ğŸ” ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="ngxfmt" src="/assets/images/2023/20230301164340.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;log_format&lt;/code&gt; è¿™æ¢è¡Œå¯ä»¥è¯´æ˜¯éå¸¸èˆ’æœäº†ğŸ˜Œ  ï¼Œ&lt;code&gt;gzip_types&lt;/code&gt; è¿™å¯¹é½èƒ½è®©äººé«˜æ½®ğŸ† ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="ngxfmt-2" src="/assets/images/2023/20230301165631.png"&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å‰å…¬å¸æ›¾ç»ä¸‰ä¸ªäº§å“çº¿è¦å†™åˆ°ä¸€ä¸ªserver é‡Œé¢ï¼Œ&lt;code&gt;server_name&lt;/code&gt; é•¿åˆ°è®©äººç»æœ›ğŸ˜­ ï¼Œè€Œä¸”å¶å°”è¿˜å¾—æ”¹æ”¹ï¼Œè¿™æ ·æ¢è¡Œå°±æ¸…çˆ½å¤šäº†ğŸƒ ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸é‚»çš„é…ç½®é¡¹å¦‚æœä¸€æ ·ï¼Œå¯¹æ‰€æœ‰çš„å€¼éƒ½è¿›è¡Œå·¦å¯¹é½å¤„ç†ï¼Œåƒè¿™æ ·â¬‡ï¸  ï¼š&lt;br&gt;
&lt;img alt="ngxfmt-2" src="/assets/images/2023/20230301165710.png"&gt;&lt;/p&gt;
&lt;p&gt;æºä»£ç ğŸ™  ï¼š&lt;a href="https://github.com/fangpsh/ngxfmt"&gt;fangpsh/ngxfmt&lt;/a&gt;ï¼Œ&lt;br&gt;
æœ‰ç‚¹ä¹±ï¼Œå›å¤´å†çœ‹ä¼°è®¡ä¼šè¢«æ¶å¿ƒåˆ°ï¼Œå°±åƒä¸€æ¬¡æ€§åƒäº†3ä¸ªé¸¡è‚‰å·ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä»–ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.nginx.com/resources/wiki/start/topics/examples/full/"&gt;Full Example Configuration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/chr4/nginx.vim/blob/master/syntax/nginx.vim"&gt;nginx.vim&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.kancloud.cn/digest/understandingnginx/202597"&gt;Nginx é…ç½®è§£æ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2018"></category><category term="nginx"></category><category term="python"></category></entry><entry><title>æŠ“å–å¾®åšï¼ŒåŒæ­¥åˆ°Twitter</title><link href="https://fangpsh.github.io/posts/2017/2017-12-21.html" rel="alternate"></link><published>2017-12-21T00:00:00+08:00</published><updated>2017-12-21T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-12-21:/posts/2017/2017-12-21.html</id><summary type="html">&lt;p&gt;&lt;img alt="zelda" src="/assets/images/2023/20230306161433.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å‰å‡ ä¸ªæœˆä¹°äº†&lt;a href="https://www.nintendo.co.jp/hardware/switch/"&gt;NintendoSwitch&lt;/a&gt;ï¼Œæ²‰è¿·äºâ€œå¡å°”è¾¾-è’é‡ä¹‹æ¯â€ä¸èƒ½è‡ªæ‹”ï¼ŒåŒæ—¶ä¹Ÿå…³æ³¨ç€NS æ–°æ¸¸æˆçš„èµ„è®¯ã€‚
å¾®åšä¸Šæœ‰å‡ ä¸ªå¸å·ä¼šå‘å¸ƒå„ç§NS æ¸¸æˆ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="zelda" src="/assets/images/2023/20230306161433.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å‰å‡ ä¸ªæœˆä¹°äº†&lt;a href="https://www.nintendo.co.jp/hardware/switch/"&gt;NintendoSwitch&lt;/a&gt;ï¼Œæ²‰è¿·äºâ€œå¡å°”è¾¾-è’é‡ä¹‹æ¯â€ä¸èƒ½è‡ªæ‹”ï¼ŒåŒæ—¶ä¹Ÿå…³æ³¨ç€NS æ–°æ¸¸æˆçš„èµ„è®¯ã€‚
å¾®åšä¸Šæœ‰å‡ ä¸ªå¸å·ä¼šå‘å¸ƒå„ç§NS æ¸¸æˆä¿¡æ¯ï¼Œä¸è¿‡å¾®åšåšçš„å’ŒğŸ’© ä¸€æ ·ï¼Œå®Œå…¨ä¸æƒ³ç”¨ã€‚è”ç³»äº†é‚£å‡ ä¸ªå¾®åšåšä¸»ï¼Œè¯¢é—®æ˜¯å¦è€ƒè™‘ä¹ŸåŒæ­¥å‘åœ¨Twitterï¼Œæ²¡ç†æˆ‘ï¼Œé‚£å°±è‡ªå·±åŠ¨æ‰‹å§ã€‚&lt;/p&gt;
&lt;h2&gt;çˆ¬å–å¾®åš&lt;/h2&gt;
&lt;p&gt;æœ¬æ¥è¿˜ä»¥ä¸ºå¾—æ‰‹åŠ¨è§£æç½‘é¡µï¼Œå¶å°”å‘ç°ç§»åŠ¨ç‰ˆå±…ç„¶æœ‰ç°æˆçš„API å¯ä»¥ç”¨ï¼Œååˆ†é…¸çˆ½ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;https://m.weibo.cn/u/5084965647
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="weibo1" src="/assets/images/2023/20230306161502.jpg"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;https://m.weibo.cn/api/container/getIndex?containerid=1076035084965647&amp;amp;page=2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="weibo2" src="/assets/images/2023/20230306161516.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ç»“æ„æŒºæ¸…æ™°çš„ï¼Œdata-cards å°±æ˜¯æ¯ä¸€æ¡å¾®åšï¼Œä¸è¿‡ä¼šæœ‰ä¸åŒçš„card-typeï¼Œé€‰å‡ºcard-type=9 çš„å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸€ä¸ªcard é‡Œé¢ï¼Œä¸»è¦å…³æ³¨ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;itemidï¼š å¾®åšçš„å”¯ä¸€ID&lt;/li&gt;
&lt;li&gt;textï¼š æ–‡æœ¬å†…å®¹&lt;/li&gt;
&lt;li&gt;picsï¼š å›¾ç‰‡&lt;/li&gt;
&lt;li&gt;page_info: å¦‚æœå¸¦è§†é¢‘ï¼Œä¼šæœ‰ä¸€ä¸ªpage_infoï¼Œå…¶ä¸­åŒ…å«è§†é¢‘ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›æ¥å£åº”è¯¥æœ‰é¢‘ç‡é™åˆ¶ï¼Œä¸è¿‡æˆ‘åªæƒ³æŠ“æœ€æ–°çš„ï¼Œå‡ ååˆ†é’Ÿè®¿é—®ä¸€æ¬¡å³å¯ã€‚&lt;/p&gt;
&lt;h2&gt;å‘å¸ƒåˆ°Twitter&lt;/h2&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªå¸å·ï¼Œç„¶åå†åœ¨è¿™ä¸ªå¸å·ä¸‹åˆ›å»ºä¸€ä¸ª apps.twitter.comï¼Œç›´æ¥ç”Ÿæˆä¸€å †tokenï¼Œè¿™æ ·æœ€æ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºTwitter çš„è®¤è¯å¯ä»¥å‚è€ƒï¼š&lt;a href="http://isouth.org/archives/286.html"&gt;OAuth è®¤è¯æ­¥éª¤&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é‡ç‚¹å¾—åˆ°è¿™å››ä¸ªä¸œè¥¿å³å¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;CONSUMER_KEY&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;your-consumer-key&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;CONSUMER_SECRET&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;your-consumer-secret&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;ACCESS_TOKEN&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;your-access-token&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;ACCESS_TOKEN_SECRET&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;your-access-secret&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…³äºå›¾ç‰‡å’Œè§†é¢‘ä¸Šä¼ å¯ä»¥å‚è€ƒï¼š&lt;a href="https://github.com/twitterdev/large-video-upload-python"&gt;twitterdev/large-video-upload-python&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¾®åšçš„text ä¸­å¸¦äº†å¤§é‡çš„é“¾æ¥ï¼Œéœ€è¦å¤„ç†ä¸€ä¸‹ï¼Œç”¨re.sub æ›¿æ¢æ‰å³å¯ã€‚&lt;br&gt;
å¾®åšçš„è¯é¢˜æ˜¯&lt;code&gt;#è¯é¢˜#&lt;/code&gt;ï¼Œè€ŒTwitter æ˜¯&lt;code&gt;#è¯é¢˜&lt;/code&gt;ï¼Œä¹Ÿéœ€è¦å¤„ç†ä¸€ä¸‹ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;card&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;mblog&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;text&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;data-url=\&amp;quot;([^\&amp;quot; ]+)\&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;gt; \1 &amp;lt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;lt;[^&amp;lt;]*&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;t&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sub&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#([^#]+)#&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="sa"&gt;r&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;#\1&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
           &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…³äºå›¾ç‰‡ã€è§†é¢‘çš„å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Twitter çš„å›¾ç‰‡ï¼ˆé™¤GIF ä¹‹å¤–ï¼‰é™åˆ¶ä¸€æ¡tweet åªèƒ½å‘4å¼ ï¼Œå¾®åšå¯ä»¥æœ‰å¤šå¼ ï¼Œéœ€è¦æ³¨æ„æ‹†åˆ†ï¼Œç„¶åæŠŠç¬¬ä¸€æ¡tweet çš„ID ä½œä¸ºç¬¬äºŒæ¡çš„ &lt;code&gt;in_reply_to_status_id&lt;/code&gt;ï¼Œå°±èƒ½ä¸²æˆæ‰€è°“çš„â€œä¸»é¢˜å¸–â€ï¼›&lt;/li&gt;
&lt;li&gt;Twitter çš„è§†é¢‘æœ‰ä¸€å¤§å †é™åˆ¶ï¼Œå…è®¸çš„è§†é¢‘æ—¶é•¿ä¹Ÿå¾ˆçŸ­ã€‚ç´¢æ€§ä¸ä¼ è§†é¢‘äº†ï¼Œç›´æ¥ä¿ç•™å¾®åšåŸæ¥çš„ç§’æ‹è·³è½¬é“¾æ¥ï¼›&lt;/li&gt;
&lt;li&gt;GIF å›¾ç‰‡ï¼ŒTwitter ä¸€æ¡tweet ä¹Ÿåªèƒ½ä¼ ä¸€å¼ ï¼Œè¿˜ä¸èƒ½æ˜¯åŠ¨å›¾ï¼Œæ‡’å¾—åˆ¤æ–­ï¼Œç›´æ¥ä¸¢å¼ƒGIF å›¾äº†ã€‚&lt;/li&gt;
&lt;li&gt;ä¼ å›¾ç‰‡å’Œè§†é¢‘æ—¶ï¼Œè®°å¾—å¸¦ä¸Š&lt;code&gt;media_category&lt;/code&gt;ï¼Œå›¾ç‰‡æ˜¯&lt;code&gt;tweet_image&lt;/code&gt;ï¼Œè§†é¢‘æ˜¯&lt;code&gt;tweet_video&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å†™å¥½ä¹‹åï¼Œä¸¢åˆ°VPS ä¸Šï¼Œ15åˆ†é’Ÿè¿è¡Œä¸€æ¬¡å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href="https://twitter.com/NinSwitch_News"&gt;@NinSwitch_News&lt;/a&gt;&lt;/strong&gt;&lt;br&gt;
&lt;img alt="ns_news" src="/assets/images/2023/20230306161552.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä»£ç å°±ä¸å‘äº†ï¼Œå†™å¾—å¾ˆå¿«å¾ˆç³™ï¼Œä¹Ÿæ²¡å•¥éš¾åº¦ã€‚  &lt;/p&gt;</content><category term="2017"></category><category term="spider"></category></entry><entry><title>ioping</title><link href="https://fangpsh.github.io/posts/2017/2017-12-13.html" rel="alternate"></link><published>2017-12-13T00:00:00+08:00</published><updated>2017-12-13T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-12-13:/posts/2017/2017-12-13.html</id><summary type="html">&lt;p&gt;&lt;img alt="ioping" src="/assets/images/2023/20230306152430.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°ä¸€ä¸ªæœ‰è¶£çš„å·¥å…· - iopingï¼Œç±»ä¼¼å¸¸ç”¨çš„ping å‘½ä»¤ã€‚ping ç”¨æ¥ping ç½‘ç»œï¼Œçœ‹å»¶æ—¶ã€ä¸¢åŒ…ç­‰ç­‰ï¼Œioping ç”¨æ¥ â€œpingâ€ IOï¼Œçœ‹IO è€—æ—¶ï¼Œè¯»å†™é€Ÿåº¦ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/koct9i/ioping"&gt;ioping&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;simple disk I â€¦&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="ioping" src="/assets/images/2023/20230306152430.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å‘ç°ä¸€ä¸ªæœ‰è¶£çš„å·¥å…· - iopingï¼Œç±»ä¼¼å¸¸ç”¨çš„ping å‘½ä»¤ã€‚ping ç”¨æ¥ping ç½‘ç»œï¼Œçœ‹å»¶æ—¶ã€ä¸¢åŒ…ç­‰ç­‰ï¼Œioping ç”¨æ¥ â€œpingâ€ IOï¼Œçœ‹IO è€—æ—¶ï¼Œè¯»å†™é€Ÿåº¦ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/koct9i/ioping"&gt;ioping&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;simple disk I/0 latency measuring tool&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”¨å¸¸è§çš„åŒ…ç®¡ç†å·¥å…·å°±å¯ä»¥å®‰è£…ä¸Šï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt/yum/dnf/brew install ioping
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ping å‘½ä»¤åŸºæœ¬æ— å®³ï¼Œä¸è¿‡ioping æ®è¯´å¯èƒ½ä¼šæŸåæ•°æ®ï¼Œå¾—å°å¿ƒä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…ä¹‹åï¼Œman ä¸€ä¸‹æŸ¥çœ‹æ‰‹å†Œï¼Œä¼šå‘ç°é€‰é¡¹è¿˜æŒºå¤šï¼šæ¯ä¸€æ¬¡å†™å…¥çš„å¤§å°ï¼Œå†™å…¥/è¯»å–è¯·æ±‚çš„é—´éš”ï¼Œè¯·æ±‚çš„æ€»æ¬¡æ•°ï¼ŒåŒæ­¥/å¼‚æ­¥ IOï¼Œ direct I/O ã€cached I/O å¤šç§æ¨¡å¼ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤ä¸€ä¸ªæ•°æ®å—æ˜¯4k ï¼Œå¯ä»¥é€‰æ‹©å†™å…¥ï¼Œè¯»å–ï¼Œæˆ–è€…è¯»å†™äº¤æ›¿æ¨¡å¼ï¼Œä»¥å‰ç®€å•çš„IOæµ‹è¯•éƒ½æ˜¯ç”¨&lt;a href="https://en.wikipedia.org/wiki/Dd_(Unix)"&gt;dd&lt;/a&gt;ï¼Œä»¥åå¯ä»¥è¯•ä¸€è¯•ç”¨iopingï¼Œå½“ç„¶ï¼Œä¸“ä¸šä¸¥è°¨çš„å‹æµ‹è¿˜æ˜¯å¾—ç”¨&lt;a href="https://github.com/axboe/fio"&gt;fio&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“è¯­æ³•å’Œç¤ºä¾‹ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹èµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.systutorials.com/docs/linux/man/1-ioping/"&gt;ioping(1)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/koct9i/ioping"&gt;koct9i/ioping&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.cyberciti.biz/faq/linux-freebsd-openbsd-macosx-find-disk-io-latency-with-ioping/amp/?__twitter_impression=true"&gt;How to find disk I/O latency with ioping monitoring tool on Linux&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2017"></category><category term="bash"></category></entry><entry><title>ç¦ç”¨é€æ˜å¤§é¡µ</title><link href="https://fangpsh.github.io/posts/2017/2017-12-05.html" rel="alternate"></link><published>2017-12-05T00:00:00+08:00</published><updated>2017-12-05T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-12-05:/posts/2017/2017-12-05.html</id><summary type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href="https://blog.nelhage.com/post/transparent-hugepages/#fn:tree"&gt;blog.nelhage.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡ä½œè€…ï¼š&lt;a href="https://blog.nelhage.com/about/"&gt;Nelson Elhage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡å‘è¡¨æ—¶é—´ï¼š 2017-07-10&lt;/li&gt;
&lt;li&gt;åŸæ–‡è®¸å¯åè®®ï¼š&lt;a href="https://creativecommons.org/licenses/by/4.0/"&gt;CC BY 4.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;tl;drï¼ˆé•¿è¯çŸ­è¯´ï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.kernel.org/doc/Documentation/vm/transhuge.txt"&gt;â€œé€æ˜å¤§é¡µï¼ˆTransparent Hugepagesï¼‰â€&lt;/a&gt;æ˜¯ä¸€ä¸ªLinux å†…æ ¸ç‰¹æ€§ â€¦&lt;/p&gt;</summary><content type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡é“¾æ¥ï¼š&lt;a href="https://blog.nelhage.com/post/transparent-hugepages/#fn:tree"&gt;blog.nelhage.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡ä½œè€…ï¼š&lt;a href="https://blog.nelhage.com/about/"&gt;Nelson Elhage&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡å‘è¡¨æ—¶é—´ï¼š 2017-07-10&lt;/li&gt;
&lt;li&gt;åŸæ–‡è®¸å¯åè®®ï¼š&lt;a href="https://creativecommons.org/licenses/by/4.0/"&gt;CC BY 4.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;tl;drï¼ˆé•¿è¯çŸ­è¯´ï¼‰&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.kernel.org/doc/Documentation/vm/transhuge.txt"&gt;â€œé€æ˜å¤§é¡µï¼ˆTransparent Hugepagesï¼‰â€&lt;/a&gt;æ˜¯ä¸€ä¸ªLinux å†…æ ¸ç‰¹æ€§ï¼Œå®ƒé€šè¿‡æé«˜å¤„ç†å™¨çš„å†…å­˜æ˜ å°„ç¡¬ä»¶çš„ä½¿ç”¨æ•ˆç‡ï¼ˆè¯‘æ³¨ï¼šé™ä½TLB Miss å’Œpage faultï¼Œæé«˜TLB çš„å‘½ä¸­ç‡ï¼Œè¿™éƒ¨åˆ†åŸºç¡€çŸ¥è¯†å¯ä»¥ç¿»ä¸‹æ“ä½œç³»ç»Ÿä¹¦ï¼‰æ¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚åœ¨ç»å¤§å¤šæ•°Linux å‘è¡Œç‰ˆä¸­æ˜¯é»˜è®¤å¯ç”¨çš„ï¼ˆâ€œ&lt;code&gt;enabled=always&lt;/code&gt;â€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;é€æ˜å¤§é¡µèƒ½è®©ä¸€äº›åº”ç”¨ç¨‹åºçš„&lt;a href="https://lwn.net/Articles/423590/"&gt;æ€§èƒ½æé«˜ä¸€ç‚¹ç‚¹&lt;/a&gt;ï¼ˆæœ€å¥½çš„æƒ…å†µå¤§çº¦æ˜¯10%ï¼Œä¸€èˆ¬åœ¨0~3%ï¼‰ï¼Œä½†æ˜¯ä¼šé€ æˆå¾ˆæ˜æ˜¾çš„æ€§èƒ½é—®é¢˜ï¼ˆå‚è€ƒï¼š1.&lt;a href="https://docs.mongodb.com/manual/tutorial/transparent-huge-pages/"&gt;mongodb&lt;/a&gt;ï¼Œ2.&lt;a href="https://blogs.oracle.com/linux/performance-issues-with-transparent-huge-pages-thp"&gt;oracle&lt;/a&gt;, 3.&lt;a href="https://docs.splunk.com/Documentation/Splunk/6.5.2/ReleaseNotes/SplunkandTHP"&gt;splunk&lt;/a&gt;ï¼‰, ç”šè‡³ä¼šé€ æˆä¸¥é‡çš„å†…å­˜æ³„æ¼ï¼ˆå‚è€ƒï¼š1.&lt;a href="https://blog.digitalocean.com/transparent-huge-pages-and-alternative-memory-allocators/"&gt;digitalocean&lt;/a&gt;ï¼Œ2.&lt;a href="https://github.com/golang/go/issues/8832"&gt;golang/go&lt;/a&gt;ï¼‰.&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œä½ åº”è¯¥å°†è¿è¡Œçš„æœåŠ¡å™¨è®¾ç½®æˆ&lt;code&gt;enabled=madvise&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;echo madvise | sudo tee /sys/kernel/mm/transparent_hugepage/enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¹¶åœ¨æœåŠ¡å™¨çš„å†…æ ¸å‘½ä»¤è¡Œä¸Šè®¾ç½®&lt;code&gt;transparent_hugepage=madvise&lt;/code&gt;ï¼ˆä¾‹å¦‚åœ¨&lt;code&gt;/etc/default/grub&lt;/code&gt; ä¸­è®¾ç½®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å®Œæˆè¿™äº›ä¿®æ”¹ä¹‹åï¼Œåº”ç”¨ç¨‹åºèƒ½é€šè¿‡é€æ˜å¤§é¡µæå‡æ€§èƒ½ï¼Œä¹Ÿèƒ½é¿å…ä¸Šè¿°é—®é¢˜ï¼ˆè¯‘æ³¨ï¼šè®¾ç½®æˆ&lt;code&gt;madvise&lt;/code&gt;ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡è®¾ç½®&lt;code&gt;MADV_HUGEPAGE&lt;/code&gt;æ ‡å¿—å°±èƒ½åˆ†é…åˆ°å¤§é¡µï¼Œä¸éœ€è¦çš„ç¨‹åºåˆ™ä¸å—å½±å“ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç»§ç»­é˜…è¯»äº†è§£æ›´å¤šç»†èŠ‚ã€‚&lt;/p&gt;
&lt;!-- more --&gt;

&lt;h2&gt;ä»€ä¹ˆæ˜¯é€æ˜å¤§é¡µï¼Ÿ&lt;/h2&gt;
&lt;h3&gt;ä»€ä¹ˆæ˜¯å¤§é¡µï¼Ÿ&lt;/h3&gt;
&lt;p&gt;æ•°åå¹´æ¥ï¼Œå¤„ç†å™¨å’Œæ“ä½œç³»ç»Ÿä¹‹é—´é€šè¿‡ä½¿ç”¨&lt;a href="https://en.wikipedia.org/wiki/Virtual_memory"&gt;è™šæ‹Ÿå†…å­˜&lt;/a&gt;ï¼Œåœ¨åº”ç”¨ç¨‹åºå¯è§çš„å†…å­˜ç©ºé—´ï¼ˆâ€œè™šæ‹Ÿå†…å­˜ç©ºé—´(virtual address space)â€ï¼‰å’Œåº•å±‚çš„ç‰©ç†å†…å­˜ä¹‹é—´è®¾ç½®äº†é—´æ¥å±‚ã€‚é—´æ¥å±‚ä¸ä»…ä¿æŠ¤äº†åº”ç”¨ç¨‹åºäº’ç›¸ä¸å—å½±å“ï¼Œè¿˜æœ‰è®¸å¤šå¼ºå¤§çš„ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;p&gt;éå¸¸å¤šçš„ x86 å¤„ç†å™¨éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå«&lt;a href="https://en.wikipedia.org/wiki/Page_table"&gt;é¡µè¡¨ï¼ˆpage tableï¼‰&lt;/a&gt;çš„æ–¹æ¡ˆå®ç°è™šæ‹Ÿå†…å­˜ï¼Œè¿™ä¸ªæ–¹æ¡ˆä¼šåœ¨å†…å­˜ä¸­å­˜ä¸€ä¸ªéå¸¸å¤§çš„æ˜ å°„è¡¨ï¼ˆå®é™…ä¸Šä¸€ä¸ªæ·±åº¦ä¸åŒçš„æ ‘ç»“æ„ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç¨€ç–è¡¨ï¼‰ã€‚ä¼ ç»Ÿä¸Šï¼Œx86 å¤„ç†å™¨ä¸­ä¸€ä»½é¡µè¡¨æ¡ç›®å¯¹åº”ä¸€ä»½4KB çš„å†…å­˜â€œé¡µâ€ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶é¡µè¡¨éƒ½æ˜¯å­˜åœ¨å†…å­˜é‡Œï¼Œä½†æ˜¯å¤„ç†å™¨ä¼šç¼“å­˜ä¸€éƒ¨åˆ†é¡µè¡¨æ¡ç›®åˆ°å¤„ç†å™¨çš„å¯„å­˜å™¨ä¸Šï¼Œå®ƒè¢«ç§°ä¸º&lt;a href="https://en.wikipedia.org/wiki/Translation_lookaside_buffer"&gt;TLB&lt;/a&gt; ã€‚æŸ¥çœ‹æˆ‘ç¬”è®°æœ¬ä¸Šçš„&lt;code&gt;cpuid(1)&lt;/code&gt;ï¼ˆè¯‘æ³¨ï¼š&lt;a href="http://www.etallen.com/cpuid.html"&gt;Linux tool to dump x86 CPUID information about the CPU(s)&lt;/a&gt;ï¼‰å‘ç°æœ€ä½ç­‰çº§çš„TLB åªåŒ…å«64ä¸ªæ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®å¯¹åº”ä¸€ä»½4KB çš„æ•°æ®é¡µã€‚ç°åœ¨æ˜¯2017å¹´ï¼Œ64*4KB åªæœ‰å››åˆ†ä¹‹ä¸€å…†å­—èŠ‚ï¼Œè¿œå°äºç›®å‰ä½¿ç”¨çš„å¤§å¤šæ•°åº”ç”¨ç¨‹åºçš„å·¥ä½œå†…å­˜ã€‚è¿™ç§å¤§å°ä¸åŒ¹é…çš„æƒ…å†µæ„å‘³ç€å ç”¨å¤§é‡å†…å­˜çš„åº”ç”¨ç¨‹åºä¼šå‘¨æœŸæ€§çš„é‡åˆ°TLB ä¸å‘½ä¸­çš„æƒ…å†µï¼Œä»è€Œéœ€è¦èŠ±è´¹å¾ˆé«˜çš„ä»£ä»·è®¿é—®ä¸»å†…å­˜ï¼Œåªä¸ºå¾—åˆ°å…·ä½“çš„å†…å­˜åœ°å€ï¼ˆè¯‘æ³¨ï¼šTLB Miss ä¹‹åéœ€è¦è®¿é—®å†…å­˜ä¸­çš„é¡µè¡¨ï¼Œä»è€Œå¾—åˆ°å…·ä½“å†…å­˜åœ°å€ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ”¹è¿›TLB çš„æ•ˆç‡ï¼Œx86 åŠå…¶ä»–å¤„ç†å™¨é•¿æœŸä»¥æ¥éƒ½æ”¯æŒåˆ›å»ºâ€œå¤§é¡µï¼ˆhuge pagesï¼‰â€ï¼Œå¤§é¡µçš„é¡µè¡¨æ¡ç›®èƒ½æ˜ å°„ä¸€å¤§æ®µçš„ç‰©ç†å†…å­˜åœ°å€ã€‚æ ¹æ®æ“ä½œç³»ç»Ÿçš„é…ç½®ä¸åŒï¼Œå¤§å¤šæ•°æœ€è¿‘çš„èŠ¯ç‰‡èƒ½å¤Ÿæ˜ å°„2MBï¼Œ4MBï¼Œç”šè‡³1GB çš„å†…å­˜é¡µã€‚ä½¿ç”¨å¤§é¡µæ„å‘³ç€TLB å­˜ç€æ›´å¤šçš„æ•°æ®ï¼Œå¯¹æŸäº›ç‰¹å®šçš„ä»»åŠ¡æ¥è¯´æ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;
&lt;h3&gt;ä»€ä¹ˆæ˜¯é€æ˜å¤§é¡µï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å­˜åœ¨å„ç§é¡µè¡¨ç®¡ç†æ–¹å¼ï¼Œè¿™æ„å‘³ç€æ“ä½œç³»ç»Ÿéœ€è¦å†³å®šå¦‚ä½•æ˜ å°„åœ°å€ç©ºé—´å’Œç‰©ç†å†…å­˜ã€‚ç”±äºåº”ç”¨ç¨‹åºçš„å†…å­˜ç®¡ç†æ¥å£ï¼ˆä¾‹å¦‚&lt;code&gt;mmap(2)&lt;/code&gt;ï¼‰ä¸€ç›´éƒ½æ˜¯åŸºäºæœ€å°çš„ 4KB é¡µï¼Œæ‰€ä»¥å†…æ ¸æ˜ å°„æ•°æ®å¿…é¡»ä»¥4KB ä¸ºå•ä½ã€‚æœ€ç®€å•å’Œæœ€çµæ´»çš„ï¼ˆå°±å·²æ”¯æŒçš„å†…å­˜å¸ƒå±€è€Œè¨€ï¼‰æ–¹æ¡ˆæ˜¯åªé‡‡ç”¨4KB çš„é¡µï¼Œåº”ç”¨ç¨‹åºæ˜ å°„å†…å­˜æ— æ³•ä½¿ç”¨å¤§é¡µã€‚é•¿æœŸä»¥æ¥ï¼Œè¿™æ˜¯å†…æ ¸æœ€é€šç”¨çš„å†…å­˜ç®¡ç†ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºéœ€è¦å¤§é‡å†…å­˜å¹¶å¯¹æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚æŸäº›ç‰¹å®šæ•°æ®åº“æˆ–è€…ç§‘å­¦è®¡ç®—ç¨‹åºï¼‰ï¼Œå†…æ ¸å¼•å…¥&lt;a href="https://www.kernel.org/doc/Documentation/vm/hugetlbpage.txt"&gt;hugetlbfs&lt;/a&gt; ç‰¹æ€§ï¼Œè¯¥ç‰¹æ€§å…è®¸ç³»ç»Ÿç®¡ç†å‘˜é€šè¿‡é…ç½®è®©ç‰¹å®šçš„åº”ç”¨ç¨‹åºä½¿ç”¨å¤§é¡µã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.kernel.org/doc/Documentation/vm/transhuge.txt"&gt;é€æ˜å¤§é¡µï¼ˆç®€ç§°â€œTHPâ€ï¼‰&lt;/a&gt;ï¼Œæ­£å¦‚å…¶åï¼Œæ—¨åœ¨è‡ªåŠ¨ä¸ºåº”ç”¨ç¨‹åºæä¾›å¤§é¡µæ”¯æŒï¼Œä¸éœ€è¦ç‰¹æ®Šé…ç½®ï¼ˆè¯‘æ³¨ï¼šé€æ˜å¤§é¡µçš„é€æ˜ï¼Œç±»ä¼¼é€æ˜ä»£ç†çš„é€æ˜ï¼‰ã€‚é€æ˜å¤§é¡µé€šè¿‡åœ¨åå°æ‰«æï¼ˆä½¿ç”¨&lt;code&gt;khugepaged&lt;/code&gt; å†…æ ¸çº¿ç¨‹ï¼‰å†…å­˜æ˜ å°„ï¼Œå°è¯•æ‰¾åˆ°æˆ–è€…åˆ›å»ºï¼ˆé€šè¿‡ç§»åŠ¨ç›¸é‚»çš„å†…å­˜ï¼‰æ€»å…±2MB çš„è¿ç»­4KB æ˜ å°„ï¼Œç”¨ä¸€ä¸ªå¤§é¡µæ¥æ›¿æ¢è¿™ä¸€æ®µå†…å­˜æ˜ å°„ã€‚&lt;/p&gt;
&lt;h2&gt;æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;é€æ˜å¤§é¡µè¿è¡Œè‰¯å¥½æ—¶ï¼Œç‰¹å®šçš„æµ‹è¯•åœºæ™¯ä¸‹ï¼Œå¯ä»¥å¸¦æ¥å¤§çº¦10% çš„æ€§èƒ½æå‡ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿä¼šé€ æˆè‡³å°‘ä¸¤ç§éå¸¸ä¸¥é‡çš„æ•…éšœï¼š&lt;/p&gt;
&lt;h3&gt;å†…å­˜æ³„æ¼&lt;/h3&gt;
&lt;p&gt;THP å€¾å‘äºåˆ›å»º2MB çš„å†…å­˜æ˜ å°„ã€‚ç„¶è€Œï¼Œè¿™æ ·åšå¤ªè´ªå¿ƒï¼Œå³ä½¿å¿…è¦çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸æ„¿æ„æŠŠå®ƒä»¬æ‹†åˆ†å›å»ã€‚å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºæ˜ å°„äº†ä¸€å¤§æ®µå†…å­˜ä½†æ˜¯åªè®¿é—®å‰é¢å‡ ä¸ªå­—èŠ‚ï¼Œä¼ ç»Ÿä¸Šåªä¼šæ¶ˆè€—ä¸€ä¸ª4KB çš„ç‰©ç†å†…å­˜é¡µã€‚THP å¼€å¯çš„æƒ…å†µä¸‹ï¼Œ&lt;code&gt;khugepaged&lt;/code&gt;ä¼šå°†4KB é¡µæ‰©å¼ åˆ°2MBï¼Œå†…å­˜å ç”¨é‡å¢å¤§512å€ï¼ˆè¿™ä»½&lt;a href="https://bugzilla.kernel.org/show_bug.cgi?id=93111"&gt;Bug æŠ¥å‘Š&lt;/a&gt; ä¸­çš„ä¾‹å­æ›´ç³Ÿç³•ï¼Œç”šè‡³è¶…è¿‡512 å€ï¼ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æƒ…å†µä¸æ˜¯å‡è®¾ï¼›Go è¯­è¨€çš„GC å°±æœ‰ä¸€ä¸ª&lt;a href="https://github.com/golang/go/issues/8832"&gt;æ˜ç¡®çš„è§£å†³æ–¹æ³•&lt;/a&gt;ï¼ŒDigital Ocean ä¹Ÿ&lt;a href="https://blog.digitalocean.com/transparent-huge-pages-and-alternative-memory-allocators/"&gt;è®°å½•&lt;/a&gt;äº†å®ƒä»¬æ˜¯å¦‚ä½•å¤„ç†Redisï¼ŒTHP å’Œ&lt;code&gt;jemalloc&lt;/code&gt;é‡åˆ°çš„é—®é¢˜ã€‚ &lt;/p&gt;
&lt;p&gt;ï¼ˆè¯‘æ³¨ï¼šæ®è¯´3.10 å†…æ ¸é€æ˜é›¶é¡µæœ‰æ³„æ¼é—®é¢˜ï¼Œå†…æ ¸åªé‡Šæ”¾2MB ä¸­ç¬¬ä¸€ä¸ª4KB çš„é¡µé¢ï¼Œå‰©ä½™çš„é¡µé¢æ³„æ¼ï¼‰&lt;/p&gt;
&lt;h3&gt;å¡é¡¿å’Œé«˜CPU ä½¿ç”¨ç‡&lt;/h3&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºéƒ½æ˜¯åˆ†é…ç›¸å¯¹é™æ€çš„å†…å­˜ï¼Œç¨³å®šçš„çŠ¶æ€ä¸‹ï¼Œ&lt;code&gt;khugepaged&lt;/code&gt; çš„å·¥ä½œé‡æ˜¯æœ€å°çš„ã€‚ä½†æ˜¯å¦‚æœå­˜åœ¨é¢‘ç¹æ˜ å°„å†…å­˜çš„æƒ…å†µï¼Œæˆ–è€…å­˜åœ¨ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­çš„è¿›ç¨‹ï¼Œ&lt;code&gt;khugepaged&lt;/code&gt; ä¼šè¿›è¡Œå¤§é‡çš„æ‹†åˆ†/åˆå¹¶å†…å­˜åŒºåŸŸçš„å·¥ä½œï¼Œæ¯«æ— æ„ä¹‰ï¼Œå­˜æ´»æ—¶é—´å¾ˆçŸ­ã€‚è¿™ä¼šå¼•èµ·å¾ˆé«˜çš„CPU ä½¿ç”¨ç‡ï¼Œä»¥åŠè¾ƒé•¿çš„å¡é¡¿ï¼Œå› ä¸ºå†…æ ¸è¢«è¿«å¾—å…ˆæŠŠ2MB çš„é¡µæ‹†åˆ†æˆ4KB çš„é¡µï¼Œæ‰èƒ½æ‰§è¡ŒåŸæœ¬åœ¨å•é¡µä¸Šæ•ˆç‡å¾ˆé«˜çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™äº›åŸå› ï¼Œå¯ç”¨äº†THP ä¹‹åï¼Œå¥½å‡ ä¸ªåº”ç”¨ç¨‹åºéƒ½è§‚å¯Ÿåˆ°30% çš„æ€§èƒ½ä¸‹é™ï¼Œç”šè‡³æ›´ç³Ÿã€‚&lt;/p&gt;
&lt;h2&gt;ç°åœ¨æ€ä¹ˆåŠï¼Ÿ&lt;/h2&gt;
&lt;p&gt;THP ä½œè€…ä»¬äº‹å…ˆæ„è¯†åˆ°äº†é€æ˜å¤§é¡µå¯èƒ½æœ‰æ½œåœ¨çš„é—®é¢˜ï¼ˆå°½ç®¡å¦‚ä»Šçœ‹æ¥ï¼Œä»–ä»¬ä½ä¼°äº†é—®é¢˜çš„ä¸¥é‡æ€§ï¼‰ï¼Œæ‰€ä»¥ä»–ä»¬é€‰æ‹©é€šè¿‡ &lt;code&gt;/sys/kernel/mm/transparent_hugepage/enabled&lt;/code&gt; ç³»ç»Ÿæ–‡ä»¶é…ç½®é€æ˜å¤§é¡µã€‚&lt;/p&gt;
&lt;p&gt;æ›´é‡è¦çš„æ˜¯ï¼Œä»–ä»¬ä¸ºé€æ˜å¤§é¡µå®ç°äº†ä¸€ç§å¯é€‰æ‹©çš„æ¨¡å¼ã€‚å°†&lt;code&gt;/sys/kernel/mm/transparent_hugepage/enabled&lt;/code&gt; è®¾ç½®ä¸º&lt;code&gt;madvise&lt;/code&gt;ï¼Œ&lt;code&gt;khugepaged&lt;/code&gt; é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå¤„ç†å†…å­˜ï¼Œé™¤éåº”ç”¨ç¨‹åºä½¿ç”¨&lt;code&gt;madvise&lt;/code&gt; ç³»ç»Ÿè°ƒç”¨ï¼Œç»™ç‰¹å®šèŒƒå›´çš„å†…å­˜è¿›è¡ŒTHP å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåªæœ‰å°‘æ•°ç‰¹å®šçš„åº”ç”¨ç¨‹åºèƒ½é€šè¿‡é€æ˜å¤§é¡µæ˜¾è‘—æå‡æ€§èƒ½ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„é€‰é¡¹ã€‚è¿™äº›å°‘æ•°çš„åº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©ä½¿ç”¨&lt;code&gt;madvise&lt;/code&gt;ï¼Œå…¶ä½™çš„åº”ç”¨ç¨‹åºä¸å—å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œæˆ‘å»ºè®®æ¯ä¸ªç”¨æˆ·éƒ½æŠŠé€æ˜å¤§é¡µé…ç½®æˆ&lt;code&gt;madvise&lt;/code&gt;ï¼Œå¦‚æ–‡ç« å¼€å¤´&lt;a href="#tl;dr"&gt;tl;dr&lt;/a&gt;æ‰€è¯´çš„ã€‚åŒæ—¶æˆ‘ä¹Ÿå¸Œæœ›è¯´æœä¸»æµçš„å‘è¡Œç‰ˆé»˜è®¤ç¦ç”¨é€æ˜å¤§é¡µï¼Œè®©æ›´å¤šçš„ç³»ç»Ÿç®¡ç†å‘˜å’Œå¼€å‘è€…é¿å…è¸©è¿™äº›å‘ã€‚&lt;/p&gt;</content><category term="2017"></category><category term="linux"></category></entry><entry><title>Chromeï¼ŒERR_SPDY_PROTOCOL_ERROR å’Œæ— æ•ˆçš„HTTP header</title><link href="https://fangpsh.github.io/posts/2017/2017-12-04.html" rel="alternate"></link><published>2017-12-04T00:00:00+08:00</published><updated>2017-12-04T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-12-04:/posts/2017/2017-12-04.html</id><summary type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href="https://www.michalspacek.com/chrome-err_spdy_protocol_error-and-an-invalid-http-header"&gt;michalspacek.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡ä½œè€…ï¼š&lt;a href="https://www.michalspacek.com/contact"&gt;Michal Å paÄek&lt;/a&gt;https://www.michalspacek.com/contact&lt;/li&gt;
&lt;li&gt;å‘è¡¨æ—¶é—´ï¼š2017-08-28&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ä½ æŠŠç½‘ç«™è¿ç§»åˆ°æ€§èƒ½æ›´å¥½çš„HTTP/2 åè®®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°Chrome æ²¡æ³•åŠ è½½ â€¦&lt;/p&gt;</summary><content type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€ï¼š&lt;a href="https://www.michalspacek.com/chrome-err_spdy_protocol_error-and-an-invalid-http-header"&gt;michalspacek.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡ä½œè€…ï¼š&lt;a href="https://www.michalspacek.com/contact"&gt;Michal Å paÄek&lt;/a&gt;https://www.michalspacek.com/contact&lt;/li&gt;
&lt;li&gt;å‘è¡¨æ—¶é—´ï¼š2017-08-28&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ä½ æŠŠç½‘ç«™è¿ç§»åˆ°æ€§èƒ½æ›´å¥½çš„HTTP/2 åè®®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°Chrome æ²¡æ³•åŠ è½½é¡µé¢çš„é—®é¢˜ï¼Œå–è€Œä»£ä¹‹æ˜¯ä¸€ä¸ªæ˜¾ç¤º&lt;strong&gt;This site canâ€™t be reached&lt;/strong&gt;ï¼Œä»¥åŠé”™è¯¯ä¿¡æ¯ä¸º&lt;code&gt;ERR_SPDY_PROTOCOL_ERROR&lt;/code&gt; çš„é¡µé¢ã€‚é”™è¯¯ä¿¡æ¯é‡Œé¢æ²¡æœ‰æåˆ°HTTP/2ï¼Œ å¯èƒ½æ˜¯å› ä¸º HTTP/2 æ˜¯ä»SPDY åè®®å‘å±•è€Œæ¥ï¼Œæ‰€ä»¥é”™è¯¯ä¿¡æ¯è¿˜æ˜¯è€çš„SPDYã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="chrome_err_spdy_protocol_error" src="/assets/images/2023/20230301160946.png"&gt;&lt;/p&gt;
&lt;p&gt;å‡ºç°&lt;code&gt;ERR_SPDY_PROTOCOL_ERROR&lt;/code&gt; å¯èƒ½æ˜¯å› ä¸ºæœåŠ¡å™¨å‘é€äº†ä¸€ä¸ªæ— æ•ˆçš„HTTP headerã€‚Chrome å¤„ç†äºŒè¿›åˆ¶çš„HTTP/2 åè®®æ—¶æœ‰ä¸€äº›ä¸¥æ ¼ï¼Œä¸ä¼šå¤„ç†ä»¥ç©ºæ ¼ä»£æ›¿ç ´æŠ˜å·çš„headerï¼ˆä¾‹å¦‚ç”¨&lt;code&gt;Referrer Policy&lt;/code&gt; ä»£æ›¿&lt;code&gt;Referrer-Policy&lt;/code&gt;ï¼‰ï¼Œä¹Ÿä¸ä¼šå¤„ç†å¸¦ç€2ä¸ªå†’å·çš„headerï¼ˆä¾‹å¦‚&lt;code&gt;Content-Security-Policy:: ...&lt;/code&gt;ï¼‰ï¼Œæ‰€ä»¥æ£€æŸ¥ä¸‹ä½ çš„header æ˜¯å¦å‡†ç¡®ã€‚Firefox ä¼šå¿½ç•¥è¿™äº›æ— æ•ˆçš„headerï¼Œæ­£å¸¸æ˜¾ç¤ºé¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;ç»™å‡ºä¸€ä¸ªå¦‚ä½•æ‰¾åˆ°è¿™äº›æœ‰é—®é¢˜çš„header çš„æ–¹æ³•ã€‚è®¿é—®&lt;code&gt;chrome://net-internals/#events&lt;/code&gt;ï¼ˆè¿™é“¾æ¥æ²¡æ³•ç‚¹å‡»ï¼Œåªèƒ½å¤åˆ¶ç„¶åç²˜è´´åˆ°åœ°å€æ å†è®¿é—®ï¼‰ï¼Œåœ¨æœç´¢æ¡†è¾“å…¥ä½ çš„åŸŸåï¼ˆæˆ‘ä»¥&lt;code&gt;example.com&lt;/code&gt;ä¸ºä¾‹ï¼‰ï¼Œç„¶ååœ¨å…¶ä»–æ ‡ç­¾ä¸­æ‰“å¼€å‡ºé—®é¢˜çš„ç½‘ç«™ã€‚è¿”å›&lt;code&gt;chrome://net-internals/#events&lt;/code&gt; ï¼Œé€‰ä¸­Source Type æ˜¯&lt;code&gt;HTTP2_SESSION&lt;/code&gt; çš„è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="chrome-events-http2_session" src="/assets/images/2023/20230228211536.png"&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å³è¾¹ï¼Œå¯ä»¥çœ‹åˆ°HTTP/2 åè®®çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‡ç‚¹éƒ¨åˆ†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;t=50413 [st=7]  HTTP2_SESSION_RECV_INVALID_HEADER
                --&amp;gt; header_name = &amp;quot;referrer policy&amp;quot;
                --&amp;gt; header_value = &amp;quot;same-origin&amp;quot;
t=50413 [st=7]  HTTP2_SESSION_SEND_RST_STREAM
               --&amp;gt; description = &amp;quot;Could not parse Spdy Control Frame Header.&amp;quot;
               --&amp;gt; error_code = &amp;quot;1 (PROTOCOL_ERROR)&amp;quot;
               --&amp;gt; stream_id = 3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹åˆ°&lt;code&gt;HTTP2_SESSION_RECV_INVALID_HEADER&lt;/code&gt; é‚£è¡Œäº†å—ï¼Ÿæ— æ•ˆçš„header å°±åœ¨å®ƒä¸‹é¢ï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œæ— æ•ˆçš„header æ˜¯&lt;code&gt;referrer policy&lt;/code&gt;ï¼Œç”¨ç©ºæ ¼ä»£æ›¿äº†ç ´æŠ˜å·ã€‚HTTP/2 åè®®ç†çš„header åç§°å¿…é¡»å…¨å°å†™ï¼Œå¦‚æœä½ å‘é€ä¸€ä¸ª&lt;code&gt;Referrer-Policy&lt;/code&gt;çš„headerï¼Œæµè§ˆå™¨ä¼šè§†ä¸º&lt;code&gt;referrer-policy&lt;/code&gt;ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œè¢«è§†ä¸ºæˆæ— æ•ˆçš„&lt;code&gt;referrer policy&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½ æµè§ˆå™¨çš„&lt;code&gt;chrome://net-internals/&lt;/code&gt;ä¸­ï¼Œä½ èƒ½å‘ç°å¾ˆå¤šæœ‰è¶£çš„ä¸œè¥¿ã€‚è¿™é‡Œæœ‰ä¸€äº›ä¸ä¼šå‡ºç°åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„è¯·æ±‚ï¼Œä¾‹å¦‚æµè§ˆå™¨æ‰©å±•å‘å‡ºçš„è¯·æ±‚ã€‚å»è¯•ä¸€è¯•ï¼Œè¯´ä¸å®šä¸‹æ¬¡ä½ debug æ—¶èƒ½å¸®ä¸Šå¿™ã€‚æˆ‘åœ¨ç ”ç©¶&lt;a href="https://www.michalspacek.com/opera-browsers-vpn-is-just-a-proxy"&gt;Opera browser â€œVPNâ€ &lt;/a&gt;å’Œ&lt;a href="https://www.michalspacek.com/ur-browser-vpn-and-other-tales"&gt;â€œVPNâ€ in UR browser&lt;/a&gt; å°±ç”¨è¿‡å®ƒã€‚&lt;/p&gt;</content><category term="2017"></category><category term="chrome"></category><category term="http2"></category></entry><entry><title>æ­å»ºHTTP/2 ä»£ç†</title><link href="https://fangpsh.github.io/posts/2017/2017-11-01.html" rel="alternate"></link><published>2017-11-01T00:00:00+08:00</published><updated>2017-11-01T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-11-01:/posts/2017/2017-11-01.html</id><summary type="html">&lt;p&gt;è¿™ä¸ªæœˆåˆæŠ¢åˆ°äº†å†…éƒ¨çš„100å…ƒè…¾è®¯äº‘ä»£é‡‘åˆ¸ï¼Œå¬è¯´æœ€è¿‘æµè¡ŒHTTP/2 ä»£ç†ï¼Œå¿«é€ŸæŠ˜è…¾ä¸€ä¸‹ï¼Œä¸»è¦å†…å®¹éƒ½æ˜¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š&lt;a href="https://wzyboy.im/post/1052.html"&gt;ã€Šä½¿ç”¨ nghttpx æ­å»º HTTP/2 ä»£ç†ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;è¯ä¹¦ â€¦&lt;/h2&gt;</summary><content type="html">&lt;p&gt;è¿™ä¸ªæœˆåˆæŠ¢åˆ°äº†å†…éƒ¨çš„100å…ƒè…¾è®¯äº‘ä»£é‡‘åˆ¸ï¼Œå¬è¯´æœ€è¿‘æµè¡ŒHTTP/2 ä»£ç†ï¼Œå¿«é€ŸæŠ˜è…¾ä¸€ä¸‹ï¼Œä¸»è¦å†…å®¹éƒ½æ˜¯å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š&lt;a href="https://wzyboy.im/post/1052.html"&gt;ã€Šä½¿ç”¨ nghttpx æ­å»º HTTP/2 ä»£ç†ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;è¯ä¹¦&lt;/h2&gt;
&lt;p&gt;HTTP/2 ä»£ç†å…¶å®ä¹Ÿå°±æ˜¯HTTPS ä»£ç†äº†ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªè¯ä¹¦ï¼Œå¯ä»¥è‡ªå·±ç­¾ï¼Œå¤ªéº»çƒ¦äº†ã€‚è…¾è®¯äº‘å’Œé˜¿é‡Œäº‘éƒ½æä¾›äº†å…è´¹çš„DV è¯ä¹¦ã€‚æä¸€ä¸ªã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.qcloud.com/blog/?p=1237"&gt;è…¾è®¯äº‘æ”¯æŒDV SSLè¯ä¹¦å…è´¹ç”³è¯·&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.aliyun.com/product/cas"&gt;Alibaba Cloud Certificates Service&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å› ä¸ºåŸŸåæ‰˜ç®¡åœ¨DNSPODï¼Œåœ¨è…¾è®¯äº‘ç”³è¯·éƒ½æ— éœ€éªŒè¯ï¼ŒæŒºå¿«çš„ï¼Œä¼šç»™ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œæ‰“å¼€é‡Œé¢Nginx å­ç›®å½•ï¼Œæ‹¿åˆ°crt å’Œkey å¤‡ç”¨ã€‚&lt;/p&gt;
&lt;h2&gt;nghttpx&lt;/h2&gt;
&lt;p&gt;nghttpx å¯ä»¥å¯¹å¤–æä¾›HTTP/2 æœåŠ¡ï¼Œå°†è¯·æ±‚è½¬æ¢æˆHTTP/1.X è½¬å‘ç»™åç«¯ï¼Œç›¸å½“äºä¸€ä¸ªä¸­é—´äººã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;aptitude install nghttp2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸æ‡‚ä¸ºå•¥ubuntu çš„åŒ…åæ˜¯&lt;a href="https://packages.ubuntu.com/xenial/nghttp2"&gt;nghttp2&lt;/a&gt;ï¼Œç„¶ååŒ…å«ä¸‰ä¸ªåŒ…ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nghttp2-client
nghttp2-proxy
nghttp2-server
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¼–è¾‘é…ç½®æ–‡ä»¶ &lt;code&gt;/etc/nghttpx/nghttpx.conf&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;frontend=0.0.0.0,443
backend=127.0.0.1,3128
private-key-file=/root/ssl/2_xxxxx.fangpeishi.com.key
certificate-file=/root/ssl/1_xxxxx.fangpeishi.com_bundle.crt
http2-proxy=yes
errorlog-syslog=yes
workers=1

add-x-forwarded-for=no

no-via=yes
no-ocsp=yes
tls-proto-list=TLSv1.2
ciphers=ECDHE+AES128
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘æ˜¯æŠ„çš„ä¸Šæ–‡æ–‡ç« ä¸­çš„é…ç½®ï¼Œå…ˆè·‘èµ·æ¥å†è¯´ã€‚ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl restart nghttpx
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;squid&lt;/h2&gt;
&lt;p&gt;squid ä½œä¸ºnghttpx åç«¯çš„é€æ˜ä»£ç†ï¼Œä¸è¿‡è®°ä½è¦è®©å®ƒç›‘å¬åœ¨æœ¬åœ°ï¼Œåˆ«æš´éœ²åœ¨å…¬ç½‘ä¸Šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get install squid
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¼–è¾‘é…ç½®æ–‡ä»¶&lt;code&gt;/etc/squid/squid.conf&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http_port 127.0.0.1:3128

cache deny all
access_log none

dns_v4_first on

via off

forwarded_for delete

auth_param basic program /usr/lib/squid/basic_ncsa_auth  /etc/squid/passwd
auth_param basic casesensitive off
acl auth_user proxy_auth REQUIRED
http_access allow auth_user
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿæ˜¯æŠ„çš„æ•™ç¨‹ä¸­çš„é…ç½®ã€‚ã€‚å…ˆè·‘èµ·æ¥å†è¯´ã€‚é‰´æƒé‚£æ®µä¸‹æ–‡è¯´æ˜ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;systemctl restart squid
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;é‰´æƒ&lt;/h2&gt;
&lt;p&gt;æš´éœ²åœ¨å…¬ç½‘è¢«å…¶ä»–äººä¹±è·‘æµé‡æ€»ä¸å¤ªå¥½ï¼Œåœ¨Squid ä¸ŠåŠ ä¸€ä¸ªç®€å•çš„HTTP Authã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£… htpasswd å·¥å…·ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get install apache2-utils
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#-c åˆ›å»ºæ–‡ä»¶
htpasswd  -c  /etc/squid/passwd [ç”¨æˆ·å]

# æ·»åŠ å…¶ä»–ç”¨æˆ·
htpasswd /etc/squid/passwd [ç”¨æˆ·å]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨&lt;code&gt;/etc/squid/squid.conf&lt;/code&gt; æ·»åŠ é…ç½®ï¼Œå†é‡å¯å³å¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;auth_param basic program /usr/lib/squid/basic_ncsa_auth  /etc/squid/passwd
auth_param basic casesensitive off
acl auth_user proxy_auth REQUIRED
http_access allow auth_user
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ›´å¤šå…³äºsquid çš„é…ç½®éœ€æ±‚ï¼Œç›´æ¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œåº”è¯¥æ²¡æœ‰å•¥æ˜¯squid åšä¸åˆ°äº†ã€‚&lt;/p&gt;
&lt;h2&gt;BBR&lt;/h2&gt;
&lt;p&gt;å†é¡ºä¾¿å‡ä¸‹å†…æ ¸ï¼Œå¼€å¯ä¸‹ BBRï¼Œå¬è¯´æœ‰å¥‡æ•ˆï¼Ÿä¸è¿‡æˆ‘æ²¡æœ‰åšå¯¹æ¯”ã€‚ã€‚ç›´æ¥å¼€å¯äº†ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒæ–‡ç« ï¼š&lt;a href="https://imtx.me/archives/2379.html"&gt;ã€Šä½¿ç”¨æ ‡å‡†æ–¹å¼åœ¨ Ubuntu 16.04 ä¸‹å¯ç”¨ TCP æ‹¥å¡æ§åˆ¶ä¹‹ BBRã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ç®€æ˜æ­¥éª¤ï¼Œæ¥ç€ä¸Šé¢è¿™ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;p&gt;å®‰è£…å†…æ ¸&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;apt-get install linux-generic-hwe-16.04
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;reboot ä¹‹åï¼Œæ£€æŸ¥å†…æ ¸æ˜¯ä¸æ˜¯&amp;gt; 4.9&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;uname -a 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŠ è½½æ¨¡å—ï¼Œæ‰“å¼€å‚æ•°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;modprobe tcp_bbr
echo &amp;quot;tcp_bbr&amp;quot; | tee -a /etc/modules-load.d/modules.conf

echo &amp;quot;net.core.default_qdisc=fq&amp;quot; | tee -a /etc/sysctl.conf
echo &amp;quot;net.ipv4.tcp_congestion_control=bbr&amp;quot; | tee -a /etc/sysctl.conf
sysctl -p
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ€åéªŒè¯ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sysctl net.ipv4.tcp_congestion_control
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿”å›ç»“æœå¿…é¡»æ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;net.ipv4.tcp_congestion_control = bbr
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ä½¿ç”¨&lt;/h2&gt;
&lt;p&gt;æå®Œä¹‹åï¼ŒéªŒè¯ä¸€ä¸‹ï¼ŒChrome å®‰è£…&lt;a href="https://chrome.google.com/webstore/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif?hl=en"&gt;SwitchyOmega&lt;/a&gt; æ’ä»¶ï¼Œæ–°å»ºä¸€ä»½é…ç½®ï¼Œåè®®é€‰æ‹©HTTPSï¼Œè®°å¾—å¡«å…¥HTTP AuthéªŒè¯ä¿¡æ¯ã€‚ç„¶åé€‰ä¸­å¯ç”¨ï¼Œæ‰“å¼€ &lt;a href="https://www.whatismyip.com/"&gt;whatismyip&lt;/a&gt; çœ‹çœ‹IP æ˜¯ä¸æ˜¯å˜äº†ã€‚åœ¨ä¸åŒçš„å¹³å°ä¸Šè¦ä½¿ç”¨ï¼Œæ‰¾ä¸åŒçš„å®¢æˆ·ç«¯æ”¯æŒå§ã€‚&lt;/p&gt;</content><category term="2017"></category><category term="ä»£ç†"></category></entry><entry><title>å†™ä¸€ä¸ªTerraform Provider</title><link href="https://fangpsh.github.io/posts/2017/2017-10-13.html" rel="alternate"></link><published>2017-10-13T00:00:00+08:00</published><updated>2017-10-13T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-10-13:/posts/2017/2017-10-13.html</id><summary type="html">&lt;p&gt;ä¸Šä¸ªæœˆæƒ³ç»™è…¾è®¯äº‘å†™ä¸€ä¸ªterraform providerï¼ŒèŠ±äº†ä¸€å‘¨çš„æ—¶é—´å…¥é—¨Golangï¼Œå‚è€ƒç°æœ‰çš„ä¸€äº›é¡¹ç›®å®Œæˆäº†&lt;a href="https://cloud.tencent.com/product/clb"&gt;CLB&lt;/a&gt; çš„&lt;a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"&gt;CRUD&lt;/a&gt;ã€‚æœ¬æ¥æƒ³åšæˆå’Œé˜¿é‡Œäº‘çš„provider ä¸€ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸Šä¸ªæœˆæƒ³ç»™è…¾è®¯äº‘å†™ä¸€ä¸ªterraform providerï¼ŒèŠ±äº†ä¸€å‘¨çš„æ—¶é—´å…¥é—¨Golangï¼Œå‚è€ƒç°æœ‰çš„ä¸€äº›é¡¹ç›®å®Œæˆäº†&lt;a href="https://cloud.tencent.com/product/clb"&gt;CLB&lt;/a&gt; çš„&lt;a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"&gt;CRUD&lt;/a&gt;ã€‚æœ¬æ¥æƒ³åšæˆå’Œé˜¿é‡Œäº‘çš„provider ä¸€æ ·å®Œå–„ï¼Œä½†æ˜¯è…¾è®¯äº‘çš„API é”™è¯¯ç™¾å‡ºï¼Œæœ‰äº›äº§å“çš„API è¿”å›å‚æ•°ä¸ä¸€è‡´ã€‚ç®—äº†ï¼Œç­‰ä»¥åé‡åˆ°å…·ä½“éœ€æ±‚å†ç»§ç»­åšã€‚æŠŠå­¦ä¹ å†™provider çš„è¿‡ç¨‹ç®€å•è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å…¥é—¨Golangï¼Œè¯»äº†&lt;a href="https://book.douban.com/subject/11577300/"&gt;ã€ŠGo è¯­è¨€ç¼–ç¨‹ã€‹&lt;/a&gt; çš„1~4ç« , é‡ç‚¹çœ‹äº†ä¸‹map å’Œinterface å°±å¤Ÿç”¨äº†ã€‚goroutineã€channel å•¥çš„å…ˆä¸ç”¨çœ‹ï¼Œå†™provider ç”¨ä¸åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;å®˜ç½‘çš„æ•™ç¨‹&lt;a href="https://www.terraform.io/guides/writing-custom-terraform-providers.html"&gt;Writing Custom Providers&lt;/a&gt; æ¯”è¾ƒç®€å•ï¼Œæˆ‘æ˜¯å…ˆçœ‹è¿™ä¸ªä¾‹å­ï¼Œäº†è§£å¤§è‡´çš„ç»“æ„ã€‚å†è¯»&lt;a href="https://github.com/alibaba/terraform-provider"&gt;alibaba/terraform-provider&lt;/a&gt; æºç ï¼Œç…§çŒ«ç”»è™ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ•™ç¨‹å†™çš„ä¹Ÿä¸é”™&lt;a href="http://blog.jfabre.net/2017/01/22/writing-terraform-provider/"&gt;Writing a Terraform provider&lt;/a&gt;ï¼Œçœ‹å®Œä¹‹åå¾ˆå—ç”¨ï¼Œå†™é‚®ä»¶ç»™ä½œè€…è¡¨ç¤ºå¸Œæœ›èƒ½ç¿»è¯‘ï¼Œæ²¡ç†æˆ‘:( ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç ç›®å½•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;â”œâ”€â”€ README.md
â”œâ”€â”€ api
â”‚Â Â  â”œâ”€â”€ clb
â”‚Â Â  â”œâ”€â”€ common
â”‚Â Â  â””â”€â”€ cvm
â”œâ”€â”€ main.go
â”œâ”€â”€ qcloud
â”‚Â Â  â”œâ”€â”€ config.go
â”‚Â Â  â”œâ”€â”€ data_source_qcloud_zones.go
â”‚Â Â  â”œâ”€â”€ provider.go
â”‚Â Â  â”œâ”€â”€ resource_qcloud_clb.go
â”‚Â Â  â”œâ”€â”€ resource_qcloud_clb_listener.go
â”‚Â Â  â”œâ”€â”€ resource_qcloud_eip.go
â”‚Â Â  â””â”€â”€ validators.go
....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;main.go&lt;/h2&gt;
&lt;p&gt;main.go æ¯ä¸ªprovider éƒ½å·®ä¸å¤šï¼ŒåŒ…å«ä¸€ä¸ªmain å‡½æ•°ï¼Œbuild çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç…§æŠ„å³å¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;package&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;main&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;github.com/hashicorp/terraform/plugin&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;terraform-provider-qcloud/qcloud&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="kd"&gt;func&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;plugin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Serve&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;plugin&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ServeOpts&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;ProviderFunc&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;qcloud&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Provider&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;api/&lt;/h2&gt;
&lt;p&gt;provider æ˜¯é€šè¿‡äº‘äº§å“çš„api è°ƒç”¨ç›¸å…³çš„æ¥å£å¯¹èµ„æºè¿›è¡ŒCRUDï¼Œä¸è¿‡è…¾è®¯äº‘æ²¡æœ‰æä¾›golang çš„sdkï¼Œéœ€è¦è‡ªå·±å°è£…ä¸€ä¸‹ã€‚æˆ‘å‚è€ƒäº†é˜¿é‡Œäº‘çš„&lt;a href="https://github.com/denverdino/aliyungo"&gt;denverdino/aliyungo&lt;/a&gt;ï¼Œé˜¿é‡Œäº‘çš„provider ä¹Ÿæ˜¯ä½¿ç”¨çš„è¿™ä¸ªSDKã€‚ç­¾åå‡½æ•°ç›´æ¥ç”¨äº†è…¾è®¯äº‘çš„&lt;a href="https://github.com/QcloudApi/qcloud_sign_golang"&gt;QcloudApi/qcloud_sign_golang&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.
â”œâ”€â”€ clb
â”‚Â Â  â”œâ”€â”€ client.go
â”‚Â Â  â”œâ”€â”€ listener.go
â”‚Â Â  â””â”€â”€ load_balancer.go
â”œâ”€â”€ common
â”‚Â Â  â”œâ”€â”€ client.go
â”‚Â Â  â””â”€â”€ sign.go
â””â”€â”€ cvm
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŒ‰ç…§ä¸åŒäº§å“åˆ†æˆå¤šä¸ªclientï¼Œæ˜¯å› ä¸ºä¸åŒäº§å“çš„API åœ¨å‚æ•°ä¸Šæœ‰ä¸€äº›åŒºåˆ«ï¼Œä¾‹å¦‚ç‰ˆæœ¬å·ï¼Œæ¥å£åœ°å€ç­‰ã€‚æˆ‘æ”¾å¼ƒç»§ç»­å®ç°çš„ä¸»è¦åŸå› å°±æ˜¯è…¾è®¯äº‘çš„API æ–‡æ¡£é”™è¯¯ç™¾å‡ºï¼Œå„ä¸ªäº§å“API é£æ ¼ä¸ç»Ÿä¸€ï¼Œéå¸¸ç´¯ã€‚&lt;/p&gt;
&lt;h2&gt;provider.go&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæ–‡ä»¶åŒ…å«ä½ å®ç°çš„Provider æ‰€æä¾›çš„æ‰€æœ‰å†…å®¹ï¼Œå…·ä½“å¯ä»¥çœ‹æºç ã€‚Provider() å‡½æ•°è¿”å›ä¸€ä¸ª terraform.ResourceProvider å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Schema æ˜¯éœ€è¦æä¾›ç»™ä½ provider çš„å‚æ•°ï¼Œä¾‹å¦‚è®¿é—®API çš„key ä¹‹ç±»çš„ã€‚&lt;/li&gt;
&lt;li&gt;ResourceMap æ˜¯ä½ provider å°†æä¾›çš„resourcesï¼Œä¾‹å¦‚è…¾è®¯äº‘çš„CLBï¼ŒCVMï¼ŒCDN ä¹‹ç±»çš„ï¼Œæ¯ä¸ªresource ä½ éœ€è¦å®ç°ç‰¹å®šçš„CRUD æ¥å£ã€‚&lt;/li&gt;
&lt;li&gt;DataSourcesMap æ˜¯ä½ provider å°†æä¾›çš„æ•°æ®æºï¼Œä¾‹å¦‚è…¾è®¯äº‘CVM éƒ½æä¾›äº†å“ªäº›é•œåƒï¼Œå¯ä»¥é€šè¿‡å®ç°ä¸€ä¸ªé•œåƒçš„datasource æ‹¿åˆ°ï¼Œåœ¨æ“ä½œresources çš„æ—¶å€™ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹æ³•å¯ä»¥å‚è€ƒ&lt;a href="https://yq.aliyun.com/articles/137596?spm=5176.100239.0.0.Sztgba"&gt;Terraformä¸­DataSourceçš„æ·±åº¦åˆ†æ&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ConfigureFunc æŒ‡å‘ä¸€ä¸ªä½ å®ç°çš„å‡½æ•°ï¼Œç”¨æ¥åšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚åˆå§‹åŒ–ä¸Šæ–‡ä¸­å‡ºç°å„ç§Clientï¼Œåç»­API è°ƒç”¨æ—¶ä½¿ç”¨ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="https://github.com/fangpeishi/terraform-provider-qcloud/blob/master/qcloud/provider.go"&gt;terraform-provider-qcloud/qcloud/provider.go&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;config.go&lt;/h3&gt;
&lt;p&gt;ConfigureFunc æŒ‡å‘çš„å‡½æ•°providerConfigure ä¸­åˆ›å»ºäº†ä¸€ä¸ª Config å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ¥è‡ªconfig.go ï¼Œè¿™é‡Œé¢ä¼šåŒ…å«å„ç±»client çš„init ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/fangpeishi/terraform-provider-qcloud/blob/master/qcloud/config.go"&gt;terraform-provider-qcloud/qcloud/config.go&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;validators.go&lt;/h3&gt;
&lt;p&gt;åœ¨å®ç°Resource æˆ–è€…DataSource çš„æ—¶å€™ï¼Œéœ€è¦ä¼ ä¸€äº›å‚æ•°ç»™APIï¼ŒæœåŠ¡ç«¯å¯¹è¿™ç±»å‚æ•°ä¸€èˆ¬éƒ½æœ‰è§„å®šï¼Œé™¤äº†åŸºæœ¬çš„ç±»å‹åŒºåˆ«ï¼Œæ¯”å¦‚Intï¼ŒString ä¹‹ç±»çš„ï¼Œè¿˜ä¼šæœ‰å¿…é¡»å¤§äºå‡ ï¼Œå°äºå‡ ï¼Œå­—ç¬¦ä¸²å¿…é¡»ä»¥ä»€ä¹ˆç»“å°¾å¼€å¤´ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚é˜¿é‡Œäº‘provider çš„è¿™ä¸ª&lt;a href="https://github.com/alibaba/terraform-provider/blob/master/alicloud/resource_alicloud_slb.go#L32"&gt;ç‰‡æ®µ&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;func resourceAliyunSlb() *schema.Resource {
    return &amp;amp;schema.Resource{
        Create: resourceAliyunSlbCreate,
        Read:   resourceAliyunSlbRead,
        Update: resourceAliyunSlbUpdate,
        Delete: resourceAliyunSlbDelete,
        Importer: &amp;amp;schema.ResourceImporter{
            State: schema.ImportStatePassthrough,
        },

        Schema: map[string]*schema.Schema{
            &amp;quot;name&amp;quot;: &amp;amp;schema.Schema{
            Type:         schema.TypeString,
            Optional:     true,
            ValidateFunc: validateSlbName,
            Computed:     true,
            },
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ValidateFunc è°ƒç”¨çš„ &lt;a href="https://github.com/alibaba/terraform-provider/blob/master/alicloud/validators.go#L305"&gt;validateSlbName&lt;/a&gt; ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;// SLB
func validateSlbName(v interface{}, k string) (ws []string, errors []error) {
    if value := v.(string); value != &amp;quot;&amp;quot; {
        if len(value) &amp;lt; 1 || len(value) &amp;gt; 80 {
            errors = append(errors, fmt.Errorf(
                    &amp;quot;%q must be a valid load balancer name characters between 1 and 80&amp;quot;,
                    k))
                return
            }
    }


    return
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹çœ‹é˜¿é‡Œäº‘å®˜ç½‘æ–‡æ¡£çš„&lt;a href="https://help.aliyun.com/document_detail/27577.html?spm=5176.doc27566.2.4.K5ta6Q"&gt;è¦æ±‚&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;LoadBalancerName

String

è´Ÿè½½å‡è¡¡å®ä¾‹çš„æ˜¾ç¤ºåç§°ã€‚
å–å€¼ï¼šç”¨æˆ·è‡ªå®šä¹‰å­—ç¬¦ä¸²ã€‚é•¿åº¦é™åˆ¶ä¸º1-80ä¸ªå­—ç¬¦ï¼Œå…è®¸åŒ…å«å­—æ¯ã€æ•°å­—ã€â€˜-â€™ã€â€˜/â€™ã€â€˜.â€™ã€â€˜_â€™è¿™äº›å­—ç¬¦ã€‚

é»˜è®¤å€¼ï¼šæ— ã€‚

ä¸æŒ‡å®šè¯¥å‚æ•°æ—¶ï¼Œé»˜è®¤ç”±ç³»ç»Ÿåˆ†é…ä¸€ä¸ªå®ä¾‹åç§°ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨å®ç°å…¶ä»–Provider æ—¶ï¼Œå¯¹ç€API æ–‡æ¡£æ•²å³å¯ã€‚&lt;/p&gt;
&lt;h2&gt;resource_*.go&lt;/h2&gt;
&lt;p&gt;provider çš„resource å¯ä»¥è®¤ä¸ºæ˜¯äº‘æœåŠ¡çš„å„é¡¹äº§å“äº†ï¼Œä¾‹å¦‚è…¾è®¯äº‘çš„CLBï¼ŒCDNï¼ŒCVM ç­‰ã€‚æŒ‰ç…§è¦æ±‚å®ç°å¢åˆ æ”¹æŸ¥çš„å‡½æ•°å³å¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;func resourceQcloudClb() *schema.Resource {
    return &amp;amp;schema.Resource{
        Create: resourceQcloudClbCreate,
        Read:   resourceQcloudClbRead,
        Update: resourceQcloudClbUpdate,
        Delete: resourceQcloudClbDelete,
....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Create&lt;/h3&gt;
&lt;p&gt;Create æ˜¯åˆ›å»ºæ—¶è°ƒç”¨çš„å‡½æ•°ï¼Œåˆ›å»ºæˆåŠŸåéœ€è¦è°ƒç”¨ä¸€ä¸‹func (*ResourceData) SetIdï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;SetId sets the ID of the resource. If the value is blank, then the resource is destroyed.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;d.SetId(clb.UnLoadBalancerIds[clb.DealIds[0]][0])
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªID å¿…é¡»å”¯ä¸€ã€‚&lt;/p&gt;
&lt;h3&gt;Read&lt;/h3&gt;
&lt;p&gt;è·å–å¯¹åº”ID èµ„æºçš„æœ€æ–°çŠ¶æ€ã€‚å¦‚æœæœ‰ä¸€äº›èµ„æºçš„å±æ€§åœ¨æœåŠ¡ç«¯å¯ä»¥ä¿®æ”¹çš„ï¼Œæ‹‰å–åˆ°æœ€æ–°çš„ï¼Œå¾—æ›´æ–°æœ¬åœ°çš„çŠ¶æ€ï¼Œä¾‹å¦‚CLB çš„åç§°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Set sets the value for the given key.&lt;/p&gt;
&lt;p&gt;If the key is invalid or the value is not a correct type, an error will be returned.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;d.Set(&amp;quot;load_balancer_type&amp;quot;, clb.LoadBalancerSet[0].LoadBalancerType)
d.Set(&amp;quot;forward&amp;quot;, clb.LoadBalancerSet[0].LoadBalancerName)
d.Set(&amp;quot;load_balancer_name&amp;quot;, clb.LoadBalancerSet[0].LoadBalancerName)
d.Set(&amp;quot;domain_prefix&amp;quot;, clb.LoadBalancerSet[0].Domain)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Update&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªå‡½æ•°ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæ›´æ–°tf æ–‡ä»¶ä¸­èµ„æºå±æ€§çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œapply åˆ°æœåŠ¡ç«¯ã€‚ä¸€èˆ¬ç”¨ d.HasChange æ¥æ£€æµ‹å¯¹åº”çš„å±æ€§æ˜¯å¦æ”¹å˜ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;d.Partial(true)

...

if d.HasChange(&amp;quot;load_balancer_name&amp;quot;) {
    args.LoadBalancerName = d.Get(&amp;quot;load_balancer_name&amp;quot;).(string)
    argList = append(argList, &amp;quot;load_balancer_name&amp;quot;)
    _, err := conn.ModifyLoadBalancerAttributes(args, argList)
    if err != nil {
        return err
    }

    d.SetPartial(&amp;quot;load_balancer_name&amp;quot;)
}

...

d.Partial(false)
return resourceQcloudClbRead(d, meta)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;&lt;code&gt;func (*ResourceData) HasChange&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;HasChange returns whether or not the given key has been changed.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;func (*ResourceData) Partial&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Partial turns partial state mode on/off.&lt;/p&gt;
&lt;p&gt;When partial state mode is enabled, then only key prefixes specified by SetPartial will be in the final state. This allows providers to return partial states for partially applied resources (when errors occur).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;&lt;code&gt;func (*ResourceData) SetPartial&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;SetPartial adds the key to the final state output while in partial state mode. The key must be a root key in the schema (i.e. it cannot be "list.0").&lt;/p&gt;
&lt;p&gt;If partial state mode is disabled, then this has no effect. Additionally, whenever partial state mode is toggled, the partial data is cleared.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Update ä¸€èˆ¬èƒ½ç”¨HasChange åº”ä»˜ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°å‡ºç°å­èµ„æºè¿™ç§éœ€æ±‚æ—¶ï¼Œå°±æ¯”è¾ƒéº»çƒ¦ã€‚ä¾‹å¦‚é˜¿é‡Œäº‘çš„ä¸€ä¸ªSLB åé¢ä¼šæŒ‚å¾ˆå¤šlistenerï¼ˆç›‘å¬å™¨ï¼‰ ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Create a new load balancer for classic
resource &amp;quot;alicloud_slb&amp;quot; &amp;quot;classic&amp;quot; {
name                 = &amp;quot;test-slb-tf&amp;quot;
internet             = true
internet_charge_type = &amp;quot;paybybandwidth&amp;quot;
bandwidth            = 5

listener = [
    {
        &amp;quot;instance_port&amp;quot; = &amp;quot;2111&amp;quot;
        &amp;quot;lb_port&amp;quot;       = &amp;quot;21&amp;quot;
        &amp;quot;lb_protocol&amp;quot;   = &amp;quot;tcp&amp;quot;
        &amp;quot;bandwidth&amp;quot;     = &amp;quot;5&amp;quot;
    },
    {
        &amp;quot;instance_port&amp;quot; = &amp;quot;8000&amp;quot;
        &amp;quot;lb_port&amp;quot;       = &amp;quot;80&amp;quot;
        &amp;quot;lb_protocol&amp;quot;   = &amp;quot;http&amp;quot;
        &amp;quot;bandwidth&amp;quot;     = &amp;quot;5&amp;quot;
    },
    {
        &amp;quot;instance_port&amp;quot; = &amp;quot;1611&amp;quot;
        &amp;quot;lb_port&amp;quot;       = &amp;quot;161&amp;quot;
        &amp;quot;lb_protocol&amp;quot;   = &amp;quot;udp&amp;quot;
        &amp;quot;bandwidth&amp;quot;     = &amp;quot;5&amp;quot;
    },
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ç§åœ¨Update æ—¶å°±æ¯”è¾ƒå°´å°¬ï¼Œå› ä¸ºlistener å°±æ˜¯ä¸€ä¸ªlistï¼Œæ²¡æœ‰å”¯ä¸€æ ‡è¯†ï¼Œä¿®æ”¹ä¸€ä¸‹ç«¯å£å•¥çš„ï¼Œæ€»ä¸èƒ½æŠŠæ‰€æœ‰listener åˆ é™¤å†æ·»åŠ ä¸€éã€‚&lt;/p&gt;
&lt;p&gt;é˜¿é‡Œäº‘çš„åšæ³•æ˜¯é€šè¿‡&lt;code&gt;func (*ResourceData) GetChange&lt;/code&gt; éš¾é“æ–°ã€æ—§çš„å€¼ï¼Œäº’ç›¸å¯¹æ¯”ï¼ŒæŠŠæ”¹å˜çš„listener åˆ é™¤æ‰ï¼Œä¿®æ”¹åçš„listener æ–°å¢ï¼Œ&lt;a href="https://github.com/terraform-providers/terraform-provider-alicloud/blob/974aa3101f94ab18099c1284274128c042a902bb/alicloud/resource_alicloud_slb.go#L335,#L362"&gt;HasChange("listener")&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æˆ‘åœ¨å®ç°è…¾è®¯äº‘çš„CLB Listener æ—¶å€™ï¼Œé‡‡ç”¨çš„åšæ³•æ˜¯ç”¨ä¸€ä¸ª&lt;code&gt;load_balancer_id&lt;/code&gt;  æŒ‡å‘CLB çš„èµ„æºIDï¼Œè¿™æ ·å»ºç«‹èµ·å¯¹åº”å…³ç³»ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;resource &amp;quot;qcloud_clb_listener&amp;quot; &amp;quot;tcp1234&amp;quot; {
    depends_on = [&amp;quot;qcloud_clb.example&amp;quot;]
    load_balancer_id = &amp;quot;${qcloud_clb.example.id}&amp;quot;
    listener_name = &amp;quot;abcxxxxxsodo&amp;quot;
    load_balancer_port = 1234
    instance_port = 4567
    protocol = 2
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸è¿‡æˆ‘åœ¨ç»™listener åŠ backend server çš„æ—¶å€™ï¼Œæ„Ÿè§‰è¿˜æ˜¯å¾—ç”¨é˜¿é‡Œé‚£ç§åšæ³•ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;a href="https://github.com/hashicorp/terraform/issues/2275"&gt;helper/schema feature: nestable resources #2275&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;Delete&lt;/h3&gt;
&lt;p&gt;æŠŠæœ¬åœ°tf æ–‡ä»¶å¯¹åº”çš„èµ„æºåˆ é™¤æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œåˆ é™¤æœåŠ¡ç«¯çš„èµ„æºã€‚&lt;/p&gt;
&lt;h2&gt;data_source_*.go&lt;/h2&gt;
&lt;p&gt;è¿™ä¸ªæ²¡å®ç°è¿‡ï¼Œä¸è¿‡çœ‹èµ·æ¥å’Œresource å·®ä¸å¤šï¼Œåªæ˜¯å¤§é‡çš„å±æ€§æ˜¯Computedï¼Œä¾›resource ä½¿ç”¨ã€‚å¯ä»¥å‚è€ƒé˜¿é‡Œäº‘çš„datasource å®ç°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;æœ€åï¼Œæ„Ÿè§‰è…¾è®¯äº‘å’ŒAWS ä¹‹é—´ï¼Œè¿˜å·®åä¸ªé˜¿é‡Œäº‘ï¼Œæ‰‹åŠ¨å†è§ã€‚&lt;/p&gt;</content><category term="2017"></category><category term="terraform"></category><category term="golang"></category></entry><entry><title>åŸºäºOpenResty çš„whoami.akaimai.net å®ç°</title><link href="https://fangpsh.github.io/posts/2017/2017-08-30.html" rel="alternate"></link><published>2017-08-30T00:00:00+08:00</published><updated>2017-08-30T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-08-30:/posts/2017/2017-08-30.html</id><summary type="html">&lt;p&gt;ä¸Šæ¬¡æ”¶é›†æ•´ç†[[170822 è·å–Local DNS åœ°å€ä¿¡æ¯]]) çš„æ—¶å€™çœ‹åˆ°akamai çš„&lt;code&gt;whoami.akamai.net&lt;/code&gt;ï¼Œæƒ³èµ·ä¹‹å‰çœ‹åˆ°&lt;a href="https://twitter.com/agentzh/status/767963492850601985"&gt;agentzh&lt;/a&gt; åŸºäºOpenRestyå®ç°äº†ä¸€ä¸ªæƒå¨DNS æœåŠ¡å™¨ï¼Œæ„Ÿè§‰å¯ä»¥ç”¨openresty ç®€å•å¿«é€Ÿçš„å® â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸Šæ¬¡æ”¶é›†æ•´ç†[[170822 è·å–Local DNS åœ°å€ä¿¡æ¯]]) çš„æ—¶å€™çœ‹åˆ°akamai çš„&lt;code&gt;whoami.akamai.net&lt;/code&gt;ï¼Œæƒ³èµ·ä¹‹å‰çœ‹åˆ°&lt;a href="https://twitter.com/agentzh/status/767963492850601985"&gt;agentzh&lt;/a&gt; åŸºäºOpenRestyå®ç°äº†ä¸€ä¸ªæƒå¨DNS æœåŠ¡å™¨ï¼Œæ„Ÿè§‰å¯ä»¥ç”¨openresty ç®€å•å¿«é€Ÿçš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æ‰¾åˆ°agentzh å½“æ—¶çš„ &lt;a href="https://gist.github.com/agentzh/6c50d37510daef792ed220fa0d970393"&gt;gist&lt;/a&gt;ï¼Œç¬¬ä¸€æ¬¡å­¦ä¹ OpenResty ï¼Œå†³å®šç…§çŒ«ç”»è™ã€‚çœ‹èµ·æ¥è¦åœ¨OpenResty é‡Œé¢æ¥å—dns æ•°æ®åŒ…ï¼Œå¹¶ä¸”è¿”å›ï¼Œéœ€è¦ç”¨åˆ°&lt;a href="https://github.com/openresty/stream-lua-nginx-module"&gt;stream-lua-nginx-module&lt;/a&gt;è¿™ä¸ªæ¨¡å—ï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ—¶å€™ï¼Œæˆªè‡³ç›®å‰(2017-08-30) master åˆ†æ”¯è¿˜ä¸æ”¯æŒ &lt;code&gt;ngx.req.udp_socket&lt;/code&gt; ï¼Œagentzh å½“æ—¶hack çš„ä»£ç éƒ½åœ¨ bloody-dns-server åˆ†æ”¯ä¸‹é¢ã€‚&lt;/p&gt;
&lt;h2&gt;ç¼–è¯‘OpenResty&lt;/h2&gt;
&lt;p&gt;è¯´æ¥æƒ­æ„§ï¼Œç¼–è¯‘OpenRestyè´¹äº†å¥½å¤§ä¸€ç•ªå·¥å¤«ã€‚å…ˆæ˜¯æ²¡æœ‰çœ‹æ¸…stream-lua-nginx-modele çš„åˆ†æ”¯ï¼Œç›´æ¥ç”¨master åˆ†æ”¯çš„ç¼–è¯‘ï¼Œæµ‹è¯•ä»£ç çš„æ—¶å€™ç›´æ¥è¿”å› &lt;code&gt;ngx.req.udp_socket&lt;/code&gt; æ˜¯ç©ºã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åç”¨bloody-dns-server åˆ†æ”¯ç¼–è¯‘ï¼Œåˆé‡åˆ° mmdb åº“çš„é—®é¢˜ã€‚Mac OS ä¸‹éœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šmaxminddb çš„åº“ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;./configure \
--with-cc-opt=&amp;quot;-I/usr/local/opt/openssl/include/ -I/usr/local/opt/pcre/include/&amp;quot; \
--with-ld-opt=&amp;quot;-L/usr/local/opt/openssl/lib/ -L/usr/local/opt/pcre/lib/ -L/opt/mmdb/lib -lmaxminddb&amp;quot; \ 
--with-stream \
--with-stream_ssl_module \
--add-module=./bundle/stream-lua-nginx-module
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸ç„¶ä¼šå‡ºç°ä¸€å †:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;undefined reference to `MMDB_open&amp;#39;
undefined reference to `MMDB_strerror&amp;#39;
undefined reference to `MMDB_lookup_sockaddr&amp;#39;
ndefined reference to `MMDB_strerror&amp;#39;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘çœ‹äº†ä¸€ä¸‹ stream-lua-nginx-module çš„&lt;code&gt;build.sh&lt;/code&gt; æ˜¯æ˜¾å¼æŒ‡å®šäº†&lt;code&gt;-L/opt/mmdb/lib -lmaxminddb&lt;/code&gt;ï¼Œä½†æ˜¯nginx ç¼–è¯‘çš„æ—¶å€™æ²¡æŒ‡å®šï¼Œå°±ä¼šæŠ¥é”™ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³é—®é¢˜ï¼š&lt;a href="https://stackoverflow.com/questions/32425361/ld-symbols-not-found-for-architecture-x86-64-clang-linker-command-failed"&gt;ld: symbols not found for architecture x86_64, clang: linker command failed&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é‡åˆ°é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nginx: [alert] cannot open file /opt/mmdb/database/GeoLite2-Country.mmdb for reading: Error opening the specified MaxMind DB file in
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å»Maxmind å®˜ç½‘ä¸‹ä¸€ä¸ªï¼Œä¸¢åˆ°å¯¹åº”çš„ç›®å½•å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ç¼–è¯‘çš„æ—¶å€™è¦æ³¨æ„é€‰æ‹©ç‰ˆæœ¬ï¼Œæˆ‘é€‰æ‹©çš„æ˜¯OpenResty-1.11.2.5ï¼Œå…¶ä¸­çš„Nginx çš„ç‰ˆæœ¬æ˜¯&lt;code&gt;1.11.2&lt;/code&gt;ï¼Œå¤ªæ–°çš„Nginx å¯èƒ½æ²¡æµ‹è¯•è¿‡ã€‚&lt;/p&gt;
&lt;h2&gt;å®ç°whoami.akamai.net&lt;/h2&gt;
&lt;p&gt;ç¼–è¯‘æˆåŠŸä¹‹åï¼Œå°±æ˜¯å¼€å§‹åŠ¨æ‰‹äº†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæ˜¯DNS æŠ¥æ–‡æ ¼å¼ï¼Œå‚è€ƒè¿™2ç¯‡æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.ietf.org/rfc/rfc1035.txt"&gt;rfc1035 DOMAIN NAMES - IMPLEMENTATION AND SPECIFICATION&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://zhujunwu.cn/python-dns-server/"&gt;Pythonåˆ©ç”¨socketæ¶è®¾DNSæœåŠ¡&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥åŠè‡ªå·±ç”¨wireshark æŠ“åŒ…åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;å¯¹ç€æ–‡æ¡£ä¸€ä¸ªä¸€ä¸ªbit æ ¡å¯¹ï¼Œå¯¹ä»»ä½•DNS æŸ¥è¯¢æŠ¥æ–‡ï¼Œéƒ½æ‹¿å‡ºå®ƒçš„IPï¼Œç„¶åè¿”å›ä¸€æ¡Aè®°å½•å°±å¥½äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="whoami" src="/assets/images/2023/20230301155214.png"&gt;&lt;/p&gt;
&lt;h2&gt;ä¸Šçº¿&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨ä¸ªäººçš„VPS ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªï¼Œå†æ·»åŠ ä¸€æ¡NS è®°å½•ï¼Œæ³¨æ„éœ€è¦æ˜¯åŸŸåï¼Œä¸èƒ½æ·»åŠ IPï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="whoami_ns" src="/assets/images/2023/20230301155222.png"&gt;&lt;/p&gt;
&lt;p&gt;å† &lt;code&gt;dig whoami.example.com&lt;/code&gt; æˆ–è€… &lt;code&gt;ping whoami.example.com&lt;/code&gt; å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="whoami_dig" src="/assets/images/2023/20230301155233.png"&gt;&lt;/p&gt;
&lt;h2&gt;ä»£ç &lt;/h2&gt;
&lt;p&gt;å®ç°ä»£ç : &lt;a href="https://gist.github.com/fangpsh/c7de2d718f6c50befe389eb646e60426"&gt;whoami.lua&lt;/a&gt;&lt;/p&gt;</content><category term="2017"></category><category term="openresty"></category><category term="dns"></category></entry><entry><title>è·å–Local DNS åœ°å€ä¿¡æ¯</title><link href="https://fangpsh.github.io/posts/2017/2017-08-22.html" rel="alternate"></link><published>2017-08-22T00:00:00+08:00</published><updated>2017-08-22T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-08-22:/posts/2017/2017-08-22.html</id><summary type="html">&lt;p&gt;åœ¨ç½‘é¡µä¸­è·å–local dns ä¸å¤ªæ–¹ä¾¿ï¼Œçœ‹çœ‹å¤§å®¶æ˜¯æ€ä¹ˆåšçš„ã€‚  &lt;/p&gt;
&lt;h2&gt;é˜¿é‡Œäº‘CDN è¯Šæ–­å·¥å…·&lt;/h2&gt;
&lt;p&gt;é˜¿é‡Œäº‘CDNæä¾›çš„&lt;a href="https://cdn.dns-detect.alicdn.com/https/doc.html"&gt;é˜¿é‡Œæ˜†ä»‘ç”¨æˆ·è¯Šæ–­å·¥å…·&lt;/a&gt;ï¼š&lt;br&gt;
&lt;img alt="alicdn_local_dns" src="/assets/images/2023/20230301171842.png"&gt;  &lt;/p&gt;
&lt;p&gt;è·å–åˆ°local dns çš„è¿™ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;åœ¨ç½‘é¡µä¸­è·å–local dns ä¸å¤ªæ–¹ä¾¿ï¼Œçœ‹çœ‹å¤§å®¶æ˜¯æ€ä¹ˆåšçš„ã€‚  &lt;/p&gt;
&lt;h2&gt;é˜¿é‡Œäº‘CDN è¯Šæ–­å·¥å…·&lt;/h2&gt;
&lt;p&gt;é˜¿é‡Œäº‘CDNæä¾›çš„&lt;a href="https://cdn.dns-detect.alicdn.com/https/doc.html"&gt;é˜¿é‡Œæ˜†ä»‘ç”¨æˆ·è¯Šæ–­å·¥å…·&lt;/a&gt;ï¼š&lt;br&gt;
&lt;img alt="alicdn_local_dns" src="/assets/images/2023/20230301171842.png"&gt;  &lt;/p&gt;
&lt;p&gt;è·å–åˆ°local dns çš„è¿™ä¸ªè¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;https://123-66-35-57-122894414.dns-detect.alicdn.com/api/cdnDetectHttps?method=commitDetectHttps&amp;amp;detectId=122894414&amp;amp;cb=jQuery110102821084573750223_1503489263656&amp;amp;_=1503489263658

ä¸€ä¸ªå¥‡æ€ªçš„åŸŸåï¼Œæ¯æ¬¡è®¿é—®éƒ½ä¸ä¸€æ ·ï¼š
123-66-35-57-122894414.dns-detect.alicdn.com
è®¾å¤‡ID ï¼š
detectId=122894414
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”¨æˆ·è®¿é—®ä¸€ä¸ªåŸŸåï¼Œæµè§ˆå™¨ç»™æŒ‰ç…§åˆ†é…çš„local dns å‘èµ·dns è¿­ä»£æŸ¥è¯¢ï¼Œæœ€åå‘åŸŸåçš„æƒå¨æœåŠ¡å™¨åæŸ¥è¯¢ï¼Œæœ€åè¿™ä¸€æ­¥çš„æ—¶å€™å¯ä»¥å¾—åˆ°local dns çš„åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="microsoft-offical-course-20410c07-18-638" src="/assets/images/2023/20230301171853.png"&gt;&lt;br&gt;
&lt;strong&gt;å›¾ç‰‡æ¥æºï¼š&lt;a href="https://www.slideshare.net/gameaxt/microsoft-offical-course-20410c07"&gt;Microsoft Offical Course 20410C_07&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¦æ€ä¹ˆæŠŠlocal dns åœ°å€å’Œç”¨æˆ·å¯¹åº”èµ·æ¥å‘¢ï¼Ÿè¿™å°±æ˜¯å‰é¢é‚£ä¸ªå¥‡æ€ªçš„åŸŸåçš„ä½œç”¨ï¼Œæ¯æ¬¡çš„åŸŸåéƒ½ä¸åŒï¼Œå½“æµè§ˆå™¨è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è¿™ä¸ªå”¯ä¸€åŸŸåå†ç»“åˆåŸŸåæœåŠ¡å™¨çš„ä¿¡æ¯ï¼ŒæŠŠå¯¹åº”çš„local dns è¿”å›ç»™ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;h2&gt;è…¾è®¯åä½—&lt;/h2&gt;
&lt;p&gt;è…¾è®¯çš„åä½—åˆ†æç³»ç»Ÿ&lt;a href="http://utp.qq.com/"&gt;utp.qq.com&lt;/a&gt;æˆ–&lt;a href="http://ping.huatuo.qq.com/"&gt;ping.huatuo.qq.com&lt;/a&gt;ï¼š&lt;br&gt;
&lt;img alt="qq_ldns_1" src="/assets/images/2023/20230301171906.png"&gt;  &lt;/p&gt;
&lt;p&gt;è…¾è®¯è¿™æœåŠ¡ç°åœ¨å¥½åƒæŒ‚äº†ã€‚ã€‚ä¸è¿‡ä¸å¦¨ç¢æˆ‘ä»¬åˆ†æå®ƒçš„åŸç†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http://utp.qq.com/getldns.php?d=
1503491352464.1724.sngdia.imtmp.net
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ª&lt;code&gt;imtmp.net&lt;/code&gt; çš„åŸŸåçœ‹ä¸‹whois ä¿¡æ¯ï¼Œå±äºè…¾è®¯ï¼š&lt;br&gt;
&lt;img alt="imtmp.net" src="/assets/images/2023/20230301171920.png"&gt;&lt;/p&gt;
&lt;p&gt;å‰é¢è¿™ä¸ªæ•°å­—çœ‹ç€åƒæ—¶é—´æˆ³ï¼Œåšæ³•åº”è¯¥å’Œé˜¿é‡Œçš„åšæ³•ä¸€æ ·ï¼Œé‚£ç”¨æˆ·å¯¹è¿™ä¸ªåŸŸåçš„æŸ¥è¯¢åœ¨å“ªé‡Œå‘¢ã€‚&lt;/p&gt;
&lt;p&gt;ç¿»ä¸‹ä»£ç ï¼š&lt;br&gt;
&lt;img alt="qq_ldns_2" src="/assets/images/2023/20230301171939.png"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;getDNS&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;$&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/getldns.php?d=&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dns_domain&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ldndsip&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;

&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;typeof&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;saveDns&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;function&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;

&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="nx"&gt;saveDns&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ldndsip&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;ldnsIMG&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;img&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;IMG&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;img&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;img&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;style&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;display&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;none&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;img&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nx"&gt;dns_domain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ow"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;getTime&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;Math&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;random&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1000000&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.sngdia.imtmp.net&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;           &lt;/span&gt;&lt;span class="nx"&gt;img&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;src&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;dns_domain&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/s&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;       &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœç„¶å’Œæ—¶é—´æˆ³æœ‰å…³ã€‚ç¿»ä¸‹å‰é¢ï¼Œä¹Ÿæ‰¾åˆ°äº†è¿™ä¸ªå›¾ç‰‡çš„è¯·æ±‚ï¼š&lt;br&gt;
&lt;img alt="qq_ldns_3" src="/assets/images/2023/20230301171950.png"&gt;&lt;/p&gt;
&lt;p&gt;å¤šæ­¤ä¸€ä¸¾ï¼Ÿ&lt;/p&gt;
&lt;h2&gt;ç½‘æ˜“DNS æ£€æµ‹å·¥å…·&lt;/h2&gt;
&lt;p&gt;ç½‘æ˜“ä¹Ÿæœ‰ä¸€ä¸ª&lt;a href="https://nstool.netease.com/"&gt;DNSæ£€æµ‹å·¥å…·&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="netease_ldns" src="/assets/images/2023/20230301172004.png"&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;GET https://only-425945-183-240-25-249.nstool.netease.com/
&amp;gt;Response: æ‚¨å¥½ï¼Œå°Šæ•¬çš„ç½‘æ˜“ç”¨æˆ·&amp;lt;br&amp;gt;æ‚¨çš„IPåœ°å€ä¿¡æ¯: 183.240.25.249 å¹¿ä¸œçœå¹¿å·å¸‚ç§»åŠ¨&amp;lt;br&amp;gt;æ‚¨çš„DNSåœ°å€ä¿¡æ¯: 211.136.209.212 å¹¿ä¸œçœå¹¿å·å¸‚ç§»åŠ¨&amp;lt;br&amp;gt;æ‚¨çš„DNSè®¾ç½®æ­£ç¡®
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¹Ÿæ˜¯ç±»ä¼¼çš„åšæ³•ã€‚&lt;/p&gt;
&lt;h2&gt;è±†ç“£ç”¨æˆ·æ£€æµ‹å·¥å…·&lt;/h2&gt;
&lt;p&gt;å‘ç°è±†ç“£ä¹Ÿæœ‰ä¸€ä¸ª&lt;a href="http://doctor.douban.com/"&gt;æ£€æµ‹å·¥å…·&lt;/a&gt;:&lt;br&gt;
&lt;img alt="douban_ldns" src="/assets/images/2023/20230301172015.png"&gt;&lt;/p&gt;
&lt;p&gt;å±…ç„¶ç›´æ¥ç”¨é˜¿é‡Œçš„æ¥å£ã€‚&lt;/p&gt;
&lt;h2&gt;whoami.akamai.net&lt;/h2&gt;
&lt;p&gt;akamai æä¾›äº†ä¸€ä¸ªåŸŸåï¼Œç›´æ¥ping æˆ–è€…dig å°±å¯ä»¥è·å–local dnsåœ°å€ï¼Œè¿™ä¸ªå¾ˆé…·ï¼Œç›´æ¥æŠŠlocal dns å½“ä½œæŸ¥è¯¢ç»“æœè¿”å›ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="akamai_ldns" src="/assets/images/2023/20230301172035.png"&gt;&lt;/p&gt;
&lt;h2&gt;Anycast&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ä»¥ä¸Šå·¥å…·å¤šæ¬¡æ£€æµ‹ï¼Œå¦‚æœä¼šå‘ç°æ£€æµ‹åˆ°çš„åœ°å€ä¸åŒï¼Œå¯èƒ½æ˜¯ç”±äºlocal dns åšäº†&lt;a href="https://en.wikipedia.org/wiki/Anycast"&gt;Anycast&lt;/a&gt;ï¼Œæˆ–è€…æœ‰å‡ºå£IP æœ‰å¤šä¸ªé€ æˆã€‚&lt;/p&gt;</content><category term="2017"></category><category term="dns"></category><category term="web"></category></entry><entry><title>ç»™Pelican æ·»åŠ Twitter Card</title><link href="https://fangpsh.github.io/posts/2017/2017-08-21.html" rel="alternate"></link><published>2017-08-21T00:00:00+08:00</published><updated>2017-08-21T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-08-21:/posts/2017/2017-08-21.html</id><summary type="html">&lt;p&gt;ä¹‹å‰å‘Tweet çš„æ—¶å€™ï¼Œå‘ç°æœ‰äº›é“¾æ¥èƒ½å¤Ÿè¢«è¯†åˆ«å‡ºå†…å®¹ï¼Œå¸¦ç€ä¸€ä¸ªâ€œå¡ç‰‡â€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="twitter_card_demo" src="/assets/images/2023/20230301165513.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="twitter_card_demo_2" src="/assets/images/2023/20230301165525.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯Twitter å¯¹æŸäº›ç½‘ç«™çš„ç‰¹æ®Šç…§é¡¾ï¼Œæœ€è¿‘å–µäº† â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¹‹å‰å‘Tweet çš„æ—¶å€™ï¼Œå‘ç°æœ‰äº›é“¾æ¥èƒ½å¤Ÿè¢«è¯†åˆ«å‡ºå†…å®¹ï¼Œå¸¦ç€ä¸€ä¸ªâ€œå¡ç‰‡â€ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="twitter_card_demo" src="/assets/images/2023/20230301165513.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="twitter_card_demo_2" src="/assets/images/2023/20230301165525.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯Twitter å¯¹æŸäº›ç½‘ç«™çš„ç‰¹æ®Šç…§é¡¾ï¼Œæœ€è¿‘å–µäº†ä¸‹æŸä¸ªç½‘å€çš„æºç ï¼Œæ‰æ˜ç™½æ˜¯éœ€è¦è‡ªå·±è®¾ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="twitter_card_meta" src="twitter_card_meta.jpg"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;twitter:card æ˜¯ç±»å‹ï¼Œå¸¸è§çš„æœ‰summary å’Œsummary_large_image&lt;/li&gt;
&lt;li&gt;twitter:site æ˜¯ç½‘ç«™çš„twitter å¸å·&lt;/li&gt;
&lt;li&gt;twitter:title å¡ç‰‡æ˜¾ç¤ºçš„æ ‡é¢˜&lt;/li&gt;
&lt;li&gt;twitter:description å¡ç‰‡æ˜¾ç¤ºçš„å†…å®¹æ¦‚è¿°&lt;/li&gt;
&lt;li&gt;twitter:images å¡ç‰‡ä¸­çš„å›¾ç‰‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»†èŠ‚å¯ä»¥å‚è€ƒï¼š&lt;a href="https://dev.twitter.com/cards/types/summary"&gt;Twitter Developer Documentation&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæˆ‘çš„ä¸ªäººåšå®¢æ¥è¯´ï¼Œsummary ç±»ä¼¼çš„å¡ç‰‡å°±å¤Ÿç”¨äº†ï¼Œç»™æ¯ç¯‡æ–‡ç« æ‰¾ä¸ªé…å›¾ä¹ŸæŒºç´¯çš„ã€‚&lt;/p&gt;
&lt;p&gt;åšå®¢æ˜¯ç”¨Pelican ç”Ÿæˆçš„ï¼Œæ‰¾äº†ä¸€ä¸‹æ’ä»¶ï¼Œæœç„¶æœ‰ä¸€ä¸ªï¼Œæˆ‘fork äº†ä¸‹ï¼Œä¿®äº†ä¸€ä¸ªbug ï¼š&lt;a href="https://github.com/fangpeishi/twitter_card"&gt;twitter_card&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æŒ‰ç…§æ’ä»¶çš„è¯´æ˜æå®Œä¹‹åï¼Œæµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥ç”¨è¿™ä¸ªå·¥å…·ï¼š&lt;a href="https://cards-dev.twitter.com/validator"&gt;Card validator&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="twitter_card_validator" src="/assets/images/2023/20230301165545.png"&gt;&lt;/p&gt;
&lt;p&gt;æå®šï¼Œç„¶è€Œå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚&lt;/p&gt;</content><category term="2017"></category><category term="pelican"></category></entry><entry><title>è‹±æ–‡ç¼©å†™å­—å…¸</title><link href="https://fangpsh.github.io/posts/2017/2017-07-18.html" rel="alternate"></link><published>2017-07-18T00:00:00+08:00</published><updated>2017-07-18T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-07-18:/posts/2017/2017-07-18.html</id><summary type="html">&lt;p&gt;&lt;img alt="abbreviations_dictionary" src="/assets/images/2023/20230301165301.png"&gt;&lt;/p&gt;
&lt;p&gt;å¥½ä¹…ä¹‹å‰åœ¨V2EX è§è¿‡ç½‘å‹åˆ†äº«çš„ &lt;a href="https://www.v2ex.com/t/227197"&gt;å‘ç°ä¸€ä¸ªæŸ¥å•è¯ç¼©å†™çš„ç½‘ç«™ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘ç»™å˜é‡å‘½åäº†ï¼&lt;/a&gt;ï¼Œä¸€ç›´æ”¶è—ç€æŒºå¥½ç”¨ï¼Œä¸è¿‡ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="abbreviations_dictionary" src="/assets/images/2023/20230301165301.png"&gt;&lt;/p&gt;
&lt;p&gt;å¥½ä¹…ä¹‹å‰åœ¨V2EX è§è¿‡ç½‘å‹åˆ†äº«çš„ &lt;a href="https://www.v2ex.com/t/227197"&gt;å‘ç°ä¸€ä¸ªæŸ¥å•è¯ç¼©å†™çš„ç½‘ç«™ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘ç»™å˜é‡å‘½åäº†ï¼&lt;/a&gt;ï¼Œä¸€ç›´æ”¶è—ç€æŒºå¥½ç”¨ï¼Œä¸è¿‡ç”±äºä¸ªäººä¸€ç›´åœ¨ç”¨çš„æ˜¯Mac OS è‡ªå¸¦çš„Dictionary Appï¼Œå¦‚æœèƒ½åšä¸ªä¸“é—¨æŸ¥ç¼©å†™çš„å­—å…¸åº“ï¼Œå°±æ›´æ–¹ä¾¿äº†ã€‚&lt;/p&gt;
&lt;p&gt;å…ˆè¦çœ‹çœ‹æ€ä¹ˆåˆ›å»ºä¸€ä¸ªMac Dictionary App çš„å­—å…¸æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://blog.nagpals.com/mac-dictionaries/"&gt;Create Custom Dictionaries For Mac OSX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://developer.apple.com/library/content/documentation/UserExperience/Conceptual/DictionaryServicesProgGuide/Introduction/Introduction.html"&gt;Dictionary Services Programming Guide&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªé“¾æ¥æ˜¯ä¸€ç¯‡åšæ–‡ï¼Œæ¯”è¾ƒè€äº†ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ï¼Œä¸»è¦è¿˜æ˜¯çœ‹ç¬¬äºŒä¸ªå®˜æ–¹çš„æŒ‡å—ã€‚åŸºæœ¬æ¥è¯´ç…§ç€åšå³å¯ï¼Œä¸è¿‡ä¸€å¼€å§‹å°±é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç”Ÿæˆå­—å…¸éœ€è¦çš„Dictionary Development Kit ä¸è§äº†ã€‚ç°åœ¨æ–°ç‰ˆæœ¬çš„Xcode éƒ½ä¸å¸¦è¿™ä¸ªå·¥å…·äº†ï¼Œå¾—è‡ªå·±å»&lt;a href="https://developer.apple.com"&gt;developer.apple.com&lt;/a&gt;ä¸‹Auxiliary Toolsã€‚ä¸‹è½½ä¹‹åè§£å‹å¼€ï¼ŒæŠŠDictionary Development Kit æ‹·è´åˆ°è‡ªå·±å–œæ¬¢çš„ç›®å½•ï¼ŒåŒæ—¶å¯ä»¥çœ‹ä¸‹æ–‡ä»¶å¤¹é‡Œé¢çš„project_templates ï¼Œç…§ç€è¿™ä¸ªæ”¹æ”¹å³å¯ã€‚è®°å¾—è¦æ”¹Makefile é‡Œé¢çš„&lt;code&gt;DICT_BUILD_TOOL_DIR&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://apple.stackexchange.com/questions/80099/how-can-i-create-a-dictionary-for-mac-os-x"&gt;How can I create a dictionary for Mac OS X?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤§æ¦‚çŸ¥é“æ€ä¹ˆæ„å»ºå­—å…¸ä¹‹åï¼Œå°±å¼€å§‹æ‰¾ç¼©å†™çš„æ¥æºäº†ï¼Œæ‰’äº†ä¸‹é¢è¿™2ä¸ªç½‘ç«™çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://public.oed.com/how-to-use-the-oed/abbreviations/"&gt;public.oed.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.easypacelearning.com/english-books/english-books-for-download-pdf/category/33-3-dictionaries-to-download-in-pdf"&gt;easypacelearning.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åªæ”¶å½•ç¼©å†™ï¼Œä¸æ”¶å½•é¦–å­—æ¯å¤§å†™ï¼Œä¾‹å¦‚CCTVã€NBA è¿™ç§ï¼Œå› ä¸ºè§‰å¾—é¦–å­—æ¯å¤§å†™æ²¡å•¥ç”¨ï¼Œè¿™ä¸ªå­—å…¸çš„å‡ºå‘ç‚¹å°±æ˜¯æˆ‘æ•²ä»£ç çš„æ—¶å€™ï¼Œå‡½æ•°åå¤ªé•¿äº†æƒ³æ‰¾ç¼©å†™ã€‚&lt;/p&gt;
&lt;p&gt;æ‰‹åŠ¨æ•´ç†åŠ ä¸€äº›ç®€å•çš„å‘½ä»¤ï¼Œå¾—åˆ°åˆå§‹æ–‡ä»¶ï¼Œå†å†™ä¸ªè„šæœ¬ç”Ÿæˆéœ€è¦çš„xmlï¼Œæœ€åå¾—åˆ°å­—å…¸ï¼Œæ•ˆæœå¦‚ä¸Šå›¾ã€‚&lt;/p&gt;
&lt;p&gt;å­—å…¸åº“ä¸‹è½½ã€ç›¸å…³æºç ï¼š&lt;a href="https://github.com/fangpsh/Abbreviations"&gt;fangpsh/Abbreviations&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2017"></category><category term="dictionary"></category><category term="mac"></category></entry><entry><title>Pelicanæ’ä»¶ï¼šCDN Support</title><link href="https://fangpsh.github.io/posts/2017/2017-07-10.html" rel="alternate"></link><published>2017-07-10T00:00:00+08:00</published><updated>2017-07-10T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-07-10:/posts/2017/2017-07-10.html</id><summary type="html">&lt;p&gt;ä¹‹å‰ç”¨WordPress åšåšå®¢çš„æ—¶å€™ï¼Œç”¨è¿‡ä¸€ä¸ª&lt;a href="https://srd.wordpress.org/plugins/wp-super-cache/"&gt;WP Super Cache&lt;/a&gt; çš„æ’ä»¶ï¼Œ&lt;br&gt;
è¿™ä¸ªæ’ä»¶å¯ä»¥æŠŠWordPress çš„é¡µé¢é™æ€åŒ–ï¼Œç„¶åç”¨å†…å­˜æˆ–è€…ç£ç›˜ç­‰åšç¼“å­˜ï¼Œæå‡æ€§ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¹‹å‰ç”¨WordPress åšåšå®¢çš„æ—¶å€™ï¼Œç”¨è¿‡ä¸€ä¸ª&lt;a href="https://srd.wordpress.org/plugins/wp-super-cache/"&gt;WP Super Cache&lt;/a&gt; çš„æ’ä»¶ï¼Œ&lt;br&gt;
è¿™ä¸ªæ’ä»¶å¯ä»¥æŠŠWordPress çš„é¡µé¢é™æ€åŒ–ï¼Œç„¶åç”¨å†…å­˜æˆ–è€…ç£ç›˜ç­‰åšç¼“å­˜ï¼Œæå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å…¶ä¸­æœ‰ä¸ªé€‰é¡¹æ˜¯å¼€å¯CDN æ”¯æŒï¼Œå¼€å¯è¿™ç§åŠŸèƒ½ä¹‹åï¼Œæ’ä»¶ä¼šæŠŠæ‰€æœ‰æŒ‡å‘æœ¬ç«™çš„é™æ€èµ„æºï¼ˆCSSï¼ŒJSï¼Œå„ç±»å›¾ç‰‡ï¼‰çš„URL æ›¿æ¢ä¸ºCDN çš„URLï¼Œå½“ç„¶å¡«å…¥çš„CDN åŸŸåéœ€è¦é…ç½®å¥½å›æºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="wp-super-cache" src="https://www.shoutmeloud.com/wp-content/uploads/2015/05/Enabling-cache-with-WP-Super-cache-plugin.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ€è¿‘å¸®å¦¹å­åšäº†ä¸€ä¸ªç½‘ç«™ï¼Œæƒ³ç€å„ç§ä¼˜åŒ–ï¼Œåˆæƒ³èµ·è¿™äº‹ã€‚è¿™ä¸ªç½‘ç«™æ˜¯ç”¨Pelican ç”Ÿæˆçš„ï¼Œæ‰€æœ‰å°±æœ‰äº†è¿™ä¸ªæ’ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;Pelican æ’ä»¶å¯ä»¥æ³¨å†Œä¸åŒé˜¶æ®µçš„ä¿¡å·ï¼Œé€‰æ‹©äº†&lt;a href="http://docs.getpelican.com/en/3.6.3/plugins.html"&gt;&lt;code&gt;finalized&lt;/code&gt;&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;finalized:
invoked after all the generators are executed and just before pelican exits useful for custom post processing actions, such as: - minifying js/css assets. - notify/ping search engines with an updated sitemap.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç”¨&lt;code&gt;re.sub&lt;/code&gt; æ¨¡å—è¿‡æ»¤ç”Ÿæˆçš„html æ–‡ä»¶ï¼Œæ›¿æ¢é™æ€èµ„æºçš„URLï¼Œå†å†™å›æ–‡ä»¶å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æºä»£ç åŠè®¾ç½®è¯´æ˜ï¼šhttps://github.com/fangpsh/cdn_support&lt;/p&gt;
&lt;p&gt;å½“ç„¶ï¼Œæ›¿æ¢ä¹‹åçš„CDN åŸŸåï¼Œéœ€è¦æå‰åšå¥½æ¥å…¥å’Œå›æºè®¾ç½®ç­‰å·¥ä½œã€‚&lt;/p&gt;</content><category term="2017"></category><category term="pelican"></category></entry><entry><title>å›¾ç‰‡ä¼˜åŒ–ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2017/2017-06-08.html" rel="alternate"></link><published>2017-06-08T15:11:11+08:00</published><updated>2017-06-08T15:11:11+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-06-08:/posts/2017/2017-06-08.html</id><summary type="html">&lt;p&gt;è¿™é‡Œè¯´çš„å›¾ç‰‡ä¼˜åŒ–ï¼Œç›®æ ‡æ˜¯æƒ³å°½å¯èƒ½é™ä½å›¾ç‰‡å¤§å°ï¼Œä½†åˆè¦ä¿è¯è´¨é‡ä¸é”™ï¼Œéå¸¸çŸ›ç›¾ã€‚ä¸è¿‡é™ä½å›¾ç‰‡å¤§å°ï¼Œå¯ä»¥å‰©ä¸€å¤§ç¬”æµé‡ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¿™é‡Œè¯´çš„å›¾ç‰‡ä¼˜åŒ–ï¼Œç›®æ ‡æ˜¯æƒ³å°½å¯èƒ½é™ä½å›¾ç‰‡å¤§å°ï¼Œä½†åˆè¦ä¿è¯è´¨é‡ä¸é”™ï¼Œéå¸¸çŸ›ç›¾ã€‚ä¸è¿‡é™ä½å›¾ç‰‡å¤§å°ï¼Œå¯ä»¥å‰©ä¸€å¤§ç¬”æµé‡é’±ï¼Œé™ä½è´Ÿè½½ï¼Œè¿˜èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼Œå€¼å¾—èŠ±ç‚¹åŠŸå¤«ã€‚&lt;/p&gt;
&lt;p&gt;å‰ç«¯æ–¹é¢æœ‰ä¸€äº›å…³äºå›¾ç‰‡åŠ è½½é€Ÿåº¦çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚CSS ç”»å›¾ï¼ŒCSS åˆå¹¶ç´ æï¼Œç”šè‡³ç”¨CSS æŠŠå›¾ç‰‡Base64 ç¼–ç ï¼ˆä¸æ¨èï¼‰ï¼Œå’Œè¿™ä»½ç¬”è®°å…³ç³»ä¸å¤§ã€‚&lt;/p&gt;
&lt;h2&gt;æ ¼å¼é€‰æ‹©&lt;/h2&gt;
&lt;p&gt;ä¸åŒçš„éœ€æ±‚é€‰æ‹©ä¸åŒçš„æ ¼å¼, JPEG èƒ½å¤Ÿæ»¡è¶³çš„éœ€æ±‚æ²¡å¿…è¦é€‰æ‹©PNGã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="format-tree" src="/assets/images/2023/20230301155951.png"&gt;&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥æºï¼š&lt;a href="http://jixianqianduan.com/frontend-weboptimize/2015/11/17/front-end-image-optmize.html"&gt;ã€Šwebå‰ç«¯å›¾ç‰‡æé™ä¼˜åŒ–ç­–ç•¥ã€‹&lt;/a&gt;ï¼ŒåŸå›¾æ˜¯Google çš„&lt;a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/image-optimization"&gt;Image Optimization&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;WebPã€SharpP&lt;/h3&gt;
&lt;p&gt;ç›®å‰å¯¹äºWebP çš„æ”¯æŒå·²ç»å¾ˆå¥½äº†ï¼Œæ‰€ä»¥æ–°ä¸šåŠ¡èƒ½å¤Ÿé€‰æ‹©WebPï¼Œå°±é€‰WebPã€‚&lt;br&gt;
è±†ç“£çš„ç›¸å†Œåˆ‡åˆ°äº†WebPï¼Œå¦å¤–æä¾›äº†ä¸€ä¸ªè®©å›¾ç‰‡å˜æ¸…æ™°çš„æ€è·¯ï¼šæŠŠå›¾ç‰‡å°ºå¯¸æ‹‰å¤§åˆ°2å€ï¼Œç„¶åç¼©å°æˆ1å€ã€‚&lt;br&gt;
å›¾ç‰‡æ¸…æ™°åº¦å¤§å¤§æå‡ï¼Œè¿˜é™ä½äº†å›¾ç‰‡å¤§å°ï¼š&lt;code&gt;2x WebP(73k) &amp;lt; 1x JPG(119k)&lt;/code&gt;ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼ˆå›¾ç‰‡æ¥æº è±†ç“£ æ³¢å¸Œç±³äºšçš„æ—¥è®°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="douban.jpg" src="/assets/images/2023/20230301160002.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸è¿‡é‡‡ç”¨WebP ä¹‹åï¼Œç”¨æˆ·â€œå¦å­˜ä¸ºâ€ä¸å¤ªæ–¹ä¾¿ï¼Œæ¯•ç«Ÿå¤§å®¶å¯¹PNGå’ŒJPEG æ¯”è¾ƒç†Ÿæ‚‰ã€‚&lt;/p&gt;
&lt;p&gt;è±†ç“£çš„WebP å®è·µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.douban.com/note/613447642/"&gt;ã€Šè¿™ä¸ªä¸–ç•Œåˆç¾å¥½äº†ä¸€ç‚¹ç‚¹â€”â€”ç›¸å†Œç¯‡ã€‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.douban.com/note/616303673/"&gt;ã€Šè¿™ä¸ªä¸–ç•Œåˆç¾å¥½äº†ä¸€ç‚¹ç‚¹â€”â€”æ—¥è®°ç¯‡ã€‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰è¶£çš„æ˜¯ï¼ŒWebP åŸºäº&lt;a href="https://zh.wikipedia.org/wiki/VP8"&gt;VP8&lt;/a&gt;ï¼ŒVP8 çš„ä¸‹ä¸€ä»£æ˜¯&lt;a href="https://zh.wikipedia.org/wiki/VP9"&gt;VP9&lt;/a&gt;ï¼ŒVP9 çš„å¯¹æ‰‹æ˜¯&lt;a href="https://zh.wikipedia.org/zh/%E9%AB%98%E6%95%88%E7%8E%87%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81"&gt;HEVC/H.265&lt;/a&gt;ï¼Œ&lt;a href="https://zh.wikipedia.org/wiki/BPG"&gt;BGP&lt;/a&gt; åŸºäºHEVCï¼Œæ®è¯´è¡¨ç°æ¯”WebP å¥½å¾ˆå¤šï¼Œä¸çŸ¥ä¸ºå•¥åº”ç”¨ä¸å¤šï¼Œå› ä¸ºä¸“åˆ©ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è…¾è®¯åŸºäºHEVC æå‡ºäº†ä¸€ä¸ªSharpP æ ¼å¼ï¼Œå¬è¯´ç§’å¤©ç§’åœ°ï¼Œç›®å‰å·²åœ¨è…¾è®¯äº‘CDN ä¸Šåº”ç”¨ï¼Œä¸è¿‡æ¥å…¥çš„å¤§éƒ½æ˜¯è…¾è®¯è‡ªå®¶çš„äº§å“ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="SharpP.jpg" src="/assets/images/2023/20230301160018.png"&gt;&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¨¡ç…³çš„æ²¡åŠæ³•:( ï¼Œ&lt;br&gt;
å›¾ç‰‡æ¥æºï¼š&lt;a href="https://www.qcloud.com/community/article/164816001481011868"&gt;ã€Šå›¾ç‰‡æµé‡èŠ‚çœå¤§æ€å™¨ï¼šåŸºäº CDN çš„ sharpP è‡ªé€‚åº”å›¾ç‰‡æŠ€æœ¯å®è·µã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;çœ‹èµ·æ¥ç¡®å®ä¸é”™ï¼Œå¬è¯´åœ¨ç§»åŠ¨ç«¯è§£ç é€Ÿåº¦ä¹Ÿå¾ˆå¿«ï¼Œä¸è¿‡å¦‚æ­¤å¤§è§„æ¨¡ä½¿ç”¨ä¼°è®¡èŠ±äº†ä¸å°‘ä¸“åˆ©è´¹ã€‚ç¬¬ä¸‰æ–¹ç”¨æˆ·ä½¿ç”¨ä¹Ÿä¸æ–¹ä¾¿ï¼Œå¾—ä½¿ç”¨&lt;a href="https://x5.tencent.com/tbs/"&gt;X5å†…æ ¸&lt;/a&gt;ï¼Œä¸”åªèƒ½ç”¨è…¾è®¯äº‘çš„CDNï¼Œè¿™æ ·è¢«æ´»æ´»ç»‘æ­»çš„äº‹æƒ…ï¼Œæ„¿æ„çš„äººåº”è¯¥ä¸å¤šã€‚å¦å¤–è…¾è®¯è¿˜æäº†ä¸€ä¸ª&lt;a href="http://www.ifanr.com/832678"&gt;TPG&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡å„ç§ä¸“åˆ©ä¹‹äº‰ï¼Œåªä¼šå¯¼è‡´æ¨å¹¿å—é˜»ï¼Œæˆ‘ä»¬è¿˜æ˜¯æƒ³æƒ³æ€ä¹ˆä¼˜åŒ–JPEG å’ŒPNG å§ã€‚&lt;/p&gt;
&lt;p&gt;å„ç§æ ¼å¼çš„ä»‹ç»å¯ä»¥å‚è€ƒï¼š&lt;a href="http://jixianqianduan.com/frontend-weboptimize/2015/11/17/front-end-image-optmize.html"&gt;ã€Šwebå‰ç«¯å›¾ç‰‡æé™ä¼˜åŒ–ç­–ç•¥ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;Yelp çš„å›¾ç‰‡ä¼˜åŒ–ç»éªŒ&lt;/h2&gt;
&lt;p&gt;å†™è¿™ç¯‡ç¬”è®°ï¼Œä¹Ÿæ˜¯å› ä¸ºçœ‹åˆ°Yelp çš„ä¸€ç¯‡åšæ–‡ï¼š&lt;a href="https://engineeringblog.yelp.com/2017/06/making-photos-smaller.html"&gt;Making Photos Smaller Without Quality Loss&lt;/a&gt;ï¼Œç„¶åå»¶ä¼¸çœ‹äº†ä¸€äº›ä¸œè¥¿ã€‚
Yelp çš„ä¼˜åŒ–å›´ç»•JPEG å’ŒPNGï¼Œè€Œä¸”çœ‹èµ·æ¥å¾ˆé€šç”¨ï¼Œå€¼å¾—å­¦ä¹ ã€‚&lt;/p&gt;
&lt;h3&gt;ç”¨Pillow ä¼˜åŒ–å›¾ç‰‡&lt;/h3&gt;
&lt;p&gt;Yelp ç”¨&lt;a href="https://python-pillow.org/"&gt;Pillow &lt;/a&gt;æ¥ä¿å­˜å›¾ç‰‡ï¼ŒPillow æ”¯æŒ&lt;a href="http://pillow.readthedocs.io/en/4.1.x/handbook/image-file-formats.html?highlight=optimize"&gt;optimize&lt;/a&gt;çš„å‚æ•°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;optimize
If present and true, indicates that the encoder should make an extra pass over the image in order to select optimal encoder settings.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦å¤–ä¹Ÿè¿˜æœ‰å…¶ä»–ä¼˜åŒ–æ–¹å¼ï¼Œä¾‹å¦‚å¤§åé¼é¼çš„&lt;a href="https://tinypng.com/"&gt;Tinypng&lt;/a&gt;ï¼Œ&lt;a href="https://zhitu.isux.us/"&gt;æ™ºå›¾&lt;/a&gt; ç­‰ã€‚æ¨èPillowï¼ŒPillow çš„æ•ˆæœä¸å·®ï¼Œè€Œä¸”å¼€æºã€å…è´¹ã€‚&lt;/p&gt;
&lt;h3&gt;é€‰æ‹©æ¸è¿›å¼ï¼ˆProgressiveï¼‰ JPEG&lt;/h3&gt;
&lt;p&gt;å¸¸è§çš„JPEG æœ‰2ç§ï¼ŒåŸºæœ¬å¼ï¼ˆBaselineï¼‰å’Œæ¸è¿›å¼ï¼ˆProgressiveï¼‰ï¼Œæ˜æ˜¾çš„åŒºåˆ«æ˜¯å‰è€…ä»ä¸Šè‡³ä¸‹åŠ è½½ï¼Œåè€…åŠ è½½è¿‡ç¨‹ä»æ¨¡ç…³åˆ°æ¸…æ™°ã€‚å‚è€ƒä¸‹å›¾ï¼š
&lt;img alt="progressive" src="/assets/images/2023/20230301160342.png"&gt;&lt;/p&gt;
&lt;p&gt;æ¸è¿›å¼ä¸€èˆ¬ä¼šæ¯”åŸºæœ¬å¼å°ä¸€äº›ï¼Œè€Œä¸”åŠ è½½é€Ÿåº¦æ›´å¿«ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="speed" src="/assets/images/2023/20230301160125.png"&gt;&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥æºï¼š&lt;a href="http://www.zhangxinxu.com/wordpress/2013/01/progressive-jpeg-image-and-so-on/"&gt;ã€Šæ¸è¿›å¼jpeg(progressive jpeg)å›¾ç‰‡åŠå…¶ç›¸å…³ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è€Œä¸”ä»ç”¨æˆ·ä½“éªŒä¸Šæ¥è¯´ï¼Œä»æ¨¡ç…³åˆ°æ¸…æ™°æ¯”ä»ç©ºç™½å±•å¼€åˆ°å…¨éƒ¨ï¼Œå‰è€…ä½“éªŒæ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºä¸ºä½•æ¸è¿›å¼ä¼šæ›´å°ï¼Œéœ€è¦ä»JPEG çš„åŸç†è¯´èµ·ï¼ˆå¯¹è¿™ä¸€å—ä¹Ÿä¸€çŸ¥åŠè§£ï¼‰ï¼ŒJPEGè¢«æŒ‰ç…§8x8ï¼Œä»åæ ‡å˜æ¢ï¼ŒDCT å˜æ¢ï¼Œé‡æ’åˆ—ï¼Œæœ€åé‡åŒ–ï¼Œå¾—åˆ°çš„ç»“æœå·¦ä¸Šè§’æ˜¯å¤§é‡æ­£æ•°ï¼Œå³ä¸‹è§’èšé›†å¤§é‡0ï¼Œç„¶åå†Zig-Zag æ‰«æï¼Œå†ç”¨éœå¤«æ›¼ç¼–ç å‹ç¼©ã€‚æ¸è¿›å¼çš„æƒ…å†µä¸‹ï¼Œç›¸å½“äºåˆ†å±‚äº†ï¼Œå‰é¢çš„æ‰«æåŒ…å«ç€å¤§é‡æ­£æ•°ï¼Œåé¢çš„æ‰«æå…³æ³¨æ›´å¤šç»†èŠ‚ï¼ŒåŒ…å«å¤§é‡çš„0ï¼Œè¿™æ ·å¯¼è‡´0 ä¸€èµ·å‡ºç°çš„æ¦‚ç‡å¢åŠ ï¼Œä»è€Œæ›´æ˜“äºå‹ç¼©ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹æ­¤ä¸€çŸ¥åŠè§£ï¼Œçœ‹åˆ°DCT å˜æ¢ï¼Œæ¶‰åŠåˆ°å‚…é‡Œå¶å˜æ¢ï¼Œæ„Ÿè§‰é«˜æ•°éƒ½å¿˜è®°äº†ï¼Œæƒ­æ„§ï¼Œæœ‰å…´è¶£çš„åŒå­¦è¯·è‡ªè¡Œé˜…è¯»ä»¥ä¸‹ä¸¤ä»½èµ„æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://twins.ee.nctu.edu.tw/courses/soclab_04/lab_hw_pdf/proj1_jpeg_introduction.pdf"&gt;å°æ¹¾å›½ç«‹äº¤é€šå¤§å­¦ç”µå­å·¥ç¨‹ç³»çš„ä¸€ä»½å®éªŒæ‰‹å†Œï¼šJPEG ç®€ä»‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.codingnow.com/2000/download/jpeg.txt"&gt;äº‘é£ï¼šJPEG ç®€æ˜“æ–‡æ¡£ V2.15&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;å¤§å°ºå¯¸çš„PNG åˆ¤æ–­ï¼Œç„¶åè½¬æ¢ä¸ºJPEG&lt;/h3&gt;
&lt;p&gt;PNG æ— æŸå‹ç¼©ï¼Œä½“ç§¯éƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥èƒ½ä¸ç”¨PNG å°±ä¸ç”¨ï¼Œä¸è¿‡å¦‚æœåƒYelp è¿™ç§ï¼Œç”¨æˆ·ä¼šä¸Šä¼ PNG çš„è¯ï¼Œä¾‹å¦‚iPhone çš„å±å¹•æˆªå›¾ä¿å­˜çš„æ ¼å¼å°±æ˜¯PNGï¼Œå®Œå…¨å¯ä»¥è½¬æ¢ä¸ºJPEGã€‚Yelp é‡åˆ°çš„é—®é¢˜æ˜¯å¦‚æœç”¨æˆ·ä¼ çš„æ˜¯LOGO ä¹‹ç±»çš„ï¼Œéœ€è¦æ— æŸï¼Œå°±ä¸èƒ½è½¬æ¢æˆJPEGï¼Œæ‰€ä»¥ä»–ä»¬æƒ³äº†ä¸€ä¸ªåŠæ³•ï¼š&lt;br&gt;
ç”Ÿæˆä¸€ä»½PNG çš„ç¼©ç•¥å›¾ï¼Œå¦‚æœå¤§äº300KiBï¼Œå†æ£€æŸ¥è¿™ä¸ªç¼©ç•¥å›¾æ˜¯å¦åŒ…å«è¶…è¿‡2^16 ç§ä¸åŒçš„è‰²å½©ã€‚ä¸€èˆ¬æ¥è¯´LOGO çš„è‰²å½©éƒ½æ¯”è¾ƒå°‘å’Œå•ä¸€ã€‚&lt;/p&gt;
&lt;h3&gt;åŠ¨æ€è®¾ç½®JPEG è´¨é‡å› å­ï¼ˆQualityï¼‰&lt;/h3&gt;
&lt;p&gt;JPEG æœ‰ä¸€ä¸ªè´¨é‡å› å­ï¼Œä»0åˆ°100ï¼Œè¡¨ç¤ºå›¾ç‰‡çš„è´¨é‡ä»å·®åˆ°å¥½ã€‚Yelp åšäº†ä¸€ä¸ªå®éªŒï¼Œå‘ç°åœ¨quality åœ¨80~85 ä¹‹é—´çš„æ—¶å€™ï¼Œå›¾ç‰‡æ•ˆæœè‚‰çœ¼çœ‹åŸºæœ¬æ²¡å·®åˆ«ï¼Œ&lt;a href="https://zh.wikipedia.org/wiki/%E7%B5%90%E6%A7%8B%E7%9B%B8%E4%BC%BC%E6%80%A7"&gt;SSIM&lt;/a&gt; åœ¨0.9~0.95ã€‚SSIM ä¸­æ–‡åç§°ï¼šç»“æ„ç›¸ä¼¼æ€§ï¼Œç”¨æ¥åˆ¤æ–­ä¸¤å¼ å›¾ç‰‡çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œæ‹¿ä¸€å¼ å‹ç¼©åçš„å›¾ç‰‡å’ŒåŸå›¾æ¯”è¾ƒï¼Œç›¸ä¼¼è¶Šé«˜ï¼Œè¯´æ˜å¤±çœŸè¶Šå°ï¼Œæ•°å­¦åŸç†å¯ä»¥çœ‹ç»´åŸºç™¾ç§‘ï¼ŒYelp ç”¨&lt;a href="https://github.com/jterrace/pyssim/"&gt;pyssim&lt;/a&gt;æ¥è®¡ç®—SSIMã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="ssims-strategies" src="/assets/images/2023/20230301160134.png"&gt;&lt;/p&gt;
&lt;p&gt;è´¨é‡è®¾ç½®ä¸º80~85 ä¹‹é—´æŸä¸€ä¸ªå€¼çš„æ—¶å€™ï¼ŒSSIM è¿˜èƒ½ä¿æŒåœ¨0.9åˆ°0.95ï¼Œå¤šå¥‡å¦™å•Šã€‚Yelp æä¾›äº†ä¸€æ®µè„šæœ¬æ¥æ‰¾å‡ºå›¾ç‰‡åˆé€‚çš„quality å€¼ï¼š&lt;a href="https://gist.github.com/thebostik/cfc9f059459cfefd1f61134b48291436"&gt;dynamic_quality.py&lt;/a&gt;ï¼Œç”¨ç±»ä¼¼äºŒåˆ†æ³•çŒœæ•°å­—çš„æ–¹æ³•:Pã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ä¸ªäººè§‰å¾—å¯¹äºä¸€äº›è‰²å½©æ¯”è¾ƒå•ä¸€çš„å›¾ç‰‡ï¼Œå¯ä»¥æ¿€è¿›ä¸€ç‚¹ï¼Œä¾‹å¦‚ä»20~85 å¼€å§‹æ‰¾æœ€åˆé€‚çš„å‹ç¼©æ¯”ã€‚ä¸ºä»€ä¹ˆè‰²å½©å•ä¸€çš„å¯ä»¥è°ƒä½è´¨é‡å‘¢ï¼Œå› ä¸ºè‚‰çœ¼çœ‹ä¸å‡ºæ¥å•Šã€‚æ‰€ä»¥æ˜¯ä¸æ˜¯å¯ä»¥å»¶ä¼¸ä¸€ä¸‹ï¼Œç”¨å¤§é‡çš„è®­ç»ƒæ•°æ®ï¼Œç”¨AI çš„æ–¹æ³•æ‰¾åˆ°æœ€åˆé€‚çš„quality ï¼Ÿæƒ³èµ·æ¥Googleä¹‹å‰æ¨å‡ºçš„&lt;a href="https://www.blog.google/products/google-plus/saving-you-bandwidth-through-machine-learning/"&gt;RAISR&lt;/a&gt;ï¼Œéå¸¸å‰å®³ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="RAISR" src="/assets/images/2023/20230301160144.png"&gt;&lt;/p&gt;
&lt;p&gt;æ‰¯è¿œäº†ã€‚&lt;/p&gt;
&lt;p&gt;Yelp åšå®¢æåˆ°çš„å…¶ä»–ä¸¤ç¯‡ç›¸å…³æ–‡ç« ï¼Œç±»ä¼¼çš„æ€è·¯ï¼Œå¹¶ä¸”æ–‡ä¸­éƒ½æœ‰æˆå‹çš„å¼€æºå·¥å…·ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://codeascraft.com/2017/05/30/reducing-image-file-size-at-etsy/"&gt;Reducing Image File Size at Etsy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://medium.com/@duhroach/reducing-jpg-file-size-e5b27df3257c"&gt;Reducing JPG File size&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;å…¶ä»–&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨Mozjpeg æ›¿ä»£libjpeg-turbo æˆ– libjpegï¼Œæ€§èƒ½æå‡æ˜æ˜¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Chroma_subsampling"&gt;Subsampling&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å°è¯•æœ‰æŸçš„PNG ç¼–ç &lt;/li&gt;
&lt;li&gt;SVG ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç›®å‰ï¼Œå·¥ä½œä¸Šæ²¡æœ‰å®è·µçš„æœºä¼šï¼Œçº¸ä¸Šè°ˆå…µï¼Œå¸Œæœ›ä»¥åæœ‰æœºä¼šç»ƒæ‰‹ã€å®è·µã€‚&lt;/p&gt;</content><category term="2017"></category><category term="image"></category></entry><entry><title>htop è§£é‡Š</title><link href="https://fangpsh.github.io/posts/2017/2017-04-05.html" rel="alternate"></link><published>2017-04-05T10:18:30+08:00</published><updated>2017-04-05T10:18:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-04-05:/posts/2017/2017-04-05.html</id><summary type="html">&lt;blockquote&gt;
&lt;p&gt;"Explanation of everything you can see in htop/top on Linux"&lt;/p&gt;
&lt;p&gt;â€œè§£é‡Šä½ åœ¨Linux ä¸Šhtop/top ä¸­çœ‹åˆ°çš„æ‰€æœ‰å†…å®¹â€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://peteris.rocks/blog/htop/"&gt;åŸæ–‡åœ°å€&lt;/a&gt;ï¼š&lt;ul&gt;
&lt;li&gt;https://peteris.rocks/blog/htop/&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éµå¾ªåŸæ–‡è®¸å¯åè®®ï¼š&lt;a href="http://www.apache.org/licenses/LICENSE-2.0"&gt;Apache 2.0 license&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€… â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;blockquote&gt;
&lt;p&gt;"Explanation of everything you can see in htop/top on Linux"&lt;/p&gt;
&lt;p&gt;â€œè§£é‡Šä½ åœ¨Linux ä¸Šhtop/top ä¸­çœ‹åˆ°çš„æ‰€æœ‰å†…å®¹â€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://peteris.rocks/blog/htop/"&gt;åŸæ–‡åœ°å€&lt;/a&gt;ï¼š&lt;ul&gt;
&lt;li&gt;https://peteris.rocks/blog/htop/&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;éµå¾ªåŸæ–‡è®¸å¯åè®®ï¼š&lt;a href="http://www.apache.org/licenses/LICENSE-2.0"&gt;Apache 2.0 license&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½œè€…:&lt;a href="https://peteris.rocks/"&gt;PÄ“teris Å…ikiforovs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;åŸæ–‡ä¿®è®¢æ—¶é—´ï¼šJanuary 2, 2017 &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½ä¸æ¸…æ¥šhtop ä¸­æ‰€æœ‰å†…å®¹çš„æ„æ€ã€‚&lt;br&gt;
æˆ‘æ›¾ç»ä»¥ä¸ºæˆ‘çš„åŒæ ¸æœºå™¨ä¸Š&lt;code&gt;1.0&lt;/code&gt;çš„å¹³å‡è´Ÿè½½æ„å‘³ç€CPU åˆ©ç”¨ç‡æ˜¯50%ã€‚è¿™å¹¶ä¸å®Œå…¨æ­£ç¡®ã€‚è€Œä¸”ï¼Œä¸ºä»€ä¹ˆæ˜¯&lt;code&gt;1.0&lt;/code&gt;å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘å†³å®šæŸ¥æ¸…æ¥šï¼Œå¹¶è®°å½•æˆè¿™ä»½æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å®¶ä¹Ÿéƒ½è¯´ï¼Œå­¦ä¹ äº‹ç‰©çš„æœ€å¥½æ–¹å¼æ˜¯é€šè¿‡æ•™åˆ«äººã€‚&lt;/p&gt;
&lt;h2&gt;Ubuntu Server 16.04 x64 ä¸Šçš„htop&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä¸€å¼ æˆ‘è¦è§£é‡Šçš„htop æˆªå›¾ã€‚&lt;br&gt;
&lt;img alt="canyoukillit-before" src="/assets/images/2023/20230301153350.png"&gt;&lt;/p&gt;
&lt;h2&gt;Uptime&lt;/h2&gt;
&lt;p&gt;Uptime æ˜¾ç¤ºç³»ç»Ÿå·²ç»æ­£å¸¸è¿è¡Œäº†å¤šä¹…ã€‚&lt;br&gt;
ä½ å¯ä»¥é€šè¿‡è¿è¡Œ&lt;code&gt;uptime&lt;/code&gt; å‘½ä»¤çœ‹åˆ°åŒæ ·çš„å†…å®¹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ uptime
 12:17:58 up 111 days, 31 min,  1 user,  load average: 0.00, 0.01, 0.05
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;uptime&lt;/code&gt; ç¨‹åºæ˜¯æ€ä¹ˆè·å–è¿™äº›ä¿¡æ¯çš„ï¼Ÿ&lt;br&gt;
å®ƒæ˜¯ä»&lt;code&gt;/proc/uptime&lt;/code&gt;æ–‡ä»¶ä¸­è¯»å–è¿™äº›ä¿¡æ¯ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;9592411.58 9566042.33
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¬¬ä¸€ä¸ªå€¼æ˜¯ç³»ç»Ÿæ€»å…±å·²ç»è¿è¡Œçš„ç§’æ•°ã€‚ç¬¬äºŒä¸ªå€¼æ˜¯æœºå™¨ç©ºé—²çš„æ€»ç§’æ•°ï¼Œåœ¨å¤šæ ¸æœºå™¨ä¸Šç¬¬äºŒä¸ªå€¼å¯èƒ½æŸäº›æ—¶åˆ»ä¼šå¤§äºç³»ç»Ÿæ€»ä½“çš„è¿è¡Œæ—¶é—´ï¼Œå› ä¸ºå®ƒæ˜¯å¤šä¸ªæ ¸å¿ƒçš„æ€»ç©ºé—²æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘æ€ä¹ˆçŸ¥é“çš„ï¼Ÿæˆ‘æŸ¥çœ‹äº†&lt;code&gt;uptime&lt;/code&gt; ç¨‹åºè¿è¡Œçš„æ—¶å€™æ‰“å¼€äº†å“ªäº›æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç”¨&lt;code&gt;strace&lt;/code&gt; å·¥å…·æ¥è·Ÿè¸ªã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;strace uptime
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰§è¡Œä¸Šè¿°å‘½ä»¤ä¼šå¾—åˆ°ä¸€å¤§å †è¾“å‡ºã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code&gt;grep&lt;/code&gt; è¿‡æ»¤å‡º&lt;code&gt;open&lt;/code&gt;  çš„ç³»ç»Ÿè°ƒç”¨ã€‚ä½†æ˜¯è¿™æ ·ä¸ä¼šèµ·ä½œç”¨ï¼Œå› ä¸º&lt;code&gt;strace&lt;/code&gt; ä¼šæŠŠæ‰€æœ‰å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯(stderr)æµã€‚æˆ‘ä»¬ç”¨&lt;code&gt;2&amp;gt;&amp;amp;1&lt;/code&gt;å¯ä»¥æŠŠæ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º(stdout)æµã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¾—åˆ°çš„è¾“å‡ºå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ strace uptime 2&amp;gt;&amp;amp;1 | grep open
...
open(&amp;quot;/proc/uptime&amp;quot;, O_RDONLY)          = 3
open(&amp;quot;/var/run/utmp&amp;quot;, O_RDONLY|O_CLOEXEC) = 4
open(&amp;quot;/proc/loadavg&amp;quot;, O_RDONLY)         = 4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­åŒ…å«æˆ‘æåˆ°çš„&lt;code&gt;/proc/uptime&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å…¶å®ä½ ä¹Ÿå¯ä»¥ç”¨&lt;code&gt;strace -e open uptime&lt;/code&gt;ï¼Œä¸å¿…ç”¨&lt;code&gt;grep&lt;/code&gt; è¿‡æ»¤ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ä»è¿™äº›æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦&lt;code&gt;uptime&lt;/code&gt; ç¨‹åºå‘¢ï¼Ÿè¿™æ˜¯å› ä¸º&lt;code&gt;uptime&lt;/code&gt;çš„è¾“å‡ºæ ¼å¼å¯¹äººæ¥è¯´æ›´å‹å¥½ï¼Œä¸è¿‡åœ¨ä½ çš„ç¨‹åºæˆ–è€…è„šæœ¬é‡Œè¿˜æ˜¯ä½¿ç”¨ç§’æ•°æ–¹ä¾¿ä¸€äº›ã€‚&lt;/p&gt;
&lt;h2&gt;å¹³å‡è´Ÿè½½&lt;/h2&gt;
&lt;p&gt;é™¤äº†æ­£å¸¸è¿è¡Œæ—¶é—´ï¼Œå¦å¤–è¿˜æœ‰ä¸‰ä¸ªæ•°å€¼è¡¨ç¤ºå¹³å‡è´Ÿè½½ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ uptime
 12:59:09 up 32 min,  1 user,  load average: 0.00, 0.01, 0.03
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®ƒä»¬æ˜¯ä»&lt;code&gt;/proc/loadavg&lt;/code&gt;æ–‡ä»¶ä¸­è¯»å–çš„ã€‚å¦‚æœä½ å†çœ‹ä¸€çœ¼&lt;code&gt;strace&lt;/code&gt;çš„è¾“å‡ºï¼Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶è¢«æ‰“å¼€äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat /proc/loadavg
0.00 0.01 0.03 1/120 1500
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‰ä¸‰åˆ—æ•°åˆ†åˆ«è¡¨ç¤ºç³»ç»Ÿæœ€è¿‘1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿå’Œ15åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½ã€‚ç¬¬å››åˆ—æ•°è¡¨ç¤ºç›®å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°å’Œæ€»è¿›ç¨‹æ•°ã€‚æœ€åä¸€åˆ—æ˜¾ç¤ºäº†æœ€è¿‘ä¸€æ¬¡è¿è¡Œçš„è¿›ç¨‹IDã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ä»æœ€åä¸€ä¸ªæ•°å¼€å§‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½ æ¯æ¬¡å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹æ—¶ï¼Œéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªID å·ã€‚è¿›ç¨‹ID é€šå¸¸æ˜¯é€æ¸å¢å¤§ï¼Œé™¤éå®ƒä»¬å·²ç»è€—å°½ï¼Œå¹¶è¢«é‡å¤ä½¿ç”¨ã€‚è¿›ç¨‹ID 1 å±äº&lt;code&gt;/sbin/init&lt;/code&gt;ï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿå¯åŠ¨çš„æ—¶è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨çœ‹ä¸€é&lt;code&gt;/proc/loadavg&lt;/code&gt;çš„å†…å®¹ï¼Œå¹¶åœ¨åå°æ‰§è¡Œ&lt;code&gt;sleep&lt;/code&gt;å‘½ä»¤ã€‚å½“å®ƒåœ¨åå°å¯åŠ¨æ—¶ï¼Œå®ƒçš„è¿›ç¨‹ID ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat /proc/loadavg
0.00 0.01 0.03 1/123 1566
$ sleep 10 &amp;amp;
[1] 1567
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰€ä»¥&lt;code&gt;1/123&lt;/code&gt; æ„å‘³ç€è¿™ä¸€åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼Œå¹¶ä¸”æ€»å…±æœ‰&lt;code&gt;123&lt;/code&gt;ä¸ªè¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ è¿è¡Œ&lt;code&gt;htop&lt;/code&gt; æ—¶ï¼Œåªçœ‹åˆ°åªæœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„è¯ï¼Œè¿™ä¸ªè¿›ç¨‹å°±æ˜¯&lt;code&gt;htop&lt;/code&gt; è‡ªèº«ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ‰§è¡Œ&lt;code&gt;sleep 30&lt;/code&gt;ï¼Œç„¶åå†æ¬¡è¿è¡Œ&lt;code&gt;htop&lt;/code&gt;ï¼Œä½ ä¼šçœ‹åˆ°è¿˜æ˜¯åªæœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚è¿™æ˜¯å› ä¸º&lt;code&gt;sleep&lt;/code&gt;æ²¡åœ¨è¿è¡Œï¼Œå®ƒæ­£å¤„äºä¼‘çœ æˆ–ç©ºé—²çŠ¶æ€ï¼Œæˆ–è€…è¯´æ˜¯åœ¨ç­‰å¾…æŸäº‹å‘ç”Ÿã€‚ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„å®šä¹‰æ˜¯å½“å‰æ­£åœ¨æŸä¸ªç‰©ç†CPU ä¸Šè¿è¡Œï¼Œæˆ–è€…ç­‰å¾…è°ƒåº¦åˆ°CPU ä¸Šè¿è¡Œçš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ‰§è¡Œ&lt;code&gt;cat /dev/urandom &amp;gt; /dev/null&lt;/code&gt;ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šä¸æ–­ç”Ÿæˆéšæœºçš„å­—èŠ‚ï¼Œå¹¶å†™å…¥åˆ°ä¸€ä¸ªç‰¹æ®Šçš„æ— æ³•è¢«è¯»å–çš„æ–‡ä»¶ï¼Œä½ å°†ä¼šçœ‹åˆ°æœ‰2ä¸ªæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat /dev/urandom &amp;gt; /dev/null &amp;amp;
[1] 1639
$ cat /proc/loadavg
1.00 0.69 0.35 2/124 1679
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ ·ç°åœ¨æœ‰2ä¸ªè¿è¡Œä¸­çš„è¿›ç¨‹ï¼ˆéšæœºæ•°ç”Ÿæˆå’Œè¯»å–&lt;code&gt;/proc/loadavg&lt;/code&gt;å†…å®¹çš„&lt;code&gt;cat&lt;/code&gt;ï¼‰ï¼ŒåŒæ—¶ä½ ä¹Ÿä¼šæ³¨æ„åˆ°å¹³å‡è´Ÿè½½å‡é«˜äº†ã€‚&lt;/p&gt;
&lt;p&gt;å¹³å‡è´Ÿè½½è¡¨ç¤ºä¸€æ®µæ—¶é—´å†…ç³»ç»Ÿçš„å¹³å‡è´Ÿè½½ã€‚&lt;/p&gt;
&lt;p&gt;è´Ÿè½½æ˜¯é€šè¿‡ç»Ÿè®¡è¿è¡Œä¸­çš„è¿›ç¨‹ï¼ˆæ­£åœ¨è¿è¡Œæˆ–è€…ç­‰å¾…è¿è¡Œï¼‰å’Œä¸å¯ä¸­æ–­ï¼ˆuninterruptibleï¼‰è¿›ç¨‹ï¼ˆç­‰å¾…ç£ç›˜æˆ–ç½‘ç»œçš„ç›¸åº”ï¼‰æ•°é‡è®¡ç®—å¾—åˆ°çš„ã€‚ç®€å•æ¥è¯´æ˜¯ä¸€äº›è¿›ç¨‹çš„æ€»æ•°ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥å¹³å‡è´Ÿè½½æ˜¯æœ€è¿‘1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿå’Œ15åˆ†é’Ÿå†…è¿™äº›è¿›ç¨‹çš„å¹³å‡æ•°ï¼Œå¯¹å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šæ²¡è¿™ä¹ˆç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;å¹³å‡è´Ÿè½½æ˜¯è´Ÿè½½çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ã€‚æ‘˜è‡ªç»´åŸºç™¾ç§‘ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä»æ•°å­¦ä¸Šæ¥è®²ï¼Œè¿™ä¸‰ä¸ªå€¼éƒ½æ˜¯ç³»ç»Ÿèµ·æ¥ä»¥æ¥çš„å¹³å‡å€¼ã€‚å®ƒä»¬éƒ½æ˜¯æŒ‡æ•°çº§è¡°å‡çš„ï¼Œä¸è¿‡è¡°å‡é€Ÿåº¦ä¸åŒã€‚å› æ­¤ï¼Œ1åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½æ˜¯63% çš„æœ€è¿‘ä¸€åˆ†é’Ÿçš„è´Ÿè½½ï¼Œå†åŠ ä¸Š37%çš„ç³»ç»Ÿå¯åŠ¨ä»¥æ¥é™¤å»æœ€è¿‘ä¸€åˆ†é’Ÿçš„è´Ÿè½½å¾—åˆ°çš„ã€‚æ‰€ä»¥ï¼Œ1åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½åªåŒ…å«æœ€è¿‘60ç§’çš„æƒ…å†µä»æŠ€æœ¯ä¸Šçœ‹æ˜¯ä¸å‡†ç¡®çš„ï¼ˆå› ä¸ºå®ƒè¿˜åŒ…å«äº†è¿‡å»37% çš„æƒ…å†µï¼‰ï¼Œåªæ˜¯å¤§éƒ¨åˆ†æ˜¯æœ€è¿‘ä¸€åˆ†é’Ÿçš„æƒ…å†µã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://en.wikipedia.org/wiki/Load_(computing)"&gt;Load (computing)&lt;/a&gt;ï¼Œ&lt;a href="https://zh.wikipedia.org/wiki/%E7%A7%BB%E5%8B%95%E5%B9%B3%E5%9D%87"&gt;ç§»åŠ¨å¹³å‡&lt;/a&gt; ï¼‰&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä½ æ„æ–™ä¹‹ä¸­çš„å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬å†çœ‹çœ‹æˆ‘ä»¬çš„éšæœºæ•°ç”Ÿæˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat /proc/loadavg
1.00 0.69 0.35 2/124 1679
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°½ç®¡ä»æŠ€æœ¯ä¸Šçœ‹æ˜¯ä¸å‡†ç¡®çš„ï¼Œä½†æ˜¯ä¸ºäº†ä¾¿äºç†è§£ï¼Œè¿˜æ˜¯æŠŠå¹³å‡è´Ÿè½½ç®€å•åŒ–ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”Ÿæˆéšæœºæ•°çš„è¿›ç¨‹æ˜¯CPU å¯†é›†å‹ï¼ˆCPU Boundï¼‰ï¼Œæ‰€ä»¥æœ€è¿‘ä¸€åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½æ˜¯&lt;code&gt;1&lt;/code&gt;ï¼Œæˆ–è€…è¯´æœ€è¿‘ä¸€åˆ†é’Ÿå¹³å‡æœ‰1ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘çš„ç³»ç»Ÿä¸Šåªæœ‰ä¸€é¢—CPUï¼Œä¸€é¢—CPUä¸ŠåŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œæ‰€ä»¥CPU åˆ©ç”¨ç‡æ˜¯100%ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰2ä¸ªæ ¸å¿ƒï¼ŒCPU åˆ©ç”¨ç‡å°†ä¼šæ˜¯50%ï¼Œå› ä¸ºåŒä¸€æ—¶åˆ»å¯ä»¥è¿è¡Œ2ä¸ªè¿›ç¨‹ã€‚2ä¸ªæ ¸å¿ƒçš„è®¡ç®—æœºçš„CPU åˆ©ç”¨ç‡è¾¾åˆ°100% çš„è¯ï¼Œå®ƒçš„å¹³å‡è´Ÿè½½ä¼šæ˜¯&lt;code&gt;2.0&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;code&gt;htop&lt;/code&gt; å·¦ä¸Šè§’æˆ–è€…æ‰§è¡Œ&lt;code&gt;nproc&lt;/code&gt; å‘½ä»¤ï¼Œçœ‹åˆ°ä½ çš„CPU æ ¸å¿ƒæ•°ã€‚&lt;/p&gt;
&lt;p&gt;å› ä¸ºè´Ÿè½½æ•°è¿˜åŒ…æ‹¬å‡ºäºä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹ï¼Œä½†æ˜¯è¿™äº›è¿›ç¨‹ä¸ä¼šå¤ªå½±å“CPU åˆ©ç”¨ç‡ï¼Œæ‰€ä»¥ä»å¹³å‡è´Ÿè½½æ¨æ–­CPU åˆ©ç”¨ç‡ä¸å¤ªå‡†ç¡®ã€‚è¿™ä¹Ÿè§£é‡Šäº†ä½ å¯èƒ½é‡åˆ°è¿‡çš„å¹³å‡è´Ÿè½½å¾ˆé«˜ä½†æ˜¯CPU ä¸å¿™çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡ä¹Ÿæœ‰ä¸€äº›ä¾‹å¦‚&lt;code&gt;mpstat&lt;/code&gt; è¿™æ ·çš„å·¥å…·å¯ä»¥æ˜¾ç¤ºå³æ—¶çš„CPU åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo apt install sysstat -y
$ mpstat 1
Linux 4.4.0-47-generic (hostname)   12/03/2016      _x86_64_        (1 CPU)

10:16:20 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
10:16:21 PM  all    0.00    0.00  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
10:16:22 PM  all    0.00    0.00  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
10:16:23 PM  all    0.00    0.00  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
# ...
# kill cat /dev/urandom
# ...
10:17:00 PM  all    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
10:17:01 PM  all    1.00    0.00    0.00    2.00    0.00    0.00    0.00    0.00    0.00   97.00
10:17:02 PM  all    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦ä½¿ç”¨å¹³å‡è´Ÿè½½å‘¢ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ curl -s https://raw.githubusercontent.com/torvalds/linux/v4.8/kernel/sched/loadavg.c | head -n 7
/*
* kernel/sched/loadavg.c
*
* This file contains the magic bits required to compute the global loadavg
* figure. Its a silly number but people think its important. We go through
* great pains to make it work on big machines and tickless kernels.
*/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ï¼ˆè¯‘æ³¨ï¼šæ€»çš„æ¥è¯´ï¼Œå¹³å‡è´Ÿè½½ååˆ†æ„šè ¢ï¼Œ
tickles å†…æ ¸å‚è€ƒï¼š&lt;a href="https://zh.wikipedia.org/wiki/%E6%97%A0%E5%98%80%E5%97%92%E5%86%85%E6%A0%B8"&gt;æ— å˜€å—’å†…æ ¸&lt;/a&gt;ï¼‰,&lt;a href="http://kernel.meizu.com/linux-tick-and-tickless.html"&gt;Linux Tick å’Œ Tickless&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;htop å³ä¸Šè§’æ˜¾ç¤ºäº†è¿›ç¨‹æ€»æ•°å’Œè¿è¡Œä¸­çš„æ•°é‡ï¼Œä¸è¿‡å®ƒæ˜¾ç¤ºçš„æ˜¯&lt;em&gt;ä»»åŠ¡ï¼ˆTaskï¼‰&lt;/em&gt;è€Œä¸æ˜¯è¿›ç¨‹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹çš„å¦ä¸€ä¸ªåå­—æ˜¯ä»»åŠ¡ã€‚Linux å†…æ ¸å†…éƒ¨æŠŠè¿›ç¨‹ç§°ä¸ºä»»åŠ¡ã€‚&lt;code&gt;htop&lt;/code&gt; ä½¿ç”¨ä»»åŠ¡ï¼ˆTaskï¼‰æ¥ä»£æ›¿è¿›ç¨‹ï¼ˆProcessï¼‰å¯èƒ½æ˜¯å› ä¸ºå®ƒï¼ˆTaskï¼‰æ›´çŸ­ï¼Œæ›´èŠ‚çœå±å¹•ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨&lt;code&gt;htop&lt;/code&gt;ä¸­çœ‹åˆ°çº¿ç¨‹ã€‚æŒ‰ä¸‹&lt;code&gt;Shift&lt;/code&gt;å’Œ&lt;code&gt;H&lt;/code&gt; é”®å¯ä»¥åˆ‡æ¢åˆ°æ˜¾ç¤ºçº¿ç¨‹çš„æ¨¡å¼ã€‚å¦‚æœä½ çœ‹åˆ°&lt;code&gt;Tasks: 23, 10 thr&lt;/code&gt;ï¼Œå³æ˜¾ç¤ºäº†çº¿ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°å†…æ ¸çš„çº¿ç¨‹ï¼ŒæŒ‰ä¸‹&lt;code&gt;Shift&lt;/code&gt;å’Œ&lt;code&gt;K&lt;/code&gt;é”®ã€‚å®ƒä»¬ä¼šæ˜¾ç¤ºçš„æ˜¯&lt;code&gt;Tasks: 23, 40 kthr&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹ ID / PID&lt;/h2&gt;
&lt;p&gt;æ¯æ¬¡æ–°å»ºä¸€ä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ†é…ç»™å®ƒä¸€ä¸ªæ ‡è¯†çš„æ•°å­—ï¼ˆIDï¼‰ï¼Œä¹Ÿç§°ä¸ºè¿›ç¨‹ID æˆ–ç®€ç§°ä¸ºPIDã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨bash é‡Œè¿è¡Œä¸€ä¸ªåå°ï¼ˆ&amp;amp;ï¼‰çš„ç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°æ–¹æ‰©å·é‡Œçš„ä»»åŠ¡å·å’ŒPIDã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sleep 1000 &amp;amp;
[1] 12503
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœä½ é”™è¿‡è¿™äº›å†…å®¹ï¼Œåœ¨bash é‡Œé¢å¯ä»¥ç”¨&lt;code&gt;$!&lt;/code&gt;è¿™ä¸ªå˜é‡ï¼Œå®ƒä¼šæ˜¾ç¤ºæœ€è¿‘çš„åå°è¿›ç¨‹çš„IDã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo $!
12503
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿›ç¨‹ID éå¸¸æœ‰ç”¨ã€‚å¯ä»¥ç”¨å®ƒæ¥æŸ¥çœ‹è¿›ç¨‹çš„ç»†èŠ‚å’Œæ§åˆ¶è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;procfs&lt;/code&gt; æ˜¯ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨æ¥è®©ç”¨æˆ·ç¨‹åºé€šè¿‡è¯»å–æ–‡ä»¶è·å–å†…æ ¸çš„ä¿¡æ¯ã€‚&lt;code&gt;procfs&lt;/code&gt;é€šå¸¸æŒ‚è½½åœ¨&lt;code&gt;/proc/&lt;/code&gt;ï¼Œå¯¹ä½ æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥æƒ³ä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶ç›®å½•ï¼Œä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;ls&lt;/code&gt;å’Œ&lt;code&gt;cd&lt;/code&gt;è¿›è¡Œæµè§ˆã€‚&lt;/p&gt;
&lt;p&gt;æ‰€æœ‰å…³äºä¸€ä¸ªè¿›ç¨‹çš„ä¿¡æ¯éƒ½åœ¨&lt;code&gt;/proc/&amp;lt;pid&amp;gt;/&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ls /proc/12503
attr        coredump_filter  fdinfo     maps        ns             personality  smaps    task
auxv        cpuset           gid_map    mem         numa_maps      projid_map   stack    uid_map
cgroup      cwd              io         mountinfo   oom_adj        root         stat     wchan
clear_refs  environ          limits     mounts      oom_score      schedstat    statm
cmdline     exe              loginuid   mountstats  oom_score_adj  sessionid    status
comm        fd               map_files  net         pagemap        setgroups    syscall
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸¾ä¸ªä¾‹å­ï¼Œ&lt;code&gt;/proc/&amp;lt;pid&amp;gt;/cmdline&lt;/code&gt; åŒ…å«è¿è¡Œè¿™ä¸ªè¿›ç¨‹æ‰€ç”¨çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat /proc/12503/cmdline
sleep1000$
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é¢ï¼Œä¸å¯¹ã€‚å®é™…ä¸Šè¿™ä¸ªå‘½ä»¤æ˜¯ä»¥&lt;code&gt;\0&lt;/code&gt;å­—èŠ‚åˆ†éš”çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ od -c /proc/12503/cmdline
0000000   s   l   e   e   p  \0   1   0   0   0  \0
0000013
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬å¯ä»¥ç”¨ç©ºæ ¼æˆ–è€…æ¢è¡Œç¬¦æ›¿æ¢&lt;code&gt;\0&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ tr &amp;#39;\0&amp;#39; &amp;#39;\n&amp;#39; &amp;lt; /proc/12503/cmdline
sleep
1000
$ strings /proc/12503/cmdline
sleep
1000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸€ä¸ªè¿›ç¨‹çš„ç›®å½•å¯ä»¥åŒ…å«é“¾æ¥ï¼ä¾‹å¦‚ï¼Œ&lt;code&gt;cwd&lt;/code&gt;æŒ‡å‘å½“å‰çš„å·¥ä½œç›®å½•ï¼Œ&lt;code&gt;exe&lt;/code&gt;æŒ‡å‘å¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ls -l /proc/12503/{cwd,exe}
lrwxrwxrwx 1 ubuntu ubuntu 0 Jul  6 10:10 /proc/12503/cwd -&amp;gt; /home/ubuntu
lrwxrwxrwx 1 ubuntu ubuntu 0 Jul  6 10:10 /proc/12503/exe -&amp;gt; /bin/sleep
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™å°±æ˜¯&lt;code&gt;htop&lt;/code&gt;,&lt;code&gt;top&lt;/code&gt;,&lt;code&gt;ps&lt;/code&gt;å’Œå…¶ä»–è¯Šæ–­å·¥å…·è·å–è¿›ç¨‹è¯¦ç»†ä¿¡æ¯çš„æ–¹å¼ï¼š&lt;br&gt;
éƒ½æ˜¯é€šè¿‡è¯»å–&lt;code&gt;/proc/&amp;lt;pid&amp;gt;/&amp;lt;file&amp;gt;&lt;/code&gt;çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹æ ‘&lt;/h2&gt;
&lt;p&gt;å½“å¯åŠ¨ä¸€ä¸ªæ–°è¿›ç¨‹çš„æ—¶å€™ï¼Œå¯åŠ¨è¿™ä¸ªæ–°è¿›ç¨‹çš„é‚£ä¸ªè¿›ç¨‹è¢«ç§°ä¸ºçˆ¶è¿›ç¨‹ã€‚æ–°çš„è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„ä¸€ä¸ªå­è¿›ç¨‹ã€‚å®ƒä»¬æ˜¯æ ‘çŠ¶ç»“æ„çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨&lt;code&gt;htop&lt;/code&gt;é‡ŒæŒ‰&lt;code&gt;F5&lt;/code&gt;é”®ï¼Œå°±å¯ä»¥çœ‹åˆ°åˆ†å±‚çš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code&gt;ps&lt;/code&gt;çš„&lt;code&gt;f&lt;/code&gt;é€‰é¡¹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps f
PID TTY      STAT   TIME COMMAND
12472 pts/0    Ss     0:00 -bash
12684 pts/0    R+     0:00  \_ ps f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ–è€…&lt;code&gt;pstree&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ pstree -a
init
â”œâ”€atd
â”œâ”€cron
â”œâ”€sshd -D
â”‚   â””â”€sshd
â”‚       â””â”€sshd
â”‚           â””â”€bash
â”‚               â””â”€pstree -a
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯èƒ½ç»å¸¸çœ‹åˆ°&lt;code&gt;bash&lt;/code&gt;æˆ–è€…&lt;code&gt;sshd&lt;/code&gt; æ˜¯ä¸€äº›è¿›ç¨‹çš„çˆ¶è¿›ç¨‹çš„åŸå› ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ åœ¨&lt;code&gt;bash&lt;/code&gt;é‡Œè¿è¡Œ&lt;code&gt;date&lt;/code&gt;ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹è¿™äº›äº‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;bash&lt;/code&gt; æ–°å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹æ˜¯å®ƒè‡ªèº«çš„æ‹·è´ï¼ˆä½¿ç”¨&lt;code&gt;fork&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;æ¥ç€ä»å¯æ‰§è¡Œæ–‡ä»¶&lt;code&gt;/bin/date&lt;/code&gt;åŠ è½½ç¨‹åºåˆ°å†…å­˜ä¸­ï¼ˆä½¿ç”¨&lt;code&gt;exec&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;code&gt;bash&lt;/code&gt;ä½œä¸ºçˆ¶è¿›ç¨‹å°†ç­‰å¾…ç›´åˆ°å®ƒçš„å­è¿›ç¨‹é€€å‡º&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ID ä¸º1 çš„&lt;code&gt;/sbin/init&lt;/code&gt;æ˜¯åœ¨å¯åŠ¨æ—¶è¿è¡Œçš„ï¼Œå®ƒç”Ÿæˆäº†SSH å®ˆæŠ¤è¿›ç¨‹&lt;code&gt;sshd&lt;/code&gt;ã€‚å½“ä½ è¿æ¥åˆ°è®¡ç®—æœºæ—¶ï¼Œ&lt;code&gt;sshd&lt;/code&gt;å°†äº§ç”Ÿä¸€ä¸ªä¼šè¯è¿›ç¨‹ï¼Œè¿™ä¸ªä¼šè¯è¿›ç¨‹å†å¯åŠ¨&lt;code&gt;bash&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å–œæ¬¢åœ¨&lt;code&gt;htop&lt;/code&gt;ä¸­ä½¿ç”¨æ ‘çŠ¶å›¾ï¼Œå½“æˆ‘æƒ³çœ‹åˆ°æ‰€æœ‰çº¿ç¨‹çš„æ—¶å€™ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹ç”¨æˆ·&lt;/h2&gt;
&lt;p&gt;æ¯ä¸ªè¿›ç¨‹éƒ½å±äºä¸€ä¸ªç”¨æˆ·ï¼Œé€šè¿‡ä¸€ä¸ªæ•°å­—æ ‡è¯†ç”¨æˆ·ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sleep 1000 &amp;amp;
[1] 2045
$  grep Uid /proc/2045/status
Uid:    1000    1000    1000    1000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ å¯ä»¥ç”¨&lt;code&gt;id&lt;/code&gt;å‘½ä»¤æ‰¾å‡ºè¿™ä¸ªUID çš„ç”¨æˆ·åã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ id 1000
uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®é™…ä¸Š&lt;code&gt;id&lt;/code&gt; æ˜¯ä»&lt;code&gt;/etc/passwd&lt;/code&gt;å’Œ&lt;code&gt;/etc/group&lt;/code&gt;æ–‡ä»¶ä¸­è·å–ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ strace -e open id 1000
...
open(&amp;quot;/etc/nsswitch.conf&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
open(&amp;quot;/lib/x86_64-linux-gnu/libnss_compat.so.2&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
open(&amp;quot;/lib/x86_64-linux-gnu/libnss_files.so.2&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
open(&amp;quot;/etc/passwd&amp;quot;, O_RDONLY|O_CLOEXEC) = 3
open(&amp;quot;/etc/group&amp;quot;, O_RDONLY|O_CLOEXEC)  = 3
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ˜¯å› ä¸ºName Service Switch ï¼ˆNSSï¼‰çš„é…ç½®æ–‡ä»¶&lt;code&gt;/etc/nsswitch.conf&lt;/code&gt;è¡¨ç¤ºé€šè¿‡è¿™äº›æ–‡ä»¶è§£æåç§°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ head -n 9 /etc/nsswitch.conf
# ...
passwd:         compat
group:          compat
shadow:         compat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;compat&lt;/code&gt;ï¼ˆå…¼å®¹æ¨¡å¼ï¼šCompatibility modeï¼‰è¿™ä¸ªé…ç½®é¡¹å’Œ&lt;code&gt;files&lt;/code&gt;ä½œç”¨ä¸€æ ·ï¼Œé™¤äº†æ”¯æŒä¸€äº›ç‰¹æ®Šçš„æ¡ç›®ã€‚&lt;code&gt;files&lt;/code&gt;è¡¨ç¤ºæ•°æ®å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆé€šè¿‡&lt;code&gt;libnss_files.so&lt;/code&gt;åŠ è½½ï¼‰ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥æŠŠä½ çš„ç”¨æˆ·ä¿¡æ¯å­˜åœ¨å…¶ä»–æ•°æ®åº“æˆ–è€…æœåŠ¡ä¸­ï¼Œä¾‹å¦‚ä½¿ç”¨è½»å‹ç›®å½•è®¿é—®åè®®ï¼ˆLDAPï¼‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/etc/passwd&lt;/code&gt;å’Œ&lt;code&gt;/etc/group&lt;/code&gt;æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå°†æ•°å­—åŒ–çš„ç”¨æˆ·ID æ˜ å°„åˆ°å¯¹äººç±»å¯è¯»çš„åç§°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
$ cat /etc/group
root:x:0:
adm:x:4:syslog,ubuntu
ubuntu:x:1000:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;passwd&lt;/code&gt;ï¼Ÿå“ªé‡Œæœ‰å¯†ç ï¼Ÿ&lt;/p&gt;
&lt;p&gt;å®ƒä»¬å®é™…ä¸Šæ˜¯åœ¨&lt;code&gt;/etc/shadow&lt;/code&gt;ä¸­ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo cat /etc/shadow
root:$6$mS9o0QBw$P1ojPSTexV2PQ.Z./rqzYex.k7TJE2nVeIVL0dql/:17126:0:99999:7:::
daemon:*:17109:0:99999:7:::
ubuntu:$6$GIfdqlb/$ms9ZoxfrUq455K6UbmHyOfz7DVf7TWaveyHcp.:17126:0:99999:7:::
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$6$&lt;/code&gt;æ˜¯ä½¿ç”¨çš„å¯†ç hash ç®—æ³•ï¼Œç°åœ¨è¿™ä¸ªè¡¨ç¤ºçš„æ˜¯&lt;code&gt;sha512&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç´§è·Ÿç€çš„æ˜¯éšæœºäº§ç”Ÿçš„ç›ï¼Œé˜²æ­¢å½©è™¹è¡¨æ”»å‡»&lt;/li&gt;
&lt;li&gt;æœ€åæ˜¯å¯†ç +ç›çš„hash å€¼&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ä½ è¿è¡Œä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œå®ƒä¼šä»¥ä½ çš„ç”¨æˆ·è¿è¡Œã€‚å³æ—¶è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸å±äºä½ ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³ä»¥&lt;code&gt;root&lt;/code&gt;æˆ–è€…å…¶ä»–ç”¨æˆ·è¿è¡Œç¨‹åºï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;sudo&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ id
uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm)
$ sudo id
uid=0(root) gid=0(root) groups=0(root)
$ sudo -u ubuntu id
uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu),4(adm)
$ sudo -u daemon id
uid=1(daemon) gid=1(daemon) groups=1(daemon)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœä½ æƒ³è¦ç™»å½•å…¶ä»–ç”¨æˆ·çš„å¸å·æ¥è¿è¡Œæ›´å¤šçš„å‘½ä»¤è¯¥æ€ä¹ˆåšï¼Ÿå¯ä»¥ä½¿ç”¨&lt;code&gt;sudo bash&lt;/code&gt;æˆ–&lt;code&gt;sudo -u user bash&lt;/code&gt;ã€‚ä½ å°†èƒ½ä»¥å…¶ä»–ç”¨æˆ·çš„èº«ä»½ä½¿ç”¨shellã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ ä¸å–œæ¬¢æ¯æ¬¡éƒ½è¢«è¦æ±‚è¾“å…¥root å¯†ç ï¼ŒæŠŠä½ çš„ç”¨æˆ·åæ·»åŠ åˆ°&lt;code&gt;/etcsudoers&lt;/code&gt;æ–‡ä»¶ä¸­å°±èƒ½å…³é—­å®ƒã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬è¯•ä¸€è¯•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo &amp;quot;$USER ALL=(ALL) NOPASSWD: ALL&amp;quot; &amp;gt;&amp;gt; /etc/sudoers
-bash: /etc/sudoers: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¥½å§ï¼Œåªæœ‰root æ‰æœ‰æƒé™ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo echo &amp;quot;$USER ALL=(ALL) NOPASSWD: ALL&amp;quot; &amp;gt;&amp;gt; /etc/sudoers
-bash: /etc/sudoers: Permission denied
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘æ“¦ï¼Œä»€ä¹ˆæƒ…å†µï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç°åœ¨ä½ æ˜¯ä»¥root ç”¨æˆ·æ‰§è¡Œäº†&lt;code&gt;echo&lt;/code&gt;å‘½ä»¤ï¼Œä¸è¿‡è¿½åŠ å†…å®¹åˆ°&lt;code&gt;/etc/sudoers&lt;/code&gt;è¿˜æ˜¯ä»¥ä½ çš„ç”¨æˆ·èº«ä»½ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;echo "$USER ALL=(ALL) NOPASSWD: ALL" | sudo tee -a /etc/sudoers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sudo bash -c "echo '$USER ALL=(ALL) NOPASSWD: ALL' &amp;gt;&amp;gt; /etc/sudoers"&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œ&lt;code&gt;tee -a&lt;/code&gt;å°†æ ‡å‡†è¾“å‡ºçš„å†…å®¹è¿½åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä»¥root ç”¨æˆ·æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„ã€‚&lt;/p&gt;
&lt;p&gt;ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»¥root ç”¨æˆ·è¿è¡Œbashï¼Œå¹¶è®©å®ƒæ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼Œè¿™æ¡å‘½ä»¤ä¼šä»¥root ç”¨æˆ·æ‰§è¡Œã€‚
æ³¨æ„è¿™é‡Œé¢å¤æ‚çš„å•å¼•å·å’ŒåŒå¼•å·ï¼Œå®ƒä»¬å†³å®šäº†&lt;code&gt;$USER&lt;/code&gt;æ ‡é‡ä»€ä¹ˆæ—¶å€™è¢«å±•å¼€ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çœ‹ä¸€çœ¼&lt;code&gt;/etc/sudoers&lt;/code&gt;æ–‡ä»¶ï¼Œåœ¨å¼€å¤´ä½ ä¼šçœ‹åˆ°ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo head -n 3 /etc/sudoers
#
# This file MUST be edited with the &amp;#39;visudo&amp;#39; command as root.
#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å“å‘¦ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„è­¦å‘Šï¼Œè¯´ä½ åº”è¯¥ä½¿ç”¨&lt;code&gt;sudo visudo&lt;/code&gt;æ¥ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ã€‚å®ƒä¼šåœ¨ä½ ä¿å­˜æ–‡ä»¶ä¹‹å‰æ ¡éªŒå†…å®¹ï¼Œé˜²æ­¢å‘ç”Ÿé”™è¯¯ã€‚
å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨&lt;code&gt;visudo&lt;/code&gt;è€Œå¯¼è‡´é”™è¯¯çš„è¯ï¼Œå°†æŠŠä½ é”å®šæ— æ³•ä½¿ç”¨&lt;code&gt;sudo&lt;/code&gt;ã€‚è¿™æ„å‘³ç€ä½ æ²¡æ³•ä¿®æ­£é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾ä½ æƒ³è¦ä¿®æ”¹ä½ çš„å¯†ç ï¼Œä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;password&lt;/code&gt;å‘½ä»¤ã€‚å¦‚å‰é¢æåˆ°çš„ï¼Œå®ƒä¼šæŠŠå¯†ç ä¿å­˜åœ¨&lt;code&gt;/etc/shaow&lt;/code&gt;æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ–‡ä»¶éå¸¸æ•æ„Ÿï¼Œåªæœ‰root ç”¨æˆ·æ‰èƒ½å†™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ls -l /etc/shadow
-rw-r----- 1 root shadow 1122 Nov 27 18:52 /etc/shadow
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰€ä»¥æ™®é€šç”¨æˆ·æ‰§è¡Œçš„&lt;code&gt;password&lt;/code&gt;ç¨‹åºæ˜¯æ€ä¹ˆå¯èƒ½å†™å…¥å†…å®¹åˆ°ä¸€ä¸ªå®ˆä¿æŠ¤çš„æ–‡ä»¶å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘å‰é¢è¯´è¿‡å½“ä½ æ‰§è¡Œä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œå®ƒæ˜¯ä»¥ä½ çš„èº«ä»½æ‰§è¡Œçš„ï¼Œå³ä½¿è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æ‰€æœ‰è€…æ˜¯å¦å¤–ä¸€ä¸ªç”¨æˆ·ã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šä½ å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶æƒé™æ”¹å˜è¿™ä¸ªè¡Œä¸ºã€‚è®©æˆ‘ä»¬çœ‹çœ‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ls -l /usr/bin/passwd
-rwsr-xr-x 1 root root 54256 Mar 29  2016 /usr/bin/passwd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„&lt;code&gt;s&lt;/code&gt;çš„å­—æ¯ã€‚è¿™æ˜¯é€šè¿‡&lt;code&gt;sudo chmod u+s /usr/bin/passwd&lt;/code&gt;åŠ ä¸Šçš„ã€‚å®ƒè¡¨ç¤ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¼šä»¥æ–‡ä»¶çš„æ‰€æœ‰è€…çš„èº«ä»½è¢«æ‰§è¡Œï¼Œè¿™é‡Œæ˜¯ä»¥root ç”¨æˆ·æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ç”¨&lt;code&gt;find /bin -user root -perm -u+s&lt;/code&gt; æ‰¾åˆ°å…·æœ‰&lt;code&gt;setuid&lt;/code&gt;æƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ä½ ä¹Ÿå¯ä»¥å¯¹ç”¨æˆ·ç»„æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼ˆ&lt;code&gt;g+s&lt;/code&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹çŠ¶æ€&lt;/h2&gt;
&lt;p&gt;æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹&lt;code&gt;htop&lt;/code&gt;ä¸­ç”¨å­—æ¯&lt;code&gt;s&lt;/code&gt;è¡¨ç¤ºçš„è¿›ç¨‹çŠ¶æ€è¿™ä¸€åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;å‡ ç§å¯èƒ½çš„å€¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;R    running or runnable (on run queue) è¿è¡Œä¸­æˆ–è€…å³å°†è¿è¡Œ
S    interruptible sleep (waiting for an event to complete) ä¸­æ–­ç¡çœ 
D    uninterruptible sleep (usually IO) ä¸å¯ä¸­æ–­ç¡çœ 
Z    defunct (&amp;quot;zombie&amp;quot;) process, terminated but not reaped by its parent åƒµå°¸è¿›ç¨‹
T    stopped by job control signal è¢«åˆ¶ä¿¡å·åœæ­¢
t    stopped by debugger during the tracing è¢«debugger åœæ­¢
X    dead (should never be seen) æ­»äº¡
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘æŠŠå®ƒä»¬æŒ‰ç…§å‡ºç°çš„é¢‘ç‡å¦‚ä¸Šæ’åºã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„å½“ä½ æ‰§è¡Œ&lt;code&gt;ps&lt;/code&gt;çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‡ºç°ä¾‹å¦‚&lt;code&gt;Ss&lt;/code&gt;ï¼Œ&lt;code&gt;R+&lt;/code&gt;ï¼Œ&lt;code&gt;Ss+&lt;/code&gt;ç­‰çŠ¶æ€ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps x
PID TTY      STAT   TIME COMMAND
1688 ?        Ss     0:00 /lib/systemd/systemd --user
1689 ?        S      0:00 (sd-pam)
1724 ?        S      0:01 sshd: vagrant@pts/0
1725 pts/0    Ss     0:00 -bash
2628 pts/0    R+     0:00 ps x
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;R - running or runnable (on run queue)&lt;/h3&gt;
&lt;p&gt;è¿™ç§çŠ¶æ€ä¸‹çš„è¿›ç¨‹ï¼Œè¦ä¹ˆæ˜¯æ­£åœ¨è¿è¡Œä¸­ï¼Œè¦ä¹ˆå°±æ˜¯åœ¨ç­‰å¾…è¿è¡Œçš„é˜Ÿåˆ—ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯è¿è¡Œï¼Ÿ&lt;/p&gt;
&lt;p&gt;å½“ä½ ä»æºä»£ç ç¼–è¯‘ä½ çš„ç¨‹åºåï¼Œå¾—åˆ°çš„æœºå™¨ä»£ç å…¶å®æ˜¯CPU æŒ‡ä»¤ã€‚å®ƒä»¬è¢«ä¿å­˜åˆ°æ–‡ä»¶ä¸­ç­‰å¾…æ‰§è¡Œã€‚å½“ä½ åŠ è½½ç¨‹åºçš„æ—¶å€™ï¼Œå®ƒä»¬è¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ¥ç€CPU ä¼šæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šè¿™ä¸ªçŠ¶æ€æ„å‘³ç€CPU åœ¨æ‰§è¡ŒæŒ‡ä»¤ï¼Œæˆ–è€…è¯´åœ¨å¤„ç†æ•°å­¦è¿ç®—ã€‚&lt;/p&gt;
&lt;h3&gt;S - interruptible sleep (waiting for an event to complete)&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºè¯¥è¿›ç¨‹çš„ä»£ç æŒ‡ä»¤æ­¤åˆ»æ²¡åœ¨CPU ä¸Šè¿è¡Œã€‚ç›¸åï¼Œè¿›ç¨‹æ­£åœ¨ç­‰å¾…ä¸€ä¸ªäº‹ä»¶æˆ–è€…ä¸€æ¡è§¦å‘æ¡ä»¶äº§ç”Ÿã€‚å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå†…æ ¸ä¼šå°†çŠ¶æ€è®¾ç½®ä¸ºè¿è¡Œä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªä¾‹å­æ˜¯æ ¸å¿ƒå·¥å…·åŒ…é‡Œçš„&lt;code&gt;sleep&lt;/code&gt;ï¼ˆè¯‘æ³¨ï¼šGNUæ ¸å¿ƒå·¥å…·ç»„ï¼ˆè‹±è¯­ï¼šGNU Core Utilitiesï¼Œäº¦å¸¸ç¼©å†™ä¸ºCoreutilsï¼‰ï¼Œå‚è€ƒ &lt;a href="https://zh.wikipedia.org/wiki/GNU%E6%A0%B8%E5%BF%83%E5%B7%A5%E5%85%B7%E7%BB%84"&gt;GNUæ ¸å¿ƒå·¥å…·ç»„&lt;/a&gt;ï¼‰ã€‚å®ƒèƒ½ç¡çœ æŒ‡å®šçš„ç§’æ•°ï¼ˆå¤§è‡´ä¸Šï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sleep 1000 &amp;amp;
[1] 10089
$ ps f
PID TTY      STAT   TIME COMMAND
3514 pts/1    Ss     0:00 -bash
10089 pts/1    S      0:00  \_ sleep 1000
10094 pts/1    R+     0:00  \_ ps f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ˜¯å¯ä¸­æ–­çš„ç¡çœ ã€‚é‚£æˆ‘ä»¬æ€ä¹ˆä¸­æ–­å®ƒï¼Ÿ&lt;/p&gt;
&lt;p&gt;é€šè¿‡å‘é€ä¿¡å·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;htop&lt;/code&gt;é‡Œä½ å¯ä»¥æŒ‰ä¸‹&lt;code&gt;F9&lt;/code&gt;ç„¶ååœ¨èœå•å·¦åˆ™é€‰æ‹©ä¸€ä¸ªä¿¡å·æ¥å‘é€ã€‚&lt;/p&gt;
&lt;p&gt;å‘é€ä¿¡å·ä¹Ÿè¢«ç§°ä¸º&lt;code&gt;kill&lt;/code&gt;ã€‚è¿™æ˜¯å› ä¸º&lt;code&gt;kill&lt;/code&gt;æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒå¯ä»¥ç»™ä¸€ä¸ªè¿›ç¨‹å‘é€ä¿¡å·ã€‚&lt;code&gt;/bin/kill&lt;/code&gt; ç¨‹åºå¯ä»¥ä»ç”¨æˆ·ç©ºé—´å‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œé»˜è®¤çš„ä¿¡å·æ˜¯&lt;code&gt;TERM&lt;/code&gt;ï¼Œè¿™ä¸ªä¿¡å·ä¼šè®©è¿›ç¨‹é€€å‡ºï¼Œæˆ–è€…è¯´ä¼šæ€æ­»è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¿¡å·åªæ˜¯ä¸€ä¸ªæ•°å­—ã€‚ä¸è¿‡æ•°å­—å¾ˆéš¾è®°ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»™å®ƒä»¬å–äº†åå­—ã€‚ä¿¡å·åç§°å¸¸å¸¸å¤§å†™ï¼Œå¹¶ä»¥&lt;code&gt;SIG&lt;/code&gt;ä¸ºå¼€å¤´ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›å¸¸ç”¨çš„ä¿¡å·æ˜¯&lt;code&gt;INT&lt;/code&gt;ï¼Œ&lt;code&gt;KILL&lt;/code&gt;ï¼Œ&lt;code&gt;STOP&lt;/code&gt;ï¼Œ&lt;code&gt;CONT&lt;/code&gt;ï¼Œ&lt;code&gt;HUP&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç»™sleep è¿›ç¨‹å‘é€&lt;code&gt;INT&lt;/code&gt;ï¼ˆä¹Ÿå¯ç§°ä¸º&lt;code&gt;SIGINT&lt;/code&gt;ï¼Œ&lt;code&gt;2&lt;/code&gt;ï¼Œ&lt;code&gt;Terminal interrupt&lt;/code&gt;ï¼‰ä¿¡å·ä¸­æ–­ç¡çœ ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ kill -INT 10089
[1]+  Interrupt               sleep 1000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“ä½ æŒ‰ä¸‹&lt;code&gt;CTRL&lt;/code&gt;é”®å’Œ&lt;code&gt;C&lt;/code&gt;é”®çš„æ—¶å€™ï¼Œä¹Ÿä¼šå‘ç”Ÿä»¥ä¸Šç°è±¡ã€‚&lt;code&gt;bash&lt;/code&gt;ä¼šåƒæˆ‘ä»¬åˆšåˆšé‚£æ ·ï¼Œç»™æ‰€æœ‰åå°ç¨‹åºå‘é€&lt;code&gt;SIGINT&lt;/code&gt;ä¿¡å·ã€‚&lt;/p&gt;
&lt;p&gt;é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ&lt;code&gt;kill&lt;/code&gt;æ˜¯&lt;code&gt;bash&lt;/code&gt;å†…ç½®çš„å‘½ä»¤ï¼Œè™½ç„¶åœ¨å¤§å¤šæ•°ç³»ç»Ÿä¸Šæœ‰&lt;code&gt;/bin/kill&lt;/code&gt;ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†å½“ä½ åˆ›å»ºçš„è¿›ç¨‹æ•°é‡è¾¾åˆ°é™åˆ¶æ—¶ï¼Œè¿˜å¯ä»¥ç”¨å®ƒæ¥æ€æ­»è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹åˆ—å‘½ä»¤æ˜¯åšåŒæ ·ä¸€ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;kill -INT 10089&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;kill -2 10089&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/bin/kill -2 10089&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªæœ‰ç”¨çš„ä¿¡å·æ˜¯&lt;code&gt;SIGKILL&lt;/code&gt;ï¼Œåˆç§°ä¸º&lt;code&gt;9&lt;/code&gt;ã€‚å½“ä½ ç‹‚æŒ‰&lt;code&gt;CTRL&lt;/code&gt;å’Œ&lt;code&gt;C&lt;/code&gt;é”®ä¸èµ·çš„ä½œç”¨æ—¶ï¼Œä½ å¯èƒ½æ›¾ç”¨è¿‡å®ƒæ¥æ€æ­»è¿‡è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ å†™ä¸€ä¸ªç¨‹åºæ—¶ï¼Œä½ å¯ä»¥å†™ä¸€äº›ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå½“ä½ çš„ç¨‹åºæ”¶åˆ°ä¿¡å·çš„æ—¶å°±ä¼šè°ƒç”¨è¿™äº›å‡½æ•°ã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥æ•è·ä¿¡å·æ¥åšä¸€äº›äº‹æƒ…ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œå’Œä¼˜é›…çš„å…³é—­ç¨‹åºã€‚
æ‰€ä»¥å‘é€&lt;code&gt;SIGINT&lt;/code&gt;ï¼ˆç”¨æˆ·æƒ³è¦ä¸­æ–­ä¸€ä¸ªè¿›ç¨‹ï¼‰å’Œ&lt;code&gt;SIGTERM&lt;/code&gt;ï¼ˆç”¨æˆ·æƒ³è¦ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼‰å¹¶ä¸æ„å‘³ç€è¿›ç¨‹èƒ½å¤Ÿè¢«ç»ˆæ­¢ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥è§è¿‡è¿™ä¸ªå¼‚å¸¸ï¼Œå½“è¿è¡ŒPython è„šæœ¬çš„æ—¶å€™ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ python -c &amp;#39;import sys; sys.stdin.read()&amp;#39;
^C
Traceback (most recent call last):
File &amp;quot;&amp;lt;string&amp;gt;&amp;quot;, line 1, in &amp;lt;module&amp;gt;
KeyboardInterrupt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ å¯ä»¥é€šè¿‡å‘é€&lt;code&gt;KILL&lt;/code&gt;å‹å·è®©å†…æ ¸å¼ºåˆ¶ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸è®©å®ƒæœ‰æœºä¼šå“åº”ï¼ˆè¯‘æ³¨ï¼šåŸæ–‡æ˜¯ not give it a change to respond ï¼Œæ€€ç–‘æ˜¯ä¸æ˜¯ä½œè€…æ‰“é”™äº†chanceï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sleep 1000 &amp;amp;
[1] 2658
$ kill -9 2658
[1]+  Killed                  sleep 1000
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;D - uninterruptible sleep (usually IO)&lt;/h3&gt;
&lt;p&gt;ä¸åŒäºå¯ä¸­æ–­ç¡çœ ï¼Œä½ æ— æ³•ç”¨ä¿¡å·å”¤é†’è¿™ä¸ªçŠ¶æ€ä¸‹çš„è¿›ç¨‹ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šäººæ€•çœ‹åˆ°è¿™ä¸ªçŠ¶æ€çš„åŸå› ã€‚ä½ ä¸èƒ½æ€æ­»è¿™æ ·çš„è¿›ç¨‹ï¼Œä»¥ä¸ºæ€æ­»æ„å‘³ç€ç»™è¿›ç¨‹å‘é€&lt;code&gt;SIGKILL&lt;/code&gt; ä¿¡å·ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿›ç¨‹å¿…é¡»ç­‰å¾…å¹¶ä¸èƒ½è¢«ä¸­æ–­ï¼Œæˆ–è€…æœ‰äº‹ä»¶ä¼šé©¬ä¸Šå‘ç”Ÿï¼Œå°±ä¼šç”¨è¿™ä¸ªçŠ¶æ€ã€‚æ¯”å¦‚ä»ç£ç›˜è¯»å–å†…å®¹ã€‚ä½†æ˜¯è¿™åªèƒ½å‘ç”Ÿå‡ ç§’é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;StackOverflow ä¸Šä¸€ä¸ª&lt;a href="http://stackoverflow.com/questions/223644/what-is-an-uninterruptable-process"&gt;ä¸é”™çš„è§£ç­”&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Uninterruptable processes are USUALLY waiting for I/O following a page fault. The process/task cannot be interrupted in this state, because it can't handle any signals; if it did, another page fault would happen and it would be back where it was.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼ˆNFSï¼‰ï¼Œè¿™ç§æ¸…ç©ºå°±ä¼šå‘ç”Ÿï¼Œä»NSF è¯»å†™æ–‡ä»¶éœ€è¦èŠ±ä¸€æ®µæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™ä¹Ÿæ„å‘³ç€ä½ çš„ä¸€äº›è¿›ç¨‹å¤šæ¬¡è¯»å†™äº¤æ¢åˆ†åŒºï¼Œç©ºé—²çš„å†…å­˜ç©ºé—´ä¸å¤Ÿç”¨äº†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¯•ä¸€è¯•è®©ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸å¯ä¸­æ–­çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;8.8.8.8&lt;/code&gt;æ˜¯ä¸€ä¸ªGoogle æä¾›çš„å…¬ç”¨DNS æœåŠ¡å™¨ã€‚å®ƒä»¬æ²¡æœ‰æä¾›ä¸€ä¸ªå¼€å‘çš„NFSã€‚ä¸è¿‡è¿™ä¸èƒ½é˜»æ­¢æˆ‘ä»¬ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo mount 8.8.8.8:/tmp /tmp &amp;amp;
[1] 12646
$ sudo ps x | grep mount.nfs
12648 pts/1    D      0:00 /sbin/mount.nfs 8.8.8.8:/tmp /tmp -o rw
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚ä½•æ‰¾å‡ºè¿›å…¥è¿™ä¸ªçŠ¶æ€åŸå› ï¼Ÿ&lt;code&gt;strace&lt;/code&gt;ï¼  &lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç”¨&lt;code&gt;strace&lt;/code&gt;è·Ÿè¸ª&lt;code&gt;ps&lt;/code&gt; ä¸Šé¢çš„å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo strace /sbin/mount.nfs 8.8.8.8:/tmp /tmp -o rw
...
mount(&amp;quot;8.8.8.8:/tmp&amp;quot;, &amp;quot;/tmp&amp;quot;, &amp;quot;nfs&amp;quot;, 0, ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ˜¯&lt;code&gt;mount&lt;/code&gt;è¿™ä¸ªç³»ç»Ÿè°ƒç”¨é˜»å¡äº†è¿›ç¨‹ã€‚  &lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æƒ³çŸ¥é“çš„è¯ï¼Œä½ å¯ä»¥è¿è¡Œ&lt;code&gt;mount&lt;/code&gt; æ—¶åŠ ä¸Š&lt;code&gt;intr&lt;/code&gt;é€‰é¡¹ï¼Œè®©å®ƒè¿è¡Œåœ¨ä¸­æ–­æ¨¡å¼ä¸‹ï¼š&lt;code&gt;sudo mount 8.8.8.8:/tmp /tmp -o intr&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;Z - defunct ("zombie") process, terminated but not reaped by its parent&lt;/h3&gt;
&lt;p&gt;å½“è¿›ç¨‹é€šè¿‡&lt;code&gt;exit&lt;/code&gt; é€€å‡ºåï¼Œå­è¿›ç¨‹è¿˜å­˜åœ¨çš„è¯ï¼Œå®ƒçš„å­è¿›ç¨‹ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœåƒµå°¸è¿›ç¨‹çŸ­æ—¶é—´å­˜åœ¨ï¼Œè¿™å¾ˆæ­£å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;åƒµå°¸è¿›ç¨‹é•¿æ—¶é—´å­˜åœ¨çš„è¯ï¼Œè¾¨æ˜ç¨‹åºæœ‰ä¸€ä¸ªbug&lt;/li&gt;
&lt;li&gt;åƒµå°¸è¿›ç¨‹ä¸ä¼šæ¶ˆè€—è¿›ç¨‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè¿›ç¨‹ID&lt;/li&gt;
&lt;li&gt;ä½ ä¸èƒ½&lt;code&gt;kill&lt;/code&gt; ä¸€ä¸ªåƒµå°¸è¿›ç¨‹&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥è¯·æ±‚çˆ¶è¿›ç¨‹å›æ”¶åƒµå°¸è¿›ç¨‹ï¼ˆ&lt;code&gt;SIGHLD&lt;/code&gt;ä¿¡å·ï¼‰&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥&lt;code&gt;kill&lt;/code&gt; åƒµå°¸è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œä»¥æ­¤å»é™¤çˆ¶è¿›ç¨‹å’Œå®ƒçš„åƒµå°¸è¿›ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘å°†å†™ä¸€æ®µC ä»£ç æ¥æ¼”ç¤ºè¿™ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘çš„ç¨‹åºã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Running&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;I am the child process&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The child process is exiting now&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;I am the parent process&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The parent process is sleeping now&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;The parent process is finished&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬æ¥å®‰è£…GNU C ç¼–è¯‘å™¨ï¼ˆGCCï¼‰ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt install -y gcc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¼–è¯‘å¹¶è¿è¡Œã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gcc zombie.c -o zombie
./zombie
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹ä¸‹è¿›ç¨‹æ ‘ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps f
PID TTY      STAT   TIME COMMAND
3514 pts/1    Ss     0:00 -bash
7911 pts/1    S+     0:00  \_ ./zombie
7912 pts/1    Z+     0:00      \_ [zombie] &amp;lt;defunct&amp;gt;
1317 pts/0    Ss     0:00 -bash
 7913 pts/0    R+     0:00  \_ ps f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬å¾—åˆ°äº†åƒµå°¸è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;å½“çˆ¶è¿›ç¨‹é€€å‡ºä¹‹åï¼Œåƒµå°¸è¿›ç¨‹ä¹Ÿé€€å‡ºäº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps f
PID TTY      STAT   TIME COMMAND
3514 pts/1    Ss+    0:00 -bash
1317 pts/0    Ss     0:00 -bash
 7914 pts/0    R+     0:00  \_ ps f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœä½ ç”¨&lt;code&gt;sleep 20&lt;/code&gt;ä»£æ›¿&lt;code&gt;while (true) ;&lt;/code&gt;ï¼Œåƒµå°¸è¿›ç¨‹ä¼šé©¬ä¸Šé€€å‡ºã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;code&gt;exit&lt;/code&gt;é€€å‡ºï¼Œæ‰€æœ‰ç”³è¯·çš„å†…å­˜å’Œèµ„æºä¼šé©¬ä¸Šé‡Šæ”¾ï¼Œä»¥ä¾›å…¶ä»–è¿›ç¨‹ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;çˆ¶è¿›ç¨‹å¯ä»¥ä½¿ç”¨&lt;code&gt;wait&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨æ‰¾åˆ°å­è¿›ç¨‹çš„é€€å‡ºä»£ç ï¼ˆåœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­ï¼‰ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ç¡çœ çŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…å®ƒé†’æ¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä¸ç®€å•ç²—æš´çš„å”¤é†’è¿›ç¨‹ï¼Œç„¶åæ€æ­»å®ƒï¼ŸåŒæ ·çš„åŸå› ï¼Œä½ ä¹Ÿä¸ä¼šåœ¨åŒçƒ¦ä½ å­©å­çš„æ—¶å€™æŠŠå®ƒä¸¢è¿›åƒåœ¾æ¡¶ã€‚åæœå¾ˆä¸¥é‡ã€‚&lt;/p&gt;
&lt;h3&gt;T - stopped by job control signal&lt;/h3&gt;
&lt;p&gt;æˆ‘æ‰“å¼€äº†ä¸¤ä¸ªç»ˆç«¯çª—å£ï¼Œç”¨&lt;code&gt;ps u&lt;/code&gt;å¯ä»¥çœ‹åˆ°æˆ‘çš„ç”¨æˆ·è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
ubuntu    1317  0.0  0.9  21420  4992 pts/0    Ss+  Jun07   0:00 -bash
ubuntu    3514  1.5  1.0  21420  5196 pts/1    Ss   07:28   0:00 -bash
ubuntu    3528  0.0  0.6  36084  3316 pts/1    R+   07:28   0:00 ps u
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹æ–‡çš„è¾“å‡ºä¸­æˆ‘ä¼šå¿½ç•¥&lt;code&gt;-bash&lt;/code&gt;å’Œ&lt;code&gt;ps u&lt;/code&gt;è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨åœ¨ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ&lt;code&gt;cat /dev/urandom &amp;gt; /dev/null&lt;/code&gt;ã€‚å®ƒçš„çŠ¶æ€æ˜¯&lt;code&gt;R+&lt;/code&gt;ï¼Œæ„å‘³ç€å®ƒåœ¨è¿è¡Œä¸­ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
ubuntu    3540  103  0.1   6168   688 pts/1    R+   07:29   0:04 cat /dev/urandom
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŒ‰ä¸‹&lt;code&gt;CTRL&lt;/code&gt;åŠ &lt;code&gt;Z&lt;/code&gt;é”®ï¼Œç»ˆæ­¢è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ # CTRL+Z
[1]+  Stopped                 cat /dev/urandom &amp;gt; /dev/null
$ ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
ubuntu    3540 86.8  0.1   6168   688 pts/1    T    07:29   0:15 cat /dev/urandom
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç°åœ¨å®ƒçš„çŠ¶æ€æ˜¯&lt;code&gt;T&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ&lt;code&gt;fg&lt;/code&gt;ï¼Œæ¢å¤å®ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªç»ˆæ­¢è¿›ç¨‹çš„æ–¹æ³•æ˜¯é€šè¿‡&lt;code&gt;kill&lt;/code&gt;å‘é€&lt;code&gt;STOP&lt;/code&gt;ä¿¡å·ã€‚ä½ å¯ä»¥ç”¨&lt;code&gt;CONT&lt;/code&gt;å‹å·ï¼Œè®©è¿›ç¨‹æ¢å¤æ‰§è¡Œã€‚&lt;/p&gt;
&lt;h3&gt;t - stopped by debugger during the tracing&lt;/h3&gt;
&lt;p&gt;é¦–é€‰ï¼Œå®‰è£…GNU Debuggerï¼ˆgdbï¼‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt install -y gdb
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿è¡Œä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä¼šåœ¨1234 ç«¯å£ä¸Šç›‘å¬è¿›å…¥çš„ç½‘ç»œè¿æ¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ nc -l 1234 &amp;amp;
[1] 3905
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®ƒåœ¨ç¡çœ ä¸­æ„å‘³ç€å®ƒæ­£åœ¨ç­‰å¾…ç½‘ç»œæ•°æ®ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ps u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
ubuntu    3905  0.0  0.1   9184   896 pts/0    S    07:41   0:00 nc -l 1234
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿è¡Œdebuggerï¼Œè¿æ¥ä¸ŠIDæ˜¯3905 çš„è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo gdb -p 3905
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ ä¼šçœ‹åˆ°è¿›ç¨‹çŠ¶æ€å˜ä¸º&lt;code&gt;t&lt;/code&gt;ï¼Œæ„å‘³ç€è¿™ä¸ªè¿›ç¨‹æ­£åœ¨è¢«debugger è·Ÿè¸ªã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹æ—¶é—´ç‰‡&lt;/h2&gt;
&lt;p&gt;Linux æ˜¯ä¸€ä¸ªå¤šä»»åŠ¡çš„æ“ä½œç³»ç»Ÿï¼Œè¿™æ„å‘³ç€å³ä½¿ä½ åªæœ‰ä¸€é¢—CPUï¼Œä¹Ÿå¯ä»¥åŒæ—¶è·‘å¤šä¸ªè¿›ç¨‹ã€‚å½“ä½ çš„Web server é€šè¿‡äº’è”ç½‘æŠŠä½ çš„åšå®¢å†…å®¹åˆ†å‘ç»™è¯»è€…çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡SSH è¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨ï¼Œçœ‹ä¸€ä¸‹&lt;code&gt;htop&lt;/code&gt;çš„è¾“å‡ºå†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€é¢—CPUåŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œé‚£è¿™æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ç­”æ¡ˆæ˜¯åˆ†æ—¶ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè¿›ç¨‹è¿è¡Œä¸€ç‚¹æ—¶é—´ï¼Œæ¥ç€å®ƒè¿›å…¥ç¡çœ ï¼Œå› ä¸ºå…¶ä»–è¿›ç¨‹åœ¨ç­‰å¾…è½®æµè¿è¡Œã€‚è¿›ç¨‹è¿è¡Œçš„ä¸€å°æ®µæ—¶é—´è¢«ç§°è°“æ—¶é—´ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæ—¶é—´ç‰‡é€šå¸¸æ˜¯å‡ æ¯«ç§’ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿè´Ÿè½½ä¸é«˜çš„æ—¶å€™ï¼Œä½ ä¸ä¼šæ³¨æ„åˆ°å®ƒã€‚ï¼ˆæ‰¾å‡ºLinux çš„æ—¶é—´ç‰‡æ˜¯å¤šé•¿å¾ˆæœ‰æ„æ€ã€‚ï¼‰&lt;/p&gt;
&lt;p&gt;è¿™åº”è¯¥å¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆå¹³å‡è´Ÿè½½æ˜¯è¿è¡Œä¸­çš„å¹³å‡è¿›ç¨‹æ•°ã€‚å¦‚æœä½ åªæœ‰ä¸€ä¸ªæ ¸å¿ƒï¼Œå¹¶ä¸”å¹³å‡è´Ÿè½½æ˜¯&lt;code&gt;1.0&lt;/code&gt;ï¼Œåˆ™CPU åˆ©ç”¨ç‡æ˜¯100%ã€‚å¦‚æœå¹³å‡è´Ÿè½½å¤§äº&lt;code&gt;1.0&lt;/code&gt;ï¼Œè¿™æ„å‘³ç€ç­‰å¾…è¿è¡Œçš„è¿›ç¨‹è¶…è¿‡CPU å¯ä»¥è¿è¡Œçš„æ•°é‡ï¼Œæ‰€ä»¥è¿™æ—¶ä½ å¯èƒ½ä¼šæ„Ÿè§‰åˆ°å¡é¡¿ã€‚å¦‚æœå¹³å‡è´Ÿè½½ä½äº&lt;code&gt;1.0&lt;/code&gt;ï¼Œæ„å‘³ç€CPU æœ‰æ—¶ç©ºé—²ç€ä¸åšäº‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™åº”è¯¥è®©ä½ æœ‰äº†æ€è·¯ï¼Œä¸ºä»€ä¹ˆæœ‰æ—¶è¿è¡Œä¸€ä¸ªæ‰§è¡Œæ—¶é—´ä¸º10ç§’çš„è¿›ç¨‹ï¼Œè¿è¡Œæ—¶é—´å¯èƒ½é•¿äºæˆ–è€…çŸ­äº10ç§’ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹å‹å¥½åº¦å’Œä¼˜å…ˆçº§&lt;/h2&gt;
&lt;p&gt;å½“ä½ æœ‰è¶…è¿‡CPU Hæ ¸å¿ƒæ•°çš„è¿›ç¨‹éœ€è¦è¿è¡Œçš„æ—¶å€™ï¼Œä½ å¾—æƒ³ä¸ªæ–¹å¼å†³å®šä¸‹ä¸€æ­¥è¿è¡Œå“ªäº›è¿›ç¨‹ï¼Œä»¥åŠè®©å“ªäº›è¿›ç¨‹æ’é˜Ÿç­‰å¾…ã€‚è¿™å°±æ˜¯ä»»åŠ¡è°ƒåº¦å™¨çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;Linux å†…æ ¸çš„è°ƒåº¦å™¨è´Ÿè´£ä»è¿è¡Œé˜Ÿåˆ—ä¸­é€‰å‡ºä¸‹ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹ï¼Œå…·ä½“çš„é€‰å–æ–¹æ³•å–å†³äºå†…æ ¸ä½¿ç”¨çš„è°ƒåº¦ç®—æ³•ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸ä½ æ²¡æ³•å½±å“è°ƒåº¦å™¨ï¼Œä¸è¿‡ä½ å¯ä»¥è®©è°ƒåº¦å™¨çŸ¥é“å“ªäº›ç¨‹åºå¯¹ä½ æ¥è¯´æ›´é‡è¦ï¼Œè°ƒåº¦å™¨ä¼šç‰¹åˆ«å…³æ³¨ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;å‹å¥½åº¦ï¼ˆ&lt;code&gt;NI&lt;/code&gt;ï¼‰æ˜¯è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ä¼˜å…ˆçº§ï¼ŒèŒƒå›´ä»-20ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰åˆ°19ï¼ˆä¼˜å…ˆçº§æœ€ä½ï¼‰ã€‚è¿™å¯èƒ½è®©äººæœ‰ç‚¹è´¹è§£ï¼Œä¸è¿‡ä½ å¯ä»¥è¿™æ ·æƒ³ï¼Œä¸€ä¸ªå‹å¥½çš„è¿›ç¨‹ä¼šè°¦è®©ä¸€ä¸ªä¸å‹å¥½çš„è¿›ç¨‹ã€‚æ‰€ä»¥ä¸€ä¸ªè¿›ç¨‹è¶Šå‹å¥½ï¼Œå®ƒè°¦è®©å¾—è¶Šå¤šã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡é˜…è¯»StackOverflow å’Œå…¶ä»–ç«™ç‚¹ï¼Œæˆ‘æ€»ç»“æ•´ç†äº†ä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹çš„Nice å€¼æ¯æé«˜1ï¼Œä¼šè®©å‡ºè¶…è¿‡10% çš„CPU æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜å…ˆçº§ï¼ˆ&lt;code&gt;PRI&lt;/code&gt;ï¼‰æ˜¯Linux å†…æ ¸ä½¿ç”¨çš„å†…æ ¸ç©ºé—´çš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯0åˆ°139ï¼Œå…¶ä¸­0åˆ°99 ç”¨äºå®æ—¶è¿›ç¨‹ï¼Œ100åˆ°139 ç”¨äºç”¨æˆ·è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥æ”¹å˜è¿›ç¨‹çš„å‹å¥½åº¦ï¼Œå†…æ ¸ä¼šè€ƒè™‘åˆ°ï¼Œä¸è¿‡ä½ æ²¡æ³•æ”¹å˜ä¼˜å…ˆçº§ã€‚&lt;/p&gt;
&lt;p&gt;nice å€¼å’Œä¼˜å…ˆçº§çš„å…³ç³»æ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;PR = 20 + NI
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰€ä»¥&lt;code&gt;PR=20 + (-20 to +19)&lt;/code&gt; çš„å€¼æ˜¯0 åˆ°39ï¼Œå¯¹åº”çš„ä¼˜å…ˆçº§æ˜¯100åˆ°139 ã€‚&lt;br&gt;
ä½ å¯ä»¥åœ¨å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å‰è®¾ç½®å®ƒçš„å‹å¥½åº¦ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;nice -n niceness program
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯ä»¥ç”¨&lt;code&gt;renice&lt;/code&gt;æ”¹å˜è¿è¡Œä¸­çš„è¿›ç¨‹çš„å‹å¥½åº¦ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;renice -n niceness -p PID
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸åŒé¢œè‰²çš„CPU åˆ©ç”¨ç‡çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è“è‰²ï¼šä½ä¼˜å…ˆçº§çš„çº¿ç¨‹ï¼ˆnice &amp;gt; 0ï¼‰&lt;/li&gt;
&lt;li&gt;ç»¿è‰²ï¼šæ™®é€šä¼˜å…ˆçº§çš„çº¿ç¨‹&lt;/li&gt;
&lt;li&gt;çº¢è‰²ï¼šå†…æ ¸çº¿ç¨‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href="http://askubuntu.com/questions/656771/process-niceness-vs-priority"&gt;http://askubuntu.com/questions/656771/process-niceness-vs-priority&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;å†…å­˜ä½¿ç”¨æƒ…å†µ - VIRT/RES/SHR/MEM&lt;/h2&gt;
&lt;p&gt;ä¸€ä¸ªè¿›ç¨‹ä¼šæœ‰å®ƒæ˜¯å†…å­˜é‡Œé¢å”¯ä¸€ä¸€ä¸ªçš„é”™è§‰ã€‚è¿™æ˜¯é€šè¿‡è™šæ‹Ÿå†…å­˜å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;è¿›ç¨‹æ²¡æœ‰ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜çš„æƒé™ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå®ƒæœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå†…æ ¸ä¼šæŠŠè™šæ‹Ÿåœ°å€ç©ºé—´è½¬æ¢åˆ°ç‰©ç†å†…å­˜åœ°å€ï¼Œæˆ–è€…æ˜ å°„åˆ°ç£ç›˜ä¸Šã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆçœ‹èµ·æ¥è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜è¶…è¿‡ä½ è®¡ç®—æœºä¸Šå®é™…çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œæˆ‘æƒ³æå‡ºçš„æ˜¯å¼„æ¸…æ¥šä¸€ä¸ªè¿›ç¨‹åˆ°åº•ä½¿ç”¨äº†å¤šå°‘å†…å­˜ä¸å¤ªå®¹æ˜“ã€‚ä½ ä¹Ÿæƒ³ç»Ÿè®¡è´¡çŒ®åº“å’Œç£ç›˜æ˜ å°„çš„å†…å­˜ï¼Ÿå†…æ ¸æä¾›çš„å’Œ&lt;code&gt;htop&lt;/code&gt; å±•ç¤ºçš„ä¸€äº›ä¿¡æ¯å¯ä»¥å¸®ä½ ä¼°ç®—å†…å­˜ä½¿ç”¨æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä¸åŒé¢œè‰²çš„å†…å­˜ä½¿ç”¨é‡çš„å«ä¹‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç»¿è‰²ï¼šå·²ä½¿ç”¨çš„å†…å­˜&lt;/li&gt;
&lt;li&gt;è“è‰²ï¼šBuffer&lt;/li&gt;
&lt;li&gt;æ©˜é»„è‰²ï¼šCache&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;VIRT/VSZ - è™šæ‹Ÿé•œåƒ&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The total amount of virtual memory used by the task. It includes all code, data and shared libraries plus pages that have been swapped out and pages that have been mapped but not used.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;VIRT&lt;/code&gt;æ˜¯è™šæ‹Ÿå†…å­˜ä½¿ç”¨é‡ã€‚å®ƒåŒ…æ‹¬æ‰€æœ‰ä¸œè¥¿ï¼ŒåŒ…æ‹¬æ˜ å°„çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºç”³è¯·äº†1GB å†…å­˜ï¼Œä½†æ˜¯å®é™…åªç”¨äº†1MBï¼Œ&lt;code&gt;VIRT&lt;/code&gt;ä¹Ÿä¼šæ˜¾ç¤º 1GBã€‚å¦‚æœå®ƒ&lt;code&gt;mmap&lt;/code&gt;ä¸€ä¸ª1GB çš„æ–‡ä»¶ï¼Œä½†ä¸ä½¿ç”¨ï¼Œ&lt;code&gt;VIRT&lt;/code&gt;ä¹Ÿä¼šæ˜¾ç¤ºä¸º 1GBã€‚&lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°æ—¶å€™ï¼Œè¿™ä¸ªå€¼æ²¡å•¥ç”¨ã€‚&lt;/p&gt;
&lt;h3&gt;RES/RSS - å¸¸é©»å¤§å°&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The non-swapped physical memory a task has used.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;RES&lt;/code&gt;æ˜¯å¸¸é©»å†…å­˜çš„ä½¿ç”¨é‡ï¼Œå³å½“å‰ç‰©ç†å†…å­˜ä½¿ç”¨é‡ã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶&lt;code&gt;RES&lt;/code&gt;ç›¸æ¯”&lt;code&gt;VIRT&lt;/code&gt;å¯ä»¥æ›´å¥½çš„è¡¨ç¤ºè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨é‡ï¼Œä¸è¿‡è¯·è®°ä½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ƒä¸åŒ…æ‹¬äº¤æ¢å‡ºçš„å†…å­˜ï¼ˆè¯‘æ³¨ï¼šå³åœ¨swap ä¸Šçš„å†…å®¹ï¼‰&lt;/li&gt;
&lt;li&gt;å¯èƒ½åŒ…æ‹¬å’Œå…¶ä»–è¿›ç¨‹çš„å…±äº«å†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨äº†1GB å†…å­˜ï¼Œå®ƒè°ƒç”¨&lt;code&gt;fork()&lt;/code&gt;ï¼Œfork çš„ç»“æœæ˜¯æœ‰2 ä¸ªè¿›ç¨‹ï¼Œå®ƒä»¬çš„&lt;code&gt;RES&lt;/code&gt;éƒ½æ˜¯1GBï¼Œä¸è¿‡å®é™…ä¸Šåªç”¨äº†1GBï¼Œå› ä¸ºLinux çš„å†™å…¥æ—¶å¤åˆ¶ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://zh.wikipedia.org/zh-hans/%E5%AF%AB%E5%85%A5%E6%99%82%E8%A4%87%E8%A3%BD"&gt;å†™å…¥æ—¶å¤åˆ¶&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;SHR - å…±äº«å†…å­˜å¤§å°&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The amount of shared memory used by a task.
It simply reflects memory that could be potentially shared with other processes.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Started&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// 10 MB&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;malloc&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Allocated 10M&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Used 5M&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Forked&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;size_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;memory&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;42&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Child used extra 2M&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;fallocate -l 10G
gcc -std=c99 mem.c -o mem
./mem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Process  Message               VIRT  RES SHR
main     Started               4200  680 604
main     Allocated 10M        14444  680 604
main     Used 5M              14444 6168 1116
main     Forked               14444 6168 1116
child    Forked               14444 5216 0
main     Child used extra 2M        8252 1116
child    Child used extra 2M        5216 0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;TODO: I should finish this.&lt;/p&gt;
&lt;h3&gt;MEM% - å†…å­˜ä½¿ç”¨ç‡&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;A task's currently used share of available physical memory.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;RES&lt;/code&gt; é™¤ä»¥ æ€»ç‰©ç†å†…å­˜å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ&lt;code&gt;RES&lt;/code&gt;æ˜¯500Mï¼Œä½ æœ‰8Gå†…å­˜ï¼Œ&lt;code&gt;MEM%&lt;/code&gt; å°†æ˜¯&lt;code&gt;400/8192*100&lt;/code&gt; = &lt;code&gt;4.88%&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;è¿›ç¨‹&lt;/h2&gt;
&lt;p&gt;æˆ‘åœ¨Digital Ocean ä¸Šå¯åŠ¨äº†ä¸€å°Ubuntu Serverã€‚&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™ä¼šè¿è¡Œå“ªäº›è¿›ç¨‹å‘¢ï¼Ÿ&lt;br&gt;
ä½ çœŸçš„éœ€è¦å®ƒä»¬å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨Digital Ocean æ–°å¯åŠ¨äº†ä¸€å°Ubuntu Server 16.04.1 LTS x64 ï¼Œè¿™æ˜¯å…³äºå®ƒçš„å¼€æœºå¯åŠ¨ç¨‹åºçš„è°ƒç ”ç¬”è®°ã€‚&lt;/p&gt;
&lt;h3&gt;å¼€å§‹ä¹‹å‰&lt;/h3&gt;
&lt;p&gt;&lt;img alt="canyoukillit-before" src="/assets/images/2023/20230301153424.png"&gt;&lt;/p&gt;
&lt;h3&gt;/sbin/init&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The /sbin/init program (also called init) coordinates the rest of the boot process and configures the environment for the user.&lt;/p&gt;
&lt;p&gt;When the init command starts, it becomes the parent or grandparent of all of the processes that start up automatically on the system.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ˜¯Systemd å—ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ dpkg -S /sbin/init
systemd-sysv: /sbin/init
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ˜¯çš„ï¼Œå°±æ˜¯å®ƒã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ kill æ‰å®ƒä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://unix.stackexchange.com/questions/66698/how-does-systemd-survive-a-kill-9"&gt;How does systemd survive a kill -9?&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://wiki.ubuntu.com/SystemdForUpstartUsers"&gt;https://wiki.ubuntu.com/SystemdForUpstartUsers&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.centos.org/docs/5/html/5.1/Installation_Guide/s2-boot-init-shutdown-init.html"&gt;https://www.centos.org/docs/5/html/5.1/Installation_Guide/s2-boot-init-shutdown-init.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/lib/systemd/systemd-journald&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;systemd-journald is a system service that collects and stores logging data. It creates and maintains structured, indexed journals based on logging information that is received from a variety of sources.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¢ç§è¯´æ³•ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;One of the main changes in journald was to replace simple plain text log files with a special file format optimized for log messages. This file format allows system administrators to access relevant messages more efficiently. It also brings some of the power of database-driven centralized logging implementations to individual systems.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ åº”è¯¥ç”¨&lt;code&gt;journalctl&lt;/code&gt;å‘½ä»¤æ¥æŸ¥è¯¢æ—¥å¿—ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;journalctl _COMM=sshd&lt;/code&gt; sshd æ—¥å¿—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl _COMM=sshd -o json-pretty&lt;/code&gt; JSON æ ¼å¼çš„sshd æ—¥å¿—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl --since "2015-01-10" --until "2015-01-11 03:00"&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl --since 09:00 --until "1 hour ago"&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl --since yesterday&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl -b&lt;/code&gt; å¯åŠ¨ä»¥æ¥çš„æ—¥å¿—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl -f&lt;/code&gt; æ»šåŠ¨æ›´æ–°æ—¥å¿—&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl --disk-usage&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl --vacuum-size=1G&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¤ªé…·äº†ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹èµ·æ¥æ²¡æ³•ç¦ç”¨æˆ–è€…ç§»é™¤è¿™ä¸ªæœåŠ¡ï¼Œä½ åªèƒ½å…³é—­æ—¥å¿—è®°å½•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd-journald.service.html"&gt;https://www.freedesktop.org/software/systemd/man/systemd-journald.service.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs"&gt;https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.loggly.com/blog/why-journald/"&gt;https://www.loggly.com/blog/why-journald/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://ask.fedoraproject.org/en/question/63985/how-to-correctly-disable-journald/"&gt;https://ask.fedoraproject.org/en/question/63985/how-to-correctly-disable-journald/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/sbin/lvmetad -f&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The lvmetad daemon caches LVM metadata, so that LVM commands can read metadata without scanning disks.&lt;/p&gt;
&lt;p&gt;Metadata caching can be an advantage because scanning disks is time consuming and may interfere with the normal work of the system and disks.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯LVMï¼ˆé€»è¾‘åˆ†å·ç®¡ç†å™¨ï¼‰ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You can think of LVM as "dynamic partitions", meaning that you can create/resize/delete LVM "partitions" (they're called "Logical Volumes" in LVM-speak) from the command line while your Linux system is running: no need to reboot the system to make the kernel aware of the newly-created or resized partitions.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¬èµ·æ¥å¦‚æœä½ åœ¨ç”¨LVM çš„è¯ï¼Œåº”è¯¥ä¿ç•™è¿™ä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ lvscan
$ sudo apt remove lvm2 -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/lvmetad.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/lvmetad.8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://askubuntu.com/questions/3596/what-is-lvm-and-what-is-it-used-for"&gt;http://askubuntu.com/questions/3596/what-is-lvm-and-what-is-it-used-for&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/lib/systemd/udevd&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;systemd-udevd listens to kernel uevents. For every event, systemd-udevd executes matching instructions specified in udev rules.&lt;/p&gt;
&lt;p&gt;udev is a device manager for the Linux kernel. As the successor of devfsd and hotplug, udev primarily manages device nodes in the /dev directory.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥è¿™ä¸ªæœåŠ¡æ˜¯ç®¡ç†&lt;code&gt;dev&lt;/code&gt;çš„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä¸ç¡®å®šåœ¨è™šæ‹Ÿæœºä¸Šæ˜¯å¦éœ€è¦å®ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd-udevd.service.html"&gt;https://www.freedesktop.org/software/systemd/man/systemd-udevd.service.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/udev"&gt;https://wiki.archlinux.org/index.php/udev&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/lib/systemd/timesyncd&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;systemd-timesyncd is a system service that may be used to synchronize the local system clock with a remote Network Time Protocol server.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥è¿™æ˜¯ç”¨æ¥ä»£æ›¿&lt;code&gt;ntpd&lt;/code&gt;çš„ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ timedatectl status
Local time: Fri 2016-08-26 11:38:21 UTC
Universal time: Fri 2016-08-26 11:38:21 UTC
RTC time: Fri 2016-08-26 11:38:20
Time zone: Etc/UTC (UTC, +0000)
Network time on: yes
NTP synchronized: yes
 RTC in local TZ: no
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹æœåŠ¡å™¨ä¸Šæ‰“å¼€çš„ç«¯å£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo netstat -nlput
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      2178/sshd
tcp6       0      0 :::22                   :::*                    LISTEN      2178/sshd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;èµï¼&lt;/p&gt;
&lt;p&gt;ä¹‹å‰çš„Ubuntu 14.04 æ˜¯è¿™æ ·çš„ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo apt-get install ntp -y
$ sudo netstat -nlput
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1380/sshd
tcp6       0      0 :::22                   :::*                    LISTEN      1380/sshd
udp        0      0 10.19.0.6:123           0.0.0.0:*                           2377/ntpd
udp        0      0 139.59.256.256:123      0.0.0.0:*                           2377/ntpd
udp        0      0 127.0.0.1:123           0.0.0.0:*                           2377/ntpd
udp        0      0 0.0.0.0:123             0.0.0.0:*                           2377/ntpd
udp6       0      0 fe80::601:6aff:fxxx:123 :::*                                2377/ntpd
udp6       0      0 ::1:123                 :::*                                2377/ntpd
udp6       0      0 :::123                  :::*                                2377/ntpd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é¢ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd-timesyncd.service.html"&gt;https://www.freedesktop.org/software/systemd/man/systemd-timesyncd.service.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/systemd-timesyncd"&gt;https://wiki.archlinux.org/index.php/systemd-timesyncd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/sbin/atd -f&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;atd - run jobs queued for later execution. atd runs jobs queued by at.&lt;/p&gt;
&lt;p&gt;at and batch read commands from standard input or a specified file which are to be executed at a later time&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸åŒäºå‘¨æœŸæ€§é‡å¤æ‰§è¡Œä»»åŠ¡çš„cronï¼Œ&lt;code&gt;at&lt;/code&gt; åªä¼šåœ¨æŒ‡å®šæ—¶åˆ»æ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ echo &amp;quot;touch /tmp/yolo.txt&amp;quot; | at now + 1 minute
job 1 at Fri Aug 26 10:44:00 2016
$ atq
1       Fri Aug 26 10:44:00 2016 a root
$ sleep 60 &amp;amp;&amp;amp; ls /tmp/yolo.txt
/tmp/yolo.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®é™…ä¸Šè¿„ä»Šä¸ºæ­¢æˆ‘éƒ½æ²¡ç”¨è¿‡å®ƒã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove at -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/atd.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/atd.8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man1/at.1.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man1/at.1.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://askubuntu.com/questions/162439/why-does-ubuntu-server-run-both-cron-and-atd"&gt;http://askubuntu.com/questions/162439/why-does-ubuntu-server-run-both-cron-and-atd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/lib/snapd/snapd&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Snappy Ubuntu Core is a new rendition of Ubuntu with transactional updates - a minimal server image with the same libraries as todayâ€™s Ubuntu, but applications are provided through a simpler mechanism.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä»€ä¹ˆï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Developers from multiple Linux distributions and companies today announced collaboration on the â€œsnapâ€ universal Linux package format, enabling a single binary package to work perfectly and securely on any Linux desktop, server, cloud or device.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ˜¾è€Œæ˜“è§è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„deb åŒ…ï¼Œä½ å¯ä»¥å°†æ‰€æœ‰ä¾èµ–æ‰“è¿›ä¸€ä¸ªSnappy æ¥åˆ†å‘ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»æ¥æ²¡åœ¨æœåŠ¡å™¨ä¸Šç”¨Snappy éƒ¨ç½²æˆ–åˆ†å‘è¿‡åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove snapd -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="https://developer.ubuntu.com/en/snappy/"&gt;https://developer.ubuntu.com/en/snappy/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://insights.ubuntu.com/2016/06/14/universal-snap-packages-launch-on-multiple-linux-distros/"&gt;https://insights.ubuntu.com/2016/06/14/universal-snap-packages-launch-on-multiple-linux-distros/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/bin/dbus-daemon&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;In computing, D-Bus or DBus is an inter-process communication (IPC) and remote procedure call (RPC) mechanism that allows communication between multiple computer programs (that is, processes) concurrently running on the same machine&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘çš„ç†è§£æ˜¯æ¡Œé¢ç¯å¢ƒæˆ–è€…åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œweb åº”ç”¨æ‰éœ€è¦è¿™ä¸ªï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove dbus -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘æƒ³çŸ¥é“ç°åœ¨æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Œæ˜¯å¦å’ŒNTP ä¿æŒåŒæ­¥ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ timedatectl status
Failed to create bus connection: No such file or directory
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç³Ÿç³•ã€‚åº”è¯¥ä¿ç•™è¿™ä¸ªçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/D-Bus"&gt;https://en.wikipedia.org/wiki/D-Bus&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/lib/systemd/systemd-logind&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;systemd-logind is a system service that manages user logins.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.freedesktop.org/software/systemd/man/systemd-logind.service.html"&gt;https://www.freedesktop.org/software/systemd/man/systemd-logind.service.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/sbin/cron -f&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;cron - daemon to execute scheduled commands (Vixie Cron)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;-f&lt;/code&gt; Stay in foreground mode, don't daemonize.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ å¯ä»¥å®‰æ’cron å‘¨æœŸæ€§çš„é‡å¤æ‰§è¡Œä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;ç”¨&lt;code&gt;crontab -e&lt;/code&gt;æ¥ç¼–è¾‘ä½ çš„é…ç½®ï¼Œä¸è¿‡æˆ‘æ›´å€¾å‘äºä½¿ç”¨&lt;code&gt;/etc/cron.hourly&lt;/code&gt;ï¼Œ&lt;code&gt;/etc/cron.daily&lt;/code&gt;ç­‰ç›®å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥ç”¨ä»¥ä¸‹æ–¹æ³•æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;grep cron /var/log/syslog&lt;/code&gt; æˆ–è€…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl _COMM=cron&lt;/code&gt; ç”šè‡³&lt;/li&gt;
&lt;li&gt;&lt;code&gt;journalctl _COMM=cron --since="date" --until="date"&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯èƒ½æƒ³ä¿ç•™cronã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä¸æƒ³çš„è¯ï¼Œåº”è¯¥åœæ­¢å’Œç¦ç”¨è¿™ä¸ªæœåŠ¡ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo systemctl stop cron
sudo systemctl disable cron
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å› ä¸ºå¦‚æœæˆ‘ä»¬å°è¯•é€šè¿‡&lt;code&gt;apt remove cron&lt;/code&gt;å¸è½½å®ƒçš„è¯ï¼Œç³»ç»Ÿä¼šå®‰è£…postfixï¼&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sudo apt remove cron
The following packages will be REMOVED:
cron
The following NEW packages will be installed:
  anacron bcron bcron-run fgetty libbg1 libbg1-doc postfix runit ssl-cert ucspi-unix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹èµ·æ¥cron éœ€è¦é€šè¿‡ä¸€ä¸ªé‚®ä»¶ä¼ è¾“ä»£ç†ï¼ˆMTAï¼‰æ¥å‘é€é‚®ä»¶ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ apt show cron
Package: cron
Version: 3.0pl1-128ubuntu2
...
Suggests: anacron (&amp;gt;= 2.0-1), logrotate, checksecurity, exim4 | postfix | mail-transport-agent

$ apt depends cron
cron
...
Suggests: anacron (&amp;gt;= 2.0-1)
Suggests: logrotate
Suggests: checksecurity
|Suggests: exim4
|Suggests: postfix
Suggests: &amp;lt;mail-transport-agent&amp;gt;
...
exim4-daemon-heavy
    postfix
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/CronHowto"&gt;https://help.ubuntu.com/community/CronHowto&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.digitalocean.com/community/tutorials/how-to-use-cron-to-automate-tasks-on-a-vps"&gt;https://www.digitalocean.com/community/tutorials/how-to-use-cron-to-automate-tasks-on-a-vps&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://unix.stackexchange.com/questions/212355/where-is-my-logfile-of-crontab"&gt;http://unix.stackexchange.com/questions/212355/where-is-my-logfile-of-crontab&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/sbin/rsyslogd -n&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Rsyslogd is a system utility providing support for message logging.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼Œå®ƒäº§ç”Ÿ&lt;code&gt;/var/log&lt;/code&gt;ä¸‹çš„æ—¥å¿—æ–‡ä»¶ï¼Œä¾‹å¦‚è®°å½•äº†SSHç™»å½•çš„è®¤è¯æ¶ˆæ¯çš„&lt;code&gt;/var/log/auth.log&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®æ–‡ä»¶åœ¨&lt;code&gt;/etc/rsyslog.d&lt;/code&gt;ç›®å½•ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥é…ç½®rsyslogd å‘é€æ—¥å¿—åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå®ç°é›†ä¸­è®°å½•æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åœ¨åå°è„šæœ¬é‡Œï¼ˆä¾‹å¦‚å¼€æœºå¯åŠ¨çš„è„šæœ¬ï¼‰ä½¿ç”¨&lt;code&gt;logger&lt;/code&gt;å‘½ä»¤ï¼ŒæŠŠæ¶ˆæ¯è®°å½•åˆ°&lt;code&gt;/var/log/syslog&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/bin/bash

logger Starting doing something
# NFS, get IPs, etc.
logger Done doing something
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¹äº†ï¼Œæˆ‘ä»¬å·²ç»è¿è¡Œç€&lt;code&gt;systemd-journald&lt;/code&gt;ï¼Œè¿˜éœ€è¦&lt;code&gt;rsyslogd&lt;/code&gt;å—ï¼Ÿ&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Rsyslog and Journal, the two logging applications present on your system, have several distinctive features that make them suitable for specific use cases. In many situations it is useful to combine their capabilities, for example to create structured messages and store them in a file database. A communication interface needed for this cooperation is provided by input and output modules on the side of Rsyslog and by the Journal's communication socke&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¯èƒ½éœ€è¦å§ï¼Ÿä»¥é˜²ä¸‡ä¸€æˆ‘å†³å®šç•™ç€å®ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/rsyslogd.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/rsyslogd.8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man1/logger.1.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man1/logger.1.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/rsyslog"&gt;https://wiki.archlinux.org/index.php/rsyslog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.digitalocean.com/community/tutorials/how-to-centralize-logs-with-rsyslog-logstash-and-elasticsearch-on-ubuntu-14-04"&gt;https://www.digitalocean.com/community/tutorials/how-to-centralize-logs-with-rsyslog-logstash-and-elasticsearch-on-ubuntu-14-04&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-interaction_of_rsyslog_and_journal.html"&gt;https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/s1-interaction_of_rsyslog_and_journal.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/sbin/acpid&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;acpid - Advanced Configuration and Power Interface event daemon&lt;/p&gt;
&lt;p&gt;acpid is designed to notify user-space programs of ACPI events. acpid should be started during the system boot, and will run as a background process, by default.&lt;/p&gt;
&lt;p&gt;In computing, the Advanced Configuration and Power Interface (ACPI) specification provides an open standard that operating systems can use to perform discovery and configuration of computer hardware components, to perform power management by, for example, putting unused components to sleep, and to do status monitoring.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½†æ˜¯æˆ‘æ˜¯åœ¨è™šæ‹Ÿæœºé‡Œï¼Œæˆ‘ä¸æ‰“ç®—ä¼‘çœ /æ¢å¤ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è¦ç§»é™¤å®ƒçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove acpid -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘èƒ½å¤ŸæˆåŠŸ&lt;code&gt;reboot&lt;/code&gt;ï¼Œä½†æ˜¯&lt;code&gt;halt&lt;/code&gt; ä¹‹åDigital Oceanä»»åŠ¡å®ƒè¿˜åœ¨è¿è¡Œï¼Œæ‰€ä»¥ä¸å¾—ä¸åœ¨web ç•Œé¢ä¸Šå…³é—­ç”µæºã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘åº”è¯¥ç•™ç€å®ƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/acpid.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/acpid.8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface"&gt;https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/bin/lxcfs /var/lib/lxcfs/&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Lxcfs is a fuse filesystem mainly designed for use by lxc containers. On a Ubuntu 15.04 system, it will be used by default to provide two things: first, a virtualized view of some /proc files; and secondly, filtered access to the hostâ€™s cgroup filesystems.&lt;/p&gt;
&lt;p&gt;In summary, on a 15.04 host, you can now create a container the usual way, lxc-create ... The resulting container will have â€œcorrectâ€ results for uptime, top, etc.&lt;/p&gt;
&lt;p&gt;Itâ€™s basically a userspace workaround to changes which were deemed unreasonable to do in the kernel. It makes containers feel much more like separate systems than they would without it.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ç”¨LXC å®¹å™¨ï¼Ÿä½ å¯ä»¥ç§»é™¤å®ƒã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove lxcfs -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="https://insights.ubuntu.com/2015/03/02/introducing-lxcfs/"&gt;https://insights.ubuntu.com/2015/03/02/introducing-lxcfs/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.stgraber.org/2016/03/31/lxcfs-2-0-has-been-released/"&gt;https://www.stgraber.org/2016/03/31/lxcfs-2-0-has-been-released/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/lib/accountservice/accounts-daemon&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;The AccountsService package provides a set of D-Bus interfaces for querying and manipulating user account information and an implementation of these interfaces based on the usermod(8), useradd(8) and userdel(8) commands.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ç§»é™¤DBus çš„æ—¶å€™æŸåäº†&lt;code&gt;timedatectl&lt;/code&gt;ï¼Œä¸çŸ¥é“æˆ‘ç§»é™¤äº†è¿™ä¸ªæœåŠ¡ä¹‹åä¼šæŸåä»€ä¹ˆã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove accountsservice -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ—¶é—´ä¼šè¯´æ˜ä¸€åˆ‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.linuxfromscratch.org/blfs/view/systemd/gnome/accountsservice.html"&gt;http://www.linuxfromscratch.org/blfs/view/systemd/gnome/accountsservice.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/sbin/mdadm&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;mdadm is a Linux utility used to manage and monitor software RAID devices.&lt;/p&gt;
&lt;p&gt;The name is derived from the md (multiple device) device nodes it administers or manages, and it replaced a previous utility mdctl. The original name was "Mirror Disk", but was changed as the functionality increased.&lt;/p&gt;
&lt;p&gt;RAID is a method of using multiple hard drives to act as one. There are two purposes of RAID: 1) Expand drive capacity: RAID 0. If you have 2 x 500 GB HDD then total space become 1 TB. 2) Prevent data loss in case of drive failure: For example RAID 1, RAID 5, RAID 6, and RAID 10.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ å¯ä»¥ç§»é™¤å®ƒã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove mdadm -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Mdadm"&gt;https://en.wikipedia.org/wiki/Mdadm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://help.ubuntu.com/community/Installation/SoftwareRAID"&gt;https://help.ubuntu.com/community/Installation/SoftwareRAID&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/mdadm.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/mdadm.8.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/lib/policykit-1/polkitd --no-debug&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;polkitd â€” PolicyKit daemon&lt;/p&gt;
&lt;p&gt;polkit - Authorization Framework&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘çš„ç†è§£æ˜¯è¿™åƒæ˜¯ä¸€ä¸ªç²¾ç»†çš„sudo ã€‚ä½ å¯ä»¥å…è®¸éç‰¹æƒç”¨æˆ·ä»¥root çš„èº«ä»½åšæŸäº›æ“ä½œã€‚ä¾‹å¦‚é‡å¯ä½ çš„æ¡Œé¢ç‰ˆLinuxã€‚&lt;/p&gt;
&lt;p&gt;ä¸è¿‡æˆ‘è¿è¡Œçš„æ˜¯ä¸€å°æœåŠ¡å™¨ã€‚ä½ å¯ä»¥ç§»é™¤å®ƒã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove policykit-1 -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿˜åœ¨è€ƒè™‘è¿™æ ·æ˜¯ä¸æ˜¯ç ´åäº†æŸäº›ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/polkitd.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/polkitd.8.html&lt;/a&gt; &lt;/li&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/polkit.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/polkit.8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.admin-magazine.com/Articles/Assigning-Privileges-with-sudo-and-PolicyKit"&gt;http://www.admin-magazine.com/Articles/Assigning-Privileges-with-sudo-and-PolicyKit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.archlinux.org/index.php/Polkit#Configuration"&gt;https://wiki.archlinux.org/index.php/Polkit#Configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/usr/sbin/sshd -D&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;sshd (OpenSSH Daemon) is the daemon program for ssh.&lt;/p&gt;
&lt;p&gt;-D When this option is specified, sshd will not detach and does not become a daemon. This allows easy monitoring of sshd.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/sshd.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/sshd.8.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;/sbin/iscsid&lt;/h3&gt;
&lt;p&gt;iscsid æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨åå°çš„daemonï¼ˆç³»ç»ŸæœåŠ¡ï¼‰è¿›ç¨‹ï¼Œç”¨äºé…ç½®iSCSI å’Œç®¡ç†è¿æ¥ã€‚æ‘˜è‡ªå®ƒçš„ä¸»é¡µï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The iscsid implements the control path of iSCSI protocol, plus some management facilities. For example, the daemon could be configured to automatically re-start discovery at startup, based on the contents of persistent iSCSI database.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="http://unix.stackexchange.com/questions/216239/iscsi-vs-iscsid-services"&gt;http://unix.stackexchange.com/questions/216239/iscsi-vs-iscsid-services&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»æ¥æ²¡å¬è¯´è¿‡iSCSIï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In computing, iSCSI (Listeni/aÉªËˆskÊŒzi/ eye-skuz-ee) is an acronym for Internet Small Computer Systems Interface, an Internet Protocol (IP)-based storage networking standard for linking data storage facilities.&lt;/p&gt;
&lt;p&gt;By carrying SCSI commands over IP networks, iSCSI is used to facilitate data transfers over intranets and to manage storage over long distances. iSCSI can be used to transmit data over local area networks (LANs), wide area networks (WANs), or the Internet and can enable location-independent data storage and retrieval.&lt;/p&gt;
&lt;p&gt;The protocol allows clients (called initiators) to send SCSI commands (CDBs) to SCSI storage devices (targets) on remote servers. It is a storage area network (SAN) protocol, allowing organizations to consolidate storage into data center storage arrays while providing hosts (such as database and web servers) with the illusion of locally attached disks.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½ å¯ä»¥ç§»é™¤å®ƒã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove open-iscsi -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;/sbin/agetty --noclear tty1 linux&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;agetty - alternative Linux getty&lt;/p&gt;
&lt;p&gt;getty, short for "get tty", is a Unix program running on a host computer that manages physical or virtual terminals (TTYs). When it detects a connection, it prompts for a username and runs the 'login' program to authenticate the user.&lt;/p&gt;
&lt;p&gt;Originally, on traditional Unix systems, getty handled connections to serial terminals (often Teletype machines) connected to a host computer. The tty part of the name stands for Teletype, but has come to mean any type of text terminal.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å®ƒå¯ä»¥è®©ä½ åœ¨ç‰©ç†æœºä¸Šç™»å½•è¿›ä½ çš„æœåŠ¡å™¨ã€‚åœ¨Digital Ocean ä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»droplet è¯¦æƒ…çš„&lt;code&gt;Console&lt;/code&gt;ï¼Œè®°ç€ä½ åº”è¯¥å¯ä»¥åœ¨æµè§ˆå™¨ä¸­å’Œä¸€ä¸ªç»ˆç«¯äº¤äº’ï¼ˆè®¤ä¸ºå®ƒå…¶å®æ˜¯ä¸€ä¸ªVNC è¿æ¥ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥å‰ï¼Œä½ ä¼šçœ‹åˆ°ä¸€å †tty åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ï¼ˆåœ¨&lt;code&gt;/etc/inittab&lt;/code&gt;ä¸­é…ç½®ï¼‰ï¼Œä½†æ˜¯ç°åœ¨å®ƒä»¬ç”±Systemd æŒ‰éœ€å¯åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¥½ç©ï¼Œæˆ‘ç§»é™¤äº†å¯åŠ¨å’Œç”Ÿæˆ&lt;code&gt;agetty&lt;/code&gt;çš„é…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo rm /etc/systemd/system/getty.target.wants/getty@tty1.service
sudo rm /lib/systemd/system/getty@.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“æˆ‘é‡å¯æœåŠ¡å™¨ä¹‹åï¼Œæˆ‘è¿˜èƒ½å¤Ÿé€šè¿‡SSH è¿æ¥ä¸Šï¼Œä¸è¿‡æ²¡æ³•é€šè¿‡Digital Ocean web ç»ˆç«¯ç™»å½•ã€‚&lt;br&gt;
&lt;img alt="htop-login" src="/assets/images/2023/20230301153446.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://manpages.ubuntu.com/manpages/xenial/man8/getty.8.html"&gt;http://manpages.ubuntu.com/manpages/xenial/man8/getty.8.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Getty_(Unix)"&gt;https://en.wikipedia.org/wiki/Getty_(Unix)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://0pointer.de/blog/projects/serial-console.html"&gt;http://0pointer.de/blog/projects/serial-console.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://unix.stackexchange.com/questions/56531/how-to-get-fewer-ttys-with-systemd"&gt;http://unix.stackexchange.com/questions/56531/how-to-get-fewer-ttys-with-systemd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;sshd: root@pts/0 &amp;amp; -bash &amp;amp; htop&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;sshd: root@pts/0&lt;/code&gt;è¡¨ç¤ºç”¨æˆ·&lt;code&gt;root&lt;/code&gt;åœ¨#&lt;code&gt;0&lt;/code&gt;å·è™šæ‹Ÿç»ˆç«¯ï¼ˆ&lt;code&gt;pts&lt;/code&gt;ï¼‰ä¸Šå»ºç«‹äº†ä¸€ä¸ªSSH ä¼šè¯ã€‚ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯æ¨¡ä»¿ä¸€ä¸ªçœŸæ­£çš„æ–‡æœ¬ç»ˆç«¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bash&lt;/code&gt; æ˜¯æˆ‘åœ¨ç”¨çš„shellã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆå¼€å¤´æœ‰ä¸€ä¸ªç ´æŠ˜å·ï¼ŸReddit ç”¨æˆ·hirnbrot å¾ˆå¥½çš„è§£é‡Šäº†ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There's a dash at the beginning because launching it as "-bash" will make it a login shell. A login shell is one whose first character of argument zero is a -, or one started with the --login option. This will then cause it to read a different set of configuration files.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;htop&lt;/code&gt;æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æˆªå›¾ä¸­çš„äº¤äº’å¼è¿›ç¨‹æŸ¥çœ‹å·¥å…·ã€‚&lt;/p&gt;
&lt;h3&gt;ç»“æŸä¹‹å&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove lvm2 -y --purge
sudo apt remove at -y --purge
sudo apt remove snapd -y --purge
sudo apt remove lxcfs -y --purge
sudo apt remove mdadm -y --purge
sudo apt remove open-iscsi -y --purge
sudo apt remove accountsservice -y --purge
sudo apt remove policykit-1 -y --purge
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="canyoukillit-after" src="/assets/images/2023/20230301153459.png"&gt;&lt;/p&gt;
&lt;p&gt;æé™ç‰ˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo apt remove dbus -y --purge
sudo apt remove rsyslog -y --purge
sudo apt remove acpid -y --purge
sudo systemctl stop cron &amp;amp;&amp;amp; sudo systemctl disable cron
sudo rm /etc/systemd/system/getty.target.wants/getty@tty1.service
sudo rm /lib/systemd/system/getty@.service
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="canyoukillit-after-extreme" src="/assets/images/2023/20230301153514.png"&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘æŒ‰ç…§æˆ‘çš„åšå®¢æ–‡ç« &lt;a href="https://peteris.rocks/blog/unattended-installation-of-wordpress-on-ubuntu-server/"&gt;about unattended installation of WordPress on Ubuntu Server &lt;/a&gt;çš„æ­¥éª¤å®‰è£…ï¼ŒæˆåŠŸäº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯nginxï¼ŒPHP7 å’ŒMySQLã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="canyoukillit-after-extreme-wp" src="/assets/images/2023/20230301153534.png"&gt;&lt;/p&gt;
&lt;h2&gt;é™„å½•&lt;/h2&gt;
&lt;h3&gt;æºä»£ç &lt;/h3&gt;
&lt;p&gt;æœ‰æ—¶å€™åªçœ‹&lt;code&gt;strace&lt;/code&gt; æ˜¯ä¸å¤Ÿçš„ã€‚ &lt;br&gt;
å¦å¤–ä¸€ä¸ªæ‰¾å‡ºä¸€ä¸ªç¨‹åºåˆ°åº•åšäº†ä»€ä¹ˆæ˜¯è¯»å®ƒçš„æºä»£ç ã€‚&lt;br&gt;
é¦–å…ˆï¼Œæˆ‘éœ€è¦æ‰¾åˆ°æˆ‘ä»¬ä»å“ªé‡Œå¼€å§‹çœ‹ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ which uptime
/usr/bin/uptime
$ dpkg -S /usr/bin/uptime
procps: /usr/bin/uptime
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘ä»¬å‘ç°&lt;code&gt;uptime&lt;/code&gt;å®é™…ä¸Šæ˜¯ä½äº&lt;code&gt;/usr/bin/uptime&lt;/code&gt;ï¼Œå¹¶ä¸”åœ¨Ubuntu ä¸Šå®ƒæ˜¯&lt;code&gt;proccps&lt;/code&gt; è½¯ä»¶åŒ…çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥åˆ°&lt;a href="http://packages.ubuntu.com/"&gt;http://packages.ubuntu.com/&lt;/a&gt; ä¸Šæœç´¢è¿™ä¸ªè½¯ä»¶åŒ…ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯&lt;code&gt;procps&lt;/code&gt;çš„é¡µé¢ï¼š&lt;a href="http://packages.ubuntu.com/source/xenial/procps"&gt;http://packages.ubuntu.com/source/xenial/procps&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ï¼Œä½ ä¼šçœ‹åˆ°æºä»£ç åº“çš„é“¾æ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Debian Package Source Repository git://git.debian.org/collab-maint/procps.git&lt;/li&gt;
&lt;li&gt;Debian Package Source Repository (Browsable) &lt;a href="https://anonscm.debian.org/cgit/collab-maint/procps.git/"&gt;https://anonscm.debian.org/cgit/collab-maint/procps.git/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;æ–‡ä»¶æè¿°ç¬¦å’Œé‡å®šå‘&lt;/h3&gt;
&lt;p&gt;å½“ä½ æƒ³æŠŠæ ‡å‡†é”™è¯¯è¾“å‡º(stderr)é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡º(stdout)ï¼Œæ˜¯ç”¨&lt;code&gt;2&amp;amp;&amp;gt;1&lt;/code&gt; è¿˜æ˜¯&lt;code&gt;2&amp;gt;&amp;amp;1&lt;/code&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä½ å¯ä»¥é€šè¿‡è®¤è¯†åˆ°&lt;code&gt;echo something &amp;gt; file&lt;/code&gt;å°†ä¼šå†™&lt;code&gt;something&lt;/code&gt;åˆ°æ–‡ä»¶&lt;code&gt;file&lt;/code&gt;ä¸­æ¥è®°ä½&lt;code&gt;&amp;amp;&lt;/code&gt;ç¬¦å·çš„ä½ç½®ã€‚è¿™å’Œ&lt;code&gt;echo something 1&amp;gt; file&lt;/code&gt;ä¸€æ ·ã€‚ç°åœ¨ï¼Œ&lt;code&gt;echo something 2&amp;gt; file&lt;/code&gt;ä¼šæŠŠstderr è¾“å‡ºåˆ°&lt;code&gt;file&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å†™çš„æ˜¯&lt;code&gt;echo something 2&amp;gt;1&lt;/code&gt;ï¼Œæ„å‘³ç€ä½ æŠŠstderr é‡å®šå‘åˆ°ä¸€ä¸ªå«&lt;code&gt;1``çš„æ–‡ä»¶ã€‚åŠ ä¸ªç©ºæ ¼çœ‹èµ·æ¥æ›´æ¸…æ™°ä¸€äº›ï¼š&lt;/code&gt;echo something 2&amp;gt; 1`ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åœ¨&lt;code&gt;1&lt;/code&gt;å‰é¢åŠ ä¸€ä¸ª&lt;code&gt;&amp;amp;&lt;/code&gt;ï¼Œè¡¨ç¤º&lt;code&gt;1&lt;/code&gt;ä¸æ˜¯ä¸€ä¸ªæ–‡ä»¶åè€Œæ˜¯ä¸€ä¸ªæµIDã€‚æ‰€ä»¥åº”è¯¥æ˜¯&lt;code&gt;echo something 2&amp;gt;&amp;amp;1&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;PuTTY çš„é¢œè‰²&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨PuTTY çš„æ—¶å€™ï¼Œåœ¨htop å‘ç°ç¼ºå°‘ä¸€äº›å½©è‰²å…ƒç´ ï¼Œä¸‹é¢æ˜¯è§£å†³æ–¹æ³•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å³å‡»æ ‡é¢˜æ &lt;/li&gt;
&lt;li&gt;ç‚¹å‡»Change settings...&lt;/li&gt;
&lt;li&gt;è·³åˆ°Window -&amp;gt; Colours&lt;/li&gt;
&lt;li&gt;é€‰æ‹©Both å•é€‰æŒ‰é’®&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»åº”ç”¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="putty-settings" src="/assets/images/2023/20230301153557.png"&gt;&lt;/p&gt;
&lt;h3&gt;C å†™çš„Shell&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç”¨C å†™ä¸€ä¸ªéå¸¸ç®€å•çš„shellï¼Œæ˜¾ç¤ºä¸‹ä½¿ç”¨&lt;code&gt;fork&lt;/code&gt;/&lt;code&gt;exec&lt;/code&gt;/&lt;code&gt;wait&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ˜¯ç¨‹åº&lt;code&gt;shell.c&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;unistd.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;
&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;sys/wait.h&amp;gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Welcome to my shell&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;gt; &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;fgets&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="mi"&gt;-1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sc"&gt;&amp;#39;\0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// strip \n&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;strcmp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;exit&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;// shell built-in&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;fork&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Executing: %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;execlp&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;-1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ERROR!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;exit&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;waitpid&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;pid&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;Child exited with %d&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;WEXITSTATUS&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;status&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;ERROR!&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç¼–è¯‘ç¨‹åºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;gcc shell.c -o shell
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¥ç€è¿è¡Œï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./shell
Welcome to my shell
&amp;gt; date
Executing: date
Thu Dec  1 14:10:59 UTC 2016
Child exited with 0
&amp;gt; true
Executing: true
Child exited with 0
&amp;gt; false
Executing: false
Child exited with 1
&amp;gt; exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸ºä»€ä¹ˆè¿è¡Œä¸€ä¸ªåå°ç¨‹åºçš„æ—¶å€™ï¼Œåªèƒ½åœ¨ä½ æŒ‰ä¸‹&lt;code&gt;Enter&lt;/code&gt;ä¹‹åä¸€ä¼šæ‰èƒ½çœ‹åˆ°å®ƒé€€å‡ºäº†ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ sleep 1 &amp;amp;
[1] 11686
$ # press Enter
[1]+  Done                    sleep 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™æ˜¯å› ä¸ºshell ä¸€ç›´å”‰ç­‰å¾…ä½ çš„è¾“å…¥ã€‚åªæœ‰å½“ä½ è¾“å…¥ä¸€ä¸ªå‘½ä»¤ä¹‹åï¼Œå®ƒæ‰ä¼šæ£€æŸ¥åå°ç¨‹åºçš„çŠ¶æ€ï¼Œå¦‚æœå®ƒä»¬ç»ˆæ­¢äº†å°±ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚&lt;/p&gt;
&lt;h2&gt;TODO&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯æˆ‘è¿˜æƒ³è¦äº†è§£çš„æ›´åŠ è¯¦ç»†çš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;process state substatuses (&lt;code&gt;Ss&lt;/code&gt;, &lt;code&gt;Ss+&lt;/code&gt;, &lt;code&gt;R+&lt;/code&gt;, etc.)&lt;/li&gt;
&lt;li&gt;kernel threads&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/dev/pts&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;more about memory (&lt;code&gt;CODE&lt;/code&gt;, &lt;code&gt;DATA&lt;/code&gt;, &lt;code&gt;SWAP&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;figure out time slices length&lt;/li&gt;
&lt;li&gt;Linux scheduler algorithm&lt;/li&gt;
&lt;li&gt;pinning proceses to cores&lt;/li&gt;
&lt;li&gt;write about manual pages&lt;/li&gt;
&lt;li&gt;cpu/memory colors in bars&lt;/li&gt;
&lt;li&gt;process ID limit &amp;amp; fork bomb&lt;/li&gt;
&lt;li&gt;&lt;code&gt;lsof&lt;/code&gt;, &lt;code&gt;ionice&lt;/code&gt;, &lt;code&gt;schedtool&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ›´æ–°&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯æ–‡ç« è‡ªå‘å¸ƒä»¥æ¥è¾ƒå¤§çš„æ›´æ­£å’Œæ›´æ–°åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Idle time in &lt;code&gt;/proc/uptime&lt;/code&gt; is the sum of all cores (Dec 2, 2016)&lt;/li&gt;
&lt;li&gt;My parent/child &lt;code&gt;printf&lt;/code&gt; in &lt;code&gt;zombie.c&lt;/code&gt; was reversed (Dec 2, 2016)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;apt remove cron&lt;/code&gt; installs &lt;code&gt;postfix&lt;/code&gt; because of a dependency to an MTA (Dec 3, 2016)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;id&lt;/code&gt; can load information from other sources (via &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt;), not just &lt;code&gt;/etc/passwd&lt;/code&gt; (Dec 3, 2016)&lt;/li&gt;
&lt;li&gt;Describe &lt;code&gt;/etc/shadow&lt;/code&gt; password hash format (Dec 3, 2016)&lt;/li&gt;
&lt;li&gt;Use &lt;code&gt;visudo&lt;/code&gt; to edit the &lt;code&gt;/etc/sudoers&lt;/code&gt; file to be safe (Dec 3, 2016)&lt;/li&gt;
&lt;li&gt;Explain &lt;code&gt;MEM%&lt;/code&gt; (Dec 3, 2016)&lt;/li&gt;
&lt;li&gt;Rewrite the section about load averages (Dec 4, 2016)&lt;/li&gt;
&lt;li&gt;Fix: &lt;code&gt;kill 1234&lt;/code&gt; by default sends &lt;code&gt;TERM&lt;/code&gt; not &lt;code&gt;INT&lt;/code&gt; (Dec 7, 2016)&lt;/li&gt;
&lt;li&gt;Explain CPU and memory color bars (Dec 7, 2016)&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;åè®°&lt;/h2&gt;
&lt;p&gt;å¦‚æœè¿™ç¯‡æ–‡ç« æœ‰é”™è¯¯è¯·è®©æˆ‘çŸ¥é“ï¼æˆ‘å¾ˆä¹æ„æ›´æ­£å®ƒã€‚&lt;/p&gt;</content><category term="2017"></category><category term="htop"></category><category term="linux"></category></entry><entry><title>ã€Šæå®¢ä¸å›¢é˜Ÿã€‹è¯»ä¹¦ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2017/2017-01-28.html" rel="alternate"></link><published>2017-01-28T20:00:30+08:00</published><updated>2017-01-28T20:00:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-01-28:/posts/2017/2017-01-28.html</id><summary type="html">&lt;p&gt;&lt;img alt="team_geek_cover" src="/assets/images/2023/20230302132558.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://book.douban.com/subject/21372237/"&gt;ã€Šæå®¢ä¸å›¢é˜Ÿã€‹&lt;/a&gt;è¿™æœ¬ä¹¦æ˜¯åœ¨çœ‹&lt;a href="https://blog.youxu.info/2015/05/17/tech-lead-1/"&gt;ã€ŠæŠ€æœ¯ç®¡ç†çŒªé¸¡-1 å¼€ç¯‡ã€‹&lt;/a&gt;æ³¨æ„åˆ°çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Google çš„èŠåŠ å“¥ office æœ‰ä¸¤ä¸ªæŠ€æœ¯é¢†å¯¼ï¼šBrian Fitzpatrick å’Œ Ben Collins-Sussmanã€‚ä»–ä»¬åˆå†™äº†ä¸€æœ¬ä¹¦ â€¦&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="team_geek_cover" src="/assets/images/2023/20230302132558.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://book.douban.com/subject/21372237/"&gt;ã€Šæå®¢ä¸å›¢é˜Ÿã€‹&lt;/a&gt;è¿™æœ¬ä¹¦æ˜¯åœ¨çœ‹&lt;a href="https://blog.youxu.info/2015/05/17/tech-lead-1/"&gt;ã€ŠæŠ€æœ¯ç®¡ç†çŒªé¸¡-1 å¼€ç¯‡ã€‹&lt;/a&gt;æ³¨æ„åˆ°çš„ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Google çš„èŠåŠ å“¥ office æœ‰ä¸¤ä¸ªæŠ€æœ¯é¢†å¯¼ï¼šBrian Fitzpatrick å’Œ Ben Collins-Sussmanã€‚ä»–ä»¬åˆå†™äº†ä¸€æœ¬ä¹¦ï¼Œå«åš Team Geekã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æœ¬ä¹¦çš„å‰¯æ ‡é¢˜æ˜¯â€œè½¯ä»¶å·¥ç¨‹å¸ˆçš„å›¢é˜Ÿç”Ÿå­˜ç§˜ç¬ˆâ€ï¼Œæ¯•ä¸šä¸€å¹´è®¤è¯†åˆ°å’ŒåŒäº‹åˆä½œã€å¦‚ä½•æ›´é«˜æ•ˆçš„æ¨è¿›å·¥ä½œä¹Ÿååˆ†é‡è¦ï¼Œæ­£å¦‚ä½œè€…åœ¨ä¹¦ä¸€å¼€å§‹æåˆ°äº†ä¹¦çš„å®—æ—¨ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ¬ä¹¦æ—¨åœ¨å¸®åŠ©ç¨‹åºå‘˜æ”¹è¿›ç†è§£ä»–äººã€ä¸äººæ²Ÿé€šï¼Œä»¥åŠä¸äººåˆä½œçš„èƒ½åŠ›ï¼Œè¿›è€Œä½¿å…¶åœ¨ç¼–å†™è½¯ä»¶çš„è¿‡ç¨‹ä¸­å˜çš„æ›´æœ‰æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™æœ¬ä¹¦çš„æ ¸å¿ƒæ˜¯â€œHRTâ€ï¼Œå³â€œè°¦è™šâ€ï¼Œâ€œå°Šé‡â€ï¼Œâ€œä¿¡ä»»â€ï¼Œä¸ç®—æ˜¯ä»€ä¹ˆç§˜è¯€ï¼Œä½†å´éå¸¸éš¾åšåˆ°ï¼Œä¸€éè¯»ï¼Œä¸€éæƒ³ç€å·¥ä½œä¸­çš„ä¸€å¹•å¹•ï¼Œæ„Ÿæ…¨è‰¯å¤šï¼Œå¸Œæœ›èƒ½åœ¨é˜…è¯»å®Œè¿™æœ¬ä¹¦ä¹‹åï¼Œåœ¨ä¸‹ä¸€ä»½å·¥ä½œä¸­æœ‰æ›´å¥½çš„è¡¨ç°å§ã€‚&lt;br&gt;
æŠŠä¹¦ä¸­çš„å†…å®¹è¦ç‚¹ï¼Œä»¥åŠä¸€äº›éšæƒ³ç®€å•çš„è®°å½•å¦‚ä¸‹ï¼Œæ–¹ä¾¿æ—¥åæŸ¥é˜…ã€‚  &lt;/p&gt;
&lt;h2&gt;æ³¨é‡å›¢é˜Ÿåˆä½œå’Œåˆ†äº«&lt;/h2&gt;
&lt;p&gt;å…¬å¼€é€æ˜å’Œä¿¡ä»»å¯ä»¥æå¤§çš„é™ä½æˆæœ¬ï¼Œä»¥åŠå¼ºåŒ–å…¬è½¦å› å­ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å…¬è½¦å› å­ï¼šï¼šä¸€ä¸ªé¡¹ç›®é‡Œï¼Œéœ€è¦æœ‰å¤šå°‘ä¸ªäººè¢«å…¬äº¤è½¦æ’åˆ°æ‰èƒ½ä»¤å…¶å®Œå…¨ç˜«ç—ªã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‰©å¤§â€œå…¬è½¦å› å­â€ï¼Œé¿å…å‡ºç°é¢†åœ°æ„Ÿã€‚&lt;/p&gt;
&lt;p&gt;åˆ†äº«åä½œï¼Œç„¶åæœ‰è‰¯å¥½çš„æ–‡æ¡£ç§¯ç´¯ï¼Œå¯ä»¥è®©å•ä¸ªäººå…äºå››å¤„æ•‘ç«ï¼Œæƒ³èµ·äº†&lt;a href="https://book.douban.com/subject/26644070/"&gt;ã€Šå‡¤å‡°é¡¹ç›®ã€‹&lt;/a&gt;é‡Œçš„è¶…çº§å‘˜å·¥â€œå¸ƒä¼¦ç‰¹â€ã€‚å¦å¤–å›¢é˜Ÿåˆä½œå¸¦æ¥çš„è£èª‰æ„Ÿå’Œæ¿€åŠ±ä½œç”¨ä¹Ÿéå¸¸å¤§ï¼Œè¿‡å»ä¸€å¹´çš„å·¥ä½œæ‰€åœ¨çš„å›¢é˜Ÿå¹¶æ²¡æœ‰è®©æˆ‘æœ‰è¿™ç§æ„Ÿè§‰ã€‚&lt;/p&gt;
&lt;h2&gt;ä¸‰æ”¯æŸ±ï¼ˆHRTï¼‰ï¼šè°¦è™šï¼Œå°Šé‡ï¼Œä¿¡ä»»&lt;/h2&gt;
&lt;p&gt;è°¦è™š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ²¡æœ‰äººæ˜¯å®‡å®™ä¸­å¿ƒã€‚è°ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œè°éƒ½ä¼šçŠ¯é”™ã€‚ä½ å¿…é¡»ä¸æ–­åœ°æé«˜è‡ªå·±ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å°Šé‡&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä½ å¿…é¡»çœŸå¿ƒå®æ„åœ°å…³å¿ƒåŒäº‹ã€‚ä»–ä»¬éƒ½æ˜¯æ´»ç”Ÿç”Ÿçš„äººï¼Œä»–ä»¬çš„èƒ½åŠ›å’Œæˆç»©éƒ½éœ€è¦å¾—åˆ°è‚¯å®šã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¿¡ä»»&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¦ç›¸ä¿¡åˆ«äººçš„èƒ½åŠ›å’Œåˆ¤æ–­åŠ›ï¼Œåœ¨é€‚å½“çš„æ—¶å€™æ‡‚å¾—æ”¾æƒã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img alt="HRT" src="/assets/images/2023/20230301171735.png"&gt;&lt;/p&gt;
&lt;h3&gt;HRT å®æˆ˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ”¾ä¸‹è‡ªè´Ÿ&lt;/li&gt;
&lt;li&gt;å­¦ä¼šæ‰¹è¯„å’Œæ¥å—æ‰¹è¯„&lt;ul&gt;
&lt;li&gt;â€œåˆ«æŠŠä½ çš„è‡ªå°Šå’Œä½ çš„ä»£ç ç­‰åŒèµ·æ¥â€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¿«é€Ÿå¤±è´¥ï¼›å­¦ä¹ ï¼›è¿­ä»£&lt;ul&gt;
&lt;li&gt;â€œå¤±è´¥æ˜¯å¯ä»¥æ¥å—çš„â€&lt;/li&gt;
&lt;li&gt;â€œä¸è¦ç­‰åˆ°å®Œç¾çš„æ—¶å€™å†å‡ºæ¥â€&lt;/li&gt;
&lt;li&gt;â€œçœŸæ­£çš„æ£€è®¨åº”è¯¥åŒ…å«æœ‰å…³å­¦åˆ°äº†ä»€ä¹ˆï¼Œä»¥åŠæ€ä¹ˆæ”¹æ­£ç­‰ç»éªŒæ•™è®­çš„è¯¦ç»†æ³¨è§£â€ï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åæŸ¥çœ‹ï¼Œå’Œæ€»ç»“ç§¯ç´¯ç»éªŒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸ºå­¦ä¹ é¢„ç•™æ—¶é—´&lt;/li&gt;
&lt;li&gt;å­¦ä¹ ä¿æŒè€å¿ƒ&lt;/li&gt;
&lt;li&gt;å¯¹å½±å“ä¿æŒå¼€æ”¾çš„æ€åº¦&lt;ul&gt;
&lt;li&gt;â€œä½ è¶Šæ˜¯å®¹æ˜“å—å½±å“ï¼Œä½ å°±è¶Šèƒ½å½±å“åˆ«äººï¼›ä½ è¶Šæ˜¯ç¤ºå¼±ï¼Œä½ å°±è¶Šå¼ºå£®â€&lt;/li&gt;
&lt;li&gt;â€œåŒäº‹æ˜¯åˆä½œè€…ï¼Œä¸æ˜¯ç«äº‰è€…â€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;å›¢é˜Ÿæ–‡åŒ–&lt;/h2&gt;
&lt;p&gt;ä½œè€…åœ¨è¿™é‡Œè¯´çš„æ–‡åŒ–ï¼Œå…¶å®æ›´åƒä¸€ç§å›¢é˜Ÿæ°›å›´ï¼Œä»¥åŠå›¢é˜Ÿå†…å½¢æˆçš„é»˜å¥‘ï¼Œè€Œä¸æ˜¯é˜¿é‡Œé‚£ç§å¼ºä»·å€¼è§‚çš„æ–‡åŒ–ã€‚å¥½çš„æ–‡åŒ–å¯ä»¥è–°é™¶æ–°äººï¼Œè®©å›¢é˜Ÿå¥åº·çš„è¿ä½œï¼Œæœ€ç»ˆçš„ç›®çš„éƒ½æ˜¯å¸¦æ¥æ›´é«˜æ•ˆçš„äº§å‡ºã€‚&lt;/p&gt;
&lt;p&gt;â€œå¦‚æœä½ æƒ³è¦ä¼˜ç§€çš„å·¥ç¨‹å¸ˆä¸ºè‡ªå·±çš„å›¢é˜Ÿå·¥ä½œï¼Œé¦–å…ˆçš„å°±æ˜¯é›‡ä½£å‡ºè‰²çš„å·¥ç¨‹å¸ˆâ€ï¼Œä¼˜ç§€çš„äººæ€»æ˜¯å€¾å‘äºå’Œä¼˜ç§€çš„äººä¸€èµ·å·¥ä½œï¼Œèƒ½å¤Ÿä¿æŒæ›´å¥½çš„èŠ‚å¥ï¼Œä¹Ÿæ›´å¥½æ²Ÿé€šï¼Œä¹Ÿå¸¸å¸¸è§åˆ°åŠ£å¸é©±é€è‰¯å¸çš„æƒ…å†µã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜ç§€çš„äººï¼Œå¤§å¤šæ•°éƒ½å¾ˆæœ‰ä¸»è§å’Œæƒ³æ³•ï¼Œå¯ä»¥è¯´æ˜¯æ¯”è¾ƒéš¾â€œç®¡ç†â€ï¼Œä¸€ç¾¤å¹³åº¸ã€æº·æ—¥å­çš„äººå¥½ç®¡ç†ï¼Œä½†æ˜¯æ¯«æ— æˆ˜æ–—åŠ›ã€‚â€œåŸºäºå…±è¯†å†³ç­–çš„å›¢é˜Ÿâ€ï¼Œæ˜¯è®©å›¢é˜Ÿæˆå‘˜éƒ½æœ‰ä¸»äººç¿ç²¾ç¥å’Œè´£ä»»æ„Ÿï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¥½çš„TeamLeaderä¸ä¼šæ‹…å¿ƒè‡ªå·±çš„åœ°ä½å—åˆ°å¨èƒï¼Œè€Œåº”è¯¥æ³¨é‡å›¢ç»“ï¼Œå’Œå€¾å¬æ„è§ã€‚&lt;/p&gt;
&lt;h3&gt;å¯¹ä»˜å®³ç¾¤ä¹‹é©¬&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯ç¬¬å››ç« çš„å†…å®¹ï¼Œä½†æ˜¯ä½œè€…åœ¨å›¢é˜Ÿæ–‡åŒ–è¿™ç« æåˆ°äº†ï¼Œå°±ç»™æ€»ç»“åˆ°ä¸€èµ·äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¦å‰”èµ°çš„æ˜¯è¡Œä¸ºæœ¬èº«ï¼Œè€Œä¸æ˜¯äººã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;å®³ç¾¤ä¹‹é©¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å°Šé‡åˆ«äººçš„æ—¶é—´&lt;/li&gt;
&lt;li&gt;è‡ªè´Ÿ&lt;/li&gt;
&lt;li&gt;è¿‡åˆ†ç´¢æ±‚&lt;/li&gt;
&lt;li&gt;å¹¼ç¨šæˆ–è€…è«åå…¶å¦™çš„åæ‰§å¦„æƒ³&lt;/li&gt;
&lt;li&gt;å®Œç¾ä¸»ä¹‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€äº›è§£å†³æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è½¬ç§»å®Œç¾ä¸»ä¹‰è€…çš„æ³¨æ„åŠ›&lt;/li&gt;
&lt;li&gt;åˆ«å»æ­ç†æŒ‘è¡…çš„å®¶ä¼™ï¼Œæ— è§†æ˜¯æœ€å¥½çš„åŠæ³•&lt;/li&gt;
&lt;li&gt;åˆ«å¤ªæ„Ÿæƒ…ç”¨äº‹&lt;/li&gt;
&lt;li&gt;æŠ“ä½é‡ç‚¹å¤„ç†é—®é¢˜&lt;/li&gt;
&lt;li&gt;å¯¹ä»˜æŒ‘è¡…è¦ä¸å‘ä¸äº¢&lt;/li&gt;
&lt;li&gt;çŸ¥é“ä»€ä¹ˆåº”è¯¥æ”¾å¼ƒ&lt;/li&gt;
&lt;li&gt;å…³æ³¨é•¿è¿œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸€éƒ¨åˆ†è¿˜æ˜¯éœ€è¦çœ‹ä¹¦ä¸­çš„è¯¦ç»†è§£é‡Šæ‰å¥½å›é¡¾ï¼Œåªçœ‹è¿™äº›æœ‰äº›å®½æ³›ã€‚&lt;/p&gt;
&lt;h3&gt;æ²Ÿé€š&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;â€œæ²Ÿé€šçš„æŒ‡å¯¼åŸåˆ™ä¹‹ä¸€å°±æ˜¯åœ¨åŒæ­¥æ²Ÿé€šçš„æ—¶å€™ï¼ˆæ¯”å¦‚å¼€ä¼šï¼‰ï¼Œäººè¶Šå°‘è¶Šå¥½ã€‚è€Œåœ¨å¼‚æ­¥æ²Ÿé€šçš„æ—¶å€™ï¼ˆæ¯”å¦‚E-mailï¼‰ï¼Œæ¶‰åŠçš„å¬ä¼—è¶Šå¤šè¶Šå¥½ã€‚â€&lt;/strong&gt;&lt;br&gt;
æ›´é‡è¦çš„æ˜¯ï¼Œä½ å¿…é¡»ç¡®ä¿æ–‡æ¡£é‡Œçš„ä¿¡æ¯è¦å°½å¯èƒ½åœ°è®©æ‰€æœ‰äººéƒ½çœ‹åˆ°ã€‚  &lt;/p&gt;
&lt;p&gt;æƒ³èµ·ä¹‹å‰ä¸€ä»½å·¥ä½œï¼Œå…¬å¸å¼ºçƒˆä¾èµ–IM å·¥å…·ï¼Œä¸èƒœå…¶æ‰°ã€‚è€Œä¸”æŸäº›é¢†å¯¼ä¸€ç‚¹å°äº‹å°±å–œæ¬¢å¼€ä¸ªä¼šï¼Œâ€œèŠä¸€ä¸‹â€ï¼Œç„¶åä¸€éƒ¨åˆ†äººæ”¾ä¸‹æ‰‹å¤´å·¥ä½œå»äº†ä¹‹åï¼Œåªæ˜¯ç«™äº†å‡ ååˆ†é’Ÿï¼Œå›æ¥è¿˜å¾—æ‹¿èµ·åˆšåˆšæ”¾ä¸‹çš„äº‹æƒ…ï¼Œéå¸¸è¦å‘½ã€‚&lt;/p&gt;
&lt;h3&gt;é«˜å±‚é¢åŒæ­¥&lt;/h3&gt;
&lt;p&gt;åˆ¶å®šä»»åŠ¡å®—æ—¨ï¼Œå‡†ç¡®å®šä¹‰äº§å“çš„æ–¹å‘å’ŒèŒƒå›´ï¼Œè¿™æ ·å¤§å®¶çŸ¥é“åŠªåŠ›æ–¹å‘ï¼ŒåŒæ—¶å‡ºç°åˆ†æ­§çš„æ—¶å€™ï¼Œç»“æœèƒ½å¤Ÿæ›´å¥½çš„è¾¾æˆä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;å¼€ä¼šè¦æœ‰æ•ˆç‡,å¼€ä¼šçš„äº”æ¡å°è´´å£«&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åªé‚€è¯·ä¸€å®šè¦å‚åŠ çš„äºº&lt;/li&gt;
&lt;li&gt;å¼€ä¼šå‰è¦å†³å®šå¥½è®®ç¨‹ï¼Œè€Œä¸”è¦äº‹å…ˆé€šçŸ¥æ‰€æœ‰äºº&lt;/li&gt;
&lt;li&gt;è¾¾æˆç›®çš„ååº”è¯¥ææ—©æ•£ä¼š&lt;/li&gt;
&lt;li&gt;æ³¨æ„åˆ«è·‘é¢˜&lt;/li&gt;
&lt;li&gt;é•œåƒå¸ä¼šè®®å®‰æ’åœ¨ä¼‘æ¯æ—¶é—´å‰åï¼ˆæ¯”å¦‚åˆé¥­æ—¶é—´ï¼Œä¸‹ç­å‰ç­‰ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿œç¨‹å›¢é˜Ÿè¦å¤šæ²Ÿé€šï¼ŒåŒæ—¶ä¹Ÿè¦å‹‡äºè§é¢&lt;/p&gt;
&lt;p&gt;æ³¨é‡æ–‡æ¡£çš„ç¼–å†™å’Œç§¯ç´¯&lt;/p&gt;
&lt;hr&gt;
&lt;h3&gt;æ—¥å¸¸æ²Ÿé€š&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é‚®ä»¶åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;åœ¨çº¿èŠå¤©&lt;ul&gt;
&lt;li&gt;å°½é‡ç¾¤èŠ&lt;/li&gt;
&lt;li&gt;èŠå¤©è®°å½•å¯æ£€ç´¢&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ä½¿ç”¨Bug è·Ÿè¸ªç³»ç»Ÿ&lt;/h3&gt;
&lt;h3&gt;ä»£ç æ³¨é‡Š&lt;/h3&gt;
&lt;p&gt;â€œæ³¨é‡Šåº”è¯¥å°½é‡è§£é‡Šä¸ºä»€ä¹ˆä»£ç è¦é‚£ä¹ˆå†™ï¼Œè€Œä¸æ˜¯å»è§£é‡Šä»£ç åšäº†ä»€ä¹ˆâ€ï¼Œâ€œæ³¨é‡Šä¸åº”è¯¥æ¶‰åŠè¿‡å¤šç»†èŠ‚â€ï¼Œâ€œè¿‡çŠ¹ä¸åŠâ€ã€‚&lt;/p&gt;
&lt;h3&gt;ä»£ç ç½²å&lt;/h3&gt;
&lt;p&gt;ä½œè€…ä¸å»ºè®®åœ¨ä»£ç ä¸­è¿›è¡Œç½²åï¼Œæ›´å¥½çš„æ–¹å¼åº”è¯¥æ˜¯é€šè¿‡ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œåœ¨é‡Œé¢è¿›è¡Œè·Ÿè¸ªï¼Œä¾‹å¦‚gitã€‚&lt;br&gt;
ä¹‹å‰å·¥ä½œä¸­ï¼Œéœ€è¦å†™å¾ˆå¤šç›‘æ§è„šæœ¬ï¼Œä¸ºäº†ä»¥åæ‰¾åˆ°å¯¹åº”çš„è´Ÿè´£äººï¼Œä¼šåœ¨è„šæœ¬å¼€å¤´ç½²åï¼Œä¸è¿‡å¦‚æœå½“åˆå¤§å®¶é€šè¿‡git åä½œçš„è¯ï¼Œå°±æ²¡è¿™ä¸ªå¿…è¦äº†ã€‚&lt;/p&gt;
&lt;h3&gt;ä»£ç å®¡æŸ¥&lt;/h3&gt;
&lt;p&gt;â€œä»£ç æ”¹åŠ¨åº”è¯¥å°½é‡çŸ­å°ä»¥ä¿è¯å®¡æŸ¥çš„è´¨é‡ã€‚â€&lt;/p&gt;
&lt;h3&gt;æµ‹è¯•å’Œå‘å¸ƒ&lt;/h3&gt;
&lt;p&gt;æµ‹è¯•å’Œå‘å¸ƒæµç¨‹åº”è¯¥å°½å¯èƒ½çš„è‡ªåŠ¨åŒ–ï¼Œæµ‹è¯•è‡ªåŠ¨åŒ–ç¨‹åº¦è¶Šé«˜ï¼Œâ€œåœ¨ä¿®å¤bug å’Œæ·»åŠ æ–°ç‰¹æ€§çš„æ—¶å€™å°±è¶Šè‡ªä¿¡â€ï¼Œä¹Ÿå®¹æ˜“æ›´æ—©å¾—å‘ç°é—®é¢˜ã€‚å‘å¸ƒæµç¨‹è¶Šè‡ªåŠ¨ï¼Œè¶Šæµç•…å¿«é€Ÿï¼Œå¯ä»¥è®©äº§å“è¿­ä»£å¾—è¶Šå¿«ã€‚&lt;/p&gt;
&lt;h2&gt;å›¢é˜Ÿä¸»ç®¡&lt;/h2&gt;
&lt;p&gt;â€œä¼ ç»Ÿå‹ç»ç†å…³å¿ƒçš„æ˜¯æ€ä¹ˆå®Œæˆä»»åŠ¡ï¼Œè€Œä¸»ç®¡åªå…³å¿ƒå®Œæˆäº†ä»€ä¹ˆä»»ã€‚ã€‚ã€‚ã€‚ï¼ˆå¹¶ä¸”ç›¸ä¿¡å›¢é˜Ÿèƒ½è‡ªå·±æƒ³å‡ºè§£å†³æ–¹æ³•ï¼‰ã€‚â€ï¼Œä¸»ç®¡åªéœ€è¦è´Ÿè´£è®¾å®šå¤§æ–¹å‘ï¼Œè¿™ä¹Ÿæ˜¯â€œä¿¡ä»»â€çš„ä¸€ç§è¡¨ç°ã€‚&lt;/p&gt;
&lt;h3&gt;ä»†äººå¼é¢†å¯¼&lt;/h3&gt;
&lt;p&gt;â€œä»†äººå¼é¢†å¯¼è¦ä¸ºå›¢é˜Ÿå¡«è¡¥å‰è¿›é“è·¯ä¸Šçš„è£‚ç¼ï¼Œå¹¶åœ¨å¿…è¦çš„æ—¶å€™ç»™äºˆå»ºè®®ï¼ŒåŒæ—¶è¿˜è¦å‹‡äºå†²åˆ°ç¬¬ä¸€çº¿ã€‚ä»†äººå¼é¢†å¯¼å”¯ä¸€è¦åšçš„ç®¡ç†å·¥ç¨‹å¸ˆå°±æ˜¯å¯¹å›¢é˜Ÿçš„æŠ€æœ¯å’Œäººäº‹å¥åº·æƒ…å†µè´Ÿè´£ã€‚â€&lt;/p&gt;
&lt;h3&gt;åæ¨¡å¼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;é›‡ä½£å¬è¯çš„äºº&lt;/li&gt;
&lt;li&gt;æ— è§†è¡¨ç°ä¸ä½³çš„äºº&lt;/li&gt;
&lt;li&gt;æ— è§†äººé™…å…³ç³»&lt;/li&gt;
&lt;li&gt;å’Œè°éƒ½æ˜¯æœ‹å‹&lt;/li&gt;
&lt;li&gt;é™ä½æ‹›è˜æ ‡å‡†&lt;/li&gt;
&lt;li&gt;æŠŠå›¢é˜Ÿå½“å°å­©å­&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;é¢†è¢–çš„å¤„äº‹ä¹‹é“&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æ”¾ä¸‹è‡ªè´Ÿ&lt;ul&gt;
&lt;li&gt;â€œå¦‚æœä½ èƒ½é¼“åŠ±è¿™ç§æé—®ï¼Œä½ æ‰èƒ½æœ‰æ›´å¤šçš„æœºä¼šå¬åˆ°è°è¨€ï¼Œè¿™èƒ½è®©ä½ æˆä¸ºä¸€ä¸ªæ›´å¥½çš„é¢†è¢–ï¼Œå›¢é˜Ÿä¹Ÿä¼šå˜å¾—æ›´åŠ æˆåŠŸâ€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åšä¸€ä¸ªç¦…å¸ˆ&lt;/li&gt;
&lt;li&gt;ä¿æŒæ¾¹å®šå’Œå†·é™&lt;/li&gt;
&lt;li&gt;â€œå·¥ç¨‹å¸ˆæ¥é—®ä½ å»ºè®®é€šå¸¸æ˜¯ä¸æ˜¯ä½ å»è§£å†³ä»–çš„é—®é¢˜ï¼Œè€Œæ˜¯è¦ä½ å¸®åŠ©ä»–è§£å†³é—®é¢˜ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ–¹æ³•åº”è¯¥æ˜¯é—®é—®é¢˜â€ï¼Œâ€œæ­£ç¡®çš„åšæ³•æ˜¯åœ¨HRT çš„åŸåˆ™ä¸‹ï¼Œå¸®åŠ©ä»–è§£å†³åˆ†æé—®é¢˜ï¼Œä»è€Œè¾¾åˆ°è®©ä»–è‡ªå·±è§£å†³é—®é¢˜çš„ç›®çš„â€ï¼Œâ€œè¿™é€šå¸¸èƒ½å¼•å¯¼å·¥ç¨‹å¸ˆå¾—å‡ºç­”æ¡‰ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œè¿™æ˜¯ä»–è‡ªå·±æƒ³å‡ºæ¥çš„ç­”æ¡‰ï¼Œå› ä¸ºä¹Ÿå°±å›åˆ°äº†æœ¬ç« å¼€å¤´æ‰€è®²çš„ä¸»äººç¿ç²¾ç¥å’Œè´£ä»»æ„Ÿã€‚â€&lt;/li&gt;
&lt;li&gt;æˆä¸ºå‚¬åŒ–å‰‚&lt;/li&gt;
&lt;li&gt;å¼•å¯¼å¤§å®¶è¾¾æˆå…±è¯†&lt;/li&gt;
&lt;li&gt;ç»™äºˆå›¢é˜Ÿå®‰å…¨æ„Ÿ&lt;/li&gt;
&lt;li&gt;â€œåœ¨é­å—å¤±è´¥çš„æ—¶å€™æŒ‡è´£ä¸ªäººåˆ™ä¸åˆ©å›¢é˜Ÿï¼Œè€Œä¸”ä¼šä»æ ¹æœ¬ä¸Šé˜»ç¢æ‰¿æ‹…é£é™©çš„æ„æ„¿â€ï¼Œâ€œä¸ªäººçš„æˆåŠŸå¯ä»¥åœ¨ä¼—äººé¢å‰è¡¨å½°ï¼Œä½†ä¸ªäººçš„å¤±è´¥æœ€å¥½è¿˜æ˜¯ç§ä¸‹æ£€è®¨â€ï¼Œâ€œéœ€è¦å…¬å¼€æ‰¹è¯„æŸä¸€ä¸ªäººçš„æƒ…å†µå‡ ä¹æ˜¯ä¸å­˜åœ¨çš„ï¼Œç»å¤§å¤šæ•°æ—¶å€™è¿™æ ·åšéƒ½æ˜¯å¾ˆè¿‡åˆ†ï¼Œå¾ˆæ®‹å¿çš„ã€‚å›¢é˜Ÿé‡Œçš„å…¶ä»–äººè‚¯å®šæ—©å°±çŸ¥é“è¿™ä¸ªäººæŠŠäº‹æƒ…åŠç ¸äº†ï¼Œæ‰€ä»¥å®Œå…¨æ²¡å¿…è¦é‡å¤è®²ã€‚â€ï¼Œåº”è¯¥æŠ“ä½æœºä¼šå¸®åŠ©å›¢é˜Ÿä»å¤±è´¥ä»æˆé•¿èµ·æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å½“ä¸€ä¸ªå¯¼å¸ˆ&lt;/li&gt;
&lt;li&gt;ä¸‰ä¸ªæ¡ä»¶ï¼š&lt;ul&gt;
&lt;li&gt;ç†Ÿæ‚‰å›¢é˜Ÿçš„æµç¨‹å’Œç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;å‘ä»–äººè§£é‡Šäº‹ç‰©çš„èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;ä¼°è®¡è¢«çŸ¥é“çš„äººåˆ°åº•éœ€è¦å¤šå°‘å¸®åŠ©çš„èƒ½åŠ›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¾ç½®æ˜ç¡®çš„ç›®æ ‡&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¦è¯š&lt;ul&gt;
&lt;li&gt;è­¦æƒ•ä¸‰æ˜æ²»èµç¾æ³•ï¼Œå³å…ˆèµç¾ï¼Œå†æ‰¹è¯„ï¼Œå†èµç¾ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;è®°å½•å›¢é˜Ÿçš„å¿«ä¹ç¨‹åº¦&lt;ul&gt;
&lt;li&gt;å»ºç«‹ä¿¡ä»»ï¼Œå»ºè®®ä¸€å¯¹ä¸€ä¼šè®®ç»“æŸçš„æ—¶å€™é—®â€œä½ è¿˜æœ‰ä»€ä¹ˆè¦æ±‚å—â€ï¼Œè€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„è¯‰æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;â€œç»å¯¹ä¸è¦ä»¥ä¸ºäººäººéƒ½æ˜¯å·¥ä½œç‹‚----å¯¹åˆ«äººåœ¨å·¥ä½œä¸Šèƒ½æŠ•å…¥çš„æ—¶é—´ä¸è¦æœ‰ä¸åˆ‡å®é™…çš„æœŸæœ›ã€‚å¦åˆ™å¾ˆå®¹æ˜“å¤±å»åˆ«äººå¯¹ä½ çš„å°Šæ•¬ï¼Œç”šè‡³å½»åº•ç»æœ›ã€‚â€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¸å¿…äº‹äº‹èº¬äº²ï¼Œä½†ä¹Ÿä¸èƒ½å½“ç”©æ‰‹æŒæŸœ&lt;/li&gt;
&lt;li&gt;å¯»æ‰¾æ¥ç­äºº&lt;/li&gt;
&lt;li&gt;çŸ¥é“ä»€ä¹ˆæ—¶å€™è¦åšæ¶äºº&lt;ul&gt;
&lt;li&gt;ä¸ç¬¦åˆå›¢é˜Ÿè¦æ±‚çš„äººï¼Œæ‹–çš„è¶Šä¹…ï¼Œå¯¹å›¢é˜Ÿä¼¤å®³è¶Šå¤§&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä¿æŠ¤å›¢é˜Ÿä¸å—æº·ä¹±å¹²æ‰°&lt;/li&gt;
&lt;li&gt;å¸®å›¢é˜Ÿé®é£æŒ¡é›¨  &lt;ul&gt;
&lt;li&gt;â€œåœ¨æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å°½å¯èƒ½çš„å’Œå›¢é˜Ÿåˆ†äº«ä¿¡æ¯ï¼Œä½†æ˜¯ä¹Ÿä¸è¦æŠŠé‚£äº›ä¸å¤ªå¯èƒ½ä¼šç›´æ¥å½±å“åˆ°ä»–ä»¬çš„äº‹æƒ…å‘Šè¯‰ä»–ä»¬ï¼Œè¿™ç§ç»„ç»‡æ€§çš„æº·ä¹±åªä¼šè®©ä»–ä»¬åˆ†æâ€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å‘Šè¯‰å›¢é˜Ÿä»–ä»¬å¹²å¾—å¾ˆå¥½&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;æ¿€åŠ±&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç»™å·¥ç¨‹å¸ˆä¸€ä¸ªç›®æ ‡ï¼›&lt;/li&gt;
&lt;li&gt;è®©å·¥ç¨‹å¸ˆæœ‰æœºä¼šå­¦ä¹ æ–°æŠ€æœ¯å’Œæé«˜æŠ€æœ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ“ä½œç»„ç»‡çš„è‰ºæœ¯&lt;/h2&gt;
&lt;p&gt;è¿™ä¸€ç« ä½œè€…åˆ—äº†ä¸€äº›å·¥ç¨‹å¸ˆé‡åˆ°å…·ä½“é—®é¢˜è¯¥å¦‚ä½•å¤„ç†ï¼ŒèŠ‚é€‰å‡ å¥å°è±¡æ·±åˆ»çš„è¯ã€‚&lt;/p&gt;
&lt;p&gt;â€œè¦å°½å¯èƒ½ç¡®ä¿ä½ çš„ç»ç†ä»¥åŠå›¢é˜Ÿä¹‹å¤–çš„äººä¸ä½†çŸ¥é“ä½ åœ¨å¹²å˜›ï¼Œè¿˜è¦çŸ¥é“ä½ å¹²çš„å¾ˆæ£’â€&lt;/p&gt;
&lt;p&gt;â€œåœ¨åšæ‰¿è¯ºçš„æ—¶å€™è¦è°¨æ…ï¼Œè€Œå¹²å·¥ä½œçš„æ—¶å€™è¦å°½æœ€å¤§åŠªåŠ›â€&lt;/p&gt;
&lt;p&gt;â€œä¸ç®¡æŠ€æœ¯å€ºåŠ¡æœ‰å¤šå°‘ï¼Œå›¢é˜Ÿä¹Ÿæ°¸è¿œä¸åº”è¯¥èŠ±è¶…è¿‡ä¸‰åˆ†ä¹‹ä¸€ç”šè‡³ä¸€åŠçš„æ—¶é—´å’Œç²¾åŠ›å»åšé˜²å¾¡æ€§çš„å·¥ä½œï¼Œå¦åˆ™å°±ç­‰äºæ”¿æ²»è‡ªæ€â€&lt;/p&gt;
&lt;p&gt;å†™é‚®ä»¶æ±‚åŠ©è¦é‡‡ç”¨â€œä¸‰ä¸ªè®ºç‚¹å’Œä¸€ä¸ªè¡ŒåŠ¨â€ï¼Œç»å¯¹ä¸èƒ½æœ‰å…¶ä»–å†…å®¹ï¼Œè®©ä»–äººèƒ½åœ¨10ç§’å†…è¯»å®Œã€‚&lt;/p&gt;
&lt;h2&gt;å’Œç”¨æˆ·çš„å…³ç³»&lt;/h2&gt;
&lt;p&gt;è½¯ä»¶è¦æœåŠ¡çš„æ˜¯ç”¨æˆ·ï¼Œæœ€åä¸€ç« åˆ—äº†ä¸€äº›ä¾‹å¦‚â€œè¦å¤šæ²Ÿé€šâ€ï¼Œâ€œæ³¨æ„ç¬¬ä¸€å°è±¡â€ï¼Œâ€œå…³æ³¨ç”¨æˆ·â€ï¼Œè™½ç„¶éƒ½å¾ˆæœ‰é“ç†ï¼Œæ¯”è¾ƒæ‚ä¹±ï¼Œæ˜¯ä¸€äº›ç»éªŒä¹‹è°ˆï¼Œè¯»å®Œå°±è¦ç”¨èµ·æ¥éå¸¸éš¾ã€‚&lt;/p&gt;
&lt;p&gt;æ•´æœ¬ä¹¦çš„å†…å®¹éƒ½æ˜¯å›´ç»•HRTï¼Œä¸è¿‡äººå’Œäººä¹‹é—´ï¼Œæ€»æ˜¯èƒ½å’ŒHRT æ‰¯ä¸Šå…³ç³»ã€‚
æ¯ç« çš„ç‹¬ç«‹æ€§å…¶å®ä¸æ˜¯å¾ˆå¼ºï¼Œä½œè€…åœ¨è®²å¾ˆå¤šè®ºç‚¹çš„æ—¶å€™ï¼Œä¼šç©¿æ’å…¶ä»–å†…å®¹ã€‚æ€»ä¹‹ï¼Œçœ‹å®Œä¹Ÿå¾ˆéš¾è®°ä½ï¼Œåªèƒ½è®°ä½HRTï¼Œå¥½å¥½å·¥ä½œï¼Œå¤šå®è·µã€‚&lt;/p&gt;</content><category term="2017"></category><category term="teamwork"></category><category term="book"></category></entry><entry><title>Salt Minion ID å˜ä¸ºFQDN è®°å½•çš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2017/2017-01-09.html" rel="alternate"></link><published>2017-01-09T18:31:30+08:00</published><updated>2017-01-09T18:31:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2017-01-09:/posts/2017/2017-01-09.html</id><summary type="html">&lt;p&gt;æœ€è¿‘åœ¨ä¸€å°å¤–ç½‘æœºå™¨ä¸Šèµ·äº†salt minion ï¼Œä½†æ˜¯åŒäº‹å‘ç°&lt;code&gt;/etc/salt/minion_id&lt;/code&gt; ä¸å¯¹ï¼Œä¹‹å‰è‡ªåŠ¨ç”Ÿæˆçš„minion_id éƒ½æ˜¯æœºå™¨çš„&lt;code&gt;/etc/hostname&lt;/code&gt;,è¿™å›å˜æˆäº†ä¸€ä¸ªå¥‡æ€ªçš„ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æœ€è¿‘åœ¨ä¸€å°å¤–ç½‘æœºå™¨ä¸Šèµ·äº†salt minion ï¼Œä½†æ˜¯åŒäº‹å‘ç°&lt;code&gt;/etc/salt/minion_id&lt;/code&gt; ä¸å¯¹ï¼Œä¹‹å‰è‡ªåŠ¨ç”Ÿæˆçš„minion_id éƒ½æ˜¯æœºå™¨çš„&lt;code&gt;/etc/hostname&lt;/code&gt;,è¿™å›å˜æˆäº†ä¸€ä¸ªå¥‡æ€ªçš„åŸŸåï¼š&lt;code&gt;cncXXXX.XXX.ln.cn&lt;/code&gt;ï¼Œå¹¶ä¸”è¿™ä¸ªåŸŸåå’Œä½¿ç”¨ &lt;code&gt;hostname --all-fqdns&lt;/code&gt; è¿”å›çš„ç»“æœç›¸åŒã€‚å…ˆæŸ¥ä¸‹minion_id æ˜¯æ€ä¹ˆç”Ÿæˆçš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/saltstack/salt/blob/a380c12159a3a6691081d30e33c16e6f534c4482/doc/topics/tutorials/walkthrough.rst"&gt;Github:saltstack/salt/doc/topics/tutorials/walkthrough.rst&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;When the minion is started, it will generate an id value, unless it has been generated on a previous run and cached (in /etc/salt/minion_id by default). This is the name by which the minion will attempt to authenticate to the master. The following steps are attempted, in order to try to find a value that is not localhost:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The Python function socket.getfqdn() is run&lt;/li&gt;
&lt;li&gt;/etc/hostname is checked (non-Windows only)&lt;/li&gt;
&lt;li&gt;/etc/hosts (%WINDIR%\system32\drivers\etc\hosts on Windows hosts) is checked for hostnames that map to anything within 127.0.0.0/8.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If none of the above are able to produce an id which is not localhost, then a sorted list of IP addresses on the minion (excluding any within 127.0.0.0/8) is inspected. The first publicly-routable IP address is used, if there is one. Otherwise, the first privately-routable IP address is used.&lt;/p&gt;
&lt;p&gt;If all else fails, then localhost is used as a fallback.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åº”è¯¥æ˜¯ç¬¬ä¸€ç‚¹ï¼Œé€šè¿‡&lt;code&gt;socket.getfqdn&lt;/code&gt; æ‹¿åˆ°çš„ç»“æœï¼Œä¹ŸéªŒè¯äº†å’Œä¸Šæ–‡æåˆ°çš„&lt;code&gt;hostname --all-fqdns&lt;/code&gt; æ‹¿åˆ°çš„ç»“æœä¸€æ ·ã€‚&lt;/p&gt;
&lt;h2&gt;FQDNæ˜¯ä»€ä¹ˆ?&lt;/h2&gt;
&lt;!-- more --&gt;

&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Fully_qualified_domain_name"&gt;FQDN&lt;/a&gt;å…¨ç§°æ˜¯"Fully qualified domain name",ä¸­æ–‡å«&lt;a href="https://zh.wikipedia.org/wiki/%E5%AE%8C%E6%95%B4%E7%B6%B2%E5%9F%9F%E5%90%8D%E7%A8%B1"&gt;å®Œæ•´ç½‘åŸŸåç§°&lt;/a&gt;,æ›´ç»†è‡´çš„ä»‹ç»çœ‹é¸Ÿå“¥çš„è§£é‡Š&lt;a href="http://linux.vbird.org/linux_server/0350dns.php#fqdn"&gt;å®Œæ•´ä¸»æœºåç§°ï¼š Fully Qualified Domain Name (FQDN)&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;socket.getfqdn()&lt;/h2&gt;
&lt;p&gt;çœ‹ä¸‹è¿™ä¸ªå‡½æ•°çš„å®ç°, &lt;a href="https://svn.python.org/projects/python/trunk/Lib/socket.py"&gt;socket.py&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;getfqdn&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Get fully qualified domain name from name.&lt;/span&gt;

&lt;span class="sd"&gt;    An empty argument is interpreted as meaning the local host.&lt;/span&gt;

&lt;span class="sd"&gt;    First the hostname returned by gethostbyaddr() is checked, then&lt;/span&gt;
&lt;span class="sd"&gt;    possibly existing aliases. In case no FQDN is available, hostname&lt;/span&gt;
&lt;span class="sd"&gt;    from gethostname() is returned.&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strip&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;0.0.0.0&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gethostname&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;hostname&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;aliases&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ipaddrs&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gethostbyaddr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;pass&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;aliases&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;hostname&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;aliases&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;break&lt;/span&gt;
        &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hostname&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;name&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿”å›ç»“æœåº”è¯¥æ˜¯gethostbyaddr() è¿™ä¸ªå‡½æ•°è¿”å›çš„ï¼Œè¿™ä¸ªå‡½æ•°çš„ä»‹ç»å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;gethostbyaddr() -- map an IP number or hostname to DNS info.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ‹¿åˆ°çš„ç»“æœåº”è¯¥å°±æ˜¯ä¸€ä¸ªåæŸ¥IPçš„æ—¶å€™æ‹¿åˆ°çš„&lt;a href="https://en.wikipedia.org/wiki/Reverse_DNS_lookup"&gt;PTRè®°å½•&lt;/a&gt;ã€‚è¯å®ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="salt-minion-id-dig-x" src="/assets/images/2023/20230301164133.png"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹æ¥è¿™ä¸ªIP ä¹‹å‰æœ‰äººç”¨è¿‡ï¼Œç„¶åæ·»åŠ äº†ä¸€æ¡PTR è®°å½•ï¼Œä¹Ÿæ²¡åŠæ³•åˆ äº†ï¼Œå†ç»§ç»­çœ‹çœ‹è¿™ä¸ªgethostbyaddr çš„å®ç°å’Œå·¥ä½œåŸç†ï¼Œçœ‹çœ‹èƒ½æ€ä¹ˆè§£å†³ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºè¿™ä¸ªå‡½æ•°æ›´è¯¦ç»†çš„ä»‹ç»ï¼Œæ¥è‡ª&lt;a href="https://docs.python.org/2/library/socket.html#socket.gethostbyaddr"&gt;python.org/2/library/socket&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;socket.gethostbyaddr(ip_address)&lt;/p&gt;
&lt;p&gt;Return a triple (hostname, aliaslist, ipaddrlist) where hostname is the primary host name responding to the given ip_address, aliaslist is a (possibly empty) list of alternative host names for the same address, and ipaddrlist is a list of IPv4/v6 addresses for the same interface on the same host (most likely containing only a single address). To findthe fully qualified domain name, use the function getfqdn(). gethostbyaddr() supports both IPv4 and IPv6.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è¿™ä¸ªå‡½æ•°çš„å®ç°ï¼š&lt;a href="https://github.com/python/cpython/blob/29ac8f827d040faa37cfbd5b41f3a9891056d7c1/Modules/socketmodule.c"&gt;cpython/socketmodule.c&lt;/a&gt;, åº”è¯¥æ˜¯è°ƒç”¨äº†ç³»ç»Ÿçš„gethostbyaddr_rï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€ä¸ªè‡ªå·±å®ç°çš„&lt;a href="https://github.com/python/cpython/blob/c30098c8c6014f3340a369a31df9c74bdbacc269/Modules/getaddrinfo.c"&gt;cpython/getaddrinfo.c)&lt;/a&gt;ï¼ŒLinux ç³»ç»Ÿæä¾›çš„gethostbyaddr çš„ä»‹ç»ï¼Œå®ç°ä¸Šåº”è¯¥æ˜¯ç±»ä¼¼çš„, &lt;a href="http://man7.org/linux/man-pages/man3/gethostbyaddr.3.html"&gt;GETHOSTBYNAME(3)&lt;/a&gt;, è¿™ä¸ªå‡½æ•°ä¾èµ–äº†ä¸‹åˆ—ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;/etc/host.conf
  resolver configuration file

/etc/hosts
  host database file

/etc/nsswitch.conf
  name service switch configuration
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­&lt;a href="http://man7.org/linux/man-pages/man5/nsswitch.conf.5.html"&gt;nsswitch.conf&lt;/a&gt; å®šä¹‰äº†ä¸€äº›C å‡½æ•°åº“è¿›è¡Œæ“ä½œæœç´¢çš„åŠ¨ä½œï¼Œå…ˆåé¡ºåºã€‚  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://en.wikipedia.org/wiki/Name_Service_Switch"&gt;Name Service Switch&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The Name Service Switch (NSS) is a facility in Unix-like operating systems that provides a variety of sources for
common configuration databases and name resolution mechanisms. These sources include local operating system files
(such as /etc/passwd, /etc/group, and /etc/hosts), the Domain Name System (DNS), the Network Information Service (NIS), and LDAP.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;nsswith.conf&lt;/code&gt; æ–‡ä»¶ä¸­æŒ‡å®šäº†hosts æŸ¥è¯¢çš„å…ˆåé¡ºåºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hosts       Host names and numbers, used by gethostbyname(3) and  related functions.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç›®å‰çš„é…ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#       dns                     Use DNS (Domain Name Service)
#       files                   Use the local files

#hosts:     db files nisplus nis dns
hosts:      files dns myhostname
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å‚è€ƒæ‰‹å†Œï¼ŒæŒ‰ç…§é…ç½®çš„å®šä¹‰ï¼Œå…³äºhostsï¼Œä¼šå…ˆæŸ¥filesï¼Œè€Œå¯¹äºhostsï¼Œå¯¹åº”çš„files æ˜¯/etc/hostsï¼Œç„¶åæ˜¯dns æŸ¥è¯¢ï¼Œæœ€åæ˜¯çœ‹&lt;code&gt;/etc/hostname&lt;/code&gt;ã€‚
åšä¸‹å®éªŒï¼ŒæŠŠé…ç½®æ”¹ä¸ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hosts:      files 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;socket.getfqdn()&lt;/code&gt; è¿”å›ç»“æœä¸ºç©ºã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®æ”¹æˆï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;hosts:  myhostname files dns
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;socket.getfqdn()&lt;/code&gt; è¿”å›ç»“æœä¸º&lt;code&gt;/etc/hostname&lt;/code&gt; çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;åˆ°è¿™é‡Œå¯ä»¥æ‰¾åˆ°è§£å†³æ–¹æ³•äº†ï¼ŒæŠŠæ–‡ç« å¼€å¤´å‡ºé—®é¢˜çš„è¿™å°æœºå™¨çš„&lt;code&gt;nsswitch.conf&lt;/code&gt; å¦‚ä¸Šé…ç½®ï¼Œmyhostname æ”¾åˆ°å‰é¢å³å¯è§£å†³é—®é¢˜ã€‚&lt;/p&gt;
&lt;h2&gt;hostname --all-fqdns&lt;/h2&gt;
&lt;p&gt;åœ¨è¿”å›æ¥çœ‹çœ‹ï¼Œä¸€å¼€å§‹&lt;code&gt;hostname --all-fqdns&lt;/code&gt; çš„ç»“æœå’Œ&lt;code&gt;socket.getfqdn()&lt;/code&gt; ä¸€æ ·ï¼Œå¹¶å†ä¸Šæ–‡æ›´æ”¹&lt;code&gt;nsswithc.conf&lt;/code&gt; çš„é…ç½®è¿‡ç¨‹ä¸­ï¼Œæ’ä»¶ç»“æœè¡¨ç°ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚
æ‰¾Hostname çš„&lt;a href="https://packages.debian.org/source/stable/hostname"&gt;æºä»£ç &lt;/a&gt;çœ‹ä¸‹ï¼Œ&lt;br&gt;
&lt;img alt="hostname-getnameinfo" src="/assets/images/2023/20230301164145.png"&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;getnameinfo  -  address-to-name  translation  in protocol-independent  manner&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;getnameinfo() çš„åŠŸèƒ½å’Œ gethostbyaddr() ç±»ä¼¼ï¼Œå…·ä½“è§:&lt;a href="http://man7.org/linux/man-pages/man3/getnameinfo.3.html"&gt;GETNAMEINFO(3) &lt;/a&gt;ï¼Œä¹Ÿå¯ä»¥é€šè¿‡&lt;code&gt;nsswitch.conf&lt;/code&gt; é…ç½®hosts çš„æŸ¥è¯¢é¡ºåºã€‚&lt;/p&gt;</content><category term="2017"></category><category term="saltstack"></category><category term="fqdn"></category><category term="dns"></category></entry><entry><title>HAProxy æœ€ä½³å®è·µç¬”è®°</title><link href="https://fangpsh.github.io/posts/2016/2016-12-09.html" rel="alternate"></link><published>2016-12-09T15:30:00+08:00</published><updated>2016-12-09T15:30:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-12-09:/posts/2016/2016-12-09.html</id><summary type="html">&lt;p&gt;&lt;img alt="haproxy_best_practice" src="/assets/images/2023/20230301164657.png"&gt;  &lt;/p&gt;
&lt;p&gt;è¿™ç¯‡ç¬”è®°å†…å®¹ä¸»è¦æ¥è‡ªHaproxyå®˜æ–¹å›¢é˜Ÿåˆ†äº«çš„ä¸€ä¸ªå¹»ç¯ç‰‡:&lt;a href="http://www.slideshare.net/haproxytech/haproxy-best-practice"&gt;ã€ŠHaproxy best practiceã€‹&lt;/a&gt;ï¼Œä»‹ç»äº†ä¸€äº›å¸¸è§„çš„é…ç½®æ–¹å¼å’Œä¼˜åŒ–æ‰‹æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸è¦ç›²ç›®ä½¿ç”¨æ–‡ä¸­å‡ºç°çš„æ‰€æœ‰æŠ€å·§ã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;h2&gt;Haproxy æ˜¯å¦‚ä½• â€¦&lt;/h2&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="haproxy_best_practice" src="/assets/images/2023/20230301164657.png"&gt;  &lt;/p&gt;
&lt;p&gt;è¿™ç¯‡ç¬”è®°å†…å®¹ä¸»è¦æ¥è‡ªHaproxyå®˜æ–¹å›¢é˜Ÿåˆ†äº«çš„ä¸€ä¸ªå¹»ç¯ç‰‡:&lt;a href="http://www.slideshare.net/haproxytech/haproxy-best-practice"&gt;ã€ŠHaproxy best practiceã€‹&lt;/a&gt;ï¼Œä»‹ç»äº†ä¸€äº›å¸¸è§„çš„é…ç½®æ–¹å¼å’Œä¼˜åŒ–æ‰‹æ®µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸è¦ç›²ç›®ä½¿ç”¨æ–‡ä¸­å‡ºç°çš„æ‰€æœ‰æŠ€å·§ã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;h2&gt;Haproxy æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;/h2&gt;
&lt;p&gt;å…³äºHaproxy å›¢é˜Ÿä»‹ç»ï¼Œä»¥åŠä¸€äº›ç‰¹æ€§ä»‹ç»ç›´æ¥çœ‹å‰é¢å‡ å¼ å¹»ç¯ç‰‡å³å¯ã€‚
Haproxy çš„ä¸»è¦ç”¨ä½œä»£ç†è¯·æ±‚ï¼Œå·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š&lt;br&gt;
&lt;img alt="haproxy_proxy_mode" src="/assets/images/2023/20230301164706.png"&gt;  &lt;/p&gt;
&lt;p&gt;client å’ŒHaproxy å»ºç«‹è¿æ¥ï¼ŒHaproxy å†å’Œå¯¹åº”çš„åç«¯server å»ºç«‹è¿æ¥ï¼Œç„¶åä½œä¸ºä¸­é—´äººï¼Œè½¬å‘è¯·æ±‚ã€‚
åœ¨Haproxy é…ç½®ä¸­ï¼Œå¯¹ä¸€ä¸ªä»£ç†ï¼Œä¼šåˆ’åˆ†ä¸º2å±‚ï¼Œfrontendï¼ˆå‰ç«¯ï¼‰ å’Œbackendï¼ˆåç«¯ï¼‰ï¼Œè¿™å’Œä¸Šæ–‡è¯´çš„Haproxy çš„å·¥ä½œæµç¨‹ä¹Ÿæ˜¯å¯¹åº”çš„ã€‚  &lt;/p&gt;
&lt;!-- more --&gt;
&lt;p&gt;é…ç½®ä¾‹ï¼ˆæ¥è‡ªå¹»ç¯ç‰‡ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;global
  daemon
defaults
  mode http
  timeout client 10s
  timeout connect 4s
  timeout server 30s

frontend fe
  bind 10.0.0.1:80
  bind 10.0.0.1:443 ssl crt ./my.pem
  default_backend be

backend be
  server s1 10.0.0.101:80 check
  server s2 10.0.0.102:80 check
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="haproxy_frontend_backend" src="/assets/images/2023/20230301164718.png"&gt;  &lt;/p&gt;
&lt;p&gt;frontend:ç›‘å¬ç«¯å£ã€åè®®ä»£ç†å®šä¹‰ï¼ŒHTTPè®¤è¯ï¼Œåç«¯é€‰æ‹©ç­‰ï¼›&lt;br&gt;
backend:ç›‘æ§serverï¼Œè´Ÿè½½å‡è¡¡ï¼Œé˜Ÿåˆ—ã€‚&lt;br&gt;
å¯ä»¥çœ‹å‡ºï¼Œåœ¨frontend ä¸­å®šä¹‰äº†è¦ç»‘å®šçš„åœ°å€å’Œç«¯å£ï¼Œä»¥åŠè¯ä¹¦ç­‰ï¼Œåœ¨backendï¼Œç½—åˆ—äº†åç«¯çš„IPå’Œç«¯å£ã€‚ä¸è¿‡è¦æŠŠ2è€…åˆåœ¨ä¸€èµ·å†™ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½¿ç”¨listen å³å¯ï¼Œå¦‚ä¸‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;listen http-in
    bind *:80
    server server1 127.0.0.1:8000 maxconn 32
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;A &amp;quot;frontend&amp;quot; section describes a set of listening sockets accepting client
connections.

A &amp;quot;backend&amp;quot; section describes a set of servers to which the proxy will connect
to forward incoming connections.

A &amp;quot;listen&amp;quot; section defines a complete proxy with its frontend and backend
parts combined in one section. It is generally useful for TCP-only traffic.

æ‘˜è‡ª http://www.haproxy.org/download/1.4/doc/configuration.txt
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;RTF(W|E|L)M&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é˜…è¯»ï¼ˆWarings/Errors/Logï¼‰æ¶ˆæ¯ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HAProxy ä¼šå‘stderrï¼ˆæ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰ è¾“å‡ºé…ç½®é”™è¯¯ä¿¡æ¯ï¼›&lt;ul&gt;
&lt;li&gt;å½“é…ç½®æ–‡ä»¶ä¸­å‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œwarningæ¶ˆæ¯ä¼šè¾“å‡ºåˆ°stderrã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å½“å¼€å¯æ—¥å¿—è®°å½•çš„æ—¶å€™ï¼Œå¯ä»¥å‘é€æ¶ˆæ¯åˆ°syslog&lt;/li&gt;
&lt;li&gt;HAProxy ä¼šæä¾›ä¸€æ¡æ¶ˆæ¯ï¼Œæ¥è§£é‡Šé”™è¯¯ï¼Œæœ‰æ—¶å€™ä¹Ÿä¼šæä¾›ä¿®å¤æ–¹æ³•ã€‚
å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[WARNING] 177/011147 (8652) : Setting tune.ssl.default-dh-param to 1024 by default, if your workload permits it
Configuration file is valid
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;HAProxy çš„æ—¥å¿—ä¿¡æ¯éå¸¸ä¸°å¯Œï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼ï¼Œå¯¹äºçº¿ä¸Šæ’æŸ¥æ•…éšœéå¸¸æœ‰ç”¨ã€‚&lt;/p&gt;
&lt;h2&gt;ç¡¬ä»¶æ¨è&lt;/h2&gt;
&lt;p&gt;ç”±äºHAProxy çš„å·¥ä½œæœºåˆ¶ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;CPU:ç›¸å¯¹äºå¤šæ ¸å¿ƒï¼Œæ›´åº”è¯¥çœ‹é‡é€Ÿåº¦ï¼ˆä¹Ÿå°±æ˜¯ä¸»é¢‘æ›´é«˜ï¼‰ï¼Œå’Œç¼“å­˜å¤§å°ã€‚&lt;/li&gt;
&lt;li&gt;éœ€è¦è¶³å¤Ÿçš„å†…å­˜æ¥å¤„ç†TCP è¿æ¥ï¼ŒHAProxy çš„å¼€é”€ä»¥åŠç³»ç»Ÿçš„å¼€é”€ï¼Œåƒä¸‡ä¸èƒ½å¿½è§†å¤§é‡TCPè¿æ¥å¸¦æ¥çš„å†…å­˜å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘å¡ï¼šintel æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;ç¡¬ç›˜ï¼šéå¿…é¡»ï¼Œé™¤éæœ¬åœ°éœ€è¦æ—¥å¿—è®°å½•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†è¾¾åˆ°æœ€ä½³æ€§èƒ½ï¼Œè¿˜éœ€è¦ä¸€ç‚¹è°ƒæ•´ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æŠŠç½‘å¡ä¸­æ–­å’Œå†…æ ¸ç»‘å®šåœ¨core 0 ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;HAProxy ç»‘å®šåœ¨é€šä¸€å—ç‰©ç†CPU çš„ä¸‹ä¸€ä¸ªæ ¸å¿ƒä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸ªä¼˜åŒ–å¾ˆæœ‰é“ç†ï¼Œä¹Ÿéå¸¸å¿…è¦ï¼Œç‰¹åˆ«æ˜¯HAProxy å¦‚æœè¿˜æ˜¯å·¥ä½œåœ¨å•è¿›ç¨‹æ¨¡å¼ä¸‹ï¼Œè¿™æ ·èƒ½æœ€å¤§åŒ–å‹æ¦¨æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šå¸è½½irqbalance&lt;/strong&gt;ï¼Œ&lt;a href="https://linux.die.net/man/1/irqbalance"&gt;irqbalance&lt;/a&gt; æ˜¯ä¸€ä¸ªç³»ç»ŸæœåŠ¡ï¼Œå¯ä»¥åœ¨å¤šä¸ªæ ¸å¿ƒä¹‹é—´è‡ªåŠ¨å¹³è¡¡ä¸­æ–­ã€‚&lt;br&gt;
å»¶ä¼¸é˜…è¯»ï¼š&lt;a href="http://blog.yufeng.info/archives/2422"&gt;è¤šéœ¸:ã€Šæ·±åº¦å‰–æå‘Šè¯‰ä½ irqbalanceæœ‰ç”¨å—ï¼Ÿã€‹&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;é¿å…ä½¿ç”¨VM æˆ–å…¶ä»–å…±äº«èµ„æºçš„äº‘æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2&gt;Sysctl è°ƒä¼˜&lt;/h2&gt;
&lt;p&gt;æœ€é‡è¦çš„è°ƒä¼˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;net.ipv4.ip_local_port_range = "1025 65534"&lt;/li&gt;
&lt;li&gt;net.ipv4.tcp_max_syn_backlog = 100000&lt;/li&gt;
&lt;li&gt;net.core.netdev_max_backlog = 100000&lt;/li&gt;
&lt;li&gt;net.core.somaxconn = 65534&lt;/li&gt;
&lt;li&gt;ipv4.tcp_rmem = "4096 16060 64060"&lt;/li&gt;
&lt;li&gt;ipv4.tcp_wmem = "4096 16384 262144"&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è°ƒ&lt;code&gt;net.ipv4.ip_local_port_range&lt;/code&gt;ï¼Œæ˜¯å› ä¸ºHAProxy éœ€è¦å……å½“ä¸­é—´äººï¼Œå¼€Nå¤šç«¯å£ï¼Œè¿æ¥å‰åç«¯ã€‚è°ƒå¤§äº†&lt;code&gt;net.ipv4.tcp_max_syn_backlog&lt;/code&gt;ï¼Œå‰è€…å†³å®šäº†ä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œè¿˜æ²¡è¢«HAProxyæ¥æ”¶çš„TCP è¿æ¥çš„æ’é˜Ÿæ•°é‡ï¼Œè¶…è¿‡äº†ä¹‹åï¼Œç³»ç»Ÿä¸å†æ¥å—æ–°çš„è¯·æ±‚ï¼Œæ‰€ä»¥å¾—è°ƒé«˜è¿™ä¸ªå€¼ã€‚&lt;code&gt;net.core.somaxconn&lt;/code&gt; æ˜¯ç³»ç»Ÿç«¯å£çš„ç›‘å¬é˜Ÿåˆ—ï¼Œä¹Ÿå¾—å¢å¤§ã€‚&lt;code&gt;ipv4.tcp_rmem&lt;/code&gt;å’Œ&lt;code&gt;ipv4.tcp_wmem&lt;/code&gt;,å‡å°é»˜è®¤å€¼å’Œæœ€å¤§å€¼ï¼Œé˜²æ­¢å†…å­˜çˆ†äº†ï¼Œå…³äºTCP å†…å­˜è¿™ä¸€å—ï¼Œå¯ä»¥çœ‹é™¶è¾‰çš„è¿™ç¯‡æ–‡ç« ï¼Œå†™çš„å¾ˆå¥½:&lt;a href="http://blog.csdn.net/russell_tao/article/details/18711023"&gt;ã€Šé«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹7--tcpè¿æ¥çš„å†…å­˜ä½¿ç”¨ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰é•¿è¿æ¥ï¼ŒæŠŠtcp_slow_start_after_idle è®¾ç½®ä¸º0ï¼Œå³å…³é—­ï¼Œé˜²æ­¢é•¿è¿æ¥ç©ºé—²ä¹‹åï¼Œç³»ç»Ÿé™ä½æ‹¥å¡çª—å£ï¼Œæå‡æ€§èƒ½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tcp_slow_start_after_idle=0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…³äºiptables çš„è°ƒä¼˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;net.netfilter.nf_conntrack_max = 131072&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœé…ç½®ä¸åˆç†ï¼Œconntrack ä¼šå½±å“HAProxy è¾¾åˆ°é«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼šå¯ç”¨iptablesï¼ŒåŠä½¿ç”¨è¿æ¥è·Ÿè¸ªï¼ˆconnection tracking ï¼‰ï¼Œä¼šæ¶ˆè€—20%çš„CPU èµ„æºï¼Œå³ä½¿æ²¡ä»»ä½•è§„åˆ™ã€‚&lt;/strong&gt;&lt;br&gt;
å¦‚æœçº¿ä¸Šå¯ç”¨äº†iptablesï¼Œç‰¹åˆ«è¿˜æ˜¯åœ¨ä¸€äº›å‰ç«¯æµé‡æ¥å…¥çš„æœºå™¨ä¸Šï¼Œä¾‹å¦‚Nginxï¼ŒLVSï¼ŒHaproxyä¹‹ç±»ï¼Œè¦å¥½å¥½ä¼˜åŒ–ä¸€ç•ªiptablesã€‚&lt;/p&gt;
&lt;h2&gt;HAProxyçš„å¤šè¿›ç¨‹æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;é…ç½®ç¤ºä¾‹ï¼ˆæ‘˜è‡ªå¹»ç¯ç‰‡ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# **DON&amp;#39;T RUN IN PRODUCTION, THERE ARE NO TIMEOUTS**
global
  nbproc 2
  cpu-map 1 1
  cpu-map 2 2
  stats socket /var/run/haproxy/socket_web process 1
  stats socket /var/run/haproxy/socket_mysql process 2

defaults HTTP
  bind-process 1
  mode http

frontend f_web
  bind 192.168.10.1:9000
  default_backend b_web
backend b_web
  server w1 192.168.10.21:8000 check

defaults MYSQL
  bind-process 2
  mode tcp
frontend f_mysql
  bind 192.168.10.1:3306
  default_backend b_mysql
backend b_mysql
   server m1 192.168.10.11:3306 check
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å¥½å¤„&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ªè¿›ç¨‹å¤„ç†ä¸€ä¸ªä»»åŠ¡ï¼Œä¾‹å¦‚ä¸€ä¸ªè¿›ç¨‹ç”¨äºå¤„ç†HTTPè¯·æ±‚ï¼Œä¸€ä¸ªç”¨äºMySQLï¼Œäº’ç›¸ä¸å¹²æ‰°,è§ä¸Šæ–‡é…ç½®ã€‚&lt;br&gt;
å¤šè¿›ç¨‹å¯ä»¥ç»‘å®šåˆ°å¤šä¸ªæ ¸å¿ƒä¸Šï¼ˆcpu-mapï¼‰ï¼Œæ‰©å±•æ€§ä¹Ÿæ›´å¥½ã€‚å¦å¤–å¦‚æœHAProxy éœ€è¦è¿›è¡ŒSSL å¸è½½çš„è¯ï¼Œå¤šè¿›ç¨‹éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥æ›´åŠ å……åˆ†çš„åˆ©ç”¨CPU èµ„æºã€‚&lt;/p&gt;
&lt;h3&gt;åå¤„&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…å­˜åŒºåŸŸ&lt;/strong&gt;ï¼Œå¸¦æ¥çš„ä¸€äº›é™åˆ¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¼€å¯debug æ¨¡å¼æ—¶ï¼Œå¤šè¿›ç¨‹ä¼šé€€å‡ºï¼Œåªå¯åŠ¨å•ä¸ªè¿›ç¨‹ï¼›&lt;/li&gt;
&lt;li&gt;frontentd å’Œ å¯¹åº”çš„backend å¿…é¡»è¿è¡Œåœ¨é€šä¸€ä¸ªè¿›ç¨‹ä¸Šï¼›&lt;/li&gt;
&lt;li&gt;å’ŒPeers å†²çªï¼›ï¼ˆpeers æ˜¯ä¸€ä¸ªåœ¨haproxy èŠ‚ç‚¹ä¹‹é—´åŒæ­¥server åˆ—è¡¨çš„åŠŸèƒ½ï¼Œå…·ä½“çœ‹&lt;a href="http://www.haproxy.org/download/1.5/doc/configuration.txt"&gt;haproxy é…ç½®peers ä¸€èŠ‚&lt;/a&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;å­˜å‚¨åœ¨å•ä¸ªè¿›ç¨‹å†…å­˜åŒºåŸŸå†…çš„ä¿¡æ¯æ— æ³•å…±äº«ç»™å…¶ä»–è¿›ç¨‹&lt;ul&gt;
&lt;li&gt;stick table + tracked counters&lt;/li&gt;
&lt;li&gt;statisticsï¼ˆç»Ÿè®¡ä¿¡æ¯ï¼‰&lt;/li&gt;
&lt;li&gt;server's maxconn (queue management)&lt;/li&gt;
&lt;li&gt;connection rate&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªHAProxy è¿›ç¨‹è‡ªè¡Œè¿›è¡Œç›‘æ§æ£€æŸ¥ï¼š&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªservice éœ€è¦è¢«æ¯ä¸ªè¿›ç¨‹æ£€æŸ¥ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªservice åœ¨ä¸åŒè¿›ç¨‹ä¸­ï¼ŒæŸä¸€åˆ»çš„çŠ¶æ€å¯èƒ½ä¸åŒï¼›&lt;/li&gt;
&lt;li&gt;ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åç«¯çš„ç›‘æ§æ£€æŸ¥æ— æ³•å…±äº«ï¼Œå¯¼è‡´èµ„æºæµªè´¹å’ŒçŠ¶æ€ä¸ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;ç®¡ç†ä¸€ä¸ªå¤šè¿›ç¨‹çš„é…ç½®æ›´åŠ å¤æ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Loggingï¼ˆæ—¥å¿—ï¼‰&lt;/h2&gt;
&lt;p&gt;Haproxy çš„æ—¥å¿—éå¸¸è¯¦ç»†ï¼ˆè™½ç„¶å¾ˆç®€çŸ­ï¼‰ï¼Œä¹Ÿéå¸¸é‡è¦ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å¦‚æœæ¡ä»¶å…è®¸ï¼Œåº”è¯¥ä¸€è‡´æ‰“å¼€æ—¥å¿—è®°å½•ã€‚å¦å¤–æ—¥å¿—æ ¼å¼å¯ä»¥è‡ªå®šä¹‰ï¼ˆlog-formatï¼‰ã€‚
å¦å¤–ä¹Ÿå¯ä»¥å¯¹ä¸åŒçš„frontend æŒ‡å®šæ—¥å¿—è®°å½•ï¼Œå°†ä¼ è¾“æ—¥å¿—å’Œäº‹ä»¶æ—¥å¿—åˆ†å¼€ï¼Œåªè®°å½•errorç­‰ç­‰ï¼Œå…·ä½“è§å¹»ç¯ç‰‡ã€‚&lt;/p&gt;
&lt;h2&gt;Timeoutï¼ˆè¶…æ—¶ï¼‰&lt;/h2&gt;
&lt;p&gt;ä¸€äº›timeoutè§£é‡Šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;timeout client: å®¢æˆ·ç«¯ä¸æ´»è·ƒçš„è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;li&gt;timeout connect: å’ŒæœåŠ¡ç«¯å»ºç«‹TCP è¿æ¥çš„è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;li&gt;timeout server:&lt;ul&gt;
&lt;li&gt;TCP æ¨¡å¼ï¼šæœåŠ¡ç«¯ä¸æ´»è·ƒçš„è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;li&gt;HTTP æ¨¡å¼ï¼šæœåŠ¡ç«¯å¤„ç†å“åº”å†…å®¹çš„æ—¶é—´ï¼ˆè¿”å›504 çŠ¶æ€ç ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;timeout client-fin: å®¢æˆ·ç«¯å¤„äºFIN_WAIT çŠ¶æ€çš„æœ€é•¿æ—¶é—´&lt;/li&gt;
&lt;li&gt;timeout server-fin: æœåŠ¡ç«¯å¤„äºFIN_WAIT çŠ¶æ€çš„æœ€é•¿æ—¶é—´&lt;/li&gt;
&lt;li&gt;HTTP æ¨¡å¼ä¸­æœ€è¦çš„ä¸€äº›timeoutï¼š&lt;ul&gt;
&lt;li&gt;timouet http-requestï¼šå®¢æˆ·ç«¯å‘é€æ•´ä¸ªè¯·æ±‚åˆ°æœåŠ¡ç«¯çš„ç”¨æ—¶ï¼ˆæŠµæŠ—slowlowris-live æ”»å‡»ï¼‰&lt;/li&gt;
&lt;li&gt;timeout http-keep-aliveï¼šhttp-keep-alive æ—¶ï¼Œä¿æŒè¿æ¥ï¼Œç­‰å¾…ä¸‹ä¸ªè¯·æ±‚çš„è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;li&gt;timeout tunnelï¼štunnel æ¨¡å¼å’Œwebsockets ä¸‹ï¼Œè¿æ¥ä¸æ´»è·ƒçš„è¶…æ—¶æ—¶é—´&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;timeout queueï¼šä¸€ä¸ªè¿æ¥åœ¨é˜Ÿåˆ—ä¸­èƒ½å¾…çš„æœ€é•¿æ—¶é—´&lt;/li&gt;
&lt;li&gt;timeout tarpitï¼šhow long the tarpitted connection is maintainedï¼ˆæš‚æ—¶ä¸å¤ªç†è§£è¿™ä¸ªçŠ¶æ€ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€äº›è¶…æ—¶é…ç½®ç¤ºä¾‹ï¼Œæ¥æºå¹»ç¯ç‰‡ï¼š&lt;/p&gt;
&lt;p&gt;HTTP æœåŠ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;defaults HTTP
  mode http
  timeout http-request 10s
  timeout client 20s
  timeout connect 4s
  timeout server 30s
  timeout http-keep-alive 4s
  # for websockets:
  timeout tunnel 2m
  timeout client-fin 1s
  timeout server-fin 1s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;TCP é•¿è¿æ¥çš„æœåŠ¡ï¼Œä¾‹å¦‚POPã€IMAP ä¹‹ç±»ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;defaults HTTP
  mode http
  timeout client  1m
  timeout connect 4s
  timeout server  1m
  timeout client-fin 1s
  timeout server-fin 1s
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Fetch&lt;/h2&gt;
&lt;p&gt;å¯ä»¥ç”¨æ¥è·å–è¯·æ±‚å’Œå“åº”çš„ä¸€äº›æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨haproxy é…ç½®ä¸­å¯ä»¥ä½¿ç”¨ä¸€äº›å˜é‡ï¼Œè¿™äº›å˜é‡ä»£è¡¨å…·ä½“è¯·æ±‚çš„ä¸€äº›å†…å®¹ï¼Œç„¶åç”¨å®ƒä»¬æ¥ç¼–å†™è§„åˆ™ï¼Œæ›´å¤šç»†èŠ‚å‚çœ‹å¹»ç¯ç‰‡ï¼Œä»¥åŠå®˜æ–¹è¿™ä¸ªæ–‡æ¡£ï¼š&lt;a href="https://www.haproxy.com/doc/aloha/7.0/haproxy/fetching_data_samples.html"&gt;Fetching data samples&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;ACL&lt;/h2&gt;
&lt;p&gt;å¯ä»¥æœ‰åŒ¿åæˆ–è€…å‘½åçš„ACL è§„åˆ™ï¼Œä½¿ç”¨acl æ¥ç»™è§„åˆ™èµ·åå­—ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;acl api_path path_beg -i /api/
use_backend bk_api if api_path
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŒ¿åçš„è§„åˆ™ï¼Œéœ€è¦ç”¨å¤§æ‹¬å·åŒ…èµ·æ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;use_backend bk_api if { path_beg -i /api/ }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤šä¸ªACL è§„åˆ™å¯ä»¥å…±ç”¨ä¸€ä¸ªåå­—ï¼Œå…³ç³»ä¸Šä¸ºé€»è¾‘æˆ–ï¼Œå³åŒ¹é…ä»»ä½•ä¸€æ¡è§„åˆ™å³å¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;acl myapi path_beg -i /api/
acl myapi hdr_beg(Host) -i api.
use_backend bk_api if myapi

ç­‰ä»·é¦€ï¼š

acl api_path path_beg -i /api/
acl api_vhost hdr_beg(Host) -i api.
use_backend bk_api if api_path || api_vhost
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;HTTP è§„åˆ™&lt;/h2&gt;
&lt;p&gt;åœ¨HTTP å±‚ï¼ŒHAProxy æ”¯æŒè§„åˆ™çš„å®šä¹‰ï¼Œå¯ä»¥åšä¸‹åˆ—äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…è®¸æˆ–ç¦æ­¢æŸäº›è¯·æ±‚æˆ–å“åº”&lt;/li&gt;
&lt;li&gt;è½¬å‘æµé‡&lt;/li&gt;
&lt;li&gt;ç¯¡æ”¹header æˆ–è€…URL&lt;/li&gt;
&lt;li&gt;æ•è·è¯·æ±‚å†…å®¹&lt;/li&gt;
&lt;li&gt;æ›´æ–°ACL è§„åˆ™æˆ–map å†…å®¹ç­‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨HTTP è§„åˆ™ä¸­å¯ä»¥ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„fetch å˜é‡ï¼Œç¼–å†™å¤æ‚çš„è§„åˆ™ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;http-request deny unless { req.hdr(Host) -i www.mydomain.com }
http-request redirect location /%[req.hdr(Host)]%[path] if { path_beg -i /api/ }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;æœåŠ¡å’Œåº”ç”¨ä¿æŠ¤&lt;/h2&gt;
&lt;p&gt;HAProxy æœ‰è¯·æ±‚é˜Ÿåˆ—ï¼Œå¯ä»¥å¼Šæ°‘åç«¯æœåŠ¡è¢«æ‰“æŒ‚ï¼Œç»™server é…ç½®åˆé€‚çš„maxconn ï¼Œå³å¯æŠŠåç«¯æœåŠ¡æ”¶åˆ°çš„è¯·æ±‚æ§åˆ¶ä½ã€‚&lt;br&gt;
HAProxy å›¢é˜Ÿæœ‰å¦å¤–ä¸€ä»½å¹»ç¯ç‰‡ï¼Œæä¾›äº†æ›´å¤šHAProxyé˜²DDoSçš„ç»éªŒåˆ†äº«ï¼š&lt;a href="http://www.slideshare.net/haproxytech/presentation-packetshield-solution-de-protection-contre-les-ddos-rseau"&gt;ã€ŠPresentation packetshield, solution de protection contre les DDoS rÃ©seauã€‹&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;å¦å¤–å¯ä»¥å¯¹ä¸åŒæ€§èƒ½çš„åç«¯ï¼Œè®¾ç½®ä¸åŒçš„maxconnï¼Œè½¬å‘ä¸åŒçš„è¯·æ±‚ï¼Œåˆ†æµå‹åŠ›ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;frontend f_myapp
  use_backend b_light if { path_beg /api/ /foo/ /bar/ }
  use_backend b_heavy if { path_beg /search /massivefoo /heavybar }
backend b_light
  server s1 server1:80 maxconn 300
backend b_heavy
  server s1 server1:80 maxconn 10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ç»Ÿè®¡é¡µé¢&lt;/h2&gt;
&lt;p&gt;HAProxy å†…éƒ¨ä¼šç»´æŠ¤å¾ˆå¤šè®¡æ•°å™¨ï¼Œç”¨åšç»Ÿè®¡ä¸å±•ç¤ºã€‚ç»Ÿè®¡é¡µé¢å¯ä»¥é…ç½®æˆä¸€ä¸ªweb é¡µé¢ï¼Œä¹Ÿå¯ä»¥æ˜¯è¾“å‡ºCSVæ ¼å¼çš„UNIX çš„å¥—æ¥å­—ï¼ˆUNIX socketï¼‰ã€‚é…ç½®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;listen stats
  bind-process 1
  bind :9010
  stats enable
  stats uri /
  stats auth demo:demo
  stats realm Demo
  stats admin if TRUE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœå¼€äº†å¤šè¿›ç¨‹ï¼ˆnbproc &amp;gt; 1ï¼‰ï¼Œæˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„ï¼ŒHAProxy è¿›ç¨‹ç›´æ¥çš„å†…å­˜å†…å®¹æ˜¯ä¸å…±äº«çš„ï¼Œæ‰€ä»¥ç»´æŠ¤è€…å„è‡ªçš„ç»Ÿè®¡è®¡æ•°å™¨ï¼Œæ‰€ä»¥éœ€è¦ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ›å»ºä¸€ä¸ªçŠ¶æ€é¡µé¢æˆ–è€…UNIX socketã€‚&lt;br&gt;
æœ€åæä¾›ä¸€ä¸ªç”¨äºFalcon Agent çš„HAProxyç›‘æ§é‡‡é›†è„šæœ¬ï¼š&lt;a href="https://gist.github.com/fangpsh/a0522b4d5657b42ebf14"&gt;30_haproxy_stats.sh&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2016"></category><category term="haproxy"></category></entry><entry><title>é«˜æµé‡è´Ÿè½½ä¸‹Nginx è°ƒä¼˜</title><link href="https://fangpsh.github.io/posts/2016/2016-11-24.html" rel="alternate"></link><published>2016-11-24T14:00:00+08:00</published><updated>2016-11-24T14:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-11-24:/posts/2016/2016-11-24.html</id><summary type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€: &lt;a href="https://blog.martinfjordvald.com/2011/04/optimizing-nginx-for-high-traffic-loads/"&gt;Martin Fjordvald&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å·²è·å¾—åŸæ–‡ä½œè€…ç¿»è¯‘è®¸å¯ï¼Œæœ¬æ–‡éµå¾ªåŸæ–‡è®¸å¯åè®®&lt;/li&gt;
&lt;li&gt;åŸæ–‡å‘è¡¨æ—¶é—´ï¼šApril 27ï¼Œ2011&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘æ›¾ç»è®¨è®ºè¿‡ä¸€äº›Nginx æœ€å¸¸è§çš„é—® â€¦&lt;/p&gt;</summary><content type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡åœ°å€: &lt;a href="https://blog.martinfjordvald.com/2011/04/optimizing-nginx-for-high-traffic-loads/"&gt;Martin Fjordvald&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å·²è·å¾—åŸæ–‡ä½œè€…ç¿»è¯‘è®¸å¯ï¼Œæœ¬æ–‡éµå¾ªåŸæ–‡è®¸å¯åè®®&lt;/li&gt;
&lt;li&gt;åŸæ–‡å‘è¡¨æ—¶é—´ï¼šApril 27ï¼Œ2011&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘æ›¾ç»è®¨è®ºè¿‡ä¸€äº›Nginx æœ€å¸¸è§çš„é—®é¢˜ï¼Œæ¯«æ— ç–‘é—®ï¼Œå…¶ä¸­ä¸€ä¸ªé—®é¢˜å°±æ˜¯å…³äºå¦‚ä½•ä¼˜åŒ–nginx è·å¾—é«˜æ€§èƒ½ã€‚ä¸å¿…æƒŠè®¶ï¼Œå› ä¸ºå¤§å¤šæ•°nginx æ–°ç”¨æˆ·éƒ½æ˜¯ä»Apache è¿ç§»è¿‡æ¥ï¼Œæ‰€ä»¥ä»–ä»¬ä¹ æƒ¯äºè°ƒæ•´é…ç½®å’Œä½¿ç”¨å·«æœ¯æ¥å°½å¯èƒ½è®©æœåŠ¡å™¨è¾¾åˆ°æœ€ä½³æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ©ï¼Œæˆ‘å¾—å‘Šè¯‰ä½ ä¸€äº›åæ¶ˆæ¯ï¼Œä½ å¹¶ä¸èƒ½&lt;em&gt;çœŸçš„&lt;/em&gt;æ˜¾ç€ä¼˜åŒ–nginxã€‚æ²¡æœ‰ä»€ä¹ˆé…ç½®èƒ½è®©ä½ çš„è´Ÿè½½é™ä½ä¸€åŠï¼Œæˆ–è®©PHP è¿è¡Œé€Ÿåº¦å¿«2 å€ã€‚è°¢å¤©è°¢åœ°ï¼Œå¥½æ¶ˆæ¯æ˜¯nginx ä¸éœ€è¦ä»»ä½•è°ƒä¼˜ï¼Œå› ä¸ºç›´æ¥ä½¿ç”¨å®ƒæ—¶å°±å·²ç»è¢«ä¼˜åŒ–è¿‡äº†ã€‚æœ€å¤§çš„ä¼˜åŒ–å‘ç”Ÿåœ¨å½“ä½ å†³å®šè¿è¡Œé€šè¿‡ape-get install ï¼Œyum install æˆ– make install å®‰è£…çš„nginxã€‚ï¼ˆè¯·æ³¨æ„è¿™äº›ä»“åº“å†…å®¹å¸¸å¸¸è¿‡æœŸã€‚&lt;a href="https://nginx.org/en/docs/install.html"&gt;Wiki çš„å®‰è£…é¡µé¢&lt;/a&gt;ä¸Šé€šå¸¸æœ‰æœ€æ–°çš„ä»“åº“ã€‚ï¼‰  &lt;/p&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰å¾ˆå¤šé€‰é¡¹ä¼šå½±å“nginx çš„è¡Œä¸ºï¼Œä½†æ˜¯è¿™äº›é€‰é¡¹çš„é»˜è®¤å€¼å¹¶ä¸å…¨éƒ½ä¸ºé«˜æµé‡çš„æƒ…å†µä¼˜åŒ–è¿‡ã€‚å¦å¤–æˆ‘ä»¬ä¹Ÿéœ€è¦è€ƒè™‘nginx è¿è¡Œçš„å¹³å°ï¼Œä¼˜åŒ–æˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºå®ƒä»¬æŸäº›åœ°æ–¹ä¹Ÿä¼šæœ‰ç“¶é¢ˆã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œæˆ‘ä»¬æ²¡æ³•ä¼˜åŒ–å•ä¸ªè¿æ¥çš„åŠ è½½æ—¶é—´ï¼Œä½†æ˜¯å¯ä»¥ç¡®ä¿nginx å¤„ç†é«˜æµé‡çš„æƒ…å†µæ—¶æœ‰ä¼˜åŒ–è¿‡çš„ç†æƒ³çš„ç¯å¢ƒã€‚å½“ç„¶ï¼Œæˆ‘æ‰€è¯´çš„é«˜æµé‡æ˜¯æŒ‡æ¯ç§’å‡ ç™¾ä¸ªè¯·æ±‚ï¼Œç»å¤§å¤šæ•°äººä¸éœ€è¦ä¸ºè¿™ç§æƒ…å†µè´¹å¿ƒæ€ï¼Œä¸è¿‡å¦‚æœä½ æœ‰å…´è¶£æˆ–è€…å‡†å¤‡å¤„ç†è¿™ç§æƒ…å†µï¼Œè¯·ç»§ç»­å¾€ä¸‹è¯»å§ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆæˆ‘ä»¬éœ€è¦è€ƒè™‘è¦ä½¿ç”¨çš„å¹³å°ï¼Œå› ä¸ºnginx å¯ä»¥è¿è¡Œåœ¨Linuxï¼ŒMacOSï¼ŒFreeBSDï¼ŒSolarisï¼ŒWindows ä»¥åŠå…¶ä»–ä¸“ä¸šçš„ç³»ç»Ÿã€‚ä»–ä»¬éƒ½å®ç°äº†é«˜æ€§èƒ½çš„åŸºäºäº‹ä»¶çš„è½®è¯¢æ–¹æ³•ï¼Œå¯æƒœçš„æ˜¯ï¼Œnginx åªæ”¯æŒäº†å…¶ä¸­4ä¸ªã€‚æˆ‘å€¾å‘äºå–œæ¬¢4ä¸ªä¸­çš„FreeBSDï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆå¤§çš„åŒºåˆ«ï¼Œç›¸å¯¹äºé€‰æ‹©æœ€ä¼˜çš„ç³»ç»Ÿï¼Œé€‰æ‹©ä½ æœ€ç†Ÿæ‚‰çš„ç³»ç»Ÿæ›´åŠ é‡è¦ã€‚ &lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ²¡æœ‰çŒœåˆ°ï¼Œé‚£ä¸ªä¸åŒçš„ç³»ç»Ÿå°±æ˜¯Windowsã€‚çœŸçš„æ²¡æœ‰ä»»ä½•ç†ç”±æŠŠè¿è¡Œåœ¨Windows ä¸Šçš„Nginx æŠ•å…¥ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚Windows é‡‡ç”¨ä¸€ä¸ªä¸åŒçš„å¤„ç†äº‹ä»¶è½®è¯¢çš„æ–¹æ³•ï¼Œnginx çš„ä½œè€…é€‰æ‹©ä¸æ”¯æŒå®ƒã€‚å®ƒé»˜è®¤é‡‡ç”¨ä½æ€§èƒ½çš„select()ï¼Œç»“æœæ€§èƒ½éå¸¸ç³Ÿç³•ã€‚  &lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°äººé‡åˆ°çš„ç¬¬äºŒä¸ªæœ€å¤§çš„ç“¶é¢ˆä¹Ÿä¸ä½ çš„æ“ä½œç³»ç»Ÿæœ‰å…³ã€‚æ‰“å¼€ä¸€ä¸ªshellï¼Œsu åˆ°è¿è¡Œnginx çš„ç”¨æˆ·ï¼Œç„¶åè¿è¡Œè¿™ä¸ªå‘½ä»¤:&lt;code&gt;ulimit -a&lt;/code&gt;ã€‚è¿™äº›æ•°å€¼éƒ½æ˜¯nginx è¿è¡Œæ—¶çš„ç“¶é¢ˆã€‚å¤§å¤šæ•°ç³»ç»Ÿä¸‹çš„æ‰“å¼€æ–‡ä»¶æ•°é»˜è®¤è¢«é™åˆ¶å¾—å¾ˆå°ï¼Œæˆ‘ç°åœ¨æ£€æŸ¥çš„è¿™ä¸ªç³»ç»Ÿå®ƒçš„å€¼è®¾ç½®ä¸º1024ã€‚å¦‚æœnginxè¿è¡Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å®ƒè¾¾åˆ°é™åˆ¶çš„æ—¶ä¼šè®°å½•é”™è¯¯æ—¥å¿—ï¼ˆ24: Too many open filesï¼‰å’Œè¿”å›ä¸€ä¸ªé”™è¯¯ç»™å®¢æˆ·ç«¯ã€‚nginx å½“ç„¶å¯ä»¥å¤„ç†å¤§å¤§è¶…è¿‡1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä½ çš„æ“ä½œç³»ç»ŸåŒæ ·ä¹Ÿå¯ä»¥ã€‚æ‰€ä»¥ä½ å¯ä»¥æ”¾å¿ƒçš„æé«˜è¿™ä¸ªå€¼ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œä½ å¯ä»¥é€šè¿‡ulimit è®¾ç½®è¿™ä¸ªé™åˆ¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href="https://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile"&gt;worker rlimit nofile&lt;/a&gt; æ¥å®šä¹‰ä½ éœ€è¦çš„æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„é™åˆ¶ã€‚ï¼ˆè¿™éœ€è¦ä»¥root å¯åŠ¨nginxï¼Œåœ¨å®ƒdropping  privileges ä¹‹å‰ï¼‰ï¼ˆè¯‘æ³¨ï¼šnginx ä»¥root å¯åŠ¨ä¹‹åï¼Œä¼šå†å¯åŠ¨å¤šä¸ªworker è¿›ç¨‹ï¼Œworker è¿›ç¨‹å·¥ä½œåœ¨ä½ é…ç½®ä¸­&lt;a href="https://nginx.org/en/docs/ngx_core_module.html#user"&gt;user&lt;/a&gt; æŒ‡å®šçš„æ™®é€šç”¨æˆ·ï¼Œå®ç°å‚è€ƒ&lt;a href="https://github.com/nginx/nginx/blob/b072a6957c97ca7c33a64b1a34f7b66c6e209acf/src/os/unix/ngx_process_cycle.c#L831_L850"&gt;nginx_src/os/unix/ngx_process_cycle.c&lt;/a&gt; &lt;/p&gt;
&lt;h2&gt;Nginx ç“¶é¢ˆ&lt;/h2&gt;
&lt;p&gt;å…³æ³¨äº†OS çš„ç“¶é¢ˆä¹‹åï¼Œæ˜¯æ—¶å€™æ·±å…¥nginx è‡ªèº«ï¼Œçœ‹çœ‹ä¸€äº›æˆ‘ä»¬å¯ä»¥è°ƒæ•´çš„æŒ‡æ ‡å’Œæ–¹æ³•ã€‚  &lt;/p&gt;
&lt;h3&gt;Worker è¿›ç¨‹&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://nginx.org/en/docs/ngx_core_module.html#worker_processes"&gt;worker è¿›ç¨‹&lt;/a&gt; æ˜¯nginx çš„åŸºç¡€ï¼Œä¸€æ—¦master è¿›ç¨‹ç»‘å®šäº†æŒ‡å®šçš„IP/ç«¯å£ï¼Œå®ƒå°±ä¼šæ ¹æ®å¤åˆ¶å‡ºæŒ‡å®šç”¨æˆ·çš„worker è¿›ç¨‹ï¼Œç„¶åå®ƒä»¬ä¼šå¤„ç†æ‰€æœ‰ä»»åŠ¡ã€‚Worker ä¸æ˜¯å¤šçº¿ç¨‹çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¸èƒ½åœ¨CPUä¹‹é—´åˆ†æ‘Šæ¯ä¸ªè¿æ¥ã€‚æ‰€ä»¥è¿™è®©è¿è¡Œå¤šä¸ªworker è¿›ç¨‹æœ‰æ„ä¹‰ï¼Œé€šå¸¸ä¸€ä¸ªCPU æ ¸å¿ƒé…ä¸€ä¸ªworkerã€‚2-4 ä¸ªworker å¯ä»¥åº”ä»˜å¤§å¤šæ•°è´Ÿè½½æƒ…å†µï¼Œå› ä¸ºåœ¨CPU æˆä¸ºé—®é¢˜ä¹‹å‰ï¼Œnginx ä¼šé‡åˆ°å…¶ä»–ç“¶é¢ˆï¼Œé€šå¸¸æƒ…å†µä¸‹ä½ çš„è¿›ç¨‹åªä¼šå¤„äºç©ºé—²çŠ¶æ€ã€‚å¦‚æœä½ çš„nginx å®ä¾‹åœ¨è®¾ç½®4 ä¸ªworker ä¹‹åæ˜¯CPU Boundï¼ˆè¯‘æ³¨ï¼šåªå ç”¨å¤§é‡CPUèµ„æºï¼Œç›¸å¯¹åº”çš„æœ‰I/O Boundï¼‰ï¼Œå¸Œæœ›ä¸éœ€è¦æˆ‘å‘Šè¯‰ä½ éœ€è¦æ€ä¹ˆåšã€‚ï¼ˆè¯‘æ³¨ï¼šä½œè€…æ„æŒ‡å‡çº§CPU é…ç½®å³å¯ã€‚ï¼‰  &lt;/p&gt;
&lt;p&gt;å½“ä½ åœ¨å¤„ç†æœ‰å¾ˆå¤šé˜»å¡çš„ç£ç›˜IO çš„æƒ…å†µæ—¶ï¼Œå¯ä»¥åˆ›å»ºæ›´å¤šworker è¿›ç¨‹ã€‚ä½ éœ€è¦æµ‹è¯•ç‰¹å®šçš„é…ç½®ä¸‹åŠ è½½é™æ€æ–‡ä»¶çš„ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœè¿™ä¸ªæ—¶é—´å¾ˆå¤§çš„è¯ï¼Œå°è¯•å¢åŠ worker è¿›ç¨‹ã€‚&lt;/p&gt;
&lt;h3&gt;Worker è¿æ¥æ•°&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://nginx.org/en/docs/ngx_core_module.html#worker_connections"&gt;Worker è¿æ¥æ•°&lt;/a&gt;èƒ½æœ‰æ•ˆåœ°é™åˆ¶ä»»ä¸€worker åœ¨æŸä¸€åˆ»å¯ä»¥å¤„ç†çš„è¿æ¥æ•°ã€‚è¿™ä¸ªé€‰é¡¹ææœ‰å¯èƒ½æ˜¯è®¾è®¡ç”¨æ¥é˜²æ­¢å¤±æ§çš„è¿›ç¨‹ï¼Œä¸‡ä¸€ä½ çš„ç³»ç»Ÿé…ç½®æˆå…è®¸å¤„ç†è¶…å‡ºç¡¬ä»¶èƒ½åŠ›çš„è´Ÿè½½ã€‚æ­£å¦‚nginx å¼€å‘è€…Valentine åœ¨&lt;a href="http://mailman.nginx.org/pipermail/nginx/2015-May/047460.html"&gt;é‚®ä»¶åˆ—è¡¨&lt;/a&gt;ä¸­æŒ‡å‡ºï¼Œå¦‚æœè¾¾åˆ°worker_connections çš„é™åˆ¶ï¼Œnginx å¯ä»¥å…³é—­keep-alive è¿æ¥ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬ä¸éœ€è¦æ‹…å¿ƒkeep-alive å€¼ã€‚ç›¸åï¼Œæˆ‘ä»¬åº”è¯¥å…³å¿ƒnginx å¯ä»¥å¤„ç†çš„å½“å‰æ´»è·ƒè¿æ¥çš„æ€»æ•°ã€‚æˆ‘ä»¬å¯ä»¥å¤„ç†çš„æœ€å¤§è¿æ¥æ•°å…¬å¼å¦‚ä¸‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;worker_processes * worker_connections * (K / average $request_time)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…¶ä¸­K æ˜¯å½“å‰æ´»è·ƒçš„è¿æ¥æ€»æ•°ã€‚å¦å¤–ï¼Œå¯¹äºKå€¼ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è€ƒè™‘åå‘ä»£ç†ï¼Œå®ƒä¼šå¤šæ‰“å¼€ä¸€ä¸ªåˆ°ä½ åç«¯æœåŠ¡çš„è¿æ¥ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸­&lt;code&gt;worker_connections&lt;/code&gt;  æ˜¯è®¾ç½®ä¸º1024ï¼Œå¦‚æœæˆ‘ä»¬è€ƒè™‘æµè§ˆå™¨é€šå¸¸ä¼šæ‰“å¼€2ä¸ªè¿æ¥æ¥è¿›è¡Œç«™ç‚¹èµ„æºçš„ç®¡é“ä¼ è¾“ï¼Œé‚£ä¹ˆå¯¼è‡´æˆ‘ä»¬æœ€å¤šèƒ½åŒæ—¶å¤„ç†512ä¸ªç”¨æˆ·ã€‚ä½¿ç”¨åå‘ä»£ç†çš„æƒ…å†µä¸‹ï¼ŒåŒæ—¶èƒ½å¤„ç†çš„ç”¨æˆ·æ•°ä¼šæ›´ä½ï¼Œå³ä½¿ä½ çš„åç«¯æœåŠ¡èƒ½å¤Ÿå°½å¯èƒ½å¿«çš„å“åº”æ¥é‡Šæ”¾è¿æ¥ã€‚  &lt;/p&gt;
&lt;p&gt;æ‰€æœ‰å…³äºworker è¿æ¥æ•°çš„äº‹æƒ…åº”è¯¥éƒ½ææ¸…æ¥šäº†ï¼Œå¦‚æœä½ çš„æµé‡åœ¨å¢é•¿ï¼Œä½ æœ€ç»ˆéƒ½éœ€è¦å¢åŠ æ¯ä¸ªworker çš„æ€»è¿æ¥æ•°ã€‚2048 å¯¹äºå¤§å¤šæ•°äººæ¥è¯´éƒ½é€‚ç”¨äº†ï¼Œè¯´å®è¯ï¼Œå¦‚æœä½ æœ‰è¿™ç§é‡çº§çš„æµé‡ï¼Œä½ åº”è¯¥å·²ç»å¾ˆæ¸…æ¥šçš„çŸ¥é“è¿™ä¸ªæŒ‡æ ‡å¾—è®¾å¤šé«˜ã€‚&lt;/p&gt;
&lt;h3&gt;CPU äº²ç¼˜æ€§&lt;/h3&gt;
&lt;p&gt;è®¾ç½®CPU äº²ç¼˜æ€§å®é™…ä¸Šæ˜¯å‘Šè¯‰æ¯ä¸ªworker ä½¿ç”¨å“ªä¸ªCPU æ ¸å¿ƒï¼Œå¹¶ä¸”ä»–ä»¬åªä¼šä½¿ç”¨é‚£ä¸ªæ ¸å¿ƒã€‚æˆ‘ä¸æƒ³è¯´å¤ªå¤šæ¶‰åŠè¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œé™¤äº†è¯´æ˜ä½ åšè¿™ä¸ªæ—¶å€™å¿…é¡»&lt;strong&gt;éå¸¸&lt;/strong&gt;å°å¿ƒã€‚ä½ æ“ä½œç³»ç»Ÿçš„CPUè°ƒåº¦å™¨ææœ‰å¯èƒ½æ¯”ä½ æ›´æ“…é•¿å¤„ç†è´Ÿè½½å‡è¡¡ã€‚å¦‚æœä½ è®¤ä¸ºä½ åœ¨CPU è´Ÿè½½æ–¹é¢é‡åˆ°äº†é—®é¢˜ï¼Œæƒ³åœ¨è°ƒåº¦å™¨çº§åˆ«åšä¼˜åŒ–ï¼Œæœ‰å¯èƒ½æ‰¾åˆ°ä¸€ä¸ªå¯æ›¿ä»£çš„è°ƒåº¦å™¨ã€‚é™¤éä½ æ¸…æ™°çš„çŸ¥é“ä½ åœ¨åšä»€ä¹ˆï¼Œä¸ç„¶åˆ«ç¢°è¿™ä¸ªã€‚&lt;/p&gt;
&lt;h3&gt;Keep Alive&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_timeout"&gt;Keep alive&lt;/a&gt; æ˜¯HTTP çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒå…è®¸ç”¨æˆ·å®¢æˆ·ç«¯å’Œä½ çš„æœåŠ¡å™¨ä¿æŒè¿æ¥æ¥å‘é€è‹¥å¹²è¯·æ±‚ï¼Œç›´åˆ°è¾¾åˆ°è®¾å®šçš„è¶…æ—¶æ—¶é—´ã€‚å®é™…ä¸Šè¿™ä¸ªæŒ‡æ ‡ä¸ä¼šå¤§å¤§æ”¹å–„æˆ‘ä»¬çš„nginxï¼Œå› ä¸ºnginx è‡ªèº«ä¹Ÿèƒ½å¤„ç†å¤§é‡çš„ç©ºé—²è¿æ¥ã€‚nginx çš„ä½œè€…å£°ç§°nginx å¤„ç†10,000 ä¸ªç©ºé—²è¿æ¥åªä¼šä½¿ç”¨2.5MBå†…å­˜ï¼Œåœ¨æˆ‘çœ‹æ¥ç¡®å®å¦‚æ­¤ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘åœ¨æ€§èƒ½æŒ‡å—ä¸­è®¾è®¡è¿™ç‚¹çš„ç†ç”±éå¸¸ç®€å•ã€‚Keep alive èƒ½å¤§å¤§æ”¹å–„ç»ˆç«¯ç”¨æˆ·æ„Ÿå—åˆ°çš„åŠ è½½æ—¶é—´ã€‚è¿™æ˜¯ä½ èƒ½ä¼˜åŒ–çš„æœ€é‡è¦çš„æŒ‡æ ‡ï¼Œå› ä¸ºå¦‚æœä½ çš„ç½‘ç«™å¯¹ç”¨æˆ·æ¥è¯´åŠ è½½å¾ˆå¿«ï¼Œä»–ä»¬ä¼šå¾ˆå¼€å¿ƒã€‚Amazon å’Œå…¶ä»–å¤§å‹åœ¨çº¿é›¶å”®å•†ç ”ç©¶è¡¨æ˜ï¼Œæ„Ÿå®˜ä¸Šçš„åŠ è½½æ—¶é—´å’Œé”€é‡å­˜åœ¨ç›´æ¥çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å¯èƒ½æœ‰ä¸€ç‚¹å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆä¿æŒæŒä¹…çš„è¿æ¥å½±å“è¿™ä¹ˆå¤§ï¼Œå³ä½ è¦é¿å…åˆ›å»ºæ‰€æœ‰HTTP è¿æ¥ï¼Œè¿™æ ·å½±å“å¾ˆå¤§ã€‚ä½ å¯èƒ½ä¸éœ€è¦keep alived è¶…æ—¶æ—¶é—´ä¸º65ï¼Œä½†æ˜¯è¿˜æ˜¯å¾ˆæ¨èè®¾ç½®ä¸º10~20 ï¼Œæ­£å¦‚å‰é¢è¯´çš„ï¼Œnginx å¤„ç†ç©ºé—²çš„è¯·æ±‚éå¸¸è½»æ¾ã€‚&lt;/p&gt;
&lt;h3&gt;tcp_nodelay å’Œ tcp_nopush&lt;/h3&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªæŒ‡æ ‡å¯èƒ½æ˜¯æœ€éš¾ç†è§£çš„ï¼Œå®ƒä»¬åœ¨éå¸¸åº•å±‚çš„ç½‘ç»œæ–¹é¢å½±å“ç€nginxã€‚æœ€ç®€çŸ­å’Œæµ…æ˜¾çš„è§£é‡Šæ˜¯ï¼Œè¿™äº›æŒ‡æ ‡å†³å®šæ“ä½œç³»ç»Ÿå¦‚ä½•å¤„ç†ç½‘ç»œç¼“å­˜å’Œä½•æ—¶åˆ·æ–°ç¼“å­˜ä¼ ç»™ç»ˆç«¯ç”¨æˆ·ã€‚æˆ‘åªèƒ½å»ºè®®ä½ ï¼Œå¦‚æœä¸äº†è§£å°±åˆ«ä¹±åŠ¨ã€‚å®ƒä»¬ä¸ä¼šæ˜¾ç€çš„æ”¹å–„æˆ–è€…æ”¹å˜ä»»ä½•ä»€ä¹ˆï¼Œæ‰€ä»¥æœ€å¥½æ˜¯è®©å®ƒä»¬ä¿æŒé»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;h2&gt;ç¡¬ä»¶ç“¶é¢ˆ&lt;/h2&gt;
&lt;p&gt;ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å·²ç»å¤„ç†äº†æ‰€æœ‰æºäºnginx å¯èƒ½çš„ç“¶é¢ˆï¼Œæ˜¯æ—¶å€™å¼„æ˜ç™½å¦‚ä½•æœ€å¤§é™åº¦çš„æ¦¨å¹²æˆ‘ä»¬çš„æœåŠ¡å™¨äº†ã€‚è¦åšåˆ°è¿™ä¸ªæˆ‘ä»¬ç€çœ¼é¦€ç¡¬ä»¶å±‚é¢ï¼Œå› ä¸ºè¿™æ˜¯æœ€æœ‰å¯èƒ½æ‰¾åˆ°ç“¶é¢ˆçš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;æœåŠ¡å™¨ä¸»è¦ä¸‰ä¸ªæ–¹é¢æœ‰æ½œåœ¨çš„ç“¶é¢ˆã€‚CPUï¼Œå†…å­˜å’ŒIOå±‚é¢ã€‚nginx å¯¹äºCPUä½¿ç”¨éå¸¸é«˜æ•ˆï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ç›´æ¥äº†å½“çš„å‘Šè¯‰ä½ ï¼Œè¿™æ–¹é¢ä¸ä¼šæˆä¸ºä½ çš„ç“¶é¢ˆã€‚åŒæ ·åœ°ï¼Œnginx åœ¨å†…å­˜ä½¿ç”¨æ–¹é¢ä¹Ÿéå¸¸é«˜æ•ˆï¼Œæ‰€ä»¥ä¹Ÿä¸å¤ªå¯èƒ½æˆä¸ºç“¶é¢ˆã€‚å‰©é¦€çš„IO æ˜¯æˆ‘ä»¬æœåŠ¡å™¨ç“¶é¢ˆçš„ç½ªé­ç¥¸é¦–ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ æ›¾ç»å¤„ç†è¿‡æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä½ å¯¹è¿™å—å¯èƒ½éå¸¸ç†Ÿæ‚‰ã€‚ç£ç›˜é©±åŠ¨å™¨&lt;strong&gt;éå¸¸ï¼Œéå¸¸æ…¢&lt;/strong&gt;ã€‚ä»ç£ç›˜é©±åŠ¨å™¨ä¸­è¯»å–å†…å®¹å¯èƒ½æ˜¯ä½ åœ¨æœåŠ¡å™¨ä¸­æˆæœ¬æœ€é«˜çš„æ“ä½œäº†ï¼Œæ‰€ä»¥ï¼Œè‡ªç„¶ä¸ºäº†é¿å…IO ç“¶é¢ˆï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘nginx å¯¹ç£ç›˜çš„è¯»å†™ã€‚&lt;/p&gt;
&lt;p&gt;è¦åšåˆ°è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹nginx çš„è¡Œä¸ºï¼Œå°½å¯èƒ½å‡å°‘å†™ç£ç›˜ï¼Œä»¥åŠç¡®ä¿nginx çš„å†…å­˜é™åˆ¶ï¼Œæ¥é¿å…å¯¹ç£ç›˜çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;h3&gt;è®¿é—®æ—¥å¿—&lt;/h3&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ—¥å¿—è®°å½•ï¼Œnginxä¼šå¾€ç£ç›˜ä¸Šçš„ä¸€ä¸ªæ–‡ä»¶å†™å…¥æ¯æ¡è¯·æ±‚çš„è®°å½•ï¼Œä½ å¯ä»¥ä¾é å®ƒæ¥è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œå®‰å…¨æ£€æŸ¥ç­‰ï¼Œä½†æ˜¯è¿™ä¼šå¸¦æ¥å¾ˆå¤§çš„IO å¼€é”€ã€‚æ‰€ä»¥å¦‚æœä½ ä¸éœ€è¦ä»»ä½•è®¿é—®æ—¥å¿—ï¼Œä½ å¯ä»¥ç›´æ¥å…³é—­æ—¥å¿—è®°å½•ï¼Œé¿å…å†™ç£ç›˜ã€‚ç„¶è€Œï¼Œå¦‚æœä½ éœ€è¦è®¿é—®æ—¥å¿—ï¼Œé‚£ä¹ˆè€ƒè™‘æŠŠæ—¥å¿—ä¿å­˜åˆ°å†…å­˜å§ï¼ˆè¯‘æ³¨ï¼šä½¿ç”¨RAM Diskï¼‰ã€‚è¿™ä¼šæ¯”å†™å…¥ç£ç›˜å¿«å¾ˆå¤šï¼Œè€Œä¸”å¯ä»¥æ˜¾ç€é™ä½IO å¼€é”€ã€‚ï¼ˆè¯‘æ³¨ï¼šè¿˜å¯ä»¥é‡‡ç”¨memory bufferï¼Œä»¥åŠratio ä¹‹ç±»çš„å‚æ•°æ¥ä¼˜åŒ–nginxå†™æ—¥å¿—ã€‚ï¼‰  &lt;/p&gt;
&lt;p&gt;å¦‚æœä½ åªæ˜¯ä½¿ç”¨è®¿é—®æ—¥å¿—æ¥åšç»Ÿè®¡åˆ†æï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ç±»ä¼¼Google Analytics æ¥ä»£æ›¿ï¼Œæˆ–åªè®°å½•è¯·æ±‚ä¸­çš„ä¸€éƒ¨åˆ†å³å¯ã€‚&lt;/p&gt;
&lt;h3&gt;é”™è¯¯æ—¥å¿—&lt;/h3&gt;
&lt;p&gt;æˆ‘å†…å¿ƒä¹Ÿåœ¨çŠ¹è±«æˆ‘æ˜¯å¦åº”è¯¥åŒ…å«è¿™ä¸ªæŒ‡æ ‡ï¼Œå› ä¸ºä½ çœŸçš„ä¸æƒ³è¦ç¦ç”¨é”™è¯¯æ—¥å¿—è®°å½•ï¼Œç‰¹åˆ«æ˜¯è€ƒè™‘åˆ°å®é™…ä¸Šé”™è¯¯æ—¥å¿—å çš„å­˜å‚¨ç©ºé—´å¾ˆå°‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…³äºè¿™ä¸ªæŒ‡æ ‡æœ‰å›°æƒ‘çš„åœ°æ–¹ï¼Œé”™è¯¯æ—¥å¿—ç­‰çº§çš„å‚æ•°æ˜¯ä½ å¯ä»¥æŒ‡å®šçš„ï¼Œå¦‚æœè®¾ç½®çš„å¤ªä½ï¼Œå®ƒä¼šè®°å½•404 é”™è¯¯å’Œå…¶ä»–å¯èƒ½çš„debug ä¿¡æ¯ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®ä¸ºwarn ç­‰çº§å°±å¤Ÿäº†ï¼Œå¹¶ä¸”èƒ½ä¿æŒè¾ƒä½çš„IOã€‚&lt;/p&gt;
&lt;h3&gt;Open File Cache&lt;/h3&gt;
&lt;p&gt;æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªè¯»è¯·æ±‚åŒ…å«æ‰“å¼€å’Œå…³é—­æ–‡ä»¶ï¼Œè€ƒè™‘åˆ°è¿™æ˜¯ä¸€ä¸ªé˜»å¡çš„æ“ä½œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸èƒ½å¿½ç•¥çš„æ–¹é¢ã€‚æ‰€ä»¥ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´ç¼“å­˜æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦éå¸¸æœ‰ç›Šï¼Œè¿™å°±æ˜¯&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#open_file_cache"&gt;open file cache&lt;/a&gt;çš„ä½œç”¨ã€‚é“¾æ¥çš„wiki å¯¹äºå¦‚ä½•å¯ç”¨å’Œé…ç½®æœ‰éå¸¸è¯¦ç»†è¯´æ˜ï¼Œæˆ‘å»ºè®®ä½ è¯»ä¸€è¯»ã€‚&lt;/p&gt;
&lt;h3&gt;Buffers&lt;/h3&gt;
&lt;p&gt;ä½ éœ€è¦è°ƒä¼˜çš„æœ€é‡è¦çš„ä¸€ä»¶äº‹æ˜¯ä½ å…è®¸nginx ä½¿ç”¨çš„buffer å¤§å°ã€‚å¦‚æœbuffer è®¾ç½®çš„å¤ªå°ï¼Œnginx å°†ä¸å¾—ä¸å­˜å‚¨ä¸Šæ¸¸(upstreams)çš„å“åº”åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œè¿™ä¼šå¯¼è‡´IO è¯»å†™å¢åŠ ã€‚æµé‡è¶Šå¤§é—®é¢˜è¶Šä¸¥é‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#client_body_buffer_size"&gt;client_body_buffer_size&lt;/a&gt; æŒ‡ä»¤ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯&lt;strong&gt;è¯·æ±‚&lt;/strong&gt;çš„buffer å¤§å°ï¼Œä¹Ÿå°±æ˜¯å¤–éƒ¨è¿›å…¥çš„è¯·æ±‚ä½“ã€‚å®ƒè¢«ç”¨æ¥å¤„ç†POST æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ä¸€äº›è¡¨å•æäº¤ï¼Œæ–‡ä»¶ä¸Šä¼ ä¹‹ç±»çš„ã€‚å¦‚æœä½ è¦å¤„ç†å¾ˆå¤šå¤§å®¹é‡çš„POST æ•°æ®æäº¤ï¼Œä½ éœ€è¦ç¡®ä¿è¿™ä¸ªbuffer è¶³å¤Ÿå¤§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href="https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_buffer_size"&gt;fastcgi_buffers&lt;/a&gt; å’Œ&lt;a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering"&gt;proxy_buffers&lt;/a&gt; æŒ‡ä»¤ç”¨æ¥å¤„ç†ä½ ä¸Šæ¸¸æœåŠ¡å™¨çš„å“åº”ï¼Œä¹Ÿå°±æ˜¯PHPï¼ŒApache æˆ–è€…å…¶ä»–ã€‚æ„æ€å’Œä¸Šæ–‡å·®ä¸å¤šï¼Œå¦‚æœè¿™äº›buffer ä¸å¤Ÿå¤§ï¼Œæ•°æ®åœ¨è¿”å›ç»™ç”¨æˆ·ä¹‹å‰ä¼šè¢«ç¼“å­˜åˆ°ç£ç›˜ä¸­ã€‚æ³¨æ„ï¼Œåœ¨åŒæ­¥ä¼ è¾“æ•°æ®ç»™å®¢æˆ·ç«¯ä¹‹å‰ï¼Œnginx èƒ½ç¼“å­˜çš„å¤§å°æœ‰ä¸€ä¸ªä¸Šé™ï¼Œå³ä½¿æ˜¯åœ¨ç£ç›˜ä¸Šã€‚è¿™ä¸ªé™åˆ¶æ˜¯ç”±&lt;code&gt;fastcgi_max_temp_file_size&lt;/code&gt; å’Œ&lt;code&gt;proxy_max_temp_file_size&lt;/code&gt; æŒ‡å®šçš„ã€‚å¦å¤–ä½ ä¹Ÿå¯ä»¥å…³é—­ä»£ç†è¿æ¥çš„ç¼“å­˜ï¼Œå³æŠŠ&lt;code&gt;proxy_buffering&lt;/code&gt; è®¾ç½®ä¸º&lt;code&gt;off&lt;/code&gt;ã€‚ï¼ˆé€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼ï¼‰&lt;/p&gt;
&lt;h3&gt;å½»åº•å»é™¤ç£ç›˜IO&lt;/h3&gt;
&lt;p&gt;å»é™¤ç£ç›˜IO æœ€å¥½çš„æ–¹æ³•è‡ªç„¶æ˜¯ä¸ç”¨ç£ç›˜ï¼Œå¦‚æœä½ åªæœ‰å°‘é‡æ•°æ®ï¼Œä½ å¯ä»¥æŠŠå®ƒä»¬éƒ½æ”¾å…¥å†…å­˜ï¼Œç„¶åå®Œå…¨æ‘†è„±ç£ç›˜IO çš„é™åˆ¶ã€‚ä½ çš„æ“ä½œç³»ç»Ÿé»˜è®¤ä¼šç¼“å­˜é¢‘ç¹è®¿é—®è¿‡çš„ç£ç›˜æ‰‡åŒºï¼Œæ‰€ä»¥ä½ æœ‰è¶Šå¤šçš„å†…å­˜ï¼ŒIO å°±è¶Šå°‘ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥é€šè¿‡ä¹°æ›´å¤šçš„å†…å­˜æ¥çªç ´è¿™ä¸ªé™åˆ¶ã€‚å½“ç„¶ï¼Œä½ çš„æ•°æ®è¶Šå¤šï¼Œéœ€è¦çš„å†…å­˜è¶Šå¤§ã€‚&lt;/p&gt;
&lt;h3&gt;Network IO&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å¥½ç©ï¼Œæˆ‘ä»¬å‡è®¾ä½ æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥ç¼“å­˜ä½ æ‰€æœ‰çš„æ•°æ®ï¼Œè¿™æ„å‘³ç€ç†è®ºä¸Šä½ è¯»çš„IO é€Ÿåº¦èƒ½è¾¾åˆ°3-6gbpsã€‚ç„¶è€Œï¼Œä½ å¹¶ä¸”æ²¡æœ‰è¿™ä¹ˆå¿«çš„ç½‘ç»œé€šé“ã€‚å¾ˆé—æ†¾ï¼Œå¯¹äºæˆ‘ä»¬ä¼ è¾“æ•°æ®éœ€è¦çš„ç½‘ç»œå¸¦å®½ï¼Œèƒ½å¤Ÿä¼˜åŒ–çš„æœ‰é™ã€‚å”¯ä¸€æœ‰ç”¨çš„ä¼˜åŒ–æ–¹å¼å°±æ˜¯å‡å°‘ä¼ è¾“çš„æ•°æ®ï¼Œæˆ–è€…å‹ç¼©æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢nginx æœ‰ä¸€ä¸ª&lt;a href="https://nginx.org/en/docs/http/ngx_http_gzip_module.html#gzip"&gt;gzip æ¨¡å—&lt;/a&gt;ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬åœ¨ä¼ ç»™ç”¨æˆ·ä¹‹å‰å‹ç¼©æ•°æ®ï¼Œè¿™å¯ä»¥æ˜¾ç€çš„é™ä½æ•°æ®å¤§å°ã€‚é€šå¸¸æ¥è¯´&lt;code&gt;gzip_comp_level&lt;/code&gt;è®¾ç½®ä¸º4~5 å°±è¶³å¤Ÿäº†ã€‚æ²¡æœ‰å¿…è¦è¿›ä¸€æ­¥å¢åŠ å‹ç¼©ç­‰çº§ï¼Œé‚£æ ·åªä¼šæ¶ˆè€—CPU æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å„ç§javascript å’Œcss å‹ç¼©å™¨æ¥å‹ç¼©æ•°æ®ã€‚è¿™äº›å’Œnginx æ— å…³ï¼Œæˆ‘ç›¸ä¿¡ä½ é€šè¿‡Google å¯ä»¥æ‰¾åˆ°æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2&gt;Phew&lt;/h2&gt;
&lt;p&gt;åˆ°æ­¤ï¼Œè¿™ä¸ªä¸»é¢˜å°±ç»“æŸäº†ã€‚å¦‚æœä½ è¿˜è¦æ›´å¤šçš„ä¼˜åŒ–ï¼Œæ˜¯æ—¶å€™è€ƒè™‘å¢åŠ é¢å¤–çš„æœåŠ¡å™¨æ¥æ‰©å¤§ä½ çš„æœåŠ¡è§„æ¨¡ï¼Œè€Œä¸æ˜¯æŠŠæ—¶é—´æµªè´¹åœ¨è¿›ä¸€æ­¥ä¼˜åŒ–nginx ä¸Šï¼Œè¿™æ˜¯å¦å¤–ä¸€ä¸ªè¯é¢˜ï¼Œæˆ‘å·²ç»ç ”ç©¶äº†ä¸€æ®µæ—¶é—´ã€‚å¦‚æœä½ å¯¹è¿™ç¯‡æ–‡ç« åªæœ‰2400 ä¸ªå­—æ„Ÿåˆ°å¥‡æ€ªï¼Œé‚£ä¹ˆè¯·ä¼‘æ¯ä¸€ä¸‹ï¼Œè¿›ä¸€æ­¥æ¢ç´¢æˆ‘çš„åšå®¢å§ï¼&lt;/p&gt;</content><category term="2016"></category><category term="nginx"></category></entry><entry><title>å…³é—­HPKP å’ŒHSTSçš„æ–¹æ³•</title><link href="https://fangpsh.github.io/posts/2016/2016-11-23.html" rel="alternate"></link><published>2016-11-23T11:11:30+08:00</published><updated>2016-11-23T11:11:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-11-23:/posts/2016/2016-11-23.html</id><summary type="html">&lt;p&gt;å¤§å®¶å¯¹äºHSTS ä¸€èˆ¬éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå¯¹HPKP å¯èƒ½æ¯”è¾ƒé™Œç”Ÿ,ç®€å•æ¥è¯´ç”±äºCA çš„å·¥ä½œæ¨¡å¼,å¯¼è‡´åˆ«äººæœ‰å¯èƒ½é€šè¿‡å…¶ä»–CA ç­¾å‘ä½ ç½‘ç«™ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å¤§å®¶å¯¹äºHSTS ä¸€èˆ¬éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œå¯¹HPKP å¯èƒ½æ¯”è¾ƒé™Œç”Ÿ,ç®€å•æ¥è¯´ç”±äºCA çš„å·¥ä½œæ¨¡å¼,å¯¼è‡´åˆ«äººæœ‰å¯èƒ½é€šè¿‡å…¶ä»–CA ç­¾å‘ä½ ç½‘ç«™çš„è¯ä¹¦,è¿™ä¸ªæ—¶å€™ä½ å°±éœ€è¦æœ‰ä¸€æ¡å¤´ä¿¡æ¯å£°æ˜ä½ ç½‘ç«™çš„è¯ä¹¦çš„æŒ‡çº¹æ˜¯ä»€ä¹ˆã€‚&lt;br&gt;
å…³äºHSTS å’ŒHPKP çš„ä»‹ç»å¯ä»¥æŸ¥çœ‹Jerry Qu çš„è¿™2ç¯‡æ–‡ç« :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://imququ.com/post/sth-about-switch-to-https.html"&gt;å…³äºå¯ç”¨ HTTPS çš„ä¸€äº›ç»éªŒåˆ†äº«ï¼ˆä¸€ï¼‰&lt;/a&gt;:åˆç†ä½¿ç”¨ HSTS&lt;/li&gt;
&lt;li&gt;&lt;a href="https://imququ.com/post/http-public-key-pinning.html"&gt;HTTP Public Key Pinning ä»‹ç»&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HSTS å’ŒHPKP éƒ½æ˜¯é€šè¿‡å¤´ä¿¡æ¯ä¼ é€’ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨éƒ½ä¼šæ ¹æ®max-age ç¼“å­˜èµ·æ¥ï¼Œæ‰€ä»¥åœ¨æ·»åŠ äº†HSTS å’ŒHPKP äº†ä¹‹åï¼Œæƒ³è¦å›æ»šï¼Œå°±æ²¡æœ‰åœ¨æœåŠ¡ç«¯å›æ»šç¨‹åºé‚£ä¹ˆæ–¹ä¾¿äº†ã€‚&lt;/p&gt;
&lt;p&gt;æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šé‡åˆ°è¦å…³é—­/ç§»é™¤ï¼š&lt;/p&gt;
&lt;p&gt;HSTS: è¿ç»´åŒå­¦åœ¨åˆšåˆšåšHTTPS çš„æ—¶å€™ï¼Œå¼€å¯äº†HSTSï¼Œç”šè‡³åŠ äº†includeSubDomainsï¼ŒæŸäº›è€å®¢æˆ·ç«¯è®¿é—®HTTPçš„æ¥å£çš„æ—¶å€™è·³åˆ°HTTSï¼Œç”±äºSNIã€åŠ å¯†å¥—ä»¶å…¼å®¹æ€§ç­‰é—®é¢˜å‡ºç°æ•…éšœ;&lt;/p&gt;
&lt;p&gt;HPKP: æ— è®ºæ˜¯ç”¨æ ¹è¯ä¹¦ã€ä¸­é—´è¯ä¹¦è¿˜æ˜¯ç«™ç‚¹è¯ä¹¦ç­¾å‘äº†æŒ‡çº¹ï¼Œè™½ç„¶HPKPæœ‰å¤‡ä»½æ–¹æ¡ˆï¼Œå³å‘é€å¤šä¸ªpin-shaï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦å‡†å¤‡è¯ä¹¦å‡ºç°æ•…éšœï¼Œè¦å…³é—­HPKPã€‚å¦å¤–è¦è®°å¾—æ·»åŠ report-uriï¼Œè¿™æ ·å‡ºé”™æ—¶ï¼ŒæœåŠ¡ç«¯èƒ½ä¸»åŠ¨çš„å‘ç°ä¸ŠæŠ¥çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ªäººè§‰å¾—HPKP å’ŒHSTS åœ¨è®¾è®¡ä¸Šå®åœ¨å¤ªåƒäº†ï¼Œå¦‚ä¸‹ä¾‹å­ï¼š&lt;/p&gt;
&lt;p&gt;HSTS:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Strict-Transport-Security: max-age=31536000; includeSubDomains
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;HPKP:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Public-Key-Pins:
      pin-sha256=&amp;quot;d6qzRu9zOECb90Uez27xWltNsj0e1Md7GkYYkVoZWmM=&amp;quot;;
      pin-sha256=&amp;quot;E9CZ9INDbd+2eRQozYqqbQ2yXLVKB9+xcprMF+44U1g=&amp;quot;;
      pin-sha256=&amp;quot;LPJNul+wow4m6DsqxbninhsWHlwfp0JecwQzYpOLmCQ=&amp;quot;;
      max-age=10000; includeSubDomains
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ‰€ä»¥åœ¨å…³é—­ï¼Œæˆ–è€…è¯´ç§»é™¤HSTSæˆ–HPKPçš„æ–¹å¼ä¸Šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å³max-age å­—æ®µæŒ‡å®šä¸º0&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸‹RFCï¼š&lt;/p&gt;
&lt;p&gt;HTST(&lt;a href="https://tools.ietf.org/html/rfc6797#section-8.1"&gt;RFC6797&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;The max-age value is essentially a &amp;quot;time to live&amp;quot; value relative
to the reception time of the STS header field.

If the max-age header field value token has a value of zero, the
UA MUST remove its cached HSTS Policy information (including the
includeSubDomains directive, if asserted) if the HSTS Host is
known, or the UA MUST NOT note this HSTS Host if it is not yet
known.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;HPKP(&lt;a href="https://tools.ietf.org/html/rfc7469#section-2.3.1"&gt;RFC7469&lt;/a&gt;):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;The max-age value is essentially a &amp;quot;time to live&amp;quot; value relative to
the time of the most recent observation of the PKP header field.  If
the max-age header field value token has a value of 0, the UA MUST
remove its cached Pinning Policy information (including the
includeSubDomains directive, if asserted) if the Pinned Host is
Known, or, MUST NOT note this Pinned Host if it is not yet Known.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœç„¶å¾ˆåƒã€‚ã€‚ã€‚å±…ç„¶ç…§æŠ„ã€‚&lt;br&gt;
å¦å¤–includeSubdomains ä¸¤è€…çš„å®šä¹‰ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚&lt;/p&gt;</content><category term="2016"></category><category term="https"></category></entry><entry><title>æ”¹è¿›ä¸€ä¸‹Ping</title><link href="https://fangpsh.github.io/posts/2016/2016-11-20.html" rel="alternate"></link><published>2016-11-20T20:18:30+08:00</published><updated>2016-11-20T20:18:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-11-20:/posts/2016/2016-11-20.html</id><summary type="html">&lt;p&gt;Ping æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å‘½ä»¤ï¼Œæœ‰2ç§æƒ…å†µä¼šä½¿ç”¨å®ƒï¼š&lt;br&gt;
ä¸€æ˜¯ä¼šä»æµè§ˆå™¨çš„åœ°å€æ æˆ–è€…å…¶ä»–äººå‘ç»™æˆ‘çš„ç½‘å€ï¼Œå¤åˆ¶ï¼Œç„¶åè¿›è¡Œpingï¼Œå¸¦ç€åè®®ä»¥åŠä¸€å † â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Ping æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„å‘½ä»¤ï¼Œæœ‰2ç§æƒ…å†µä¼šä½¿ç”¨å®ƒï¼š&lt;br&gt;
ä¸€æ˜¯ä¼šä»æµè§ˆå™¨çš„åœ°å€æ æˆ–è€…å…¶ä»–äººå‘ç»™æˆ‘çš„ç½‘å€ï¼Œå¤åˆ¶ï¼Œç„¶åè¿›è¡Œpingï¼Œå¸¦ç€åè®®ä»¥åŠä¸€å †uriå’Œargsï¼Œ&lt;br&gt;
ä¾‹å¦‚: &lt;code&gt;https://accounts.google.com/AddSession?hl=en...&lt;/code&gt;ï¼›&lt;br&gt;
äºŒä»Linux ç³»ç»Ÿçš„ç½‘ç»œåœ°å€å¤åˆ¶è¿‡æ¥IPï¼Œè¿›è¡ŒPingï¼Œå¸¦ç€æ©ç ä½æ•°ï¼Œ&lt;br&gt;
ä¾‹å¦‚ï¼š&lt;code&gt;192.168.1.1/32&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;ä»¥ä¸Š2ç§æƒ…å†µï¼Œå¦‚æœç›´æ¥å¤åˆ¶å†…å®¹åˆ°ç»ˆç«¯ï¼Œç„¶åpingï¼Œä¼šæç¤ºï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ping: cannot resolve ....: Unknown host
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¾ˆæ¼äººï¼Œå†™ä¸€ä¸ªç®€å•çš„è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/env bash&lt;/span&gt;
&lt;span class="c1"&gt;# issue:&lt;/span&gt;
&lt;span class="c1"&gt;#  - http(s)://xxx.xx/xxx/xx?xxx&lt;/span&gt;
&lt;span class="c1"&gt;#  - 192.168.1.1/32&lt;/span&gt;

&lt;span class="nv"&gt;new_args&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$@&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;sed&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/http.*\:\/\///&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/\/[^ ]*//&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="c1"&gt;#echo ${new_args}&lt;/span&gt;
ping&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;new_args&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠè¿™ä¸ªè„šæœ¬å‘½åä¸ºpin, æ”¾åˆ° &lt;code&gt;/bin&lt;/code&gt; ä¹‹ç±»çš„ç›®å½•ä¸‹é¢å³å¯ï¼ˆæœ¬æ¥æƒ³åšæˆaliasï¼Œæ²¡æˆåŠŸï¼‰ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š&lt;br&gt;
&lt;img alt="pin" src="/assets/images/2023/20230302145701.jpg"&gt;&lt;/p&gt;</content><category term="2016"></category><category term="shell"></category></entry><entry><title>å†™ä¸€ä¸ªPelican æ’ä»¶ï¼šRead More Link</title><link href="https://fangpsh.github.io/posts/2016/2016-11-15.html" rel="alternate"></link><published>2016-11-15T22:00:30+08:00</published><updated>2016-11-15T22:00:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-11-15:/posts/2016/2016-11-15.html</id><summary type="html">&lt;p&gt;&lt;img alt="another_read_more_link_demo" src="/assets/images/2023/20230301165914.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¹‹å‰ç”¨&lt;a href="http://octopress.org/"&gt;Octopress&lt;/a&gt; æ­å»ºåšå®¢çš„æ—¶å€™ï¼Œç”¨è¿‡ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨æ–‡ç« ä¸­æ’å…¥&lt;code&gt;&amp;lt;!-- more --&amp;gt;&lt;/code&gt;ä¹‹åï¼Œé¦–é¡µçš„æ–‡ç« åˆ—è¡¨åªä¼šæ˜¾ç¤ºè¿™ä¸ªæ ‡è®°ä¹‹å‰çš„å†…å®¹ï¼Œç„¶ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="another_read_more_link_demo" src="/assets/images/2023/20230301165914.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¹‹å‰ç”¨&lt;a href="http://octopress.org/"&gt;Octopress&lt;/a&gt; æ­å»ºåšå®¢çš„æ—¶å€™ï¼Œç”¨è¿‡ä¸€ä¸ªå¾ˆé…·çš„åŠŸèƒ½ï¼Œåœ¨æ–‡ç« ä¸­æ’å…¥&lt;code&gt;&amp;lt;!-- more --&amp;gt;&lt;/code&gt;ä¹‹åï¼Œé¦–é¡µçš„æ–‡ç« åˆ—è¡¨åªä¼šæ˜¾ç¤ºè¿™ä¸ªæ ‡è®°ä¹‹å‰çš„å†…å®¹ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªç±»ä¼¼ç»§ç»­é˜…è¯»çš„é“¾æ¥ã€‚åæ¥æœ‰ä¸€æ®µæ—¶é—´åˆ‡åˆ°Wordpressï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨Pelican ä¸Šæ²¡è§åˆ°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Inserting a &amp;lt;!-- more --&amp;gt; comment into your post will prevent the post content
below this mark from being displayed on the index page for the blog posts,
a &amp;quot;Continue â†’&amp;quot; button links to the full post.  
-- http://octopress.org/docs/blogging/
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨&lt;a href="https://github.com/getpelican/pelican-plugins"&gt;Pelica Plugins åˆ—è¡¨&lt;/a&gt;é‡Œç¿»äº†ä¸‹:  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/summary"&gt;summary&lt;/a&gt;ï¼Œéœ€è¦æ·»åŠ æ·»åŠ é¦–ä½2ä¸ªæ ‡è®°ï¼ˆçœ‹äº†ä¸‹æºä»£ç ï¼Œåªæ·»åŠ &lt;code&gt;&amp;lt;!-- PELICAN_END_SUMMARY --&amp;gt;&lt;/code&gt; ä¹Ÿå¯ä»¥ï¼Œå°±ä¼šä»å¤´å¼€å§‹ç®—ï¼‰ï¼Œä¸è¿‡ä¹Ÿä¸èƒ½æ·»åŠ ç»§ç»­é˜…è¯»çš„é“¾æ¥ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/read_more_link"&gt;read_more_link&lt;/a&gt;ï¼Œä¸è¿‡è¿™ä¸ªæ’ä»¶æ˜¯æŒ‡å®šSUMMARY_MAX_LENGTH,ä¹Ÿä¸ç¬¦åˆéœ€æ±‚ã€‚  &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥è§‰å¾—ä¸å¦‚è‡ªå·±å†™ä¸€ä¸ªï¼Œçœ‹äº†ä¸‹å®˜æ–¹æ•™ç¨‹&lt;a href="http://docs.getpelican.com/en/3.6.3/plugins.html#how-to-create-plugins"&gt;How to create plugins&lt;/a&gt; å’Œ read_more_link è¿™ä¸ªæ’ä»¶çš„æºä»£ç ï¼Œå°±èƒ½å®ç°äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#æ³¨å†Œå‡½æ•°ï¼Œå½“Pelican å‘é€all_generators_finalized ä¿¡å·æ—¶å€™ï¼Œè°ƒç”¨æ’ä»¶&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;register&lt;/span&gt;&lt;span class="p"&gt;():&lt;/span&gt;
    &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;signals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;all_generators_finalized&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;run_plugin&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;AttributeError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;signals&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;content_object_init&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;insert_read_more_link&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Pelican åœ¨é¦–é¡µå…¶å®æ˜¾ç¤ºçš„ä¸€ç¯‡æ–‡ç« çš„summaryï¼Œå³æˆ‘ä»¬åªéœ€è¦æ£€æµ‹æ–‡ç« ä¸­æ˜¯å¦å‡ºç°äº†&lt;code&gt;&amp;lt;!-- more --&amp;gt;&lt;/code&gt;ï¼Œå¦‚æœå‡ºç°äº†ï¼Œå°±æ”¹å†™æ–‡ç« çš„summaryï¼Œå†åŠ ä¸Šç»§ç»­é˜…è¯»çš„é“¾æ¥å³å¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;#å¯¹ç”Ÿæˆçš„æ–‡ç« å¯¹è±¡:article å¾ªç¯å¤„ç†&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;run_plugin&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;generators&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;generator&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;generators&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;ArticlesGenerator&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;article&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;generator&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;articles&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;insert_read_more_link&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;article&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;insert_read_more_link&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;span class="o"&gt;....&lt;/span&gt;&lt;span class="n"&gt;ç•¥&lt;/span&gt;

&lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_content&lt;/span&gt;

&lt;span class="n"&gt;marker_location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;find&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;!-- more --&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;marker_location&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;#å¦‚æœæ‰¾ä¸åˆ°æ³¨é‡Šæ ‡è®°ï¼Œå…ˆåˆ¤æ–­æ–‡ç« æ˜¯å¦å­˜åœ¨summaryï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±å°†summary è®¾ç½®ä¸ºå…¨æ–‡ï¼Œç„¶åé€€å‡ºæ’ä»¶&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_summary&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_summary&lt;/span&gt;
    &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_content&lt;/span&gt;
        &lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;has_summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt;
&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="c1"&gt;#æŒ‰ç…§æ£€ç´¢åˆ°æ³¨é‡Šæ ‡è®°çš„ä½ç½®ï¼Œæˆªå–æ–‡ç« å†…å®¹ä½œä¸ºsummary&lt;/span&gt;
    &lt;span class="n"&gt;summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;marker_location&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ANOTHER_READ_MORE_LINK&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;read_more_link&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt;  &lt;span class="n"&gt;ANOTHER_READ_MORE_LINK_FORMAT&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;text&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ANOTHER_READ_MORE_LINK&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;summary&lt;/span&gt;  &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;read_more_link&lt;/span&gt;

&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;summary&lt;/span&gt;
&lt;span class="n"&gt;instance&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;has_summary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹è½½æ’ä»¶åï¼Œåœ¨pelicanconf.py ä¸­é…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="n"&gt;PLUGIN_PATHS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/home/xxx/blog/xxx/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;PLUGINS&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;other_plugin&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;another_read_more_link&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;ANOTHER_READ_MORE_LINK&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;Continue -&amp;gt;&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é»˜è®¤æ·»åŠ çš„é“¾æ¥å¸¦æœ‰ä¸€ä¸ª&lt;code&gt;another-read-more-link&lt;/code&gt;å±æ€§ï¼Œç”¨æ¥è‡ªå®šä¹‰å–œæ¬¢çš„æ ·å¼ï¼š &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;a class=&amp;quot;another-read-more-link&amp;quot; href=&amp;quot;/{url}&amp;quot; &amp;gt;{text}&amp;lt;/a&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;.another-read-more-link {
    background: #eee;
    display: inline-block;
    padding: .4em .4em;
    margin-right: .5em;
    text-decoration: none;
    color: #737373;
    transition: background-color 0.5s;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•ˆæœè§ä¸Šæ–‡å›¾ç‰‡ã€‚&lt;/p&gt;
&lt;p&gt;æ’ä»¶æºç ï¼š&lt;a href="https://github.com/fangpsh/another_read_more_link"&gt;another_read_more_link&lt;/a&gt; ï¼Œ &lt;br&gt;
å› ä¸ºæ–°æ‰‹ä¸Šè·¯ï¼Œæºç ä¸Šå‚è€ƒread_more_linkï¼Œå¤–åŠ åŠŸèƒ½ä¹Ÿç±»ä¼¼ï¼Œæ‰€ä»¥èµ·äº†è¿™ä¹ˆä¸€ä¸ªåå­— :P&lt;/p&gt;</content><category term="2016"></category><category term="pelican"></category></entry><entry><title>ã€Šè½¯æŠ€èƒ½-ä»£ç ä¹‹å¤–çš„ç”Ÿå­˜æŒ‡å—ã€‹è¯»ä¹¦ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2016/2016-11-08.html" rel="alternate"></link><published>2016-11-08T11:51:30+08:00</published><updated>2016-11-08T11:51:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-11-08:/posts/2016/2016-11-08.html</id><summary type="html">&lt;p&gt;&lt;img alt="soft_skills.jpg" src="/assets/images/2023/20230301171643.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://book.douban.com/subject/26835090/"&gt;ã€Šè½¯æŠ€èƒ½-ä»£ç ä¹‹å¤–çš„ç”Ÿäº§æŒ‡å—ã€‹&lt;/a&gt;è¿™æœ¬ä¹¦å‡ºæ¥çš„æ—¶å€™ï¼Œåœ¨Twitter ä¸Šæ”¶åˆ°å¾ˆå¤§çš„å…³æ³¨ã€‚ä¹‹å‰ä¸ªäººå¯¹è¿™ç±»ä¹¦ç±æ˜¯æœ‰ç‚¹ä¸å±‘çš„ï¼Œæœ‰ç‚¹æˆåŠŸå­¦ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="soft_skills.jpg" src="/assets/images/2023/20230301171643.png"&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://book.douban.com/subject/26835090/"&gt;ã€Šè½¯æŠ€èƒ½-ä»£ç ä¹‹å¤–çš„ç”Ÿäº§æŒ‡å—ã€‹&lt;/a&gt;è¿™æœ¬ä¹¦å‡ºæ¥çš„æ—¶å€™ï¼Œåœ¨Twitter ä¸Šæ”¶åˆ°å¾ˆå¤§çš„å…³æ³¨ã€‚ä¹‹å‰ä¸ªäººå¯¹è¿™ç±»ä¹¦ç±æ˜¯æœ‰ç‚¹ä¸å±‘çš„ï¼Œæœ‰ç‚¹æˆåŠŸå­¦çš„å‘³é“ã€‚æˆ‘ä¹‹å‰ä¹Ÿæ˜¯ä¸å–œæ¬¢åšèŒä¸šè§„åˆ’çš„ï¼Œåªæ˜¯å¸Œæœ›æŒ‰ç…§ä¸ªäººçš„å…´è¶£é€‰æ‹©å‘å±•ã€‚ä¸è¿‡æ¯•ä¸šä¸€å¹´å¤šï¼Œæ—¥å¤ä¸€æ—¥çš„ä¸Šç­ï¼Œè®©æˆ‘è€ƒè™‘ï¼Œå¾—è®¡åˆ’ä¸€ä¸‹è‡ªå·±çš„äººç”Ÿï¼Œæ•´ç†ä¸€ä¸‹äº†ã€‚&lt;/p&gt;
&lt;h2&gt;èŒä¸š&lt;/h2&gt;
&lt;h3&gt;èŒä¸šè§„åˆ’å’Œåˆ¶å®šç›®æ ‡&lt;/h3&gt;
&lt;p&gt;ç¬¬2ç« æœ‰ä¸€å¥è¯ï¼š  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œå…¶å®ä½ å’Œä¸­ä¸–çºªå°é•‡ä¸Šå¼€é“åŒ é“ºçš„é“åŒ æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚â€  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½œè€…åœ¨è¿™é‡Œæ˜¯ä¸ºäº†æ•™å¯¼æˆ‘ä»¬ç¨‹åºå‘˜â€œæŠŠè‡ªå·±å½“ä½œä¸€ä¸ªä¼ä¸šå»æ€è€ƒâ€ï¼Œä¸è¦äº§ç”Ÿæ˜¯â€œä¸ºæŸå®¶å…¬å¸æ‰“å·¥â€çš„å¿ƒæ€ã€‚ç„¶åæŒ‰ç…§è¿™ä¸ªæ€è·¯è¿›è¡Œæ€è€ƒï¼Œæ”¹å˜å·¥ä½œæ€åº¦ã€å·¥ä½œè®¡åˆ’ç­‰ç­‰ã€‚
é¡ºç€è¿™ä¸ªæ€è·¯ï¼Œå°±ä¼šå‘ç°ç¨‹åºå‘˜ç°åœ¨æŸäº›å²—ä½çš„é«˜è–ªï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä¾›éœ€å†³å®šçš„ã€‚ä¸å°‘ç¨‹åºå‘˜è§‰å¾—è‡ªå·±å¾ˆâ€œç‰›é€¼â€ï¼Œæ‰€ä»¥æ¯•ä¸šå°±èƒ½æ‹¿ç€é«˜è–ªã€‚åº”è¯¥è¦è®¤è¯†åˆ°å¸‚åœºä¼šå˜åŒ–ï¼Œç¨‹åºå‘˜çš„äººæ•°å¤šèµ·æ¥ï¼ŒæŠ€æœ¯çº¢åˆ©å°±è¦æ¶ˆæ•£äº†ã€‚&lt;br&gt;
ä¸ºäº†åœ¨å°†æ¥æœ‰æ›´å¥½çš„ç«äº‰åŠ›ï¼Œä½œä¸ºä¸€ä¸ªäººçš„å…¬å¸ï¼Œæˆ‘ä»¬å°±åº”è¯¥æå‡è‡ªå·±çš„æœåŠ¡æ°´å‡†ï¼Œå’Œå…¶ä»–åŒç±»ç¨‹åºå‘˜ç›¸æ¯”æ›´åŠ å‡ºè‰²ã€‚è™½ç„¶è¿™æ ·è¯´ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å–œæ¬¢å‡ºå‘ç‚¹æ˜¯è§‰å¾—æŠ€æœ¯æœ‰è¶£ã€‚&lt;strong&gt;ä½œè€…åœ¨ä¹¦ä¸­å»ºè®®æˆ‘ä»¬æå‡æœåŠ¡çš„åŒæ—¶ï¼Œä¸“æ³¨äºæä¾›æŸä¸€ç‰¹å®šç±»å‹çš„å®¢æˆ·æˆ–è€…æœåŠ¡ï¼Œæˆä¸ºä¸“å®¶ã€‚&lt;/strong&gt;&lt;br&gt;
æ¯å¹´æ ¡æ‹›å­£èŠ‚ï¼Œå¸¸å¸¸åœ¨&lt;a href="https://v2ex.com"&gt;v2ex&lt;/a&gt; ä¸Šçœ‹åˆ°åº”å±Šç”Ÿå‘å¸–è¯¢é—®Offer çš„é€‰æ‹©ã€‚Offer ä¹‹é—´æœ‰è–ªé…¬ã€å²—ä½ã€åœ°ç‚¹ç­‰ç­‰çš„å·®åˆ«ï¼Œå…¶å®å¦‚æœè®¾å®šè‡ªå·±çš„ç›®æ ‡ï¼Œæœ‰äº†ç›®æ ‡ä¹‹åï¼Œä½œé€‰æ‹©çš„æ—¶å€™ä¼šæ›´åŠ å®¹æ˜“å§ã€‚&lt;br&gt;
ä½œè€…åœ¨è®¾å®šç›®æ ‡è¿™ä»¶äº‹æƒ…ä¸Šï¼Œå»ºè®®è®¾å®šç›®æ ‡ä¹‹åï¼Œè®¾å®šè·¯çº¿ï¼Œè¾¾åˆ°è‹¥å¹²ä¸ªå°ç›®æ ‡ï¼Œé€æ¸å‘å¤§ç›®æ ‡å‰è¿›ï¼Œå¹¶â€œå®šæœŸæ ¸å®šè‡ªå·±çš„ç›®æ ‡â€ï¼Œè°ƒæ•´è®¡åˆ’å’Œæ–¹å‘ã€‚  &lt;/p&gt;
&lt;h3&gt;äººé™…äº¤å¾€&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œåˆ«ç®¡æˆ‘ï¼Œæˆ‘åªæƒ³ä¸€ä¸ªäººå®‰é™åœ°å†™ä»£ç ï¼â€
æˆ‘ä¹Ÿæ›¾ç»è¿™æ ·æƒ³ï¼Œå¾ˆå¤šç¨‹åºå‘˜éƒ½å–œæ¬¢è¿™æ ·åšï¼Œè‡ªå·±ä¸€ä¸ªäººæˆ´ç€è€³æœºï¼Œå®‰é™çš„å†™ä»£ç ï¼Œæ˜¯æˆ‘ä»¬æœ€å–œæ¬¢åšçš„äº‹æƒ…ã€‚ä¸è¿‡ï¼ŒæŒ‰ç…§å‰æ–‡çš„æ€è·¯ï¼Œæˆ‘ä»¬æ˜¯åœ¨æä¾›æœåŠ¡ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£éœ€æ±‚ï¼Œéœ€è¦å’Œå…¶ä»–äººåˆä½œï¼Œæ‰€ä»¥äººé™…äº¤å¾€æ˜¯ä¸å¯é¿å…çš„ï¼Œä½†æ˜¯ç¨‹åºå‘˜å¾ˆå¤šæ—¶å€™äººé™…äº¤å¾€èƒ½åŠ›ç›¸æ¯”å…¶ä»–å²—ä½çš„äººå·®ä¸€äº›ï¼Œæˆ‘ä»¬æƒ³æ›´å¤šçš„æ—¶å€™ï¼Œæ˜¯æˆ‘ä»¬æ›´å–œæ¬¢â€œå®‰é™åœ°å†™ä»£ç â€ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å…¶ä»–çš„æ€§æ ¼ç¼ºé™·ã€‚å¿ƒæ€ä¸Šç¨å¾®åšäº›æ”¹å˜ï¼Œå·¥ä½œä¼šæ›´åŠ é¡ºåˆ©ã€‚&lt;br&gt;
ä½œè€…åˆ—äº†ä»¥ä¸‹å‡ ä¸ªä¸äººæ‰“äº¤é“çš„è¦ç‚¹ï¼Œï¼ˆæˆ‘ä¸å–œæ¬¢æŠŠä»–ä»¬ç§°ä¸ºæŠ€å·§ï¼Œæ„Ÿè§‰å¾ˆè™šä¼ªï¼‰ï¼š  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;â€œæ¯ä¸ªäººéƒ½å¸Œæœ›æ„Ÿåˆ°è‡ªå·±å¾ˆé‡è¦â€&lt;ul&gt;
&lt;li&gt;æ³¨æ„å°Šé‡ä»–äººï¼Œä¸è´¬ä½ä»–äººã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;â€œæ°¸è¿œä¸è¦æ‰¹è¯„â€ï¼Œâ€œç”¨è¡¨æ‰¬ä»£æ›¿æ‰¹è¯„â€&lt;/li&gt;
&lt;li&gt;â€œæ¢ä½æ€è€ƒâ€ï¼Œâ€œä»å¯¹æ–¹å¿ƒæ€å‡ºå‘æå‡ºå»ºè®®â€ï¼Œç«™åœ¨å¯¹æ–¹çš„ä½ç½®å’ŒèŒä½ä¸Šæ€è€ƒé—®é¢˜ï¼Œä¸è¦æ€»è§‰å¾—äº§å“ç»ç†æ˜¯å‚»é€¼XD&lt;/li&gt;
&lt;li&gt;â€œé¿å…äº‰åµâ€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è™½ç„¶è¿™æ ·è¯´ï¼Œä½†æ˜¯å¦‚æœé‡åˆ°å®åœ¨æ— æ³•ç›¸å¤„çš„äººï¼Œâ€œè‹›æ€§ç¢±â€çš„äººï¼Œä¸è¦ç™½è´¹åŠŸå¤«ï¼Œæƒ¹ä¸èµ·å°±èº²å§ã€‚&lt;br&gt;
å¦å¤–ä½œè€…å¤šæ¬¡æ¨èäº†å¡è€åŸºçš„&lt;a href="https://book.douban.com/subject/1837006/"&gt;ã€Šäººæ€§çš„å¼±ç‚¹ã€‹&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;h3&gt;é¢è¯•ä¹‹é“&lt;/h3&gt;
&lt;p&gt;ä½œè€…çš„æ€è·¯å³åœ¨é¢è¯•ä¹‹å‰æ¥è§¦åˆ°é¢è¯•å®˜ï¼Œä¾‹å¦‚é€šè¿‡åœ¨ç›®æ ‡å…¬å¸çš„èŒå‘˜çš„åšå®¢ä¸‹ç•™è¨€äº¤æµï¼Œæˆ–è€…é¢è¯•çš„æ—¶å€™å¥—å¥½æ„Ÿï¼Œè¿™æ‹›åœ¨æˆ‘çœ‹æ¥æ€»è§‰å¾—æœ‰ç‚¹ä¸‹ä½œï¼Œä¸è¿‡å›½å¤–çš„äººä¼¼ä¹å¹¶ä¸ä»‹æ„ï¼Œä¾‹å¦‚å›½å†…å­¦ç”Ÿç”³è¯·æµ·å¤–ç ”ç©¶ç”Ÿéƒ½å–œæ¬¢äº‹å…ˆå’Œæ•™æˆå¥—ç£ï¼Œå¥½åƒè¿˜å¿…ä¸å¯å°‘ã€‚&lt;br&gt;
è¿˜æœ‰ä½œè€…å¼ºè°ƒäº†â€œå†…æ¨â€çš„é‡è¦æ€§ã€‚  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ ç»Ÿæ±‚èŒæ–¹æ³•&lt;ul&gt;
&lt;li&gt;å‘å‡ºä¸€å †ç®€å†-&amp;gt; è·å¾—é¢è¯•æœºä¼š-&amp;gt; é¢è¯•&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ”¹è¿›çš„æ±‚èŒæ–¹æ³•&lt;ul&gt;
&lt;li&gt;ä»æœŸå¾…åŠ å…¥çš„å…¬å¸é‡Œæ‰¾åˆ°è”ç³»äºº -&amp;gt; ä¸è¯¥è”ç³»äººå»ºç«‹ç´§å¯†å…³ç³» -&amp;gt; è·å¾—ä¸ªäººæ¨è -&amp;gt; æ¨è&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä¹Ÿè§‰å¾—å†…æ¨æ˜¯å¾ˆæœ‰æ•ˆçš„ï¼Œä¹‹å‰æ±‚èŒä¹Ÿä¼šæ‰¾å¸ˆå…„æœ‹å‹å†…æ¨ï¼Œä¸è¿‡æ€»ä¹‹ï¼Œå°‘ä¸€ç‚¹å¥—è·¯ï¼Œå¤šä¸€ç‚¹çœŸè¯šå§ã€‚  &lt;/p&gt;
&lt;p&gt;å¦å¤–ä»ä¼ä¸šçš„è§’åº¦å‡ºå‘ï¼Œé¢è¯•çš„æ—¶å€™â€œè¦é›†ä¸­ç²¾åŠ›è¯æ˜è‡ªå·±å°±æ˜¯æ— éœ€ç›‘ç£ä¹Ÿèƒ½è‡ªåŠ¨è‡ªå‘çš„åšå¥½äº‹æƒ…çš„å‘˜å·¥â€ï¼Œå½“ç„¶ä¹Ÿè¦è¯æ˜â€œåœ¨æŠ€æœ¯ä¸Šç¡®å®èƒœä»»å·¥ä½œâ€ï¼Œâ€œéå¸¸èƒ½å¹²ï¼Œä¸ä¼šè¢«å›°éš¾é˜»æŒ¡â€ï¼Œå¸Œæœ›éƒ½èƒ½è¯´é“åšåˆ°å§ï¼Œæ¯•ç«ŸæŠ€å·§éƒ½æ˜¯å…¶æ¬¡çš„ï¼Œå®åŠ›æ‰æ˜¯å…³é”®ã€‚  &lt;/p&gt;
&lt;h3&gt;å°±ä¸šé€‰æ‹©&lt;/h3&gt;
&lt;p&gt;ä½œè€…ç½—åˆ—äº†ä½œä¸ºé›‡å‘˜ã€ç‹¬ç«‹å’¨è¯¢å¸ˆå’Œåˆ›ä¸šè€…çš„å¥½å¤„å’Œå¼Šç«¯ï¼Œè¿˜æ˜¯å»ºè®®åœ¨ä½œå‡ºå…·æœ‰é£é™©çš„é€‰æ‹©çš„æ—¶å€™ï¼Œæœ‰äº‹å…ˆçš„å‡†å¤‡ã€‚&lt;/p&gt;
&lt;h3&gt;æˆä¸ºç»†åˆ†é¢†åŸŸçš„ä¸“å®¶&lt;/h3&gt;
&lt;p&gt;ä¸“ä¸šåŒ–ä¸å¦¨ç¢æŠ€æœ¯å…¨é¢ï¼Œåªæ˜¯åº”è¯¥å…ˆæ³¨é‡æ·±åº¦ã€‚ä¸è¿‡æˆ‘ä¸ªäººè®¤ä¸ºï¼Œå½“é€‰æ‹©ä¸“ä¸šåŒ–çš„æ–¹å‘çš„æ—¶å€™ï¼Œé™¤äº†è€ƒè™‘è‡ªå·±çš„å…´è¶£ï¼Œä¹Ÿåº”è¯¥è€ƒè™‘å¸‚åœºéœ€æ±‚å’Œä»¥åçš„å‘å±•ã€‚  &lt;/p&gt;
&lt;h3&gt;å…¬å¸é€‰æ‹©ä¸æ™‹å‡&lt;/h3&gt;
&lt;p&gt;â€œé€‰æ‹©å°å…¬å¸æˆ–åˆåˆ›å…¬å¸å·¥ä½œçš„ä¸€ä¸ªæ›´å¥½çš„ç†ç”±æ˜¯ï¼Œä½ å–œæ¬¢é‚£ç§å¿«èŠ‚å¥çš„ã€ä»¤äººå…´å¥‹çš„å·¥ä½œç¯å¢ƒï¼Œä¹Ÿå¸Œæœ›æ„å»ºä¼Ÿå¤§çš„äº§å“å¹¶è§è¯å®ƒçš„æˆé•¿â€ï¼Œå¦‚æœæ˜¯ä¸ºæœŸæƒè‚¡ç¥¨é€‰æ‹©å°å…¬å¸ï¼Œé£é™©å¤ªé«˜ã€‚&lt;br&gt;
ä¸­ç­‰è§„æ¨¡çš„å…¬å¸ä¼šæ›´ç¨³å®šï¼Œä½†æ˜¯ä¹Ÿæ›´åŠ æ­»æ¿ï¼Œæ­»æ¿ä¼šæç°åœ¨å„ä¸ªæ–¹æ¡ˆï¼Œä¾‹å¦‚æŠ€æœ¯é€‰å‹ã€å†…éƒ¨æµç¨‹ä¸Šç­‰ç­‰ã€‚å¤§å…¬å¸çš„è¯ï¼Œåˆ™æ›´åŠ æ³¨é‡è§„èŒƒå’Œæµç¨‹ï¼Œä¹Ÿä¼šæ³¨é‡åˆ›æ–°ï¼Œä½†æ˜¯åŠå…¬å®¤æ”¿æ²»ä¸¥é‡ã€‚&lt;br&gt;
å¦å¤–ä½œè€…æåˆ°&lt;strong&gt;ç¨‹åºå‘˜æœ€å¥½å»ä»¥è½¯ä»¶å¼€å‘ä¸šåŠ¡ä¸ºä¸»çš„å…¬å¸ï¼Œè€Œä¸æ˜¯æŠŠè½¯ä»¶å¼€å‘ä½œä¸ºå†…éƒ¨ç³»ç»Ÿæˆ–è€…è¾¹ç¼˜éƒ¨é—¨çš„å…¬å¸ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å…³äºæ™‹å‡ï¼Œä½œè€…æåˆ°ä¸¤ç‚¹ï¼Œâ€œæ‰¿å½“æ›´å¤šè´£ä»»â€å’Œâ€œå¼•äººæ³¨ç›®â€ï¼Œæ„Ÿè§‰ç•¥å¿ƒæœºã€‚ã€‚ã€‚å¯æ˜¯ç°å®å°±æ˜¯è¿™æ ·ã€‚è¿˜æœ‰å°±æ˜¯è‡ªå­¦ï¼Œä¸æ–­å­¦ä¹ æå‡è‡ªèº«æŠ€èƒ½æ°´å¹³ã€‚&lt;br&gt;
è™½ç„¶æœ‰è¿™ä¹ˆå¤šæŠ€å·§ï¼Œæœ€é‡è¦æ˜¯æ³¨é‡è‡ªèº«ã€æå‡èƒ½åŠ›ã€å±•ç°è‡ªå·±ï¼Œè€Œä¸æ˜¯èŠ±æ—¶é—´ç©å¼„åŠå…¬å®¤æ”¿æ²»ï¼Œè¦æ´èº«è‡ªå¥½ã€‚&lt;/p&gt;
&lt;h3&gt;ä¸“ä¸šäººå£«&lt;/h3&gt;
&lt;p&gt;â€œæˆä¸ºä¸“ä¸šäººå£«çš„å…¨éƒ¨åœ¨äºï¼šå¼•å…¥æ³¨ç›®ï¼Œå…‹å°½èŒå®ˆï¼Œä»¥åŠä¸å±ˆæœäºæŒ«æŠ˜ã€‚â€&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;éµå®ˆè‡ªå·±çš„åŸåˆ™&lt;/li&gt;
&lt;li&gt;ä¸“æ³¨äºæ­£ç¡®å®Œæˆå·¥ä½œ&lt;/li&gt;
&lt;li&gt;ä¸æƒ§æ€•æ‰¿è®¤è‡ªå·±é”™äº†ï¼Œä¸ä¼šæ–‡è¿‡é¥°é&lt;/li&gt;
&lt;li&gt;æŒç»­ç¨³å®šï¼Œè¿½æ±‚å“è´¨ï¼Œé«˜æ ‡å‡†&lt;/li&gt;
&lt;li&gt;å‹‡äºæ‰¿æ‹…è´£ä»»&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;è‡ªç”±èŒä¸šç›¸å…³&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;â€œä¸è¦è´¸ç„¶è¾èŒï¼Œè¸ä¸Šåˆ›ä¸šä¹‹è·¯ã€‚â€&lt;/strong&gt;&lt;br&gt;
ä½œè€…ä»‹ç»äº†å¦‚ä½•åšå‡†å¤‡ï¼Œæœ€å¥½è®¡åˆ’å†è¾èŒï¼Œä¸è¦è´¸ç„¶è¡ŒåŠ¨ã€‚ä»¥åŠå¦‚ä½•æ¨é”€è‡ªå·±ï¼ˆé‚®ä»¶ã€åšå®¢ã€å…è´¹çš„æ¼”è®²ç­‰ï¼‰å’Œæ”¶è´¹å®šä»·ï¼ˆæ€»çš„æ¥è¯´ï¼Œå°±æ˜¯å°½é‡æé«˜ï¼Œå¦‚æœå¯¹æ–¹èƒ½æ¥å—ï¼‰ã€‚å¦å¤–æ‰¾åˆ°å—ä¼—éœ€æ±‚å†å¼€å‘äº§å“ï¼Œè€Œä¸æ˜¯åè¿‡æ¥ã€‚  &lt;/p&gt;
&lt;h3&gt;â€œå‡è£…è‡ªå·±èƒ½æˆåŠŸâ€&lt;/h3&gt;
&lt;p&gt;â€œä¸è¦å°†è¿™ä¸æ’’è°æ··ä¸ºä¸€è°ˆã€‚æˆ‘ä¸æ˜¯å»ºè®®ä½ å‘æœªæ¥çš„é›‡ä¸»å±•ç¤ºè‡ªå·±ä¸å…·å¤‡çš„æŠ€èƒ½ï¼Œå£°ç§°è‡ªå·±å…·å¤‡å°šä¸å…·å¤‡çš„èƒ½åŠ›ã€‚ç›¸åï¼Œæˆ‘å»ºè®®ä½ å¦ç‡ã€è¯šå®çš„é¢å¯¹è‡ªå·±çš„èƒ½åŠ›æˆ–ä¸è¶³ï¼ŒåŒäº‹ä¿æŒâ€œæˆ‘ä»¥å‰å·²ç»å…‹æœè¿‡é‚£äº›å›°éš¾â€çš„å¿ƒæ€å’Œå§¿æ€ï¼Œå› ä¸ºä½ æ¸…æ¥šåœ°çŸ¥é“ï¼Œå”¯ä¸€æ¨ªäº˜åœ¨â€œç°åœ¨çš„ä½ â€å’Œâ€œæœªæ¥çš„ä½ â€ä¹‹é—´çš„æ˜¯æ—¶é—´â€ï¼Œæ€»ä¹‹ï¼Œå°±æ˜¯è¦è‡ªä¿¡ã€‚&lt;/p&gt;
&lt;h3&gt;ç®€å†&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è®¾è®¡ç®€å†ï¼Œä½œè€…å»ºè®®è¯·ä¸“ä¸šçš„äººä»£å†™ç®€å†&lt;/li&gt;
&lt;li&gt;å‡†å¤‡åœ¨çº¿çš„ç®€å†ï¼Œæ–¹ä¾¿åˆ†å‘&lt;/li&gt;
&lt;li&gt;ç®€å†ç»å¯¹ä¸è¦å‡ºç°é”™åˆ«å­—&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;è¯·å‹¿é™·å…¥å¯¹æŠ€æœ¯çš„ç‹‚çƒ­ä¹‹ä¸­&lt;/h3&gt;
&lt;p&gt;é€‰æ‹©Emacs è¿˜æ˜¯Vim éƒ½å¥½ï¼Œæœ‰æ¿€æƒ…ã€çƒ­æƒ…å’Œç‹‚çƒ­æ˜¯ä¸ä¸€æ ·çš„ï¼Œåè€…åªä¼šè®©äººå˜çš„ç‹­éš˜ï¼Œâ€œå¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ æ„¿æ„å¯¹æŠ€æœ¯ä¿æŒå¼€æ”¾çš„å¿ƒæ€ï¼Œè€Œä¸æ˜¯å›ºå®ˆè‡ªå·±å·²ç»äº†è§£çš„æŠ€æœ¯ï¼Œå£°ç§°å®ƒæ˜¯æœ€å¥½çš„ï¼Œä½ ä¼šå‘ç°æœ‰æ›´å¤šçš„æœºä¼šä¸ºä½ æ•å¼€å¤§é—¨ã€‚â€&lt;/p&gt;
&lt;h2&gt;è‡ªæˆ‘è¥é”€&lt;/h2&gt;
&lt;h3&gt;å†™åšå®¢&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;â€œéœ€è¦æŒä¹‹ä»¥æ’â€&lt;/strong&gt;&lt;br&gt;
â€œè‡ªæˆ‘è¥é”€çš„åŸºæœ¬æœºåˆ¶æ˜¯ï¼Œè¦æƒ³è®©äººä»¬è¿½éšã€å€¾å¬ä½ ï¼Œä½ å°±è¦å¸¦ç»™ä»–ä»¬ä»·å€¼ï¼šä½ èƒ½ä¸ºä»–ä»¬çš„é—®é¢˜æä¾›ç­”æ¡ˆï¼Œè®¾ç½®æ˜¯ç»™ä»–ä»¬å¸¦å»å¿«ä¹ã€‚â€&lt;br&gt;
ä¸è¿‡æˆ‘ä¸ªäººå†™åšå®¢ï¼Œé¦–å…ˆè¿˜æ˜¯ä¸ºäº†è‡ªæˆ‘ç§¯ç´¯ï¼Œè‡ªå·±çš„å­¦ä¹ æ€»ç»“ï¼Œç„¶åå¦‚æœè¿™äº›å†…å®¹èƒ½ç»™åˆ«äººå¸¦æ¥æ–¹ä¾¿ï¼Œé‚£æ˜¯æœ€å¥½ä¸è¿‡çš„äº†ã€‚&lt;/p&gt;
&lt;h3&gt;ä¸»è¦ç›®æ ‡ï¼šä¸ºä»–äººå¢åŠ ä»·å€¼&lt;/h3&gt;
&lt;h3&gt;æŠŠå·¥ä½œæˆæœçš„90% éƒ½åšæˆå…è´¹çš„&lt;/h3&gt;
&lt;h3&gt;æ¼”è®²&lt;/h3&gt;
&lt;p&gt;æ¼”è®²å’Œåšåˆ†äº«ç¡®å®èƒ½è®©äººå‡ºåï¼Œä¸è¿‡å›½å†…å„ç§å¤§ä¼šä¸Šçš„åˆ†æè€…è¿™ä¸ªç›®çš„å¤ªæ˜æ˜¾äº†ï¼Œç”±äºç›®çš„ä¸çº¯ï¼Œåˆ†äº«çš„å†…å®¹ä¹Ÿå°±ä¸å¸å¼•äººï¼Œæˆ–è€…æ°´åˆ†ç•¥å¤§ã€‚&lt;/p&gt;
&lt;h3&gt;åšåŸ¹è®­ã€å†™ä¹¦&lt;/h3&gt;
&lt;p&gt;è¿™ä¸€ç« ï¼ŒæŸäº›åœ°æ–¹è§‰å¾—ä½œè€…å˜´è„¸æœ‰ç‚¹æ¶å¿ƒï¼Œåšè„¸çš®ï¼Œå……æ»¡å¿ƒæœºï¼Œå‡ºå‘ç‚¹ä¸å•çº¯ã€‚&lt;/p&gt;
&lt;h2&gt;å­¦ä¹ &lt;/h2&gt;
&lt;p&gt;æŒç»­å­¦ä¹ ï¼Œä¹äºå­¦ä¹ ã€‚&lt;br&gt;
åæ­¥å­¦ä¹ æ³•ï¼š  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;äº†è§£å…¨å±€&lt;/li&gt;
&lt;li&gt;ç¡®å®šèŒƒå›´&lt;/li&gt;
&lt;li&gt;å®šä¹‰ç›®æ ‡&lt;/li&gt;
&lt;li&gt;å¯»æ‰¾èµ„æº&lt;/li&gt;
&lt;li&gt;åˆ›å»ºå­¦ä¹ è®¡åˆ’&lt;/li&gt;
&lt;li&gt;ç­›é€‰èµ„æº&lt;/li&gt;
&lt;li&gt;å¼€å§‹å­¦ä¹ ï¼Œæµ…å°è¾„æ­¢&lt;/li&gt;
&lt;li&gt;åŠ¨æ‰‹æ“ä½œï¼Œè¾¹ç©è¾¹å­¦&lt;/li&gt;
&lt;li&gt;å…¨é¢æŒæ¡ï¼Œå­¦ä»¥è‡´ç”¨&lt;/li&gt;
&lt;li&gt;ä¹ä¸ºäººå¸ˆï¼Œèä¼šè´¯é€š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€œèšç„¦å­¦ä¹ èŒƒå›´ï¼Œå…³æ³¨é‡ç‚¹å†…å®¹â€ï¼Œâ€œè‡ªæˆ‘æ¢ç´¢â€ï¼Œâ€œä¸»åŠ¨å­¦ä¹ â€ï¼›&lt;br&gt;
ç¬¬1æ­¥åˆ°ç¬¬6æ­¥ï¼Œè¿™äº›æ­¥éª¤åªåšä¸€æ¬¡ï¼›&lt;br&gt;
ç¬¬7æ­¥åˆ°ç¬¬10æ­¥ï¼Œå¾ªç¯å¾€å¤ã€‚  &lt;/p&gt;
&lt;h3&gt;å­¦ä½&lt;/h3&gt;
&lt;p&gt;â€œå­¦ä½å¹¶ä¸æ˜¯æˆåŠŸçš„å¿…å¤‡æ¡ä»¶â€ï¼Œ&lt;br&gt;
â€œæ²¡æœ‰å­¦ä½ä¼šé™åˆ¶ä½ çš„é€‰æ‹©â€ã€‚  &lt;/p&gt;
&lt;h2&gt;ç”Ÿäº§åŠ›&lt;/h2&gt;
&lt;h3&gt;ä¸“æ³¨&lt;/h3&gt;
&lt;h3&gt;å¯¹è‡ªå·±è´Ÿè´£&lt;/h3&gt;
&lt;h3&gt;å¤šä»»åŠ¡å¹¶è¡Œå¤„ç†&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åœæ­¢ä»»ä½•å¹¶éçœŸæ­£çš„å¤šä»»åŠ¡å¹¶è¡Œçš„å¤šä»»åŠ¡å¹¶è¡Œï¼Œæ¯å¤©åŠ›äº‰åœ¨ä¸€ä¸ªæ—¶é—´æ®µå†…åªåšä¸€ä»¶äº‹ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ¬¡æ€§æ‰¹é‡å¤„ç†å°ä»»åŠ¡ï¼Œè€Œä¸æ˜¯æ¯å¤©æˆ–æ¯å‘¨é‡Œåšå¾ˆå¤šæ¬¡&lt;/li&gt;
&lt;li&gt;æ‰¾å‡ºèƒ½å¤ŸçœŸæ­£å®ç°å¤šä»»åŠ¡å¹¶è¡Œçš„é¢†åŸŸã€‚ä»»ä½•ä¸éœ€è¦è€—è´¹è„‘åŠ›çš„æ´»åŠ¨éƒ½å¯ä»¥è·Ÿå…¶ä»–æ´»åŠ¨ç»“åˆèµ·æ¥ã€‚åªè¦è¿›è¡Œä»»ä½•éœ€è¦è€—è´¹è„‘åŠ›çš„æ´»åŠ¨ï¼Œå°±å°†å…¶ä¸ä½“è‚²è¿åŠ¨ç»“åˆèµ·æ¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;æ—¶é—´æ€æ‰‹&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç”µè§†&lt;/li&gt;
&lt;li&gt;ç¤¾äº¤åª’ä½“&lt;/li&gt;
&lt;li&gt;å¼€ä¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;åˆ†è§£ä»»åŠ¡&lt;/h3&gt;
&lt;h3&gt;ä»»ä½•è¡ŒåŠ¨éƒ½æ¯”ä¸é‡‡å–è¡ŒåŠ¨å¥½&lt;/h3&gt;
&lt;h2&gt;ç†è´¢&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦æœ‰èµšå¤šå°‘ï¼ŒèŠ±å¤šå°‘çš„çŸ­æœŸæ€ç»´&lt;/li&gt;
&lt;li&gt;â€œå½“ä½ æ‹¥æœ‰ä¸€å¥—æˆ¿å­çš„æ—¶å€™ï¼Œæœ¬è´¨ä¸Šä½ ä¸è¿‡å°±æ˜¯ä»è‡ªå·±æ‰‹é‡Œç§Ÿäº†ä¸€å¥—æˆ¿å­è€Œå·²â€ï¼›â€œå¦‚æœä½ çš„æˆ¿å­çš„ä»·é’±é«˜äºä½ æ‰€éœ€è¦çš„åŸºæœ¬ä½æ‰€çš„è´¹ç”¨ï¼Œé‚£ä¹ˆæˆ¿å­å¯¹ä½ è€Œè¨€å°±æ˜¯è´Ÿå€ºã€‚â€&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½œè€…çš„å»ºè®®æ˜¯å¢åŠ èµ„äº§ï¼Œå‡å°‘è´Ÿå€ºï¼Œå¢åŠ è‚¡ç¥¨ã€å›¾ä¹¦ç‰ˆæƒã€å¯ä¾›å‡ºç§Ÿçš„ä¸åŠ¨äº§ç­‰ã€‚&lt;/p&gt;
&lt;h3&gt;è–ªé…¬&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è·å¾—å·¥ä½œçš„æ–¹å¼ä¼šå½±å“è–ªé…¬ï¼Œå†…æ¨ä¼˜äºä¸»åŠ¨æŠ•ç®€å†ï¼Œä¼ä¸šä¸»åŠ¨æä¾›æœºä¼šä¼˜äºå†…æ¨ã€‚&lt;/strong&gt;&lt;br&gt;
&lt;strong&gt;å…ˆå‡ºä»·çš„äººå‡ºäºåŠ£åŠ¿ï¼Œåƒä¸‡ä¸è¦å…ˆå‡ºä»·ï¼Œç»•è¿‡è¢«é—®åŠå½“å‰è–ªé…¬ã€‚&lt;/strong&gt;&lt;br&gt;
å¦‚æœè–ªé…¬ä¸æ»¡æ„ï¼Œå¯ä»¥è¿˜ä»·ï¼Œä¸è¿‡è¿˜ä»·2æ¬¡ä¹‹åå°±ä¸è¦å†ç»§ç»­äº†ã€‚å¦å¤–å¼„æ¸…å…¬å¸çš„è–ªé…¬èŒƒå›´ï¼Œå’Œè‡ªèº«æ°´å¹³ä¹Ÿå¾ˆé‡è¦ã€‚è¦æ±‚è–ªèµ„çš„æ—¶å€™ï¼Œè¦è¯´æ¸…æ¥šè‡ªå·±ä¸ºä»€ä¹ˆå€¼è¿™ä¸ªä»·é’±ï¼Œèƒ½ç»™å…¬å¸å¸¦æ¥ä»€ä¹ˆå¥½å¤„ã€‚è°ˆOffer æ—¶ï¼Œå¯ä»¥è‡ªä¿¡ä½†æ˜¯ä¸è¦å‚²æ…¢ã€‚&lt;/p&gt;
&lt;h3&gt;å€ºåŠ¡&lt;/h3&gt;
&lt;p&gt;â€œçœŸæ­£è·å¾—è´¢åŠ¡æˆåŠŸçš„å”¯ä¸€æ–¹æ³•å°±æ˜¯ç”¨é’±ç”Ÿé’±ã€‚â€  &lt;/p&gt;
&lt;h2&gt;å¥èº«&lt;/h2&gt;
&lt;h2&gt;ç²¾ç¥&lt;/h2&gt;
&lt;p&gt;ä¹è§‚ï¼Œç§¯æé¢å¯¹å¤±è´¥ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æœ¬ä¸ºç¨‹åºå‘˜å®šåˆ¶çš„â€œæˆåŠŸå­¦æŒ‡å—â€ï¼Œæˆ–è€…è¯´æ˜¯ä¸€æœ¬â€œç”Ÿæ´»æŒ‡å—â€ï¼Œæ¶‰åŠäº†ç†è´¢ã€é¥®é£Ÿã€å¥èº«ç­‰å„ä¸ªæ–¹é¢ï¼Œä¹¦ä¸­çš„é“ç†éƒ½æ¥è‡ªä½œè€…çš„äººç”Ÿç»å†ï¼Œä¹‹å‰ä¸€ç›´è§‰å¾—ç±»ä¼¼ã€Šäººæ€§çš„å¼±ç‚¹ã€‹ã€ã€Šå¯Œçˆ¸çˆ¸ã€ç©·çˆ¸çˆ¸ã€‹è¿™äº›ä¹¦ç±æ²¡å•¥æ„ä¹‰ï¼Œåªæ˜¯å¤§ä¼—è¯»ç‰©ï¼Œç°åœ¨çœ‹æ¥ï¼Œè¿™ç§çœ‹æ³•æ˜¯ä¼æœ¯äººå¸¸è§çš„åè§ã€‚&lt;br&gt;
æ€»ä¹‹ï¼Œæ„¿å‹¿å¿˜åˆå¿ƒçš„åŒæ—¶åº”è¯¥å¤šå­¦ä¹ ï¼Œæ¥è§¦æ›´å¤šé¢†åŸŸçš„çŸ¥è¯†ï¼Œç‰¹åˆ«æ˜¯ç†è´¢ã€å¥åº·è¥å…»ã€äººé™…äº¤å¾€ã€å¿ƒç†å¥åº·ç­‰ï¼ŒåŠªåŠ›è®©ç”Ÿæ´»å˜çš„æ›´å¥½ã€‚  &lt;/p&gt;</content><category term="2016"></category><category term="book"></category></entry><entry><title>ã€ŠWeb æ€§èƒ½æƒå¨æŒ‡å—ã€‹è¯»ä¹¦ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2016/2016-11-01.html" rel="alternate"></link><published>2016-11-01T00:00:00+08:00</published><updated>2016-11-01T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-11-01:/posts/2016/2016-11-01.html</id><summary type="html">&lt;p&gt;&lt;img alt="bookcover" src="/assets/images/2023/20230228164135.png"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹&lt;a href="https://book.douban.com/subject/25856314/"&gt;ã€ŠWeb æ€§èƒ½æƒå¨æŒ‡å—ã€‹&lt;/a&gt;çš„èµ·å› æ˜¯åœ¨çœ‹&lt;a href="https://book.douban.com/subject/26869219/"&gt;ã€ŠHTTPS æƒå¨æŒ‡å—ã€‹&lt;/a&gt;çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¼˜åŒ–ç›¸å…³çš„ï¼Œç„¶åå°±å»¶ä¼¸åˆ°æƒ³çœ‹ä¸€ä¸‹è¿™æœ¬ä¹¦ã€‚&lt;br&gt;
è¿™æœ¬ä¹¦ï¼Œä½œè€…æä¾›äº† â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="bookcover" src="/assets/images/2023/20230228164135.png"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹&lt;a href="https://book.douban.com/subject/25856314/"&gt;ã€ŠWeb æ€§èƒ½æƒå¨æŒ‡å—ã€‹&lt;/a&gt;çš„èµ·å› æ˜¯åœ¨çœ‹&lt;a href="https://book.douban.com/subject/26869219/"&gt;ã€ŠHTTPS æƒå¨æŒ‡å—ã€‹&lt;/a&gt;çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¼˜åŒ–ç›¸å…³çš„ï¼Œç„¶åå°±å»¶ä¼¸åˆ°æƒ³çœ‹ä¸€ä¸‹è¿™æœ¬ä¹¦ã€‚&lt;br&gt;
è¿™æœ¬ä¹¦ï¼Œä½œè€…æä¾›äº†å…è´¹çš„&lt;a href="https://hpbn.co/"&gt;åœ¨çº¿è‹±æ–‡ç‰ˆ&lt;/a&gt;ï¼Œå»ºè®®è¿˜æ˜¯çœ‹è‹±æ–‡çš„ï¼Œä¸­æ–‡ç¿»è¯‘ç‰ˆæœ‰äº›åœ°æ–¹ç•¥ç”Ÿç¡¬ã€‚&lt;/p&gt;
&lt;h2&gt;TCP ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;è¿™éƒ¨åˆ†ä»åè®®å‡ºå‘ï¼Œè®²è§£äº†ä¼˜åŒ–çš„è¦ç‚¹ã€‚  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸‰æ¬¡æ¡æ‰‹å¸¦æ¥çš„å»¶è¿Ÿä½¿å¾—åˆ›å»ºæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„TCPè¿æ¥éƒ½è¦ä»˜å‡ºå¾ˆå¤§çš„ä»£ä»·ã€‚è€Œè¿™ä¹Ÿå†³å®šäº†æé«˜TCPåº”ç”¨æ€§èƒ½çš„å…³é”®ï¼Œåœ¨äºæƒ³åŠæ³•é‡ç”¨è¿æ¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°é‡ç”¨è¿æ¥åœ¨åç»­çš„HTTP ä¼˜åŒ–éƒ½æ˜¯é‡ç‚¹ã€‚&lt;br&gt;
ç¬¬äºŒç« åˆ†å†…å®¹å’Œã€ŠHTTPS æƒå¨æŒ‡å—ã€‹çš„9.1 æœ‰é‡åˆï¼Œå¯ä»¥éƒ½çœ‹ä¸‹ã€‚  &lt;/p&gt;
&lt;h3&gt;æŠŠæœåŠ¡å™¨å†…æ ¸å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼ˆLinuxï¼š 3.2+)&lt;/h3&gt;
&lt;p&gt;æ–°å†…æ ¸èƒ½è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œä¾‹å¦‚é‡‡ç”¨äº†PRRï¼Œæ¯”ä¾‹é™é€Ÿç®—æ³•ã€‚&lt;/p&gt;
&lt;h3&gt;ç¡®ä¿cwnd å¤§å°ä¸º10ï¼›&lt;/h3&gt;
&lt;p&gt;å¢å¤§æ‹¥å¡çª—å£ï¼Œ10è¡¨ç¤º10ä¸ª&lt;a href="https://en.wikipedia.org/wiki/Maximum_segment_size"&gt;MSS&lt;/a&gt;ï¼Œä»¥å¤ªç½‘æ ‡å‡†çš„MSS æ˜¯1460ã€‚&lt;br&gt;
å‰é¢æåˆ°å†…æ ¸å‡çº§ä¹Ÿå¯ä»¥å¸¦æ¥å¥½å¤„ï¼ŒLinux 3.2+ çš„å†…æ ¸ï¼Œcwndéƒ½æ˜¯é»˜è®¤10ã€‚&lt;br&gt;
&lt;img alt="OS_CWND" src="/assets/images/2023/20230228164224.png"&gt;&lt;br&gt;
å›¾ç‰‡æ¥æºï¼šcdnplanet.com&lt;/p&gt;
&lt;p&gt;å…³äºæ›´æ”¹initcwndã€æŸ¥çœ‹ç³»ç»Ÿçš„initcwndï¼Œå¯ä»¥å‚è€ƒ:&lt;br&gt;
&lt;a href="http://www.cdnplanet.com/blog/tune-tcp-initcwnd-for-optimum-performance/"&gt;Tuning initcwnd for optimum performance&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;è¿™ä¸€éƒ¨åˆ†å¯ä»¥å†çœ‹çœ‹ç«ä¸ç¬”è®°çš„&lt;a href="http://huoding.com/2013/11/21/299"&gt;ã€Šæµ…è°ˆTCPä¼˜åŒ–ã€‹&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;ç¦ç”¨ç©ºé—²åçš„æ…¢å¯åŠ¨&lt;/h3&gt;
&lt;p&gt;ä¸»è¦æ˜¯å­˜åœ¨é•¿è¿æ¥çš„æ—¶å€™ï¼Œè¦ç¡®ä¿æŠŠè¿™ä¸ªç»™å…³äº†ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sysctl&lt;span class="w"&gt; &lt;/span&gt;-w&lt;span class="w"&gt; &lt;/span&gt;net.ipv4.tcp_slow_start_after_idle&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;ç¡®ä¿å¯åŠ¨çª—å£ç¼©æ”¾&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sysctl&lt;span class="w"&gt; &lt;/span&gt;-w&lt;span class="w"&gt; &lt;/span&gt;net.ipv4.tcp_windows_scaling&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å‡å°‘ä¼ è¾“å†—ä½™æ•°æ®&lt;/h3&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºæ³¨æ„èƒ½å°‘å‘æ•°æ®å°±å°‘å‘ï¼Œè¿™åœ¨åé¢çš„ç§»åŠ¨è®¾å¤‡Appä¼˜åŒ–ä¸Šä¹Ÿæ˜¯é‡ç‚¹ï¼Œç§»åŠ¨ç½‘ç»œçš„å¯åŠ¨æ›´åŠ è€—æ—¶å’Œè€—ç”µã€‚&lt;/p&gt;
&lt;h3&gt;å‹ç¼©è¦ä¼ è¾“çš„æ•°æ®&lt;/h3&gt;
&lt;p&gt;ä¾‹å¦‚web server å¼€å¯gzipï¼Œå¯¹jsã€css åšå‹ç¼©ã€‚&lt;/p&gt;
&lt;h3&gt;æŠŠæœåŠ¡å™¨æ”¾åˆ°ç¦»ç”¨æˆ·è¿‘çš„åœ°æ–¹å‡å°‘å¾€è¿”çš„æ—¶é—´&lt;/h3&gt;
&lt;p&gt;éƒ¨ç½²CDNï¼Œä¸€æ–¹é¢è¾¹ç¼˜èŠ‚ç‚¹èƒ½å¤Ÿç¼“å­˜æ–‡ä»¶ï¼Œç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœæ˜¯éœ€è¦å›æºçš„è¯ï¼Œè¾¹ç¼˜èŠ‚ç‚¹å¦‚æœèƒ½å’Œå›æºä¿æŒé•¿è¿æ¥ï¼Œè¿™æ ·å¯ä»¥é™ä½ç”¨æˆ·è®¿é—®æ•´ä¸ªè€—æ—¶ï¼Œå› ä¸ºç”¨æˆ·åªéœ€è¦å’Œè¾¹ç¼˜èŠ‚ç‚¹ä¸‰æ¬¡æ¡æ‰‹ï¼Œè·ç¦»è¿‘ï¼Œè€—æ—¶æ›´çŸ­ã€‚&lt;br&gt;
å¦å¤–åœ¨éƒ¨ç½²HTTPS çš„æ—¶å€™ï¼Œé™¤äº†TCPæ¡æ‰‹ï¼Œè¿˜éœ€è¦TLSæ¡æ‰‹ï¼Œå¦‚æœè®©è¾¹ç¼˜èŠ‚ç‚¹æä¾›HTTPSï¼Œç„¶åä»¥HTTPå‘ååä»£ï¼Œä¹Ÿæ˜¯ä¸€ç§ä¼˜åŒ–å§ã€‚ç°åœ¨CDN å‚å•†éƒ½æ”¯æŒHTTPSäº†ï¼Œé…ç½®å›æºçš„æ—¶å€™é€‰æ‹©HTTP ç›¸æ¯”HTTPS ä¼šæ›´å¿«ï¼Œç»™æºç«™çš„å‹åŠ›ä¹Ÿæ›´å°ä¸€äº›ï¼Œè€Œä¸”åœ¨IDCä¹‹é—´ï¼Œè¿è¥å•†é‚£å°æ¶å¿ƒçš„åŠ«æŒé—®é¢˜åº”è¯¥å°‘å¾ˆå¤šå§ã€‚&lt;/p&gt;
&lt;h3&gt;å°½æœ€å¤§å¯èƒ½é‡ç”¨å·²ç»å»ºç«‹çš„TCP è¿æ¥&lt;/h3&gt;
&lt;h2&gt;UDP ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;UDP è¿™éƒ¨åˆ†ï¼Œåœ¨å·¥ä½œä¸­é‡åˆ°çš„å°‘ï¼Œæ²¡å¤ªå¤šä½“ä¼šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Application must tolerate a wide range of Internet path conditions.
Application should control rate of transmission.
Application should perform congestion control over all traffic.
Application should use bandwidth similar to TCP.
Application should back off retransmission counters following loss.
Application should not send datagrams that exceed path MTU.
Application should handle datagram loss, duplication, and reordering.
Application should be robust to delivery delays up to 2 minutes.
Application should enable IPv4 UDP checksum, and must enable IPv6 checksum.
Application may use keepalives when needed (minimum interval 15 seconds).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;TLS ä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;å…³äºTLS ä¼˜åŒ–è¿˜å¯ä»¥çœ‹ã€ŠHTTPS æƒå¨æŒ‡å—ã€‹çš„9.2ï¼šTLSåè®®ä¼˜åŒ–ã€‚&lt;br&gt;
å¦å¤–æ·˜å®çš„è¿™ä»½åˆ†æéå¸¸ä¸é”™ï¼š&lt;a href="http://velocity.oreilly.com.cn/2015/ppts/lizhenyu.pdf"&gt;ã€Šæ·˜å®HTTPSæ¢ç´¢ã€‹&lt;/a&gt;  &lt;/p&gt;
&lt;h3&gt;SSLå¸è½½&lt;/h3&gt;
&lt;p&gt;åœ¨ä¿è¯å…¼å®¹æ€§çš„æƒ…å†µä¸‹ï¼Œå‡çº§åˆ°æ–°ç‰ˆçš„openSSLï¼Œå¯ä»¥æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚&lt;br&gt;
HPBNçš„åœ¨è¿™ä¸€ç« çš„å»ºè®®æ˜¯ç”¨ç‰©ç†æœºï¼Œçº¯CPUè®¡ç®—å¸è½½ï¼Œä¸¾äº†Googleå’ŒFacebookä¸ºä¾‹ã€‚ä¸è¿‡å¦‚æœæ˜¯ä½¿ç”¨çš„äº‘æœåŠ¡çš„è¯ï¼Œéƒ¨åˆ†äº‘å‚å•†åœ¨è´Ÿè½½å‡è¡¡ä¸Šéƒ½æä¾›äº†SSLå¸è½½çš„åŠŸèƒ½ï¼Œä¸è¿‡æ„Ÿè§‰å¯¹ALPNè¿™äº›åè®®çš„æ”¯æŒä¸çŸ¥å¦‚ä½•ï¼Œæ‰€ä»¥è¿˜æ²¡è¯•ç”¨è¿‡ã€‚äº‘æœåŠ¡è™šæœº+Nginx æ¥åšå¸è½½è¿˜æ˜¯æœ‰å°‘è®¸å‹åŠ›çš„ï¼Œé«˜å³°æœŸçš„æ—¶å€™ã€‚Intelä¹‹ç±»çš„ç¡¬ä»¶ï¼Œç”šè‡³F5 è¿™ç§ï¼Œæ„Ÿè§‰æˆæœ¬æœ‰ç‚¹é«˜ï¼Œä¸è¿‡æ€§èƒ½ç¡®å®éå¸¸å¥½ï¼Œå¦‚æœæœ‰æ¡ä»¶çš„è¯ï¼Œå¯ä»¥ä¸Šè¿™ç±»è®¾å¤‡ã€‚ä¸è¿‡ä½¿ç”¨äº†è¿™äº›è®¾å¤‡ä¹‹åï¼Œç®—æ³•å‡çº§ã€è°ƒä¼˜çš„è‡ªç”±åº¦å¯èƒ½å°±ä¸å¤§äº†ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸ºäº†é™ä½å‹åŠ›ï¼Œå¯ä»¥å¯¹åŠ å¯†å¥—ä»¶çš„é€‰æ‹©è¿›è¡Œä¼˜åŒ–ï¼Œå‚è€ƒã€ŠHTTPSæƒå¨æŒ‡å—ã€‹ä¸€ä¹¦çš„æµ‹è¯•ç»“æœï¼š&lt;br&gt;
&lt;img alt="TLS_Speed" src="/assets/images/2023/20230228164304.png"&gt;  &lt;/p&gt;
&lt;p&gt;&lt;img alt="TLS_Speed_taobao" src="/assets/images/2023/20230228164345.png"&gt;  &lt;/p&gt;
&lt;p&gt;å»ºè®®ï¼šä¼˜å…ˆé€‰æ‹©ECDHEï¼Œç¦ç”¨DHEã€‚&lt;/p&gt;
&lt;h3&gt;å°½æ—©æ¡æ‰‹&lt;/h3&gt;
&lt;p&gt;ç±»ä¼¼TCPçš„ä¸‰æ¬¡æ¡æ‰‹ï¼ŒTLSçš„æ¡æ‰‹è¿‡ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼CDNçš„ç½‘ç»œè¿›è¡Œä¼˜åŒ–ã€‚åœ¨è·ç¦»ç”¨æˆ·è¾ƒè¿‘çš„åœ°æ–¹æ­å»ºä»£ç†æœåŠ¡å™¨ï¼Œç„¶åå’Œåç«¯ä¿æŒé•¿è¿æ¥ï¼Œè¿™æ ·é™ä½ç”¨æˆ·åˆ°æœåŠ¡æ•´ä¸ªçš„æ¡æ‰‹æ—¶é—´ã€‚&lt;/p&gt;
&lt;h3&gt;è¯ä¹¦ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;ã€ŠHTTPSæƒå¨æŒ‡å—ã€‹æåˆ°çš„å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å°½å¯èƒ½å°‘çš„è¯ä¹¦&lt;/li&gt;
&lt;li&gt;åªåŒ…å«å¿…é¡»çš„è¯ä¹¦&lt;/li&gt;
&lt;li&gt;æä¾›å®Œæ•´çš„è¯ä¹¦é“¾&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ¤­åœ†æ›²çº¿è¯ä¹¦é“¾&lt;/li&gt;
&lt;li&gt;å°å¿ƒåŒä¸€å¼ è¯ä¹¦ç»‘å®šè¿‡å¤šåŸŸå&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯åœ¨è¯ä¹¦é“¾é‡Œé¢åŒ…å«æ ¹è¯ä¹¦ï¼Œæ¯«æ— æ„ä¹‰ï¼Œè¿˜åŠ å¤§äº†ä¼ è¾“å¼€é”€ã€‚&lt;/p&gt;
&lt;h3&gt;ä¼˜åŒ–TLS è®°å½•å¤§å°&lt;/h3&gt;
&lt;p&gt;TLS å¤ªå°ä¼šé€ æˆæµªè´¹ï¼Œå¤´ä¿¡æ¯çš„æ¯”ä¾‹è¿‡å¤§ã€‚å¦‚æœå¤ªå¤§ï¼Œä¼šé€ æˆå»¶è¿Ÿï¼Œå¦‚æœä¸‡ä¸€ä¸¢åŒ…ï¼Œä¼šéå¸¸ç³Ÿç³•ã€‚å‚è€ƒ&lt;a href="http://fangpeishi.com/optimizing-tls-record-size.html"&gt;TLS Record Size ä¼˜åŒ–ç¬”è®°&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;å…¶ä»–&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;ç¦ç”¨æœåŠ¡å™¨çš„TLSå‹ç¼©ï¼Œå®‰å…¨æ€§é—®é¢˜ï¼ŒNginxçš„è¯é»˜è®¤æ˜¯ä¸æ”¯æŒçš„ï¼›&lt;/li&gt;
&lt;li&gt;ç¡®ä¿è¯ä¹¦é“¾ä¸ä¼šè¶…è¿‡æ‹¥å¡çª—å£å¤§å°ï¼›&lt;/li&gt;
&lt;li&gt;å¯ç”¨ä¼šè¯ç¼“å­˜å’Œæ— çŠ¶æ€æ¢å¤ï¼Œå‚è€ƒnginx çš„ ssl_session_cacheï¼Œssl_session_timeoutç­‰ã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®ssl_stapling&lt;/li&gt;
&lt;li&gt;é…ç½®ssl_session_tickets&lt;/li&gt;
&lt;li&gt;å¼€å¯HSTSï¼Œè¿™ä¸ªå¼€å¯å¾—éå¸¸å°å¿ƒ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æ— çº¿ç½‘ç»œä¼˜åŒ–&lt;/h2&gt;
&lt;p&gt;è¿™éƒ¨åˆ†å†…å®¹ä»‹ç»äº†å¾ˆå¤šå…³äºç§»åŠ¨ç½‘ç»œçš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿæ˜¯ä¸ºåé¢çš„HTTPä¼˜åŒ–åšé“ºå«ï¼Œæ¯•ç«Ÿç°åœ¨ç§»åŠ¨App éå¸¸å‘è¾¾ã€‚æ€»çš„æ¥è¯´ï¼Œç§»åŠ¨è®¾å¤‡ä¸Šä¸€æ¬¡è¯·æ±‚çš„ä»£ä»·æ›´å¤§ï¼Œæ—¶é—´ä¸Šå’Œè€—ç”µä¸Šï¼Œæ‰€ä»¥å‡å°‘è¯·æ±‚å’Œé‡ç”¨è¿æ¥éå¸¸é‡è¦ã€‚&lt;/p&gt;
&lt;h2&gt;HTTP ä¼˜åŒ–&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;HTTP 1.0 å‡çº§åˆ°HTTP1.1&lt;/li&gt;
&lt;li&gt;å‡å°‘DNSæŸ¥è¯¢&lt;/li&gt;
&lt;li&gt;å‡å°‘HTTPè¯·æ±‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨CDN&lt;/li&gt;
&lt;li&gt;æ·»åŠ Expires å¤´éƒ¨å¹¶é…ç½®ETagæ ‡ç­¾&lt;/li&gt;
&lt;li&gt;Gzip å‹ç¼©èµ„æº&lt;/li&gt;
&lt;li&gt;é¿å…HTTP é‡å®šå‘&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ä½¿ç”¨æŒä¹…è¿æ¥&lt;/h3&gt;
&lt;h3&gt;HTTPç®¡é“&lt;/h3&gt;
&lt;p&gt;æ¶ˆé™¤éƒ¨åˆ†ç­‰å¾…æ—¶é—´ã€‚&lt;/p&gt;
&lt;h3&gt;åŸŸååˆ†åŒº&lt;/h3&gt;
&lt;p&gt;è¿™ä¸ªä½¿ç”¨è¦é€‚é‡ï¼Œä¸è®©ä¼šé€‚å¾—å…¶åã€‚&lt;/p&gt;
&lt;h3&gt;æ‹¼æ¥ã€å‹ç¼©é™æ€èµ„æº&lt;/h3&gt;
&lt;p&gt;ç›´æ¥å‚è€ƒ&lt;a href="https://ngxpagespeed.com"&gt;ngxpagespeed.com&lt;/a&gt; å°±å¯ä»¥äº†ã€‚&lt;/p&gt;
&lt;h3&gt;å‡çº§åˆ°HTTP 2.0&lt;/h3&gt;
&lt;p&gt;è¦æ³¨æ„ä¸è¦æŠŠåœ¨HTTP 1.1 ä¸Šçš„ä¼˜åŒ–æ‰‹æ®µç”¨åˆ°HTTP 2.0 ä¸Šï¼Œä¼šé€‚å¾—å…¶åã€‚&lt;/p&gt;
&lt;h2&gt;å…¶ä»–&lt;/h2&gt;
&lt;p&gt;ä¹¦ä¸­è¿˜æœ‰å¤§é‡å…¶ä»–å†…å®¹ï¼Œä¸€äº›å…³äºTCPã€HTTPçš„åŸºç¡€ä»‹ç»ï¼Œä»¥åŠç§»åŠ¨ç½‘ç»œã€XMLHttpRequestã€WebSocketã€WebRTCç­‰å†…å®¹ã€‚&lt;/p&gt;</content><category term="2016"></category><category term="web"></category><category term="http"></category><category term="https"></category><category term="book"></category></entry><entry><title>Nginx åŠ è½½é…ç½®çš„é¡ºåºåˆ†æ</title><link href="https://fangpsh.github.io/posts/2016/2016-10-14.html" rel="alternate"></link><published>2016-10-14T13:59:30+08:00</published><updated>2016-10-14T13:59:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-10-14:/posts/2016/2016-10-14.html</id><summary type="html">&lt;h2&gt;é—®é¢˜èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨éƒ¨ç½²HTTPS çš„æ—¶å€™ï¼Œ2å°Nginx ä¸‹éƒ½éƒ¨ç½²äº†å¤šä¸ªåŸŸåçš„è¯ä¹¦ï¼Œå³NginxA éƒ¨ç½²äº†è¯ä¹¦a.com å’Œb.com çš„è¯ä¹¦ï¼ŒNginxB ä¹Ÿéƒ¨ç½²äº†è¯ä¹¦a.com å’Œb â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;é—®é¢˜èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;åœ¨éƒ¨ç½²HTTPS çš„æ—¶å€™ï¼Œ2å°Nginx ä¸‹éƒ½éƒ¨ç½²äº†å¤šä¸ªåŸŸåçš„è¯ä¹¦ï¼Œå³NginxA éƒ¨ç½²äº†è¯ä¹¦a.com å’Œb.com çš„è¯ä¹¦ï¼ŒNginxB ä¹Ÿéƒ¨ç½²äº†è¯ä¹¦a.com å’Œb.com ï¼ŒåŸŸåa.com æŒ‡å‘NginxAï¼ŒåŸŸåb.com æŒ‡å‘NginxBã€‚&lt;br&gt;
åœ¨ç”¨&lt;a href="https://www.ssllabs.com"&gt;SSL LABS&lt;/a&gt; æ£€æµ‹çš„æ—¶å€™ï¼Œå‘ç°b.com ä¼šå‡ºç°â€œThis site works only in browsers with SNI support.â€ï¼Œè€Œa.com ä¸ä¼šã€‚&lt;br&gt;
&lt;img alt="SNI" src="/assets/images/2023/20230301164029.png"&gt;  &lt;/p&gt;
&lt;h3&gt;SNI ä»‹ç»&lt;/h3&gt;
&lt;p&gt;å…³äº&lt;a href="https://en.wikipedia.org/wiki/Server_Name_Indication"&gt;SNI&lt;/a&gt; çš„ç®€å•ä»‹ç»ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨ Nginx ä¸­å¯ä»¥é€šè¿‡æŒ‡å®šä¸åŒçš„ server_name æ¥é…ç½®å¤šä¸ªç«™ç‚¹ã€‚HTTP/1.1 åè®®è¯·æ±‚å¤´ä¸­çš„ Host å­—æ®µå¯ä»¥æ ‡è¯†å‡ºå½“å‰è¯·æ±‚å±äºå“ªä¸ªç«™ç‚¹ã€‚ä½†æ˜¯å¯¹äº HTTPS ç½‘ç«™æ¥è¯´ï¼Œè¦æƒ³å‘é€ HTTP æ•°æ®ï¼Œå¿…é¡»ç­‰å¾… SSL æ¡æ‰‹å®Œæˆï¼Œè€Œåœ¨æ¡æ‰‹é˜¶æ®µæœåŠ¡ç«¯å°±å¿…é¡»æä¾›ç½‘ç«™è¯ä¹¦ã€‚å¯¹äºåœ¨åŒä¸€ä¸ª IP éƒ¨ç½²ä¸åŒ HTTPS ç«™ç‚¹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨äº†ä¸åŒè¯ä¹¦çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡ç«¯æ€ä¹ˆçŸ¥é“è¯¥å‘é€å“ªä¸ªè¯ä¹¦ï¼Ÿ&lt;br&gt;
Server Name Indicationï¼Œç®€ç§°ä¸º SNIï¼Œæ˜¯ TLS çš„ä¸€ä¸ªæ‰©å±•ï¼Œä¸ºè§£å†³è¿™ä¸ªé—®é¢˜åº”è¿è€Œç”Ÿã€‚æœ‰äº† SNIï¼ŒæœåŠ¡ç«¯å¯ä»¥é€šè¿‡ Client Hello ä¸­çš„ SNI æ‰©å±•æ‹¿åˆ°ç”¨æˆ·è¦è®¿é—®ç½‘ç«™çš„ Server Nameï¼Œè¿›è€Œå‘é€ä¸ä¹‹åŒ¹é…çš„è¯ä¹¦ï¼Œé¡ºåˆ©å®Œæˆ SSL æ¡æ‰‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å¼•ç”¨æ¥æºï¼š&lt;a href="https://imququ.com/post/sth-about-switch-to-https-2.html"&gt;å…³äºå¯ç”¨ HTTPS çš„ä¸€äº›ç»éªŒåˆ†äº«ï¼ˆäºŒï¼‰&lt;/a&gt;ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨OpenSSL æµ‹è¯•NginxAï¼ŒNginxBï¼Œä¸æŒ‡å®šHost å¤´ï¼ŒNginxA è¿”å›çš„æ˜¯a.com çš„è¯ä¹¦ï¼ŒNginxB è¿”å›çš„ä¹Ÿæ˜¯a.com çš„è¯ä¹¦ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;openssl s_client -connect nginx_ip:443 -showcerts &amp;lt; /dev/null 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;Nginx æºç åˆ†æ&lt;/h2&gt;
&lt;p&gt;åŸºæœ¬ç¡®å®šæ˜¯é…ç½®åŠ è½½çš„é¡ºåºé—®é¢˜ã€‚åœ¨NginxA å’ŒNginxB ä¸­å…ˆåŠ è½½çš„éƒ½æ˜¯a.comã€‚
åœ¨nginx.conf ä¸­ï¼Œæˆ‘ç”¨ include æŒ‡ä»¤ å¼•å…¥äº† æŸç›®å½•ä¸‹çš„æ‰€æœ‰conf ç»“å°¾çš„é…ç½®:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;include /home/xxxxx/*.conf;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ€€ç–‘Nginx include æ˜¯æŒ‰ç…§å­—å…¸é¡ºåºï¼Œå³a-z çš„é¡ºåºã€‚çœ‹ä¸‹æºä»£ç ï¼Œå‚è€ƒçš„Nginx ä»£ç ç‰ˆæœ¬æ˜¯1.11.0ã€‚&lt;br&gt;
å…ˆæ‰¾åˆ°include æŒ‡å®šç›¸å…³çš„å‡½æ•°:  &lt;/p&gt;
&lt;h3&gt;ngx_conf_file.c&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#/src/core/ngx_conf_file.c&lt;/span&gt;
&lt;span class="k"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ngx_command_t&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="n"&gt;ngx_conf_commands&lt;/span&gt;&lt;span class="p"&gt;[]&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ngx_string&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;include&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;NGX_ANY_CONF&lt;/span&gt;&lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;NGX_CONF_TAKE1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ngx_conf_include&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ngx_null_command&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç»§ç»­æŸ¥çœ‹&lt;code&gt;ngx_conf_include&lt;/code&gt; å‡½æ•°ï¼Œç•¥å»éƒ¨åˆ†ç‰‡æ®µ:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#/src/core/ngx_config_file.c&lt;/span&gt;

&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;
&lt;span class="nf"&gt;ngx_conf_include&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ngx_conf_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;cf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ngx_command_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;cmd&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;conf&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ngx_glob_t&lt;/span&gt;&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;....&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pattern&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cf&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ngx_open_glob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NGX_OK&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;ngx_conf_log_error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;NGX_LOG_EMERG&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;cf&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ngx_errno&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;ngx_open_glob_n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot; &lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt;%s&lt;/span&gt;&lt;span class="se"&gt;\&amp;quot;&lt;/span&gt;&lt;span class="s"&gt; failed&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NGX_CONF_ERROR&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;rv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;NGX_CONF_OK&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ngx_read_glob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;...&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;ngx_close_glob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;gl&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;rv&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;ngx_open_glob&lt;/code&gt; è¿™ä¸ªå‡½æ•°æœ‰ç‚¹çœ¼ç†Ÿï¼Œglob æ˜¯ä¸€ä¸ªç†Ÿæ‚‰çš„åå­—ï¼Œåœ¨Python å’Œå…¶ä»–è¯­è¨€ä¸­å¸¸å¸¸çœ‹åˆ°ç›¸å…³çš„åº“ï¼Œç”¨æ¥åšæ–‡ä»¶è·¯å¾„æœç´¢å’ŒåŒ¹é…ã€‚ç»§ç»­æ‰¾&lt;code&gt;ngx_open_glob&lt;/code&gt; è¿™ä¸ªå‡½æ•°ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#/src/os/unix/ngx_files.c

ngx_int_t
ngx_open_glob(ngx_glob_t *gl)
{
    int  n;

    n = glob((char *) gl-&amp;gt;pattern, 0, NULL, &amp;amp;gl-&amp;gt;pglob);

    if (n == 0) {
        return NGX_OK;
    }

#ifdef GLOB_NOMATCH

    if (n == GLOB_NOMATCH &amp;amp;&amp;amp; gl-&amp;gt;test) {
        return NGX_OK;
}

#endif

    return NGX_ERROR;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;ngx_conf_include&lt;/code&gt; åœ¨åç»­æ‹¿åˆ°åŒ¹é…çš„æ–‡ä»¶è·¯å¾„ï¼Œå¾ªç¯è°ƒç”¨&lt;code&gt;ngx_read_glob&lt;/code&gt; è¿›è¡Œè¯»å–è§£æã€‚&lt;br&gt;
&lt;code&gt;ngx_open_glob&lt;/code&gt; ä¸­è°ƒç”¨äº†ç³»ç»Ÿçš„&lt;code&gt;glob.h&lt;/code&gt; ä¸­çš„&lt;code&gt;glob&lt;/code&gt; å‡½æ•°è¿›è¡Œè·¯å¾„åŒ¹é…ã€‚  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;glob, globfree - find pathnames matching a pattern, free memory from glob()&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;glob.h&amp;gt;&lt;/span&gt;

&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;glob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pattern&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;errfunc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;epath&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;eerrno&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;glob_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pglob&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;globfree&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;glob_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;pglob&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç»§ç»­ææ¸…æ¥šè¿”å›é¡ºåºçš„é—®é¢˜ï¼Œ&lt;code&gt;glob&lt;/code&gt; å‡½æ•°çš„ä¼ å‚ç¬¬äºŒä¸ªæ˜¯flagsã€‚&lt;br&gt;
flags å¯ä»¥è®¾ç½®ä¸º&lt;code&gt;GLOB_NOSORT&lt;/code&gt;ï¼Œè¦æ±‚å¯¹è¿”å›çš„ç»“æœä¸è¿›è¡Œæ’åºï¼Œä¹Ÿå°±æ˜¯è¯´é»˜è®¤æ˜¯æ’åºçš„ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GLOB_NOSORT
Don&amp;#39;t sort the returned pathnames.  The only reason to do this
is to save processing time.  By default, the returned
pathnames are sorted.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨&lt;code&gt;ngx_open_glob&lt;/code&gt; ä¸­è°ƒç”¨&lt;code&gt;glob&lt;/code&gt;æ˜¯ä¼ çš„&lt;code&gt;flags&lt;/code&gt; æ˜¯&lt;code&gt;int 0&lt;/code&gt;ã€‚åœ¨GLOB çš„æ‰‹å†Œä¸­æ²¡æ‰¾åˆ°å…³äºflags è®¾ç½®ä¸º0 çš„è¯´æ˜ã€‚ç»§ç»­ç¿»ä»£ç ã€‚  &lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a href="http://man7.org/linux/man-pages/man3/glob.3.html"&gt;glob(3) &lt;/a&gt;  &lt;/p&gt;
&lt;h3&gt;glob.c&lt;/h3&gt;
&lt;p&gt;ä¸Šgithub æœäº†ä¸‹posix çš„glob å®ç°ï¼Œ  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#https:&lt;/span&gt;&lt;span class="c1"&gt;//github.com/lattera/glibc/blob/master/posix/glob.h&lt;/span&gt;

&lt;span class="cm"&gt;/* Bits set in the FLAGS argument to `glob&amp;#39;.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_ERR    (1 &amp;lt;&amp;lt; 0)&lt;/span&gt;&lt;span class="cm"&gt;/* Return on read errors.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_MARK    (1 &amp;lt;&amp;lt; 1)&lt;/span&gt;&lt;span class="cm"&gt;/* Append a slash to each name.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_NOSORT    (1 &amp;lt;&amp;lt; 2)&lt;/span&gt;&lt;span class="cm"&gt;/* Don&amp;#39;t sort the names.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_DOOFFS    (1 &amp;lt;&amp;lt; 3)&lt;/span&gt;&lt;span class="cm"&gt;/* Insert PGLOB-&amp;gt;gl_offs NULLs.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_NOCHECK    (1 &amp;lt;&amp;lt; 4)&lt;/span&gt;&lt;span class="cm"&gt;/* If nothing matches, return the pattern.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_APPEND    (1 &amp;lt;&amp;lt; 5)&lt;/span&gt;&lt;span class="cm"&gt;/* Append to results of a previous call.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_NOESCAPE    (1 &amp;lt;&amp;lt; 6)&lt;/span&gt;&lt;span class="cm"&gt;/* Backslashes don&amp;#39;t quote metacharacters.  */&lt;/span&gt;
&lt;span class="cp"&gt;#define    GLOB_PERIOD    (1 &amp;lt;&amp;lt; 7)&lt;/span&gt;&lt;span class="cm"&gt;/* Leading `.&amp;#39; can be matched by metachars.  */&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;GLOB çš„æ‰‹å†Œä¸­æœ‰ä¸€å¥è¯ï¼š  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The argument flags is made up of the bitwise OR of zero or more the following symbolic constants.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¹Ÿå°±æ˜¯è¯´å¯ä»¥flag å¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªï¼Œä¾‹å¦‚:&lt;code&gt;GLOB_APPEND|GLOB_NOSORT&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨&lt;code&gt;glob.c&lt;/code&gt; ä¸­ ä¸å°‘&lt;code&gt;if(!(flags &amp;amp; GLOB_DOOFFS))&lt;/code&gt; è¿™æ ·çš„è¯­å¥ï¼Œå°±æ˜ç™½äº†ï¼Œé€šè¿‡ä¸æ“ä½œï¼Œå¯ä»¥åœ¨flags è¿™æ ·ä¸€ä¸ªå˜é‡ä¸Šå­˜å‚¨å’Œæå–å¤šä¸ªç»„åˆé…ç½®ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#https:&lt;/span&gt;&lt;span class="c1"&gt;//github.com/lattera/glibc/blob/master/posix/glob.c#L1243&lt;/span&gt;

&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flags&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;GLOB_NOSORT&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="cm"&gt;/* Sort the vector.  */&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;qsort&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;pglob&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;gl_pathv&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;oldcount&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="n"&gt;pglob&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;gl_pathc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;pglob&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;gl_offs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;oldcount&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;              &lt;/span&gt;&lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;collated_compare&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;ngx_open_glob&lt;/code&gt;ä¸­çš„flags æ˜¯&lt;code&gt;int 0&lt;/code&gt;ï¼Œå³&lt;code&gt;(!(flags &amp;amp; GLOB_NOSORT))&lt;/code&gt;çš„ç»“æœä¸º&lt;code&gt;True&lt;/code&gt;ï¼Œå³é»˜è®¤è¿›è¡Œæ’åºï¼Œ&lt;code&gt;qsort&lt;/code&gt; çš„æ¯”è¾ƒå‡½æ•°æ˜¯&lt;code&gt;collated_compare&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="cp"&gt;#https:&lt;/span&gt;&lt;span class="c1"&gt;//github.com/lattera/glibc/blob/a2f34833b1042d5d8eeb263b4cf4caaea138c4ad/posix/glob.c#L1283&lt;/span&gt;

&lt;span class="k"&gt;static&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt;
&lt;span class="nf"&gt;collated_compare&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;-1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;strcoll&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;s2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;strcoll&lt;/code&gt; å‡½æ•°ä¼šæ ¹æ®æœ¬åœ°ç¯å¢ƒå˜é‡LC_COLLATE çš„è®¾ç½®ï¼Œæ¥è¿›è¡Œå¯¹æ¯”,ç»†èŠ‚ä¸å¤ªæ¸…æ¥šã€‚ä¸è¿‡ä¸€èˆ¬çš„è‹±æ–‡ç¯å¢ƒä¸‹ï¼ŒæŒ‰ç…§ASCII è¡¨ï¼Œå¦‚æœs1 å¤§äº s2ï¼Œåˆ™è¿”å›å€¼å¤§äº0ï¼Œåä¹‹å°äº0ï¼Œä¸€æ ·çš„è¯è¿”å›å€¼ä¸º0ã€‚
&lt;code&gt;collated_compare&lt;/code&gt; å‡½æ•°æ¯”è¾ƒç»“æœä¸­ï¼Œå¦‚æœå°äº0ï¼Œ&lt;code&gt;qsort&lt;/code&gt; ä¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°s1 æ’åœ¨s2 å‰é¢ã€‚åœ¨ASCIIè¡¨ä¸­ï¼Œ0~9ï¼Œa-Zçš„å€¼æ˜¯ä»å°åˆ°å¤§ã€‚  &lt;/p&gt;
&lt;p&gt;å‚è€ƒèµ„æ–™: &lt;a href="https://www.tutorialspoint.com/c_standard_library/c_function_strcoll.htm"&gt;C library function - strcoll()&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œ&lt;code&gt;glob&lt;/code&gt; å‡½æ•°åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›çš„ç»“æœæ˜¯æŒ‰ç…§å­—æ¯è¡¨æ’åºçš„ã€‚å³åŒæ—¶å­˜åœ¨a.com.conf å’Œb.com.conf ä¸¤ä»½é…ç½®ï¼Œåœ¨åŒæ—¶include çš„è¯ï¼Œa.com.conf ä¼šæ¯”b.com.conf å…ˆåŠ è½½ã€‚  &lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘æŠŠNginxAä¸Šçš„a.com.conf æ”¹æˆ 00-a.com.conf ï¼ŒæŠŠNginxB ä¸Šçš„b.com.conf æ”¹æˆ 00-b.com.conf ï¼Œæ§åˆ¶äº†ä»–ä»¬çš„åŠ è½½é¡ºåºã€‚  &lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼Œæƒ³èµ·äº†åœ¨ç”¨SySV Init çš„æ—¶å€™ï¼Œ/etc/rcX.d ä¸‹é‚£äº› S01XXXï¼ŒK02XXX ä¹‹ç±»çš„æ–‡ä»¶ï¼Œç”¨æ¥æ§åˆ¶æœåŠ¡çš„èµ·åœé¡ºåºã€‚  &lt;/p&gt;
&lt;p&gt;&lt;img alt="sysv_init_rcx.d" src="/assets/images/2023/20230301164044.png"&gt;&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡&lt;a href="http://www.jianshu.com/p/b4c38f44c4ea"&gt;æ¥æºç½‘ç»œ&lt;/a&gt; ï¼Œç°åœ¨æ‰‹å¤´å·²ç»æ‰¾ä¸åˆ°ç”¨SySV åšInit çš„æœºå™¨äº†ï¼Œå†ã€‚&lt;/p&gt;
&lt;h2&gt;Changeset 4943:1e2d5d3f9f6b&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://trac.nginx.org/nginx/changeset/4943/nginx"&gt;Changeset 4943:1e2d5d3f9f6b in nginx&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Message:
Core: removed GLOB_NOSORT glob option.
This will result in alphabetical sorting of included files if
the &amp;quot;include&amp;quot; directive with wildcards is used.

Note that the behaviour is now different from that on Windows, where
alphabetical sorting is not guaranteed for FindFirsFile?()/FindNextFile?()
(used to be alphabetical on NTFS, but not on FAT).

Approved by Igor Sysoev, prodded by many.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2016"></category><category term="nginx"></category><category term="glob"></category></entry><entry><title>TLS Record Size ä¼˜åŒ–ç¬”è®°</title><link href="https://fangpsh.github.io/posts/2016/2016-10-10.html" rel="alternate"></link><published>2016-10-10T17:39:55+08:00</published><updated>2016-10-10T17:39:55+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-10-10:/posts/2016/2016-10-10.html</id><summary type="html">&lt;h2&gt;ä»æ·˜å®è¯´èµ·&lt;/h2&gt;
&lt;p&gt;ä»&lt;a href="http://velocity.oreilly.com.cn/2015/ppts/lizhenyu.pdf"&gt;ã€Šæ·˜å®å…¨ç«™HTTPSå®è·µã€‹&lt;/a&gt;å¼€å§‹è¯´ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img alt="taobao-https" src="/assets/images/2023/20230301160434.png"&gt;&lt;/p&gt;
&lt;p&gt;æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Œè°ƒå¤§è¿˜æ˜¯è°ƒå°ã€‚&lt;br&gt;
è§†é¢‘ï¼š17minåˆ†é’Ÿå·¦å³:  &lt;/p&gt;
&lt;p&gt;&lt;embed src='http://player.youku.com/player.php/sid/XMTM0MTUzMTk1Mg==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'&gt;&lt;/embed&gt;&lt;/p&gt;
&lt;p&gt;æåˆ°Google åŠ¨æ€è°ƒï¼Œç„¶åä¸€èˆ¬è®¾ç½®4kï¼Œæ©,åˆ°åº•æ€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹é‡ç‹— â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;ä»æ·˜å®è¯´èµ·&lt;/h2&gt;
&lt;p&gt;ä»&lt;a href="http://velocity.oreilly.com.cn/2015/ppts/lizhenyu.pdf"&gt;ã€Šæ·˜å®å…¨ç«™HTTPSå®è·µã€‹&lt;/a&gt;å¼€å§‹è¯´ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img alt="taobao-https" src="/assets/images/2023/20230301160434.png"&gt;&lt;/p&gt;
&lt;p&gt;æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Œè°ƒå¤§è¿˜æ˜¯è°ƒå°ã€‚&lt;br&gt;
è§†é¢‘ï¼š17minåˆ†é’Ÿå·¦å³:  &lt;/p&gt;
&lt;p&gt;&lt;embed src='http://player.youku.com/player.php/sid/XMTM0MTUzMTk1Mg==/v.swf' allowFullScreen='true' quality='high' width='480' height='400' align='middle' allowScriptAccess='always' type='application/x-shockwave-flash'&gt;&lt;/embed&gt;&lt;/p&gt;
&lt;p&gt;æåˆ°Google åŠ¨æ€è°ƒï¼Œç„¶åä¸€èˆ¬è®¾ç½®4kï¼Œæ©,åˆ°åº•æ€æ ·ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹çœ‹é‡ç‹—çš„æ–‡ç« &lt;a href="https://blog.wilddog.com/?p=210"&gt;ã€Šæ‰’ä¸€æ‰’HTTPSç½‘ç«™çš„å†…å¹•ã€‹&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;TLS Record Size
æœåŠ¡å™¨åœ¨å»ºç«‹TLSè¿æ¥æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªè¿æ¥åˆ†é…Bufferï¼Œè¿™ä¸ªBufferå«TLS Record Sizeã€‚è¿™ä¸ªSizeæ˜¯å¯è°ƒã€‚

Sizeå€¼å¦‚æœè¿‡å°ï¼Œå¤´éƒ¨è´Ÿè½½æ¯”é‡å°±ä¼šè¿‡å¤§ï¼Œæœ€é«˜å¯è¾¾6%ã€‚

Sizeå€¼å¦‚æœè¿‡å¤§ï¼Œé‚£å•ä¸ªRecordåœ¨TCPå±‚ä¼šè¢«åˆ†æˆå¤šä¸ªåŒ…å‘é€ã€‚æµè§ˆå™¨å¿…é¡»ç­‰å¾…è¿™äº›å…¨éƒ¨è¾¾åˆ°åï¼Œæ‰èƒ½è§£å¯†ï¼Œä¸€æ—¦å‡ºç°ä¸¢åŒ…ã€æ‹¥å¡ã€é‡ä¼ ã€ç”šè‡³é‡æ–°å»ºç«‹çš„æƒ…å†µï¼Œæ—¶å»¶å°±ä¼šè¢«ç›¸åº”å¢åŠ ã€‚

é‚£TLS Record Sizeå€¼å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿæœ‰ä¸¤ä¸ªå‚æ•°å¯å‚è€ƒã€‚

é¦–å…ˆï¼ŒTLS Record Sizeè¦å¤§äºè¯ä¹¦é“¾å’ŒOCSP Staplingå“åº”å¤§å°ï¼Œè¯ä¹¦é“¾ä¸ä¼šåˆ†æˆå¤šä¸ªrecordï¼›

å…¶æ¬¡ï¼Œè¦å°äºåˆå§‹æ‹¥å¡çª—å£å€¼ï¼Œä¿è¯æœåŠ¡å™¨åœ¨é€šä¿¡ä¹‹åˆå¯ä»¥å‘é€è¶³å¤Ÿæ•°æ®è€Œä¸éœ€è¦ç­‰å¾…æµè§ˆå™¨ç¡®è®¤

ä¸€èˆ¬æ¥è¯´ï¼Œä»æ ¹CAæœºæ„ç”³è¯·çš„è¯ä¹¦ä¸º2-3KBå·¦å³ï¼Œçº§æ•°è¶Šå¤šï¼Œè¯ä¹¦é“¾è¶Šå¤§ï¼Œocspå“åº”ä¸º2KBå·¦å³ï¼Œæ‰€ä»¥TLS Record Sizeæ˜¯éœ€è¦æ ¹æ®ä½ çš„å®é™…æƒ…å†µè®¾ç½®ï¼ŒGoogleçš„å€¼5KBã€‚WildDogå½“å‰çš„å€¼æ˜¯6KBã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çœ‹ä¸‹å¤§ç¥æ€ä¹ˆè¯´ï¼š&lt;a href="https://www.igvita.com/2013/10/24/optimizing-tls-record-size-and-buffering-latency/"&gt;ã€ŠOptimizing TLS Record Size &amp;amp; Buffering Latencyã€‹&lt;/a&gt;ï¼Œæœ‰è¯¦ç»†çš„ä»‹ç»ï¼ŒTLS Recordè¿‡å¤§å’Œè¿‡å°çš„ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;Nginx åœ¨1.5.9 ä¹‹ååŠ äº†ssl_buffer_sizeï¼Œä¸ç”¨ç¡¬æ”¹æºä»£ç äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Syntax:    ssl_buffer_size size;
Default:
ssl_buffer_size 16k;
Context:    http, server
This directive appeared in version 1.5.9.
Sets the size of the buffer used for sending data.

By default, the buffer size is 16k, which corresponds to minimal overhead when sending big responses. To minimize Time To First Byte it may be beneficial to use smaller values, for example:
   ssl_buffer_size 4k;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤§ç¥çš„ä¸€ä¸ªissueï¼š&lt;br&gt;
https://github.com/nodejs/node-v0.x-archive/issues/6889&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;That said, exposing a config flag to set a smaller / static record size is also suboptimal as it introduces an inherent tradeoff between latency and throughput â€“ smaller records are good for latency, but hurt server throughput by adding bytes and CPU overhead. It would be great if we could implement a smarter strategy in node... Some background on how Google servers handle this:

new connections default to small record size
      each record fits into a TCP packet
      packets are flushed at record boundaries
server tracks number of bytes written since reset and timestamp of last write
      if bytes written &amp;gt; {configurable byte threshold) then boost record size to 16KB
      if last write timestamp &amp;gt; now - {configurable time threshold} then reset sent byte count

In other words, start with small record size to optimize for delivery of
small/interactive objects (bulk of HTTP traffic). Then, if large file is
being transferred bump record size to 16KB and continue using that until
the connection goes idle.. when communication resumes, start with small
record size and repeat. Overall, this is aimed to optimize delivery of
small files where incremental delivery is a priority, and also for large
downloads where overall throughput is a priority.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ©ï¼Œä¸èƒ½ä¸€å‘³çš„è®¾ç½®é‚£ä¹ˆå°ï¼Œè¦åŠ¨æ€ã€‚&lt;/p&gt;
&lt;p&gt;çœ‹ä¸‹ä¹¦&lt;a href="https://book.douban.com/subject/26869219/"&gt;ã€Š HTTPS æƒå¨æŒ‡å—ã€‹&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;16.17 TLS ç¼“å†²åŒºè°ƒä¼˜
ä»1.5.9ç‰ˆæœ¬å¼€å§‹,Nginxå…è®¸ä½¿ç”¨ssl_buffer_sizeæŒ‡ä»¤è‡ªå®šä¹‰TLSç¼“å†²åŒºçš„å¤§å°ã€‚é»˜è®¤å€¼æ˜¯ 16 KB,ä½†æ˜¯è¿™ä¸ªå€¼ä¸ä¸€å®šæ˜¯æœ€ä¼˜åŒ–çš„,å°¤å…¶æ˜¯ä½ å¸Œæœ›é¦–å­—èŠ‚æ•°æ®è¢«å°½æ—©å‘é€æ—¶,æœ‰æŠ¥å‘Šæ˜¾ç¤ºä½¿ ç”¨1400å­—èŠ‚çš„é…ç½®å¯ä»¥æ˜¾è‘—å‡å°‘å»¶è¿Ÿã€‚
# å‡å°‘TLSç¼“å†²åŒºå¤§å°,å¯ä»¥æ˜¾è‘—å‡å°‘é¦–å­—èŠ‚æ—¶é—´ ssl_buffer_size 1400;
éœ€è¦æ³¨æ„çš„æ˜¯,å‡å°‘TLSç¼“å†²åŒºå¤§å°æœ‰å¯èƒ½ä¼šé™ä½è¿æ¥çš„ååé‡,ç‰¹åˆ«æ˜¯å½“ä½ éœ€è¦å‘é€å¤§é‡ çš„æ•°æ®æ—¶ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç»§ç»­çœ‹ä¸‹Nginxé‚®ä»¶ç»„çš„è®¨è®ºï¼š&lt;br&gt;
&lt;a href="http://mailman.nginx.org/pipermail/nginx/2013-December/041556.html"&gt;http://mailman.nginx.org/pipermail/nginx/2013-December/041556.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ€åæ˜¯cloudflareçš„ï¼šDynamic TLS Records in NGINX:&lt;br&gt;
&lt;a href="https://blog.cloudflare.com/optimizing-tls-over-tcp-to-reduce-latency/"&gt;Optimizing TLS over TCP to reduce latency&lt;/a&gt;,&lt;br&gt;
ç›¸å…³çš„Nginx Patch: &lt;a href="https://github.com/cloudflare/sslconfig/blob/master/patches/nginx__dynamic_tls_records.patch"&gt;nginx__dynamic_tls_records.patch&lt;/a&gt;&lt;/p&gt;
&lt;h2&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;ç›´æ¥ç”¨cloudflare çš„patchï¼›&lt;br&gt;
å¦‚æœåšä¸åˆ°åŠ¨æ€ï¼Œå…ˆé€‚å½“è°ƒå°ã€‚&lt;/p&gt;</content><category term="2016"></category><category term="TLS"></category><category term="HTTPS"></category><category term="Nginx"></category></entry><entry><title>ç›‘æ§æ‰€æœ‰NameServerçš„SOA è®°å½•çš„åºåˆ—å·</title><link href="https://fangpsh.github.io/posts/2016/2016-07-31.html" rel="alternate"></link><published>2016-07-31T19:49:30+08:00</published><updated>2016-07-31T19:49:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-07-31:/posts/2016/2016-07-31.html</id><summary type="html">&lt;p&gt;&lt;a href="/posts/2016/2016-05-11.html"&gt;Bind DLZ With MySQL &lt;/a&gt;æˆ–è€…å…¶ä»–æ–¹å¼æ­å»ºäº†æƒå¨DNSï¼Œä¸ºäº†é«˜å¯ç”¨çš„è¯ï¼Œè‚¯å®šä¼šæœ‰å¤šç»„NameServerã€‚
é™¤äº†å¸¸è§„çš„ç›‘æ§å¤–ï¼Œè¿˜éœ€è¦ç›‘æ§æ‰€æœ‰SLave çš„NS çš„SOA â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="/posts/2016/2016-05-11.html"&gt;Bind DLZ With MySQL &lt;/a&gt;æˆ–è€…å…¶ä»–æ–¹å¼æ­å»ºäº†æƒå¨DNSï¼Œä¸ºäº†é«˜å¯ç”¨çš„è¯ï¼Œè‚¯å®šä¼šæœ‰å¤šç»„NameServerã€‚
é™¤äº†å¸¸è§„çš„ç›‘æ§å¤–ï¼Œè¿˜éœ€è¦ç›‘æ§æ‰€æœ‰SLave çš„NS çš„SOA åºåˆ—å·ï¼ˆSerial Numberï¼‰æ˜¯å¦å’ŒMaster ä¸€è‡´ï¼Œå¦‚æœè½åçš„è¯éœ€è¦æŠ¥è­¦ï¼Œæœ‰æ—¶å€™ä¹Ÿæœ‰å¯èƒ½Master NSç”Ÿæˆçš„è®°å½•æœ‰é”™ï¼Œæ— æ³•åŒæ­¥åˆ°Slave NSï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æƒé™æ–¹é¢å‡ºé”™ç­‰ç­‰ï¼Œæ€»ä¹‹ï¼Œè¿™ä¸ªç›‘æ§éå¸¸æœ‰å¿…è¦ã€‚  &lt;/p&gt;
&lt;p&gt;å…³äºSOA è®°å½•çš„ä»‹ç»å¯ä»¥å‚è€ƒ:&lt;a href="https://support.microsoft.com/zh-tw/kb/163971"&gt;DNS SOA è®°å½•çš„ç»“æ„&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;@   IN  SOA     nameserver.place.dom.  postmaster.place.dom. (
                           1            ; serial number
                           3600         ; refresh   [1h]
                           600          ; retry     [10m]
                           86400        ; expire    [1d]
                           3600 )       ; min TTL   [1h]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨dig å‘½ä»¤å‘ç‰¹å®šNameServer æŸ¥è¯¢ç‰¹å®šåŸŸåçš„SOA è®°å½•:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;dig&lt;span class="w"&gt; &lt;/span&gt;@NS_IP&lt;span class="w"&gt; &lt;/span&gt;domain&lt;span class="w"&gt; &lt;/span&gt;soa
&amp;gt;&amp;gt;dig&lt;span class="w"&gt; &lt;/span&gt;@114.114.114.114&lt;span class="w"&gt; &lt;/span&gt;google.com&lt;span class="w"&gt; &lt;/span&gt;soa

&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;dig&lt;span class="w"&gt; &lt;/span&gt;@NS_IP&lt;span class="w"&gt; &lt;/span&gt;domain&lt;span class="w"&gt; &lt;/span&gt;soa&lt;span class="w"&gt; &lt;/span&gt;+short&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#è¿”å›ç®€çŸ­çš„ç»“æœ&lt;/span&gt;
&amp;gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;dig&lt;span class="w"&gt; &lt;/span&gt;@8.8.8.8&lt;span class="w"&gt; &lt;/span&gt;google&lt;span class="w"&gt; &lt;/span&gt;soa&lt;span class="w"&gt; &lt;/span&gt;+short
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;!-- more --&gt;

&lt;p&gt;&lt;img alt="dns_soa_serial_number" src="/assets/images/2023/20230301171412.png"&gt;&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªOpenFalcon çš„ç›‘æ§è„šæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/env bash&lt;/span&gt;
&lt;span class="c1"&gt;#author: fangpsh&lt;/span&gt;
&lt;span class="c1"&gt;#check whether NSs have same SOA serial&lt;/span&gt;
&lt;span class="nv"&gt;DATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;date&lt;span class="w"&gt; &lt;/span&gt;+%s&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="nv"&gt;HOST&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;cat&lt;span class="w"&gt; &lt;/span&gt;/etc/hostname&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="c1"&gt;#your domain&lt;/span&gt;
&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#master name server&lt;/span&gt;
&lt;span class="nv"&gt;MASTER_NS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="c1"&gt;#slave NSs, a space separated list&lt;/span&gt;
&lt;span class="nv"&gt;SLAVE_NS_SET&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;

q_serial&lt;span class="o"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
dig&lt;span class="w"&gt; &lt;/span&gt;@&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;1&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;DOMAIN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;soa&lt;span class="w"&gt; &lt;/span&gt;+short&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="nv"&gt;dns_s&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;q_serial&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;${MASTER_NS}&amp;#39;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;


&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;[{\&amp;quot;metric\&amp;quot;: \&amp;quot;NS_Serial\&amp;quot;, \&amp;quot;endpoint\&amp;quot;: \&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOST&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;, \&amp;quot;tags\&amp;quot;: \&amp;quot;host=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;MASTER_NS&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;, &amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\&amp;quot;value\&amp;quot;: 0,&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; \&amp;quot;timestamp\&amp;quot;: &lt;/span&gt;&lt;span class="nv"&gt;$DATE&lt;/span&gt;&lt;span class="s2"&gt;, \&amp;quot;counterType\&amp;quot;: \&amp;quot;GAUGE\&amp;quot;, \&amp;quot;step\&amp;quot;: 60}&amp;quot;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;ns&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;SLAVE_NS_SET&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nv"&gt;ns_s&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;q_serial&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ns&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;,{\&amp;quot;metric\&amp;quot;: \&amp;quot;NS_Serial\&amp;quot;, \&amp;quot;endpoint\&amp;quot;: \&amp;quot;&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;HOST&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;, \&amp;quot;tags\&amp;quot;: \&amp;quot;host=&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ns&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;\&amp;quot;, &amp;quot;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;dns_s&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;ns_s&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\&amp;quot;value\&amp;quot;: 0,&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#ok&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\&amp;quot;value\&amp;quot;: 1,&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#error&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot; \&amp;quot;timestamp\&amp;quot;: &lt;/span&gt;&lt;span class="nv"&gt;$DATE&lt;/span&gt;&lt;span class="s2"&gt;, \&amp;quot;counterType\&amp;quot;: \&amp;quot;GAUGE\&amp;quot;, \&amp;quot;step\&amp;quot;: 60}&amp;quot;&lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;]&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2016"></category><category term="DNS"></category></entry><entry><title>Haproxy ä½œä¸ºShadowsocks ä¸­ç»§é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜</title><link href="https://fangpsh.github.io/posts/2016/2016-07-27.html" rel="alternate"></link><published>2016-07-27T14:57:00+08:00</published><updated>2016-07-27T14:57:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-07-27:/posts/2016/2016-07-27.html</id><summary type="html">&lt;p&gt;ä¹‹å‰ç”¨Haproxy æ¥è½¬å‘Shadowsocks çš„æµé‡æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç°è±¡æ˜¯åœ¨ä½¿ç”¨Slack çš„æ—¶å€™ï¼ˆèŠå¤©ä½¿ç”¨äº†Websocketï¼‰ï¼Œé¢‘ç¹é‡è¿ã€‚å‡­ç›´è§‰æ˜¯ç”±äºHaproxy çš„æŸä¸€é¡¹timeout â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¹‹å‰ç”¨Haproxy æ¥è½¬å‘Shadowsocks çš„æµé‡æ—¶é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç°è±¡æ˜¯åœ¨ä½¿ç”¨Slack çš„æ—¶å€™ï¼ˆèŠå¤©ä½¿ç”¨äº†Websocketï¼‰ï¼Œé¢‘ç¹é‡è¿ã€‚å‡­ç›´è§‰æ˜¯ç”±äºHaproxy çš„æŸä¸€é¡¹timeout è®¾ç½®çš„ä¸åˆç†å¯¼è‡´çš„ã€‚&lt;br&gt;
Websocket åè®®å¯ä»¥åˆ†ä¸º2ä¸ªé˜¶æ®µï¼Œå…ˆç”¨HTTP æ¡æ‰‹ï¼Œç„¶åå»ºç«‹é•¿è¿æ¥ï¼Œé€šè¿‡ws åè®®è¿›è¡Œé€šä¿¡ã€‚å°†Haproxy ä½œä¸ºä¸­ç»§æ—¶ï¼Œåœ¨å»ºç«‹é•¿è¿æ¥ä¹‹åï¼ŒHaproxy å°±è½¬å…¥&lt;a href="http://blog.haproxy.com/2011/07/29/layer-4-load-balancing-tunnel-mode/"&gt;tunnel æ¨¡å¼&lt;/a&gt;ï¼š  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;TUNï¼štunnelï¼ˆoption http-tunnelï¼‰ï¼šè¿™æ˜¯ 1.0 ~ 1.5-dev21 çš„é»˜è®¤æ¨¡å¼ï¼Œç±»ä¼¼äºéš§é“ï¼ŒHAProxy ä»…å¤„ç†ç¬¬ä¸€ä¸ªè¯·æ±‚å’Œå“åº”ï¼Œå‰©ä½™çš„æŠ¥æ–‡å°†ç›´æ¥è½¬å‘è€Œä¸è¿›è¡Œå¤„ç†ã€‚å°½é‡ä¸è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œå› ä¸ºå®ƒåœ¨æ—¥å¿—è®°å½•å’Œ HTTP å¤„ç†ä¸Šæœ‰å¾ˆå¤šé—®é¢˜ã€‚ --æ¥æºï¼šliaoph.com&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¶‰åŠåˆ°çš„timeout è§ä¸‹å›¾ï¼š&lt;br&gt;
&lt;img alt="timeout_websocket" src="/assets/images/2023/20230301163942.png"&gt;&lt;br&gt;
å›¾ç‰‡æ¥æºï¼šwww.yuangguo.info&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬é‡åˆ°çš„éœ€è¦é¢‘ç¹é‡è¿çš„æƒ…å†µï¼Œå…¶å®æ˜¯ç”±äºtimeout tunnel è®¾ç½®ä¸åˆç†å¯¼è‡´çš„ã€‚å®˜æ–¹ç»™çš„å…³äº&lt;a href="https://cbonte.github.io/haproxy-dconv/1.7/configuration.html#4.2-timeout%20tunnel"&gt;timeout tunnel&lt;/a&gt; çš„è§£é‡Šï¼š &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Set the maximum inactivity time on the client and server side for tunnels.&lt;/p&gt;
&lt;p&gt;The tunnel timeout applies when a bidirectional connection is established
between a client and a server, and the connection remains inactive in both
directions. This timeout supersedes both the client and server timeouts once
the connection becomes a tunnel. In TCP, this timeout is used as soon as no
analyser remains attached to either connection (eg: tcp content rules are
accepted). &lt;strong&gt;In HTTP, this timeout is used when a connection is upgraded (eg:
when switching to the WebSocket protocol, or forwarding a CONNECT request
to a proxy), or after the first response when no keepalive/close option is
specified&lt;/strong&gt;......&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦å¤–å®˜æ–¹ç»™å‡ºäº†ä¸€ä¸ªé…ç½®ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;defaults http
    option http-server-close
    timeout connect 5s
    timeout client 30s
    timeout client-fin 30s
    timeout server 30s
    timeout tunnel  1h    # timeout to use with WebSocket and CONNECT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŠŠä¸­ç»§çš„Haproxy çš„è¿™é¡¹å€¼è®¾ä¸º1hï¼Œè§£å†³äº†Slack ä¼šé¢‘ç¹é‡è¿çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒï¼š
 - &lt;a href="https://github.com/shadowsocks/shadowsocks/wiki/Setup-a-Shadowsocks-relay"&gt;Setup a Shadowsocks relay&lt;/a&gt;
 - &lt;a href="http://www.yangguo.info/2014/06/25/haproxyå®ç°websocketè´Ÿè½½å‡è¡¡/"&gt;Haproxyä¹‹websocketçš„è´Ÿè½½å‡è¡¡æ–¹æ¡ˆ&lt;/a&gt;
 - &lt;a href="http://liaoph.com/haproxy-tutorial/"&gt;HAProxy åå‘ä»£ç†çš„ä½¿ç”¨&lt;/a&gt;&lt;/p&gt;</content><category term="2016"></category><category term="haproxy"></category><category term="websocket"></category></entry><entry><title>ElasticSearch ç”¨äºæ—¥å¿—è®°å½•</title><link href="https://fangpsh.github.io/posts/2016/elasticsearch-for-logging_zh.html" rel="alternate"></link><published>2016-06-15T11:40:00+08:00</published><updated>2016-06-15T11:40:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-06-15:/posts/2016/elasticsearch-for-logging_zh.html</id><summary type="html">&lt;p&gt;&lt;img alt="EdgeofSanity" src="/assets/images/2023/20230302133726.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://edgeofsanity.net/article/2012/12/26/elasticsearch-for-logging.html"&gt;åŸæ–‡åœ°å€&lt;/a&gt;ï¼š&lt;ul&gt;
&lt;li&gt;http://edgeofsanity.net/article/2012/12/26/elasticsearch-for-logging.html&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·²è·å¾—åŸæ–‡ä½œè€…ç¿»è¯‘è®¸å¯ï¼Œæœ¬æ–‡éµå¾ªåŸæ–‡è®¸å¯åè®®ã€‚&lt;/li&gt;
&lt;li&gt;åŸæ–‡å‘è¡¨æ—¶é—´ï¼š2012-12-26&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æˆ‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬åœ¨Web â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="EdgeofSanity" src="/assets/images/2023/20230302133726.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://edgeofsanity.net/article/2012/12/26/elasticsearch-for-logging.html"&gt;åŸæ–‡åœ°å€&lt;/a&gt;ï¼š&lt;ul&gt;
&lt;li&gt;http://edgeofsanity.net/article/2012/12/26/elasticsearch-for-logging.html&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å·²è·å¾—åŸæ–‡ä½œè€…ç¿»è¯‘è®¸å¯ï¼Œæœ¬æ–‡éµå¾ªåŸæ–‡è®¸å¯åè®®ã€‚&lt;/li&gt;
&lt;li&gt;åŸæ–‡å‘è¡¨æ—¶é—´ï¼š2012-12-26&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨æˆ‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬åœ¨Web å‰ç«¯æœç´¢ä¸Šä½¿ç”¨&lt;a href="http://elasticsearch.org/"&gt;ElasticSearch&lt;/a&gt;ã€‚æ€§èƒ½è‡³å…³é‡è¦ï¼Œå¯¹æˆ‘ä»¬è€Œè¨€ï¼Œå¤§å¤šæ•°çš„æ•°æ®æ˜¯é™æ€çš„ã€‚&lt;br&gt;
æˆ‘ä»¬æ¯å¤©æ›´æ–°æœç´¢ç´¢å¼•ï¼Œä¸è¿‡ç”¨æ—§çš„ç´¢å¼•è·‘å‡ ä¸ªæ˜ŸæœŸä¹Ÿæ²¡é—®é¢˜ã€‚è¿™ä¸ªé›†ç¾¤å¤§éƒ¨åˆ†çš„æµé‡æ˜¯æœç´¢ï¼›è¿™æ˜¯ä¸€ä¸ªâ€œé‡è¯»â€çš„é›†ç¾¤ã€‚ä¸€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬æœ‰ä¸€äº›æ€§èƒ½ä¸Šçš„å°é—®é¢˜ï¼Œ&lt;br&gt;
ä¸è¿‡æˆ‘ä»¬é€šè¿‡å’ŒElasticSearch çš„Shay Bannon å¯†åˆ‡åˆä½œè§£å†³äº†è¿™äº›é—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬çš„å‰ç«¯é›†ç¾¤éå¸¸å¯é ï¼Œçµæ´»ï¼Œå’Œå¿«é€Ÿã€‚  &lt;/p&gt;
&lt;p&gt;æˆ‘ç›®å‰çš„å·¥ä½œæ˜¯éƒ¨ç½²ä¸€ä¸ªç¬¦åˆè§„èŒƒï¼ŒåŒæ—¶ä¹Ÿéå¸¸æœ‰ç”¨çš„ä¸­å¿ƒåŒ–çš„æ—¥å¿—åŸºç¡€æœåŠ¡ã€‚è¿™ä¸ªæ—¥å¿—åŸºç¡€æœåŠ¡çš„ç›®æ ‡æ˜¯å°½å¯èƒ½çš„å®ç°Splunk çš„åŠŸèƒ½ã€‚æˆ‘&lt;a href="http://edgeofsanity.net/article/2012/06/17/central-logging-with-open-source-software.html"&gt;ä¹‹å‰å†™çš„ä¸€ç¯‡å…³äºæ—¥å¿—è®°å½•çš„æ–‡ç« &lt;/a&gt;è§£é‡Šäº†æˆ‘ä»¬ä¸ºä»€ä¹ˆå†³å®šä¸ç”¨&lt;a href="http://splunk.com/"&gt;Splunk&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;è¯„ä¼°äº†ä¸€äº›é€‰æ‹©ä¹‹åï¼Œæˆ‘å†³å®šä½¿ç”¨ElasticSearch ä½œä¸ºè¿™ä¸ªç³»ç»Ÿçš„åç«¯å­˜å‚¨ã€‚è¿™ä¸ªé›†ç¾¤çš„ç±»å‹å’Œæˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ç”¨äºå¤§é‡æœç´¢çš„é›†ç¾¤&lt;em&gt;éå¸¸ä¸åŒ&lt;/em&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;è¯‘æ–‡&lt;br&gt;
ç”±&lt;a href="http://www.everycloudtech.com"&gt;EveryCloud&lt;/a&gt; è´¡çŒ®çš„ä¸€ç¯‡&lt;a href="http://www.everycloudtech.com/elasticsearch-for-logging"&gt;ä¿„è¯­è¯‘æ–‡&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;h2&gt;ç´¢å¼•è®¾è®¡&lt;/h2&gt;
&lt;p&gt;ä¸¤ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—åˆ†å‘ç³»ç»Ÿæ˜¯&lt;a href="http://graylog2.org/"&gt;Graylog2&lt;/a&gt; å’Œ&lt;a href="http://logstash.net/"&gt;LogStash&lt;/a&gt;ã€‚åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œ&lt;em&gt;ç¨³å®š&lt;/em&gt;ç‰ˆæœ¬çš„Graylog2 åªæ”¯æŒä»å•ä¸€çš„ç´¢å¼•è¯»/å†™ã€‚æ­£å¦‚é€ä¹‹å‰æ–‡ç« ä¸­æŒ‡å‡ºçš„ï¼ŒGraylog2 å­˜åœ¨&lt;em&gt;å¾ˆå¤š&lt;/em&gt;ä¸¥é‡çš„é—®é¢˜ã€‚0.10.0 ç‰ˆçš„Graylog2 å°†åŒ…å«è”åˆå¤šä¸ªç´¢å¼•çš„èƒ½åŠ›ã€‚ç„¶è€Œï¼Œæˆ‘å·²ç»åœ¨LogStash çš„ç´¢å¼•ä¸Šæœ‰äº†ä¸€äº›ç»éªŒï¼Œå› ä¸ºä¹‹å‰å®ƒæ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸ºäº†å°½å¯èƒ½å¾—å……åˆ†åˆ©ç”¨ElasticSearch ç”¨æ¥åšæ—¥å¿—è®°å½•ï¼Œä½ éœ€è¦ä½¿ç”¨å¤šä¸ªç´¢å¼•ã€‚å½“ä½ æ»šåŠ¨æ›´æ–°ç´¢å¼•çš„æ—¶å€™æœ‰éå¸¸å¤šç§æ–¹å¼ï¼Œä¸è¿‡LogStash é»˜è®¤çš„æ¯å¤©æ»šåŠ¨æ›´æ–°çš„æ–¹å¼æ˜¯æœ€åˆç†çš„ã€‚è¿™æ ·ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹åˆ—å†…å®¹ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;logstash-2012.12.19&lt;/li&gt;
&lt;li&gt;logstash-2012.12.20&lt;/li&gt;
&lt;li&gt;logstash-2012.12.21&lt;/li&gt;
&lt;li&gt;logstash-THE_WORLD_HAS_ENDED&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½ å¯ä»¥è·Ÿè¸ªæ¯ä¸ªç´¢å¼•ä¸­æœ‰å¤šå°‘ä¸ªæ–‡æœ¬ã€‚åœ¨ç™¾ä¸‡æˆ–è€…åƒä¸‡ä¸ªæ–‡æœ¬ä¹‹åæ»šåŠ¨æ›´æ–°ï¼Œæˆ–è€…å…¶ä»–ä½ éšæ„è®¾å®šçš„æ•°å€¼ä¹‹åï¼Œä½†æ˜¯è¿™æ ·ä½ ä¼šç»™ä½ è‡ªå·±ä»¥åå¸¦æ¥æ›´å¤šçš„å·¥ä½œå†…å®¹ã€‚åœ¨æŸäº›å°‘è§çš„æƒ…å†µä¸‹å…¶ä»–çš„ç´¢å¼•æ–¹å¼å¯èƒ½ä¼šæ›´é«˜æ•ˆï¼Œä½†æ˜¯å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œä¸€å¤©ä¸€ä¸ªç´¢å¼•æ˜¯æœ€ç®€å•çš„ï¼Œä¹Ÿèƒ½æœ€æœ‰æ•ˆçš„åˆ©ç”¨ä½ çš„èµ„æºã€‚  &lt;/p&gt;
&lt;!-- more --&gt;

&lt;h2&gt;è®¤çœŸç‚¹ï¼Œä¸ç„¶å°±å›å®¶å¾…ç€&lt;/h2&gt;
&lt;p&gt;LogStash å’ŒGraylog2 éƒ½é™„å¸¦å†…ç½®çš„ElasticSearchã€‚è¿™å¯¹ç¤ºèŒƒæ¼”ç¤ºå’Œå¼€å‘æ¥è¯´éå¸¸æ–¹ä¾¿ã€‚&lt;em&gt;ç”¨äºçœŸæ­£ç”¨é€”çš„æ—¶å€™ä¸è¦ä½¿ç”¨å†…ç½®çš„æœåŠ¡å™¨ï¼&lt;/em&gt;æˆ‘éå¸¸æƒŠå¥‡æœ‰å¤§é‡çš„LogStash å’ŒGraylog2 ç”¨æˆ·ä½¿ç”¨äº†å†…ç½®çš„ElasticSearch å­˜å‚¨å¼•æ“ï¼Œæœ€ååœ¨irc.freenode.org çš„ #elasticsearch é¢‘é“é‡Œå¯¹æœåŠ¡å´©æºƒæ„Ÿåˆ°å¥‡æ€ªã€‚  &lt;/p&gt;
&lt;p&gt;&lt;em&gt;è¯·è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„ElasticSearch é›†ç¾¤ï¼&lt;/em&gt;  &lt;/p&gt;
&lt;p&gt;ä½ å°†éœ€è¦ä¸ºé›†ç¾¤åˆ’åˆ’åˆ†ç¡¬ä»¶ã€‚åƒLogStashå’ŒElasticSearch è¿™æ ·çš„Java åº”ç”¨æ˜¯å†…å­˜å’Œç£ç›˜ç¼“å­˜å¯†é›†å‹çš„ã€‚ä¿è¯ä¸€æ‰¹ç¡¬ä»¶æ˜¯ç”¨æ¥ä½œä¸ºæ—¥å¿—å¤„ç†çš„ç®±å­ï¼Œç„¶ååˆ’åˆ†è¿™äº›ç®±å­ç»™ElasticSearch é›†ç¾¤ã€‚Java æœ‰ä¸€äº›å¥‡æ€ªçš„å†…å­˜é—®é¢˜ã€‚æˆ‘ä»¬å‘ç°ä½ ä¸ä¼šæƒ³æŠŠè¶…è¿‡32GBå†…å­˜ç»™ElasticSearchï¼Œé¢„ç•™è‡³å°‘8GB ç»™æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œæˆ‘çš„é›†ç¾¤æ¯å¤©å¤„ç†å¤§çº¦60GB çš„æ—¥å¿—èµ„æ–™ï¼Œé›†ç¾¤ä¸€å…±æœ‰ä¸‰ä¸ªæœç´¢èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹24GB å†…å­˜ï¼Œæ¯«æ— å‹åŠ›ã€‚è¿™å¼•å‘ä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œ&lt;strong&gt;æˆ‘çš„é›†ç¾¤éœ€è¦å¤šå°‘å°æœåŠ¡å™¨ï¼Ÿ&lt;/strong&gt;å¼€å§‹å…ˆåœ¨ä½ çš„ElasticSearch é›†ç¾¤ä¸­éƒ¨ç½²3å°æœåŠ¡å™¨ã€‚è¿™æ ·ä½ å¯ä»¥çµæ´»çš„å…³é—­ä¸€å°æœåŠ¡å™¨ï¼Œç»´æŒä½ çš„é›†ç¾¤èƒ½å……åˆ†å¾—è¢«ä½¿ç”¨ã€‚ä½ å¯ä»¥éšæ—¶æ·»åŠ æ›´å¤šçš„ç¡¬ä»¶ï¼  &lt;/p&gt;
&lt;h2&gt;å®‰è£…ElasticSearch&lt;/h2&gt;
&lt;p&gt;æˆ‘ä¸æ‰“ç®—è¦†ç›–å®‰è£…ElasticSearch çš„æ‰€æœ‰å†…å®¹ï¼Œä½ å¯ä»¥åœ¨æ–‡æ¡£ç«™ç‚¹ä¸Š&lt;a href="http://www.elasticsearch.org/guide/reference/setup/installation.html"&gt;è¯»åˆ°æ›´å¤šå…³äºè¿™æ–¹é¢çš„å†…å®¹&lt;/a&gt;ã€‚ä½ å¯èƒ½å†³å®šé€šè¿‡&lt;a href="https://github.com/Aethylred/puppet-elasticsearch"&gt;Puppet&lt;/a&gt; æˆ–&lt;a href="https://github.com/karmi/cookbook-elasticsearch"&gt;Chef&lt;/a&gt; åˆ©ç”¨ .deb åŒ…æˆ–&lt;a href="https://github.com/tavisto/elasticsearch-rpms"&gt;rpm&lt;/a&gt; åŒ…çš„æ–¹å¼åˆ›å»ºä¸€ä»½ElasticSearch çš„éƒ¨ç½²è„šæœ¬ã€‚å…³äºå®‰è£…æˆ‘ä¼šè¯´çš„å”¯ä¸€ä¸€ä»¶äº‹æ˜¯ï¼Œæ— è®ºæœ‰å¤šä¸çˆ½ï¼Œæœ€å¥½è¿˜æ˜¯ç”¨&lt;a href="http://www.java.com/en/download/index.jsp"&gt;Sun JVM&lt;/a&gt; è¿è¡ŒElasticSearchã€‚è¿™æ˜¯ElasticSearch çš„å¼€å‘äººå‘˜è¿è¡ŒElasticSearch çš„æ–¹å¼ï¼Œæ‰€ä»¥ä½ ä¹Ÿåº”è¯¥è¿™æ ·ã€‚  &lt;/p&gt;
&lt;h2&gt;ElasticSearch é…ç½®ï¼šOS å’Œ Java&lt;/h2&gt;
&lt;p&gt;ä¸»æœºç³»ç»Ÿä¸Šæœ‰ä¸€äº›åœ°æ–¹ä½ &lt;strong&gt;çœŸçš„&lt;/strong&gt;éœ€è¦é…ç½®ä¸€ä¸‹ã€‚æˆ‘å‡å®šä½ çš„ä¸»æœºç³»ç»Ÿä¸Šè¿è¡Œçš„æ˜¯Linux ç³»ç»Ÿã€‚ä½ åº”è¯¥ä½¿ç”¨éç‰¹æƒç”¨æˆ·æ¥è¿è¡ŒElasticSearchã€‚æˆ‘ä»¬çš„é›†ç¾¤æ˜¯ç”¨'elasticsearch' ç”¨æˆ·æ¥è¿è¡Œçš„ï¼Œå¦å¤–æˆ‘ä»¬è°ƒæ•´äº†&lt;code&gt;/etc/security/limits.conf&lt;/code&gt;ä¸­å†…æ ¸å¯¹è¿›ç¨‹å’Œå†…å­˜ä¸Šçš„é™åˆ¶ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Ensure ElasticSearch can open files and lock memory!
elasticsearch   soft    nofile          65536
elasticsearch   hard    nofile          65536
elasticsearch   -       memlock         unlimited
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ ä¹Ÿåº”è¯¥æŠŠElasticSearch æœ€å°å’Œæœ€å¤§çš„å†…å­˜æ± è®¾ç½®ä¸º&lt;strong&gt;ä¸€æ ·çš„å€¼&lt;/strong&gt;ã€‚è¿™æ ·ä½¿å¾—å¯åŠ¨æ—¶å°±èƒ½åˆ†é…åˆ°æ€»å†…å­˜ï¼Œè¿™æ ·çº¿ç¨‹éœ€è¦æ›´å¤šçš„å†…å­˜çš„æ—¶å€™ä¸éœ€è¦ç­‰å¾…å†…æ ¸åˆ†é…ã€‚æˆ‘åœ¨ä¸€ä¸ªRedHat ç³»ç»Ÿä¸Šéƒ¨ç½²äº†ElasticSearchï¼Œ&lt;code&gt;/etc/sysconfig/elasticsearch&lt;/code&gt;ä¸­çš„é…ç½®ä¼šåœ¨daemon è¿›ç¨‹å¯åŠ¨æ—¶è®¾ç½®å¥½ç¯å¢ƒå˜é‡ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Allocate 14 Gigs of RAM
ES_MIN_MEM=14g
ES_MAX_MEM=&amp;quot;$ES_MIN_MEM&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä»½æ–‡ä»¶ç”±Puppet ç®¡ç†ï¼Œå¹¶è®¾ç½®å†…å­˜å¤§å°ç­‰äº50% çš„RAM å¤§å°ï¼Œå†™2éã€‚è¿™æ²¡ä»€ä¹ˆéš¾çš„ï¼Œåœ¨&lt;em&gt;æ¯ä»½&lt;/em&gt;ElasticSearch ä¼˜åŒ–æŒ‡å—ä¸­éƒ½ä¼šæåˆ°ã€‚  &lt;/p&gt;
&lt;h2&gt;ElasticSearch é…ç½®ï¼šelasticsearch.yml&lt;/h2&gt;
&lt;p&gt;åœ¨&lt;code&gt;elasticsearch.yml&lt;/code&gt; æ–‡ä»¶ä¸­æœ‰ä¸€äº›è°ƒä¼˜çš„äº‹æƒ…æˆ‘ä»¬å¯ä»¥åšï¼Œå¯ä»¥æå¤§çš„æ”¹è¿›é‡å†™çš„èŠ‚ç‚¹çš„æ€§èƒ½ã€‚é¦–å…ˆæ˜¯è®¾ç½®&lt;code&gt;bootstrap.mlockall&lt;/code&gt; ä¸º trueã€‚è¿™ä¼šå¼ºåˆ¶JVM ç«‹å³åˆ†é…æ‰€æœ‰çš„&lt;code&gt;ES_MIN_MEM&lt;/code&gt;ã€‚è¿™æ„å‘³ç€Java åœ¨å¯åŠ¨æ—¶å°±æœ‰äº†æ‰€æœ‰æ‰€éœ€çš„å†…å­˜ï¼é‡å†™çš„é›†ç¾¤çš„å¦å¤–ä¸€ä¸ªè®©äººæ‹…å¿ƒçš„ç‚¹æ˜¯indexing/bulk å¼•æ“åˆ†é…å†…å­˜æ—¶ä¸å‡è¡¡çš„é—®é¢˜ã€‚  &lt;/p&gt;
&lt;p&gt;ElasticSearch æ˜¯å‡å®šä½ å°†å¤§é‡ä½¿ç”¨æœç´¢ï¼Œæ‰€ä»¥åˆ†é…äº†å¤§éƒ¨åˆ†çš„å†…å­˜ç”¨äºä¿éšœæœç´¢ã€‚è¿™ä¸æ˜¯æˆ‘çš„é›†ç¾¤çš„ä½¿ç”¨æƒ…å†µï¼Œæ‰€ä»¥è°ƒæ•´&lt;code&gt;indices.memory.index_buffer_size&lt;/code&gt;åˆ°50%ï¼Œä»è€Œæ¢å¤åœ¨æˆ‘ä»¬ä½¿ç”¨æ–¹å¼ä¸‹å†…å­˜åˆ†é…çš„å¹³è¡¡ã€‚åœ¨æˆ‘çš„è®¾ç½®é‡Œï¼Œæˆ‘è¿˜æé«˜äº†åˆ·æ–°é—´éš”å’Œæ—¥å¿—åˆ·æ–°çš„ä¼ è¾“æ€»æ•°ã€‚å¦åˆ™ï¼ŒElasticSearch å°†éœ€è¦æ¥è¿‘æ¯åˆ†é’Ÿéƒ½åˆ·æ–°ä¼ è¾“æ—¥å¿—ã€‚  &lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªéœ€è¦æˆ‘ä»¬è°ƒæ•´ä»¥é¿å…ç¾éš¾æ€§çš„å¤±è´¥çš„åœ°æ–¹æ˜¯çº¿ç¨‹æ± çš„è®¾ç½®ã€‚ElasticSearch ä¼šåšå®ƒè®¤ä¸ºèƒ½è·å¾—æœ€å¥½æ€§èƒ½çš„äº‹æƒ…ã€‚æˆ‘ä»¬å‘ç°ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™æ„å‘³ç€ç”Ÿæˆæˆåƒä¸Šä¸‡çš„çº¿ç¨‹æ¥å¤„ç†ä¼ å…¥çš„è¯·æ±‚ã€‚åœ¨é«˜è´Ÿè½½ä¸‹ï¼Œä½ çš„é›†ç¾¤å¾ˆå¿«ä¼šè¢«å‹å®ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åˆ†åˆ«è®¾ç½®äº†search,index å’Œbulk çº¿ç¨‹æ± çš„æœ€å¤§å€¼ã€‚æˆ‘ä»¬ä¸»è¦çš„æ“ä½œæ˜¯bulkï¼Œæ‰€ä»¥ç»™bulk è®¾ç½®äº†60ä¸ªçº¿ç¨‹ï¼Œå…¶ä»–çš„æ“ä½œè®¾ç½®äº†20ä¸ªçº¿ç¨‹ã€‚æˆ‘ä»¬ä¹Ÿè®¾ç½®äº†bulk é˜Ÿåˆ—èƒ½å¤„ç†çš„æœ€å¤§è¯·æ±‚æ•°ä¸º200ï¼Œå…¶ä»–çš„å„ä¸º100ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœé›†ç¾¤è¿‡è½½ï¼Œå®ƒä¼šæ‹’ç»æ–°çš„è¯·æ±‚ï¼Œä¸è¿‡å®ƒä¼šç•™ç»™ä½ è¶³å¤Ÿçš„æ–‡ä»¶æè¿°æ•°å’ŒPID æ¥ssh åˆ°ä¸»æœºä¸­æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ã€‚  &lt;/p&gt;
&lt;p&gt;æ€»ç»“ä»¥ä¸Šå†…å®¹ï¼Œè¿™æ˜¯æˆ‘çš„&lt;a href="https://gist.github.com/reyjrar/4364063#file-elasticsearch-yml"&gt;é…ç½®æ–‡ä»¶&lt;/a&gt;ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="c1"&gt;##################################################################&lt;/span&gt;
&lt;span class="c1"&gt;# /etc/elasticsearch/elasticsearch.yml&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Base configuration for a write heavy cluster&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;

&lt;span class="c1"&gt;# Cluster / Node Basics&lt;/span&gt;
&lt;span class="nt"&gt;cluster.name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;logng&lt;/span&gt;

&lt;span class="c1"&gt;# Node can have abritrary attributes we can use for routing&lt;/span&gt;
&lt;span class="nt"&gt;node.name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;logsearch-01&lt;/span&gt;
&lt;span class="nt"&gt;node.datacenter&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;amsterdam&lt;/span&gt;

&lt;span class="c1"&gt;# Force all memory to be locked, forcing the JVM to never swap&lt;/span&gt;
&lt;span class="nt"&gt;bootstrap.mlockall&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;true&lt;/span&gt;

&lt;span class="c1"&gt;## Threadpool Settings ##&lt;/span&gt;

&lt;span class="c1"&gt;# Search pool&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.search.type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;fixed&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.search.size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;20&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.search.queue_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;100&lt;/span&gt;

&lt;span class="c1"&gt;# Bulk pool&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.bulk.type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;fixed&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.bulk.size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;60&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.bulk.queue_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;300&lt;/span&gt;

&lt;span class="c1"&gt;# Index pool&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.index.type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;fixed&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.index.size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;20&lt;/span&gt;
&lt;span class="nt"&gt;threadpool.index.queue_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;100&lt;/span&gt;

&lt;span class="c1"&gt;# Indices settings&lt;/span&gt;
&lt;span class="nt"&gt;indices.memory.index_buffer_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;30%&lt;/span&gt;
&lt;span class="nt"&gt;indices.memory.min_shard_index_buffer_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;12mb&lt;/span&gt;
&lt;span class="nt"&gt;indices.memory.min_index_buffer_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;96mb&lt;/span&gt;

&lt;span class="c1"&gt;# Cache Sizes&lt;/span&gt;
&lt;span class="nt"&gt;indices.fielddata.cache.size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;15%&lt;/span&gt;
&lt;span class="nt"&gt;indices.fielddata.cache.expire&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;6h&lt;/span&gt;
&lt;span class="nt"&gt;indices.cache.filter.size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;15%&lt;/span&gt;
&lt;span class="nt"&gt;indices.cache.filter.expire&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;6h&lt;/span&gt;

&lt;span class="c1"&gt;# Indexing Settings for Writes&lt;/span&gt;
&lt;span class="nt"&gt;index.refresh_interval&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;30s&lt;/span&gt;
&lt;span class="nt"&gt;index.translog.flush_threshold_ops&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;50000&lt;/span&gt;

&lt;span class="c1"&gt;# Minimum nodes alive to constitute an operational cluster&lt;/span&gt;
&lt;span class="nt"&gt;discovery.zen.minimum_master_nodes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;2&lt;/span&gt;

&lt;span class="c1"&gt;# Unicast Discovery (disable multicast)&lt;/span&gt;
&lt;span class="nt"&gt;discovery.zen.ping.multicast.enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;false&lt;/span&gt;
&lt;span class="nt"&gt;discovery.zen.ping.unicast.hosts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p p-Indicator"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logsearch-01&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logsearch-02&amp;quot;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;quot;logsearch-03&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p p-Indicator"&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ElasticSearch é…ç½®: ç´¢å¼•æ¨¡æ¿&lt;/h2&gt;
&lt;p&gt;ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘æ˜¯åŸºäºLogStash æ¥éƒ¨ç½²é›†ç¾¤ï¼Œç”±äºé‚£æ—¶Graylog2 éƒ¨ç½²ä¸Šçš„ç¼ºç‚¹ã€‚è¿™ä¸€èŠ‚å†…å®¹ä¸»è¦å…³äºâ€œlogstashâ€ï¼Œä½†åŒæ ·ä¹Ÿé€‚ç”¨äºGraylog2 æˆ–å…¶ä»–è‡ªå®šä¹‰çš„ç´¢å¼•æ˜ å°„ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html"&gt;Mapping&lt;/a&gt;ï¼‰ã€‚  &lt;/p&gt;
&lt;p&gt;å› ä¸ºæˆ‘ä»¬å†³å®šä¸€å¤©åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œè¿™å°±æœ‰ä¸¤ç§æ–¹å¼é…ç½®æ¯ä¸ªç´¢å¼•çš„æ˜ å°„å’Œç‰¹æ€§ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§æˆ‘ä»¬çš„éœ€æ±‚é…ç½®æ˜ç¡®å¾—ç”Ÿæˆç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªåŒ…å«æˆ‘ä»¬éœ€è¦çš„é…ç½®å’Œç‰¹æ€§çš„æ¨¡æ¿æ¥ç”Ÿæˆæ¯ä¸ªç´¢å¼•ï¼æ¨¡æ¿åœ¨è¿™ç§æƒ…å†µä¸‹æœ€æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œçš„é›†ç¾¤ä¸Šåˆ›å»ºå®ƒä»¬ï¼  &lt;/p&gt;
&lt;p&gt;æˆ‘çš„&lt;a href="https://gist.github.com/reyjrar/4364225#file-logstash-template-json"&gt;æ¨¡æ¿é…ç½®&lt;/a&gt;å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;template&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;logstash-*&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;settings&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index.number_of_shards&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index.number_of_replicas&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index.query.default_field&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@message&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index.routing.allocation.total_shards_per_node&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index.auto_expand_replicas&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;mappings&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;_default_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;_all&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;enabled&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;_source&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;compress&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;dynamic_templates&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;fields_template&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;mapping&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;path_match&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@fields.*&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;tags_template&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;mapping&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;path_match&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;@tags.*&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;properties&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@fields&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;object&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;dynamic&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;path&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;full&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@source&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@source_host&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@source_path&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@timestamp&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;date&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;not_analyzed&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;@message&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;string&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;analyzer&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;whitespace&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¦åœ¨é›†ç¾¤ä¸Šåº”ç”¨é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªPUT æ¥åˆ›å»ºå’Œæ›´æ–°æ¨¡æ¿ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;curl -XPUT &amp;#39;http://localhost:9200/_template/template_logstash/&amp;#39; -d @logstash-template.json
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å°†æ¨¡æ¿è®¾ç½®ä¸º&lt;code&gt;logstash-*&lt;/code&gt; ï¼Œæ„å‘³ç€é…ç½®å°†åº”ç”¨åˆ°æ‰€ä»¥'logstash-' å¼€å¤´æ–°å»ºçš„ç´¢å¼•ã€‚æˆ‘é€šè¿‡ç¦ç”¨å¯¹&lt;code&gt;_all&lt;/code&gt; å­—æ®µè¿›è¡Œæœç´¢å¹¶å°†é»˜è®¤çš„å±æ€§ä¿®æ”¹ä¸º&lt;code&gt;@message&lt;/code&gt;ï¼Œè¦†ç›–äº†åŸæ¥çš„é»˜è®¤æœç´¢è¡Œä¸ºï¼ˆè¯‘æ³¨ï¼šé»˜è®¤ä¼šå¯¹å…¨éƒ¨å­—æ®µè¿›è¡Œæœç´¢ï¼Œä½œè€…ç¦ç”¨äº†è¿™ç§è¡Œä¸ºï¼Œä¿®æ”¹ä¸ºåªå¯¹message å­—æ®µè¿›è¡Œæœç´¢ï¼‰ã€‚è¿™ä¸ªå­—æ®µï¼ˆè¯‘æ³¨ï¼šæŒ‡message å­—æ®µï¼‰å°†åŒ…å«åŸç”Ÿçš„syslog æ¶ˆæ¯ã€‚è¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªç¦æ­¢åˆ†æçš„å­—æ®µã€‚ä¸è¦ä¸å®‰ã€‚è¿™èƒ½èŠ‚çœç©ºé—´å’Œå»ºç«‹ç´¢å¼•çš„æ—¶é—´ã€‚è¿™æ„å‘³ç€æœç´¢æ–‡æ¡£ä¸­å…¶ä»–å­—æ®µæ—¶åªèƒ½ä½¿ç”¨ç²¾ç¡®æœç´¢ï¼Œè€Œä¸èƒ½ä½¿ç”¨æ¨¡ç³Šæœç´¢ï¼Œä¸è¿‡è¿™æ˜¯OK çš„ã€‚æˆ‘ä»¬ä¾ç„¶å¯ä»¥å¯¹&lt;code&gt;@message&lt;/code&gt; å­—æ®µè¿›è¡Œæ¨¡ç³Šæœç´¢ï¼è¿™å°†æå¤§çš„é™ä½å­˜å‚¨ç©ºé—´ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼ŒElasticSearch 0.19 ä¹‹å‰ï¼Œä½ å¯èƒ½è§è¿‡è®¾ç½®äº†&lt;code&gt;"_source": { "compress": true }&lt;/code&gt; ã€‚è¿™å¯¹æ—¥å¿—ç±»çš„æ•°æ®æ˜¯ä¸æ¨èçš„ã€‚è¿™ä¸ªå±æ€§å†³å®šäº†æ¯ä»½æ–‡æ¡£ï¼ˆæ—¥å¿—æ¶ˆæ¯ï¼‰æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚ç”±äºè¿™äº›æ–‡ä»¶å¾€å¾€éå¸¸å°ï¼Œå‹ç¼©å¹¶ä¸èƒ½çœŸæ­£çš„èŠ‚çœå¾ˆå¤šçš„ç©ºé—´ã€‚åœ¨è¿›è¡Œç´¢å¼•å’Œæ£€ç´¢çš„æ—¶ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„æ—¶é—´æˆæœ¬ã€‚å¯¹è®°å½•æ—¥å¿—çš„é›†ç¾¤æ¥è¯´æœ€å¥½ç¦ç”¨å‹ç¼©ã€‚æˆ‘ä»¬&lt;code&gt;elasticsearch.yml&lt;/code&gt;ä¸­å¯ç”¨çš„å‹ç¼©æ˜¯ä½¿ç”¨å—çº§åˆ«çš„å‹ç¼©æ–¹å¼ï¼Œæ›´åŠ é«˜æ•ˆã€‚&lt;/p&gt;
&lt;h3&gt;ç´¢å¼•é…ç½®&lt;/h3&gt;
&lt;p&gt;è¿™ä»½ç´¢å¼•çš„é…ç½®æ˜¯ä¸ºä¸€ä¸ª3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤è°ƒä¼˜çš„ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹é…ç½®ä¸­çš„ä»»ä½•é¡¹ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦æ‰©å®¹æˆ–è€…ç¼©å®¹æ—¶ï¼Œ&lt;code&gt;index.number_of_shards&lt;/code&gt;éœ€è¦ç«‹å³ä¿®æ”¹ã€‚è¿™ä»½é…ç½®ä¸æ˜¯ç»å¯¹å®Œç¾çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰æ—¶æœ€åä¼šæœ‰ä¸€äº›å­¤å„¿ï¼ˆæœªåˆ†é…ï¼‰çš„åˆ†ç‰‡ã€‚é€šè¿‡&lt;a href="http://www.elasticsearch.org/guide/reference/api/admin-cluster-reroute.html"&gt;ElasticSearch API&lt;/a&gt; æ¥ç§»åŠ¨åˆ†ç‰‡å¯ä»¥å¾ˆæ–¹ä¾¿çš„çº æ­£è¿™äº›é”™è¯¯ã€‚  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬éšç€æ·»åŠ èŠ‚ç‚¹è€Œæå‡å­˜å‚¨èƒ½åŠ›ï¼Œè€Œä¸æ˜¯å¤åˆ¶æ•´ä¸ªç´¢å¼•åˆ°æ•´ä¸ªé›†ç¾¤ã€‚è¿™æ ·æˆ‘ä»¬æœ‰ä¸€ä¸ªç±»ä¼¼â€œRAIDâ€ çš„åˆ†é…åˆ†ç‰‡çš„è®¾ç½®ã€‚æˆ‘æœ‰ä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œæ¯ä¸ªç´¢å¼•æˆ‘åˆ›å»º3ä¸ªåˆ†ç‰‡ã€‚è¿™æ„å‘³ç€ä¸»åˆ†ç‰‡æˆ–è€…â€œå†™â€åˆ†ç‰‡å¯ä»¥åˆ†æ‘Šåˆ°æ¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸ºäº†å†—ä½™ï¼Œæˆ‘è®¾ç½®å‰¯æœ¬æ•°ä¸ºä¸€ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç´¢å¼•æœ‰6ä¸ªåˆ†ç‰‡ã€‚æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦æœ‰æ¯ä¸ªç´¢å¼•çš„2ä¸ªåˆ†ç‰‡ã€‚  &lt;/p&gt;
&lt;p&gt;ä½ éœ€è¦è¿›è¡Œå®éªŒæ¥æ‰¾åˆ°ä½ éœ€è¦çš„é…ç½®ã€‚åœ¨å¤±å»åŠŸèƒ½å‰ï¼Œè€ƒè™‘ä¸€ä¸‹æŸå¤±å¤šå°‘ä¸ªèŠ‚ç‚¹æ˜¯ä½ èƒ½å¤Ÿæ‰¿å—çš„ã€‚ä½ éœ€è¦åŸºäºè¿™ä¸ªè°ƒæ•´å‰¯æœ¬æ•°é‡ã€‚æˆ‘é‡‡ç”¨äº†ä¸€ä¸ªç®€å•çš„åšæ³•ï¼Œå³ç”¨1ä¸ªåˆ†ç‰‡å¤‡ä»½ã€‚è¿™æ„å‘³ç€æˆ‘ä¸€æ¬¡åªèƒ½ä»é›†ç¾¤ä¸­ä¸‹æ‰ä¸€ä¸ªèŠ‚ç‚¹ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘å‘ç°&lt;code&gt;number_of_replicas&lt;/code&gt; ç­‰äº (2/3 * èŠ‚ç‚¹æ•°) -1 æ˜¯ä¸€ä¸ªä¸é”™çš„æ•°å­—ï¼Œæ¯ä¸ªäººçš„æƒ…å†µå¯èƒ½ä¸åŒã€‚  &lt;/p&gt;
&lt;h3&gt;è‡ªåŠ¨æ‰©å……å‰¯æœ¬&lt;/h3&gt;
&lt;p&gt;æœ€å¥½ä¹Ÿç¦ç”¨ElasticSearch é»˜è®¤ä¼šåŸºäºé›†ç¾¤ä¸­æœ‰å¤šå°‘èŠ‚ç‚¹å°±æ‰©å……å¤šå°‘ä¸ªå‰¯æœ¬çš„è¡Œä¸ºã€‚æˆ‘ä»¬å‡å®šæ‰‹å·¥ç®¡ç†è¿™ä¸ªèƒ½æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å½“æˆ‘ä»¬éœ€è¦åœæ­¢æˆ–é‡å¯ä¸€ä¸ªé›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ—¶ã€‚è‡ªåŠ¨æ‰©å……æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„ç‰¹æ€§ï¼Œå¯¹äºé‡æœç´¢çš„ã€æœ‰ç€å°åˆ°ä¸­é‡çš„æ•°æ®çš„ç´¢å¼•æ¥è¯´ã€‚æ— éœ€é…ç½®ï¼Œæ·»åŠ ä¸€ä¸ªå‡ ç‚¹å°±èƒ½æé«˜æ€§èƒ½ã€‚ç„¶è€Œï¼Œå¦‚æœä½ çš„ç´¢å¼•æœ‰ç€å¤§é‡çš„æ•°æ®ï¼Œå¹¶å¯ç”¨äº†è¿™ä¸ªç‰¹æ€§ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹é‡å¯æ—¶ï¼Œå°†ä¼šå‘ç”Ÿä¸‹åˆ—äº‹æƒ…ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€åˆ‡æ­£å¸¸ã€‚å‰¯æœ¬(replica)æ•° = 1&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A å…³é—­&lt;/li&gt;
&lt;li&gt;é›†ç¾¤æ³¨æ„åˆ°èŠ‚ç‚¹ä¸‹çº¿ï¼ŒçŠ¶æ€å˜æˆé»„è‰²ï¼ˆè¯‘æ³¨ï¼šelasticsearch é›†ç¾¤å¥åº·çŠ¶æ€ç”¨ä¸‰ç§é¢œè‰²è¡¨ç¤ºï¼Œçº¢ã€é»„ã€ç»¿ï¼Œå…·ä½“å¯å‚è€ƒ&lt;a href="http://chrissimpson.co.uk/elasticsearch-yellow-cluster-status-explained.html"&gt;Elasticsearch "Yellow" cluster status explained&lt;/a&gt;ï¼‰  &lt;ul&gt;
&lt;li&gt;å‰¯æœ¬æ•° = 0, æœŸæœ›å€¼ä¸º1&lt;/li&gt;
&lt;li&gt;ç›®å‰èŠ‚ç‚¹æ•°ä¸º1&lt;/li&gt;
&lt;li&gt;ç›®å‰å‰¯æœ¬æ•°æœŸæœ› = 0&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å¥åº·çŠ¶æ€ä¸Šå‡ä¸ºç»¿è‰²ï¼Œä¸€åˆ‡å®Œç¾&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A é‡æ–°ä¸Šçº¿&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å‘é€æœŸæœ›çš„å‰¯æœ¬æ•°å’Œå®é™…çš„ç´¢å¼•ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A å®ƒçš„å‰¯æœ¬æ˜¯ä¸å¿…è¦çš„ï¼Œäºæ˜¯åˆ é™¤äº†æ•°æ®&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å¢åŠ äº†èŠ‚ç‚¹æ•°ï¼ŒæœŸæœ›çš„å‰¯æœ¬æ•° = 1ï¼Œå®é™… = 0&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A è¢«é€šçŸ¥å®ƒçš„å‰¯æœ¬æ•°ä¸æ»¡è¶³è¦æ±‚&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A é€šè¿‡ç½‘ç»œå¤åˆ¶æ‰€æœ‰å‰¯æœ¬åŠ åˆ°å®ƒçš„ç´¢å¼•ä¸­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œè¿™ä¸å¤ªç†æƒ³ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€ä¸ªéå¸¸ç¹å¿™çš„é›†ç¾¤é‡Œã€‚è¯·å°å¿ƒä½ çš„ç”Ÿäº§ç¯å¢ƒä¸­çš„æ“ä½œï¼Œå½“ä½ ä»é›†ç¾¤ä¸­æ·»åŠ /åˆ é™¤èŠ‚ç‚¹æ—¶è¯·æ³¨æ„ä½ çš„ç½‘ç»œè®¾å¤‡ç›‘æ§å›¾ã€‚å¦‚æœä½ çœ‹åˆ°å°–å³°ï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨è¿›è¡Œå¤„ç†ã€‚ä½ å¤±å»äº†ä¸€äº›é­”æ³•ï¼Œä¸è¿‡ä½ å¯èƒ½å‘ç°è¿™äº›æ˜¯é»‘é­”æ³•ã€‚ç¦ç”¨å‰¯æœ¬çš„è‡ªåŠ¨æ‰©å……ï¼Œä¼šå‡ºç°ä¸‹åˆ—æƒ…å†µï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€åˆ‡æ­£å¸¸&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A å…³é—­&lt;/li&gt;
&lt;li&gt;é›†ç¾¤æ³¨æ„åˆ°èŠ‚ç‚¹ä¸‹çº¿ï¼ŒçŠ¶æ€å˜æˆé»„è‰²&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å¥åº·çŠ¶æ€æœªæ¢å¤ï¼ŒæœŸæœ›çš„å‰¯æœ¬æ•° != å®é™…å‰¯æœ¬æ•°&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A é‡æ–°ä¸Šçº¿&lt;/li&gt;
&lt;li&gt;é›†ç¾¤å‘é€æœŸæœ›çš„å‰¯æœ¬æ•°å’Œå®é™…ä¸Šæ‰€æœ‰çš„ç´¢å¼•ä¸ªæ•°&lt;/li&gt;
&lt;li&gt;èŠ‚ç‚¹A é€šçŸ¥é›†ç¾¤å®ƒæœ‰åˆ†ç‰‡çš„æ‹·è´&lt;/li&gt;
&lt;li&gt;é›†ç¾¤æœŸæœ›å’Œå®é™…ä¸Šçš„å‰¯æœ¬æ•°ç›¸ç­‰ï¼Œå¥åº·çŠ¶æ€å˜ç»¿&lt;/li&gt;
&lt;li&gt;é›†ç¾¤æ ¡éªŒåˆ†ç‰‡ï¼Œå’Œå¤åˆ¶ä»»ä½•è¿‡æœŸçš„åˆ†ç‰‡ç»™èŠ‚ç‚¹A&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™æ‰æ˜¯å¤§å¤šæ•°äººæ°‘æœŸæœ›é›†ç¾¤é»˜è®¤è¯¥åšçš„ï¼Œä½†æ˜¯åˆ¤å®šé›†ç¾¤çŠ¶æ€ä¹‹é—´çš„é€»è¾‘å…³ç³»è®©è¿™å¾ˆéš¾å®ç°ã€‚å†è¯´ä¸€æ¬¡ï¼Œ&lt;code&gt;auto_expand_replicas&lt;/code&gt;çš„é­”æ³•åŠ¨ä½œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æœ‰ç”¨çš„ï¼Œä¸è¿‡ä¸é€‚ç”¨ä¸æˆ‘ä»¬çš„æƒ…å†µã€‚  &lt;/p&gt;
&lt;h2&gt;ç»´æŠ¤å’Œç›‘æ§&lt;/h2&gt;
&lt;p&gt;æˆ‘ä¸ºå·¥ä½œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„ElasticSearchå†™äº†&lt;a href="https://github.com/reyjrar/es-utils"&gt;ä¸€äº›è„šæœ¬&lt;/a&gt; ã€‚å®ƒåŒ…å«ä¼ é€æ ‡å‡†å€¼ç»™Graphite å’ŒCactiã€‚è¿™å„¿ä¹Ÿæœ‰ä¸€ä»½Nagios çš„ç›‘æ§æ£€æµ‹è„šæœ¬ï¼Œéå¸¸å®¹æ˜“é…ç½®ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™äº›å·¥å…·æ¥è·Ÿè¸ªæˆ‘ä»¬å¤šä¸ªé›†ç¾¤çš„æ€§èƒ½å’Œå¥åº·çŠ¶æ€ï¼ŒåŒ…æ‹¬æ—¥å¿—è®°å½•é›†ç¾¤ã€‚è¿‡å‡ å¤©ï¼Œæˆ‘ä¼šæ›´æ–°ä¸€ä¸‹ï¼Œå°†åŒ…å«æˆ‘ä»¬logstash ç´¢å¼•ç»´æŠ¤çš„è„šæœ¬ã€‚  &lt;/p&gt;
&lt;p&gt;å½“ä½ å°†æ•°æ®å†™å…¥æ—¥å¿—é›†ç¾¤æ—¶ï¼ŒElasticSearch åŒæ—¶åœ¨åå°åˆ›å»ºLucence ç´¢å¼•ã€‚æ”¶åˆ°çš„æ–‡æ¡£æœ‰ä¸€ä¸ªç¼“å†²åŒºï¼ŒåŸºäºä½ çš„è®¾ç½®ï¼Œæ•°æ®ä¼šè¢«åˆ·æ–°åˆ°ä¸€ä¸ªLucene ç´¢å¼•ã€‚Lucene ç´¢å¼•æ–°å»º/æ›´æ–° çš„æˆæœ¬éå¸¸é«˜ï¼Œä½†æ˜¯æœç´¢éå¸¸&lt;em&gt;å¿«&lt;/em&gt;ã€‚è¿™æ„å‘³è¿™å•ä¸ªåˆ†ç‰‡å¯èƒ½åŒ…å«ä¸Šç™¾ä¸ªLucence ç´¢å¼•ï¼Œå¸¸å¸¸è¢«ç§°ä¸ºæ®µã€‚è¿™äº›æ®µå¯ä»¥è¢«å¾ˆå¿«é€Ÿçš„æœç´¢ï¼Œä½†æ˜¯æ¯ä¸ªæ®µåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚è¿™å¯èƒ½å¯¹æ€§èƒ½æœ‰è´Ÿé¢å½±å“ã€‚æˆ‘ä»¬å·²ç»è§‚å¯Ÿåˆ°20å¤šä¸ªæ®µçš„ç´¢å¼•ï¼Œæœ‰10%çš„æ€§èƒ½ä¸‹é™ã€‚  &lt;/p&gt;
&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼ŒElasticSearch æä¾›äº†&lt;a href="http://www.elasticsearch.org/guide/reference/api/admin-indices-optimize.html"&gt;ä¸€ä¸ªAPI ä¼˜åŒ–Luceneæ®µ&lt;/a&gt;ã€‚ä½ ä¸åº”è¯¥ä¼˜åŒ–ä¸€ä¸ªæ­£åœ¨ç´¢å¼•æ•°æ®çš„ç´¢å¼•ã€‚åœ¨è¿™äº›åˆ†ç‰‡ä¸Šï¼Œæ–°æ•°æ®å°†ä¼šç”Ÿæˆæ›´å¤šçš„æ®µã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“å·²ç»å†™å®Œä¸€ä¸ªç´¢å¼•äº†å‘¢ï¼Ÿå¦‚æœä½ è¿˜è®°å¾—ï¼Œæˆ‘å»ºè®®æŒ‰å¤©å»ºç«‹ç´¢å¼•ã€‚è¿™æ„å‘³ç€ï¼Œä½ å¯ä»¥è¿è¡Œä¸€ä¸ªæ¯å¤©çš„cron ä»»åŠ¡ï¼ˆæˆ–æ¯å°æ—¶ï¼‰æ¥æ£€æŸ¥æ˜¨å¤©æˆ–è€…æ›´ä¹…ä¹‹å‰çš„ç´¢å¼•ï¼Œç¡®ä¿ä»–ä»¬å·²ç»è¢«ä¼˜åŒ–ï¼ˆæˆ–&lt;code&gt;max_num_segments = 1&lt;/code&gt;ï¼‰ã€‚å¦‚æœä½ å·²ç»ä¸ºåˆ›å»ºç´¢å¼•çš„åå­—é€‰æ‹©äº†ä¸€äº›å…¶ä»–æ¨¡å¼ï¼Œé‚£ä¹ˆä½ åˆšåˆšç»™è‡ªå·±å¢åŠ åŠ äº†å¾ˆå¤šå·¥ä½œã€‚&lt;/p&gt;
&lt;h2&gt;æœªæ¥çš„æ¢ç´¢&lt;/h2&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ¯”æˆ‘æƒ³è±¡çš„é•¿å¾ˆå¤šã€‚æˆ‘åªæ˜¯å¯¹è®¾è®¡å’Œå®è·µç”¨äºæ—¥å¿—è®°å½•çš„ElasticSearch é›†ç¾¤åšäº†è¡¨é¢çš„ç ”ç©¶ã€‚æˆ‘çš„é›†ç¾¤å¾ˆå¿«ä¼šä»å¼€å‘ç¯å¢ƒè¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆå°½ç®¡å®ƒæ­£åœ¨æä¾›ç”Ÿäº§ç¯å¢ƒçš„åŠŸèƒ½ï¼‰ã€‚å½“æˆ‘è¿™æ ·åšçš„æ—¶å€™ï¼Œæˆ‘å°†é¢å¯¹æ›´å¤šçš„æŒ‘æˆ˜ï¼Œæˆ‘æœ‰ä¸€ä¸ªç¬”è®°æœ¬å†™æ»¡äº†å…³äºå¦‚ä½•æ„å»ºç´¢å¼•çš„æ–¹æ³•ï¼Œå…³äºé›†ç¾¤å¦‚ä½•å¤„ç†è´Ÿè½½ï¼Œå’Œå…¶ä»–å½“ä½ çªç„¶æä¾›ç®€å•ã€å¿«é€Ÿçš„è®¿é—®å¤§é‡çš„æ•°æ®æ—¶å€™å‡ºç°çš„ä¸€äº›éšç§ç›¸å…³çš„é—®é¢˜ã€‚&lt;/p&gt;</content><category term="2016"></category><category term="elasticsearch"></category><category term="graylog"></category><category term="logstash"></category></entry><entry><title>è®°ä¸€ä¸ªé€€å‡ºç»ˆç«¯è¿›ç¨‹ä¸é€€å‡ºçš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2016/2016-05-23.html" rel="alternate"></link><published>2016-05-23T15:25:30+08:00</published><updated>2016-05-23T15:25:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-05-23:/posts/2016/2016-05-23.html</id><summary type="html">&lt;p&gt;æŸä¸€å¤©å¼€å‘åŒå­¦é—®äº†ä¸€ä¸ªé—®é¢˜ï¼Œä»–ä»¬åœ¨çº¿ä¸Šè·‘ä¸€ä¸ªjobï¼Œæ²¡ç”¨screenï¼Œnohupï¼ŒæŠŠiTerm çª—å£å…³äº†ï¼Œjob æ²¡æŒ‚ã€‚å†ç™»å½•è¿›å»çœ‹ï¼ŒPPID å˜æˆ1ï¼Œå³è¿›ç¨‹è¢«init â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æŸä¸€å¤©å¼€å‘åŒå­¦é—®äº†ä¸€ä¸ªé—®é¢˜ï¼Œä»–ä»¬åœ¨çº¿ä¸Šè·‘ä¸€ä¸ªjobï¼Œæ²¡ç”¨screenï¼Œnohupï¼ŒæŠŠiTerm çª—å£å…³äº†ï¼Œjob æ²¡æŒ‚ã€‚å†ç™»å½•è¿›å»çœ‹ï¼ŒPPID å˜æˆ1ï¼Œå³è¿›ç¨‹è¢«init è¿›ç¨‹æ¥ç®¡ã€‚&lt;br&gt;
åœ¨å¯¹åº”æœºå™¨ä¸Šæ‰§è¡Œ&lt;code&gt;shopt&lt;/code&gt;, å‘ç°ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...
gnu_errfmt      off
histappend      off
histreedit      off
histverify      off
hostcomplete    on
huponexit       off
interactive_comments    on
lastpipe        off
lithist         off
login_shell     on
mailwarn        off
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ³¨æ„CentOS 7 é»˜è®¤å°†&lt;code&gt;huponexit&lt;/code&gt; è®¾ä¸º&lt;code&gt;off&lt;/code&gt; äº†ï¼Œè¿™æ ·åœ¨ç”¨æˆ·å°†Shell é€€å‡ºç»“æŸä¼šè¯æ—¶ï¼Œç³»ç»Ÿä¸ä¼šå‘é€ SIGHUP ç»™æ‰€æœ‰è¿›ç¨‹ï¼Œè¿™æ•ˆæœå…¶å®ç±»ä¼¼ä½¿ç”¨äº†nohupï¼Œnohup çš„ä½œç”¨å°±æ˜¯å¿½ç•¥HUP ä¿¡å·ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;huponexit
  If set, bash will send SIGHUP to all jobs when an interactive login shell exits.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2016"></category><category term="shell"></category><category term="linux"></category></entry><entry><title>è±†ç“£FM çº¢å¿ƒæ­Œæ›²å¯¼å…¥ç½‘æ˜“äº‘éŸ³ä¹</title><link href="https://fangpsh.github.io/posts/2016/2016-05-16.html" rel="alternate"></link><published>2016-05-16T12:08:30+08:00</published><updated>2016-05-16T12:08:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-05-16:/posts/2016/2016-05-16.html</id><summary type="html">&lt;p&gt;&lt;img alt="NeteaseMusic" src="/assets/images/2023/20230306155230.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»è±†ç“£FM è½¬ç”¨ç½‘æ˜“äº‘éŸ³ä¹çš„å‡ ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‰ˆæƒå¤§æˆ˜ï¼Œè±†ç“£FM é‡Œé¢çš„æ­Œæ›²å¤§éƒ¨åˆ†éƒ½æ’­æ”¾ä¸äº†äº†ï¼›&lt;/li&gt;
&lt;li&gt;è±†ç“£FM éŸ³è´¨å¤ªçƒ‚ï¼Œç›¸æ¯”QQï¼Œç½‘æ˜“ï¼Œè™¾ â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="NeteaseMusic" src="/assets/images/2023/20230306155230.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»è±†ç“£FM è½¬ç”¨ç½‘æ˜“äº‘éŸ³ä¹çš„å‡ ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç‰ˆæƒå¤§æˆ˜ï¼Œè±†ç“£FM é‡Œé¢çš„æ­Œæ›²å¤§éƒ¨åˆ†éƒ½æ’­æ”¾ä¸äº†äº†ï¼›&lt;/li&gt;
&lt;li&gt;è±†ç“£FM éŸ³è´¨å¤ªçƒ‚ï¼Œç›¸æ¯”QQï¼Œç½‘æ˜“ï¼Œè™¾ç±³ä¹‹ç±»ï¼›&lt;/li&gt;
&lt;li&gt;è±†ç“£FM åœ¨OS X ä¸‹æ— å®˜æ–¹å®¢æˆ·ç«¯ï¼Œç½‘é¡µç‰ˆåˆä¾èµ–Flashï¼Œå¤šå¹´åçš„æ–°ç‰ˆæ‰å¼ƒç”¨äº†ï¼›&lt;/li&gt;
&lt;li&gt;è±†ç“£FM iOS App å¸¸å¸¸éœ€è¦é‡å¤ç™»å½•ï¼Œæœ‰æ—¶æ˜¯åœ¨å‡çº§ä¹‹åï¼Œç®€ç›´ä¸èƒ½å¿ï¼›&lt;/li&gt;
&lt;li&gt;è±†ç“£FM åœ¨åŒ—äº¬ç§»åŠ¨çš„å®½å¸¦ç¯å¢ƒä¸‹å¸¸å¸¸æ’­æ”¾å¡é¡¿ï¼Œç»™è±†ç“£å®˜æ–¹help é‚®ç®±å‘é‚®ä»¶åé¦ˆï¼Œè·‘è¿‡ä»–ä»¬çš„æµ‹è¯•è„šæœ¬ï¼Œä¸äº†äº†ä¹‹ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç½‘æ˜“äº‘éŸ³ä¹çš„iOS App å’ŒOS X App éƒ½åšçš„ä¸é”™ï¼Œä¸è¿‡ç§äººFM çš„æ­Œæ›²æ¨èç›¸æ¯”è±†ç“£FM è¿˜æ˜¯å·®ä¸€å¤§èŠ‚ï¼Œæ€€ç–‘æ˜¯çº¢å¿ƒæ­Œæ›²å’Œåƒåœ¾æ­Œæ›²æ ‡æ³¨çš„ä¸å¤Ÿï¼Œæ‰€ä»¥äº§ç”Ÿå°†è±†ç“£FM çº¢å¿ƒæ­Œæ›²å¯¼å…¥ç½‘æ˜“äº‘éŸ³ä¹çš„æƒ³æ³•ã€‚&lt;br&gt;
è®°å¾—ç½‘æ˜“äº‘éŸ³ä¹ä¸€å¼€å§‹æ¨å‡ºçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä»è±†ç“£FM å’Œè™¾ç±³éŸ³ä¹å¯¼å…¥æ­Œå•ï¼Œç›®å‰å·²ç»ä¸å¯ç”¨ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±åŠ¨æ‰‹äº†ã€‚  &lt;/p&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥ï¼Œæ‹‰å–è±†ç“£FM çº¢å¿ƒæ­Œæ›²åˆ—è¡¨ï¼Œæ–°ç‰ˆçš„æ¥å£å¥½åƒå˜äº†ï¼Œç›´æ¥ç”¨æ—§ç‰ˆçš„æ¥å£ï¼Œç™»å½•è±†ç“£FM ç½‘é¡µç‰ˆæœ¬ï¼Œ&lt;br&gt;
æ‰“å¼€&lt;code&gt;https://douban.fm/mine/#!type=liked&lt;/code&gt;, Inspect çœ‹ä¸€ä¸‹ç½‘ç»œè¯·æ±‚æ¥å£ï¼Œæ‰¾å‡ºç±»ä¼¼ï¼š&lt;br&gt;
&lt;code&gt;http://douban.fm/j/play_record?ck=&amp;amp;spbid=&amp;amp;type=liked&amp;amp;start=&lt;/code&gt;&lt;br&gt;
çš„è¯·æ±‚ï¼ŒCopy As cURLï¼Œå¾—åˆ°Cookie ä¹‹ç±»çš„ï¼Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/usr/bin/env bash
#Convert DoubanFM liked songs into KWL list.
#require:
#  jq: https://stedolan.github.io/jq/

COUNT=#liked songs number#

for i in `seq 0 15 ${COUNT}`;do
    songs=`curl -s &amp;#39;http://douban.fm/j/play_record?ck=&amp;amp;spbid=&amp;amp;type=liked&amp;amp;start=&amp;#39;$i\
           -H &amp;#39;Host: douban.fm&amp;#39; -H &amp;#39;User-Agent: &amp;#39;\
           -H &amp;#39;Accept: text/plain, */*; q=0.01&amp;#39;\
           -H &amp;#39;Accept-Language: en-US,en;q=0.5&amp;#39;\
           -H &amp;#39;DNT: 1&amp;#39; \
           -H &amp;#39;X-Requested-With: XMLHttpRequest&amp;#39;\
           -H &amp;#39;Referer: http://douban.fm/mine/&amp;#39;\
           -H &amp;#39;Cookie: &amp;#39;\
           -H &amp;#39;Connection: keep-alive&amp;#39;\
           |jq &amp;#39;.songs&amp;#39;`
    for s in `seq 0 14`;do
        song=`echo $songs | jq .[$s]`
        title=`echo $song | jq .title`
        artist=`echo $song | jq .artist`
        echo $title $artist
        echo &amp;quot;&amp;lt;so name=&amp;quot;$title &amp;quot;artist=&amp;quot;$artist&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;&amp;quot; &amp;gt;&amp;gt; Douban_FM.kwl
    done
    sleep 10
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”±äºæ­Œæ›²æ€»æ•°ä¸ä¸€å®šæ˜¯15 çš„å€æ•°ï¼Œæ‰€ä»¥æœ€åå¯èƒ½ä¼šå‡ é¡¹æ˜¯NULL ï¼Œæ‰‹åŠ¨åˆ é™¤ä¸€ä¸‹å°±å¥½äº†ã€‚&lt;br&gt;
ç”Ÿæˆçš„DoubanFM.kwl æ˜¯é…·æˆ‘çš„æ­Œæ›²åˆ—è¡¨ï¼Œä¸Šä¼ åœ°å€ï¼š&lt;a href="http://music.163.com/#/import/kuwo"&gt;http://music.163.com/#/import/kuwo&lt;/a&gt;ï¼Œå¯¼å…¥å³å¯ã€‚&lt;br&gt;
.kwl å†…å®¹ç‰‡æ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;so&amp;gt;
&amp;lt;so name=&amp;quot;ã¨ã‚“ã¡ã‚“ã‹ã‚“ã¡ã‚“ä¸€ä¼‘ã•ã‚“&amp;quot; artist=&amp;quot;ç›¸å†…æµ / ãƒ¤ãƒ³ã‚°ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;å²›äººã¬å®&amp;quot; artist=&amp;quot;BEGIN&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;ç¾ä¸½çš„æ¢­ç½—æ²³&amp;quot; artist=&amp;quot;é»„ç§‹ç”Ÿ&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;é›¨&amp;quot; artist=&amp;quot;å°æœ&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Paradise&amp;quot; artist=&amp;quot;Coldplay&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Broken&amp;quot; artist=&amp;quot;Jake Bugg&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;A Step You Can&amp;#39;t Take Back&amp;quot; artist=&amp;quot;Keira Knightley&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Tokyo&amp;quot; artist=&amp;quot;California Wives&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;ç—´äºº&amp;quot; artist=&amp;quot;ç—´äºº / ç—´äºº&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;I Cried For You&amp;quot; artist=&amp;quot;Katie Melua&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Counting Stars&amp;quot; artist=&amp;quot;OneRepublic&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
....
&amp;lt;so name=&amp;quot;I Have Nothing&amp;quot; artist=&amp;quot;Whitney Houston&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Sometimes When We Touch&amp;quot; artist=&amp;quot;Rod Stewart&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;From The Bottom Of My Broken Heart&amp;quot; artist=&amp;quot;Britney Spears&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Because I Love You&amp;quot; artist=&amp;quot;Shakin Stevens&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;Rhythm Of The Rain&amp;quot; artist=&amp;quot;Jason Donovan / The Cascades&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;so name=&amp;quot;ç»‡æ¢¦è¡Œäº‘&amp;quot; artist=&amp;quot;éª†é›†ç›Š&amp;quot;&amp;gt;&amp;lt;/so&amp;gt;
&amp;lt;/so&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¯¼å…¥ç½‘æ˜“äº‘éŸ³ä¹ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªå’Œkwlæ–‡ä»¶åŒåçš„æ­Œå•ï¼Œå†åœ¨App å†…æ“ä½œå¯¼å…¥åˆ°&lt;code&gt;æˆ‘å–œæ¬¢çš„éŸ³ä¹&lt;/code&gt; ï¼Œæ‰¹é‡åŠ çº¢å¿ƒå³å¯ã€‚ç›®å‰çœ‹æ¥å¯¼å…¥ä¹‹åï¼Œéš”å‡ å¤©ï¼Œç½‘æ˜“ç§äººFM çš„æ¨èç¨å¾®å¥½äº†ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–è¿™æ¬¡å¯¼å…¥æ“ä½œï¼Œè±†ç“£FM æ­Œæ›²ä¸‹æ¶çš„æƒ…å†µå¯ä»¥è®©äººéå¸¸åƒæƒŠï¼š&lt;br&gt;
&lt;strong&gt;æˆ‘çš„è±†ç“£FMçº¢å¿ƒæ­Œæ›²æ€»è®¡1741 é¦–ï¼Œèƒ½æ’­æ”¾çš„åªæœ‰421 é¦–ï¼Œå°†å…¶å¯¼å…¥ç½‘æ˜“äº‘éŸ³ä¹èƒ½æ’­æ”¾çš„æœ‰1271é¦–&lt;/strong&gt;ã€‚&lt;/p&gt;</content><category term="2016"></category><category term="douban"></category><category term="bash"></category></entry><entry><title>Bind DLZ With MySQL</title><link href="https://fangpsh.github.io/posts/2016/2016-05-11.html" rel="alternate"></link><published>2016-05-11T10:49:30+08:00</published><updated>2016-05-11T10:49:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-05-11:/posts/2016/2016-05-11.html</id><summary type="html">&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¦åšå¥½è¿ç»´è‡ªåŠ¨åŒ–ï¼Œå†…ç½‘åŸŸåçš„è‡ªåŠ¨åŒ–ç®¡ç†ä¸å¯å°‘ï¼Œå¾—æä¾›ä¸°å¯Œçš„API ä¾›å…¶ä»–å†…éƒ¨ç³»ç»Ÿè°ƒç”¨ã€‚&lt;br&gt;
ä¹‹å‰åœ¨ç½‘æ˜“æ­ç ”å®ä¹ ï¼Œè§è¿‡ â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;è¦åšå¥½è¿ç»´è‡ªåŠ¨åŒ–ï¼Œå†…ç½‘åŸŸåçš„è‡ªåŠ¨åŒ–ç®¡ç†ä¸å¯å°‘ï¼Œå¾—æä¾›ä¸°å¯Œçš„API ä¾›å…¶ä»–å†…éƒ¨ç³»ç»Ÿè°ƒç”¨ã€‚&lt;br&gt;
ä¹‹å‰åœ¨ç½‘æ˜“æ­ç ”å®ä¹ ï¼Œè§è¿‡ä»–ä»¬ç®¡ç†å†…éƒ¨çš„åŸŸåï¼Œè¿˜æ˜¯æ‰‹å·¥ç¼–è¾‘bind çš„zone æ–‡ä»¶ï¼Œè‹¦ä¸å ªè¨€ï¼Œæ”¹ä¸€ä¸ªå¾—åå¤æ£€æŸ¥å’Œæ‰¾äººReviewï¼Œå› ä¸ºzone å¦‚æœå‡ºç°ä¸€ä¸é”™è¯¯ï¼Œä¼šå¯¼è‡´å¤§é‡åŸŸåè§£æå‡ºé”™ã€‚ä¸€ä¸ªæ–¹å¼æ˜¯ç”¨DNSPodï¼ŒCloudXNSç­‰ï¼Œè¿™äº›æœåŠ¡å•†ä¸€èˆ¬éƒ½æœ‰å®Œå–„çš„API æ”¯æŒï¼Œä½†æ˜¯è¿™æ ·å†…ç½‘åŸŸåå°±æš´éœ²åœ¨å…¬ç½‘ï¼Œå¯è¢«äººæš´åŠ›éå†ï¼Œä¸ºæ¸—é€ä¹‹ç±»çš„æä¾›ä¿¡æ¯ï¼Œæ‰€ä»¥å†…ç½‘è‡ªå·±æ­å»ºä¸€ä¸ªæƒå¨DNS æœåŠ¡å™¨æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚  &lt;/p&gt;
&lt;p&gt;Name server çš„é€‰æ‹©ä¸Šï¼Œæœ‰å¾ˆå¤šé€‰æ‹©ï¼Œå¦‚&lt;a href="https://www.isc.org/downloads/bind/"&gt;Bind&lt;/a&gt;, &lt;a href="https://www.powerdns.com"&gt;PowerDNS&lt;/a&gt;, &lt;a href="http://www.nlnetlabs.nl/projects/nsd/"&gt;NSD&lt;/a&gt; ç­‰ã€‚PowerDNS å¯¹MySQL æœ‰åŸç”Ÿæ”¯æŒï¼Œ
æ€§èƒ½ä¸Šç›¸å¯¹&lt;a href="http://bind-dlz.sourceforge.net"&gt;Bind DLZ&lt;/a&gt; MySQL ä¼šå¼ºå¾ˆå¤šï¼Œå¹¶ä¸”æœ‰éå¸¸å¤šå¼€æºçš„&lt;a href="https://github.com/PowerDNS/pdns/wiki/WebFrontends"&gt;WebFrontend&lt;/a&gt; æ”¯æŒã€‚ä¸è¿‡æˆ‘æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº†Bind DLZï¼Œæ€§èƒ½çš„é—®é¢˜å¯ä»¥é€šè¿‡åæ–‡æåˆ°çš„æ¶æ„è§£å†³æ‰ï¼Œå¹¶ä¸”è¿˜å¯ä»¥çœå»å¯¹
MySQL ä¹‹ç±»çš„ä¼˜åŒ–å·¥ä½œï¼Œå¦å¤–è‡ªå·±å†™ä¸€ä¸ªå¯¹æ•°æ®åº“çš„CRUD æ“ä½œçš„Web ç•Œé¢å¹¶ä¸å›°éš¾ï¼Œå·¥ä½œé‡ä¹Ÿå¹¶ä¸å¤§ã€‚  &lt;/p&gt;
&lt;h2&gt;æ€§èƒ½ä¸æ¶æ„&lt;/h2&gt;
&lt;p&gt;Bind DLZ å®˜æ–¹æä¾›äº†ä¸€ä»½&lt;a href="http://bind-dlz.sourceforge.net/perf_tests.html"&gt;Performance Tests&lt;/a&gt;ï¼Œè™½ç„¶æ˜¯æ¯”è¾ƒè€çš„æµ‹è¯•äº†ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸å°‘å‚è€ƒä»·å€¼ã€‚&lt;br&gt;
&lt;img alt="bind-dlz-perf-tests" src="/assets/images/2023/20230301163634.png"&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘è‡ªå·±ä½¿ç”¨queryperf å‹æµ‹ï¼Œç»“æœä¸ä¸Šå›¾ä¸­ç±»ä¼¼ï¼ŒåŸºæœ¬æ¥è¯´Bind DLZ MySQL ç›¸æ¯”Bind åŸç”Ÿçš„æ–¹å¼ï¼ŒQPS å·®20å€å·¦å³ï¼Œå› ä¸ºMySQL åªèƒ½è·‘åœ¨å•çº¿ç¨‹ä¸‹ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œå»ºè®®é‡‡ç”¨Bind DLZ ä½œä¸ºMasterï¼ŒBind ä½œä¸ºSlaveçš„æ–¹å¼ã€‚å¤šä¸ªSlave ç»“åˆLVS åšé«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ï¼Œ
Masterå¯ä»¥å¦å¤–é’ˆå¯¹Bind DLZ å’ŒMySQL åšé«˜å¯ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡ï¼Œå¯ä»¥å‘æŒ¥Bind åŸç”Ÿçš„é«˜æ€§èƒ½ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨Bind DLZ çš„çµæ´»æ€§ã€‚&lt;br&gt;
&lt;strong&gt;ä½†æ˜¯è¿™æ ·ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨Master ä¸Šä¿®æ”¹å®Œè®°å½•ä¹‹åï¼Œå¯èƒ½ä¸ä¼šç«‹å³åŒæ­¥åˆ°Slaveï¼Œä¼šå¸¦æ¥ä¸ä¸€è‡´çš„é—®é¢˜ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘é€Notify æ¥è§£å†³æ‰ã€‚&lt;/strong&gt;&lt;br&gt;
&lt;img alt="bind-dlz" src="/assets/images/2023/20230301163644.png"&gt;  &lt;/p&gt;
&lt;p&gt;å¦å¤–å¯å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://bind-dlz.sourceforge.net/best_practices.html"&gt;Best Practices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://bind-dlz.sourceforge.net/worst_practices.html"&gt;Worst Practices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DNS æŸ¥è¯¢èµ°UDP åè®®ï¼Œå‰ç«¯è½¬å‘è¿™å—ä¸€èˆ¬ç”¨LVS + Keepalived ä¹‹ç±»çš„åšé«˜å¯ç”¨ï¼Œå½“ç„¶ç”¨æœ€è¿‘å‡ºçš„&lt;a href="http://nginx.org/en/docs/stream/ngx_stream_core_module.html"&gt;Nginx UDP Stream&lt;/a&gt; ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡æ€§èƒ½ä¸Šå·®å¾ˆå¤šã€‚&lt;br&gt;
åŒæ—¶ä¹Ÿéœ€è¦ä¼˜åŒ–ä¸€ä¸‹æœåŠ¡å™¨ç½‘ç»œUDP ç›¸å…³çš„å‚æ•°ã€‚  &lt;/p&gt;
&lt;!-- more --&gt;

&lt;h3&gt;pnotify.pl&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href="https://github.com/jodrell/pnotify"&gt;pnotify&lt;/a&gt; - A simple, portable Perl script for sending DNS NOTIFY packets with TSIG support.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä½¿ç”¨&lt;a href="https://github.com/jodrell/pnotify"&gt;è¿™ä¸ªè„šæœ¬&lt;/a&gt;ï¼Œåœ¨æ¯æ¬¡å¯¹åŸŸåè®°å½•åšæ›´æ”¹ä¹‹åéƒ½å¯¹å‡ å°Slaveå‘é€ä¸€ä¸‹notify è¯·æ±‚ã€‚&lt;/p&gt;
&lt;h3&gt;/etc/resolv.conf&lt;/h3&gt;
&lt;p&gt;æŠŠå†…ç½‘NS åŠ å…¥åˆ°&lt;code&gt;/etc/resolv.conf&lt;/code&gt; ä¹‹å‰éœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…ï¼Œä¸€èˆ¬æ¥è¯´resolv.conf ä¼šæœ‰å¤šä¸ªnameserverï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šä»ä¸Šåˆ°ä¸‹å‘é€åŸŸåè§£æè¯·æ±‚ï¼Œå½“ç„¶å¯ä»¥é…ç½®æˆè½®è¯¢ï¼ˆoptions:rotate)ã€‚å»ºè®®æ˜¯å¤šä¸ªns slave ä¸ºä¸€ç»„ï¼Œä¸€ç»„æœ‰ä¸€ä¸ªlvs åšé«˜å¯ç”¨ï¼Œå°†å¤šä¸ªlvsçš„vip åˆ†æˆå¤šè¡Œå†™åˆ°resolv.conf ä¸­ï¼Œç„¶åé…ç½®options: rotateï¼Œå¼€å¯è½®è¯¢ã€‚&lt;br&gt;
å¦å¤–éœ€è¦è®¾ç½®ä¸€ä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯5sã€‚å¦‚æœæŸä¸ªæœåŠ¡å¤„ç†è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å¤§é‡çš„åŸŸåæŸ¥è¯¢ï¼Œå¦‚æœresolv.conf ä¸­æŸä¸€ä¸ªnameserver å¼‚å¸¸ï¼Œé»˜è®¤çš„30s è¶…æ—¶å°†ä¼šå¯¼è‡´è¯·æ±‚å¤§é‡å †ç§¯ã€‚å»ºè®®æ”¹å°timeout çš„å€¼ï¼Œç‰¹åˆ«NS åœ¨åŒä¸€ä¸ªå†…ç½‘çš„æƒ…å†µä¸‹ã€‚&lt;br&gt;
æ›´å¤šé…ç½®ç»†èŠ‚è¯·å‚è€ƒï¼š&lt;a href="http://man7.org/linux/man-pages/man5/resolv.conf.5.html"&gt;resolv.conf - resolver configuration file&lt;/a&gt;  &lt;/p&gt;
&lt;h2&gt;å®‰è£…é…ç½®&lt;/h2&gt;
&lt;p&gt;Bind çš„ç‰ˆæœ¬é€‰æ‹©ä¸Šï¼Œå»ºè®®ä½¿ç”¨å®˜æ–¹æ¨èçš„stable ç‰ˆæœ¬ã€‚DLZ éœ€è¦è‡ªè¡Œç¼–è¯‘å®‰è£…ï¼Œå®˜æ–¹çš„Bind æºç åŒ…é‡Œå·²å¸¦DLZ çš„ç›¸å…³ä»£ç ï¼Œç¼–è¯‘æ—¶å¼€å¯å¯¹åº”é€‰é¡¹å³å¯ã€‚MySQL çš„è¡¨è®¾è®¡ç›´æ¥å‚è€ƒ&lt;a href="http://bind-dlz.sourceforge.net/mysql_driver.html"&gt;å®˜ç½‘å†…å®¹&lt;/a&gt;ï¼Œå’Œ&lt;a href="http://bind-dlz.sourceforge.net/mysql_example.html"&gt;MySQL_Example&lt;/a&gt;ã€‚&lt;br&gt;
å»ºè®®è®¾ç½®ä¸€ä¸‹MySQL çš„triggerï¼Œè‡ªåŠ¨æ›´æ–°SOA è®°å½•çš„serial å­—æ®µçš„å€¼ã€‚  &lt;/p&gt;
&lt;p&gt;ä½œä¸ºSlave çš„Bind å¼ºçƒˆå»ºè®®ä½¿ç”¨åŒ…ç®¡ç†ç³»ç»Ÿç›´æ¥å®‰è£…ã€‚å¦‚æœå‡ºç°å®‰å…¨é—®é¢˜ï¼ŒSlave æ˜¯ç›´æ¥å¯¹å¤–æä¾›æœåŠ¡çš„ï¼Œéœ€è¦å¿«é€Ÿä¿®å¤ï¼Œç›´æ¥ aptitude|yum æ›´æ–°ä¼šæ–¹ä¾¿å’Œå¿«é€Ÿå¾ˆå¤šï¼ˆç›¸ä¿¡ä¸Šæ¸¸ä»“åº“æ‰“åŒ…è€…çš„é€Ÿåº¦ï¼‰ã€‚  &lt;/p&gt;
&lt;p&gt;å¦å¤–åœ¨æŠ•å…¥ä½¿ç”¨ä¹‹å‰ï¼Œæ­å»ºè€…åº”è¯¥å·²ç»é˜…è¯»è¿‡å®˜æ–¹çš„æ‰‹å†Œï¼Œ&lt;a href="https://kb.isc.org/article/AA-01031"&gt;BIND 9 Documentation&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;å®‰è£…é…ç½®å¥½ä¹‹åï¼Œå¦‚æœNS è¦å¼€æ”¾åœ¨å…¬ç½‘è®¿é—®ï¼Œæ¨èä½¿ç”¨&lt;a href="http://www.intodns.com"&gt;intoDNS&lt;/a&gt; è¿›è¡Œæ£€æµ‹ï¼Œå¯ä»¥å‘ç°ä¸€äº›ç»†èŠ‚é—®é¢˜ã€‚å¦å¤–è¿˜å¯ä»¥ä½¿ç”¨&lt;a href="https://dnsspy.io"&gt;DNS Spy&lt;/a&gt; å¯¹å®‰å…¨æ€§åšä¸€ç•ªæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;å¼€å‘çš„Web å‰ç«¯åœ¨æ•°æ®è¾“å…¥ä¸Šå¿…é¡»åšå¥½æ ¡éªŒï¼Œç©ºæ ¼å’Œå¼‚å¸¸å­—ç¬¦ç­‰è¦æ£€æµ‹å’Œå¤„ç†æ‰ï¼ŒåŸŸåéœ€è¦ç¬¦åˆè§„èŒƒï¼ˆåªèƒ½åŒ…å«æ•°å­—ï¼Œå­—æ¯ï¼Œè¿æ¥ç¬¦ï¼Œç‚¹å·ç­‰ï¼Œç»†èŠ‚å¯ä»¥Googleä¸‹ï¼‰ï¼Œä¸ç„¶æŸæ¡è®°å½•å‡ºé”™ï¼Œä¾ç„¶å¯èƒ½å¯¼è‡´å¤§é‡åŸŸåæ— æ³•è§£æã€‚&lt;/p&gt;
&lt;h3&gt;å®‰å…¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;å…³æ³¨å®˜æ–¹çš„&lt;a href="https://kb.isc.org/category/74"&gt; Security Advisories&lt;/a&gt;ï¼ŒRSSè®¢é˜…ï¼›&lt;/li&gt;
&lt;li&gt;éšè—ç‰ˆæœ¬ï¼šoptions ä¸­è‡ªå®šä¹‰ versionï¼›&lt;/li&gt;
&lt;li&gt;chrootï¼Œå¦å¤–ä½¿ç”¨éroot è´¦æˆ·è·‘bind æœåŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;é™åˆ¶è¯·æ±‚ï¼Œåˆ©ç”¨ACL é™åˆ¶æŸ¥è¯¢æ¥æºï¼Œå¦‚æœå¼€æ”¾åœ¨å…¬ç½‘æœ€å¥½å…³é—­é€’å½’æŸ¥è¯¢ï¼Œé˜²æ­¢è¢«ç”¨äºDNS æ”¾å¤§æ”»å‡»ï¼›&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¥½åŸŸä¼ é€ï¼Œé…ç½®allow-transferï¼›&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¥½allow-notifyï¼›&lt;/li&gt;
&lt;li&gt;æ§åˆ¶å¥½allow-updateï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨DNSSECï¼›&lt;/li&gt;
&lt;li&gt;ç­‰ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;å¤‡ä»½&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;MySQL å¤‡ä»½ï¼›&lt;/li&gt;
&lt;li&gt;Slave çš„zone æ–‡ä»¶å¤‡ä»½ï¼Œæ–¹ä¾¿å¿«é€Ÿæ¢å¤ï¼›&lt;/li&gt;
&lt;li&gt;å…¨éƒ¨åŸŸåè®°å½•å¯ä»¥é€‰æ‹©å®šæœŸå¤‡ä»½åˆ°DNSPod æˆ–è€…CloudXN ä¹‹ç±»çš„ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ç›‘æ§&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Bind è¿›ç¨‹ç›‘æ§ï¼›&lt;/li&gt;
&lt;li&gt;Bind ç«¯å£ç›‘æ§ï¼›&lt;/li&gt;
&lt;li&gt;Bind è§£æåŠŸèƒ½ç›‘æ§ï¼›&lt;/li&gt;
&lt;li&gt;Bind å„ç±»è¯·æ±‚é‡å’Œå“åº”ç›‘æ§ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nagios æœ‰ä¸€ä¸ªå¼€æºçš„æ’ä»¶å¯ä»¥ä½¿ç”¨ï¼š&lt;a href="https://exchange.nagios.org/directory/Plugins/Network-Protocols/DNS/check_bind-2Esh/details"&gt;check_bind.sh&lt;/a&gt;ï¼Œä¸è¿‡å¾ˆè€äº†ï¼Œå¯èƒ½éœ€è¦è‡ªå·±æ”¹æ”¹ï¼Œä½¿ç”¨rndc è¿™ä¸ªå‘½ä»¤æ¥è·å–Bind çš„çŠ¶æ€ï¼Œé‡‡ç‚¹ç»˜å›¾ã€‚&lt;br&gt;
ä¸Šé¢çš„è„šæœ¬ç®€å•æ”¹æ”¹ï¼Œå¯ç”¨äºOpenFalconï¼ŒBind9.9 ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/usr/bin/env bash

#check bind status for falcon agent
#fork from https://exchange.nagios.org/directory/Plugins/Network-Protocols/DNS/check_bind-2Esh/details
#author: fangpeishi

ST_OK=0
ST_WR=1
ST_CR=2
ST_UK=3
path_pid=&amp;quot;&amp;quot;
name_pid=&amp;quot;named.pid&amp;quot;
path_rndc=&amp;quot;&amp;quot;
path_stats=&amp;quot;&amp;quot;
path_tmp=&amp;quot;&amp;quot;
pid_check=1
HOST=`hostname`
DATE=`date +%s`


check_pid() {
    if [ -f &amp;quot;$path_pid/$name_pid&amp;quot; ]
    then
        retval=0
    else
        retval=1
    fi
}

trigger_stats() {
    if [ -n &amp;quot;$path_chroot&amp;quot; ]
    then
        sudo chroot $path_chroot $path_rndc/rndc stats
    else
        sudo $path_rndc/rndc -c /named/etc/rndc.conf stats
    fi
}

copy_to_tmp() {
    tac $path_stats/named_stats.txt | awk &amp;#39;/--- \([0-9]*\)/{p=1} p{print} /\+\+\+ \([0-9]*\)/{p=0;if (count++==1) exit}&amp;#39; &amp;gt; $path_tmp/named.stats.tmp
    }

get_vals() {
    succ_1st=`grep &amp;#39;resulted in successful answer&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    succ_2nd=`grep &amp;#39;resulted in successful answer&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`
    ref_1st=`grep &amp;#39;resulted in referral&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    ref_2nd=`grep &amp;#39;resulted in referral&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`
    nxrr_1st=`grep &amp;#39;resulted in nxrrset&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    nxrr_2nd=`grep &amp;#39;resulted in nxrrset&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`
    nxdom_1st=`grep &amp;#39;resulted in NXDOMAIN&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    nxdom_2nd=`grep &amp;#39;resulted in NXDOMAIN&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`
    rec_1st=`grep &amp;#39;caused recursion&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    rec_2nd=`grep &amp;#39;caused recursion&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`
    fail_1st=`grep &amp;#39;resulted in SERVFAIL&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    fail_2nd=`grep &amp;#39;resulted in SERVFAIL&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`
    dup_1st=`grep &amp;#39;duplicate queries received&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | grep -m1 &amp;#39;&amp;#39;`
    dup_2nd=`grep &amp;#39;duplicate queries received&amp;#39; $path_tmp/named.stats.tmp | awk &amp;#39;{ print $1 }&amp;#39; | sort -n | grep -m1 &amp;#39;&amp;#39;`

    if [ &amp;quot;$succ_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        success=0
    else
        success=`expr $succ_1st - $succ_2nd`
    fi
    if [ &amp;quot;$ref_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        referral=0
    else
        referral=`expr $ref_1st - $ref_2nd`
    fi
    if [ &amp;quot;$nxrr_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        nxrrset=0
    else
        nxrrset=`expr $nxrr_1st - $nxrr_2nd`
    fi
    if [ &amp;quot;$nxdom_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        nxdomain=0
    else
        nxdomain=`expr $nxdom_1st - $nxdom_2nd`
    fi
    if [ &amp;quot;$rec_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        recursion=0
    else
        recursion=`expr $rec_1st - $rec_2nd`
    fi
    if [ &amp;quot;$fail_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        failure=0
    else
        failure=`expr $fail_1st - $fail_2nd`
    fi
    if [ &amp;quot;$dup_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        duplicate=0
    else
        duplicate=`expr $dup_1st - $dup_2nd`
    fi
    if [ &amp;quot;$drop_1st&amp;quot; == &amp;#39;&amp;#39; ]
    then
        dropped=0
    else
        dropped=`expr $drop_1st - $drop_2nd`
    fi
}

falcon() {
    echo -n &amp;quot;{\&amp;quot;metric\&amp;quot;: \&amp;quot;$1\&amp;quot;, \&amp;quot;endpoint\&amp;quot;: \&amp;quot;$HOST\&amp;quot;, \&amp;quot;tags\&amp;quot;: \&amp;quot;\&amp;quot;, &amp;quot;
    echo -n &amp;quot;\&amp;quot;value\&amp;quot;: $2,&amp;quot;
    echo -n &amp;quot; \&amp;quot;timestamp\&amp;quot;: $DATE, \&amp;quot;counterType\&amp;quot;: \&amp;quot;GAUGE\&amp;quot;, \&amp;quot;step\&amp;quot;: 60}&amp;quot;
}

get_perfdata() {
    echo -n &amp;quot;[&amp;quot;
    falcon &amp;quot;caused_recursion&amp;quot; $recursion
    echo -n &amp;quot;,&amp;quot;
    falcon &amp;quot;duplicate_queries_received&amp;quot; $duplicate
    echo -n &amp;quot;,&amp;quot;
    falcon &amp;quot;failure_responses&amp;quot; $failure
    echo -n &amp;quot;,&amp;quot;
    falcon &amp;quot;nxdomain_responses&amp;quot; $nxdomain
    echo -n &amp;quot;,&amp;quot;
    falcon &amp;quot;nxrrset_responses&amp;quot; $nxrrset
    echo -n &amp;quot;,&amp;quot;
    falcon &amp;quot;referral_responses&amp;quot; $referral
    echo -n &amp;quot;,&amp;quot;
    falcon &amp;quot;success_responses&amp;quot; $success
}

if [ ${pid_check} == 1 ]
then
    check_pid
    if [ &amp;quot;$retval&amp;quot; = 1 ]
    then
        echo -n &amp;quot;[&amp;quot;
        falcon &amp;quot;check_bind&amp;quot; 1
        echo -n &amp;quot;]&amp;quot;
        exit $ST_CR
    fi
fi

trigger_stats
copy_to_tmp
get_vals
get_perfdata

echo -n &amp;quot;,&amp;quot;
falcon &amp;quot;check_bind&amp;quot; 0
echo -n &amp;quot;]&amp;quot;

Exit $ST_OK
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2016"></category><category term="dns"></category><category term="bind"></category></entry><entry><title>Pelican æ–‡ç« ç”Ÿæˆç›®å½•</title><link href="https://fangpsh.github.io/posts/2016/2016-04-25.html" rel="alternate"></link><published>2016-04-25T17:22:30+08:00</published><updated>2016-04-25T17:22:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-04-25:/posts/2016/2016-04-25.html</id><summary type="html">&lt;p&gt;æœ€è¿‘ç¿»è¯‘äº†ä¸€ç¯‡ &lt;a href="/posts/2016/2016-04-13.html"&gt;Googleé£æ ¼ç¼–ç¨‹æŒ‡å—&lt;/a&gt;ï¼Œå‘ç°ç« èŠ‚ä¸€å¤šï¼Œæ²¡æœ‰ç›®å½•éå¸¸ä¸å‹å¥½ã€‚æ–‡ç« æ˜¯ç”¨Markdown å†™æˆçš„ï¼Œæ‰‹å†™html ä»£ç åŠ ç›®å½•å¤ªä¸æ–¹ä¾¿äº†ã€‚&lt;br&gt;
Pelican æœ‰ä¸€ä¸ªç”Ÿæˆ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;æœ€è¿‘ç¿»è¯‘äº†ä¸€ç¯‡ &lt;a href="/posts/2016/2016-04-13.html"&gt;Googleé£æ ¼ç¼–ç¨‹æŒ‡å—&lt;/a&gt;ï¼Œå‘ç°ç« èŠ‚ä¸€å¤šï¼Œæ²¡æœ‰ç›®å½•éå¸¸ä¸å‹å¥½ã€‚æ–‡ç« æ˜¯ç”¨Markdown å†™æˆçš„ï¼Œæ‰‹å†™html ä»£ç åŠ ç›®å½•å¤ªä¸æ–¹ä¾¿äº†ã€‚&lt;br&gt;
Pelican æœ‰ä¸€ä¸ªç”Ÿæˆç›®å½•çš„æ’ä»¶ï¼š&lt;a href="https://github.com/getpelican/pelican-plugins/tree/master/extract_toc"&gt;extract_toc&lt;/a&gt;ï¼Œè¯•ç”¨äº†ä¸€ä¸‹ï¼Œå‘ç°ä½¿ç”¨ä¸‰ä¸ªåå¼•å·æ ‡æ³¨çš„ä»£ç å—ä¹±æ‰äº†ï¼Œè¿™ä¸ªæ’ä»¶ä¼¼ä¹è°ƒç”¨çš„pandocï¼Œè€Œpandoc æ”¯æŒçš„markdown è¯­æ³•ä¸åŒ…å«è¯•ç”¨ä¸‰ä¸ªåå¼•å·æ ‡æ³¨ä»£ç å—ï¼Œæ‰€ä»¥æ‚²å‰§äº†ã€‚  &lt;/p&gt;
&lt;p&gt;æ”¹å˜æ€è·¯ï¼Œåœ¨æ–‡ç« é¡µé¢ä½¿ç”¨JavaScript è§£æDOM æ ‘ï¼Œç”Ÿæˆç›®å½•è¡¨æ ¼ã€‚&lt;br&gt;
Google äº†ä¸‹ï¼ŒStackoverflow çœ‹åˆ°ä¸€é—®é¢˜ï¼š&lt;br&gt;
&lt;a href="http://stackoverflow.com/questions/187619/is-there-a-javascript-solution-to-generating-a-table-of-contents-for-a-page"&gt;Is there a JavaScript solution to generating a â€œtable of contentsâ€ for a page?&lt;/a&gt;ï¼Œ&lt;br&gt;
å‚è€ƒç­”æ¡ˆç›´æ¥æ‹¿æ¥ç”¨ï¼š  &lt;/p&gt;
&lt;p&gt;toc.js&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;onload&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;toc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;article-content&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;innerHTML&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;article-content&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;innerHTML&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="sr"&gt;/&amp;lt;h([\d])&amp;gt;([^&amp;lt;]+)&amp;lt;\/h([\d])&amp;gt;/gi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;titleText&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;closeLevel&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;!=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;closeLevel&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nx"&gt;toc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;ul&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nx"&gt;toc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;/ul&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;anchor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;titleText&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/ /g&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;_&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="nx"&gt;toc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;li&amp;gt;&amp;lt;a href=\&amp;quot;#&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;anchor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\&amp;quot;&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;titleText&lt;/span&gt;
&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/li&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="w"&gt;                    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;h&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;openLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;gt;&amp;lt;a name=\&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;anchor&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;\&amp;quot;&amp;gt;&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;                        &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;titleText&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;/a&amp;gt;&amp;lt;/h&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;closeLevel&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;toc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;new&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;level&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mf"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)).&lt;/span&gt;&lt;span class="nx"&gt;join&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;/ul&amp;gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;toc&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;innerHTML&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;+=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;toc&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¿®æ”¹pelican ä¸»é¢˜ çš„base.html ä¹‹ç±»æ¨¡æ¿æ–‡ä»¶çš„ï¼Œå¼•å…¥è¿™ä¸ªJavaScript æ–‡ä»¶ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;script src=&amp;quot;{{ SITEURL }}/theme/static/js/toc.js&amp;quot; type=&amp;quot;text/javascript&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¿®æ”¹pelican ä¸»é¢˜çš„ç”Ÿæˆæ–‡ç« çš„html æ¨¡æ¿ï¼ŒåŠ ä¸€ä¸ªdivï¼Œå¦å¤–è¿˜éœ€è¦ç»™æ–‡ç« å†…å®¹çš„div åŠ ä¸€ä¸ª&lt;code&gt;id="contents"&lt;/code&gt;ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;div id=&amp;quot;toc&amp;quot;&amp;gt;
&amp;lt;/div&amp;gt;

&amp;lt;div id=&amp;quot;article-content&amp;quot; class=&amp;quot;entry-content&amp;quot;&amp;gt;
{{ article.content }}
  &amp;lt;/div&amp;gt;&amp;lt;!-- /.entry-content --&amp;gt;
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¤§åŠŸå‘Šæˆï¼Œæ•ˆæœå¦‚ä¸‹ï¼š&lt;br&gt;
&lt;img alt="pelican_toc" src="/assets/images/2023/20230301170301.png"&gt;&lt;/p&gt;</content><category term="2016"></category><category term="pelican"></category></entry><entry><title>Google Shell ç¼–ç¨‹é£æ ¼æŒ‡å—</title><link href="https://fangpsh.github.io/posts/2016/2016-04-13.html" rel="alternate"></link><published>2016-04-13T00:00:00+08:00</published><updated>2016-04-13T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-04-13:/posts/2016/2016-04-13.html</id><summary type="html">&lt;p&gt;google shellç¼–ç¨‹é£æ ¼æŒ‡å—ç¿»è¯‘&lt;/p&gt;</summary><content type="html">&lt;ul&gt;
&lt;li&gt;åŸæ–‡ï¼š&lt;a href="https://google.github.io/styleguide/shell.xml"&gt;https://google.github.io/styleguide/shell.xml&lt;/a&gt;  &lt;/li&gt;
&lt;li&gt;ä¿®è®¢ç‰ˆï¼š1.26&lt;/li&gt;
&lt;li&gt;ä½œè€…ï¼šPaul Armstrong ç­‰&lt;/li&gt;
&lt;li&gt;æ³¨ï¼šä»£ç ç‰‡æ®µå†…çš„æ³¨é‡Šæœªç¿»è¯‘ï¼Œæ€•å½±å“ç¾è§‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;h3&gt;ä½¿ç”¨å“ªç§Shell&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;Bash&lt;/code&gt; æ˜¯å”¯ä¸€è¢«å…è®¸ç”¨äºç¼–å†™å¯æ‰§è¡Œæ–‡ä»¶çš„Shell è„šæœ¬è¯­è¨€ï¼ˆè¯‘æ³¨ï¼šå­˜åœ¨å¤šç§Shellè¯­è¨€ï¼Œå¯å‚è€ƒ&lt;a href="https://en.wikipedia.org/wiki/Unix_shellï¼‰"&gt;Wikipedia:Unix_Shell&lt;/a&gt;ã€‚&lt;/strong&gt;&lt;br&gt;
å¯æ‰§è¡Œæ–‡ä»¶å¿…é¡»ä»¥&lt;code&gt;#!/bin/bash&lt;/code&gt; å¼€å§‹ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://en.wikipedia.org/wiki/Shebang_(Unix)"&gt;Wikipedia:Shebang&lt;/a&gt;ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨æœ€å°æ•°é‡çš„æ‰§è¡Œé€‰é¡¹(è¯‘æ³¨ï¼š&lt;a href="https://www.chainsawonatireswing.com/2012/02/02/find-out-what-your-unix-shells-flags-are-then-change-them//?from=@"&gt;Find out what your UNIX shellâ€™s flags are &amp;amp; then change them&lt;/a&gt;, &lt;a href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html"&gt;The Set Builtin&lt;/a&gt;ï¼‰ã€‚&lt;br&gt;
ä½¿ç”¨&lt;code&gt;set&lt;/code&gt;è®¾ç½®shell æ‰§è¡Œé€‰é¡¹ï¼Œä»¥ä¾¿ç”¨&lt;code&gt;bash &amp;lt;è„šæœ¬å&amp;gt;&lt;/code&gt; çš„æ–¹å¼è°ƒç”¨è„šæœ¬æ—¶å€™ä¸ä¼šç ´åæ‰§è¡Œé€‰é¡¹çš„åŠŸèƒ½ã€‚&lt;br&gt;
é™åˆ¶æ‰€æœ‰çš„å¯æ‰§è¡Œshell è„šæœ¬ç»Ÿä¸€ä½¿ç”¨bash ä½¿å¾—æˆ‘ä»¬åœ¨æœºå™¨ä¸Šèƒ½ç»Ÿä¸€å®‰è£…ä¸€ç§shell ã€‚ 
å”¯ä¸€çš„ä¾‹å¤–ï¼Œä½ æ­£åœ¨ç¼–å†™çš„é¡¹ç›®å¼ºåˆ¶ä½ ä½¿ç”¨å…¶ä»–shell è¯­è¨€ã€‚ä¾‹å¦‚Solaris SVR4 è½¯ä»¶åŒ…è¦æ±‚åŒ…å†…çš„ä»»ä½•è„šæœ¬ç”¨çº¯Bourne shell ç¼–å†™ï¼ˆè¯‘æ³¨ï¼šå³shï¼Œå‚è€ƒ&lt;a href="https://en.wikipedia.org/wiki/Bourne_shell"&gt;Wikipedia:Bourne_shell&lt;/a&gt;ï¼‰ã€‚  &lt;/p&gt;
&lt;h3&gt;ä»€ä¹ˆæ—¶å€™ä½¿ç”¨Shell&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Shell åº”è¯¥åªç”¨äºç¼–å†™å°å·¥å…·æˆ–è€…ç®€å•çš„åŒ…è£…è„šæœ¬ï¼ˆè¯‘æ³¨ï¼šwrapper scriptsï¼Œ&lt;a href="http://tldp.org/LDP/abs/html/wrapper.html"&gt;Shell Wrappers&lt;/a&gt;ï¼‰ã€‚&lt;/strong&gt;&lt;br&gt;
å°½ç®¡shell è„šæœ¬ä¸æ˜¯ä¸€ç§å¼€å‘è¯­è¨€ï¼Œä½†åœ¨Google å†…éƒ¨å®ƒè¢«ç”¨äºç¼–å†™å„ç§å„æ ·çš„å·¥å…·æ€§è„šæœ¬ã€‚åœ¨å¹¿æ³›çš„å¼€å‘éƒ¨ç½²ä¸­ï¼Œéµå¾ªè¿™ä»½ç¼–ç¨‹é£æ ¼æŒ‡å—æ˜¯ä¸€ç§å…±è¯†ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå»ºè®®ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸€äº›å‡†åˆ™ï¼š &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœä½ ä¸»è¦æ˜¯è°ƒç”¨å…¶ä»–å·¥å…·å’Œåšç›¸å¯¹å°‘é‡çš„æ•°æ®å¤„ç†ï¼Œä½¿ç”¨shell æ¥å®Œæˆä»»åŠ¡æ˜¯åˆé€‚çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ åœ¨æ„æ€§èƒ½ï¼Œè¯·ä½¿ç”¨å…¶ä»–å·¥å…·æ¥ä»£æ›¿shellã€‚&lt;/li&gt;
&lt;li&gt;ä»»ä½•æƒ…å†µä¸‹ï¼Œå¦‚æœä½ å‘ç°éœ€è¦ä½¿ç”¨æ•°ç»„ï¼ˆè¯‘æ³¨ï¼š&lt;a href="http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_10_02.html"&gt;Bash:Array variables&lt;/a&gt;ï¼‰ï¼Œå¹¶ä¸”ä¸æ˜¯ä½¿ç”¨&lt;code&gt;${PIPESTATUS}&lt;/code&gt;ï¼ˆè¯‘æ³¨ï¼šPIPESTATUS ä¿å­˜ç€ç®¡é“ä¸­å„å‘½ä»¤çš„è¿”å›å€¼ï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨Pythonã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ è¦ç¼–å†™ä¸€ä»½è¶…è¿‡ä¸€ç™¾è¡Œçš„Shell è„šæœ¬ï¼Œä½ åº”è¯¥å°½é‡ä½¿ç”¨Python æ¥ç¼–å†™ã€‚è®°ä½ï¼Œéšç€Shellè„šæœ¬è¡Œæ•°çš„å¢é•¿ï¼Œå°½æ—©ä½¿ç”¨å…¶ä»–è¯­è¨€æ¥é‡å†™ä½ çš„è„šæœ¬ï¼Œä»¥å…å°†æ¥é‡å†™çš„æ—¶å€™æµªè´¹æ›´å¤šçš„æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- more --&gt;
&lt;h2&gt;Shellæ–‡ä»¶å’Œè§£é‡Šå™¨è°ƒç”¨&lt;/h2&gt;
&lt;h3&gt;æ–‡ä»¶æ‰©å±•å&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å¯æ‰§è¡Œæ–‡ä»¶åº”è¯¥ä¸å¸¦æ‰©å±•åï¼ˆå¼ºçƒˆå»ºè®®ï¼‰æˆ–è€…ä½¿ç”¨&lt;code&gt;.sh&lt;/code&gt; çš„æ‰©å±•åã€‚ åº“æ–‡ä»¶åº”è¯¥å¸¦ä¸€ä¸ª&lt;code&gt;.sh&lt;/code&gt;çš„æ‰©å±•åï¼Œå¹¶ä¸”ä¸åº”è¯¥æ˜¯å¯æ‰§è¡Œçš„ã€‚&lt;/strong&gt;&lt;br&gt;
å½“æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªç¨‹åºçš„æ—¶å€™ä¸éœ€è¦çŸ¥é“å®ƒæ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å†™çš„ï¼Œå¹¶ä¸”shell ä¹Ÿä¸è¦æ±‚è„šæœ¬å¿…é¡»å¸¦æ‰©å±•åã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å¸Œæœ›ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å¸¦ç€æ‰©å±•åã€‚&lt;br&gt;
ç„¶è€Œï¼Œå¯¹äºåº“æ–‡ä»¶æ¥è¯´çŸ¥é“æ˜¯ä»€ä¹ˆè¯­è¨€å†™çš„å´éå¸¸é‡è¦ï¼Œæœ‰æ—¶éœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­è¨€ç¼–å†™ç±»ä¼¼çš„åº“æ–‡ä»¶ã€‚ä½¿ç”¨ä»£è¡¨è¯­è¨€çš„æ–‡ä»¶ååç¼€ï¼ˆå³æ‰©å±•åï¼‰ï¼Œå°±å¯ä»¥è®©ä½¿ç”¨ä¸åŒè¯­è¨€ç¼–å†™çš„å…·æœ‰åŒæ ·åŠŸèƒ½çš„åº“ä»¶æœ‰ç€ç›¸åŒçš„åå­—ã€‚  &lt;/p&gt;
&lt;h3&gt;SUID/SGID&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ç¦æ­¢åœ¨Shell è„šæœ¬ä¸­ä½¿ç”¨SUID æˆ–SGID ï¼ˆè¯‘æ³¨ï¼š&lt;a href="http://thegeekdiary.com/what-is-suid-sgid-and-sticky-bit/"&gt;What is SUID, SGID and Sticky bit ?&lt;/a&gt;ï¼‰&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;shell å­˜åœ¨å¤ªå¤šçš„å®‰å…¨é—®é¢˜ï¼Œä»¥è‡³äºå…è®¸SUID/SGID åå‡ ä¹ä¸å¯èƒ½ä¿è¯shell çš„å®‰å…¨ã€‚è™½ç„¶bash è®©è¿è¡Œ SUID å˜å¾—å›°éš¾ï¼Œä½†æ˜¯åœ¨æŸäº›å¹³å°ä¸Šè¿˜æ˜¯æœ‰å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜ç¡®ç¦æ­¢ä½¿ç”¨å®ƒã€‚&lt;br&gt;
å½“ä½ éœ€è¦ææƒçš„æ—¶å€™ï¼Œä½¿ç”¨&lt;code&gt;sudo&lt;/code&gt;ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://en.wikipedia.org/wiki/Sudo"&gt;Wikipedia:sudo&lt;/a&gt;ï¼‰ã€‚  &lt;/p&gt;
&lt;h2&gt;ç¯å¢ƒ&lt;/h2&gt;
&lt;h3&gt;STDOUT vs STDERR&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯åº”è¯¥ä¼ å…¥STDERRï¼ˆè¯‘æ³¨ï¼šæ ‡å‡†é”™è¯¯è¾“å‡ºï¼Œå»¶ä¼¸é˜…è¯»ï¼š&lt;a href="http://www.tldp.org/LDP/abs/html/io-redirection.html"&gt;I/O Redirection&lt;/a&gt;ï¼‰&lt;/strong&gt;
è¿™ä½¿å¾—ä»å®é™…é—®é¢˜ä¸­åŒºåˆ†æ­£å¸¸çŠ¶æ€å˜å¾—å®¹æ˜“ã€‚&lt;br&gt;
æ¨èä½¿ç”¨ä¸€ä¸ªå‡½æ•°æ¥ä¸“é—¨æ‰“å°é”™è¯¯ä¿¡æ¯å’Œå…¶ä»–çŠ¶æ€ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;err() {
  echo &amp;quot;[$(date +&amp;#39;%Y-%m-%dT%H:%M:%S%z&amp;#39;)]: $@&amp;quot; &amp;gt;&amp;amp;2
}

if ! do_something; then
  err &amp;quot;Unable to do_something&amp;quot;
  exit &amp;quot;${E_DID_NOTHING}&amp;quot;
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;æ³¨é‡Š&lt;/h2&gt;
&lt;h3&gt;æ–‡ä»¶å¤´&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ¯ä¸ªæ–‡ä»¶çš„å¼€å¤´å¿…é¡»æœ‰ä¸€æ®µå…³äºå®ƒå†…å®¹çš„æ¦‚è¿°&lt;/strong&gt;&lt;br&gt;
æ¯ä¸ªæ–‡ä»¶å¿…é¡»åœ¨å¼€å¤´éƒ¨åˆ†åŒ…å«ä¸€æ®µå…³äºå…¶å†…å®¹çš„æ¦‚è¿°çš„æ³¨é‡Šã€‚ä¹Ÿå¯ä»¥é€‰æ‹©æ·»åŠ ç‰ˆæƒå£°æ˜å’Œä½œè€…ä¿¡æ¯ã€‚&lt;br&gt;
ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/bin/bash
#
# Perform hot backups of Oracle databases.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å‡½æ•°æ³¨é‡Š&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;é™¤äº†ç®€çŸ­ã€æ˜ç¡®çš„å‡½æ•°ä¹‹å¤–ï¼Œä»»ä½•ä¸€ä¸ªå‡½æ•°éƒ½å¿…é¡»å†™æ³¨é‡Šã€‚åº“æ–‡ä»¶çš„ä¸­çš„ä»»ä½•ä¸€ä¸ªå‡½æ•°å¿…é¡»å†™æ³¨é‡Šï¼Œæ— è®ºå…¶é•¿çŸ­å’Œå¤æ‚æ€§ã€‚&lt;/strong&gt;&lt;br&gt;
ä»–äººåº”è¯¥èƒ½å¤Ÿåœ¨ä¸é˜…è¯»æºç çš„æƒ…å†µä¸‹é€šè¿‡é˜…è¯»æ³¨é‡Šï¼ˆå’Œå¸®åŠ©ä¿¡æ¯ï¼Œå¦‚æœæœ‰æä¾›çš„è¯ï¼‰ï¼Œä»è€Œå­¦ä¼šä½¿ç”¨ä½ çš„ç¨‹åºæˆ–è€…åº“æ–‡ä»¶ä¸­çš„å‡½æ•°ã€‚&lt;br&gt;
æ‰€æœ‰å‡½æ•°çš„æ³¨é‡Šéƒ½åº”è¯¥åŒ…å«ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹å‡½æ•°çš„æè¿°ï¼›&lt;/li&gt;
&lt;li&gt;ä¼šä½¿ç”¨æˆ–ä¿®æ”¹çš„å…¨å±€å˜é‡ï¼›&lt;/li&gt;
&lt;li&gt;å‡½æ•°ä¼ å‚ï¼›&lt;/li&gt;
&lt;li&gt;è¿”å›å€¼ï¼Œä¸æ˜¯è¿è¡Œçš„æœ€åä¸€æ¡å‘½ä»¤é»˜è®¤çš„é€€å‡ºçŠ¶æ€ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/bin/bash
#
# Perform hot backups of Oracle databases.

export PATH=&amp;#39;/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin&amp;#39;

#######################################
# Cleanup files from the backup dir
# Globals:
#   BACKUP_DIR
#   ORACLE_SID
# Arguments:
#   None
# Returns:
#   None
#######################################
cleanup() {
...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å®ç°çš„æ³¨é‡Š&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä»£ç ä¸­ä½¿ç”¨äº†æŠ€å·§ï¼Œæˆ–æ™¦æ¶©éš¾æ‡‚ï¼Œæˆ–æœ‰è¶£ï¼Œæˆ–ååˆ†é‡è¦çš„éƒ¨åˆ†ä½ éƒ½åº”è¯¥æ·»åŠ æ³¨é‡Šã€‚&lt;/strong&gt;&lt;br&gt;
è¿™é‡Œè¦éµå¾ªGoogle ä»£ç æ³¨é‡Šçš„é€šç”¨æƒ¯ä¾‹ã€‚ä¸è¦ä»»ä½•ä¸œè¥¿éƒ½æ·»åŠ æ³¨é‡Šã€‚å¦‚æœæ˜¯ä¸€ä¸ªå¤æ‚çš„ç®—æ³•ï¼Œæˆ–è€…ä½ åœ¨åšä¸€äº›ä¸ä¼—ä¸åŒçš„äº‹æƒ…ï¼ŒåŠ ä¸€æ®µç®€çŸ­çš„æ³¨é‡Šã€‚  &lt;/p&gt;
&lt;h3&gt;TODO æ³¨é‡Š&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å¯¹ä¸´æ—¶æ€§çš„ä»£ç ï¼Œæˆ–çŸ­æœŸçš„è§£å†³æ–¹æ¡ˆï¼Œæˆ–è¶³å¤Ÿå¥½ä½†æ˜¯ä¸å¤Ÿå®Œç¾çš„ä»£ç ç­‰æ·»åŠ TODO æ³¨é‡Šã€‚&lt;/strong&gt;&lt;br&gt;
è¿™å’Œ&lt;a href="https://google.github.io/styleguide/cppguide.html#TODO_Comments"&gt;C++ Guide&lt;/a&gt; ä¸­çš„åšæ³•çº¦å®šä¸€è‡´ã€‚&lt;br&gt;
TODO æ³¨é‡Šéƒ½åº”è¯¥åœ¨å¼€å¤´åŒ…å«å¤§å†™çš„TODOï¼Œè·Ÿç€æ˜¯ä¸€å¯¹å°æ‹¬å·ï¼Œä¸­é—´æ³¨æ˜ä½ çš„ç”¨æˆ·åã€‚å†’å·æ˜¯å¯é€‰çš„ã€‚æœ€å¥½ä¹Ÿåœ¨TODO æ¡ç›®æœ«å°¾æ·»åŠ bug/ticket å·ç ã€‚&lt;br&gt;
ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# TODO(mrmonkey): Handle the unlikely edge cases (bug ####)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;æ ¼å¼&lt;/h2&gt;
&lt;p&gt;ä¿®æ”¹ä»£ç çš„æ—¶å€™åº”è¯¥éµå¾ªç°å­˜ä»£ç é£æ ¼ï¼Œä»»ä½•æ–°ä»£ç éƒ½åº”è¯¥éµå¾ªä¸‹åˆ—è§„èŒƒã€‚&lt;/p&gt;
&lt;h3&gt;ç¼©è¿›&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼åšç¼©è¿›ï¼Œä¸è¦ä½¿ç”¨tabsã€‚&lt;/strong&gt;&lt;br&gt;
åœ¨ä»£ç å—ä¹‹é—´ä½¿ç”¨ç©ºè¡Œææé«˜å¯è¯»æ€§ã€‚ç¼©è¿›æ˜¯ä¸¤ä¸ªç©ºæ ¼ã€‚æ— è®ºå¦‚ä½•éƒ½ä¸è¦ä½¿ç”¨tabsã€‚å¯¹äºå·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼Œå¦‚å®çš„ä¿ç•™å·²ç»å­˜åœ¨çš„ç¼©è¿›ã€‚  &lt;/p&gt;
&lt;h3&gt;è¡Œå®½å’Œé•¿å­—ç¬¦ä¸²&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è¡Œå®½æœ€å¤§ä¸º80 ä¸ªå­—ç¬¦ã€‚&lt;/strong&gt;&lt;br&gt;
å¦‚æœä¸å¾—ä¸å†™è¶…è¿‡80 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œä½ åº”è¯¥å°½å¯èƒ½çš„ä½¿ç”¨here æ–‡æ¡£ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://zh.wikipedia.org/wiki/Hereæ–‡æ¡£"&gt;Wikipedia:Hereæ–‡æ¡£&lt;/a&gt;ï¼‰æˆ–è€…åµŒå…¥æ–°è¡Œã€‚å¦‚æœæœ‰è¶…è¿‡80 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²å¹¶ä¸”ä¸èƒ½è¢«åˆ†å‰²ï¼Œè¿™æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¼ºçƒˆå»ºè®®æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ–¹æ³•è®©å®ƒå˜çŸ­ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# DO use &amp;#39;here document&amp;#39;s
cat &amp;lt;&amp;lt;END;
I am an exceptionally long
string.
END

# Embedded newlines are ok too
long_string=&amp;quot;I am an exceptionally
  long string.&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;ç®¡é“&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœä¸€è¡Œå†™ä¸ä¸‹æ•´æ¡ç®¡é“ï¼Œé‚£ä¹ˆåº”è¯¥ä¸€è¡Œä¸€ä¸ªç®¡æ®µçš„è¿›è¡Œåˆ†å‰²ã€‚&lt;/strong&gt;&lt;br&gt;
å¦‚æœä¸€è¡Œèƒ½å†™ä¸‹ä¸€æ¡ç®¡é“ï¼Œé‚£ä¹ˆå°±åº”è¯¥å†™åˆ°ä¸€è¡Œã€‚ &lt;br&gt;
å¦‚æœå†™ä¸ä¸‹ï¼Œå°±åº”è¯¥å°†ç®¡é“åˆ†å‰²ä¸ºä¸€ä¸ªç®¡æ®µä¸€è¡Œï¼Œä»¥2ä¸ªç©ºæ ¼ä½œä¸ºç¼©è¿›ã€‚è¿™ä¸ªè§„èŒƒé€‚ç”¨ä¸ä½¿ç”¨â€œ|â€ é“¾æ¥èµ·æ¥çš„ç»„åˆå‘½ä»¤ä»¥åŠä½¿ç”¨â€œ||â€ å’Œâ€œ&amp;amp;&amp;amp;â€çš„ç»„åˆé€»è¾‘è¯­å¥ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# All fits on one line
command1 | command2

# Long commands
command1 \
  | command2 \
  | command3 \
  | command4
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å¾ªç¯&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;&lt;code&gt;; do&lt;/code&gt;, &lt;code&gt;; then&lt;/code&gt; ä¸ &lt;code&gt;while&lt;/code&gt;,&lt;code&gt;for&lt;/code&gt; æˆ–&lt;code&gt;if&lt;/code&gt; åº”ç½®äºåŒä¸€è¡Œã€‚&lt;/strong&gt;&lt;br&gt;
Shell ä¸­çš„å¾ªç¯æœ‰ä¸€ç‚¹ç‰¹åˆ«,ä½†æ˜¯æˆ‘ä»¬éµå¾ªå’Œå£°æ˜å‡½æ•°æ—¶å¤§æ‹¬å·çš„ç›¸åŒçš„å‡†åˆ™ã€‚å³&lt;code&gt;; then&lt;/code&gt; å’Œ &lt;code&gt;; do&lt;/code&gt; åº”è¯¥å’Œ if/for/while è¯­å¥å†™åœ¨åŒä¸€è¡Œã€‚&lt;code&gt;else&lt;/code&gt; åº”è¯¥ç‹¬å ä¸€è¡Œï¼Œç»“æŸå£°æ˜ä¹Ÿåº”è¯¥ç‹¬å ä¸€è¡Œï¼Œå¹¶ä¸”å’Œå¼€å§‹å£°æ˜å‚ç›´å¯¹é½ã€‚  &lt;/p&gt;
&lt;p&gt;ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;for dir in ${dirs_to_cleanup}; do
  if [[ -d &amp;quot;${dir}/${ORACLE_SID}&amp;quot; ]]; then
    log_date &amp;quot;Cleaning up old files in ${dir}/${ORACLE_SID}&amp;quot;
    rm &amp;quot;${dir}/${ORACLE_SID}/&amp;quot;*
    if [[ &amp;quot;$?&amp;quot; -ne 0 ]]; then
      error_message
    fi
  else
    mkdir -p &amp;quot;${dir}/${ORACLE_SID}&amp;quot;
    if [[ &amp;quot;$?&amp;quot; -ne 0 ]]; then
      error_message
    fi
  fi
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Case å£°æ˜&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¯ä»¥é€‰æ‹©2ä¸ªç©ºæ ¼ä½œä¸ºç¼©è¿›ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ¹é…è¡Œå³æ‹¬å·åé¢å’Œ&lt;code&gt;;;&lt;/code&gt;å‰é¢éƒ½éœ€è¦åŠ ä¸€ä¸ªç©ºæ ¼ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŒ¹é…æ¨¡å¼ï¼Œæ“ä½œå’Œ&lt;code&gt;;;&lt;/code&gt; åº”è¯¥åˆ†æˆä¸åŒçš„è¡Œã€‚é•¿çš„è¯­å¥æˆ–è€…å¤šå‘½ä»¤ç»„åˆè¯­å¥åº”è¯¥åˆ‡å‰²æˆå¤šè¡Œã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åŒ¹é…è¡¨è¾¾å¼åº”è¯¥æ¯”&lt;code&gt;case&lt;/code&gt;å’Œ&lt;code&gt;esac&lt;/code&gt; ç¼©è¿›ä¸€çº§ã€‚å¤šè¡Œæ“ä½œåº”è¯¥å†ç¼©è¿›ä¸€çº§ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ç»™åŒ¹é…è¡¨è¾¾å¼åŠ å¼•å·ã€‚åŒ¹é…æ¨¡å¼å‰é¢ä¸åº”è¯¥æœ‰å·¦æ‹¬å·ã€‚é¿å…ä½¿ç”¨&lt;code&gt;;&amp;amp;&lt;/code&gt; å’Œ&lt;code&gt;;;&amp;amp;&lt;/code&gt;è¿™äº›æ ‡è®°ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;case &amp;quot;${expression}&amp;quot; in
  a)
    variable=&amp;quot;...&amp;quot;
    some_command &amp;quot;${variable}&amp;quot; &amp;quot;${other_expr}&amp;quot; ...
  ;;
  absolute)
    actions=&amp;quot;relative&amp;quot;
    another_command &amp;quot;${actions}&amp;quot; &amp;quot;${other_expr}&amp;quot; ...
  ;;
  *)
    error &amp;quot;Unexpected expression &amp;#39;${expression}&amp;#39;&amp;quot;
  ;;
esac
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å˜é‡&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æŒ‰ä¼˜å…ˆçº§æ’åºï¼šå’Œå·²å­˜çš„é£æ ¼ä¸€è‡´ï¼›ç»™ä½ çš„å˜é‡åŠ å¼•å·ï¼›æ¨èä½¿ç”¨"${var}"è€Œä¸æ˜¯"$var"ï¼Œä½†æ˜¯è§†å…·ä½“è€Œå®šã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;è¿™äº›ä»…ä»…æ˜¯æŒ‡å—ï¼Œå› ä¸ºè¿™ä¸ªä¸»é¢˜å†…å®¹ä½œä¸ºå¼ºåˆ¶è§„å®šä¼¼ä¹æ˜¯æœ‰äº‰è®®çš„ã€‚&lt;br&gt;
ä»¥ä¸‹æŒ‰ç…§ä¼˜å…ˆçº§æ’åˆ—ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å’Œç°å­˜ä»£ç çš„é£æ ¼ä¿æŒä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;ç»™å˜é‡åŠ å¼•å·ï¼Œå‚è€ƒã€ŒåŠ å¼•å·ã€ä¸€èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸æ˜¯ç»å¯¹å¿…è¦æˆ–ä¸ºäº†é¿å…æ­§ä¹‰ï¼Œä¸è¦ç”¨å¤§æ‹¬å·æŠŠå•ä¸ªå­—ç¬¦çš„shell å˜é‡æˆ– ç‰¹æ®Šå‚æ•°ï¼ˆè¯‘æ³¨ï¼šæŒ‡$?,$$,$@,$*ç­‰è¿™ç±»å‚æ•°ï¼Œ&lt;a href="https://www.gnu.org/software/bash/manual/html_node/Special-Parameters.html"&gt;Special Parameters&lt;/a&gt;ï¼‰æˆ–ä½ç½®å‚æ•°ï¼ˆè¯‘æ³¨ï¼š&lt;a href="https://www.gnu.org/software/bash/manual/html_node/Positional-Parameters.html"&gt; Positional Parameters&lt;/a&gt;ï¼‰ã€‚æ¨èå°†å…¶ä»–æ‰€æœ‰å˜é‡éƒ½ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Section of recommended cases.

# Preferred style for &amp;#39;special&amp;#39; variables:
echo &amp;quot;Positional: $1&amp;quot; &amp;quot;$5&amp;quot; &amp;quot;$3&amp;quot;
echo &amp;quot;Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \$=$$ ...&amp;quot;

# Braces necessary:
echo &amp;quot;many parameters: ${10}&amp;quot;

# Braces avoiding confusion:
# Output is &amp;quot;a0b0c0&amp;quot;
set -- a b c
echo &amp;quot;${1}0${2}0${3}0&amp;quot;

# Preferred style for other variables:
echo &amp;quot;PATH=${PATH}, PWD=${PWD}, mine=${some_var}&amp;quot;
while read f; do
  echo &amp;quot;file=${f}&amp;quot;
done &amp;lt; &amp;lt;(ls -l /tmp)

# Section of discouraged cases

# Unquoted vars, unbraced vars, brace-quoted single letter
# shell specials.
echo a=$avar &amp;quot;b=$bvar&amp;quot; &amp;quot;PID=${$}&amp;quot; &amp;quot;${1}&amp;quot;

# Confusing use: this is expanded as &amp;quot;${1}0${2}0${3}0&amp;quot;,
# not &amp;quot;${10}${20}${30}
set -- a b c
echo &amp;quot;$10$20$30&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;åŠ å¼•å·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒ…å«å˜é‡çš„å­—ç¬¦ä¸²ï¼Œå‘½ä»¤æ›¿æ¢ï¼Œç©ºæ ¼å’Œshell å…ƒå­—ç¬¦éƒ½å¿…é¡»åŠ å¼•å·ï¼Œé™¤äº†ä¸€å®šè¦ä»”ç»†å¾—å¤„ç†è¡¨è¾¾å¼ï¼Œä¸åŠ å¼•å·ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨èç»™åŒ…å«å•è¯çš„å­—ç¬¦ä¸²åŠ å¼•å·ï¼ˆä¸åŒ…æ‹¬å‘½ä»¤é€‰é¡¹æˆ–è·¯å¾„åï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦ç»™å­—é¢ä¸Šçš„æ•´æ•°åŠ å¼•å·ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»”ç»†å¤„ç†&lt;code&gt;[[&lt;/code&gt;ä¸­åŒ¹é…æ¨¡å¼çš„å¼•å·ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åšæŒä½¿ç”¨"$@"ï¼Œé™¤éä½ æœ‰åŸå› è¦ä½¿ç”¨ $* ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# &amp;#39;Single&amp;#39; quotes indicate that no substitution is desired.
# &amp;quot;Double&amp;quot; quotes indicate that substitution is required/tolerated.

# Simple examples
# &amp;quot;quote command substitutions&amp;quot;
flag=&amp;quot;$(some_command and its args &amp;quot;$@&amp;quot; &amp;#39;quoted separately&amp;#39;)&amp;quot;

# &amp;quot;quote variables&amp;quot;
echo &amp;quot;${flag}&amp;quot;

# &amp;quot;never quote literal integers&amp;quot;
value=32
# &amp;quot;quote command substitutions&amp;quot;, even when you expect integers
number=&amp;quot;$(generate_number)&amp;quot;

# &amp;quot;prefer quoting words&amp;quot;, not compulsory
readonly USE_INTEGER=&amp;#39;true&amp;#39;

# &amp;quot;quote shell meta characters&amp;quot;
echo &amp;#39;Hello stranger, and well met. Earn lots of $$$&amp;#39;
echo &amp;quot;Process $$: Done making \$\$\$.&amp;quot;

# &amp;quot;command options or path names&amp;quot;
# ($1 is assumed to contain a value here)
grep -li Hugo /dev/null &amp;quot;$1&amp;quot;

# Less simple examples
# &amp;quot;quote variables, unless proven false&amp;quot;: ccs might be empty
git send-email --to &amp;quot;${reviewers}&amp;quot; ${ccs:+&amp;quot;--cc&amp;quot; &amp;quot;${ccs}&amp;quot;}

# Positional parameter precautions: $1 might be unset
# Single quotes leave regex as-is.
grep -cP &amp;#39;([Ss]pecial|\|?characters*)$&amp;#39; ${1:+&amp;quot;$1&amp;quot;}

# For passing on arguments,
# &amp;quot;$@&amp;quot; is right almost everytime, and
# $* is wrong almost everytime:
#
# * $* and $@ will split on spaces, clobbering up arguments
#   that contain spaces and dropping empty strings;
# * &amp;quot;$@&amp;quot; will retain arguments as-is, so no args
#   provided will result in no args being passed on;
#   This is in most cases what you want to use for passing
#   on arguments.
# * &amp;quot;$*&amp;quot; expands to one argument, with all args joined
#   by (usually) spaces,
#   so no args provided will result in one empty string
#   being passed on.
# (Consult &amp;#39;man bash&amp;#39; for the nit-grits ;-)

set -- 1 &amp;quot;2 two&amp;quot; &amp;quot;3 three tres&amp;quot;; echo $# ; set -- &amp;quot;$*&amp;quot;; echo &amp;quot;$#, $@&amp;quot;)
set -- 1 &amp;quot;2 two&amp;quot; &amp;quot;3 three tres&amp;quot;; echo $# ; set -- &amp;quot;$@&amp;quot;; echo &amp;quot;$#, $@&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;ç‰¹æ€§å’Œå‘&lt;/h2&gt;
&lt;h3&gt;å‘½ä»¤æ›¿æ¢&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨&lt;code&gt;$(command)&lt;/code&gt; ä»£æ›¿åå¼•å·ã€‚&lt;/strong&gt;&lt;br&gt;
åµŒå¥—çš„åå¼•å·éœ€è¦åœ¨å†…éƒ¨ä½¿ç”¨&lt;code&gt;\&lt;/code&gt; è½¬ä¹‰ã€‚åµŒå¥—çš„&lt;code&gt;$(command)&lt;/code&gt; ä¸éœ€è¦æ”¹å˜æ ¼å¼ï¼Œå¯è¯»æ€§ä¹Ÿæ›´å¥½ã€‚&lt;br&gt;
ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# This is preferred:
var=&amp;quot;$(command &amp;quot;$(command1)&amp;quot;)&amp;quot;

# This is not:
var=&amp;quot;`command \`command1\``&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Test, [ å’Œ [[&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ¨èä½¿ç”¨&lt;code&gt;[[ ... ]]&lt;/code&gt;ä»£æ›¿ &lt;code&gt;[&lt;/code&gt;,&lt;code&gt;test&lt;/code&gt; å’Œ&lt;code&gt;/usr/bin/[&lt;/code&gt;&lt;/strong&gt;  &lt;br&gt;
&lt;code&gt;[[ ... ]]&lt;/code&gt; å¯ä»¥é™ä½é”™è¯¯ï¼Œå› ä¸ºåœ¨ &lt;code&gt;[[&lt;/code&gt; å’Œ&lt;code&gt;]]&lt;/code&gt;  ç›´æ¥ä¸ä¼šå‘ç”Ÿè·¯å¾„æ‰©å±•æˆ–å•è¯åˆ†å‰²ï¼Œå¹¶ä¸”&lt;code&gt;[[ ... ]]&lt;/code&gt; å…è®¸æ­£åˆ™è¡¨è¾¾å¼è€Œ&lt;code&gt;[ ... ]&lt;/code&gt;ä¸å…è®¸ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# This ensures the string on the left is made up of characters in the
# alnum character class followed by the string name.
# Note that the RHS should not be quoted here.
# For the gory details, see
# E14 at http://tiswww.case.edu/php/chet/bash/FAQ
if [[ &amp;quot;filename&amp;quot; =~ ^[[:alnum:]]+name ]]; then
  echo &amp;quot;Match&amp;quot;
fi

# This matches the exact pattern &amp;quot;f*&amp;quot; (Does not match in this case)
if [[ &amp;quot;filename&amp;quot; == &amp;quot;f*&amp;quot; ]]; then
  echo &amp;quot;Match&amp;quot;
fi

# This gives a &amp;quot;too many arguments&amp;quot; error as f* is expanded to the
# contents of the current directory
if [ &amp;quot;filename&amp;quot; == f* ]; then
  echo &amp;quot;Match&amp;quot;
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;æ£€æµ‹å­—ç¬¦ä¸²&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å¦‚æœå¯èƒ½çš„è¯ï¼Œä½¿ç”¨å¼•å·è€Œä¸æ˜¯è¿‡æ»¤å­—ç¬¦ä¸²ã€‚&lt;/strong&gt;&lt;br&gt;
æ£€æµ‹å­—ç¬¦ä¸²æ—¶å€™ï¼ŒBashèƒ½å¤Ÿæ™ºèƒ½çš„å¤„ç†ç©ºå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œä¸ºäº†è®©ä»£ç å¯è¯»æ€§æ›´å¥½ï¼Œåº”ç”¨ç©ºæˆ–éç©ºå­—ç¬¦ä¸²æµ‹è¯•ï¼Œè€Œä¸æ˜¯è¿‡æ»¤å­—ç¬¦ä¸²ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Do this:
if [[ &amp;quot;${my_var}&amp;quot; = &amp;quot;some_string&amp;quot; ]]; then
  do_something
fi

# -z (string length is zero) and -n (string length is not zero) are
# preferred over testing for an empty string
if [[ -z &amp;quot;${my_var}&amp;quot; ]]; then
  do_something
fi

# This is OK (ensure quotes on the empty side), but not preferred:
if [[ &amp;quot;${my_var}&amp;quot; = &amp;quot;&amp;quot; ]]; then
  do_something
fi

# Not this:
if [[ &amp;quot;${my_var}X&amp;quot; = &amp;quot;some_stringX&amp;quot; ]]; then
  do_something
fi  
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸ºé¿å…å¯¹ä½ æ£€æµ‹çš„ç›®çš„æ„Ÿåˆ°å›°æƒ‘ï¼Œè¯·ç›´æ¥ä½¿ç”¨&lt;code&gt;-z&lt;/code&gt;æˆ–&lt;code&gt;-n&lt;/code&gt;ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Use this
if [[ -n &amp;quot;${my_var}&amp;quot; ]]; then
  do_something
fi

# Instead of this as errors can occur if ${my_var} expands to a test
# flag
if [[ &amp;quot;${my_var}&amp;quot; ]]; then
  do_something
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;æ–‡ä»¶åçš„é€šé…ç¬¦æ‰©å±•&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å½“å¯¹æ–‡ä»¶åä½¿ç”¨é€šé…ç¬¦çš„æ—¶å€™ï¼Œè¯·ä½¿ç”¨å‡†ç¡®çš„è·¯å¾„ã€‚&lt;/strong&gt;&lt;br&gt;
å› ä¸ºæ–‡ä»¶åå¯ä»¥ä»¥&lt;code&gt;-&lt;/code&gt;ä¸ºå¼€å¤´ï¼Œæ‰€ä»¥ä½¿ç”¨&lt;code&gt;./*&lt;/code&gt; ä»£æ›¿&lt;code&gt;*&lt;/code&gt;ä¼šæ›´å®‰å…¨ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Here&amp;#39;s the contents of the directory:
# -f  -r  somedir  somefile

# This deletes almost everything in the directory by force
psa@bilby$ rm -v *
removed directory: `somedir&amp;#39;
removed `somefile&amp;#39;

# As opposed to:
psa@bilby$ rm -v ./*
removed `./-f&amp;#39;
removed `./-r&amp;#39;
rm: cannot remove `./somedir&amp;#39;: Is a directory
removed `./somefile&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;Eval&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;åº”è¯¥é¿å…ä½¿ç”¨&lt;code&gt;eval&lt;/code&gt;&lt;/strong&gt;&lt;br&gt;
å½“ç”¨äºç»™å˜é‡èµ‹å€¼æ—¶ï¼Œeval å¯ä»¥è§£æè¾“å…¥ï¼Œè®¾ç½®å˜é‡ï¼Œä½†æ˜¯ä¸èƒ½æ£€æŸ¥è¿™äº›å˜é‡æ˜¯ä»€ä¹ˆã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# What does this set?
# Did it succeed? In part or whole?
eval $(set_my_variables)

# What happens if one of the returned values has a space in it?
variable=&amp;quot;$(eval some_function)&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;ç®¡é“å¯¼å…¥While&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ç›¸æ¯”ç®¡é“å¯¼å…¥whileï¼Œæ›´æ¨èä½¿ç”¨ç¨‹åºæ›¿æ¢ï¼ˆè¯‘æ³¨ï¼š&lt;a href="http://tldp.org/LDP/abs/html/process-sub.html"&gt;Process Substitution&lt;/a&gt;ï¼‰æˆ– for å¾ªç¯ã€‚åœ¨ ä¸€ä¸ªwhile å¾ªç¯ä¸­ä¿®æ”¹çš„å˜é‡æ˜¯ä¸èƒ½ä¼ é€’ç»™çˆ¶è¿›ç¨‹çš„ï¼Œå› ä¸ºå¾ªç¯å‘½ä»¤æ˜¯å…è®¸åœ¨ä¸€ä¸ªå­shell ä¸­ã€‚&lt;/strong&gt;&lt;br&gt;
ç®¡é“å¯¼å…¥while å¾ªç¯ä¸­éšè—çš„å­shell è®©è¿½è¸ªbug å˜å¾—å›°éš¾ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;last_line=&amp;#39;NULL&amp;#39;
your_command | while read line; do
  last_line=&amp;quot;${line}&amp;quot;
done

# This will output &amp;#39;NULL&amp;#39;
echo &amp;quot;${last_line}&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœä½ ç¡®å®šè¾“å…¥ä¸åŒ…å«ç©ºæ ¼æˆ–è€…ç‰¹æ®Šå­—ç¬¦ä¸²ï¼ˆé€šå¸¸ï¼Œè¿™æ„å‘³ç€ä¸æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼‰ï¼Œè¯·ä½¿ç”¨ for å¾ªç¯ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;total=0
# Only do this if there are no spaces in return values.
for value in $(command); do
  total+=&amp;quot;${value}&amp;quot;
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨è¿›ç¨‹æ›¿æ¢å¯ä»¥é‡å®šå‘è¾“å‡ºï¼Œä½†æ˜¯è¯·å°†å‘½ä»¤æ”¾ç½®åœ¨ä¸€ä¸ªæ˜¾å¼çš„å­shell ä¸­ï¼Œè€Œä¸æ˜¯ä¸ºwhile å¾ªç¯åˆ›å»ºçš„éšå¼å­shellã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;total=0
last_file=
while read count filename; do
  total+=&amp;quot;${count}&amp;quot;
  last_file=&amp;quot;${filename}&amp;quot;
done &amp;lt; &amp;lt;(your_command | uniq -c)

# This will output the second field of the last line of output from
# the command.
echo &amp;quot;Total = ${total}&amp;quot;
echo &amp;quot;Last one = ${last_file}&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“ä¸éœ€è¦ä¼ é€’éå¸¸çš„ç»“æœç»™çˆ¶shell çš„æ—¶å€™å¯ä»¥ä½¿ç”¨while å¾ªç¯ï¼Œé€šå¸¸æƒ…å†µä¸‹æ›´å¤šçš„ç»“æœéœ€è¦å¤æ‚çš„â€œè§£æâ€ã€‚å¦å¤–æ³¨æ„ä¸€äº›ç®€å•çš„ä¾‹å­é€šè¿‡ç±»ä¼¼aws è¿™æ ·çš„å·¥å…·è§£å†³èµ·æ¥æ›´å®¹æ˜“ã€‚è¿™ä¸ªç‰¹æ€§åœ¨ä½ ç‰¹åˆ«ä¸å¸Œæœ›æ”¹å˜çˆ¶è¿›ç¨‹åŸŸçš„å˜é‡çš„æ—¶å€™ä¹Ÿæ˜¯æœ‰ç”¨çš„ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Trivial implementation of awk expression:
#   awk &amp;#39;$3 == &amp;quot;nfs&amp;quot; { print $2 &amp;quot; maps to &amp;quot; $1 }&amp;#39; /proc/mounts
cat /proc/mounts | while read src dest type opts rest; do
  if [[ ${type} == &amp;quot;nfs&amp;quot; ]]; then
    echo &amp;quot;NFS ${dest} maps to ${src}&amp;quot;
  fi
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;å‘½åä¹ æƒ¯&lt;/h2&gt;
&lt;h3&gt;å‡½æ•°å&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨å°å†™å­—æ¯ï¼Œç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚ä½¿ç”¨&lt;code&gt;::&lt;/code&gt;åˆ†éš”åº“æ–‡ä»¶ã€‚å‡½æ•°ååé¢å¿…é¡»æœ‰å°æ‹¬å·ã€‚å…³é”®è¯&lt;code&gt;function&lt;/code&gt; æ˜¯å¯é€‰çš„ï¼Œä½†åœ¨é¡¹ç›®ä¸­åº”è¯¥ä¿æŒä¸€è‡´ã€‚&lt;/strong&gt;&lt;br&gt;
å¦‚æœä½ åœ¨å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œè¯·ç”¨å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚å¦‚æœä½ åœ¨å†™ä¸€ä¸ªåŒ…ï¼ŒåŒ…åè¯·ç”¨&lt;code&gt;::&lt;/code&gt; åˆ†éš”ã€‚å·¦å¤§æ‹¬å·å¿…é¡»å’Œå‡½æ•°ååœ¨åŒä¸€è¡Œï¼ˆå’ŒGoogle å†…çš„å…¶ä»–è¯­è¨€è§„èŒƒä¸€æ ·ï¼‰ï¼Œå¹¶ä¸”åœ¨å‡½æ•°åå’Œå°æ‹¬å·ç›´æ¥ä¸èƒ½æœ‰ç©ºæ ¼ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Single function
my_func() {
  ...
}

# Part of a package
mypackage::my_func() {
  ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“å‡½æ•°ååé¢å¸¦"()" çš„æ—¶å€™ï¼Œå…³é”®è¯&lt;code&gt;function&lt;/code&gt; æ˜¯å¤šä½™çš„ï¼Œä½†æ˜¯å®ƒæé«˜äº†å‡½æ•°çš„è¾¨è¯†åº¦ã€‚  &lt;/p&gt;
&lt;h3&gt;å˜é‡å&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å’Œå‡½æ•°åè§„èŒƒä¸€è‡´ã€‚&lt;/strong&gt;&lt;br&gt;
å¾ªç¯å†…çš„å˜é‡ååº”è¯¥å’Œå…¶ä»–å˜é‡åä¸€æ ·å‘½åã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;for zone in ${zones}; do
  something_with &amp;quot;${zone}&amp;quot;
done
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å¸¸é‡åå’Œç¯å¢ƒå˜é‡å&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å…¨éƒ¨éƒ½åº”è¯¥å¤§å†™ï¼Œç”¨ä¸‹åˆ’çº¿åˆ†éš”ï¼Œåœ¨æ–‡ä»¶é¡¶éƒ¨å£°æ˜ã€‚&lt;/strong&gt;&lt;br&gt;
å¸¸é‡å’Œä»»ä½•å¯¼å‡ºåˆ°ç¯å¢ƒçš„å…ƒç´ éƒ½åº”è¯¥å¤§å†™ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Constant
readonly PATH_TO_FILES=&amp;#39;/some/path&amp;#39;

# Both constant and environment
declare -xr ORACLE_SID=&amp;#39;PROD&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æœ‰äº›å…ƒç´ åœ¨åˆå§‹è®¾ç½®æ—¶å°±æˆäº†å¸¸é‡ï¼ˆä¾‹å¦‚é€šè¿‡getoptsï¼Œï¼ˆè¯‘æ³¨ï¼š&lt;a href="http://wiki.bash-hackers.org/howto/getopts_tutorial"&gt;Small getopts tutorial&lt;/a&gt;ï¼‰ï¼‰ã€‚æ‰€ä»¥å¯ä»¥åœ¨getops ä¸­æˆ–åœ¨æŸç§æƒ…å†µä¸­è®¾ç½®å˜é‡ï¼Œä½†æ˜¯åº”è¯¥åœ¨è®¾ç½®ä¹‹åé©¬ä¸Šå°†å…¶è®¾ç½®æˆåªè¯»ã€‚æ³¨æ„åœ¨å‡½æ•°å†…éƒ¨&lt;code&gt;declare&lt;/code&gt; ä¸ä¼šå¯¹å…¨å±€å˜é‡è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æ¨èä½¿ç”¨&lt;code&gt;readonly&lt;/code&gt;æˆ–&lt;code&gt;export&lt;/code&gt;æ¥ä»£æ›¿ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;VERBOSE=&amp;#39;false&amp;#39;
while getopts &amp;#39;v&amp;#39; flag; do
  case &amp;quot;${flag}&amp;quot; in
    v) VERBOSE=&amp;#39;true&amp;#39; ;;
  esac
done
readonly VERBOSE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;æºæ–‡ä»¶å&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å…¨å°å†™ï¼Œå¦‚æœæœ‰å¿…è¦çš„è¯åº”è¯¥ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚&lt;/strong&gt;&lt;br&gt;
è¿™å’ŒGoogle å†…éƒ¨çš„å…¶ä»–ä»£ç é£æ ¼ä¸€è‡´ï¼š&lt;code&gt;maketemplate&lt;/code&gt;æˆ–&lt;code&gt;make_template&lt;/code&gt;æ˜¯å¯ä»¥çš„ï¼Œä½†ä¸å¯ä»¥æ˜¯&lt;code&gt;make-template&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;åªè¯»å˜é‡&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨&lt;code&gt;readonly&lt;/code&gt;æˆ–&lt;code&gt;declare -r&lt;/code&gt;æ¥ç¡®ä¿å®ƒä»¬æ˜¯åªè¯»çš„ã€‚&lt;/strong&gt;&lt;br&gt;
å› ä¸ºå…¨å±€å˜é‡åœ¨shell ä¸­è¢«å¹¿æ³›ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®ƒä»¬çš„æ—¶å€™æ•è·é”™è¯¯æ˜¯éå¸¸é‡è¦çš„ã€‚å½“ä½ å£°æ˜å˜é‡çš„æ—¶å¦‚æœæ‰“ç®—è®©å®ƒä»¬åªè¯»ï¼Œé‚£å°±æ˜ç¡®çš„è®¾ç½®ä¸€ä¸‹ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;zip_version=&amp;quot;$(dpkg --status zip | grep Version: | cut -d &amp;#39; &amp;#39; -f 2)&amp;quot;
if [[ -z &amp;quot;${zip_version}&amp;quot; ]]; then
  error_message
else
  readonly zip_version
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;ä½¿ç”¨å±€éƒ¨å˜é‡&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ä½¿ç”¨&lt;code&gt;local&lt;/code&gt;å£°æ˜å‡½æ•°å†…çš„å˜é‡ã€‚å£°æ˜å’Œèµ‹å€¼åº”è¯¥åœ¨ä¸åŒè¡Œã€‚&lt;/strong&gt;&lt;br&gt;
é€šè¿‡ä½¿ç”¨&lt;code&gt;local&lt;/code&gt; å£°æ˜å±€éƒ¨å˜é‡æ¥ç¡®ä¿å®ƒä»¬åªä½œç”¨äºå‡½æ•°å’Œå­å‡½æ•°å†…éƒ¨ã€‚è¿™æ ·åšé¿å…æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ï¼Œå’Œé¿å…ä¸ç»æ„ä¹‹é—´è®¾ç½®äº†ä¸€ä¸ªå¯¹äºå‡½æ•°å¤–éƒ¨ååˆ†é‡è¦çš„å˜é‡ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;my_func2() {
  local name=&amp;quot;$1&amp;quot;

  # Separate lines for declaration and assignment:
  local my_var
  my_var=&amp;quot;$(my_func)&amp;quot; || return

  # DO NOT do this: $? contains the exit code of &amp;#39;local&amp;#39;, not my_func
  local my_var=&amp;quot;$(my_func)&amp;quot;
  [[ $? -eq 0 ]] || return

  ...
  }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å‡½æ•°ä½ç½®&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å°†æ‰€æœ‰å‡½æ•°ä¸€èµ·æ”¾åœ¨å¸¸é‡ä¸‹æ–¹ã€‚ä¸è¦åœ¨å‡½æ•°ä¹‹é—´æŒŸè—å¯æ‰§è¡Œä»£ç ã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;å¦‚æœå­˜åœ¨å‡½æ•°ï¼Œè¯·å°†å®ƒä»¬ä¸€èµ·æ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚åªæœ‰includesï¼Œ&lt;code&gt;set&lt;/code&gt; å£°æ˜å’Œå¸¸é‡è®¾ç½®æœ‰å¯èƒ½å‡ºç°åœ¨å‡½æ•°ä¸Šé¢ã€‚&lt;br&gt;
ä¸è¦åœ¨å‡½æ•°ä¹‹é—´æŒŸè—å¯æ‰§è¡Œä»£ç ã€‚å¦‚æœè¿™æ ·åšä¼šå¯¼è‡´åœ¨debug çš„æ—¶å€™ï¼Œä»£ç éš¾ä»¥è·Ÿè¸ªå’Œå‡ºç°æ„æƒ³ä¸åˆ°çš„æ‰§è¡Œç»“æœã€‚&lt;/p&gt;
&lt;h3&gt;main&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è‡³å°‘åŒ…å«ä¸€ä¸ªå‡½æ•°çš„è„šæœ¬ï¼Œå¦‚æœè¶³å¤Ÿé•¿çš„è¯ï¼Œéƒ½åº”è¯¥æœ‰ä¸€ä¸ªå«&lt;code&gt;main&lt;/code&gt; çš„å‡½æ•°ã€‚&lt;/strong&gt;&lt;br&gt;
ä¸ºäº†æ–¹ä¾¿æ‰¾åˆ°ç¨‹åºå¼€å§‹æ‰§è¡Œçš„åœ°æ–¹ï¼Œåº”è¯¥åœ¨æ‰€æœ‰å‡½æ•°çš„åº•éƒ¨æ”¾ä¸€ä¸ªå«&lt;code&gt;main&lt;/code&gt;çš„ä¸»å‡½æ•°ï¼ŒåŒ…å«ä¸»è¦çš„ç¨‹åºè°ƒç”¨ã€‚è¿™ä½¿å¾—å…¶ä»–çš„ä»£ç ä¿æŒä¸€è‡´æ€§ï¼Œä¹Ÿå…è®¸ä½ ä½¿ç”¨&lt;code&gt;local&lt;/code&gt;å®šä¹‰æ›´å¤šçš„å˜é‡ï¼ˆå¦‚æœä¸»ä»£ç ä¸æ˜¯ä¸€ä¸ªå‡½æ•°æ˜¯åšä¸åˆ°çš„ï¼‰ã€‚æ–‡ä»¶æœ€åä¸€è¡Œéæ³¨é‡Šçš„å†…å®¹åº”è¯¥æ˜¯è°ƒç”¨&lt;code&gt;main&lt;/code&gt;ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;main &amp;quot;$@&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“ç„¶ï¼Œå¯¹äºé¡ºåºæ‰§è¡Œçš„ç®€çŸ­ä»£ç ï¼ŒåŠ 'main' å‡½æ•°æ˜¯é€‚å¾—å…¶åçš„ï¼Œå¹¶ä¸éœ€è¦ã€‚&lt;/p&gt;
&lt;h2&gt;è°ƒç”¨å‘½ä»¤&lt;/h2&gt;
&lt;h3&gt;æ£€æŸ¥è¿”å›å€¼&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ€»æ˜¯æ£€æŸ¥è¿”å›å€¼ï¼Œå¹¶ç»™å‡ºå…·ä½“è§£é‡Šä¿¡æ¯ã€‚&lt;/strong&gt;&lt;br&gt;
å¯¹äºéç®¡é“çš„å‘½ä»¤ï¼Œå¯ä»¥ç®€å•çš„ä½¿ç”¨&lt;code&gt;$?&lt;/code&gt; æˆ–ä½¿ç”¨&lt;code&gt;if&lt;/code&gt; è¯­å¥ç›´æ¥æ£€æŸ¥è¿”å›å€¼ã€‚&lt;br&gt;
ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;if ! mv &amp;quot;${file_list}&amp;quot; &amp;quot;${dest_dir}/&amp;quot; ; then
  echo &amp;quot;Unable to move ${file_list} to ${dest_dir}&amp;quot; &amp;gt;&amp;amp;2
  exit &amp;quot;${E_BAD_MOVE}&amp;quot;
fi

# Or
mv &amp;quot;${file_list}&amp;quot; &amp;quot;${dest_dir}/&amp;quot;
if [[ &amp;quot;$?&amp;quot; -ne 0 ]]; then
  echo &amp;quot;Unable to move ${file_list} to ${dest_dir}&amp;quot; &amp;gt;&amp;amp;2
  exit &amp;quot;${E_BAD_MOVE}&amp;quot;
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Bash ä¹Ÿæœ‰ä¸€ä¸ª&lt;code&gt;PIPESTATUS&lt;/code&gt; çš„å˜é‡ï¼Œå¯ä»¥é€šè¿‡å®ƒæ£€æŸ¥ç®¡é“ä¸­å„éƒ¨åˆ†çš„è¿”å›å€¼ã€‚å¦‚æœä½ ä»…ä»…éœ€è¦æ£€æŸ¥æ•´æ¡ç®¡é“çš„æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥ï¼Œå¯ä»¥å‚è€ƒä¸‹åˆ—åšæ³•ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tar -cf - ./* | ( cd &amp;quot;${dir}&amp;quot; &amp;amp;&amp;amp; tar -xf - )
if [[ &amp;quot;${PIPESTATUS[0]}&amp;quot; -ne 0 || &amp;quot;${PIPESTATUS[1]}&amp;quot; -ne 0 ]]; then
  echo &amp;quot;Unable to tar files to ${dir}&amp;quot; &amp;gt;&amp;amp;2
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç„¶è€Œï¼Œå½“ä½ æ‰§è¡Œå…¶ä»–å‘½ä»¤å&lt;code&gt;PIPESTATUS&lt;/code&gt;å°±ä¼šè¢«è¦†ç›–ï¼Œå¦‚æœä½ éœ€è¦æ ¹æ®ç®¡é“ä¸­ä¸åŒéƒ¨åˆ†å‘ç”Ÿçš„é”™è¯¯æ‰§è¡Œä¸åŒçš„åŠ¨ä½œï¼Œä½ éœ€è¦åœ¨æ‰§è¡Œå®Œå‘½ä»¤ä¹‹åç«‹å³å°†&lt;code&gt;PIPESTATUS&lt;/code&gt; èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼ˆä¸è¦å¿˜è®° &lt;code&gt;[&lt;/code&gt; ä¹Ÿæ˜¯ä¸€ä¸ªå‘½ä»¤ï¼ŒæŠ¹é™¤&lt;code&gt;PIPESTATUS&lt;/code&gt;çš„å†…å®¹ï¼‰ã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;tar -cf - ./* | ( cd &amp;quot;${DIR}&amp;quot; &amp;amp;&amp;amp; tar -xf - )
return_codes=(${PIPESTATUS[*]})
if [[ &amp;quot;${return_codes[0]}&amp;quot; -ne 0 ]]; then
  do_something
fi
if [[ &amp;quot;${return_codes[1]}&amp;quot; -ne 0 ]]; then
  do_something_else
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;å†…å»ºå‘½ä»¤ vs å¤–éƒ¨å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;åœ¨é€‰æ‹©è°ƒç”¨å†…å»ºå‘½ä»¤è¿˜æ˜¯å¤–éƒ¨ç¨‹åºæ—¶ï¼Œé€‰æ‹©å†…å»ºå‘½ä»¤ã€‚&lt;/strong&gt;&lt;br&gt;
æˆ‘ä»¬æ¨èä½¿ç”¨&lt;a href="http://linux.die.net/man/1/bash"&gt;bash(1)&lt;/a&gt;ä¸­ã€ŒParameter Expansionã€éƒ¨åˆ†æåˆ°çš„å†…å»ºå‘½ä»¤ï¼Œå› ä¸ºå†…å»ºå‘½ä»¤æ›´åŠ å¯é å’Œå¯ç§»æ¤ï¼ˆç‰¹åˆ«æ˜¯å’Œsed ä¹‹ç±»çš„å‘½ä»¤ç›¸æ¯”ï¼‰ã€‚&lt;br&gt;
ä¾‹ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;# Prefer this:
addition=$((${X} + ${Y}))
substitution=&amp;quot;${string/#foo/bar}&amp;quot;

# Instead of this:
addition=&amp;quot;$(expr ${X} + ${Y})&amp;quot;
substitution=&amp;quot;$(echo &amp;quot;${string}&amp;quot; | sed -e &amp;#39;s/^foo/bar/&amp;#39;)&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å§‹ç»ˆéµå¾ªå¸¸è¯†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¯·èŠ±å‡ åˆ†é’Ÿé˜…è¯»&lt;a href="https://google.github.io/styleguide/cppguide.html"&gt;C++ Guide&lt;/a&gt; åº•éƒ¨çš„Parting Words éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸´åˆ«èµ è¨€&lt;/p&gt;
&lt;p&gt;å§‹ç»ˆéµå¾ªå¸¸è¯†ã€‚&lt;/p&gt;
&lt;p&gt;å½“ä½ ç¼–ç æ—¶ï¼ŒèŠ±å‡ åˆ†é’Ÿé˜…è¯»ä¸€ä¸‹å…¶ä»–ä»£ç ï¼Œå¹¶ç†Ÿæ‚‰å®ƒçš„é£æ ¼ã€‚å¦‚æœä»–ä»¬åœ¨if æ¡ä»¶ä»å¥ä¸­ä½¿ç”¨ç©ºæ ¼ï¼Œé‚£ä¹ˆä½ ä¹Ÿåº”è¯¥è¿™æ ·åšã€‚å¦‚æœä»–ä»¬çš„æ³¨é‡Šç”±æ˜Ÿå·ç»„æˆçš„ç›’å­å›´ç€ï¼Œé‚£ä¹ˆä½ ä¹Ÿåº”è¯¥è¿™æ ·åšã€‚  &lt;/p&gt;
&lt;p&gt;ç¼–ç¨‹é£æ ¼æŒ‡å—æ˜¯ä¸ºäº†æä¾›ä¸€ä¸ªé€šç”¨çš„ç¼–ç¨‹è§„èŒƒï¼Œä»¥ä¾¿äººä»¬å¯ä»¥é›†ä¸­ç²¾åŠ›åœ¨ç¼–ç å®ç°ä¸Šï¼Œè€Œä¸æ˜¯è€ƒè™‘ä»£ç å½¢å¼ä¸Šã€‚æˆ‘ä»¬å±•ç¤ºäº†æ•´ä½“ä¸Šçš„é£æ ¼è§„èŒƒï¼Œå¦å¤–å±€éƒ¨çš„é£æ ¼ä¹ŸåŒæ ·é‡è¦ã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªæ–‡ä»¶
ä¸­æ·»åŠ çš„ä»£ç çš„é£æ ¼å’ŒåŸæ¥çš„é£æ ¼å·®å¼‚å·¨å¤§ï¼Œå½“é˜…è¯»è¿™ä»½ä»£ç æ—¶ï¼Œæ•´ä½“çš„éŸµå‘³å°±è¢«ç ´åäº†ã€‚è¯·å°½é‡é¿å…è¿™æ ·åšã€‚&lt;/p&gt;
&lt;p&gt;å¥½äº†ï¼Œå…³äºç¼–ç¨‹é£æ ¼æŒ‡å—å†™çš„å¤Ÿå¤šäº†ï¼Œä»£ç æœ¬èº«æ›´åŠ æœ‰è¶£ã€‚å°½æƒ…äº«å—å§ï¼&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="2016"></category><category term="Shell"></category></entry><entry><title>é›†ç¾¤çš„NTP å¯¹æ—¶é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2016/2016-04-03.html" rel="alternate"></link><published>2016-04-03T22:55:30+08:00</published><updated>2016-04-03T22:55:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-04-03:/posts/2016/2016-04-03.html</id><summary type="html">&lt;h2&gt;NTP ç®€å•ä»‹ç»&lt;/h2&gt;
&lt;p&gt;NTP æ˜¯äº’è”ç½‘ä¸Šè®¾å¤‡ä¹‹é—´è¿›è¡Œå¯¹æ—¶çš„åè®®ï¼Œå¦‚ä¸‹å›¾æ‰€è¡¨ç¤ºï¼Œæœ‰å¤šå±‚NTP æœåŠ¡å™¨ï¼Œä¸‹æ¸¸æœåŠ¡å™¨å‘ä¸Šæ¸¸è¿›è¡Œå¯¹æ—¶ï¼ˆå¯ä»¥äº† â€¦&lt;/p&gt;</summary><content type="html">&lt;h2&gt;NTP ç®€å•ä»‹ç»&lt;/h2&gt;
&lt;p&gt;NTP æ˜¯äº’è”ç½‘ä¸Šè®¾å¤‡ä¹‹é—´è¿›è¡Œå¯¹æ—¶çš„åè®®ï¼Œå¦‚ä¸‹å›¾æ‰€è¡¨ç¤ºï¼Œæœ‰å¤šå±‚NTP æœåŠ¡å™¨ï¼Œä¸‹æ¸¸æœåŠ¡å™¨å‘ä¸Šæ¸¸è¿›è¡Œå¯¹æ—¶ï¼ˆå¯ä»¥äº†è§£ä¸€ä¸‹stratum å€¼ï¼‰ã€‚&lt;br&gt;
&lt;img alt="NTP" src="/assets/images/2023/20230301163444.png"&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‡è®¾ä¸Šæ¸¸çš„æœåŠ¡å™¨æ—¶é—´æ˜¯å¯é çš„ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯å°½é‡ä½¿æœ¬åœ°è®¡ç®—æœºæ—¶é—´å’Œä¸Šæ¸¸æœåŠ¡å™¨æ—¶é—´ä¸€è‡´ï¼ŒåŸç†å¦‚ä¸‹å›¾ï¼ˆå›¾ç‰‡æ¥è‡ªwikipediaï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="NTP-Algorithm" src="/assets/images/2023/20230301163455.png"&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;t0 æ˜¯å®¢æˆ·ç«¯å‘é€è¯·æ±‚åŒ…æ—¶çš„å®¢æˆ·ç«¯æ—¶é—´æˆ³ï¼›&lt;/li&gt;
&lt;li&gt;t1 æ˜¯æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åŒ…æ—¶çš„æœåŠ¡ç«¯æ—¶é—´æˆ³ï¼›&lt;/li&gt;
&lt;li&gt;t2 æ˜¯æœåŠ¡ç«¯å‘é€å“åº”åŒ…æ—¶çš„æœåŠ¡ç«¯æ—¶é—´æˆ³ï¼›&lt;/li&gt;
&lt;li&gt;t3 æ˜¯å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åŒ…æ—¶çš„å®¢æˆ·ç«¯æ—¶é—´æˆ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å‡è®¾æ•°æ®åŒ…ä¼ è¾“æ¥å›æ‰€èŠ±çš„æ—¶é—´ä¸€æ ·ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯ä¸»è¦çš„è¯¯å·®åŸå› ï¼‰ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¤„ç†æ•°æ®åŒ…çš„æ—¶é—´ä¸€è‡´ï¼Œ
é‚£ä¹ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ—¶é—´å·®å°±æ˜¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;(t1-t0)+(t2-t3)/2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç®€å•æ¨å¯¼ä¸‹å…¬å¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;è®¾æœåŠ¡ç«¯-å®¢æˆ·ç«¯æ—¶é—´å·®ä¸ºï¼šoffset
è®¾è¯·æ±‚åŒ…åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“æ—¶é—´ä¸ºï¼šs0
è®¾å“åº”åŒ…åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“æ—¶é—´ä¸º: s1

æŒ‰æ¡ä»¶å¾—ï¼š
t0 + s0 = t1 - offset  =&amp;gt; offset = t0 + s0 -t1
t2 + s1 = t3 + offset  =&amp;gt; offset = t3 - t2 -s1

=&amp;gt; offset = (t0 - t1 + t3 - t2 + s0 - s1)/2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœs0 - s1 = 0ï¼Œå³æ¥å›ä¼ è¾“åŒ…æ‰€è¯çš„æ—¶é—´ç›¸ç­‰ï¼Œé‚£ä¹ˆå¯¹æ—¶çš„è¯¯å·®ä¼šç›¸å¯¹æ¥è¯´å°ä¸€ç‚¹ï¼Œä½†æ˜¯åœ¨ä¸€äº›ç³Ÿç³•çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¾‹å¦‚ç§»åŠ¨ç½‘ç»œï¼Œè¿™ä¸ªä¼ è¾“æ—¶é—´å·®å¸¸å¸¸å¾ˆå¤§ï¼Œå‡ ç™¾æ¯«ç§’éƒ½æœ‰å¯èƒ½ï¼Œæ‰€ä»¥åœ¨é€‰æ‹©
ç§»åŠ¨ç«¯å¯¹æ—¶çš„æ–¹æ¡ˆæ—¶éœ€æ³¨æ„è¿™ä¸ªé—®é¢˜ã€‚  &lt;/p&gt;
&lt;p&gt;æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¼ è¾“æ¥å›æ‰€èŠ±çš„æ—¶é—´ä¸ºï¼š&lt;code&gt;( t3 - t0 ) - (t2 - t1)&lt;/code&gt;ã€‚&lt;br&gt;
è¿™ä¸ªæ—¶é—´åœ¨ntpd server é€‰æ‹©ä¸Šæ¸¸ntpd æœåŠ¡å™¨çš„ç®—æ³•ä¸­å¯ä½œä¸ºé‡è¦çš„è€ƒå¯ŸæŒ‡æ ‡ã€‚æˆ‘ä»¬çŸ¥é“å¦‚æœæ¥å›ä¼ è¾“æ€»çš„å»¶æ—¶å¢å¤§ï¼Œæ¥å›ä¼ è¾“æ•°æ®åŒ…æ‰€èŠ±æ—¶é—´å·®å€¼å¢å¤§çš„æ¦‚ç‡ä¹Ÿéšä¹‹å¢åŠ ã€‚&lt;br&gt;
å…³äºNTP åè®®çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://en.wikipedia.org/wiki/Network_Time_Protocol"&gt;Wikipedia:NTP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://www.eecis.udel.edu/~mills/ntp/html/warp.html"&gt;How NTP Works&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;æœåŠ¡å™¨å¯¹æ—¶è®¾ç½®&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦è€ƒè™‘çš„æ˜¯æœåŠ¡å™¨æ•´ä¸ªé›†ç¾¤æ—¶é—´ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œç„¶åæ‰æ˜¯æœåŠ¡å™¨æ—¶é—´å’Œæ ‡å‡†æ—¶é—´è¯¯å·®çš„é—®é¢˜ã€‚  &lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çŸ¥é“é›†ç¾¤å†…ç½‘çš„ç¯å¢ƒä¸€èˆ¬éƒ½æ¯”è¾ƒå¥½ï¼Œå³å¯ä»¥å‡å°‘ä¸Šæ–‡ä¸­çš„ ï¼ˆs1 -s0ï¼‰ çš„å·®ï¼Œæ‰€ä»¥æœ€å¥½çš„é€‰æ‹©æ˜¯åœ¨å†…ç½‘æ­å»ºNTP Serverï¼Œä¾›é›†ç¾¤å†…çš„æ‰€æœ‰æœåŠ¡å™¨ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ•´ä¸ªé›†ç¾¤å†…çš„æ—¶é—´ä¸€è‡´ã€‚&lt;br&gt;
&lt;strong&gt;æ³¨æ„ï¼šNTP Server æ²¡å¿…è¦æƒ…å†µä¸‹ä¸è¦æš´éœ²åœ¨å¤–ç½‘ï¼Œå¦‚æœéœ€è¦ç»™å¤–ç½‘è®¿é—®ï¼Œåšå¥½æˆæƒï¼Œé¿å…è¢«ä½œä¸ºNTP åå°„æ”»å‡»çš„å·¥å…·ã€‚&lt;/strong&gt;  &lt;/p&gt;
&lt;p&gt;è¿™å°NTP Server ä¹Ÿéœ€è¦ä¸Šæ¸¸åŒæ­¥æ—¶é—´ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª&lt;strong&gt;å‘&lt;/strong&gt;ï¼ŒLinux å¸¸ç”¨çš„ntpd ç¨‹åºåªä¼šåœ¨ntpd å¯åŠ¨æ—¶å»è§£æä¸Šæ¸¸æœåŠ¡å™¨çš„åŸŸåï¼Œå¦‚æœè¿™äº›ä¸Šæ¸¸çš„æœåŠ¡å™¨å®•æœºäº†ï¼Œæˆ–è€…æ›´æ”¹IP äº†ï¼Œä¸‹æ¸¸æ˜¯æ— æ³•ä¸»åŠ¨å‘ç°çš„ã€‚&lt;br&gt;
å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæ˜¯é…ç½®å¤šå‡ ä¸ª&lt;strong&gt;ä¼˜è´¨&lt;/strong&gt;çš„ä¸Šæ¸¸æœåŠ¡å™¨ï¼Œntpd æœ¬èº«å¯¹äºä¸Šæ¸¸æœåŠ¡å™¨æœ‰ä¸€ä¸ªé€‰æ‹©ç­–ç•¥ï¼Œå¯ä»¥é¿å…æŸå‡ ä¸ªä¸Šæ¸¸å®•æœºè€ŒåŒæ­¥ä¸åˆ°æ—¶é—´ã€‚å¯¹äºä¸Šæ¸¸çš„è¿™äº›æœåŠ¡å™¨æœ€å¥½é€‰æ‹©ntp.org å®˜æ–¹çš„ï¼Œæˆ–è€…çŸ¥åå‚å•†æˆ–è€…ç»„ç»‡çš„ï¼Œæ€»ä¹‹å°±æ˜¯æ±‚ç¨³å®šå’Œå¯é ï¼Œæ¶æ„çš„NTP æ•°æ®åŒ…å½±å“ä¸æ˜¯å°äº‹ã€‚åœŸè±ªå¯ä»¥è‡ªå·±ä¸Šç¡¬ä»¶æˆæ—¶çš„å·¥å…·äº†ï¼Œ23333ã€‚  &lt;br&gt;
å›½å†…å¸¸è§çš„NTP æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;é˜¿é‡Œï¼š
time1~7.aliyun.com
åˆ†åˆ«ä½äºé˜¿é‡ŒåŒ—ä¸Šæ·±æ­é’ä¸åŒçš„æœºæˆ¿ï¼Œä¸Šæ¸¸æ®è¯´æ˜¯GPS è¿˜æ˜¯åŒ—æ–—æˆæ—¶ï¼Œç›¸å¯¹å¯é ã€‚

ntp.org:
cn.pool.ntp.org, 0.asia.pool.ntp.org, 1.asia.pool.ntp.org
æ›´å¤šè¯·æŸ¥çœ‹ http://www.pool.ntp.org

ä¸Šæµ·äº¤å¤§ï¼š
ntp.sjtu.edu.cn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–ä¸€ä¸ªæªæ–½æ˜¯&lt;strong&gt;å®šæœŸé‡å¯å†…ç½‘NTP Server çš„è¿›ç¨‹&lt;/strong&gt;ã€‚&lt;br&gt;
é›†ç¾¤å†…çš„å…¶ä»–æœºå™¨çš„ntp è¿›ç¨‹ï¼Œntp.conf è®¾ç½®ä¼˜å…ˆä»å†…ç½‘NTP Server å¯¹æ—¶ã€‚å¦å¤–éœ€è¦è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨ï¼Œå¹¶å¯¹è¿›ç¨‹çŠ¶æ€åšå¥½ç›‘æ§ï¼ŒåŒæ—¶ä¹Ÿè®°å¾—æ§åˆ¶å¥½è¿™äº›ntp è¿›ç¨‹çš„å®‰å…¨ï¼Œç¦æ­¢å¤–ç½‘çš„æŸ¥è¯¢è¯·æ±‚ã€‚è¿™äº›æœºå™¨çš„ntp.conf å†…çš„ä¸Šæ¸¸æœåŠ¡å™¨å¯ä»¥é…ç½®æˆå’Œå†…ç½‘NTP Server ä¸€è‡´ï¼Œé˜²æ­¢å†…ç½‘NTP Server é•¿æ—¶é—´å®•æœºã€‚ã€‚ã€‚  &lt;/p&gt;
&lt;p&gt;å…¶ä»–å‚è€ƒè´¨æ–™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://linux.die.net/man/5/ntp.conf"&gt;man:ntp.conf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://haibing.org/64/%e7%94%9f%e4%ba%a7%e4%b8%8a%e7%9a%84ntp%e9%85%8d%e7%bd%aentp-conf/"&gt;ç”Ÿäº§ä¸Šçš„NTPé…ç½®ntp.conf&lt;/a&gt; &lt;/li&gt;
&lt;/ul&gt;</content><category term="2016"></category><category term="linux"></category><category term="ntp"></category></entry><entry><title>ä½¿ç”¨Systemd çš„Linux çš„å¯åŠ¨è¿‡ç¨‹</title><link href="https://fangpsh.github.io/posts/2016/2016-03-15.html" rel="alternate"></link><published>2016-03-15T11:55:30+08:00</published><updated>2016-03-15T11:55:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2016-03-15:/posts/2016/2016-03-15.html</id><summary type="html">&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯å›ç­”çŸ¥ä¹ä¸Šä¸€ä¸ªæœ‹å‹çš„é—®é¢˜ï¼š&lt;a href="https://www.zhihu.com/question/20880224"&gt;Systemd çš„è¯¦ç»†å¯åŠ¨è¿‡ç¨‹æ˜¯æ€æ ·çš„&lt;/a&gt; ã€‚&lt;br&gt;
å›ç­”è¿™ä¸ªé—®é¢˜å‰éœ€è¦äº†è§£ä¸€ä¸‹è®¡ç®—æœºçš„å¯åŠ¨è¿‡ç¨‹ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯å›ç­”çŸ¥ä¹ä¸Šä¸€ä¸ªæœ‹å‹çš„é—®é¢˜ï¼š&lt;a href="https://www.zhihu.com/question/20880224"&gt;Systemd çš„è¯¦ç»†å¯åŠ¨è¿‡ç¨‹æ˜¯æ€æ ·çš„&lt;/a&gt; ã€‚&lt;br&gt;
å›ç­”è¿™ä¸ªé—®é¢˜å‰éœ€è¦äº†è§£ä¸€ä¸‹è®¡ç®—æœºçš„å¯åŠ¨è¿‡ç¨‹å’ŒLinux çš„å¯åŠ¨è¿‡ç¨‹ï¼Œæ‰èƒ½å®Œæ•´ä¸²èµ·æ¥ã€‚
å…³äºè®¡ç®—æœºçš„å¯åŠ¨ï¼Œå¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹é˜®ä¸€å³°çš„æ–‡ç« ï¼š&lt;a href="http://www.ruanyifeng.com/blog/2013/02/booting.html"&gt;è®¡ç®—æœºæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Ÿ&lt;/a&gt;ï¼Œè¿™ç¯‡æ–‡ç« åœ¨ç³»ç»Ÿå¯åŠ¨éƒ¨åˆ†ï¼Œå¤§æ¦‚æåˆ°äº†Linux ç³»ç»Ÿçš„å¯åŠ¨ï¼Œ
ä¸è¿‡ä¸æ˜¯ååˆ†è¯¦ç»†ï¼Œå¯ä»¥å†çœ‹ä»–çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href="http://www.ruanyifeng.com/blog/2013/08/linux_boot_process.html"&gt;Linux çš„å¯åŠ¨è¿‡ç¨‹&lt;/a&gt;ï¼Œæ–‡ç« æ‰€ä»‹ç»çš„Init ç¨‹åºæ˜¯ä¼ ç»Ÿçš„Sysvã€‚
è€Œä½¿ç”¨Systemd çš„Linux ç³»ç»Ÿçš„å·®åˆ«å°±æ˜¯åœ¨ Init ç¨‹åºè¿™ä¸€é˜¶æ®µã€‚&lt;br&gt;
åœ¨åŠ è½½å†…æ ¸ä¹‹å‰çš„é˜¶æ®µï¼Œè¿™ç¯‡æ–‡ç« è®²çš„æŒºç»†ï¼Œå¯ä»¥é¡ºä¾¿è¯»ä¸€è¯»ï¼š&lt;a href="http://chrinux.blog.51cto.com/6466723/1192004"&gt;è¯¦è§£linuxç³»ç»Ÿçš„å¯åŠ¨è¿‡ç¨‹åŠç³»ç»Ÿåˆå§‹åŒ–&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;ç„¶åå¯ä»¥è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œå¯¹Systemd çš„åŸºç¡€ä»‹ç»ï¼Œéå¸¸ä¸é”™ï¼š&lt;a href="http://www.ibm.com/developerworks/cn/linux/1407_liuming_init3/index.html"&gt;æµ…æ Linux åˆå§‹åŒ– init ç³»ç»Ÿï¼Œç¬¬ 3 éƒ¨åˆ†: Systemd&lt;/a&gt;ï¼Œæ„Ÿè§‰IBM developerworks çš„æ–‡ç« è´¨é‡éƒ½æŒºä¸é”™çš„ã€‚  &lt;/p&gt;
&lt;p&gt;è™šæ‹Ÿæ–‡ä»¶ç³»ç»ŸInitrdï¼Œå¯åŠ¨åˆ°è¿™ä¸€æ­¥ä¹‹åï¼Œé€šè¿‡Switch-root è½¬åˆ° Init ç¨‹åºï¼Œå³Systemdï¼ˆä¹Ÿå¯ä»¥æ˜¯Sysv ä¹‹ç±»çš„ï¼‰ï¼Œåé¢å°±æ˜¯Systemd å¦‚ä½•å¯åŠ¨æœåŠ¡è¿›ç¨‹çš„é—®é¢˜ã€‚&lt;br&gt;
Initrd è¿™ä¸€æ­¥ï¼ŒSystemd å…¶å®ä¹Ÿå¯ä»¥æ¥ç®¡ï¼Œå…·ä½“å‚è€ƒï¼š&lt;a href="https://www.freedesktop.org/software/systemd/man/bootup.html#Bootup%20in%20the%20Initial%20RAM%20Disk%20(initrd)"&gt;initrd with systemd&lt;/a&gt;ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨ä¼ ç»Ÿçš„Sysv ä¸­ï¼Œæœ‰Runlevelï¼ˆå¯åŠ¨çº§åˆ«ï¼‰çš„æ¦‚å¿µï¼Œåœ¨Systemd é‡Œé¢æœ‰Target çš„æ¦‚å¿µï¼Œå¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="runlevel" src="/assets/images/2023/20230301161756.png"&gt;&lt;/p&gt;
&lt;p&gt;Systemd æœ‰ä¸ªå•å…ƒæ–‡ä»¶ï¼ˆUnitï¼‰çš„æ¦‚å¿µï¼Œå¯ä»¥ç†è§£æˆä¸€ä¸ªå•å…ƒæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæœåŠ¡å•å…ƒï¼Œæœ‰å¾ˆå¤šç±»å‹çš„å•å…ƒæ–‡ä»¶ï¼ŒMountã€Deviceã€Serviceã€Pathã€Timer ç­‰ï¼Œæœ€å¸¸è§çš„å°±æ˜¯Service å•å…ƒï¼š&lt;/p&gt;
&lt;p&gt;ä¾‹ï¼š/usr/lib/systemd/system/named.serviceï¼Œå…·ä½“çš„è§£é‡Šè¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[Unit]
Description=Berkeley Internet Name Domain (DNS)
Wants=nss-lookup.target
Wants=named-setup-rndc.service
Before=nss-lookup.target
After=network.target
After=named-setup-rndc.service

[Service]
Type=forking
EnvironmentFile=-/etc/sysconfig/named
Environment=KRB5_KTNAME=/etc/named.keytab
PIDFile=/run/named/named.pid

ExecStartPre=/usr/sbin/named-checkconf -z /etc/named.conf
ExecStart=/usr/sbin/named -u named $OPTIONS

ExecReload=/bin/sh -c &amp;#39;/usr/sbin/rndc reload &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 || /bin/kill -HUP $MAINPID&amp;#39;

ExecStop=/bin/sh -c &amp;#39;/usr/sbin/rndc stop &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 || /bin/kill -TERM $MAINPID&amp;#39;

PrivateTmp=true

[Install]
WantedBy=multi-user.target
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Target ä¹Ÿæ˜¯ä¸€ç§å•å…ƒæ–‡ä»¶ï¼Œä½†æ˜¯å®ƒæ˜¯å¼•ç”¨å’Œç»„ç»‡å…¶ä»–çš„å•å…ƒæ–‡ä»¶ï¼Œå®šä¹‰ç»„ç»‡å„ç§ä¾èµ–å…³ç³»ã€‚æ‰€ä»¥ï¼ŒTarget è‚¯å®šå¯ä»¥å®ç°Runlevel çš„ä½œç”¨ï¼Œåªè¦å®šä¹‰å…­ä¸ªTarget å°±å¯ä»¥äº†å˜›ã€‚
å†çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼Œå°±å¤§è‡´æ˜ç™½äº†å¯åŠ¨çš„æ—¶å€™æ˜¯æ€ä¹ˆåŠ è½½æœåŠ¡è¿›ç¨‹çš„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="bootup" src="/assets/images/2023/20230301161805.png"&gt;&lt;/p&gt;
&lt;p&gt;æ›´å¤šç»†èŠ‚ï¼Œä»¥åŠå…³æœºçš„è¿‡ç¨‹è¯·å‚è€ƒï¼š&lt;a href="https://www.freedesktop.org/software/systemd/man/bootup.html"&gt;bootup&lt;/a&gt;&lt;/p&gt;</content><category term="2016"></category><category term="Linux"></category><category term="Systemd"></category></entry><entry><title>Dockerä¸è™šæ‹Ÿæœºç­‰çš„SSHæƒé™ç®¡ç†æ§åˆ¶è§£å†³æ–¹æ¡ˆ</title><link href="https://fangpsh.github.io/posts/2015/2015-11-26.html" rel="alternate"></link><published>2015-11-26T15:59:00+08:00</published><updated>2015-11-26T15:59:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-11-26:/posts/2015/2015-11-26.html</id><summary type="html">&lt;p&gt;Dockerå’ŒVMä¸€ç±»çš„äº‘å¹³å°çš„æƒé™æ§åˆ¶å¦‚æœé‡‡ç”¨å¸¸è§çš„æ–¹å¼ï¼ŒæŠŠç™»å½•è€…çš„å…¬é’¥å†™å…¥&lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt;, ç”±äºä¼ä¸šå†…éƒ¨çš„äººå‘˜æµåŠ¨å’Œæƒé™å˜æ›´ï¼Œå¾€å¾€ä¸æ˜¯ååˆ†ä¾¿åˆ©ã€‚  &lt;/p&gt;
&lt;p&gt;ç‰¹åˆ«æ˜¯å¦‚æœè¿˜é€‰æ‹©æŠŠauthorized_keys æ‰“åˆ°é•œåƒ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;Dockerå’ŒVMä¸€ç±»çš„äº‘å¹³å°çš„æƒé™æ§åˆ¶å¦‚æœé‡‡ç”¨å¸¸è§çš„æ–¹å¼ï¼ŒæŠŠç™»å½•è€…çš„å…¬é’¥å†™å…¥&lt;code&gt;~/.ssh/authorized_keys&lt;/code&gt;, ç”±äºä¼ä¸šå†…éƒ¨çš„äººå‘˜æµåŠ¨å’Œæƒé™å˜æ›´ï¼Œå¾€å¾€ä¸æ˜¯ååˆ†ä¾¿åˆ©ã€‚  &lt;/p&gt;
&lt;p&gt;ç‰¹åˆ«æ˜¯å¦‚æœè¿˜é€‰æ‹©æŠŠauthorized_keys æ‰“åˆ°é•œåƒä¸­çš„è¯ï¼Œç®¡ç†èµ·æ¥å°±ä¼šååˆ†è›‹ç–¼ã€‚ä¸è¿‡å¯¹äºDockerè¿™ç§å®¹å™¨ï¼Œå¦‚æœè¿˜éœ€è¦å¼€å‘ç™»å½•è¿›å»è¿›è¡ŒDebugæˆ–è€…åšå…¶ä»–æ“ä½œçš„è¯ï¼Œå§¿åŠ¿ä¸Šå…¶å®æ˜¯ä¸å¯¹çš„ï¼Œä¸ç¬¦åˆå®ƒçš„è®¾è®¡å“²å­¦ï¼Œä½†æ˜¯æŒ‰ç…§ç›®å‰æ¥è§¦çš„å›½å†…ä½¿ç”¨Dockeråšå†…éƒ¨äº‘çš„å‚å•†æ¥çœ‹çš„è¯ï¼Œå¤§éƒ½æ˜¯æŠŠDockerå½“ä½œä¸€ä¸ªè½»é‡çº§çš„VMæ¥ç”¨è€Œå·²ï¼Œå¾ˆå¤šæ›´æ˜¯ä¸ºäº†ç”¨Dockerè€Œç”¨Dockerã€‚  &lt;/p&gt;
&lt;p&gt;è¿™æ˜¯é¢˜å¤–è¯ï¼Œå¦‚æœæ˜¯åœ¨ä¼ä¸šå†…éƒ¨çš„Serverï¼ˆDockerçš„å®¹å™¨ã€VMä»¥åŠç‰©ç†æœºï¼‰ï¼Œåº”è¯¥é€‰æ‹©å…¬å…±å¸å·ç™»å½•ï¼Œè€Œä¸æ˜¯ç»™æ¯ä¸ªå¼€å‘è€…æˆ–è€…è¿ç»´äººå‘˜éƒ½å¼€ä¸€ä¸ªä¸ªäººå¸å·ä¸Šå»æï¼Œè¿™æ ·ä¸ä»…ä¼šååˆ†æ··ä¹±ï¼Œè€Œä¸”å‘˜å·¥ç¦»èŒä¹‹ç±»çš„è¿˜å¥½å¸¦æ¥ä¸å°‘â€œé—ç•™é—®é¢˜â€ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸€ç§è§£å†³æ€è·¯æ˜¯é€šè¿‡ä¸€äº›é…ç½®ç®¡ç†å·¥å…·æ¥ç®¡ç†Serverçš„authorized_keysï¼Œä¾‹å¦‚Puppetã€SaltStackã€Ansibleç­‰ã€‚ä¸è¿‡è¿™éœ€è¦è¿ç»´äººè‚‰ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè€Œä¸”æƒé™è¿™ç§ä¸œè¥¿å˜æ›´å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥æ›´è¿›ä¸€æ­¥æ˜¯åœ¨è¿™äº›é…ç½®ç®¡ç†å·¥å…·åªæ˜¯è¿›è¡Œå¼€å‘ï¼Œæä¾›ä¸€ä¸ªWeb æœåŠ¡ä½œä¸ºæƒé™æ§åˆ¶å¹³å°ã€‚    &lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ç§è§£å†³æ€è·¯æ˜¯é€šè¿‡&lt;a href="/posts/2015/2015-01-05.html"&gt;OpenSSHçš„AuthorizedKeysCommandé€‰é¡¹&lt;/a&gt;ï¼Œè°ƒç”¨ä¸€ä¸ªè„šæœ¬ï¼Œä»è¿œç¨‹çš„æœåŠ¡å–å¾—æˆæƒç™»è€…çš„å…¬é’¥ï¼Œå…·ä½“åšæ³•å¯ä»¥å‚è€ƒå‰é¢é“¾æ¥çš„æ–‡ç« ã€‚  &lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœè¿œç«¯æƒé™ç®¡ç†çš„æœåŠ¡å®•æœºäº†ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªWeb æœåŠ¡ï¼ŒMySQL Serveræˆ–è€…LDAPï¼Œéƒ½å°†é€ æˆé€šè¿‡è¿™ç§æ–¹å¼æˆæƒçš„ç”¨æˆ·æ— æ³•ç™»å½•ï¼Œæ‰€ä»¥å¿…é¡»ä¿è¯è¯¥æœåŠ¡çš„ç¨³å®šæ€§ã€‚  &lt;/p&gt;
&lt;p&gt;å¦å¤–åº”è¯¥ç¦æ­¢æ‰rootç™»å½•ï¼Œå› ä¸ºAuthorizedKeysCommandæ˜¯ä½œç”¨äºæ‰€æœ‰ç”¨æˆ·ï¼ŒåŒ…æ‹¬rootç”¨æˆ·ã€‚å°†æ‰€æœ‰æƒé™æ”¾åœ¨ä¸€ä¸ªâ€œç¯®å­â€œé‡Œçš„è¯ï¼Œé™¤äº†å¾—ä¿è¯è¿™ä¸ªç¯®å­çš„ç¨³å®šæ€§ï¼Œè¿˜æœ‰å®‰å…¨æ€§ã€‚  &lt;/p&gt;
&lt;p&gt;é€šè¿‡å¼€å‘å®šåˆ¶åŒ–ä¸€ä¸ªWebæœåŠ¡ï¼Œå¯ä»¥åšæ›´å¤šäº‹æƒ…ï¼Œä¾‹å¦‚æ§åˆ¶å¸å·çš„æœ‰æ•ˆæœŸï¼Œæƒé™çš„æ‰¹é‡å¼€é€šç­‰ç­‰ã€‚  &lt;/p&gt;</content><category term="2015"></category><category term="SSH"></category></entry><entry><title>OpenGrok å®‰è£…éƒ¨ç½²ä¸æ·»åŠ LDAPéªŒè¯</title><link href="https://fangpsh.github.io/posts/2015/2015-11-24.html" rel="alternate"></link><published>2015-11-25T15:09:00+08:00</published><updated>2015-11-25T15:09:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-11-25:/posts/2015/2015-11-24.html</id><summary type="html">&lt;p&gt;å…¬å¸åŒäº‹æœ‰é˜…è¯»ä»£ç çš„éœ€æ±‚ï¼Œå°è¯•éƒ¨ç½²äº†ä¸€ä¸ªOpenGrokï¼Œå®‰è£…è¿‡ç¨‹å‚è€ƒè¿™ç¯‡Blogï¼Œéå¸¸è¯¦ç»†ï¼š&lt;a href="http://ox0spy.github.io/opengrok/2013/08/14/setup-opengrok/"&gt;OpenGrokå®‰è£…ä½¿ç”¨æŒ‡å—&lt;/a&gt;ï¼Œ&lt;br&gt;
æˆ–è€…ç›´æ¥çœ‹å®˜æ–¹Wiki: &lt;a href="https://github.com/OpenGrok/OpenGrok/wiki/How-to-install-OpenGrok"&gt;How to install OpenGrok&lt;/a&gt; ã€‚&lt;br&gt;
é‡åˆ°ä¸¤ä¸ª â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å…¬å¸åŒäº‹æœ‰é˜…è¯»ä»£ç çš„éœ€æ±‚ï¼Œå°è¯•éƒ¨ç½²äº†ä¸€ä¸ªOpenGrokï¼Œå®‰è£…è¿‡ç¨‹å‚è€ƒè¿™ç¯‡Blogï¼Œéå¸¸è¯¦ç»†ï¼š&lt;a href="http://ox0spy.github.io/opengrok/2013/08/14/setup-opengrok/"&gt;OpenGrokå®‰è£…ä½¿ç”¨æŒ‡å—&lt;/a&gt;ï¼Œ&lt;br&gt;
æˆ–è€…ç›´æ¥çœ‹å®˜æ–¹Wiki: &lt;a href="https://github.com/OpenGrok/OpenGrok/wiki/How-to-install-OpenGrok"&gt;How to install OpenGrok&lt;/a&gt; ã€‚&lt;br&gt;
é‡åˆ°ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯å¯¼å…¥äº†å¾ˆå¤šé¡¹ç›®ä¹‹åï¼Œå¯¹å¤šä¸ªé¡¹ç›®è¿›ä¿®æ£€ç´¢çš„æ—¶å€™å‡ºç°äº†é”™è¯¯"Error parsing HTTP request header"ï¼Œé”™è¯¯ç 400ã€‚è¿™æ˜¯ç”±äºé€‰æ‹©å¤šä¸ªé¡¹ç›®æ—¶ï¼Œå¯¼è‡´HTTP å¤´ç‰¹åˆ«å¤§ï¼Œè¶…å‡ºäº†é™åˆ¶ï¼Œä¿®æ”¹ä¸€ä¸‹app/tomcat/conf/server.xmlï¼ŒæŒ‡å®šä¸‹maxHTTPSize:  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;Connector port=&amp;quot;8080&amp;quot; protocol=&amp;quot;HTTP/1.1&amp;quot;
           connectionTimeout=&amp;quot;20000&amp;quot;
           maxHttpHeaderSize=&amp;quot;65536&amp;quot;
           redirectPort=&amp;quot;8443&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯LDAPæ”¯æŒçš„é—®é¢˜ï¼Œéœ€è¦æ”¯æŒLDAPéªŒè¯ï¼ŒGoogleäº†ä¸€ä¸‹ï¼Œä¸å°‘è§£å†³æ–¹æ³•ï¼Œä¸è¿‡éƒ½æ˜¯æŠ„æ¥æŠ„å»ï¼Œè€Œä¸”ç”±äºä¸ªäººå¯¹Tomcatä¸ç†Ÿæ‚‰ï¼Œæœ€åæ‰¾äº†ä¸€ä¸ªç®€å•çš„æ–¹æ³•ï¼Œç¼–è¾‘server.html,ä¹ŸHOSTæ ‡ç­¾ä¹‹é—´æ’å…¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;Realm className=&amp;quot;org.apache.catalina.realm.JNDIRealm&amp;quot;
               debug=&amp;quot;99&amp;quot;
               connectionURL=&amp;quot;ldap://&amp;quot;
               userPattern=&amp;quot;cn={0}, ou=XXX,dc=XXX,dc=XXX&amp;quot;
/&amp;gt;
&amp;lt;/Realm&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–æŠŠåŸæœ‰çš„ä¸€ä¸ªRealmå—æ³¨é‡Šæ‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;!--
        &amp;lt;Realm className=&amp;quot;org.apache.catalina.realm.UserDatabaseRealm&amp;quot;
               resourceName=&amp;quot;UserDatabase&amp;quot;/&amp;gt;
        &amp;lt;/Realm&amp;gt;
--&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ•ˆæœå¦‚ä¸‹ï¼ŒåŸºæœ¬çš„HTTP Authenticationå¯¹è¯æ¡†ï¼š  &lt;/p&gt;
&lt;p&gt;&lt;img alt="opengrok_ldap" src="/assets/images/2023/20230302145512.png"&gt;  &lt;/p&gt;</content><category term="2015"></category><category term="OpenGrok"></category><category term="LDAP"></category></entry><entry><title>é‡æ¸© IPv6</title><link href="https://fangpsh.github.io/posts/2015/2015-09-13.html" rel="alternate"></link><published>2015-09-13T21:48:00+08:00</published><updated>2015-09-13T21:48:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-09-13:/posts/2015/2015-09-13.html</id><summary type="html">&lt;p&gt;&lt;img alt="ipv6" src="/assets/images/2023/20230302145336.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»Šæ™šåœ¨&lt;a href="https://v2ex.com/t/220352"&gt;è¯¥å¸–å­&lt;/a&gt;ä¸­è§åˆ°ç½‘å‹è¯´ å¡å°”çš„ipv6æœåŠ¡å®é™…ä¸ŠåŒ…çš„openvpnï¼Œè™½ç„¶å®˜æ–¹åªæä¾›äº†Windowsä¸‹çš„å®‰è£…åŒ…ï¼Œé‚£å²‚ä¸æ˜¯å¯ä»¥æ‹¿å‡ºå¯†é’¥æ–‡ä»¶å’Œé…ç½®ç­‰ï¼Œåœ¨Linuxæˆ–è€…OSXä¸Šç©ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åˆ°å…­å¹´çº§çš„&lt;a href="http://6nianji.cn/"&gt;å®˜ç½‘ â€¦&lt;/a&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="ipv6" src="/assets/images/2023/20230302145336.png"&gt;&lt;/p&gt;
&lt;p&gt;ä»Šæ™šåœ¨&lt;a href="https://v2ex.com/t/220352"&gt;è¯¥å¸–å­&lt;/a&gt;ä¸­è§åˆ°ç½‘å‹è¯´ å¡å°”çš„ipv6æœåŠ¡å®é™…ä¸ŠåŒ…çš„openvpnï¼Œè™½ç„¶å®˜æ–¹åªæä¾›äº†Windowsä¸‹çš„å®‰è£…åŒ…ï¼Œé‚£å²‚ä¸æ˜¯å¯ä»¥æ‹¿å‡ºå¯†é’¥æ–‡ä»¶å’Œé…ç½®ç­‰ï¼Œåœ¨Linuxæˆ–è€…OSXä¸Šç©ï¼Ÿ&lt;/p&gt;
&lt;p&gt;åˆ°å…­å¹´çº§çš„&lt;a href="http://6nianji.cn/"&gt;å®˜ç½‘&lt;/a&gt;æ³¨å†Œï¼Œè´­ä¹°ä¸ªäººå…è´¹å¥—é¤ï¼Œé‚®ç®±ä¼šæ”¶åˆ°ä¸»é¢˜ä¸º"New Account Informationâ€çš„é‚®ä»¶ï¼Œè®°ä¸‹Usernameï¼ˆå³ä¸ªäººæ³¨å†Œçš„é‚®ç®±åœ°å€ï¼‰å’Œå®˜ç½‘ç”Ÿæˆçš„Passwordï¼Œåç»­ç”¨äºç™»å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹è½½å…­å¹´çº§å®¢æˆ·ç«¯ï¼Œè¿è¡Œå®‰è£…ï¼Œåˆ°å®‰è£…ç›®å½•ï¼ˆé»˜è®¤ä¸º C:/Program/å…­å¹´çº§ï¼‰å¯è§åˆ°ä¸€ä¸ªLinkæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­çš„éƒ¨åˆ†å†…å®¹å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œæ‹·è´å‡ºæ¥å¤‡ç”¨ï¼Œdllå’Œexeæ–‡ä»¶ä¸éœ€è¦ã€‚ï¼ˆæ³¨ï¼šä¹Ÿå¯ä»¥ä¸æ‹·è´ï¼Œè€Œå¤åˆ¶æˆ‘ä¸‹æ–‡ä¸­æä¾›çš„ï¼‰&lt;/p&gt;
&lt;p&gt;ä»¥OSXä¸ºä¾‹ï¼Œå®‰è£…openvpnï¼Œè¿‡ç¨‹è§ &lt;a href="https://fangpsh.com/post/2015/07/30/"&gt;ä¸€é”®è¿æ¥VPN&lt;/a&gt;ï¼Œæˆ‘å°†Linkä¸‹çš„é…ç½®æ‹·è´è‡³ &lt;code&gt;/usr/local/etc/openvpn/6nianji&lt;/code&gt; æ–‡ä»¶å¤¹ä¸­ï¼ŒåŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶åï¼šca.crt&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;-----BEGIN CERTIFICATE-----
MIIDKDCCAhCgAwIBAgIJAOOXJkeu5LvtMA0GCSqGSIb3DQEBCwUAMBIxEDAOBgNV
BAMTB25ld3RlY2gwHhcNMTQxMTI2MDYxMDMwWhcNMjQxMTIzMDYxMDMwWjASMRAw
DgYDVQQDEwduZXd0ZWNoMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA
xM1rbqQO9S28ynpPB4Ch78Mb/Olkr+4VWm6X9B/Aqx5x8RgZoldFJsTBTIUHiWk8
lQdtpNU++QdXqqO6RL943lrXHC9qTvxKtp44DpeXETOfozDxexIHc7S1zRTjbmZZ
5yRlLhXPR6dpzH0fLDgINTk341n+jS4zGAoBcseiqlRPBDJQXOmhvWKfGPMD5SeI
fpKsDTcVwLDj1k8rhwy58MwW/5mDtUp0ykgC3N/Crn6QGJ+SZMsNR1rfXPs8qchM
nI/MXJjyDUi+f0PTRH9RsniHOg5p9X2ldXWLBkbASOP7gesokd6pu6TkkKYRM5eQ
/DkyEo+DLShQY67FoAvlOQIDAQABo4GAMH4wHQYDVR0OBBYEFMxRMcMG/1Q85ISL
2VrGk7P0zK+oMEIGA1UdIwQ7MDmAFMxRMcMG/1Q85ISL2VrGk7P0zK+ooRakFDAS
MRAwDgYDVQQDEwduZXd0ZWNoggkA45cmR67ku+0wDAYDVR0TBAUwAwEB/zALBgNV
HQ8EBAMCAQYwDQYJKoZIhvcNAQELBQADggEBAD7iHWOU2vrsT7a8k1F1VDs1dBCh
JEskfeT5U+/asby5J7GTaitqlKMbPqYKxf3VLdlibLgMUW8EpwI0OvYrBJHJGx70
RwW+glO7gqiKmWJcF3DGDHQxcHej4PHKeve+qhtlalTK38GTmI0RFu+lE4Qp1zMA
LcasWST4iboGvaAgOC6ZJe+MsMwV9aTOvMMM4TROh+2ipe6hxtiFH8UBR1WR4gdG
MIiqaZss4capsogETnIeACL+eeOQrVzyG3DEuuy5taw+Zl8XDIRdbOBX8/3oLG0x
o8IHc24ag59MqOttUQU1FFnGwpm5GOAbudMv7v0PNizsfZYdR5ALLjY9n9M=
-----END CERTIFICATE-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ–‡ä»¶åï¼šta.key&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#
# 2048 bit OpenVPN static key
#
-----BEGIN OpenVPN Static key V1-----
a7254f6cdfc1425382b939d777174b52
45e2d5253e3688db2a6e5e5b7e996d99
78210eeb95a7ddad7c2176e63b9ed492
db08cdbb276be3e387f8556a8ab555b3
67c2bc9deb086af5df3e60f15b4fd13b
aa94f6f86c6c3147abe9e700f0b0c17f
ba53a933d6926f3a4ac5b104b2eed07c
e009d3b41b1637f638c537d3d6ef9ea7
4c8cd58cff6dfab30384cf9efc23fb3d
b62f77ffbbacd7d6b2c7e21986e69f02
244bac63c94970b097006ac04b62dac0
e974025f7203e9a4fac977f902291234
f405f71f00ac2b6f7ebc41f99b96f8ca
28b3bb7b7f984da1198aafa2e766926d
13674e1e80afdc1d08c7454d42244258
5da5f8cc31eca36999010c14a433f454
-----END OpenVPN Static key V1-----
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ–‡ä»¶åï¼šclient.ovpn&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;client
dev tap
proto udp
remote vpnsrv1.cernewtech.com 80
remote vpnsrv2.cernewtech.com 80
resolv-retry infinite
persist-key
persist-tun
ca /usr/local/etc/openvpn/6nianji/ca.crt
comp-lzo
up /usr/local/etc/openvpn/6nianji/tap-up-down.sh
down /usr/local/etc/openvpn/6nianji/tap-up-down.sh
auth-user-pass /usr/local/etc/openvpn/6nianji/pass
verb 3
mute 20
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;client.ovpn é…ç½®æ–‡ä»¶ä¸­çš„ auth-user-pass æ‰§è¡Œçš„passæ–‡ä»¶ä¸»è¦è®°å½•ä½ çš„ä¸ªäººç”¨æˆ·åå’Œå¯†ç ï¼Œç”¨äºç™»å½•éªŒè¯ï¼Œ&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶åï¼špass #å¡«å†™ä¸Šæ–‡é‚®ä»¶ä¸­çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå„ä¸€è¡Œã€‚ä½ ä¸æƒ³æ¯æ¬¡éƒ½æ‰‹åŠ¨è¾“å…¥è´¦æˆ·å’Œå¯†ç å§ï¼Ÿ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;username 
password 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨æˆ‘ä¸€å¼€å§‹ç›´æ¥æ‹·è´linkä¸‹çš„æ–‡ä»¶è¿‡æ¥ç™»å½•çš„æ—¶å€™ï¼Œé‡åˆ°è¿‡ &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;write to TUN/TAP : Input/output error (code=5)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;çš„é”™è¯¯ï¼ŒæŸ¥çœ‹äº† tap0è®¾å¤‡çš„çŠ¶æ€ï¼Œå‘ç°æ²¡æœ‰upã€‚ã€‚å›§ã€‚ç½‘ç»œä¸Šæ‰¾äº†ä¸€ä¸ª&lt;a href="http://www.mccambridge.org/blog/2007/10/correct-way-to-set-up-openvpn-client-on-mac-os-x/"&gt;è„šæœ¬&lt;/a&gt;ï¼Œå°±æ˜¯client.ovpnä¸­ upå’ŒdownæŒ‡å®šçš„è„šæœ¬ï¼Œ&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶åï¼štap-up-down.sh&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;#!/bin/sh&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# openvpn-tap-up-down.sh&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# A script to be used as an OpenVPN bridged (tap) up/down script on Mac OSX 10.4&lt;/span&gt;
&lt;span class="c1"&gt;# - uses ipconfig to acquire a DHCP lease via the OpenVPN tap interface, and scutil to&lt;/span&gt;
&lt;span class="c1"&gt;#  incorporate the DHCP-supplied DNS configuration&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# Use in your OpenVPN config file as follows:&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;#    up  openvpn-tap-up-down.sh&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# - up: openvpn calls the &amp;#39;up&amp;#39; script after the tun/tap interface is created, but before the link&lt;/span&gt;
&lt;span class="c1"&gt;#   to the server is available for use (ditto &amp;#39;up-delay&amp;#39; at least for UDP)&lt;/span&gt;
&lt;span class="c1"&gt;#   - on testing w/ openvpn 2.0.5, and tcpdump on the tap interface as soon as it comes up,&lt;/span&gt;
&lt;span class="c1"&gt;#     packets are queued up on the interface (and not actually sent over the openvpn tunnel)&lt;/span&gt;
&lt;span class="c1"&gt;#     until *after* this script returns; this makes sense: this script could fail in which&lt;/span&gt;
&lt;span class="c1"&gt;#     case the connection is invalid&lt;/span&gt;
&lt;span class="c1"&gt;#     - this means the DHCP acquisition can&amp;#39;t complete until after this script exits&lt;/span&gt;
&lt;span class="c1"&gt;#     - that&amp;#39;s not directly a problem as the OS X DHCP client should do everything we need&lt;/span&gt;
&lt;span class="c1"&gt;#       to make the interface functional, all by itself - *except* for one small thing: as of&lt;/span&gt;
&lt;span class="c1"&gt;#       OS X 10.4.7 the DHCP-acquired DNS information is not &amp;quot;merged&amp;quot; into the System&lt;/span&gt;
&lt;span class="c1"&gt;#       Configuration (OS X bug?)&lt;/span&gt;
&lt;span class="c1"&gt;#       - thus we have a chicken-and-egg situation: we need to manually fixup the DNS config,&lt;/span&gt;
&lt;span class="c1"&gt;#         but can&amp;#39;t until we get the DHCP lease; we won&amp;#39;t get the lease until we this script exits&lt;/span&gt;
&lt;span class="c1"&gt;#       - the solution is to spawn a little &amp;quot;helper&amp;quot; that waits until the lease is acquired,&lt;/span&gt;
&lt;span class="c1"&gt;#         and then does the DNS fixup&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# - down: the only sensible &amp;#39;down&amp;#39; action is to release the DHCP lease (as a courtesy to the&lt;/span&gt;
&lt;span class="c1"&gt;#   DHCP server), alas it&amp;#39;s too late to do this *after* the connection has been shutdown (as&lt;/span&gt;
&lt;span class="c1"&gt;#   of OpenVPN 2.0 there&amp;#39;s no &amp;quot;pre-disconnect&amp;quot; script option; note that both &amp;#39;down&amp;#39; and&lt;/span&gt;
&lt;span class="c1"&gt;#   &amp;#39;down-pre&amp;#39; are called only after the connection to the server is closed (&amp;#39;down-pre&amp;#39; before&lt;/span&gt;
&lt;span class="c1"&gt;#   closing the tun/tap device, &amp;#39;down&amp;#39; after)&lt;/span&gt;
&lt;span class="c1"&gt;#   - OS X automatically cleans up the System Config keys created from ipconfig, but we need to&lt;/span&gt;
&lt;span class="c1"&gt;#     manually remove the DNS fixup&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# 2006-09-21    Ben Low    original&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="c1"&gt;# 200x-xx-xx    name&lt;/span&gt;
&lt;span class="c1"&gt;#&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-z&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dev&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt;: \$dev not defined, exiting&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="c1"&gt;# relevant script_type values are &amp;#39;up&amp;#39; or &amp;#39;down&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;case&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$script_type&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;up&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;# bring the interface up and set it to DHCP&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;# - System Configuration dynamic store will be automatically updated, with the&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;#       State:/Network/Service/DHCP-tap0&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;#   data store created.&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;# - the ipconfig man page notes that it should only be used for &amp;quot;test and debug&amp;quot; purposes,&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;#   and that you&amp;#39;re supposed to use the SystemConfiguration APIs to manipulate the network&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;#   configuration&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;#   - alas, there appears to be no CLI utility other than ipconfig&lt;/span&gt;

&lt;span class="w"&gt;     &lt;/span&gt;/usr/sbin/ipconfig&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dev&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;DHCP
&lt;span class="w"&gt;     &lt;/span&gt;/usr/sbin/ipconfig&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dev&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;AUTOMATIC-V6
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;# spawn our little DNS-fixerupper&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# whilst ipconfig will have created the neccessary Network Service keys, the DNS&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# settings won&amp;#39;t actually be used by OS X unless the SupplementalMatchDomains key&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# is added&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# ref. &amp;lt;http://lists.apple.com/archives/Macnetworkprog/2005/Jun/msg00011.html&amp;gt;&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# - is there a way to extract the domains from the SC dictionary and re-insert&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;#   as SupplementalMatchDomains? i.e. not requiring the ipconfig domain_name call?&lt;/span&gt;

&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# - wait until we get a lease before extracting the DNS domain name and merging into SC&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# - despite it&amp;#39;s name, ipconfig waitall doesn&amp;#39;t (but maybe one day it will :-)&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;/usr/sbin/ipconfig&lt;span class="w"&gt; &lt;/span&gt;waitall

&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="c1"&gt;# usually takes at least a few seconds to get a DHCP lease&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;sleep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;
&lt;span class="w"&gt;                  &lt;/span&gt;&lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-z&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$domain_name&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-a&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-lt&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="w"&gt;             &lt;/span&gt;sleep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$n&lt;/span&gt;
&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="nv"&gt;n&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;expr&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$n&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;+&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="w"&gt;             &lt;/span&gt;&lt;span class="nv"&gt;domain_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;/usr/sbin/ipconfig&lt;span class="w"&gt; &lt;/span&gt;getoption&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$dev&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;domain_name&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;/dev/null&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="k"&gt;done&lt;/span&gt;

&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$domain_name&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;/usr/sbin/scutil&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;&amp;lt;&amp;lt;EOF&lt;/span&gt;
&lt;span class="s"&gt;d.init&lt;/span&gt;
&lt;span class="s"&gt;get State:/Network/Service/DHCP-$dev/DNS&lt;/span&gt;
&lt;span class="s"&gt;d.add SupplementalMatchDomains * $domain_name&lt;/span&gt;
&lt;span class="s"&gt;set State:/Network/Service/DHCP-$dev/DNS&lt;/span&gt;
&lt;span class="s"&gt;EOF&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;down&lt;span class="o"&gt;)&lt;/span&gt;

&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="c1"&gt;# for completeness...&lt;/span&gt;
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;/usr/bin/id&lt;span class="w"&gt; &lt;/span&gt;-u&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-eq&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;         &lt;/span&gt;/usr/sbin/ipconfig&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dev&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;NONE
&lt;span class="w"&gt;     &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="w"&gt;   &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="w"&gt;   &lt;/span&gt;*&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt;: invalid script_type&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="k"&gt;esac&lt;/span&gt;

&lt;span class="c1"&gt;##### FIN&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸è¿‡å¦‚æœç›´æ¥ç”¨è¿™å“¥ä»¬æä¾›çš„è„šæœ¬ï¼Œä¼šå‘ç°tap0å¹¶æ²¡æœ‰åˆ†é…åˆ°ipv6åœ°å€ï¼Œæ‰€ä»¥ä¸Šæ–‡ä¸­æˆ‘åŠ ä¸Šäº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="w"&gt;     &lt;/span&gt;/usr/sbin/ipconfig&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$dev&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;AUTOMATIC-V6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¸ªæ—¶å€™æ‰§è¡Œopenvpnç™»å½•ï¼Œå¯ä»¥ä¼šå‡ºç°ä»¥ä¸‹WARNINGï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;WARNING: External program may not be called unless &amp;#39;--script-security 2&amp;#39; or higher is enabled. See --help text or man page for detailed info.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‚£å°±æŒ‰ç…§æä¾› --script-security 2 é€‰é¡¹å’¯ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;/usr/local/sbin/openvpn&lt;span class="w"&gt;  &lt;/span&gt;--config&lt;span class="w"&gt; &lt;/span&gt;/usr/local/etc/openvpn/6nianji/client.ovpn&lt;span class="w"&gt; &lt;/span&gt;--script-security&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åšä¸ªç®€çŸ­çš„aliaså§ã€‚&lt;/p&gt;
&lt;p&gt;è´´ä¸‹ç™»å½•çš„æ—¥å¿—ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;âœ  ~  sudo /usr/local/sbin/openvpn  --config /usr/local/etc/openvpn/6nianji/client.ovpn --script-security 2
Sun Sep 13 22:20:34 2015 OpenVPN 2.3.7 x86_64-apple-darwin14.4.0 [SSL (OpenSSL)] [LZO] [MH] [IPv6] built on Jul 30 2015
Sun Sep 13 22:20:34 2015 library versions: OpenSSL 1.0.2d 9 Jul 2015, LZO 2.09
Sun Sep 13 22:20:34 2015 WARNING: file &amp;#39;/usr/local/etc/openvpn/6nianji/pass&amp;#39; is group or others accessible
Sun Sep 13 22:20:34 2015 WARNING: No server certificate verification method has been enabled.  See http://openvpn.net/howto.html#mitm for more info.
Sun Sep 13 22:20:34 2015 NOTE: the current --script-security setting may allow this configuration to call user-defined scripts
Sun Sep 13 22:20:34 2015 Socket Buffers: R=[196724-&amp;gt;65536] S=[9216-&amp;gt;65536]
Sun Sep 13 22:20:34 2015 UDPv4 link local (bound): [undef]
Sun Sep 13 22:20:34 2015 UDPv4 link remote: [AF_INET]121.194.13.130:80
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS: Initial packet from [AF_INET]121.194.13.130:80, sid=8b7c1075 4b39cd60
Sun Sep 13 22:20:35 2015 WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent this
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 VERIFY OK: depth=1, CN=newtech
Sun Sep 13 22:20:35 2015 VERIFY OK: depth=0, CN=newtech-BJ
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 TLS Error: local/remote TLS keys are out of sync: [AF_INET]121.194.13.130:80 [0]
Sun Sep 13 22:20:35 2015 Data Channel Encrypt: Cipher &amp;#39;BF-CBC&amp;#39; initialized with 128 bit key
Sun Sep 13 22:20:35 2015 Data Channel Encrypt: Using 160 bit message hash &amp;#39;SHA1&amp;#39; for HMAC authentication
Sun Sep 13 22:20:35 2015 Data Channel Decrypt: Cipher &amp;#39;BF-CBC&amp;#39; initialized with 128 bit key
Sun Sep 13 22:20:35 2015 Data Channel Decrypt: Using 160 bit message hash &amp;#39;SHA1&amp;#39; for HMAC authentication
Sun Sep 13 22:20:35 2015 Control Channel: TLSv1, cipher TLSv1/SSLv3 DHE-RSA-AES256-SHA, 2048 bit RSA
Sun Sep 13 22:20:35 2015 [newtech-BJ] Peer Connection Initiated with [AF_INET]121.194.13.130:80
Sun Sep 13 22:20:37 2015 SENT CONTROL [newtech-BJ]: &amp;#39;PUSH_REQUEST&amp;#39; (status=1)
Sun Sep 13 22:20:37 2015 PUSH: Received control message: &amp;#39;PUSH_REPLY,route-gateway dhcp,ping 10,ping-restart 120&amp;#39;
Sun Sep 13 22:20:37 2015 OPTIONS IMPORT: timers and/or timeouts modified
Sun Sep 13 22:20:37 2015 OPTIONS IMPORT: route-related options modified
Sun Sep 13 22:20:37 2015 TUN/TAP device /dev/tap0 opened
Sun Sep 13 22:20:37 2015 /usr/local/etc/openvpn/6nianji/tap-up-down.sh tap0 1500 1574   init
Sun Sep 13 22:20:37 2015 Initialization Sequence Completed
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿˜æœ‰ä¸€äº›é”™è¯¯å’Œè­¦å‘Šï¼Œä¸è¿‡å·²ç»å¯ä»¥æ­£å¸¸è®¿é—®IPv6ç½‘ç«™ï¼Œå…ˆå¿½ç•¥äº†ã€‚
Googleçš„å„é¡¹æœåŠ¡ç§’å¼€äº†ï¼Œå¯æƒœå…­ç»´å·²ç»æ‰“ä¸å¼€äº†ï¼Œå¬è¯´é™åˆ¶ä¸œåŒ—å¤§å­¦æ ¡å†…è®¿é—®äº†ï¼Œåªèƒ½å»äº¤å¤§çš„æ™¨å…‰PTçœ‹çœ‹ã€‚&lt;/p&gt;
&lt;p&gt;å‘¨æœ«ç»“æŸäº†ï¼Œæ„Ÿå†’è¿˜æ²¡å¥½ï¼Œå¸Œæœ›æ˜å¤©åŒ—äº¬å¤©æ°”ä¾æ—§å¥½å§ã€‚&lt;/p&gt;</content><category term="2015"></category><category term="IPv6"></category></entry><entry><title>ä¸€é”®è¿æ¥VPN</title><link href="https://fangpsh.github.io/posts/2015/2015-07-30.html" rel="alternate"></link><published>2015-07-30T22:00:00+08:00</published><updated>2015-07-30T22:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-07-30:/posts/2015/2015-07-30.html</id><summary type="html">&lt;p&gt;å…¬å¸å®‰å…¨çš„åŒäº‹æœ€è¿‘ç»™OpenVPNåŠ ä¸Šäº†åŸºäºGoogle Authenticatorçš„äºŒæ­¥éªŒè¯ï¼Œå¯†ç æ˜¯ã€Œå¸¸ç”¨å¯†ç ã€+ã€Œæ¯æ¬¡å˜åŒ–çš„Tokenã€ï¼Œæ¯æ¬¡åœ¨å¤–è¾¹æƒ³åšäº‹éƒ½å¾—æ‰“å¼€æ‰‹æœºæŸ¥çœ‹Tokenï¼Œè¾“å…¥å¯†ç ä¸²ï¼Œå®‰å…¨æ˜¯ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å…¬å¸å®‰å…¨çš„åŒäº‹æœ€è¿‘ç»™OpenVPNåŠ ä¸Šäº†åŸºäºGoogle Authenticatorçš„äºŒæ­¥éªŒè¯ï¼Œå¯†ç æ˜¯ã€Œå¸¸ç”¨å¯†ç ã€+ã€Œæ¯æ¬¡å˜åŒ–çš„Tokenã€ï¼Œæ¯æ¬¡åœ¨å¤–è¾¹æƒ³åšäº‹éƒ½å¾—æ‰“å¼€æ‰‹æœºæŸ¥çœ‹Tokenï¼Œè¾“å…¥å¯†ç ä¸²ï¼Œå®‰å…¨æ˜¯å®‰å…¨äº†ï¼Œå¯æ˜¯ä¸èƒ½å¿ï¼&lt;/p&gt;
&lt;h2&gt;OSX ç”ŸæˆToken&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä¸è¦æ¯æ¬¡éƒ½æ‰“å¼€æ‰‹æœºï¼Œæ‰€ä»¥å¼€å§‹å¯»æ‰¾Google Authenticator ç”Ÿæˆå·¥å…·çš„æ¡Œé¢ç‰ˆï¼Œæœç„¶æœ‰å¾ˆå¤šè§£å†³æ–¹æ¡ˆ&lt;a href="http://superuser.com/questions/462478/is-there-a-google-authenticator-desktop-client"&gt;Is there a Google Authenticator desktop client?&lt;/a&gt;, æœ‰Webç‰ˆçš„ã€Javaç‰ˆçš„ï¼Œä¸è¿‡æœ€é«˜æ•ˆçš„å½“ç„¶æ˜¯å‘½ä»¤è¡Œç‰ˆ&lt;a href="http://www.nongnu.org/oath-toolkit/"&gt;oathtool&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;å®‰è£…oath-toolkit:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brew install oath-toolkit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸€ä¸ªshellè„šæœ¬ï¼Œæ‹·è´åˆ° /usr/local/bin/ï¼ŒåŠ ä¸Šå¯æ‰§è¡Œæƒé™:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="c1"&gt;#fork from http://superuser.com/questions/462478/is-there-a-google-authenticator-desktop-client , by Peter Beckman&lt;/span&gt;

&lt;span class="nv"&gt;scriptname&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;basename&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-z&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$scriptname&lt;/span&gt;&lt;span class="s2"&gt;: Service Name Req&amp;#39;d&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Usage:&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;   otp google&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Configuration: &lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;&lt;span class="s2"&gt;/.otpkeys&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Format: name=key&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;exit&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="nv"&gt;otpkey&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;^&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$HOME&lt;/span&gt;/.otpkeys&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="s2"&gt;&amp;quot;=&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;s/ //g&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-z&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$otpkey&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$scriptname&lt;/span&gt;&lt;span class="s2"&gt;: Bad Service Name&amp;quot;&lt;/span&gt;
&lt;span class="nb"&gt;exit&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="nv"&gt;token&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;/usr/local/bin/oathtool&lt;span class="w"&gt; &lt;/span&gt;--totp&lt;span class="w"&gt; &lt;/span&gt;-b&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$otpkey&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$token&lt;/span&gt;
&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$token&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;/usr/bin/pbcopy&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="c1"&gt;#è‡ªåŠ¨æ‹·è´è‡³å‰ªè´´æ¿&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;!-- more --&gt;
&lt;p&gt;åˆ›å»º$HOME/.otpkeys æ–‡ä»¶ï¼Œè¾“å…¥Tokenç”Ÿæˆç ï¼Œæ ¼å¼ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;æ ¼å¼ï¼šã€Œåç§°ã€=ã€Œç”Ÿæˆç ã€
ä¾‹ï¼šgoogle=UKPPIDEALLKPYTT9
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¥½äº†ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œ &lt;code&gt;[è„šæœ¬å] [åç§°]&lt;/code&gt; è¯•ä¸€è¯•,ä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt; ~  which oath
/usr/local/bin/oath
 ~  cat ~/.otpkeys
google=UKPPIDEALLKPYTT9
 ~  oath google
123456
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦å¤–æŒ‰ä¸‹ Commandé”®+V è¯•ä¸€è¯•ï¼Œçˆ½åˆ°ä¸è¡Œï¼ŒpbcopyçœŸæ˜¯ä¸ªä¼Ÿå¤§çš„å‘½ä»¤ã€‚&lt;/p&gt;
&lt;h2&gt;è‡ªåŠ¨è¿æ¥VPN&lt;/h2&gt;
&lt;p&gt;è‡ªåŠ¨ç”ŸæˆTokenå¤åˆ¶åˆ°å‰ªè´´æ¿æ˜¯æ–¹ä¾¿äº†ä¸€ç‚¹ï¼Œä¸è¿‡æƒ³ç€æ¯æ¬¡è¿˜å¾—è‡ªå·±æ‰“å¼€å®¢æˆ·ç«¯--ã€ŒTunnelblickã€æ‰‹åŠ¨è¾“å…¥å¤ªçƒ¦ã€‚
å®‰è£…OpenVPNï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brew install Caskroom/cask/tuntap #å…ˆå®‰è£…è¿™è´§
brew install openvpn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®‰è£…å®Œæˆåæ‹·è´OpenVPNçš„é…ç½®æ–‡ä»¶è‡³ &lt;code&gt;/usr/local/etc/openvpn&lt;/code&gt;ç›®å½•ï¼ˆä¸æ”¾è¿™ä¸ªç›®å½•ä¹Ÿè¡Œã€‚ã€‚åæ­£æ˜¯æ‰‹åŠ¨æŒ‡å®šçš„ï¼‰ï¼Œ
ä¾‹ï¼š &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#/usr/local/etc/openvpn/client.ovpn
...
remote vpn.google.com 1234
...
ca /usr/local/etc/openvpn/ca.crt
cert /usr/local/etc/openvpn/client1.crt
key /usr/local/etc/openvpn/client1.key
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è®°å¾—ä¸Šé¢çš„&lt;code&gt;ca&lt;/code&gt;ï¼Œ&lt;code&gt;key&lt;/code&gt;ï¼Œ&lt;code&gt;cert&lt;/code&gt;å‡ ä¸ªè¦å†™ç»å¯¹è·¯å¾„ï¼Œå³ä½¿å’Œopenvpnçš„é…ç½®æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚&lt;br&gt;
å¥½äº†ï¼Œæ‰§è¡Œ&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;sudo /usr/local/sbin/openvpn  --config /usr/local/etc/openvpn/client.ovpn
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¯•ä¸€è¯•ï¼Œè¾“å…¥å¸å·å’Œå¯†ç ï¼Œæ²¡é—®é¢˜çš„è¯ä¼šçœ‹åˆ°è¿æ¥æˆåŠŸï¼Œä¸‹å‘çš„è·¯ç”±ç­‰ç­‰ã€‚  &lt;/p&gt;
&lt;p&gt;è¿æ¥æˆåŠŸä¹‹åå°è¯•æŠŠå‰é¢å‡ æ­¥è¾“å…¥çš„æ“ä½œç”¨è„šæœ¬æå®šï¼Œç¥­å‡ºè€ç‰Œç¥å™¨--[expect]ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/usr/bin/expect&lt;/span&gt;

&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;username&lt;span class="w"&gt; &lt;/span&gt;ã€Œä½ çš„ç”¨æˆ·åã€
&lt;span class="nb"&gt;set&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;passwd&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;exec&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sh&lt;span class="w"&gt; &lt;/span&gt;-c&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;ã€Œä½ çš„å¯†ç ã€&amp;quot;&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;ã€Œä¸Šé¢ä¸€æ­¥ç”ŸæˆTokenä½ çš„è„šæœ¬çš„ç»å¯¹è·¯å¾„ã€&lt;span class="w"&gt; &lt;/span&gt;ã€Œ&lt;span class="nv"&gt;$HOME&lt;/span&gt;/.otpkeysä¸­å¯¹åº”çš„æ¡ç›®åç§°ã€&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="o"&gt;}]&lt;/span&gt;
&lt;span class="c1"&gt;#ä¾‹ï¼šset passwd [exec sh -c {echo &amp;quot;helloworld&amp;quot;`/usr/local/bin/oath google`}]&lt;/span&gt;
spawn&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;/usr/local/sbin/openvpn&lt;span class="w"&gt;  &lt;/span&gt;--config&lt;span class="w"&gt; &lt;/span&gt;/usr/local/etc/openvpn/ã€ŒOpenVPNé…ç½®æ–‡ä»¶ã€
&lt;span class="c1"&gt;#ä¾‹ï¼šspawn sudo /usr/local/sbin/openvpn  --config /usr/local/etc/openvpn/client.ovpn&lt;/span&gt;
expect&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Enter Auth Username:&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;send&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$username&lt;/span&gt;&lt;span class="s2"&gt;\n&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;
expect&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Enter Auth Password:&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;send&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$passwd&lt;/span&gt;&lt;span class="s2"&gt;\n&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;}&lt;/span&gt;

interact
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¿å­˜ä¸Šé¢çš„è„šæœ¬åˆ°ä¸€ä¸ªä½ è§‰å¾—æ–¹ä¾¿è¿è¡Œçš„åœ°æ–¹ï¼Œçˆ½åˆ°ä¸è¡Œä¸è¡Œçš„ã€‚ä¸å–œæ¬¢expectè„šæœ¬çš„ï¼Œå¯ä»¥ç”¨openvpnçš„ 'auth-user-pass-verify' é€‰é¡¹æ¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚&lt;/p&gt;
&lt;h3&gt;openconnect&lt;/h3&gt;
&lt;p&gt;å¦‚æœç”¨çš„æ˜¯OpenConnectçš„è¯ï¼Œä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;brew install Caskroom/cask/tuntap
brew install openconnect
echo &amp;quot;Password&amp;quot;`oath google`  |sudo openconnect --user=USERNAME --passwd-on-stdin   vpn.google.com
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2015"></category><category term="shell"></category><category term="openvpn"></category></entry><entry><title>cronicè„šæœ¬ä¿®æ­£</title><link href="https://fangpsh.github.io/posts/2015/2015-07-13.html" rel="alternate"></link><published>2015-07-13T00:00:00+08:00</published><updated>2015-07-13T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-07-13:/posts/2015/2015-07-13.html</id><summary type="html">&lt;p&gt;å®ä¹ æœŸé—´åšçš„ä¸€ä¸ªä¸œè¥¿éœ€è¦è¯»å†™æ§åˆ¶crontab çš„ä»»åŠ¡ï¼Œå¤±è´¥éœ€è¦æŠ¥è­¦ã€‚crontabæœ¬èº«æœ‰æŠ¥è­¦ï¼Œä½†æ˜¯éå¸¸ä¸å‹å¥½ï¼Œä¾‹å¦‚cron jobå¦‚æœæœ‰ä»»ä½•è¾“å‡ºï¼ˆæ ‡å‡†è¾“å‡ºæˆ–è€…æ ‡å‡†é”™è¯¯è¾“å‡º â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å®ä¹ æœŸé—´åšçš„ä¸€ä¸ªä¸œè¥¿éœ€è¦è¯»å†™æ§åˆ¶crontab çš„ä»»åŠ¡ï¼Œå¤±è´¥éœ€è¦æŠ¥è­¦ã€‚crontabæœ¬èº«æœ‰æŠ¥è­¦ï¼Œä½†æ˜¯éå¸¸ä¸å‹å¥½ï¼Œä¾‹å¦‚cron jobå¦‚æœæœ‰ä»»ä½•è¾“å‡ºï¼ˆæ ‡å‡†è¾“å‡ºæˆ–è€…æ ‡å‡†é”™è¯¯è¾“å‡ºï¼‰ï¼Œéƒ½ä¼šå‘é€é‚®ä»¶é€šçŸ¥ï¼Œå¹¶ä¸”è¿˜éœ€è¦åœ¨æ¯å°æœºå™¨ä¸Šé…ç½®smtpï¼Œéå¸¸éº»çƒ¦ã€‚æ‰€ä»¥æƒ³ç€å°±åœ¨å‰é¢ç›´æ¥å¥—äº†ä¸ªè„šæœ¬ï¼Œå¦‚æœä»»åŠ¡å¼‚å¸¸ï¼Œç”¨curlè°ƒä¸€ä¸‹è¿œç¨‹æœåŠ¡çš„apiå‘é€é‚®ä»¶å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;æ‰¾åˆ°è¿™æ ·ä¸€ä»½shellè„šæœ¬-- &lt;a href="http://habilis.net/cronic/"&gt;Cronic&lt;/a&gt;ï¼Œä¸è¿‡è¿™ä»½è„šæœ¬ä¸æ»¡è¶³ä¸€äº›éœ€æ±‚ï¼Œå¹¶åœ¨éƒ¨ç½²æµ‹è¯•çš„æ—¶å€™é‡åˆ°ä¸€äº›bugï¼Œä¿®æ­£å¦‚ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šæ–‡è„šæœ¬é“¾æ¥ä¸­çš„ä¾‹å­æ˜¯ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;0 1 * * * cronic backup
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;code&gt;backup&lt;/code&gt;æŒ‡çš„æ˜¯&lt;strong&gt;ä¸€æ¡&lt;/strong&gt;å‘½ä»¤ï¼Œä¸èƒ½ä½¿ç”¨ç»„åˆçš„å‘½ä»¤ï¼Œä¸ç„¶ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;30 23 * * * cronic cd /named/zone_bak  &amp;amp;&amp;amp; find ./ -maxdepth 1 -mtime +2 | xargs -i rm -rf {}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœç”¨root ç”¨æˆ·æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼Œå°†ç›´æ¥å¯¼è‡´ /rootä¸‹ä¸¤å¤©å‰çš„æ‰€æœ‰æ–‡ä»¶è¢«åˆ ã€‚ã€‚è‡³äºä¸ºä»€ä¹ˆï¼Œçœ‹åŸæ¥è„šæœ¬çš„å†™æ³•å°±çŸ¥é“äº†ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;quot;$@&amp;quot; &amp;gt;$OUT 2&amp;gt;$TRACE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è§£å†³æ–¹æ³•æ˜¯æŠŠcron jobéƒ½å†™æˆä¸€ä¸ªè„šæœ¬ï¼Œç„¶å &lt;code&gt;cronic command&lt;/code&gt; æ¥è°ƒç”¨ï¼Œä½†æ˜¯å¼€å‘åŒå­¦è‚¯å®šä¸çˆ½ï¼ŒSAä¹Ÿä¸çˆ½ã€‚&lt;br&gt;
é‚£å°±åŠ å•å¼•å·å§ï¼Œbashè„šæœ¬ä¸­åŠ äº†å•å¼•å·çš„æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ä¸ä¼šè¢«å±•å¼€ï¼Œå½“ç„¶commandé‡Œé¢çš„å•å¼•å·å¾—ç”¨è½¬ä¹‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;cronic &amp;#39;command&amp;#39;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åŸæ¥è„šæœ¬ä¸­æ‰§è¡Œå‘½ä»¤çš„éƒ¨åˆ†ä½¿ç”¨&lt;code&gt;eval&lt;/code&gt;æ”¹å†™ï¼Œé¡ºå¸¦è§£å†³ä¸‹é‡å®šå‘è¾“å‡ºçš„bugï¼ˆæƒ³æƒ³å¦‚æœcommandä¸­å·²ç»åŒ…å«äº†é‡å®šå‘çš„æ“ä½œï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå¥‡æ€ªçš„äº‹æƒ…ï¼Œ2333ï¼‰ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;â€¨eval &amp;quot;(&amp;quot;$@&amp;quot;)&amp;quot; &amp;gt;$OUT 2&amp;gt;$TRACE
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®Œæ•´è„šæœ¬è§ &lt;a href="https://gist.github.com/fangpsh/688b56c029147f44d879"&gt;cronic.sh&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–æœ‰ä¸€ä¸ªPythonç‰ˆæœ¬çš„ï¼Œè§ &lt;a href="http://www.zlovezl.cn/articles/pycronic-makes-crontab-emails-painless/"&gt;pycronic: ä½¿crontabçš„æŠ¥è­¦æ›´æ— ç—›&lt;/a&gt;ã€‚&lt;/p&gt;</content><category term="2015"></category><category term="crontab"></category><category term="cronic"></category><category term="bash"></category></entry><entry><title>é¢å‘ç½‘é¡µå·¥ç¨‹å¸ˆä¸ç½‘ç«™ç®¡ç†å‘˜çš„Webç¼“å­˜æ•™ç¨‹</title><link href="https://fangpsh.github.io/posts/2015/2015-04-06.html" rel="alternate"></link><published>2015-04-06T18:00:00+08:00</published><updated>2015-04-06T18:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-04-06:/posts/2015/2015-04-06.html</id><summary type="html">&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡çŸ¥è¯†æ€§çš„æ–‡æ¡£ã€‚å°½ç®¡æ˜¯æŠ€æœ¯æ€§æ–‡ç« ï¼Œä½†æ˜¯æœ¬æ–‡è¯•å›¾è®©ç›¸å…³çš„æ¦‚å¿µæ›´å®¹æ˜“è¢«ç†è§£ï¼ŒåŠæ›´å®¹æ˜“è¢«åº”ç”¨åˆ°å®é™…åœºæ™¯ä¸­å» â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡çŸ¥è¯†æ€§çš„æ–‡æ¡£ã€‚å°½ç®¡æ˜¯æŠ€æœ¯æ€§æ–‡ç« ï¼Œä½†æ˜¯æœ¬æ–‡è¯•å›¾è®©ç›¸å…³çš„æ¦‚å¿µæ›´å®¹æ˜“è¢«ç†è§£ï¼ŒåŠæ›´å®¹æ˜“è¢«åº”ç”¨åˆ°å®é™…åœºæ™¯ä¸­å»ã€‚æ­£å› å¦‚æ­¤ï¼Œä¸ºäº†æ›´åŠ ç®€æ˜ï¼ŒæŸäº›åŸç†æ–¹é¢çš„ä¸œè¥¿åœ¨æ–‡ä¸­è¢«ç®€åŒ–æˆ–çœç•¥äº†ã€‚å¦‚æœä½ å¯¹è¿™äº›ç»†èŠ‚éƒ¨åˆ†æ„Ÿå…´è¶£ï¼Œè¯·æ·±å…¥é˜…è¯»æ–‡æœ«çš„&lt;a href="#11-å‚è€ƒæ–‡æ¡£å’Œæ›´å¤šä¿¡æ¯"&gt;å‚è€ƒæ–‡æ¡£å’Œæ›´å¤šä¿¡æ¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;1.ä»€ä¹ˆæ˜¯Webç¼“å­˜ï¼Ÿä¸ºä»€ä¹ˆäººä»¬ä½¿ç”¨å®ƒï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Webç¼“å­˜ä½äºä¸€ä¸ªæˆ–å¤šä¸ªWebæœåŠ¡å™¨ï¼ˆå³æºæœåŠ¡å™¨ï¼‰å’Œä¸€ä¸ªæˆ–å¤šä¸ªå®¢æˆ·ç«¯ä¹‹é—´ï¼Œç›‘è§†ç€è¿›å…¥çš„è¯·æ±‚ï¼Œä¿å­˜ç€æœåŠ¡å™¨å“åº”çš„å†…å®¹ï¼ˆä¾‹å¦‚HTMLé¡µé¢ã€å›¾ç‰‡å’Œæ–‡ä»¶ï¼ˆç»Ÿç§°ä¸ºä»£è¡¨ï¼‰ï¼‰çš„ä»£è¡¨ã€‚ç„¶åï¼Œå½“ä¸‹ä¸€ä¸ªåŒæ ·URLçš„è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ä¿å­˜çš„å†…å®¹å“åº”è¯·æ±‚ï¼Œè€Œä¸æ˜¯å‘æºæœåŠ¡å™¨å†æ¬¡è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨Webç¼“å­˜çš„ä¸¤å¤§ä¸»è¦ç†ç”±ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é™ä½å“åº”å»¶æ—¶&lt;/strong&gt;ï¼šå› ä¸ºè¯·æ±‚è¢«ç¼“å­˜ï¼ˆç¦»å®¢æˆ·ç«¯æ›´è¿‘ï¼‰å“åº”è€Œä¸æ˜¯æºæœåŠ¡å™¨ï¼Œå¯ä»¥èŠ±æ›´å°‘çš„æ—¶é—´å¾—åˆ°æœåŠ¡æ–‡ä»¶å¹¶æ¸²æŸ“å±•ç¤ºã€‚è¿™è®©ç½‘é¡µçœ‹èµ·æ¥å“åº”æ›´è¿…é€Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™ä½ç½‘ç»œæµé‡&lt;/strong&gt;ï¼šå› ä¸ºä»£è¡¨æ–‡ä»¶è¢«é‡ç”¨ï¼Œè¿™å°†é™ä½å®¢æˆ·ç«¯æ‰€ç”¨çš„å¸¦å®½æ€»é‡ã€‚è¿™ä¹Ÿå°†ä¸ºæŒ‰æµé‡è®¡è´¹çš„å®¢æˆ·ç«¯èŠ‚çœèµ„è´¹ï¼Œå’Œä¿æŒæ›´ä½çš„å¸¦å®½ä»¥åŠè®©å¸¦å®½æ›´å®¹æ˜“ç®¡ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2.Webç¼“å­˜ç±»å‹&lt;/h2&gt;
&lt;h3&gt;2.1 æµè§ˆå™¨ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ æŸ¥çœ‹ä»»ä½•ä¸€æ¬¾ç°ä»£æµè§ˆå™¨ï¼ˆä¾‹å¦‚ Internet Explorer, Safari æˆ– Mozillaï¼‰çš„é¦–é€‰é¡¹ï¼Œå¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€é¡¹å«â€œç¼“å­˜â€çš„è®¾ç½®ï¼Œå®ƒå¯ä»¥åœ¨ä½ çš„è®¡ç®—æœºä¸Šè®¾ç½®ä¸€å—ç¡¬ç›˜ç©ºé—´ç”¨äºå­˜å‚¨ä½ æµè§ˆå™¨è¿‡çš„ç½‘é¡µçš„ä»£è¡¨æ–‡ä»¶ã€‚æµè§ˆå™¨ç¼“å­˜ä¾ç…§éå¸¸ç®€å•çš„è§„åˆ™è¿›è¡Œè¿ä½œï¼šåœ¨åŒä¸€ä¸ªç”¨æˆ·ä¼šè¯ä¸­ï¼ˆå³å½“å‰ä½¿ç”¨æµè§ˆå™¨æ²¡æœ‰å…³é—­å‰ï¼‰ä¼šæ£€æŸ¥å¹¶ç¡®ä¿å­˜å‚¨çš„ä»£è¡¨æ–‡ä»¶æ˜¯æœ€æ–°çš„ã€‚  &lt;/p&gt;
&lt;p&gt;å½“ç”¨æˆ·å•å‡»æµè§ˆå™¨çš„â€˜è¿”å›â€™æŒ‰é’®æˆ–è€…ç‚¹å‡»æŸä¸ªæµè§ˆè¿‡çš„é¡µé¢é“¾æ¥æ—¶ï¼Œæµè§ˆå™¨ç¼“å­˜ç‰¹åˆ«æœ‰ç”¨ã€‚å¦å¤–ï¼Œå¦‚æœä½ åœ¨ä½ çš„ç½‘ç«™ä¸­ä½¿ç”¨ç›¸å…³çš„å¯¼èˆªå›¾ç‰‡ï¼Œè¿™äº›å›¾ç‰‡çš„è®¿é—®è¯·æ±‚å¯ä»¥ä»ç”¨æˆ·æµè§ˆå™¨ç¼“å­˜ä¸­åŠæ—¶å¾—åˆ°å“åº”ã€‚&lt;/p&gt;
&lt;h3&gt;2.2 ä»£ç†ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;Webä»£ç†ç¼“å­˜ä¾æ®åŒæ ·çš„åŸç†å·¥ä½œï¼Œåªæ˜¯è§„æ¨¡æ›´å¤§ã€‚ä»£ç†æœåŠ¡å™¨ä»¥åŒæ ·çš„æ–¹å¼ä¸ºæˆåƒä¸Šä¸‡çš„ç”¨æˆ·æœåŠ¡ã€‚å¤§å…¬å¸å’Œç½‘ç»œæœåŠ¡æä¾›å•†ï¼ˆISPï¼‰ä»¬ç»å¸¸å°†ä»£ç†æœåŠ¡å™¨éƒ¨ç½²åœ¨å®ƒä»¬çš„é˜²ç«å¢™ä¸Šï¼Œæˆ–è€…ä½¿ç”¨ç‹¬ç«‹çš„è®¾å¤‡ï¼ˆä¹Ÿç§°ä¸ºä¸­ä»‹æœåŠ¡å™¨ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºä»£ç†æœåŠ¡å™¨æ—¢ä¸æ˜¯å®¢æˆ·ç«¯ä¹Ÿä¸æ˜¯æºæœåŠ¡å™¨çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å®ƒä»¬ä½äºç½‘ç»œä¸­é—´ï¼Œå¹¶ä¸”è¯·æ±‚éƒ½å¿…é¡»ç»ç”±å®ƒä»¬å‘å¾€åˆ«å¤„ã€‚ä¸€ç§æ–¹å¼æ˜¯æ‰‹åŠ¨è®¾ç½®ä½ çš„æµè§ˆå™¨ï¼Œå‘Šè¯‰å®ƒä»¬ä½¿ç”¨å“ªäº›ä»£ç†ã€‚å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨æ‹¦æˆªä»£ç†ã€‚æ‹¦æˆªä»£ç†æœåŠ¡å™¨è‡ªå·±ä¼šå°†æ‰€æœ‰ç½‘é¡µè¯·æ±‚è½¬å‘ç»™åå°ç½‘ç»œï¼Œå®¢æˆ·ç«¯æ— éœ€è¿›è¡Œè®¾ç½®ï¼Œç”šè‡³å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ä»£ç†æœåŠ¡å™¨æ˜¯é€æ˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»£ç†ç¼“å­˜æ˜¯å…±äº«ç¼“å­˜çš„ä¸€ç§ï¼šé€šå¸¸æœ‰å¤§é‡çš„ç”¨æˆ·ä½¿ç”¨å®ƒè€Œä¸æ˜¯å•ä¸ªç”¨æˆ·ï¼Œå¤šæ¬¡è¯·æ±‚çš„ä»£è¡¨æ–‡ä»¶ä¼šè¢«å¤§é‡é‡å¤åˆ©ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨ä»£ç†ç¼“å­˜éå¸¸æœ‰åˆ©äºé™ä½å“åº”å»¶æ—¶å’Œé™ä½ç½‘ç»œæµé‡ã€‚&lt;/p&gt;
&lt;h4&gt;ç½‘å…³ç¼“å­˜&lt;/h4&gt;
&lt;p&gt;é™¤äº†è¢«ç§°ä¸ºâ€œåå‘ä»£ç†ç¼“å­˜â€æˆ–â€œä»£ç†ç¼“å­˜â€ï¼Œç½‘å…³ç¼“å­˜ä¹Ÿæ˜¯ä¸­ä»‹æœåŠ¡å™¨ï¼Œä½†æ˜¯å’Œç½‘ç»œç®¡ç†å‘˜éƒ¨ç½²ä»£ç†ç¼“å­˜ç”¨äºèŠ‚çœå¸¦å®½ä¸åŒï¼Œç½‘å…³ç¼“å­˜é€šå¸¸ç”±ç½‘ç«™ç®¡ç†å‘˜è‡ªå·±éƒ¨ç½²ï¼Œä¸ºäº†ä½¿ç½‘ç«™æ›´å®¹æ˜“æ‰©å±•ï¼Œæœ‰æ›´åŠ å¯é å’Œæœ‰æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;è¯·æ±‚å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è·¯ç”±åˆ°ç½‘å…³ç¼“å­˜ï¼Œä½†æ˜¯é€šå¸¸æ˜¯ä½¿ç”¨æŸç§ç±»å‹çš„è´Ÿè½½å‡è¡¡å™¨æ„å»ºä¸€ä¸ªæˆ–å¤šä¸ªç½‘å…³ç¼“å­˜ï¼Œä»å®¢æˆ·ç«¯çœ‹æ¥å°±åƒè®¿é—®æºæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å†…å®¹åˆ†å‘ç½‘ç»œï¼ˆContent delivery networkï¼Œç®€ç§°CDNï¼‰å°±æ˜¯åœ¨æ•´ä¸ªæˆ–éƒ¨åˆ†äº’è”ç½‘ä¸Šéƒ¨ç½²ç½‘å…³ç¼“å­˜æœåŠ¡å™¨ï¼Œå¹¶å‡ºå”®ç¼“å­˜æœåŠ¡ç»™æ„Ÿå…´è¶£çš„ç½‘ç«™ã€‚&lt;a href="http://www.speedera.com/"&gt;Speedera&lt;/a&gt; å’Œ&lt;a href="http://www.akamai.com/"&gt;Akamai&lt;/a&gt;å°±æ˜¯å…¸å‹çš„CDNæœåŠ¡æä¾›å•†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä»½æ•™ç¨‹ä¸»è¦è¿˜æ˜¯å…³æ³¨æµè§ˆå™¨ç¼“å­˜ä¸ä»£ç†ç¼“å­˜ï¼Œè™½ç„¶æœ‰éƒ¨åˆ†å†…å®¹é€‚åˆå¯¹ç½‘å…³ç¼“å­˜æœ‰å…´è¶£çš„æœ‹å‹ã€‚&lt;/p&gt;
&lt;h2&gt;3.Webç¼“å­˜å¯¹æˆ‘æ— å®³å—ï¼Ÿä¸ºä»€ä¹ˆè¦é¼“åŠ±ä½¿ç”¨ç¼“å­˜ï¼Ÿ&lt;/h2&gt;
&lt;p&gt;Webç¼“å­˜æ˜¯äº’è”ç½‘ä¸Šæœ€å®¹æ˜“è¢«è¯¯è§£çš„æŠ€æœ¯ä¹‹ä¸€ï¼Œå°¤å…¶æ˜¯ç½‘ç«™ç®¡ç†å‘˜ï¼Œä»–ä»¬å®³æ€•å¤±å»å¯¹ç½‘ç«™çš„æ§åˆ¶æƒï¼Œå› ä¸ºä»£ç†ç¼“å­˜å¯ä»¥â€œéšè—â€ç½‘ç«™çš„ç”¨æˆ·ï¼Œè®©çœ‹åˆ°å“ªäº›ç”¨æˆ·åœ¨ä½¿ç”¨ç½‘ç«™è¿™ä»¶äº‹å˜å¾—å›°éš¾ã€‚&lt;/p&gt;
&lt;p&gt;ä¸å¹¸çš„æ˜¯ï¼Œå³ä½¿ä¸å­˜åœ¨Webç¼“å­˜ï¼Œäº’è”ç½‘ä¸Šä¹Ÿæœ‰å¤ªå¤šå› ç´ å¯¼è‡´ç½‘ç«™ç®¡ç†å‘˜æ— æ³•æ¸…æ™°çš„çŸ¥æ™“ç”¨æˆ·æ˜¯å¦‚ä½•è®¿é—®ä»–ä»¬çš„ç½‘ç«™ã€‚å¦‚æœè¿™å¯¹ä½ æ¥è¯´ä¹Ÿæ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œé‚£ä¹ˆæœ¬æ•™ç¨‹å°†ä¼šæŒ‡å¯¼ä½ å¦‚ä½•åœ¨ä¸éœ€è¦ä½¿ç½‘ç«™å¯¹ç¼“å­˜ä¸å‹å¥½çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶å¯ä»¥è·å¾—ä½ éœ€è¦çš„ç»Ÿè®¡æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€ä¸ªå€¼å¾—è®©äººæ‹…å¿§ç‚¹æ˜¯ç¼“å­˜å¯èƒ½ä¼šç»™ç”¨æˆ·æä¾›è¿‡æ—¶é™ˆæ—§çš„å†…å®¹ï¼Œä¸è¿‡æœ¬æ•™ç¨‹å°†å‘ä½ å±•ç¤ºå¦‚ä½•é…ç½®ä½ çš„æœåŠ¡å™¨æ¥æ§åˆ¶ç¼“å­˜çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ è§„åˆ’å¥½ä½ çš„ç½‘ç«™ï¼Œç¼“å­˜å¯ä»¥å¸®ä½ è®©ç½‘ç«™åŠ è½½é€Ÿåº¦æ›´å¿«ï¼Œå¹¶é™ä½æœåŠ¡å™¨è´Ÿè½½ä¸ç½‘ç»œé“¾è·¯è´Ÿè½½ã€‚è¿™ç§å·®å¼‚æ˜¯æƒŠäººçš„ï¼šä¸€ä¸ªéš¾ä»¥è¢«ç¼“å­˜çš„ç½‘ç«™å¯èƒ½å¾—èŠ±è´¹æ•°ç§’åŠ è½½ï¼Œè€Œä¸€ä¸ªåˆ©ç”¨äº†ç¼“å­˜ç‰¹æ€§çš„ç½‘ç«™å¯ä»¥è¢«ç¬é—´åŠ è½½ã€‚ç”¨æˆ·æ›´äº«å—ä¸€ä¸ªåŠ è½½è¿…é€Ÿçš„ç½‘ç«™ï¼Œå¹¶ä¸”æ—¥åä¼šæ›´åŠ é¢‘ç¹çš„è®¿é—®ã€‚&lt;/p&gt;
&lt;p&gt;å¾€è¿™ä¸ªè§’åº¦æƒ³æƒ³ï¼šå¾ˆå¤šå¤§å…¬å¸èŠ±è´¹æ•°ç™¾ä¸‡ç¾å…ƒåœ¨ä¸–ç•Œå„åœ°å»ºç«‹æœåŠ¡å™¨é›†ç¾¤æ¥å­˜å‚¨å®ƒä»¬çš„å†…å®¹ä»£è¡¨ï¼Œä¸ºäº†ä½¿å®ƒä»¬çš„ç”¨æˆ·è®¿é—®æ›´åŠ è¿…é€Ÿã€‚ç¼“å­˜å¯ä»¥ä¸ºä½ åšåŒæ ·çš„äº‹ï¼Œå¹¶ä¸”å®ƒä»¬ç¦»ç»ˆç«¯ç”¨æˆ·æ›´è¿‘ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä½ ä¸éœ€è¦ä¸ºç¼“å­˜ä¹°å•ã€‚&lt;/p&gt;
&lt;p&gt;äº‹å®ä¸Šï¼Œæ— è®ºä½ å–œæ¬¢ä¸å–œæ¬¢ï¼Œä»£ç†ç¼“å­˜å’Œæµè§ˆå™¨ç¼“å­˜éƒ½ä¼šè¢«ä½¿ç”¨ã€‚å¦‚æœä½ ä¸é…ç½®ä½ çš„ç½‘ç«™ä½¿å…¶è¢«æ­£ç¡®ç¼“å­˜ï¼Œé‚£ä¹ˆå®ƒä»¬ä¼šé»˜è®¤æŒ‰ç…§ç¼“å­˜ç®¡ç†å‘˜çš„ç­–ç•¥è¿›è¡Œç¼“å­˜ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;CDNï¼ˆContent delivery networkï¼‰æ˜¯ä¸€ç§æœ‰è¶£çš„å‘å±•ï¼Œå› ä¸ºä¸åŒäºå¤§å¤šæ•°ä»£ç†ç¼“å­˜ï¼ŒCDNçš„ç½‘å…³ç¼“å­˜åªç¼“å­˜ä¹æ„è¢«ç¼“å­˜çš„ç½‘ç«™ï¼Œæ‰€ä»¥ä¸å­˜åœ¨ä¸Šæ–‡æåˆ°çš„é—®é¢˜ã€‚ç„¶è€Œï¼Œå½“ä½ ä½¿ç”¨CDNæ—¶è¿˜æ˜¯ä¸å¾—ä¸è€ƒè™‘ä¸‹æ¸¸çš„ä»£ç†ç¼“å­˜ä¸æµè§ˆå™¨ç¼“å­˜çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;4.Webç¼“å­˜æ˜¯å¦‚ä½•å·¥ä½œçš„&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ç¼“å­˜éƒ½æœ‰ä¸€å¥—è§„åˆ™ç”¨æ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç¼“å­˜ä¸­çš„ä»£è¡¨ï¼ˆå¦‚æœä»£è¡¨å¯ç”¨çš„æƒ…å†µä¸‹ï¼‰æ¥å“åº”è¯·æ±‚ã€‚ä¸€äº›è§„åˆ™åœ¨ï¼ˆHTTP1.0 å’ŒHTTP1.1ï¼‰åè®®ä¸­æœ‰å®šä¹‰ï¼Œå¦å¤–ä¸€äº›è§„åˆ™åˆ™ç”±ç¼“å­˜çš„ç®¡ç†å‘˜ï¼ˆæµè§ˆå™¨ç¼“å­˜çš„ç”¨æˆ·æˆ–è€…ä»£ç†æœåŠ¡å™¨çš„ç®¡ç†å‘˜ï¼‰è®¾ç½®ã€‚  &lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œç¼“å­˜éµå¾ªå¸¸è§çš„è§„åˆ™ï¼ˆä¸è¦æ‹…å¿ƒä½ ä¸ç†è§£ç»†èŠ‚ï¼Œç»†èŠ‚å†…å®¹ä¼šåœ¨ä¸‹æ–‡è§£é‡Šï¼‰ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¦‚æœå“åº”å¤´ä¿¡æ¯å‘Šè¯‰ç¼“å­˜ä¸è¦è¿›è¡Œä¿ç•™ï¼Œç¼“å­˜å³ä¸ä¼šä¿ç•™ï¼›&lt;/li&gt;
&lt;li&gt;å¦‚æœè¯·æ±‚æ˜¯éœ€è¦è®¤è¯çš„æˆ–è€…åŠ å¯†çš„ï¼ˆHTTPsï¼‰ï¼Œä¹Ÿä¸ä¼šè¢«ç¼“å­˜ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªç¼“å­˜ä»£è¡¨ä¼šè¢«è®¤ä¸ºæ˜¯æ–°çš„ï¼ˆæ¢è¨€ä¹‹ï¼Œä¸æ£€æŸ¥æºæœåŠ¡å™¨ï¼Œä»£è¡¨å¯ä»¥è¢«ç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ï¼‰ï¼Œå¦‚æœï¼š&lt;/li&gt;
&lt;li&gt;å¤´ä¿¡æ¯ä¸­è®¾ç½®äº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´æˆ–å¯¿å‘½æ§åˆ¶ï¼Œå¹¶ä¸”ä»£è¡¨æ ¹æ®è®¾ç½®æ˜¯åœ¨æ–°é²œæœŸä¸­ï¼›&lt;/li&gt;
&lt;li&gt;ç¼“å­˜è¿‘æœŸè®¿é—®è¿‡è¯¥ä»£è¡¨ï¼Œå¹¶ä¸”ä»£è¡¨æœ€è¿‘çš„ä¿®æ”¹æ—¶é—´æ˜¯å¾ˆä¹…ä¹‹å‰ã€‚  &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ–°é²œçš„ä»£è¡¨å°†ç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºç”¨äºå“åº”è¯·æ±‚ï¼Œåœ¨æ²¡æœ‰æ£€æŸ¥æºæœåŠ¡å™¨çš„æƒ…å†µä¸‹ã€‚
4. å¦‚æœä»£è¡¨è¿‡æ—§äº†ï¼Œç¼“å­˜å°†ä¼šè¯·æ±‚æºæœåŠ¡å™¨æ ¡éªŒä»£è¡¨ï¼Œæˆ–è€…è¯·æ±‚æºæœåŠ¡å™¨å‘ŠçŸ¥è¯¥ä»£è¡¨æ˜¯å¦ä»æ—§å¯ç”¨ï¼›
5. åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚å½“æ–­å¼€ç½‘ç»œè¿æ¥æ—¶ï¼Œç¼“å­˜å¯ä»¥ä½¿ç”¨è¿‡æœŸçš„ä»£è¡¨å“åº”è¯·æ±‚è€Œä¸éœ€è¦æ£€æŸ¥æºæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¯·æ±‚çš„å“åº”ä¸­ä¸å­˜åœ¨éªŒè¯å™¨ï¼ˆETagæˆ–Last-Modifyå¤´ä¿¡æ¯ï¼‰ï¼Œå¹¶ä¸”å®ƒæ²¡æœ‰å…¶ä»–ä»»ä½•æ˜ç¡®çš„æ›´æ–°ä¿¡æ¯ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä½†ä¸æ€»æ˜¯ï¼Œè¯¥è¯·æ±‚å“åº”å°†è¢«è®¤ä¸ºæ˜¯ä¸å¯ç¼“å­˜çš„ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œ&lt;strong&gt;&lt;em&gt;æ–°é²œåº¦&lt;/em&gt;&lt;/strong&gt;å’Œ&lt;strong&gt;&lt;em&gt;æ ¡éªŒ&lt;/em&gt;&lt;/strong&gt;æ˜¯ç¼“å­˜ç®¡ç†å†…å®¹çš„æœ€è¦ä¾æ®ã€‚ä¸€ä¸ªç¼“å­˜ä¸­çš„æ–°é²œçš„ä»£è¡¨æ˜¯å¯ç”¨çš„ï¼Œè€Œä¸€ä¸ªç¼“å­˜æ ¡éªŒå™¨ä¹Ÿå¯ä»¥é¿å…å°†ä¸€ä¸ªæ²¡æœ‰å˜åŒ–çš„ä»£è¡¨ä»æºæœåŠ¡å™¨ä¼ è¾“ä¸€éã€‚&lt;/p&gt;
&lt;h2&gt;5.å¦‚ä½•æ§åˆ¶ç¼“å­˜æ–‡ä»¶æˆ–ä¸ç¼“å­˜æ–‡ä»¶&lt;/h2&gt;
&lt;p&gt;ç½‘é¡µè®¾è®¡å¸ˆå’Œç½‘ç«™ç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨å¤šç§å·¥å…·æ¥ä½¿è°ƒæ•´ç¼“å­˜å¯¹å¾…ç½‘ç«™çš„æ–¹å¼ï¼Œè¿™ä¹Ÿè®¸éœ€è¦ä½ äº²æ‰‹é…ç½®ä½ çš„æœåŠ¡å™¨ï¼Œä½†å–å¾—çš„ç»“æœç»å¯¹å€¼å¾—ä½ åŠ¨æ‰‹ã€‚å…³äºå¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·é…ç½®ä½ çš„æœåŠ¡å™¨ï¼Œè¯·æŸ¥çœ‹ä¸‹æ–‡ã€å®ç°æ³¨æ„äº‹é¡¹ã€‘ç« èŠ‚ã€‚&lt;/p&gt;
&lt;h3&gt;5.1 HTML Metaæ ‡ç­¾ vs. HTTPå¤´ä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;HTMLç¼–å†™è€…å¯ä»¥åœ¨æ–‡æ¡£çš„\&amp;lt;HEAD&amp;gt;åŒºåŠ å…¥æè¿°æ–‡æ¡£å±æ€§çš„æ ‡ç­¾ã€‚è¿™äº›Metaæ ‡ç­¾å¸¸å¸¸ç”¨äºæ ‡è®°ä¸€ä¸ªæ–‡æ¡£ä¸å¯ç¼“å­˜ï¼Œæˆ–è€…åœ¨æŸä¸ªç¡®å®šæ—¶åˆ»è¿‡æœŸã€‚&lt;/p&gt;
&lt;p&gt;Metaæ ‡ç­¾å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œä½†æ˜¯æ•ˆç‡ä¸é«˜ã€‚è¿™æ˜¯å› ä¸ºåªæœ‰å°‘æ•°çš„æµè§ˆå™¨ç¼“å­˜æ”¯æŒè¿™äº›æ ‡ç­¾ï¼Œä»£ç†ç¼“å­˜ä¸æ”¯æŒï¼ˆå®ƒä»¬å‡ ä¹ä¸ä¼šè¯»å–æ–‡æ¡£ä¸­çš„HTMLå†…å®¹ï¼‰ã€‚æœ‰æ—¶ä¼šä¸ºäº†è®©é¡µé¢ä¿æŒæ–°é²œè€Œåœ¨Webé¡µé¢ä¸­æ”¾ä¸Š'Pragma:no-cache'è¿™ä¸ªMetaæ ‡ç­¾ï¼Œè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ä¸€æ–¹é¢ï¼ŒHTTP å¤´å¯ä»¥è®©ä½ å¯¹æµè§ˆå™¨ç¼“å­˜å’Œä»£ç†ç¼“å­˜å¦‚ä½•å¤„ç†ä»£è¡¨æ–‡ä»¶åšæ›´å¤šçš„æ§åˆ¶ã€‚åœ¨HTMLæ–‡ä»¶è§ä¸åˆ°å®ƒä»¬ï¼Œé€šå¸¸ç”±WebæœåŠ¡å™¨è‡ªåŠ¨ç”Ÿæˆã€‚ç„¶è€Œï¼Œæ ¹æ®ä½¿ç”¨çš„WebæœåŠ¡å™¨ä¸åŒï¼Œä½ å¯ä»¥åšä¸åŒç¨‹åº¦çš„æ§åˆ¶ã€‚åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­ï¼Œä½ å°†çœ‹åˆ°ä¸€äº›æœ‰è¶£çš„HTTPå¤´ä¿¡æ¯ï¼Œå’Œå¦‚ä½•åœ¨ä½ çš„ç½‘ç«™ä¸Šè¿›è¡Œåº”ç”¨å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;HTTPå¤´ä¿¡æ¯ç”±WebæœåŠ¡å™¨åœ¨å‘é€HTMLä¹‹å‰å‘é€ï¼Œå¹¶ä¸”åªèƒ½æµè§ˆå™¨å’Œæ¯ä¸€ä¸ªä¸­é—´ç¼“å­˜æœåŠ¡å™¨çœ‹åˆ°ã€‚å…¸å‹çš„HTTP1.1 åè®®çš„å“åº”å¤´å¯èƒ½å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;HTTP/1.1 200 OK
Date: Fri, 30 Oct 1998 13:19:41 GMT
Server: Apache/1.3.3 (Unix)
Cache-Control: max-age=3600, must-revalidate
Expires: Fri, 30 Oct 1998 14:19:41 GMT
Last-Modified: Mon, 29 Jun 1998 02:28:12 GMT
ETag: &amp;quot;3e86-410-3596fbbc&amp;quot;
Content-Length: 1040
Content-Type: text/html
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨è¿™äº›å¤´ä¿¡æ¯ä¹‹åï¼Œä»¥ä¸€è¡Œç©ºæ ¼åˆ†éš”ï¼Œç´§è·Ÿç€æ˜¯HTMLå†…å®¹ã€‚å…³äºå¦‚ä½•è®¾ç½®HTTPå¤´ä¿¡æ¯è¯·æŸ¥çœ‹ã€å®ç°æ³¨æ„äº‹é¡¹ã€‘ç« èŠ‚ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä½ çš„ç½‘ç«™æ˜¯æ‰˜ç®¡åœ¨ISPæœºæˆ¿ä¸­ï¼Œå®ƒä»¬ä¸ä¼šå…è®¸ä½ è®¾ç½®HTTPå¤´ä¿¡æ¯ï¼ˆä¾‹å¦‚Expireså’ŒCache-Controlï¼‰ï¼Œå¤§å£°çš„æŠ±æ€¨å§ï¼šå®ƒä»¬æ˜¯ä½ å·¥ä½œçš„å¿…è¦å·¥å…·ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;5.2 Pragma HTTPå¤´ä¿¡æ¯ï¼ˆä¸ºä½•å®ƒä»¬ä¸èµ·ä½œç”¨ï¼Ÿï¼‰&lt;/h3&gt;
&lt;p&gt;è®¸å¤šäººè®¤ä¸ºè®¾ç½®äº†ä¸€ä¸ª â€˜Pragma: no-cacheâ€™çš„å¤´ä¿¡æ¯å¯ä»¥è®©ä»£è¡¨ä¸è¢«ç¼“å­˜ã€‚å®é™…ä¸Šè¿™æ˜¯ä¸å¯¹çš„ï¼šHTTPè§„èŒƒä¸­æ²¡æœ‰ä»»ä½•å…³äºè®¾ç½®Pragma å“åº”å¤´ä¿¡æ¯çš„æŒ‡å¯¼ï¼›ç›¸åï¼Œå¯¹Pragmaè¯·æ±‚å¤´ï¼ˆä»æµè§ˆå™¨å‘é€ç»™æœåŠ¡å™¨çš„å¤´ä¿¡æ¯ï¼‰è¿›è¡Œäº†è®¨è®ºã€‚è™½ç„¶å°‘æ•°ç¼“å­˜ä¼šéµå¾ªè¿™ä¸ªå¤´ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†ä¸ä¼šï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚ç”¨ä¸‹æ–‡çš„å¤´ä¿¡æ¯æ¥æ›¿ä»£Pragmaå§ã€‚&lt;/p&gt;
&lt;h3&gt;5.3 ä½¿ç”¨Expires HTTPå¤´ä¿¡æ¯æ¥æ§åˆ¶æ›´æ–°&lt;/h3&gt;
&lt;p&gt;Exipres å¤´ä¿¡æ¯æ˜¯ç®¡ç†ç¼“å­˜æœ€åŸºç¡€çš„æ–¹å¼ï¼šå®ƒä¼šå‘Šè¯‰ç¼“å­˜ä»£è¡¨æ–‡ä»¶åœ¨å¤šé•¿æ—¶é—´å†…æ˜¯æ–°é²œçš„ã€‚åœ¨è¿™ä¸ªæ—¶é—´ä¹‹åï¼Œç¼“å­˜å°†æ€»ä¼šè®¿é—®æºæœåŠ¡å™¨æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ›´æ”¹ã€‚å‡ ä¹æ‰€æœ‰çš„ç¼“å­˜éƒ½æ”¯æŒExpireså¤´ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¤§å¤šæ•°WebæœåŠ¡å™¨éƒ½å…è®¸ä½ é€šè¿‡å¤šç§æ–¹å¼è®¾ç½®Expireså“åº”å¤´ä¿¡æ¯ã€‚é€šå¸¸ï¼Œå®ƒä»¬å…è®¸è®¾ç½®ä¸€ä¸ªå‡†ç¡®çš„è¿‡æœŸæ—¶åˆ»ï¼ŒåŸºäºå®¢æˆ·ç«¯æœ€è¿‘ä¸€æ¬¡è®¿é—®ä»£è¡¨çš„æ—¶é—´ï¼Œæˆ–è€…åŸºäºæœåŠ¡å™¨ä¸Šæ–‡æ¡£æœ€åä¸€æ¬¡æ”¹å˜çš„æ—¶é—´ï¼ˆæœ€æ–°ä¿®æ”¹æ—¶é—´ï¼Œlast modification timeï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Exipres å¤´ä¿¡æ¯å¯¹äºè®¾ç½®é™æ€å›¾ç‰‡ç¼“å­˜ï¼ˆä¾‹å¦‚å¯¼èˆªæ æˆ–è€…æŒ‰é’®çš„å›¾ç‰‡ï¼‰ååˆ†æœ‰ç”¨ã€‚å› ä¸ºè¿™äº›æ–‡ä»¶ä¸ç»å¸¸å˜åŠ¨ï¼Œä½ å¯ä»¥ç»™å®ƒä»¬è®¾ç½®ä¸€ä¸ªç‰¹åˆ«é•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä»è€Œä½¿ä½ çš„ç½‘ç«™æ›´å¿«å¾—å“åº”ç”¨æˆ·ã€‚å®ƒä»¬å¯¹äºæ§åˆ¶è§„å¾‹å˜åŒ–çš„é¡µé¢çš„ç¼“å­˜ä¹Ÿéå¸¸æœ‰ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ åœ¨æ¯å¤©æ—©ä¸Šå…­ç‚¹æ›´æ–°ä¸€ä¸ªé¡µé¢ï¼Œä½ å¯ä»¥è®¾ç½®å¯¹åº”ä»£è¡¨çš„è¶…æ—¶æ—¶é—´åœ¨è¿™ä¸ªç‚¹ï¼Œä»è€Œè®©ç¼“å­˜çŸ¥é“ä»€ä¹ˆæ—¶åˆ»å®ƒä»¬éœ€è¦ä¸€ä»½æ–°çš„æ‹·è´ï¼Œè€Œä¸å¿…è®©ç”¨æˆ·ç‚¹å‡»â€œé‡è½½â€æŒ‰é’®ã€‚&lt;/p&gt;
&lt;p&gt;Expires å¤´ä¿¡æ¯çš„å€¼åªèƒ½æ˜¯HTTPæ ¼å¼çš„æ—¥æœŸï¼Œå…¶ä»–çš„å€¼éƒ½ä¼šè¢«è§£ææˆâ€˜è¿‡å»çš„æ—¶åˆ»â€™ï¼Œä»¥è‡³äºä»£è¡¨éƒ½ä¼šè¿‡æœŸã€‚å¦å¤–è®°ä½HTTPçš„æ—¶é—´æ˜¯æ ¼æ—å¨æ²»æ—¶é—´ï¼ˆGMTï¼‰ï¼Œä¸æ˜¯æœ¬åœ°æ—¶é—´ã€‚&lt;br&gt;
ä¾‹å¦‚ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Expires: Fri, 30 Oct 1998 14:19:41 GMT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è™½ç„¶Expireså¤´ä¿¡æ¯éå¸¸æœ‰ç”¨ï¼Œä½†æ˜¯å®ƒä¹Ÿæœ‰ä¸€äº›é™åˆ¶ã€‚é¦–å…ˆï¼Œå› ä¸ºæ¶‰åŠåˆ°æ—¥æœŸï¼ŒWebæœåŠ¡å™¨ä¸Šå’Œç¼“å­˜ä¸Šçš„æ—¶é’Ÿå¿…é¡»åŒæ­¥ã€‚å¦‚æœå®ƒä»¬ä¸åŒæ­¥ï¼Œå°†è¾¾ä¸åˆ°é¢„æœŸçš„ç»“æœï¼Œç¼“å­˜å¯èƒ½é”™è¯¯çš„è®¤ä¸ºè¿‡æœŸçš„å†…å®¹æ˜¯æ–°é²œçš„ã€‚
å¦å¤–ä¸€ä¸ªå…³äºExpiresçš„é—®é¢˜æ˜¯éå¸¸å®¹æ˜“å¿˜è®°ä½ æ›¾ç»ä¸ºæŸäº›å†…å®¹è®¾ç½®äº†ä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶åˆ»ã€‚å¦‚æœä½ åœ¨è¿”å›å†…å®¹æ—¶æ²¡æœ‰æ›´æ–°Expires æ—¶é—´ï¼Œé‚£ä¹ˆæ¯ä¸ªè¯·æ±‚éƒ½å°†å‘å›æºæœåŠ¡å™¨ï¼Œå°†å¢åŠ è´Ÿè½½å’Œå“åº”æ—¶é—´ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨Expires å¤´ä¿¡æ¯ï¼Œç¡®ä¿ä½ çš„WebæœåŠ¡å™¨çš„æ—¶é’Ÿæ˜¯å‡†ç¡®çš„å°†éå¸¸é‡è¦ã€‚ä¸€ä¸ªæ–¹å¼æ˜¯ä½¿ç”¨ç½‘ç»œæ—¶é—´åŒæ­¥åè®®ï¼ˆNTPï¼‰ï¼Œå¯ä»¥å‘ä½ çš„ç³»ç»Ÿç®¡ç†å‘˜å’¨è¯¢æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;5.4 Cache-Control HTTPå¤´ä¿¡æ¯&lt;/h3&gt;
&lt;p&gt;HTTP1.1 åè®®ä»‹ç»äº†ä¸€ç»„æ–°çš„å¤´ä¿¡æ¯ï¼Œcache-control å“åº”å¤´ä¿¡æ¯ï¼Œè®©ç½‘ç«™å‘å¸ƒè€…å¯ä»¥æ›´å…¨é¢çš„æ§åˆ¶ä»–ä»¬çš„å†…å®¹ï¼Œå¹¶è§£å†³äº†Expireså¤´ä¿¡æ¯çš„é™åˆ¶ã€‚&lt;br&gt;
æœ‰ç”¨çš„cache-controlå“åº”å¤´ä¿¡æ¯åŒ…æ‹¬ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;max-age&lt;/strong&gt;=[ç§’] - æŒ‡å®šä»£è¡¨è¢«è§†ä¸ºæ–°é²œçš„æœ€é•¿æ—¶é—´ã€‚ç±»ä¼¼äºExpiresï¼Œè¿™ä¸ªå‚æ•°æ˜¯æŒ‡ç›¸å¯¹äºè¯·æ±‚æ—¶åˆ»çš„æ—¶é—´é—´éš”ï¼Œè€Œä¸æ˜¯ç»å¯¹çš„æ—¶åˆ»ã€‚[ç§’]æ˜¯æŒ‡ä»è¯·æ±‚å¼€å§‹æ—¶åˆ»åˆ°ä½ å¸Œæœ›ç¼“å­˜ä¾æ—§ä¿æŒæ–°é²œçš„æ—¶åˆ»ä¹‹é—´çš„ç§’æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;s-maxage&lt;/strong&gt;=[ç§’] - ç±»ä¼¼äºmax-ageï¼Œä¸è¿‡å®ƒåªåº”ç”¨ä¸å…±äº«ç¼“å­˜ï¼ˆä¾‹å¦‚ä»£ç†æœåŠ¡å™¨ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;public&lt;/strong&gt; - æ ‡è®°è®¤è¯çš„è¯·æ±‚ä¹Ÿå¯ä»¥ç¼“å­˜ã€‚é€šå¸¸æ¥è¯´ï¼Œå¦‚æœéœ€è¦HTTPè®¤è¯ï¼Œå“åº”å†…å®¹å³ä¸ºç§æœ‰çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;private&lt;/strong&gt; - å…è®¸ç¼“å­˜æŒ‡å®šä¸€ä¸ªç”¨æˆ·ï¼ˆä¾‹å¦‚åœ¨æµè§ˆå™¨ä¸­ï¼‰å­˜å‚¨å“åº”å†…å®¹ã€‚å…±äº«ç¼“å­˜ï¼ˆä¾‹å¦‚ä»£ç†æœåŠ¡å™¨ï¼‰å¯èƒ½ä¸å¯ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;no-cache&lt;/strong&gt; - å¼ºåˆ¶ç¼“å­˜åœ¨æ¯ä¸€æ¬¡é‡Šæ”¾ä¸€ä¸ªç¼“å­˜ä»£è¡¨å‰éƒ½å‘æºæœåŠ¡å™¨å‘èµ·è¯·æ±‚è¿›è¡ŒéªŒè¯ã€‚è¿™å¯¹ç¡®ä¿è¯·æ±‚å¾—åˆ°è®¤è¯ï¼ˆå’Œpublicç»“åˆä½¿ç”¨ï¼‰æˆ–ç¡®ä¿å†…å®¹æ–°é²œéƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¹¶ä¸”ä¸éœ€è¦ç‰ºç‰²ä½¿ç”¨ç¼“å­˜çš„æ‰€æœ‰å¥½å¤„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;no-store&lt;/strong&gt; - æŒ‡ç¤ºç¼“å­˜åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸è¦ä¿ç•™ä»£è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;must-revalidate&lt;/strong&gt; - å‘ŠçŸ¥ç¼“å­˜éµå¾ªä½ ç»™å‡ºçš„ä»»ä½•å…³äºä»£è¡¨çš„æ–°é²œåº¦ä¿¡æ¯ã€‚HTTPåè®®å…è®¸ç¼“å­˜åœ¨æŸäº›ç‰¹å®šæƒ…å†µä¸‹è¿”å›è¿‡æœŸä»£è¡¨ã€‚é€šè¿‡æŒ‡å®šè¿™ä¸ªå¤´ä¿¡æ¯ï¼Œä½ å¯ä»¥å‘ŠçŸ¥ç¼“å­˜ä¸¥æ ¼éµå®ˆä½ çš„è§„åˆ™ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;proxy-revalidate&lt;/strong&gt; - å’Œ must-revalidate ç±»å‹ï¼Œé™¤äº†å®ƒåªä½œç”¨äºä»£ç†ç¼“å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Cache-Control: max-age=3600, must-revalidate
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å½“åŒæ—¶å­˜åœ¨cache-controlå’ŒExpiresæ—¶ï¼Œcache-controlä¼˜å…ˆã€‚å¦‚æœä½ æ‰“ç®—ä½¿ç”¨cache-controlå¤´ä¿¡æ¯ï¼Œä½ åº”è¯¥çœ‹ä¸€ä¸‹HTTP1.1åè®®çš„è¿™ç¯‡ä¸é”™çš„æ–‡æ¡£ï¼Œè§ã€å‚è€ƒæ–‡æ¡£å’Œæ›´å¤šä¿¡æ¯ã€‘èŠ‚ã€‚&lt;/p&gt;
&lt;h3&gt;5.5 éªŒè¯å™¨ä¸éªŒè¯&lt;/h3&gt;
&lt;p&gt;åœ¨ã€Webç¼“å­˜æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‘ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è¯´è¿‡éªŒè¯æ˜¯ç”¨äºå½“ä»£è¡¨å˜æ›´åæœåŠ¡å™¨å’Œç¼“å­˜ä¹‹é—´çš„é€šè®¯ã€‚é€šè¿‡ä½¿ç”¨å®ƒï¼Œå¯ä»¥ç¦æ­¢ç¼“å­˜ä¸‹è½½æ•´ä¸ªä»£è¡¨ï¼Œå½“ä»–ä»¬æœ¬åœ°æœ‰ä¸€ä»½æ‹·è´ä½†ä¸ç¡®å®šæ‹·è´æ˜¯å¦æ–°é²œæ—¶ã€‚&lt;/p&gt;
&lt;p&gt;éªŒè¯å™¨éå¸¸é‡è¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸å­˜åœ¨ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•å…¶ä»–æ–°é²œåº¦ä¿¡æ¯ï¼ˆExpiresæˆ–è€…Cache-Controlï¼‰å¯ç”¨ï¼Œé‚£ä¹ˆç¼“å­˜å°†ä¸ä¼šä¿å­˜ä»»ä½•ä»£è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ€å¸¸è§çš„éªŒè¯å™¨æ˜¯æ–‡æ¡£çš„æœ€åä¿®æ”¹æ—¶é—´ï¼Œé€šè¿‡Last-Modifiedå¤´ä¿¡æ¯ä¼ é€’ã€‚å½“ä¸€ä»½ç¼“å­˜æœ‰ä¸€ä¸ªåŒ…å«Last-Modifiedå¤´ä¿¡æ¯çš„ä»£è¡¨æ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡å‘é€ä¸€ä¸ªIfModified-Sinceè¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨è¿™ä»½ç¼“å­˜åœ¨ä¸Šæ¬¡æµè§ˆä¹‹åæ˜¯å¦è¢«ä¿®æ”¹äº†ã€‚&lt;/p&gt;
&lt;p&gt;HTTP1.1ä¸­ä»‹ç»äº†å¦å¤–ä¸€ç§ç§°ä¸ºEtagçš„éªŒè¯å™¨ã€‚Etagæ˜¯æœåŠ¡å™¨ç”Ÿæˆçš„å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”æ¯æ¬¡ä»£è¡¨æ”¹å˜æ—¶éƒ½ä¼šå˜åŠ¨ã€‚å› ä¸ºæœåŠ¡å™¨å¯ä»¥æ§åˆ¶å¦‚ä½•ç”ŸæˆEtagï¼Œæ‰€ä»¥å½“ç¼“å­˜å‘é€If-None-Matchè¯·æ±‚æ—¶ï¼Œå¦‚æœETagæ˜¯åŒ¹é…çš„ï¼Œç¼“å­˜å°±å¯ä»¥ç¡®å®šä»£è¡¨æ˜¯ç›¸åŒçš„ã€‚&lt;/p&gt;
&lt;p&gt;å‡ ä¹æ‰€æœ‰ç¼“å­˜éƒ½ä½¿ç”¨Last-Modifiedæ—¶é—´ä½œä¸ºéªŒè¯å™¨ï¼ŒETagéªŒè¯å™¨ä¹Ÿæ­£åœ¨é€æ¸æµè¡Œèµ·æ¥ã€‚&lt;br&gt;
å¤§éƒ¨åˆ†ç°ä»£çš„WebæœåŠ¡å™¨ä¼šè‡ªåŠ¨åŒæ—¶ç”ŸæˆETagå’ŒLast-Modifiedå¤´ä¿¡æ¯æ¥ä½œä¸ºé™æ€å†…å®¹çš„éªŒè¯å™¨ï¼Œä½ ä¸éœ€è¦åšä»»ä½•äº‹ã€‚ç„¶è€Œï¼Œå®ƒä»¬å¯¹äºåŠ¨æ€å†…å®¹å¹¶ä¸çŸ¥é“å¦‚ä½•ç”ŸæˆLast-Modifiedå’ŒETagå¤´ä¿¡æ¯ï¼Œè§ã€ç¼–å†™æ”¯æŒç¼“å­˜çš„è„šæœ¬ã€‘ä¸€èŠ‚ã€‚&lt;/p&gt;
&lt;h2&gt;6.æ­å»ºæ”¯æŒç¼“å­˜çš„ç½‘ç«™çš„æŠ€å·§&lt;/h2&gt;
&lt;p&gt;é™¤äº†ä½¿ç”¨æ–°é²œè¯»ä¿¡æ¯å’ŒéªŒè¯å™¨ï¼Œè¿™å„¿è¿˜æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è®©ä½ çš„ç½‘ç«™å¯¹ç¼“å­˜æ›´å‹å¥½ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨ç»Ÿä¸€çš„URL - è¿™æ˜¯ç¼“å­˜çš„é»„é‡‘å®ˆåˆ™ã€‚å¦‚æœå¯¹äºä¸åŒçš„ç”¨æˆ·æˆ–è€…æ¥è‡ªä¸åŒçš„ç«™ç‚¹è¯·æ±‚è¿”å›åŒ…å«ç›¸åŒå†…å®¹çš„ä¸åŒé¡µé¢ï¼Œåº”è¯¥ä½¿ç”¨ç›¸åŒçš„URLã€‚è¿™æ˜¯ä½¿ä½ çš„ç½‘ç«™å¯¹ç¼“å­˜å‹å¥½çš„æœ€ç®€å•ã€æœ€æœ‰æ•ˆçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨HTMLé¡µé¢ä¸­ä½¿ç”¨â€˜/index.htmlâ€™ä½œä¸ºä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆå°±å§‹ç»ˆä½¿ç”¨è¿™ä¸ªURLã€‚  &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨ä¸€ä¸ªå…±ç”¨çš„&lt;/strong&gt;å›¾ç‰‡æˆ–è€…å…¶ä»–å…ƒç´ çš„åº“ï¼Œåœ¨ä¸åŒçš„åœ°æ–¹å¼•ç”¨å®ƒä»¬ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è®¾ç½®ä¸€ä¸ªcache-contrlï¼šmax-ageä¸ºå¾ˆå¤§çš„å€¼ï¼Œ&lt;strong&gt;è®©ç¼“å­˜æœåŠ¡å™¨å­˜å‚¨é‚£äº›ä¸å¸¸å˜åŠ¨çš„å›¾ç‰‡å’Œé¡µé¢&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æŒ‡å®šä¸€ä¸ªåˆé€‚çš„max-ageæˆ–è¿‡æœŸæ—¶é—´ï¼Œ&lt;strong&gt;è®©ç¼“å­˜æœåŠ¡å™¨è¯†åˆ«è§„å¾‹æ›´æ–°çš„é¡µé¢&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦‚æœä¸€ä¸ªèµ„æºï¼ˆç‰¹åˆ«æ˜¯ä¸‹è½½æ–‡ä»¶ï¼‰å˜åŠ¨äº†ï¼Œä¿®æ”¹å®ƒçš„åç§°&lt;/strong&gt;ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥ä½¿å…¶åœ¨æœªæ¥å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ä¸è¿‡æœŸï¼Œå¹¶ä¸”ä»ç„¶ç¡®ä¿å“åº”çš„æ˜¯æ­£ç¡®çš„ç‰ˆæœ¬ã€‚ä¸è¿‡é“¾æ¥åˆ°ä¸‹è½½æ–‡ä»¶çš„é¡µé¢éœ€è¦è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éå¿…è¦çš„æƒ…å†µä¸‹ä¸è¦ä¿®æ”¹æ–‡ä»¶&lt;/strong&gt;ã€‚å¦‚æœä½ è¿™ä¹ˆåšäº†ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªä¸æ­£ç¡®çš„æ–°çš„Last-Modifiedæ—¥æœŸã€‚ä¾‹å¦‚ï¼Œå½“ä½ æ›´æ–°ä½ çš„ç½‘ç«™æ—¶ï¼Œä¸åº”è¯¥æ‹·è´æ•´ä¸ªç½‘ç«™ï¼Œåªä¸Šä¼ ä½ ä¿®æ”¹è¿‡çš„æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åªåœ¨å¿…è¦çš„åœ°æ–¹ä½¿ç”¨cookies&lt;/strong&gt; - cookieséå¸¸éš¾è¢«ç¼“å­˜ï¼Œå¹¶ä¸”åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯ä¸éœ€è¦çš„ã€‚å¦‚æœä½ ä¸€å®šè¦ä½¿ç”¨cookieï¼Œåªé™åœ¨åŠ¨æ€é¡µé¢ä¸­ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‡å°‘ä½¿ç”¨SSL &lt;/strong&gt;- å› ä¸ºåŠ å¯†çš„é¡µé¢ä¸èƒ½è¢«å…±äº«ç¼“å­˜æ‰€å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨ä¸å¾—å·²çš„æ—¶å€™å†ä½¿ç”¨å®ƒä»¬ï¼Œå¹¶ä¸”å‡å°‘åœ¨SSL é¡µé¢ä¸Šä½¿ç”¨å›¾ç‰‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨&lt;a href="https://redbot.org/"&gt;REDbot&lt;/a&gt;æ£€æŸ¥ä½ çš„é¡µé¢&lt;/strong&gt; - å®ƒå¯ä»¥å¸®åŠ©ä½ å®è·µå¾ˆå¤šæœ¬æ•™ç¨‹å†…çš„æ¦‚å¿µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;7.ç¼–å†™æ”¯æŒç¼“å­˜çš„è„šæœ¬&lt;/h2&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†è„šæœ¬ä¸ä¼šè¿”å›éªŒè¯å™¨ï¼ˆLast-Modified æˆ–ETagå“åº”å¤´ä¿¡æ¯ï¼‰æˆ–è€…æ–°é²œåº¦ä¿¡æ¯ï¼ˆExpiresæˆ–Cache-Controlï¼‰ã€‚æœ‰äº›è„šæœ¬ç¡®å®æ˜¯åŠ¨æ€çš„ï¼ˆæ„å‘³ç€æ¯æ¬¡è¯·æ±‚å®ƒä»¬éƒ½ä¼šè¿”å›ä¸åŒçš„å“åº”å†…å®¹ï¼‰ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ï¼ˆåƒæœç´¢å¼•æ“å’Œæ•°æ®å¼•æ“ç½‘ç«™ï¼‰å¯ä»¥ä»è®¾ç½®ä¸ºç¼“å­˜å‹å¥½ä¸­è·ç›Šã€‚&lt;/p&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä¸€ä»½è„šæœ¬åœ¨ä¸€æ®µæ—¶é—´å†…ï¼ˆæ— è®ºæ˜¯å‡ åˆ†é’Ÿæˆ–è€…å‡ å¤©ï¼‰ï¼Œå¯¹äºåŒæ ·çš„è¯·æ±‚ç”Ÿæˆçš„è¾“å‡ºæ˜¯é‡å¤çš„ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å¯ä»¥è¢«ç¼“å­˜çš„ã€‚å¦‚æœè„šæœ¬çš„è¾“å‡ºå†…å®¹åªéšURLå˜åŒ–è€Œå˜åŒ–ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæ˜¯å¯ä»¥è¢«ç¼“å­˜çš„ï¼Œä½†å¦‚æœè¾“å‡ºå†…å®¹ä¾èµ–cookiesï¼Œè®¤è¯ä¿¡æ¯æˆ–è€…å…¶ä»–å¤–éƒ¨å…¶ä»–æ¡ä»¶ï¼Œé‚£ä¹ˆå¯èƒ½ä¸èƒ½è¢«ç¼“å­˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ä¸€ä»½è„šæœ¬å¯¹ç¼“å­˜å‹å¥½åŒ–çš„æœ€å¥½æ–¹å¼æ˜¯ï¼ˆåŒæ—¶ä¹Ÿæ”¹å–„æ€§èƒ½ï¼‰çš„æ–¹å¼æ˜¯åœ¨å†…å®¹æ”¹å˜æ—¶å¯¼å‡ºæˆé™æ€æ–‡ä»¶ã€‚WebæœåŠ¡å™¨å¯ä»¥å¯¹å¾…è¿™äº›é™æ€æ–‡ä»¶ä¾‹å¦‚å…¶ä»–Webé¡µé¢ï¼Œç”Ÿæˆå’Œä½¿ç”¨éªŒè¯å™¨ï¼Œä¼šè®©ä½ æ›´åŠ æ–¹ä¾¿ã€‚è®°ä½åªåœ¨å˜åŒ–æ—¶å†™æ–‡ä»¶ï¼Œè¿™æ ·å¯è®©Last-Modifiedæ—¶é—´å—ä¿æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;å¦å¤–ä¸€ç§ä½¿è„šæœ¬å¯¹ç¼“å­˜å‹å¥½åŒ–çš„æœ‰å±€é™æ€§çš„æ–¹å¼æ˜¯åœ¨å¯¹æœªæ¥ä¸€æ®µå®é™…æ—¶é—´å†…è®¾ç½®ä¸€ä¸ªç›¸å¯¹å¯¿å‘½çš„å¤´ä¿¡æ¯ã€‚è™½ç„¶ä½¿ç”¨Expireså¯ä»¥å®ç°ï¼Œä¸è¿‡æ›´å®¹æ˜“çš„æ–¹å¼æ˜¯ä½¿ç”¨Cache-Controlï¼šmax-ageï¼Œå®ƒä¼šåœ¨è¯·æ±‚ä¹‹åè®©ç¼“å­˜åœ¨ä¸€æ®µæ—¶é—´å†…ä¿æŒæ–°é²œã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä»¥ä¸Šä½ éƒ½åšä¸åˆ°ï¼Œä½ å°†éœ€è¦è®©è„šæœ¬ç”Ÿæˆä¸€ä¸ªéªŒè¯å™¨ï¼Œå¹¶å“åº”If-Modified å’Œ/æˆ– If-None-Matchè¯·æ±‚ã€‚è¿™äº›å¯ä»¥åœ¨è§£æHTTPå¤´ä¿¡æ¯æ—¶å®Œæˆï¼Œå¹¶åœ¨ç¬¦åˆæ¡ä»¶çš„æƒ…å†µä¸‹è¿”å›304 Not Modifiedã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä»–æŠ€å·§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦ä½¿ç”¨POST&lt;/strong&gt;é™¤éæ˜¯é€‚åˆçš„ã€‚POSTæ–¹æ³•è¯·æ±‚çš„å“åº”å†…å®¹ä¸ä¼šè¢«å¤§å¤šæ•°ç¼“å­˜ä¿å­˜ï¼›å¦‚æœä½ é€šè¿‡è·¯å¾„æˆ–è€…æŸ¥è¯¢ï¼ˆé€šè¿‡GETè¯·æ±‚ï¼‰å‘é€ä¿¡æ¯ï¼Œç¼“å­˜æœåŠ¡å™¨å¯ä»¥å­˜å‚¨ä¿¡æ¯ä¾›æ—¥åä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦åœ¨URLä¸­åµŒå…¥ç”¨æˆ·ç‰¹æœ‰çš„ä¿¡æ¯&lt;/strong&gt;ï¼Œé™¤éç”Ÿæˆçš„å†…å®¹å¯¹ç”¨æˆ·æ˜¯å®Œå…¨å”¯ä¸€çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸è¦ç»Ÿè®¡ä¸€ä¸ªç”¨æˆ·æ¥ç€æ¥è‡ªåŒä¸€ä¸ªä¸»æœºçš„è¯·æ±‚&lt;/strong&gt;ï¼Œå› ä¸ºç¼“å­˜å¸¸å¸¸æ˜¯å…±åŒå·¥ä½œçš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”ŸæˆConten-Lengthå“åº”å¤´ä¿¡æ¯&lt;/strong&gt;ã€‚è¿™å¾ˆå®¹æ˜“åšåˆ°ï¼Œå¹¶ä¸”è¿™å°†å…è®¸ä½ çš„è„šæœ¬çš„å“åº”å†…å®¹ç”¨äºæŒä¹…è¿æ¥ã€‚è¿™å°†å…è®¸å®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸€ä¸ªTCP/IPè¿æ¥ä¸­è¯·æ±‚å¤šä¸ªä»£è¡¨ï¼Œè€Œä¸æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½å»ºç«‹ä¸€ä¸ªTCP/IPè¿æ¥ã€‚è¿™ä¼šä½¿ä½ çš„ç½‘ç«™çœ‹èµ·æ¥æ›´å¿«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šç»†èŠ‚ä¿¡æ¯è¯·çœ‹ã€å®ç°æ³¨æ„äº‹é¡¹ã€‘ã€‚&lt;/p&gt;
&lt;h2&gt;8.å¸¸è§é—®é¢˜è§£ç­”&lt;/h2&gt;
&lt;h3&gt;ä½¿ç½‘ç«™å¯ç¼“å­˜çš„çš„é‡ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¥½çš„ç­–ç•¥æ˜¯æ‰¾å‡ºé‚£äº›æœ€å—æ¬¢è¿çš„ï¼Œä¸”æœ€å¤§çš„ä»£è¡¨æ–‡ä»¶ï¼ˆç‰¹åˆ«æ˜¯å›¾ç‰‡ï¼‰ï¼Œå°†å®ƒä»¬äº‹å…ˆç¼“å­˜èµ·æ¥ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘å¦‚ä½•æ‰èƒ½ä½¿ç”¨ç¼“å­˜æœåŠ¡å™¨è®©æˆ‘çš„é¡µé¢å°½å¯èƒ½çš„å¿«ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¤§å¤šæ•°ç¼“å­˜çš„ä»£è¡¨æ–‡ä»¶ä¼šè®¾ç½®ä¸€ä¸ªå¾ˆé•¿çš„æ–°é²œæ—¶é—´ã€‚éªŒè¯å™¨å¯ä»¥å¸®åŠ©é™ä½æ£€æŸ¥ä»£è¡¨æ–‡ä»¶çš„æ—¶é—´ï¼Œä½†æ˜¯ç¼“å­˜è¿˜æ˜¯å¾—å’ŒæºæœåŠ¡å™¨é€šè®¯ä¸€æ¬¡ä»¥ç¡®å®šå®ƒæ˜¯æ–°é²œçš„ã€‚å¦‚æœç¼“å­˜å·²çŸ¥å®ƒæ˜¯æ–°é²œçš„ï¼Œä»£è¡¨æ–‡ä»¶å¯ä»¥è¢«ç›´æ¥æœåŠ¡ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘æ˜ç™½ç¼“å­˜æ˜¯ä¸é”™ï¼Œä½†æ˜¯æˆ‘ä¸å¾—ä¸ç»Ÿè®¡æœ‰å¤šå°‘äººè®¿é—®æˆ‘çš„é¡µé¢ï¼&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ ä¸€å®šè¦çŸ¥é“ä¸€ä¸ªé¡µé¢çš„è®¿é—®æ¬¡æ•°ï¼Œé€‰æ‹©é¡µé¢ä¸Šçš„ã€Œä¸€ä¸ªã€å°å…ƒç´ ï¼ˆæˆ–è€…é¡µé¢æœ¬èº«ï¼‰ï¼Œå¹¶é€šè¿‡ç»™å®ƒè®¾ç½®ä¸€ä¸ªåˆé€‚çš„å¤´ä¿¡æ¯ï¼Œè®©å®ƒä¸è¢«ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨æ¯ä¸ªé¡µé¢ä¸Šå¼•ç”¨ä¸€ä¸ª1x1 çš„é€æ˜çš„ä¸ä¼šè¢«ç¼“å­˜çš„å›¾ç‰‡ã€‚å¼•ç”¨å¤´ä¿¡æ¯ä¼šåŒ…å«å“ªä¸ªä¸ªé¡µé¢è®¿é—®äº†å®ƒçš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„è¿™å¹¶ä¸ä¼šç»™äºˆä½ çœŸå®å’Œå‡†ç¡®çš„ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶ä¸”è¿™å¯¹ä½ çš„ç”¨æˆ·å’Œç½‘ç»œéƒ½æ˜¯ä¸å‹å¥½çš„ã€‚å®ƒä¸ä¼šæ¶ˆè€—ä¸å¿…è¦çš„ç½‘ç»œå¸¦å®½ï¼Œå¼ºè¿«äººä»¬ç­‰å¾…ä¸è¢«ç¼“å­˜çš„å†…å®¹ä¸‹è½½å®Œæ¯•ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ã€å‚è€ƒæ–‡æ¡£å’Œæ›´å¤šä¿¡æ¯ã€‘ä¸­çš„ã€Œå…³äºéè¿ç»­æ€§è®¿é—®çš„ç»Ÿè®¡ã€ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘å¦‚ä½•èƒ½çœ‹åˆ°ä¸€ä¸ªä»£è¡¨çš„æ–‡ä»¶çš„HTTPå¤´ä¿¡æ¯ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¤šæ•°Webæµè§ˆå™¨å¯ä»¥è®©ä½ åœ¨â€˜é¡µé¢ä¿¡æ¯â€™æˆ–è€…ç±»ä¼¼çš„ç•Œé¢çœ‹åˆ°Expireså’Œlast-Modified å¤´ä¿¡æ¯ã€‚å¦‚æœå¯ä»¥çš„è¯ï¼Œä½ ä¼šå¾—åˆ°é¡µé¢çš„èœå•å’Œé¡µé¢ç›¸å…³çš„æ‰€æœ‰ä»£è¡¨æ–‡ä»¶ï¼ˆåƒå›¾ç‰‡ç­‰ï¼‰ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;è¦æŸ¥çœ‹ä¸€ä¸ªä»£è¡¨æ–‡ä»¶çš„å…¨éƒ¨å¤´ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨Telnet å®¢æˆ·ç«¯æ‰‹åŠ¨è¿æ¥WebæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;è¦è¿™æ ·åšï¼Œä½ å¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªå­—æ®µä¸­æŒ‡å®šç«¯å£ï¼ˆé»˜è®¤æ˜¯80ï¼‰ï¼Œæˆ–è€…ä½ å¯èƒ½éœ€è¦è¿æ¥www.example.com:80 æˆ–www.example.com 80 (æ³¨æ„ç©ºæ ¼)ã€‚å‚è€ƒä¸‹ä½ çš„Telnetå®¢æˆ·ç«¯çš„æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦ä½ æ‰“å¼€äº†ç½‘ç«™çš„ä¸€ä¸ªè¿æ¥ï¼Œè¾“å…¥ä¸€ä¸ªä»£è¡¨æ–‡ä»¶çš„è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è¦çœ‹ http://www.example.com/foo.html çš„å¤´ä¿¡æ¯ï¼Œè¿æ¥ www.example.comï¼Œç«¯å£80ï¼Œå¹¶è¾“å…¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;GET /foo.html HTTP/1.1 [å›è½¦]
Host: www.example.com [å›è½¦][å›è½¦]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ¯æ¬¡ä½ çœ‹åˆ°ã€Œå›è½¦ã€æŒ‰ä¸‹å›è½¦é”®ï¼Œç¡®ä¿åœ¨æœ€åçš„æ—¶å€™ä½ æŒ‰äº†ä¸¤æ¬¡ã€‚å°†ä¼šæ‰“å°å¤´ä¿¡æ¯ï¼Œæ¥ç€æ˜¯å®Œæ•´çš„é¡µé¢æ–‡ä»¶ã€‚å¦‚æœåªæƒ³çœ‹åˆ°å¤´ä¿¡æ¯ï¼Œå°†&lt;code&gt;GET&lt;/code&gt; æ¢æˆ &lt;code&gt;HEAD&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘çš„é¡µé¢æ˜¯å—å¯†ç ä¿æŠ¤çš„ï¼Œä»£ç†ç¼“å­˜ä¼šå¦‚ä½•å¤„ç†å®ƒä»¬ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œå—HTTPè®¤è¯ä¿æŠ¤çš„é¡µé¢éƒ½è®¤ä¸ºæ˜¯ç§æœ‰çš„ï¼Œå®ƒä»¬ä¸ä¼šè¢«å…±äº«ç¼“å­˜ä¿å­˜ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªCache-Controlï¼špbulic header å¤´ä¿¡æ¯ä½¿è®¤è¯é¡µé¢å…¬å¼€ã€‚HTTP1.1å…¼å®¹çš„ç¼“å­˜ä¼šå…è®¸å®ƒä»¬è¢«ç¼“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å–œæ¬¢è¿™ç±»é¡µé¢è¢«ç¼“å­˜ï¼Œä½†æ˜¯å¯¹æ¯ä¸ªç”¨æˆ·ä»ç„¶è¦è®¤è¯æ‰èƒ½è®¿é—®ï¼Œå¯ä»¥ç»“åˆCache-Controlï¼špublic å’Œno-cacheå¤´ä¿¡æ¯ã€‚è¿™å°†ä¼šå‘ŠçŸ¥ç¼“å­˜åœ¨é‡Šæ”¾ä»£è¡¨æ–‡ä»¶ä¹‹å‰ç¡®è®¤æ–°çš„å®¢æˆ·ç«¯å¿…é¡»æäº¤è®¤è¯ä¿¡æ¯ç»™æœåŠ¡å™¨ã€‚è®¾ç½®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Cache-Control: public, no-cache
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ— è®ºæ˜¯å¦åšåˆ°è¿™ç‚¹ï¼Œæœ€å¥½å‡å°‘è®¤è¯çš„ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„å›¾ç‰‡ä¸æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œå°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ï¼Œå¹¶é…ç½®ä½ çš„æœåŠ¡å™¨ä¸å¯¹å®ƒä»¬è¿›è¡Œå¼ºåˆ¶è®¤è¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œè¿™äº›å›¾ç‰‡å°†å¯ä»¥è¢«æ­£å¸¸ç¼“å­˜ã€‚&lt;/p&gt;
&lt;h3&gt;å¦‚æœç”¨æˆ·é€šè¿‡ç¼“å­˜è®¿é—®æˆ‘çš„ç½‘ç«™æˆ‘æ˜¯å¦è¦æ‹…å¿ƒå®‰å…¨æ€§ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;SSL é¡µé¢ä¸ä¼šè¢«ä»£ç†ç¼“å­˜æœåŠ¡å™¨æ‰€ç¼“å­˜ï¼ˆæˆ–è§£å¯†ï¼‰ï¼Œæ‰€ä»¥ä½ ä¸å¿…æ‹…å¿ƒè¿™ä¸ªé—®é¢˜ã€‚ä¸è¿‡ï¼Œå› ä¸ºç¼“å­˜æœåŠ¡å™¨ä¼šå­˜å‚¨ç»è¿‡å®ƒä»¬çš„éSSLè¯·æ±‚å’ŒURLï¼Œä½ åº”è¯¥æ„è¯†åˆ°å¯¹äºä¸å®‰å…¨çš„ç«™ç‚¹ï¼Œä¸é“å¾·çš„ç¼“å­˜æœåŠ¡å™¨ç®¡ç†å‘˜å¯èƒ½æ”¶é›†å®ƒä»¬ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡URLã€‚&lt;/p&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œåœ¨ä½ çš„æœåŠ¡å™¨å’Œä½ çš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä»»ä½•ç½‘ç»œç®¡ç†å‘˜éƒ½å¯ä»¥æ”¶é›†è¿™ç±»ä¿¡æ¯ã€‚ç‰¹åˆ«æ˜¯å½“CGIè„šæœ¬æŠŠç”¨æˆ·åå’Œå¯†ç æ”¾åœ¨å®ƒçš„URLæ—¶ï¼Œè¿™ä¼šå¾ˆå®¹æ˜“è®©ä»–äººæ‰¾åˆ°æ­¤ç±»ä¿¡æ¯å¹¶åˆ©ç”¨ä»è€Œç™»å½•ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ äº†è§£ä¸€èˆ¬çš„Webå®‰å…¨é—®é¢˜ï¼Œä½ ä¸ä¼šå¯¹ä»£ç†ç¼“å­˜æœåŠ¡å™¨æ„Ÿåˆ°æƒŠå¥‡ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘åœ¨å¯»æ‰¾ä¸€ä¸ªé›†æˆWebå‘å¸ƒçš„è§£å†³æ–¹æ¡ˆã€‚å“ªäº›æ˜¯æ”¯æŒç¼“å­˜çš„ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å·®å¼‚å¾ˆå¤§ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¶Šå¤æ‚çš„è§£å†³æ–¹æ¡ˆï¼Œè¶Šéš¾è¢«ç¼“å­˜ã€‚æœ€ç³Ÿç³•çš„æ–¹æ¡ˆæ˜¯é‚£äº›åŠ¨æ€ç”Ÿæˆæ‰€æœ‰å†…å®¹ï¼Œå¹¶ä¸”ä¸æä¾›éªŒè¯å™¨çš„ï¼Œå®ƒä»¬å¯èƒ½å®Œå…¨ä¸ä¼šè¢«ç¼“å­˜ã€‚å‘ä½ çš„ä¾›åº”å•†çš„æŠ€æœ¯äººå‘˜äº†è§£ä¸€ä¸‹ï¼Œå¹¶å‚è€ƒä¸‹ä¸‹æ–‡çš„ã€Œå®ç°æ³¨æ„äº‹é¡¹ã€ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘çš„å›¾ç‰‡æ˜¯ä¸€ä¸ªæœˆåè¿‡æœŸï¼Œä½†æ˜¯æˆ‘éœ€è¦å®ƒä»¬ç«‹åˆ»æ›´æ–°ï¼&lt;/h3&gt;
&lt;p&gt;Expireså¤´ä¿¡æ¯æ— æ³•é¿å¼€ï¼Œé™¤éç¼“å­˜ï¼ˆæµè§ˆå™¨æˆ–è€…ä»£ç†æœåŠ¡å™¨ï¼‰ç©ºé—´ä¸è¶³æ‰ä¼šåˆ é™¤ä»£è¡¨æ–‡ä»¶ï¼Œç¼“å­˜å‰¯æœ¬ä¼šä¸€ç›´è¢«ä½¿ç”¨ç›´åˆ°è¿‡æœŸã€‚&lt;/p&gt;
&lt;p&gt;æœ€æœ‰æ•ˆçš„æ–¹å¼æ˜¯ä¿®æ”¹å®ƒä»¬çš„é“¾æ¥ã€‚è¿™æ ·ï¼Œå®Œå…¨æ–°çš„ä»£è¡¨æ–‡ä»¶ä¼šä»æºæœåŠ¡å™¨è¢«åŠ è½½ã€‚è®°ä½ï¼Œä»»ä½•å¼•ç”¨è¿™äº›ä»£è¡¨æ–‡ä»¶çš„é¡µé¢ä¹Ÿä¼šè¢«ç¼“å­˜ã€‚å› æ­¤ï¼Œæœ€å¥½è®©é™æ€å›¾ç‰‡æˆ–è€…å…¶ä»–ç±»ä¼¼çš„ä»£è¡¨æ–‡ä»¶è¢«ç¼“å­˜ï¼ŒåŒæ—¶ä¸¥æ ¼æ§åˆ¶å¼•ç”¨å®ƒä»¬çš„HTMLé¡µé¢ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¸Œæœ›é‡è½½ä»æŒ‡å®šç¼“å­˜åŠ è½½ä¸€ä¸ªä»£è¡¨æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨ä½¿ç”¨ç¼“å­˜çš„æ—¶å€™å¼ºåˆ¶é‡è½½ï¼ˆåœ¨FIrefoxä¸­ï¼ŒæŒ‰ä½shirté”®çš„æ—¶å€™æŒ‰ä¸‹â€˜é‡è½½â€™é”®å¯ä»¥åšåˆ°ï¼Œé€šè¿‡å‘èµ·ä¸€ä¸ªPragmaï¼šno-cacheå¤´ä¿¡æ¯çš„è¯·æ±‚ï¼‰ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥è®©ç¼“å­˜æœåŠ¡å™¨ç®¡ç†å‘˜åœ¨ä»–ä»¬çš„èŠ‚ç‚¹ä¸­åˆ é™¤ä»£è¡¨æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘è¿è¡Œä¸€ä¸ªWebæ‰˜ç®¡æœåŠ¡ï¼Œæˆ‘æ€ä¹ˆæ ·æ‰èƒ½è®©ç”¨æˆ·å‘å¸ƒå¯¹ç¼“å­˜å‹å¥½çš„é¡µé¢ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ ä½¿ç”¨Apacheï¼Œè€ƒè™‘å…è®¸ä»–ä»¬ä½¿ç”¨.htaccess æ–‡ä»¶å¹¶æä¾›ç›¸åº”æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–ï¼Œä½ å¯ä»¥åœ¨å„ä¸ªè™šæ‹Ÿä¸»æœºé‡Œé¢„å…ˆåˆ›å»ºç¼“å­˜å„ç±»å…ƒç´ çš„ç¼“å­˜åŒºã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªç›®å½• /cache-1m ç”¨äºç¼“å­˜è®¿é—®ä¹‹åçš„å†…å®¹ï¼Œç¼“å­˜ä¸€ä¸ªæœˆã€‚ä¸€ä¸ª /no-cache åŒºç”¨äºæä¾›ä¸ä¼šè¢«ç¼“å­˜çš„ï¼Œé€šè¿‡å¤´ä¿¡æ¯å‘ŠçŸ¥ç¼“å­˜ä¸å­˜å‚¨ä»£è¡¨æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;æ— è®ºä½ æ˜¯å¦èƒ½åšåˆ°ï¼Œæœ€å¥½è®©ä½ æœ€å¤§çš„å®¢æˆ·ä½¿ç”¨ä¸Šç¼“å­˜ã€‚å¯¹äºå¤§ç½‘ç«™è¿™å¯ä»¥å¤§é‡èŠ‚çº¦æˆæœ¬ï¼ˆå¸¦å®½å’ŒæœåŠ¡å™¨è´Ÿè½½æ–¹é¢ï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;æˆ‘å·²ç»æ ‡è®°äº†æˆ‘çš„é¡µé¢æ˜¯å¯ç¼“å­˜çš„ï¼Œä½†æ˜¯æˆ‘çš„æµè§ˆå™¨æ¯æ¬¡éƒ½ä¼šå‘æºæœåŠ¡å™¨å‘èµ·è¯·æ±‚ã€‚æˆ‘å¦‚ä½•æ‰èƒ½å¼ºåˆ¶ç¼“å­˜ä¿å­˜è¿™äº›é¡µé¢çš„ä»£è¡¨æ–‡ä»¶ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ç¼“å­˜ä¸éœ€è¦ä¿å­˜ä»£è¡¨æ–‡ä»¶å’Œé‡ç”¨å®ƒã€‚å®ƒä»¬åªä¼šè¢«è¦æ±‚ä¸è¦ä¿å­˜å’Œä½¿ç”¨ä»£è¡¨æ–‡ä»¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ã€‚æ‰€æœ‰çš„ç¼“å­˜éƒ½æ˜¯åŸºäºä»£è¡¨æ–‡ä»¶çš„å¤§å°ï¼ˆä¾‹å¦‚å›¾ç‰‡å’Œhtmlé¡µé¢ï¼‰ï¼Œä»¥åŠå¦‚æœä¿å­˜å®ƒä»¬æœ¬åœ°è¿˜èƒ½å‰©ä½™å¤šå°‘ç£ç›˜ç©ºé—´ç­‰æ¥åšå†³å®šã€‚ä½ çš„é¡µé¢ç›¸æ¯”æ›´çƒ­é—¨æˆ–è€…æ›´å¤§çš„ä»£è¡¨æ–‡ä»¶ï¼Œå¹¶ä¸å€¼å¾—ç¼“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€äº›ç¼“å­˜æœåŠ¡å™¨å…è®¸å®ƒä»¬çš„ç®¡ç†å‘˜ä¼˜å…ˆè€ƒè™‘å“ªäº›ç±»å‹çš„ä»£è¡¨æ–‡ä»¶è¢«ä¿å­˜ï¼Œä¸€äº›ä»£è¡¨æ–‡ä»¶ä¼šè¢«æ°¸ä¹…ç¼“å­˜ï¼Œæ‰€ä»¥å®ƒä»¬æ€»æ˜¯å¯ç”¨çš„ã€‚&lt;/p&gt;
&lt;h2&gt;9.å®ç°æ³¨æ„äº‹é¡¹-WebæœåŠ¡å™¨&lt;/h2&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´ï¼Œæ— è®ºä»€ä¹ˆWebæœåŠ¡å™¨ï¼Œæœ€å¥½ä½¿ç”¨æœ€æ–°çš„ç‰ˆæœ¬æ¥éƒ¨ç½²ã€‚å®ƒä»¬ä¸ä»…åŒ…å«æ›´å¤šä¸ç¼“å­˜å‹å¥½çš„ç‰¹æ€§ï¼Œè€Œä¸”æ–°ç‰ˆæœ¬é€šå¸¸åœ¨å®‰å…¨å’Œæ€§èƒ½æ–¹é¢ä¹Ÿä¼šæœ‰æ”¹å–„ã€‚&lt;/p&gt;
&lt;h3&gt;Apache HTTP Server&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://www.apache.org/"&gt;Apache&lt;/a&gt; ä½¿ç”¨å¯é€‰çš„æ¨¡å—æ¥å¼•å…¥å¤´ä¿¡æ¯ï¼ŒåŒ…æ‹¬Expireså’ŒCache-Controlã€‚è¿™ä¸¤ä¸ªæ¨¡å—åœ¨1.2 æˆ–é«˜çš„ç‰ˆæœ¬ä¸­éƒ½å¯ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ¨¡å—éœ€è¦å†…ç½®åˆ°Apacheï¼›è™½ç„¶å®ƒä»¬å·²ç»åŒ…å«åœ¨å‘å¸ƒçš„ç‰ˆæœ¬ä¸­ï¼Œä½†æ˜¯é»˜è®¤æ²¡æœ‰å¯ç”¨ã€‚ä¸ºäº†æ‰¾å‡ºä½ æœåŠ¡å™¨ä¸Šå¯ç”¨äº†å“ªäº›æ¨¡å—ï¼Œæ‰¾åˆ°httpdäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿è¡Œ &lt;code&gt;httpd -l&lt;/code&gt;ï¼›è¿™åº”è¯¥èƒ½æ‰“å°å‡ºå¯ç”¨æ¨¡å—çš„åˆ—è¡¨ï¼ˆæ³¨æ„è¿™åªåˆ—å‡ºäº†ç¼–è¯‘è¿›apacheçš„æ¨¡å—ï¼›åœ¨æœ€æ–°ç‰ˆæœ¬çš„apacheä¸Šï¼Œä½¿ç”¨&lt;code&gt;httpd -M&lt;/code&gt;ä¹ŸåŒ…å«åŠ¨æ€åŠ è½½çš„æ¨¡å— ï¼‰ã€‚è¿™äº›æ¨¡å—ä¸­æˆ‘ä»¬è¦æ‰¾çš„æ˜¯expires_module å’Œ headers_moduleã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå®ƒä»¬æ˜¯ä¸å¯ç”¨çš„ï¼Œå¹¶ä¸”ä½ æœ‰ç®¡ç†å‘˜æƒé™ï¼Œä½ å¯ä»¥é‡æ–°ç¼–è¯‘Apacheæ¥å¼•å…¥å®ƒä»¬ã€‚è¿™å¯ä»¥é€šè¿‡åæ³¨é‡ŠConfigurationæ–‡ä»¶ä¸­çš„å¯¹åº”è¡Œï¼Œæˆ–è€…ä½¿ç”¨ç¼–è¯‘é€‰é¡¹&lt;code&gt;-enable-module=expires&lt;/code&gt;å’Œ &lt;code&gt;-enable-module=headers&lt;/code&gt;(1.3æˆ–æ›´é«˜ç‰ˆæœ¬)é…ç½®åšåˆ°ã€‚å‚è€ƒApacheå‘è¡Œç‰ˆä¸­çš„INSTALL æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ªæœ‰ç€åˆé€‚æ¨¡å—çš„Apacheï¼Œä½ å¯ä»¥åœ¨.htaccess æ–‡ä»¶æˆ–è€…æœåŠ¡å™¨çš„access.confæ–‡ä»¶ä¸­ä½¿ç”¨mod_expiresæ¥æŒ‡å®šä»£è¡¨æ–‡ä»¶ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œä½ å¯ä»¥æŒ‡å®šä»è®¿é—®æ—¶é—´æˆ–è€…ä¿®æ”¹æ—¶é—´å¼€å§‹è®¡ç®—çš„çš„è¿‡æœŸæ—¶é—´ï¼Œåº”ç”¨åˆ°æŸä¸ªç±»å‹çš„æ–‡ä»¶æˆ–è€…æŒ‰ç…§é»˜è®¤è®¾ç½®ã€‚å¦‚æœä½ é‡åˆ°å›°éš¾ï¼Œå¯ä»¥é˜…è¯»&lt;a href="http://www.apache.org/docs/mod/mod_expires.html"&gt;æ¨¡å—æ–‡æ¡£&lt;/a&gt;è·å–æ›´å¤šä¿¡æ¯ï¼Œæˆ–è€…å’Œä½ é™„è¿‘çš„Apacheå¤§å¸ˆèŠä¸€èŠã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ä½¿ç”¨Cache-Control å¤´ä¿¡æ¯ï¼Œä½ å°†éœ€è¦ä½¿ç”¨mod_headersæ¨¡å—ï¼Œå®ƒå¯ä»¥ä½¿ä½ ä¸ºä¸€ä¸ªèµ„æºæŒ‡å®šä»»æ„HTTP å¤´ä¿¡æ¯ã€‚å‚è€ƒ &lt;a href="http://www.apache.org/docs/mod/mod_headers.html"&gt;mode_headers æ–‡æ¡£&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™å„¿æœ‰ä¸€ä¸ªä¾‹å­ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨å¤´ä¿¡æ¯çš„ç¤ºèŒƒæ“ä½œã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.htaccess æ–‡ä»¶å…è®¸ç½‘ç«™å‘å¸ƒè€…ä½¿ç”¨é€šå¸¸åªèƒ½åœ¨é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°çš„å‘½ä»¤ã€‚å®ƒä»¬ä¼šå½±å“åˆ°ç›®å½•çš„å†…å®¹å’Œå®ƒä»¬å­ç›®å½•çš„å†…å®¹ã€‚å’Œä½ çš„æœåŠ¡å™¨ç®¡ç†å‘˜äº†è§£ä¸‹å®ƒä»¬æ˜¯å¦è¢«å¯ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;### æ¿€æ´» mod_expires 
ExpiresActive On
### .gif æ–‡ä»¶åœ¨è®¿é—®ä¸€ä¸ªæœˆä¹‹åè¿‡æœŸ
ExpiresByType image/gif A2592000
### ä»»ä½•æ–‡ä»¶åœ¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„ä¸€å¤©åè¿‡æœŸ
###ï¼ˆæ­¤å¤„ä½¿ç”¨äº†Alternative è¯­æ³•ï¼‰
ExpiresDefault &amp;quot;modification plus 1 day&amp;quot;
### å¯¹ index.html æ–‡ä»¶åº”ç”¨ä¸€ä¸ªCache-Control å¤´ä¿¡æ¯
&amp;lt;Files index.html&amp;gt;
Header append Cache-Control &amp;quot;public, must-revalidate&amp;quot;
&amp;lt;/Files&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
&lt;li&gt;æ³¨æ„ï¼šmod_expiresä¼šåœ¨åˆé€‚çš„æƒ…å†µä¸‹è‡ªåŠ¨ç”Ÿæˆå’Œæ’å…¥ä¸€ä¸ªCache-Control:max-age å¤´ä¿¡æ¯&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Apache 2çš„é…ç½®å’Œ1.3éå¸¸ç›¸ä¼¼ï¼Œå‚è€ƒ 2.2&lt;a href="http://httpd.apache.org/docs/2.2/mod/mod_expires.html"&gt;mod_expires&lt;/a&gt;å’Œ&lt;a href="http://httpd.apache.org/docs/2.2/mod/mod_headers.html"&gt;mod_headers&lt;/a&gt;æ–‡æ¡£è·å–æ›´å¤šä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3&gt;Microsoft IIS&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://www.microsoft.com/"&gt;å¾®è½¯&lt;/a&gt;çš„ IIS å¯ä»¥é€šè¿‡éå¸¸çµæ´»çš„æ–¹å¼ï¼Œéå¸¸å®¹æ˜“çš„è®¾ç½®å¤´ä¿¡æ¯ã€‚æ³¨æ„è¿™è¿™åœ¨IIS 4æˆ–è€…æ›´é«˜ç‰ˆæœ¬å¯è¡Œï¼Œå¹¶ä¸”åªèƒ½è¿è¡Œåœ¨NTæœåŠ¡å™¨ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä¸€ä¸ªç½‘ç«™çš„ä¸€å—åŒºåŸŸæŒ‡å®šå¤´ä¿¡æ¯ï¼Œå…ˆåœ¨ &lt;code&gt;Administration Tools&lt;/code&gt; çš„ç•Œé¢ä¸­é€‰ä¸­ï¼Œç„¶åè®¾ç½®å®ƒçš„å±æ€§ã€‚åœ¨é€‰ä¸­&lt;code&gt;HTTP Headers&lt;/code&gt;é¡¹ä¹‹åï¼Œä½ åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸¤å—æœ‰è¶£çš„åŒºåŸŸï¼š&lt;code&gt;Enable Content Expiration&lt;/code&gt;å’Œ&lt;code&gt;Custom HTTP headers&lt;/code&gt;ã€‚å‰è€…ä¼šè‡ªåŠ¨é…ç½®ï¼Œåè€…å¯ä»¥ç”¨äºé…ç½®Cache-Controlå¤´ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åœ¨&lt;code&gt;Active Server Pages&lt;/code&gt;çš„ASPç« èŠ‚ä¸Šå‚è€ƒå…³äºè®¾ç½®å¤´ä¿¡æ¯çš„å†…å®¹ï¼Œå¯èƒ½ä¹Ÿå¯ä»¥é€šè¿‡ISAPIæ¨¡å—è®¾ç½®å¤´ä¿¡æ¯ï¼Œç»†èŠ‚è¯·å‚è€ƒMSDNã€‚&lt;/p&gt;
&lt;h3&gt;Netscape/iPlanet Enterprise Server&lt;/h3&gt;
&lt;p&gt;éšç€3.6ç‰ˆæœ¬å‘å¸ƒï¼ŒEnterpriseæœåŠ¡å™¨ä¸å†æä¾›ä»»ä½•æ˜ç¡®çš„æ–¹å¼æ¥è®¾ç½®Expireså¤´ä¿¡æ¯ã€‚ç„¶è€Œï¼Œå®ƒä»3.0ç‰ˆæœ¬å¼€å§‹å·²ç»æ”¯æŒHTTP1.1åè®®çš„ç‰¹æ€§ã€‚è¿™æ„å‘³ç€ HTTP 1.1ç¼“å­˜ï¼ˆä»£ç†æœåŠ¡å™¨æˆ–è€…æµè§ˆå™¨ï¼‰å¯ä»¥ä½¿ç”¨Cache-Controlè®¾ç½®æ¥å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä½¿ç”¨Cache-Control å¤´ä¿¡æ¯ï¼Œåœ¨ç®¡ç†å‘˜æœåŠ¡å™¨ä¸Šé€‰æ‹©&lt;code&gt;Content Management | Cache Control Directives&lt;/code&gt;ã€‚æ¥ç€ï¼Œä½¿ç”¨&lt;code&gt;Resource Picker&lt;/code&gt;ï¼Œé€‰æ‹©ä½ æƒ³è¦è®¾ç½®å¤´ä¿¡æ¯çš„ç›®å½•ã€‚è®¾ç½®å®Œå¤´ä¿¡æ¯ä¹‹åï¼Œç‚¹å‡»&lt;code&gt;OK&lt;/code&gt;ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ&lt;a href="http://www.redhat.com/docs/manuals/ent-server/"&gt;NESæ‰‹å†Œ&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2&gt;10.å®ç°æ³¨æ„äº‹é¡¹-æœåŠ¡å™¨ç«¯è„šæœ¬&lt;/h2&gt;
&lt;p&gt;å› ä¸ºåœ¨æœåŠ¡å™¨ç«¯çš„è„šæœ¬å¼ºè°ƒçš„æ˜¯åŠ¨æ€å†…å®¹ï¼Œå®ƒä»¬ä¸ä¼šç”Ÿæˆéå¸¸å®¹æ˜“åˆ©äºçš„é¡µé¢ï¼Œå³ä½¿è¿™äº›å†…å®¹æ˜¯å¯ä»¥è¢«ç¼“å­˜çš„ã€‚å¦‚æœä½ çš„å†…å®¹ç»å¸¸å˜åŒ–ï¼Œä½†æ˜¯ä¸æ˜¯åœ¨æ¯æ¬¡é¡µé¢è¢«ç‚¹å‡»æ—¶ï¼Œé‚£ä¹ˆè€ƒè™‘è®¾ç½®ä¸€ä¸ªCache-Control: max-ageå¤´ä¿¡æ¯ã€‚å¤§å¤šæ•°ç”¨æˆ·å†æ¬¡è®¿é—®é¡µé¢éƒ½æ˜¯åœ¨ä¸€ä¸ªè¾ƒçŸ­çš„æ—¶é—´é—´éš”ä¹‹åã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·ç‚¹å‡»â€˜è¿”å›â€™æŒ‰é’®ï¼Œå¦‚æœæ²¡æœ‰è®¤è¯æˆ–è€…æ›´æ–°çš„å†…å®¹ï¼Œä»–ä»¬ä¸å¾—ä¸å¾—ç­‰å¾…é¡µé¢ä»æœåŠ¡å™¨ä¸Šé‡æ–°ä¸‹è½½æ‰èƒ½çœ‹åˆ°ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ‰ä¸€ç‚¹è¦è®°ä½çš„æ˜¯ï¼Œåœ¨ä½ çš„WebæœåŠ¡å™¨ä¸­è®¾ç½®HTTPå¤´ä¿¡æ¯å¯èƒ½æ¯”åœ¨è„šæœ¬è¯­è¨€ä¸­æ›´å®¹æ˜“ã€‚éƒ½å°è¯•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;CGI&lt;/h3&gt;
&lt;p&gt;CGI è„šæœ¬æ˜¯ç”Ÿæˆå†…å®¹æœ€æµè¡Œçš„æ–¹å¼ä¹‹ä¸€ã€‚ä½ å¯ä»¥éå¸¸å®¹æ˜“çš„æ·»åŠ HTTPå“åº”å¤´ä¿¡æ¯ï¼Œåœ¨ä½ å‘é€å†…å®¹ä¹‹å‰ã€‚å¤§å¤šæ•°CGIå®ç°éƒ½è¦æ±‚ä½ å†™ Content-Type å¤´ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨Perlä¸­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#!/usr/bin/perl
print &amp;quot;Content-type: text/html\n&amp;quot;;
print &amp;quot;Expires: Thu, 29 Oct 1998 17:04:19 GMT\n&amp;quot;;
print &amp;quot;\n&amp;quot;;
### the content body follows...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç”±äºéƒ½æ˜¯æ–‡æœ¬ä¿¡æ¯ï¼Œä½ å¯ä»¥éå¸¸å®¹æ˜“çš„ä½¿ç”¨å†…ç½®å‡½æ•°ç”ŸæˆExpireså’Œå…¶ä»–æ—¥æœŸç›¸å…³çš„å¤´ä¿¡æ¯ã€‚å¦‚æœä½ ä½¿ç”¨Cache-Control: max-ageç”šè‡³å¯ä»¥æ›´ç®€å•ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;print &amp;quot;Cache-Control: max-age=600\n&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è¿™ä¼šä½¿è„šæœ¬åœ¨è¯·æ±‚ä¹‹åå¯ä»¥è¢«ç¼“å­˜10åˆ†é’Ÿï¼Œæ‰€ä»¥å¦‚æœç”¨æˆ·ç‚¹å‡»â€˜è¿”å›â€™æŒ‰é’®ï¼Œä»–ä»¬ä¸å†ä¼šé‡æ–°æäº¤è¯·æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è„šæœ¬ç¯å¢ƒä¸­ï¼ŒCGIè§„èŒƒä¹Ÿå…è®¸å®¢æˆ·ç«¯å‘é€å¤´ä¿¡æ¯çš„è¯·æ±‚ï¼›æ¯ä¸ªå¤´ä¿¡æ¯éƒ½æœ‰ä¸€ä¸ªâ€˜HTTP_â€™å‰ç¼€å’Œå¤´ä¿¡æ¯åç§°ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ª If-Modified-Sinceè¯·æ±‚ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸º&lt;code&gt;HTTP_IF_MODIFIED_SINCE&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å‚è€ƒ&lt;a href="https://www.mnot.net/cgi_buffer/"&gt;cgi_buffer&lt;/a&gt;åº“ï¼Œä¸€ä¸ªè‡ªåŠ¨å¤„ç†Etagç”Ÿæˆå’ŒéªŒè¯ï¼ŒContent-Lengthç”Ÿæˆå’Œå¯¹å†…å®¹è¿›è¡Œgzipå‹ç¼©çš„åº“ï¼Œåœ¨Perlå’ŒPython CGI è„šæœ¬ä¸­ä¸€è¡Œå³å¯å¼•å…¥ã€‚Pythonç‰ˆæœ¬çš„ä¹Ÿå¯ä»¥ç”¨äºåŒ…è£…ä»»æ„CGIè„šæœ¬ã€‚&lt;/p&gt;
&lt;h3&gt;Server Side Includes&lt;/h3&gt;
&lt;p&gt;SSIï¼ˆç»å¸¸ä½¿ç”¨.shtmlæ‰©å±•åï¼‰æ˜¯ç½‘ç«™å‘å¸ƒè€…æœ€æ—©å¯ä»¥ç”ŸæˆåŠ¨æ€å†…å®¹çš„æ–¹å¼ä¹‹ä¸€ã€‚é€šè¿‡åœ¨é¡µé¢ä¸­ä½¿ç”¨ç‰¹åˆ«çš„æ ‡è®°ï¼Œå¯ä»¥åµŒå…¥æœ‰é™çš„HTMLè„šæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å¤§éƒ¨åˆ†SSIçš„å®ç°æ— æ³•è®¾ç½®éªŒè¯å™¨ï¼Œä¹Ÿå°±æ— æ³•è¢«ç¼“å­˜ã€‚ä¸è¿‡ï¼ŒApacheå®ç°äº†å¯ä»¥é€šè¿‡å¯¹ç‰¹å®šæ–‡ä»¶çš„ç»„æ‰§è¡Œæƒé™è®¾ç½®ï¼Œå®ç°å…è®¸ç”¨æˆ·è®¾ç½®å“ªäº›SSIå¯ä»¥è¢«ç¼“å­˜ï¼Œç»“åˆ&lt;code&gt;XbitHack&lt;/code&gt;è°ƒæ•´æ•´ä¸ªç›®å½•ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è€ƒ&lt;a href="http://www.apache.org/docs/mod/mod_include.html"&gt;mod_include&lt;/a&gt;æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;h3&gt;PHP&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://www.php.net/"&gt;PHP&lt;/a&gt;æ˜¯ä¸€ä¸ªå†…å»ºåœ¨webæœåŠ¡å™¨ä¸­çš„æœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€ï¼Œå¯ä»¥åšä¸ºHTMLåµŒå…¥å¼è„šæœ¬ï¼Œå¾ˆåƒSSIï¼Œä¸è¿‡æœ‰æ›´å¤šçš„é€‰é¡¹ã€‚PHPå¯ä»¥åœ¨å„ç§WebæœåŠ¡å™¨ä¸Šè®¾ç½®ä¸ºCGIè„šæœ¬è¿è¡Œï¼ˆUnixæˆ–Windowsï¼‰ï¼Œæˆ–ä½œä¸ºApacheçš„æ¨¡å—è¿è¡Œï¼›&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒPHPç”Ÿæˆä»£è¡¨æ–‡ä»¶æ²¡æœ‰è®¾ç½®éªŒè¯å™¨ï¼Œä¹Ÿå°±æ— æ³•ç¼“å­˜ã€‚ä½†æ˜¯ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡Header()å‡½æ•°æ¥è®¾ç½®HTTPå¤´ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œè¿™äº›ä»£ç ä¼šç”Ÿæˆä¸€ä¸ªCache-Controlå¤´ä¿¡æ¯ï¼Œä¹Ÿä¼šè®¾ç½®ä¸€ä¸ª3å¤©åè¿‡æœŸçš„Expireså¤´ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;?php
 Header(&amp;quot;Cache-Control: must-revalidate&amp;quot;);

 $offset = 60 * 60 * 24 * 3;
 $ExpStr = &amp;quot;Expires: &amp;quot; . gmdate(&amp;quot;D, d M Y H:i:s&amp;quot;, time() + $offset) . &amp;quot; GMT&amp;quot;;
 Header($ExpStr);
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;è®°ä½ï¼ŒHeader()çš„è¾“å‡º&lt;strong&gt;å¿…é¡»&lt;/strong&gt;å…ˆäºæ‰€æœ‰å…¶ä»–HTMLçš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œä½ å¯ä»¥æ‰‹å·¥ä¸ºExpireså¤´ä¿¡æ¯åˆ›å»ºHTTPæ—¥æœŸï¼›PHPæ²¡æœ‰ä¸ºæ­¤æä¾›ä¸“é—¨çš„å‡½æ•°ï¼ˆä¸è¿‡æ–°ç‰ˆæœ¬å·²ç»è®©è¿™ä¸ªæ›´å®¹æ˜“äº†ï¼Œè¯·å‚è€ƒ&lt;a href="http://php.net/date"&gt; PHP's date documentation&lt;/a&gt;)ã€‚å½“ç„¶ï¼Œæœ€ç®€å•çš„è¿˜æ˜¯è®¾ç½®Cache-Control: max-ageå¤´ä¿¡æ¯ï¼Œå¯¹äºå¤§éƒ¨åˆ†æƒ…å†µéƒ½æ¯”è¾ƒé€‚ç”¨ï¼›&lt;/p&gt;
&lt;p&gt;æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ&lt;a href="http://www.php.net/manual/function.header.php3"&gt;e manual entry for header&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¹Ÿè¯·å‚è€ƒä¸€ä¸‹&lt;a href="https://www.mnot.net/cgi_buffer/"&gt;cgi_buffer&lt;/a&gt;åº“ï¼Œä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨å¤„ç†ETagçš„ç”Ÿæˆå’ŒéªŒè¯ï¼ŒContent-Lengthç”Ÿæˆå’Œå†…å®¹çš„gzipå‹ç¼©çš„åº“ï¼ŒPHPè„šæœ¬å¼•ç”¨åªéœ€ä¸€è¡Œä»£ç ã€‚&lt;/p&gt;
&lt;h3&gt;Cold Fusion&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://www.macromedia.com/software/coldfusion/"&gt;Cold Fusion&lt;/a&gt;ç”±&lt;a href="http://www.macromedia.com/"&gt;Macromedia&lt;/a&gt;å¼€å‘çš„ä¸€æ¬¾å•†ä¸šæœåŠ¡ç«¯è„šæœ¬å¼•æ“ï¼Œæ”¯æŒå¤šç§Windowsï¼ŒLinuxå’Œå¤šç§Unixå¹³å°ä¸Šçš„WebæœåŠ¡å™¨ã€‚&lt;/p&gt;
&lt;p&gt;Cold Fusionè®©è®¾ç½®ä»»æ„HTTPå¤´ä¿¡æ¯ç›¸å½“å®¹æ˜“ï¼Œé€šè¿‡&lt;a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000270.htm"&gt;CFHEADER&lt;/a&gt;æ ‡ç­¾ã€‚å¯æƒœçš„æ˜¯ï¼šä»¥ä¸‹è®¾ç½®Expireså¤´ä¿¡æ¯çš„ä¾‹å­æœ‰äº›å®¹æ˜“è¯¯å¯¼ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;CFHEADER NAME=&amp;quot;Expires&amp;quot; VALUE=&amp;quot;#Now()#&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å®ƒä¸æ˜¯åƒä½ è®¤ä¸ºä½ çš„é‚£æ ·ç”Ÿæ•ˆï¼Œå› ä¸ºæ—¶é—´ï¼ˆè¿™ä¸ªä¾‹å­ä¸­æ˜¯è¯·æ±‚å‘èµ·çš„æ—¶é—´ï¼‰å¹¶ä¸ä¼šè¢«è½¬æ¢æˆä¸€ä¸ªç¬¦åˆHTTPçš„æ—¶é—´ï¼›ç›¸åçš„ï¼Œå®ƒåªæ‰“å°å‡ºä»£è¡¨æ–‡ä»¶çš„Cold fusionæ—¥æœŸ/æ—¶é—´å¯¹è±¡ã€‚å¤§å¤šæ•°å®¢æˆ·ç«¯ä¼šå¿½ç•¥è¿™æ ·ä¸€ä¸ªå€¼ï¼Œæˆ–è€…å°†å…¶è½¬æ¢æˆé»˜è®¤å€¼ï¼Œä¾‹å¦‚1970å¹´1æœˆ1æ—¥ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼ŒCold Fusionæä¾›äº†ä¸€å¥—æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼š &lt;a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/00000483.htm"&gt;GetHttpTimeSTring&lt;/a&gt;ã€‚ ç»“åˆDateAddå‡½æ•°ï¼Œå¾ˆå®¹æ˜“è®¾ç½®Expiresæ—¶é—´äº†.è¿™é‡Œ,æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå¤´ä¿¡æ¯å£°æ˜ä»£è¡¨æ–‡ä»¶åœ¨1ä¸ªæœˆä»¥åè¿‡æœŸï¼›&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;cfheader name=&amp;quot;Expires&amp;quot; 
  value=&amp;quot;#GetHttpTimeString(DateAdd(&amp;#39;m&amp;#39;, 1, Now()))#&amp;quot;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨CFHEADERæ ‡ç­¾æ¥è®¾ç½®Cache-Control: max-ageç­‰å…¶ä»–å¤´ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;p&gt;è®°ä½WebæœåŠ¡å™¨çš„å¤´ä¿¡æ¯ä¹Ÿä¼šé€šè¿‡Cold Fusionçš„ä¸€äº›éƒ¨ç½²æ–¹å¼ä¼ é€’(ä¾‹å¦‚CGIï¼‰ï¼›æ£€æŸ¥ä½ çš„æœåŠ¡å™¨è®¾ç½®ï¼Œç¡®å®šä½ æ˜¯å¦å¯ä»¥ä½¿ç”¨å®ƒï¼Œå¹¶é€šè¿‡åœ¨WebæœåŠ¡å™¨ä¸Šè®¾ç½®å¤´ä¿¡æ¯æ¥ä»£æ›¿Cold Fusionã€‚ &lt;/p&gt;
&lt;h3&gt;ASP and ASP.NET&lt;/h3&gt;
&lt;p&gt;Active Server Pagesï¼Œå†…ç½®åœ¨IISä¸­ï¼Œåœ¨å…¶ä»–WebæœåŠ¡å™¨ä¸­ä¹Ÿå¯ç”¨ï¼Œä¹Ÿå…è®¸ä½ è®¾ç½®HTTPå¤´ã€‚ä¾‹å¦‚ï¼Œè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä½ å¯ä»¥ä½¿ç”¨Responseæ–¹æ³•çš„å±æ€§ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;% Response.Expires=1440 %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æŒ‡å®šè¯·æ±‚çš„ä»£è¡¨æ–‡ä»¶åœ¨å¤šå°‘åˆ†é’Ÿåè¿‡æœŸã€‚Cache-Controlå¤´ä¿¡æ¯å¯ä»¥è¿™æ ·æ·»åŠ ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&amp;lt;% Response.CacheControl=&amp;quot;public&amp;quot; %&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åœ¨ASP.NETä¸­ï¼ŒResponse.Expireså·²ä¸æ¨èä½¿ç”¨ã€‚æ­£ç¡®çš„æ–¹æ³•æ˜¯é€šè¿‡Response.Cacheè®¾ç½®cacheç›¸å…³çš„å¤´ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Response.Cache.SetExpires ( DateTime.Now.AddMinutes ( 60 ) ) ;
Response.Cache.SetCacheability ( HttpCacheability.Public ) ;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;blockquote&gt;
&lt;p&gt;å½“åœ¨ASPä¸­è®¾ç½®å¤´ä¿¡æ¯æ—¶ï¼Œç¡®ä¿ä½ å°†Responseæ–¹æ³•æ”¾ç½®åœ¨ä»»ä½•HTMLç”Ÿæˆä¹‹å‰ï¼Œæˆ–è€…ä½¿ç”¨ Response.Bufferæ¥ç¼“å†²è¾“å‡ºå†…å®¹ã€‚å¦å¤–ï¼Œæ³¨æ„æœ‰äº›ç‰ˆæœ¬çš„IISé»˜è®¤è®¾ç½®ä¸€ä¸ª Cache-Control: private çš„å¤´ä¿¡æ¯ï¼Œå¿…é¡»å£°æ˜æˆpublicæ‰èƒ½è¢«å…±äº«ç¼“å­˜æœåŠ¡å™¨ç¼“å­˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;11.å‚è€ƒæ–‡æ¡£å’Œæ›´å¤šä¿¡æ¯&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://www.ietf.org/rfc/rfc2616.txt"&gt;HTTP 1.1 Specification&lt;/a&gt;&lt;br&gt;
The HTTP 1.1 spec has many extensions for making pages cacheable, and is the authoritative guide to implementing the protocol. See sections 13, 14.9, 14.21, and 14.25.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.web-caching.com/"&gt;Web-Caching.com&lt;/a&gt;&lt;br&gt;
An excellent introduction to caching concepts, with links to other online resources.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.web-caching.com/"&gt;On Interpreting Access Statistics&lt;/a&gt;&lt;br&gt;
Jeff Goldbergâ€™s informative rant on why you shouldnâ€™t rely on access statistics and hit counters.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://redbot.org/"&gt;REDbot&lt;/a&gt;&lt;br&gt;
Examines HTTP resources to determine how they will interact with Web caches, and generally how well they use the protocol.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.mnot.net/cgi_buffer/"&gt;cgi_buffer Library&lt;/a&gt;
One-line include in Perl CGI, Python CGI and PHP scripts automatically handles ETag generation and validation, Content-Length generation and gzip Content-Encoding â€” correctly. The Python version can also be used as a wrapper around arbitrary CGI scripts.&lt;/p&gt;
&lt;h2&gt;12.å…³äºæœ¬æ–‡æ¡£&lt;/h2&gt;
&lt;p&gt;This document is Copyright Â© 1998-2013 Mark Nottingham &lt;a href="&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#109;&amp;#110;&amp;#111;&amp;#116;&amp;#64;&amp;#109;&amp;#110;&amp;#111;&amp;#116;&amp;#46;&amp;#110;&amp;#101;&amp;#116;"&gt;&amp;#109;&amp;#110;&amp;#111;&amp;#116;&amp;#64;&amp;#109;&amp;#110;&amp;#111;&amp;#116;&amp;#46;&amp;#110;&amp;#101;&amp;#116;&lt;/a&gt;. &lt;a href="http://creativecommons.org/licenses/by-nc-nd/3.0/"&gt;This work is licensed under a Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 Unported License&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;All trademarks within are property of their respective holders.&lt;/p&gt;
&lt;p&gt;Although the author believes the contents to be accurate at the time of publication, no liability is assumed for them, their application or any consequences thereof. If any misrepresentations, errors or other need for clarification is found, please contact the author immediately.&lt;/p&gt;
&lt;p&gt;The latest revision of this document can always be obtained from https://www.mnot.net/cache_docs/&lt;/p&gt;
&lt;p&gt;Translations are available in: Chinese, Czech, German, and French.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è¯‘æ–‡ï¼ŒåŸæ–‡åœ°å€ï¼š&lt;a href="https://www.mnot.net/cache_docs/"&gt;https://www.mnot.net/cache_docs/&lt;/a&gt;ï¼Œéµå¾ªåŸæ–‡çš„ç‰ˆæœ¬è®¸å¯åè®®ï¼š&lt;a href="http://creativecommons.org/licenses/by-nc-nd/3.0/"&gt;Attribution-NonCommercial-NoDerivs 3.0 Unported&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="2015"></category><category term="Web"></category><category term="Cache"></category></entry><entry><title>14å¹´ä¸‹åŠå¹´çš„å¥‡è‘©ç»å†</title><link href="https://fangpsh.github.io/posts/2015/2015-01-21.html" rel="alternate"></link><published>2015-01-21T00:00:00+08:00</published><updated>2015-01-21T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-01-21:/posts/2015/2015-01-21.html</id><summary type="html">&lt;p&gt;å›å®¶ä¸¤å¤©äº†ï¼Œæƒ³ç€è¯¥æ•´ç†ä¸‹ä¸‹åŠå¹´æ¥çš„ç»å†ï¼Œä»æ·±åœ³å›åˆ°å­¦æ ¡å¾…äº†ä¸€æ®µæ—¶é—´åï¼Œå› ä¸ºä¸€ä½å¸ˆå…„çš„æ¨èï¼Œæ”¶åˆ°ç½‘æ˜“HRçš„ç”µè¯è®©è¿‡å»å®ä¹ ï¼Œå·¥èµ„è™½ç„¶ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å›å®¶ä¸¤å¤©äº†ï¼Œæƒ³ç€è¯¥æ•´ç†ä¸‹ä¸‹åŠå¹´æ¥çš„ç»å†ï¼Œä»æ·±åœ³å›åˆ°å­¦æ ¡å¾…äº†ä¸€æ®µæ—¶é—´åï¼Œå› ä¸ºä¸€ä½å¸ˆå…„çš„æ¨èï¼Œæ”¶åˆ°ç½‘æ˜“HRçš„ç”µè¯è®©è¿‡å»å®ä¹ ï¼Œå·¥èµ„è™½ç„¶å°‘çš„å¯æ€œï¼Œä¸è¿‡æƒ³æƒ³å­¦æ ¡è¿™è¾¹æ ¡æ‹›åŸºæœ¬éƒ½ç»“æŸäº†ä¸å¦‚å…ˆå›å»äº†ï¼Œåæ­£å¿«å¹´åº•äº†ä¹Ÿè¦å›å®¶ï¼Œé¡ºä¾¿ä¹Ÿçœ‹çœ‹ç½‘æ˜“æ­å·ç ”ç©¶é™¢æ˜¯ä¸ªä»€ä¹ˆæ ·å­ï¼Œèµ·äº†ä¸ªè¿™ä¹ˆç‰›é€¼çš„åå­—ï¼Œç¬‘ã€‚
å®ä¹ çš„è¿‡ç¨‹ä¸ç®—æ„‰å¿«ï¼Œåé¢æ…¢æ…¢åæ§½ï¼Œä¸€å¤©çœ‹æŸæ‹›è˜ç½‘ç«™ï¼ŒæŠ•äº†ç™¾å§“ç½‘å’Œå¦å¤–ä¸€å®¶åŒ—äº¬å…¬å¸çš„SAå²—ï¼Œæ‹¿åˆ°ä¸¤å®¶offerçš„æ—¶å€™ï¼Œä¹Ÿå°±ç¦»èŒå›å®¶äº†ï¼ŒåŒ—äº¬å…¬å¸çš„ç”µè¯é¢è¯•è¾ƒå¿«æ·èˆ’æœï¼Œæ²¡å¤ªå¤šå¥½è¯´çš„ï¼Œç™¾å§“ç½‘çš„é¢è¯•ç»å†è¿˜æ˜¯ååˆ†æœ‰è¶£çš„ï¼Œæœ‰è®©äººèµçš„ç‚¹ä¹Ÿæœ‰è®©äººä¸èˆ’æœçš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;h3&gt;ç½‘æ˜“æ­å·ç ”ç©¶é™¢å®ä¹ ç»å†&lt;/h3&gt;
&lt;p&gt;&lt;img alt="å¬è¯´è¿™æ˜¯ä¼å“¥" src="/assets/images/2023/20230302150939.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æœ€æ—©å¬è¯´ç½‘æ˜“ç ”ç©¶é™¢æ˜¯åœ¨&lt;a href="http://teahour.fm/2014/03/17/interview-with-binghe.html"&gt;teahourå¬å†°æ²³çš„è®¿è°ˆ&lt;/a&gt;ï¼Œæƒ³è¿™åœ°æ–¹åº”è¯¥ä¸é”™ï¼Œè‡³å°‘åœ¨å®ä¹ æœŸé—´æ˜¯å¯ä»¥å­¦åˆ°ç‚¹ä¸œè¥¿ã€‚æœ¬æ¥ä¸åº”è¯¥åœ¨ç¦»èŒä¹‹åè¯´â€œåè¯â€ï¼Œä¸ºäº†å„ç§å„æ ·çš„é¡¾å¿Œï¼Œä¸è¿‡æˆ‘ä¸è§‰å¾—æˆ‘è¯´çš„æ˜¯æ‰€è°“çš„åè¯ï¼Œä»¥ä¸‹åªæ˜¯åŸºäºæˆ‘è‡ªèº«ç»å†çš„å®è¯ï¼Œè€Œä¸”ä¹Ÿæ˜¯å¯¹äº‹ä¸å¯¹äººã€‚å½“ç„¶ä¹Ÿæ²¡æœ‰å…¨éƒ¨è¡¨è¿°ï¼Œæœ‰äº›äº‹æƒ…åªæ˜¯æˆ‘ä¸»è§‚çš„çŒœæƒ³ï¼Œè¿˜æ˜¯ä¸è¯´äº†ã€‚  &lt;/p&gt;
&lt;p&gt;è¿™è¾¹éƒ¨é—¨æ˜“ä¸»ï¼Œéƒ¨é—¨è°ƒæ•´ï¼Œè¿›çš„ç³»ç»Ÿè¿ç»´ç»„ï¼Œäº”ä¸ªåœ¨èŒå‘˜å·¥ï¼Œä¸€å¼€å§‹å°±æˆ‘ä¸€ä¸ªå®ä¹ ç”Ÿã€‚å¬è¯´æ˜¯å°ç»„åŸæœ¬ä¸ƒäººï¼Œå¼€äº†ä¸€ä¸ªäººï¼Œè½¬å²—ä¸€ä¸ªäººï¼Œåˆæ¥äº†ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„ä¸šåŠ¡ï¼Œéš¾æ€ªå¤§å®¶éƒ½å¿™æˆç‹—ã€‚å…ˆè¯´è¯´åšäº†å“ªäº›äº‹æƒ…ï¼Œå­¦ä¹ äº†å†…éƒ¨çš„åŸºç¡€æ–‡æ¡£ï¼Œå†™äº†å‡ ä»½å†…éƒ¨éœ€æ±‚çš„shellè„šæœ¬ï¼Œç»ƒæ‰‹äº†ä¸€äº›ä¸»æœºçš„åŸºç¡€æ“ä½œï¼Œè¿™äº›ä¸¤ä¸‰å¤©å°±åšå¥½çš„äº‹æƒ…ï¼Œç»å†äº†ä¸€ä¸ªæœˆï¼Œè¯´ç™½äº†ï¼Œè¿˜æ˜¯æ²¡äººç®¡æˆ‘ï¼Œå¸¦æˆ‘çš„å¯¼å¸ˆå¿™çš„å¾ˆï¼Œæˆ‘ä¹Ÿå°±ç®¡è‡ªå·±æŸ¥é˜…å’Œå¸æ”¶å†…éƒ¨èƒ½å¤Ÿçœ‹åˆ°çš„æ–‡æ¡£èµ„æ–™ï¼ˆèƒ½å¸æ”¶çš„å°±å¸æ”¶ï¼Œè™½ç„¶æ—¥åè¦èµ°çš„ï¼Œä¸èƒ½å¸æ”¶ä¹Ÿæ²¡å¤åˆ¶ç•™å­˜ï¼ŒèŒä¸šé“å¾·è¿˜æ˜¯è¦æœ‰çš„ï¼‰ï¼Œçœ‹çš„æ²¡æœ‰ä¸œè¥¿çœ‹äº†ï¼Œå°±å¼€å§‹çœ‹æ¯•ä¸šè®¾è®¡ç›¸å…³çš„æ–‡æ¡£äº†ã€‚  &lt;/p&gt;
&lt;p&gt;åé¢çœ‹å®åœ¨å¤ªæ²¡è¶£äº†ï¼Œä¹Ÿä¸èƒ½åƒç™½é¥­å˜›ï¼Œå°±è¦æ±‚å€¼ç­ï¼Œå³å½“å®¢æœã€‚ã€‚ä¸€å¼€å§‹è¿˜æŒºæœ‰æ–°é²œåŠ²ï¼Œæ¯å½“QAå¦¹å­æ‰¾æˆ‘çš„æ—¶å€™ï¼Œéƒ½æ¿€åŠ¨ä¸å·²ï¼Œç»†å¿ƒæœåŠ¡ï¼Œæœ€å–œæ¬¢ä¸€äº›éæŠ€æœ¯éƒ¨é—¨çš„å¦¹å­ï¼Œä¸Šç­æ— èŠçš„æ—¶å€™èŠèŠå¤©ä¹Ÿæ˜¯æå¥½çš„ã€‚ä¸è¿‡å¶å°”ä¹Ÿä¼šé‡åˆ°ä¸å°‘å‚»é€¼å¼€å‘äººå‘˜ï¼ˆå½“ç„¶éƒ½æ˜¯ç”·çš„ï¼Œå¥³çš„é‚£å«è ¢èŒè ¢èŒï¼‰ä¸Šæ¥é—®æ€ä¹ˆsshç™»é™†ã€nginxè§„åˆ™æ€ä¹ˆé…ç½®ç­‰ç­‰é—®é¢˜ã€‚æƒ³æƒ³è‡ªå·±å¦‚æœåœ¨è¿™ç§åœ°æ–¹å…¥èŒï¼Œè¦åšå€¼ç­å®¢æœè‡³å°‘ä¸€ã€ä¸¤å¹´ï¼Œè¿˜å¥½å½“åˆæ²¡æœ‰ç›´æ¥ç»™æˆ‘å‘offerè®©æˆ‘ç­¾ä¸‰æ–¹ï¼Œè°¢å¤©è°¢åœ°ã€‚åœ¨è¿™ç§å¤§å…¬å¸ï¼Œè¿˜æ˜¯ä¸šåŠ¡ä¸ºå…ˆï¼ŒKPIä¸ºå…ˆï¼Œä»–ä»¬å¥½åƒå°±æ˜¯å–œæ¬¢è®©å·¥ä½œå˜çš„æ— è¶£ï¼ŒåŒæ—¶å› ä¸ºä¸€äº›å†å²åŸå› ã€å†å²åŒ…è¢±ï¼Œå¾ˆå¤šæ˜æ‘†ç€çš„é—®é¢˜æ²¡äººæ„¿æ„å»æ¨åŠ¨è§£å†³ã€‚  &lt;/p&gt;
&lt;p&gt;æ‹¿åˆ°å…¶ä»–offerï¼ŒèŒå‘ç¦»èŒå›å®¶è¿‡å¹´çš„æ„æ„¿ï¼Œæ°å¥½æ€»ç›‘å¤§äººè¯´æˆ‘å’Œåé¢æ¥å®ä¹ çš„å¦¹å­å¯¹æ¯”æ€åº¦ä¸å¤Ÿå¥½ï¼ˆæ¯å¤©6ç‚¹å‡†æ—¶ä¸‹ç­å¤ªæ—©äº†ï¼Œåœ¨æ­ç ”ï¼Œ12ç‚¹å‰çš„åŠ ç­éƒ½ä¸ç®—æ˜¯åŠ ç­ä½ ä»¬é€ å—ï¼‰ä¸æƒ³å†çœ‹åˆ°æˆ‘ï¼Œäºæ˜¯é©¬ä¸Šèµ°äººã€‚  &lt;/p&gt;
&lt;p&gt;å¦å¤–åœ¨è¿™è¾¹ä¹Ÿé‡åˆ°ä¸€ä¸ªé†‰äººçš„éƒ¨é—¨ç§˜ä¹¦ï¼Œè§ä¸‹å›¾ï¼š
&lt;img alt="å®ä¹ ç”ŸçœŸçš„å¾ˆæ— è¾œã€‚ã€‚" src="/assets/images/2023/20230302151026.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å®ä¹ æœŸé—´è¿˜æ”¶åˆ°é˜¿é‡Œæ·˜å®æŠ€æœ¯ä¿éšœéƒ¨çš„é¢è¯•ï¼Œèµ°äº†å‡ è½®ï¼Œå‰åå†æ—¶2ä¸ªå¤šæœˆï¼Œæœ€åå†ä¸‰å‚¬æ ¡ç…§å®¢æœï¼Œä¸€åˆ†é’Ÿå†…ç»™äº†æˆ‘ä¸ªæ‹’ä¿¡ï¼Œè¦åŸå› ï¼Œå…ˆæ˜¯è¯´ç¬¬äºŒæ‰¹æ‹›è˜è–ªèµ„å®¡æ ¸ä¸‹ä¸æ¥ï¼ˆå®¡æ‰¹ä¸ä¸‹æ¥ä½ æ‹›ä¸ªå•¥å­äººå˜›ï¼‰ï¼Œå†é—®ï¼Œæ”¹å£è¯´ç»¼åˆè¯„å®šæˆ‘èƒ½åŠ›é—®é¢˜ï¼Œä»–è¯´ä¸è¡Œå°±ä¸è¡Œå§ï¼Œ20å¤šå²ä¹Ÿä¸ç€æ€¥å¾€é˜¿é‡Œè¿™ä¸ªçº¢è‰²å¤§ç†”ç‚‰è·³ï¼Œå€’æ˜¯æµªè´¹äº†æˆ‘å¾ˆå¤šç”µè¯è´¹ã€‚HRé¢çš„HRå§å§æ¥æ“¦å±è‚¡åšäº†å¾ˆå¤šå·¥ä½œï¼Œä¸æƒ³ç»™å¥¹å†æ·»éº»çƒ¦ï¼Œå…¶ä»–ç»†èŠ‚å°±ä¸è¯´äº†ã€‚
&lt;img alt="è¯è¯´æœ‰åŒå­¦é¢çš„è½®æ•°æ¯”æˆ‘å¤šå—" src="/assets/images/2023/20230302151051.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;ç™¾å§“ç½‘é¢è¯•ç»å†&lt;/h3&gt;
&lt;p&gt;æœ€æ—©äº†è§£åˆ°ç™¾å§“ç½‘æ˜¯å› ä¸ºv2exä¸Šçš„ä¸€äº›æ‹›è˜å¸–å­ï¼Œçœ‹èµ·æ¥æ°›å›´è¿˜æŒºä¸é”™çš„ï¼Œæœ¬èº«ä¹Ÿæ¯”è¾ƒå–œæ¬¢è¿™ç§è§„æ¨¡çš„å’Œæ°›å›´çš„å…¬å¸ï¼Œè®©äººå‘å¾€ã€‚&lt;br&gt;
åœ¨æŸæ‹›è˜ç½‘ç«™ä¸ŠæŠ•äº†ç®€å†ï¼ŒHRå‘æ¥ç¬”è¯•é¢˜ï¼Œç¬”è¯•é¢˜ç›®å¦‚ä¸‹ï¼Œæ„Ÿè§‰ç›¸æ¯”æŸäº›å…¬å¸çš„æ™ºåŠ›é¢˜å‡ºçš„è¿˜æ˜¯ä¸é”™çš„ã€‚  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœè®©ä½ æ­ä¸€ä¸ªç™¾å§“ç½‘,ä½ ä¼šéœ€è¦å“ªäº›ç”¨é€”çš„æœåŠ¡å™¨,å„å¤šå°‘å°,ä»€ä¹ˆæ ·çš„é…
ç½®,è¿è¡Œä»€ä¹ˆè½¯ä»¶?å¦‚æœéœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡çš„ä¹Ÿè¯·ä¸€å¹¶åˆ—å‡ºã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç™¾å§“ç½‘æ˜¯LAMPæ¶æ„ï¼Œå¦å¤–åœ¨infoqä¸Šæœ‰ä¸ªæ¼”è®²ï¼Œåœ¨slideä¸­å¯ä»¥ä¸€çª¥ç™¾å§“ç½‘çš„æ¶æ„ï¼Œæ„Ÿè§‰ä¸­è§„ä¸­çŸ©ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æœ‰ç”¨æˆ·åæ˜ è¯´ä»–ä¸èƒ½è®¿é—®æˆ‘ä»¬ç½‘ç«™,è€Œä½ æ˜¯ç³»ç»Ÿå·¥ç¨‹å¸ˆ,ä½ å‡†å¤‡åˆ†å“ªå‡ æ­¥æ¥æ‰¾
åˆ°é—®é¢˜?&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¸¸è§çš„é—®é¢˜ï¼ŒæŒ‰ç…§ç»éªŒå’Œæ€ç»´ä¹ æƒ¯å›ç­”ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åˆ—ä¸¾ä½ æœ€å–œæ¬¢çš„ä¸€ä¸ªå¼€æºè½¯ä»¶å¹¶è¯´æ˜ç†ç”±ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç•¥&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç°æœ‰webæœåŠ¡çš„è®¿é—®æ—¥å¿—webaccess.log,å½¢å¼å¦‚ä¸‹:
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;200 123.190.216.50 - shanghai.baixing.com [03/Mar/2013:03:59:59 +0800] &amp;quot;GET
/menpiao/a250632202.html HTTP/1.1&amp;quot; &amp;quot;http://shanghai.baixing.com/menpiao/&amp;quot;
&amp;quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)&amp;quot; 9175 384 54237......
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç°éœ€è¦ä»ä¸­åˆ†åˆ«æå–æ‰€æœ‰åŒ…å«â€œGooglebotâ€å’Œâ€œBaiduspiderâ€,ä¸”é404æ‰“å¤´çš„è¡Œ,åˆ†åˆ«ä¿å­˜åˆ°ä»¥è®¿é—®æ—¥
æœŸåˆ†å‰²çš„æ–‡ä»¶ä¸­å¹¶å‹ç¼©,å¦‚googlebot.2013-03-03.log.bz2å’Œbaiduspider.2013-03-03.log.bz2ã€‚è¯·ç”¨bash shell,å¹¶ä»¥æœ€ä¼˜çš„æ–¹å¼å®ç°è¿™æ®µè„šæœ¬ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="ch"&gt;#!/bin/bash&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$#&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-ne&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Usage: &lt;/span&gt;&lt;span class="nv"&gt;$0&lt;/span&gt;&lt;span class="s2"&gt; logfile_name spiders_user_agent&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;exit&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;fi&lt;/span&gt;

&lt;span class="nv"&gt;LOG_FILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;
&lt;span class="nv"&gt;UA&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$2&lt;/span&gt;
&lt;span class="nv"&gt;lowUA&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$UA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;tr&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;A-Z&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a-z&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;
grep&lt;span class="w"&gt; &lt;/span&gt;-v&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;^404&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$LOG_FILE&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$UA&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;awk&lt;span class="w"&gt; &lt;/span&gt;-F&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;[:[]&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;{ outFile=&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$lowUA&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;quot;$2&amp;quot;.log&amp;quot;; gsub(/\//, &amp;quot; &amp;quot;, outFile); print $0 &amp;gt;&amp;gt; outFile}&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;file&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$lowUA&lt;/span&gt;.*.log&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;do&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;bzip2&lt;span class="w"&gt; &lt;/span&gt;-z&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nv"&gt;newname&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nv"&gt;$lowUA&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.&amp;quot;&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;echo&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;xargs&lt;span class="w"&gt; &lt;/span&gt;-i&lt;span class="w"&gt; &lt;/span&gt;date&lt;span class="w"&gt; &lt;/span&gt;+&lt;span class="s2"&gt;&amp;quot;%Y-%m- %d&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;{}&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;.log.bz2&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;mv&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$file&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;quot;.bz2&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$newname&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;
&lt;span class="k"&gt;done&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æˆ‘æ˜¯è¿™æ ·ç›´æ¥æ‰“åˆ°æ–‡ä»¶é‡Œï¼Œå†™èµ·æ¥æ–¹ä¾¿ç‚¹ï¼Œå¦å¤–ä¸ºäº†è€ƒè™‘è„šæœ¬çš„é€šç”¨æ€§ï¼Œæ²¡æœ‰æŠŠGooglebot å’ŒBaiduspideræ”¾åˆ°ä¸€ä¸ªè„šæœ¬é‡Œåˆ¤æ–­ï¼Œå†™æˆè¿™æ ·é€šç”¨çš„è„šæœ¬æ›´æ–¹ä¾¿ç‚¹å§ï¼Œæ–¹ä¾¿ä»¥åå¤„ç†ä»€ä¹ˆæœç‹—ï¼Œ360ï¼ŒBingï¼Œæœæœå•¥çš„ã€‚ä¸è¿‡è¿™æ ·é¢‘ç¹IOå¸¦æ¥çš„ä»£ä»·è‚¯å®šå¾ˆå¤§ï¼Œè¿˜è¦ä¼˜åŒ–çš„è¯ï¼Œå°±æŠŠä¸­é—´çš„ä¸´æ—¶æ–‡ä»¶æ”¾åˆ° /dev/shm/ ä¸€ä¸ªå¯¹åº”çš„ç›®å½•ä¸‹å§ã€‚  &lt;/p&gt;
&lt;p&gt;å‘äº†ç¬”è¯•ç­”å·çš„å½“å¤©ä¸‹åˆHRå°±çº¦äº†é¢è¯•æ—¶é—´ã€‚&lt;br&gt;
å‡ å¤©åçš„ä¸€ä¸ªæ—©æ™¨èµ¶åˆ°ä¸Šæµ·äº¤å¤§æŸæ ¡åŒºæ—è¾¹çš„å¤§å¦æ¥å—é¢è¯•ã€‚ç¬¬ä¸€ä¸ªé¢è¯•å®˜å¾ˆNiceï¼ŒèŠå¾—å¾ˆè½»æ¾ã€‚ç¬¬äºŒä¸ªé¢è¯•å®˜èŠçš„ä¹Ÿè¿˜å¼€å¿ƒï¼Œå±…ç„¶é—®æˆ‘æ˜¯ä¸æ˜¯å¤„å¥³åº§=ã€‚=ã€‚ç¬¬ä¸‰ä¸ªé¢è¯•å®˜è®©äººå¾ˆä¸èˆ’æœï¼Œè¯´çš„è¿‡åˆ†ç‚¹ï¼Œç”šè‡³è§‰å¾—æœ‰ç‚¹ä¸å°Šé‡äººï¼Œä»–æŠ“ä½ä¸€ä¸ªé—®é¢˜æ­»ç£•åˆ°åº•ï¼Œå¯èƒ½è¿™æ˜¯ä»–çš„é¢è¯•é£æ ¼ï¼Œä¸è¿‡ä¹Ÿå­¦åˆ°äº†ï¼Œé¢è¯•è€…åœ¨é¢è¯•ä¸­åº”è¯¥æ›´åŠ ä¸»åŠ¨ä¸€äº›ï¼Œå¯¹ä¸å¥½çš„çŠ¶æ€åº”è¯¥åŠæ—¶æ‰“æ–­åˆ‡æ¢è½¬ç§»ï¼Œé˜²æ­¢ä¸€ç›´å¤„äºæ¯”è¾ƒè¢«åŠ¨çš„å±€åŠ¿ã€‚ç¬¬ä¸‰é¢ä¸‹æ¥åƒé¥­çš„å¿ƒæƒ…éƒ½æ²¡äº†ï¼Œååœ¨ä¸€è§’ä¼‘æ¯ã€å–æ°´ã€‚è¿‡äº†å¾ˆä¹…ï¼Œå¿«ç¡ç€çš„æ—¶å€™PPå§è¿‡æ¥ï¼Œç»™äº†offerï¼ŒèŠäº†è–ªèµ„ï¼ˆè®¡ç®—å¾ˆéº»çƒ¦ï¼Œæ²¡è®°ä½ï¼‰ï¼Œå¦ç™½å¯¹äºè–ªèµ„ä¸å¤ªèƒ½æ¥å—ï¼Œæƒ³å›å»è€ƒè™‘ã€‚  &lt;/p&gt;
&lt;p&gt;å›æ¥çš„è·¯ä¸Šæ”¶åˆ°åŒ—äº¬å…¬å¸çš„offerã€‚  &lt;/p&gt;
&lt;p&gt;åæ¥é€‰æ‹©ä¸æ¥å—ç™¾å§“ç½‘çš„offeræ—¶ï¼Œè¾ƒçº ç»“ï¼Œç™¾å§“ç½‘çš„å…¬å¸æ°›å›´ç¡®å®æ˜¯ä¸é”™çš„ï¼Œç›¸ä¿¡ä¹Ÿæ˜¯é€‚åˆæˆ‘æ¯•ä¸šåå·¥ä½œå’Œå­¦ä¹ çš„ï¼Œæ•´ä¸ªé¢è¯•æµç¨‹è¿˜ç®—èˆ’æœï¼Œè–ªèµ„ä¸Šå…¶å®è¿˜è¡Œï¼ˆåæ¥ç”µè¯è¿‡æ¥é‡æ–°è°ˆäº†è–ªèµ„ï¼‰ï¼Œåªæ˜¯æˆ‘é‚£ä¸€é¢—åŒ—æ¼‚çš„å¿ƒã€‚ã€‚ã€‚è¿˜æ˜¯æŒºå»ºè®®æ„¿åœ¨ä¸Šæµ·å‘å±•çš„åŒå­¦é€‰æ‹©è¿™å®¶å…¬å¸ã€‚  &lt;/p&gt;
&lt;p&gt;14å¹´å°±è¿™æ ·é©¬ä¸åœè¹„çš„è¿œå»äº†ã€‚  &lt;/p&gt;</content><category term="2015"></category><category term="career"></category></entry><entry><title>OpenSSHçš„AuthorizedKeysCommandé€‰é¡¹</title><link href="https://fangpsh.github.io/posts/2015/2015-01-05.html" rel="alternate"></link><published>2015-01-05T00:00:00+08:00</published><updated>2015-01-05T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-01-05:/posts/2015/2015-01-05.html</id><summary type="html">&lt;p&gt;&lt;img alt="openssh" src="https://www.openssh.com/images/openssh.gif"&gt;&lt;/p&gt;
&lt;p&gt;Debian jessie å†»ç»“äº†ï¼Œä»Šå¹´å°±è¦releaseï¼Œopenssh-server åŒ…ä¹Ÿä»6.0 å‡åˆ°6.7ï¼ŒAuthorizedKeysCommand å’ŒAuthorizedKeysCommandUser è¿™ä¸¤ä¸ªé…ç½®é€‰é¡¹æ˜¯åœ¨6.2çš„æ—¶å€™å¼•å…¥çš„ï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”¨ä¸Šäº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;wheezy (stable)ï¼š1:6.0p1-4+deb7u2&lt;/li&gt;
&lt;li&gt;wheezy-backportsï¼š 1:6 â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="openssh" src="https://www.openssh.com/images/openssh.gif"&gt;&lt;/p&gt;
&lt;p&gt;Debian jessie å†»ç»“äº†ï¼Œä»Šå¹´å°±è¦releaseï¼Œopenssh-server åŒ…ä¹Ÿä»6.0 å‡åˆ°6.7ï¼ŒAuthorizedKeysCommand å’ŒAuthorizedKeysCommandUser è¿™ä¸¤ä¸ªé…ç½®é€‰é¡¹æ˜¯åœ¨6.2çš„æ—¶å€™å¼•å…¥çš„ï¼Œæ‰€ä»¥ä¹Ÿèƒ½ç”¨ä¸Šäº†ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;wheezy (stable)ï¼š1:6.0p1-4+deb7u2&lt;/li&gt;
&lt;li&gt;wheezy-backportsï¼š 1:6.6p1-4~bpo70+1&lt;/li&gt;
&lt;li&gt;jessie (testing) ï¼š 1:6.7p1-3&lt;/li&gt;
&lt;li&gt;sid (unstable) ï¼š 1:6.7p1-3&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;AuthorizedKeysCommand å¯ä»¥æŒ‡å®šè¿è¡Œä¸€ä¸ªè„šæœ¬ï¼Œè€Œè¿™ä¸ªè„šæœ¬ä¸»è¦æ˜¯å¯»æ‰¾ç™»å½•ç”¨æˆ·çš„publickeyï¼Œé»˜è®¤ä¼ å‚ä¸ºç™»å½•ç”¨æˆ·åï¼Œè‹¥æœªè®¤è¯æˆåŠŸï¼Œå°†ç»§ç»­ä½¿ç”¨AuthorizedKeysFileæ–‡ä»¶æ¥åšè®¤è¯ã€‚AuthorizedKeysCommandUserå°±æ˜¯æŒ‡å®šä»¥ä»€ä¹ˆç”¨æˆ·æ¥è¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚
è¿™ä¸¤ä¸ªé…ç½®é€‰é¡¹çš„ä¸€ä¸ªç”¨å¤„å°±æ˜¯åœ¨ç”¨æˆ·ç®¡ç†ä¸Šå¯ä»¥ä¸å†ä¾é æœ¬åœ°ç®¡ç†ï¼Œè€Œå¯ä»¥é€šè¿‡è„šæœ¬è¯»å–è¿œç¨‹æ•°æ®åº“ç³»ç»Ÿä¸­çš„ç”¨æˆ·çš„publickeyè¿›è¡Œè®¤è¯ï¼Œä¾‹å¦‚MySQLæˆ–è€…LDAPï¼Œè¿™æ ·çš„è¯ï¼Œæ›´ä¾¿äºç”¨æˆ·çš„é›†ä¸­ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ›´å¤šå‚è€ƒ &lt;a href="https://web.archive.org/web/20170106015909mp_/http://www.openbsd.org/cgi-bin/man.cgi/OpenBSD-current/man5/sshd_config.5?query=sshd_config&amp;amp;sec=5&amp;amp;arch=i386"&gt;SSHD_CONFIG(5) File Formats Manual&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;MySQL&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢è¿™ä¸ªä¾‹å­å–è‡ªOpenSSH 6.2 ã§è¿½åŠ ã•ã‚ŒãŸæ©Ÿèƒ½ã‚’è©¦ã™Â¶. å¦‚æœæ˜¯Debiançš„ç³»ç»Ÿéœ€è¦ç¡®ä¿æœåŠ¡å™¨ä¸Šçš„openssh-serverç‰ˆæœ¬åœ¨6.2ä¹‹ä¸Šã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;mysqlåˆ›å»ºæ•°æ®è¡¨ï¼š
mysql&amp;gt; create database authorizedkeys;
mysql&amp;gt; use authorizedkeys;
mysql&amp;gt; create table authorizedkeys(username text , publickey text);
mysql&amp;gt; insert into authorizedkeys values(&amp;#39;fps&amp;#39;,&amp;#39;ssh-rsa AAA....xOr+WVPFsH/npVrvz/w== fangpeishi&amp;#39;); #æ·»åŠ ç”¨æˆ·çš„publickeyåˆ°æ•°æ®è¡¨ä¸­

AuthorizedKeysCommandè°ƒç”¨çš„è„šæœ¬ï¼š/etc/key.sh
#!/bin/sh
/usr/bin/mysql -uroot authorizedkeys -sNe &amp;quot;select publickey from authorizedkeys where username=&amp;#39;$1&amp;#39;&amp;quot;

/etc/ssh/sshd_configé…ç½®æ–‡ä»¶ï¼š
...
AuthorizedKeysCommand /etc/key.sh
AuthorizedKeysCommandUser root #ä»¥rootç”¨æˆ·è°ƒç”¨è„šæœ¬
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æµ‹è¯•ä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;  # service ssh stop åœæ­¢æœåŠ¡
  # /usr/sbin/ssh -ddd è¿›è¡Œdebugï¼Œè¿è¡Œä¹‹åå°è¯•è¿œç¨‹ç™»å½•ï¼ŒæŸ¥çœ‹æ—¥å¿—ä¿¡æ¯å¦‚ä¸‹
  ...
  ...
  debug1: temporarily_use_uid: 0/0 (e=0/0)
  debug3: Running AuthorizedKeysCommand: &amp;quot;/etc/ssh/key.sh fps&amp;quot; as &amp;quot;root&amp;quot;
  debug1: restore_uid: 0/0
  debug1: temporarily_use_uid: 0/0 (e=0/0)
  debug1: matching key found: file /etc/ssh/key.sh, line 1 RSA 00:11:26:ba:28:bc:fc:9c:da:f7:d0:ff:ee:64:fa:e2
  debug1: restore_uid: 0/0
  debug3: mm_answer_keyallowed: key 0x7fb2576727c0 is allowed
  ...
  ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3&gt;LDAP&lt;/h3&gt;
&lt;p&gt;è¿™ä¸œè¥¿æ²¡æŠ˜è…¾è¿‡ï¼Œä¸ç†Ÿæ‚‰ï¼Œçœ‹ä¸¤ä¸ªä¾‹å­å§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20170106015909mp_/http://jmorano.moretrix.com/2013/09/openssh-6-2-x-ldap-authentication/"&gt;OpenSSH 6.2.x and LDAP authentication&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20170106015909mp_/http://www.sysadmin.org.au/index.php/2012/12/authorizedkeyscommand/"&gt;sshd AuthorizedKeysCommand&lt;/a&gt; æ„æ€éƒ½å·®ä¸å¤šï¼Œéƒ½æ˜¯æ‰§è¡Œè„šæœ¬ï¼Œä»serverä¸Šè¿œç¨‹æ‹¿åˆ°keyç„¶ååšè®¤è¯ã€‚&lt;/li&gt;
&lt;/ul&gt;</content><category term="2015"></category><category term="openssh"></category></entry><entry><title>Markdown åˆ¶ä½œå¹»ç¯ç‰‡ä¸ç¼–å†™æ–‡æ¡£</title><link href="https://fangpsh.github.io/posts/2015/2015-01-03.html" rel="alternate"></link><published>2015-01-03T23:00:41+08:00</published><updated>2015-01-03T23:00:41+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-01-03:/posts/2015/2015-01-03.html</id><summary type="html">&lt;p&gt;ä»ä½¿ç”¨markdownä¸€å¼€å§‹ï¼Œç¼–è¾‘å™¨ä¸€ç›´åœ¨æ¢ï¼ˆè¿˜åŠ¨æ‰‹å†™è¿‡ä¸€ä¸ªç®€å•çš„å®æ—¶é¢„è§ˆç¼–è¾‘å™¨ã€‚ã€‚ç”¨æ­£åˆ™åšæ¸²æŸ“å¤„ç†ï¼Œæ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼‰ï¼Œ&lt;br&gt;
ä»windowsä¸‹çš„markdownpadï¼Œåˆ°linuxä¸‹çš„retextï¼Œharoopadï¼Œä»¥åŠåœ¨ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä»ä½¿ç”¨markdownä¸€å¼€å§‹ï¼Œç¼–è¾‘å™¨ä¸€ç›´åœ¨æ¢ï¼ˆè¿˜åŠ¨æ‰‹å†™è¿‡ä¸€ä¸ªç®€å•çš„å®æ—¶é¢„è§ˆç¼–è¾‘å™¨ã€‚ã€‚ç”¨æ­£åˆ™åšæ¸²æŸ“å¤„ç†ï¼Œæ•ˆæœä¸æ˜¯å¾ˆå¥½ï¼‰ï¼Œ&lt;br&gt;
ä»windowsä¸‹çš„markdownpadï¼Œåˆ°linuxä¸‹çš„retextï¼Œharoopadï¼Œä»¥åŠåœ¨çº¿çš„stackedit.ioï¼Œdillinger.ioç­‰ï¼Œåæ¥é€‰æ‹©ä½¿ç”¨emacs+æœ¬åœ°ç›‘æ§å’Œæ¸²æŸ“å·¥å…·ï¼ˆä¾‹å¦‚nodejså†™çš„markdown serverä¹‹ç±»çš„ï¼‰ï¼Œåˆ°ç›®å‰é€‰æ‹©ç¼–è¾‘å™¨ï¼ˆemacsï¼‰+pandocï¼Œè¿˜æ˜¯ååˆ†èˆ’æœå’Œä¾¿æ·çš„ã€‚å¦å¤–macä¸‹çš„å¤§åé¼é¼mouä¸€ç›´æ²¡æœ‰æœºä¼šä½¿ç”¨:(&lt;/p&gt;
&lt;p&gt;pandocçš„å¼ºå¤§å°±ä¸å¤šè¯´äº†ï¼Œå¤§å®¶æœ‰å…´è¶£çœ‹çœ‹å®˜ç½‘é‚£å¼ è½¬æ¢å›¾ï¼š&lt;a href=""&gt;http://johnmacfarlane.net/pandoc/&lt;/a&gt;&lt;br&gt;
pandocçš„å®‰è£…å•¥çš„ä¹Ÿå°±ç•¥è¿‡äº†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥çœ‹çœ‹é˜³å¿—å¹³è€å¸ˆçš„ï¼š&lt;br&gt;
&lt;a href="http://www.yangzhiping.com/tech/pandoc.html"&gt;Markdownå†™ä½œè¿›é˜¶ï¼šPandocå…¥é—¨æµ…è°ˆ&lt;/a&gt; ,é‡Œè¾¹ä¹Ÿæœ‰ä¸€äº›åŸºç¡€çš„ä½¿ç”¨æ•™ç¨‹ã€‚&lt;br&gt;
å¦å¤–å»ºè®®è¿‡ä¸€é pandocçš„markdownçš„è¯­æ³•ï¼š&lt;a href="http://pages.tzengyuxio.me/pandoc/"&gt;Pandocâ€™s Markdown è¯­æ³•ä¸­æ–‡ç¿»è¯‘&lt;/a&gt;  &lt;/p&gt;
&lt;h2&gt;åˆ¶ä½œå¹»ç¯ç‰‡&lt;/h2&gt;
&lt;p&gt;åŸºæœ¬å¯ä»¥å‚è€ƒè¿™ä¸¤ç¯‡æ–‡ç« ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.soimort.org/posts/165/"&gt;Markdown+Pandocâ†’HTMLå¹»ç¯ç‰‡é€Ÿæˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://johnmacfarlane.net/pandoc/demo/example9/producing-slide-shows-with-pandoc.html"&gt;Producing slide shows with Pandoc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦å¤–éœ€è¦è¡¥å……ä¸¤ç‚¹ï¼Œ  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå¹»ç¯ç‰‡ä¸­æœ‰ä»£ç ï¼Œè€Œéœ€è¦ä»£ç é«˜äº®æ—¶ï¼Œå¯ä»¥çœ‹çœ‹&lt;a href="http://martin-thoma.com/how-to-print-source-code-with-latex/"&gt;How to print Source Code with LaTeX&lt;/a&gt;ï¼ŒåŸºæœ¬é‡Œè¾¹æåˆ°çš„è¯­è¨€å¤§éƒ½æ˜¯æ”¯æŒçš„ï¼Œåˆ°æ—¶å€™åœ¨ä»£ç å—å¤„æŒ‡æ˜å³å¯ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœè¾“å‡ºä¸ºbeamerçš„æ—¶å€™å¯èƒ½ä¼šé‡åˆ°ä¸­æ–‡å­—ä½“çš„é—®é¢˜ï¼Œè§£å†³çš„æ–¹æ³•ä¹Ÿå°±æ˜¯ä½¿ç”¨è‡ªå®šä¹‰çš„æ¨¡æ¿ï¼Œå¹¶åœ¨å…¶ä¸­æŒ‡å®šä¸­æ–‡å­—ä½“äº†ï¼Œç½‘ç»œä¸Šæœ‰å¾ˆå¤šä¸é”™çš„ä¸­æ–‡çš„beameræ¨¡æ¿å¯ä»¥é‡‡ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹pandocé»˜è®¤çš„beameræ¨¡æ¿ï¼Œè¿™é‡Œè´´ä¸€ä»½ï¼Œä¸çŸ¥æ˜¯ä»ä½•å¤„å‚è€ƒçš„ï¼Œå¿˜è®°äº†å‡ºå¤„ï¼šhttps://gist.github.com/fangpsh/6822e5fc6a21f21a5a51 ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±æœ¬æœºçš„æƒ…å†µä¿®æ”¹å…¶ä¸­çš„ä¸­æ–‡å­—ä½“é€‰é¡¹ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;ç¼–å†™æ–‡æ¡£&lt;/h2&gt;
&lt;p&gt;ä¸€å¼€å§‹é€‰æ‹©ä½¿ç”¨pandocè½¬æ¢ä¸ºpdfï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒæ”¯æŒç›®å½•ç´¢å¼•ï¼Œåœ¨XXæ¸¸æˆå®ä¹ é‚£ä¼šï¼Œç¼–å†™çš„æ–‡æ¡£è¶…è¿‡ä¸€ç™¾é¡µäº†ï¼Œæ²¡æœ‰ç›®å½•å®åœ¨ä¸æ–¹ä¾¿ï¼Œæ‰¾äº†ä¸€åœˆç”¨äº†pandocï¼Œè€Œä¸”é…åˆlatexæ¨¡æ¿ï¼Œå¯ä»¥åšæ¯”è¾ƒå¥½çš„æ’ç‰ˆï¼Œï¼ˆlatexè¿™ç§å¤æ‚çš„ä¸œè¥¿æ²¡æ¯…åŠ›å­¦ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æ‹¿ç½‘å‹å…±äº«çš„æ¨¡æ¿ï¼‰ã€‚  &lt;/p&gt;
&lt;p&gt;å…·ä½“å¯ä»¥å‚è€ƒè¿™ä¸¤ç¯‡ï¼š  &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://readus.org/2014/07/02/pandoc-convert-chinese-pdf/"&gt;pandocè½¬æ¢ä¸­æ–‡pdfæ”»ç•¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://afoo.me/posts/2013-07-10-how-to-transform-chinese-pdf-with-pandoc.html"&gt;pandocä¸­æ–‡pdfè½¬æ¢æ”»ç•¥&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸­æ–‡å­—ä½“ç›¸å…³çš„é—®é¢˜ä»¥ä¸Šä¸¤ä¸ªé“¾æ¥ä¸­éƒ½æœ‰æåˆ°äº†ï¼ŒæŒ‰ç…§å¯¹åº”çš„æµç¨‹è§£å†³å³å¯ï¼Œä¸è¿‡æ³¨æ„ç¬¬äºŒä¸ªé“¾æ¥ä¸­LiHei Proå¥½åƒå¯¹ç®€ä½“æ”¯æŒæœ‰é—®é¢˜ï¼Œæ‰€ä»¥å¤§å®¶å¯ä»¥çœ‹çœ‹æœ¬æœºä¸Šå®‰è£…çš„ä¸­æ–‡å­—ä½“ï¼Œç„¶åé€‰é¡¹ä¸€ä¸ªåˆé€‚çš„æŒ‡å®šå³å¯ã€‚è¿™é‡Œä¹Ÿè´´ä¸€ä»½æ¨¡æ¿ï¼Œä¹Ÿæ˜¯ç›´æ¥ä½¿ç”¨ä¸€ä»½ç½‘å‹çš„æ¨¡æ¿ï¼ˆå‡ºå¤„æ‰¾ä¸åˆ°ï¼‰:&lt;br&gt;
https://gist.github.com/fangpsh/5cc11fa503f1e9eda2c1  &lt;/p&gt;</content><category term="2015"></category><category term="markdown"></category></entry><entry><title>è¿ç»´ç¬”è®°ç‰‡æ®µ</title><link href="https://fangpsh.github.io/posts/2015/2015-01-01.html" rel="alternate"></link><published>2015-01-01T00:00:00+08:00</published><updated>2015-01-01T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2015-01-01:/posts/2015/2015-01-01.html</id><summary type="html">&lt;p&gt;å¸®åŒäº‹è¿ç§»ä¸€ä¸ªNå¹´å‰çš„wordpressç«™ï¼ˆ http://52ml.net ï¼‰ï¼Œè¿ç§»åæ•°æ®åº“ä½¿ç”¨mariadbï¼Œmariadbçš„socketé»˜è®¤ç›‘å¬åœ¨  0.0.0.0:3306ä¸Šï¼Œä½†æ˜¯wpæ— æ³•è¿æ¥ï¼ˆæœ¬åœ°å’Œè¿œç¨‹æµ‹è¯•è¿æ¥æ²¡é—®é¢˜ï¼‰ï¼Œéœ€è¦åœ¨/etc/my.cnfä¸­æ·»åŠ ï¼šbind-address=localhostã€‚å¦ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;å¸®åŒäº‹è¿ç§»ä¸€ä¸ªNå¹´å‰çš„wordpressç«™ï¼ˆ http://52ml.net ï¼‰ï¼Œè¿ç§»åæ•°æ®åº“ä½¿ç”¨mariadbï¼Œmariadbçš„socketé»˜è®¤ç›‘å¬åœ¨  0.0.0.0:3306ä¸Šï¼Œä½†æ˜¯wpæ— æ³•è¿æ¥ï¼ˆæœ¬åœ°å’Œè¿œç¨‹æµ‹è¯•è¿æ¥æ²¡é—®é¢˜ï¼‰ï¼Œéœ€è¦åœ¨/etc/my.cnfä¸­æ·»åŠ ï¼šbind-address=localhostã€‚å¦å¤–  è€ç‰ˆæœ¬çš„wpè¿ç§»ï¼Œå»ºè®®æ”¾å¼ƒæ•´ä½“è¿ç§»ï¼Œå¯¼æ•°æ®ï¼Œå¤‡ä»½é…ç½®æ–‡ä»¶å’Œå›¾ç‰‡ï¼Œç„¶åé‡å®‰è£…ä¸»é¢˜å’Œæ’ä»¶ã€‚    &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Testlinkè¿ç§»ï¼Œä¿®æ”¹æ•°æ®åº“é…ç½®é¡¹ç›®ï¼Œé™¤äº†æ›´æ–°è‡ªå®šä¹‰é…ç½®é¡¹ä¸­çš„custom_config.inc.phpä¸­çš„$tlCfg-&amp;gt;log_path ä¸$g_repositoryPathç­‰è‡ªå®šä¹‰é…ç½®ï¼Œå¦å¤–éœ€è¦ä¿®æ”¹php.iniä¸­ session.auto_start = 0ï¼Œå¦åˆ™æ— æ³•ç™»å½•ã€‚  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ä¸ºapache æ·»åŠ spdyæ”¯æŒï¼Œå¦‚æœæ˜¯2.2ï¼Œä½¿ç”¨å®˜æ–¹æ¨¡å—ï¼Œå¦‚æœæ˜¯2.4+ï¼Œæ”¾å¼ƒæŠ˜è…¾ï¼Œgithubä¸Šä¸ªäººforkçš„æ”¯æŒ2.4çš„æ¨¡å—æœ‰ä¸å°‘bugã€‚  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;nginxåšå‰ç«¯åå‘ä»£ç†éœ€è®¾ç½®client_max_body_size ï¼Œä»¥ä¾¿ä¼ å¤§æ–‡ä»¶ã€‚å¦å¤–Nginxçš„é…ç½®ï¼Œ"nginxä»…ä»…æ£€æŸ¥è¯·æ±‚çš„â€œHostâ€å¤´ä»¥å†³å®šè¯¥è¯·æ±‚åº”ç”±å“ªä¸ªè™šæ‹Ÿä¸»æœºæ¥å¤„ç†ã€‚å¦‚æœHostå¤´æ²¡æœ‰åŒ¹é…ä»»æ„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œæˆ–è€…è¯·æ±‚ä¸­æ ¹æœ¬æ²¡æœ‰åŒ…å«Hostå¤´ï¼Œé‚£nginxä¼šå°†è¯·æ±‚åˆ†å‘åˆ°å®šä¹‰åœ¨æ­¤ç«¯å£ä¸Šçš„é»˜è®¤è™šæ‹Ÿä¸»æœºã€‚"  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Centos 7å¦‚æœä½¿ç”¨ä»“åº“ä¸­çš„nginxåŒ…ï¼Œéœ€è¦æ³¨æ„sytemdçš„å¯¹åº”serviceæ–‡ä»¶ä¸­æŒ‡å®šçš„pidè·¯å¾„ä¸nginx.confä¸­æŒ‡å®šçš„è·¯å¾„æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸åŒéœ€è¦ä¿®æ”¹ä¸ºç›¸åŒï¼Œæ›¾ç»åœ¨sysytemdçš„é‚®ä»¶åˆ—è¡¨ä¸­çœ‹è¿‡è¿™ä¸ªé—®é¢˜ï¼Œæ²¡æƒ³åˆ°åŠå¹´åè‡ªå·±ä¹Ÿé‡åˆ°äº†ã€‚  &lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Nginxé…ç½®ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Server{
    listen 80;
    server_name a.foo.com
                b.foo.com
                c.foo.com
    return 301 https://$server_name/$request_uri;
   #return 301 https://$host/$request_uri;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ— è®ºè®¿é—®a.foo.comè¿˜æ˜¯b.foo.comï¼Œc.foo.comï¼Œéƒ½å°†è½¬åˆ° https://a.foo.com/ ï¼Œserver_nameåªå–ç¬¬ä¸€ä¸ªï¼Œå¦å¤–å¦‚æœç”¨æ­£åˆ™çš„è¯ä¾‹å¦‚ï¼šserver_name ~^(a|b|c).foo.comï¼Œé‚£è½¬å‘å±…ç„¶æ˜¯ https://~^(a|b|c).foo.com  ã€‚ã€‚ã€‚ã€‚ã€‚
server_nameæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå­˜å‚¨çš„æ˜¯é…ç½®ä¸­è®¾ç½®çš„ç¬¬ä¸€æ¡server_nameçš„é…ç½®é¡¹ï¼Œåº”è¯¥æ”¹ç”¨$hostã€‚  &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$host
    in this order of precedence: host name from the request line, or host name from the â€œHostâ€ request header field, or the server name matching a request 
$server_name
    name of the server which accepted a request 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;è¿ç§»LDAPï¼Œphpldapaminæ˜¾ç¤º &lt;code&gt;This base cannot be created with PLA&lt;/code&gt;ï¼Œäºæ˜¯æ‰‹åŠ¨åˆ›å»ºbaseï¼Œå¯æ˜¯ldapadd æ—¶å€™æç¤º&lt;code&gt;ldap_bind: Invalid credentials (49)&lt;/code&gt;ï¼Œä»”ç»†æ£€æŸ¥å¹¶googleäº†åŠå¤©ï¼Œæœ€åæ ¹æ®åŒäº‹å‘æ¥çš„è„šæœ¬ï¼Œå‘ç°æ˜¯æ²¡æœ‰æŒ‡å®šä¸»æœºå’Œç«¯å£é€ æˆçš„ã€‚ã€‚orzã€‚&lt;/p&gt;
&lt;p&gt;base.ldif&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;dn: dc=lol,dc=com
objectclass: dcObject
objectclass: organization
dc: lol
o: lol
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ldapadd -h ldap.lol.com -p 389 -D &amp;quot;cn=admin,dc=lol,dc=com&amp;quot; -W -x -a  -c -f base.ldif
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;hr&gt;
&lt;p&gt;ganglia å•æ’­æ¨¡å¼ä¸‹ï¼Œä¸€äº›å›¾ç‰‡æ˜¾ç¤ºä¸å…¨ï¼Œè¿™æ˜¯ç”±äºgangliaå®‰è£…å¥½åé»˜è®¤æ˜¯ç»„æ’­ï¼Œä¸ºäº†é™ä½ç½‘ç»œè´Ÿæ‹…ï¼Œé»˜è®¤çš„send_metadata_intervalä¸º0ï¼ˆ3.1.xç‰ˆæœ¬ä¹‹åï¼‰ï¼Œç„¶è€Œå•æ’­æ¨¡å¼ä¸‹ï¼Œå¦‚æœsend_memta_intervalè®¾ç½®ä¸º0ï¼ˆé»˜è®¤ä¸º0ï¼‰gmodåªä¼šåœ¨å¯åŠ¨çš„æ—¶å€™å‘æ¥æ”¶çš„gmodå‘é€å…ƒæ•°æ®ï¼ˆåŒ…å«çš„åº¦é‡ä¿¡æ¯ï¼Œä¸æ˜¯ç›‘æ§çš„æ•°æ®åŒ…ï¼‰ã€‚
æ‰€ä»¥éœ€è¦å°†send_memta_intervalè®¾ç½®ä¸ºé0ï¼Œä¾‹å¦‚30ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Gangliaçš„åº¦é‡æŒ‡æ ‡ä»ä»–çš„å…ƒæ•°æ®é—´éš”å‘é€å¾—åˆ°çš„ã€‚å…ƒæ•°æ®åŒ…å«è¯¸å¦‚åº¦é‡åˆ†ç»„ï¼Œç±»å‹ç­‰ç­‰ã€‚å‡å¦‚ä½ é‡å¯äº†æ¥æ”¶çš„gmondä¸»æœºï¼Œé‚£ä¹ˆå…ƒæ•°æ®å°±ä¼šä¸¢å¤±ï¼Œgmondå°±ä¸çŸ¥é“å¦‚ä½•å¤„ç†åº¦é‡æ•°æ®ï¼Œå› æ­¤ä¼šæŠŠä»–ä»¬æŠ›å¼ƒã€‚è¿™ä¼šå¯¼è‡´ç”Ÿæˆç©ºç™½çš„å›¾è¡¨ã€‚åœ¨ç»„æ’­æ¨¡å¼ä¸‹ï¼Œgmondså¯ä»¥å’Œå…¶ä»–ä»»æ„ä¸€å°ä¸»æœºé€šä¿¡ï¼Œåœ¨å…ƒæ•°æ®ä¸¢å¤±æƒ…å†µè¯·æ±‚é‡æ–°è·å–ã€‚ä½†è¿™åœ¨å•æ’­æ¨¡å¼ä¸‹æ˜¯ä¸å¯èƒ½çš„ï¼Œå› æ­¤ä½ éœ€è¦å‘½ä»¤gmondå®šæœŸçš„å‘é€å…ƒæ•°æ®ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;</content><category term="2015"></category><category term="linux"></category></entry><entry><title>å°è¯•è§£å†³openSUSEä¸‹zypperè½¯ä»¶åŒ…åç§°è‡ªåŠ¨è¡¥å…¨çš„é—®é¢˜</title><link href="https://fangpsh.github.io/posts/2014/2014-12-16.html" rel="alternate"></link><published>2014-12-16T11:13:19+08:00</published><updated>2014-12-16T11:13:19+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2014-12-16:/posts/2014/2014-12-16.html</id><summary type="html">&lt;p&gt;ä¸€å¹´å‰ä»debian æ¢åˆ°openseseçš„æ—¶å€™ï¼Œå¾ˆä¸ä¹ æƒ¯zypperåœ¨å®‰è£…è½¯ä»¶åŒ…çš„æ—¶å€™ä¸èƒ½è‡ªåŠ¨è¡¥å…¨ï¼Œæ·»åŠ åˆ°todolisté‡Œé¢ï¼Œåæ¥åœç”¨evernote ç»™å¿˜è®°äº†ï¼Œå‰å‡ å¤©ä¸Šå»æ•´ç†ç¬”è®°å‘ç°äº†ï¼Œæ‰€ä»¥å°è¯•æ€§å¾—è§£å†³äº†ä¸‹ï¼Œå¦å¤– â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;ä¸€å¹´å‰ä»debian æ¢åˆ°openseseçš„æ—¶å€™ï¼Œå¾ˆä¸ä¹ æƒ¯zypperåœ¨å®‰è£…è½¯ä»¶åŒ…çš„æ—¶å€™ä¸èƒ½è‡ªåŠ¨è¡¥å…¨ï¼Œæ·»åŠ åˆ°todolisté‡Œé¢ï¼Œåæ¥åœç”¨evernote ç»™å¿˜è®°äº†ï¼Œå‰å‡ å¤©ä¸Šå»æ•´ç†ç¬”è®°å‘ç°äº†ï¼Œæ‰€ä»¥å°è¯•æ€§å¾—è§£å†³äº†ä¸‹ï¼Œå¦å¤–é¡ºå¸¦ä¿®äº†ä¸€ä¸ªå°bugï¼Œå½“æœ¬åœ°repoè¶…è¿‡10æ¡æ—¶ï¼ŒåŸæ¥è„šæœ¬ç”Ÿæˆçš„è‡ªåŠ¨è¡¥å…¨åˆ—è¡¨ä¸å…¨çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;bashè‡ªå¸¦è¡¥å…¨åŠŸèƒ½ï¼Œè¦è¾¾åˆ°æ›´å¥½çš„è¡¥å…¨æ•ˆæœéœ€è¦å®‰è£…bash-completionè¿™ä¸ªè½¯ä»¶åŒ…ï¼Œç„¶åç¼–å†™å¯¹åº”çš„è¡¥å…¨è„šæœ¬ã€‚å…³äºbash-completionçš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸¤ä¸ªé“¾æ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://kodango.com/bash-competion-programming"&gt;ç¼–å†™ Bash è¡¥å…¨è„šæœ¬&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.debian-administration.org/article/317/An_introduction_to_bash_completion_part_2"&gt;An introduction to bash completion: part 2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è½¯ä»¶åŒ…åè¯çš„è‡ªåŠ¨è¡¥å…¨é—®é¢˜ä¸»è¦å°±æ˜¯æ€ä¹ˆå¿«é€Ÿçš„è·å–è½¯ä»¶åŒ…çš„åç§°ï¼Œç„¶åä½œä¸ºåˆ—è¡¨ä¾›é€‰ã€‚
ä¸€å¼€å§‹æˆ‘æ˜¯ç”¨zypper search æ¥è·å–ï¼Œé€Ÿåº¦ä¸å ªå¿å—ï¼Œï¼ˆapt-get,aptitude ç­‰çš„è‡ªåŠ¨è¡¥å…¨è„šæœ¬æ˜¯ç”¨apt-cacheæ¥è·å–ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;zypper seæ–¹å¼çš„è„šæœ¬ç‰‡æ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;install&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;info&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;download&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="p"&gt;[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;echo&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;POSIX&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$ZYPPER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;se&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$curl&lt;/span&gt;&lt;span class="s2"&gt;*&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1,5&amp;#39;&lt;/span&gt;d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;tr&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
remove&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;rm&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="p"&gt;[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;echo&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;POSIX&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$ZYPPER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;se&lt;span class="w"&gt; &lt;/span&gt;-i&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$curl&lt;/span&gt;&lt;span class="s2"&gt;*&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;/dev/null&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1,5&amp;#39;&lt;/span&gt;d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;tr&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
update&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;up&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="p"&gt;[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;echo&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;POSIX&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$ZYPPER&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;list-updates&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;1,4&amp;#39;&lt;/span&gt;d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;|&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;3&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;tr&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;åæ¥çœ‹äº†ä¸‹libzyppï¼Œåˆçœ‹åˆ° zypp-NameReqPrv è¿™ä¸ªå·¥å…·ï¼Œè¯•äº†ä¸‹ï¼Œé€Ÿåº¦å¿«äº†ä¸€äº›ï¼ŒåŸºæœ¬å¯ä»¥ç”¨äº†ï¼Œä¸è¿‡æ„Ÿè§‰è¿˜ä¸æ˜¯å¤ªç†æƒ³ï¼Œç‰¹åˆ«æ˜¯zypper install çš„æ—¶å€™ï¼Œå¦‚æœåˆ—è¡¨ç”Ÿæˆçš„æ•°ç»„è¿‡å¤§ï¼Œè¿˜æ˜¯æœ‰ç‚¹å¡é¡¿ï¼Œç“¶é¢ˆåœ¨è¦å¯¹zypp-NameReqPrvçš„è¾“å‡ºç»“æœåšè¿‡æ»¤ã€‚&lt;br&gt;
ä¸çŸ¥é“è¿˜æœ‰æ²¡æœ‰æ›´å¿«çš„æ–¹å¼æ¥è·å–è½¯ä»¶åˆ—è¡¨ï¼Œéš¾é“åªèƒ½ä½¿ç”¨libzyppæ¥ç¼–å†™ï¼Ÿ&lt;br&gt;
å¦å¤–å¦‚æœä½¿ç”¨zshï¼Œå¹¶ä¸”ä½¿ç”¨äº†on-my-zshçš„è¯å¥½åƒæ˜¯å¯ä»¥è‡ªåŠ¨è¡¥å…¨ã€‚ç¬¬ä¸€æ¬¡è¡¥å…¨æ—¶ä¼šæœ‰æ˜æ˜¾çš„å¡é¡¿ï¼Œåé¢å†ä½¿ç”¨å°±å¾ˆæµç•…äº†ï¼Œå¯èƒ½åšäº†ç¼“å­˜ï¼Ÿ ä¸çŸ¥é“æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œå¯ä»¥å­¦ä¹ å­¦ä¹ ï¼Œç„¶åè¿ç§»åˆ°bashä¸‹ã€‚  &lt;/p&gt;
&lt;p&gt;zypp-NameReqPrv æ–¹å¼çš„è„šæœ¬ç‰‡æ®µï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;install&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;in&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;info&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;download&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="p"&gt;[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;echo&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;POSIX&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$ZYPPNameReqPrv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;-E&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;^ï¼»:blank:ï¼½*[0-9]+ï¼»:blank:ï¼½+&lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="s2"&gt;[a-Z0-9]*-&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;                           &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;-r&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/-[0-9]+\..*//&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;sort&lt;span class="w"&gt; &lt;/span&gt;-u&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;

remove&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;rm&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;update&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;up&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;if&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;test&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-n&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;then&lt;/span&gt;
&lt;span class="w"&gt;                &lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="o"&gt;=(&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;opts&lt;/span&gt;&lt;span class="p"&gt;[@]&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="k"&gt;$(&lt;/span&gt;echo&lt;span class="p"&gt;;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;LC_ALL&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;POSIX&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$ZYPPNameReqPrv&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;--installed&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;grep&lt;span class="w"&gt; &lt;/span&gt;-E&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;^ï¼»:blank:ï¼½*[0-9]+ï¼»:blank:ï¼½+&lt;/span&gt;&lt;span class="nv"&gt;$cur&lt;/span&gt;&lt;span class="s2"&gt;[a-Z0-9]*-&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="se"&gt;\&lt;/span&gt;
&lt;span class="w"&gt;                              &lt;/span&gt;cut&lt;span class="w"&gt; &lt;/span&gt;-d&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39; &amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;-f&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;6&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;sed&lt;span class="w"&gt; &lt;/span&gt;-r&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;s/-[0-9]+\..*//&amp;#39;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;sort&lt;span class="w"&gt; &lt;/span&gt;-u&lt;span class="k"&gt;)&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="k"&gt;fi&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä½¿ç”¨openSUSE + bash çš„åŒå­¦å¯ä»¥è¯•ä¸€è¯•ï¼ŒæŠŠ&lt;a href="https://gist.github.com/fangpsh/86e13a771ccea24a206b"&gt;è¿™ä»½è„šæœ¬&lt;/a&gt;æ‹·è´è‡³ &lt;code&gt;/etc/bash_completion.d/&lt;/code&gt; ä¸‹ ã€‚&lt;/p&gt;</content><category term="2014"></category><category term="opensuse"></category><category term="bash"></category></entry><entry><title>Debian 8 å‡çº§ç›¸å…³ä¿¡æ¯</title><link href="https://fangpsh.github.io/posts/2014/2014-09-17.html" rel="alternate"></link><published>2014-09-17T17:42:30+08:00</published><updated>2014-09-17T17:42:30+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2014-09-17:/posts/2014/2014-09-17.html</id><summary type="html">&lt;h2&gt;Debian7-8æ›´æ–°ä¸å˜åŒ–&lt;/h2&gt;
&lt;h3&gt;Debian Installer Jessie Alpha 1 release&lt;/h3&gt;
&lt;p&gt;2014å¹´3æœˆ19å·ï¼Œdebian installer jessie alpha 1å‘å¸ƒï¼Œæ‘˜å½•éƒ¨åˆ†æ›´æ–°ä¸å˜åŒ–å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;apt-setup: Avoid hang due to interactive apt-cdrom&lt;a href="https://bugs.debian.org/740673"&gt;#740673&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;grub-installer: Support menu selection of GRUB boot disk&lt;a href="https://bugs.debian.org/706112"&gt;#706112&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The ia64 architecture has been removed from the archive â€¦&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;h2&gt;Debian7-8æ›´æ–°ä¸å˜åŒ–&lt;/h2&gt;
&lt;h3&gt;Debian Installer Jessie Alpha 1 release&lt;/h3&gt;
&lt;p&gt;2014å¹´3æœˆ19å·ï¼Œdebian installer jessie alpha 1å‘å¸ƒï¼Œæ‘˜å½•éƒ¨åˆ†æ›´æ–°ä¸å˜åŒ–å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;apt-setup: Avoid hang due to interactive apt-cdrom&lt;a href="https://bugs.debian.org/740673"&gt;#740673&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;grub-installer: Support menu selection of GRUB boot disk&lt;a href="https://bugs.debian.org/706112"&gt;#706112&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The ia64 architecture has been removed from the archive, and is no longer supported.&lt;/li&gt;
&lt;li&gt;The Linux kernel has been updated from 3.2 to 3.13.(æ³¨ï¼šdebian 8çš„å†…æ ¸ç‰ˆæœ¬å°†ä¸º3.16)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒé“¾æ¥ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://www.debian.org/devel/debian-installer/News/2014/20140319"&gt;Releae NEWS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lists.debian.org/debian-devel-announce/2014/03/msg00009.html"&gt;Debian Installer Jessie Alpha 1 release&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Linux Knernel&lt;/h3&gt;
&lt;p&gt;Debian 8 é»˜è®¤å†…æ ¸ç‰ˆæœ¬å°†ä¸º3.16ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;amp;px=MTc1MDg"&gt;Debian 8.0 Jessie Is Settling For Linux 3.16&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://lists.debian.org/debian-kernel/2014/07/msg00361.html"&gt;Kernel version for jessie&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Systemd&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://wiki.debian.org/ReleaseGoals/systemd"&gt;Add native systemd support to every package shipping a sysvinit script&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Debian 8å°†é‡‡ç”¨systemdä½œä¸ºé»˜è®¤initç³»ç»Ÿ,åŒæ—¶systemdå°†å…¼å®¹Debianä»“åº“ä¸­çš„æ‰€æœ‰åŒ…å«sysvè„šæœ¬çš„è½¯ä»¶åŒ…ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Native systemd support for every Debian package that currently contains sysv scripts.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;debian 8 sysvinitä¸systemdçš„åˆ‡æ¢&lt;/h4&gt;
&lt;p&gt;ç›®å‰debian testingï¼ˆ2014-07-29ï¼‰ä»ç„¶é‡‡ç”¨sysvä½œä¸ºé»˜è®¤initç³»ç»Ÿï¼Œéœ€æ‰‹åŠ¨å®‰è£…è½¯ä»¶åŒ…ç­‰åˆ‡æ¢è‡³systemdã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;apt-get&lt;span class="w"&gt; &lt;/span&gt;update

$&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;apt-get&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;systemd&lt;span class="w"&gt; &lt;/span&gt;

&lt;span class="c1"&gt;#å®‰è£… systemd-sysv åè‡ªåŠ¨å°†systemdé…ç½®ä¸ºé»˜è®¤initç³»ç»Ÿï¼Œ&lt;/span&gt;
&lt;span class="c1"&gt;#åŒæ—¶ç§»é™¤sysvinit-core&lt;/span&gt;
$&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;apt-get&lt;span class="w"&gt; &lt;/span&gt;install&lt;span class="w"&gt; &lt;/span&gt;systemd-sysv&lt;span class="w"&gt; &lt;/span&gt;

$&lt;span class="w"&gt; &lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;reboot
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡å¯ä¹‹åï¼ŒæŸ¥çœ‹PID=1çš„è¿›ç¨‹æ˜¯&lt;code&gt;/sbin/init&lt;/code&gt;ï¼Œå†æŸ¥çœ‹ &lt;code&gt;/sbin/init&lt;/code&gt;ä¼šå‘ç°æ˜¯&lt;code&gt;/lib/systemd/systemd&lt;/code&gt;çš„è½¯é“¾æ¥ï¼Œè‡³æ­¤ï¼Œç³»ç»Ÿé»˜è®¤initsystemå·²åˆ‡æ¢è‡³systemdã€‚åœ¨debian 8 æ­£å¼ç‰ˆå‘å¸ƒä¹‹åï¼Œå°†é‡‡ç”¨systemdä½œä¸ºé»˜è®¤initç³»ç»Ÿï¼Œå¯èƒ½ä¸éœ€è¦ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢ã€‚&lt;/p&gt;
&lt;h4&gt;systemdå…¼å®¹æ€§ä¸æ³¨æ„äº‹é¡¹&lt;/h4&gt;
&lt;p&gt;systemdçš„SySVå…¼å®¹æ€§å†…å®¹è¯·æŸ¥çœ‹ è¯¦ç»†ä»‹ç»-ç³»ç»Ÿç®¡ç†-SysVå…¼å®¹æ€§ä¸€èŠ‚ï¼ŒåŒ…å«init scriptçš„æ³¨æ„äº‹é¡¹ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„äº‹é¡¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;systemdå®šä¹‰äº†ä¸€æ‰¹é…ç½®æ–‡ä»¶ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†ä»‹ç»-ç³»ç»Ÿç®¡ç†-è§„èŒƒåŒ–çš„é…ç½®æ–‡ä»¶ä¸€èŠ‚ã€‚&lt;/li&gt;
&lt;li&gt;systemdä¸­runlevelçš„æ¦‚å¿µè¢«targetæ›¿ä»£ï¼Œtelinitä¸initå‘½ä»¤ä»å¯ä½¿ç”¨ã€‚å…³äºtargetä¸å¯åŠ¨é¡ºåºå†…å®¹ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†ä»‹ç»-ç³»ç»Ÿç®¡ç†-Targetå’ŒDependency based bootup ä¸€èŠ‚ ä¸å¯åŠ¨åˆ†æä¸€èŠ‚ã€‚&lt;ul&gt;
&lt;li&gt;æ³¨ï¼šä½¿ç”¨systemdä¹‹å/etc/initabè¢«å¿½ç•¥ï¼Œæ‰€ä»¥ä¿®æ”¹æ­¤æ–‡ä»¶ä¸­çš„runlevelå¹¶ä¸èƒ½èµ·æ•ˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;debian with systemdä¸‹ï¼Œserviceå‘½ä»¤ä¾ç„¶å¯ç”¨ï¼Œä½†æ˜¯serviceå®é™…ä¸Šæ˜¯è°ƒç”¨systemctlå‘½ä»¤ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹è¯¦ç»†ä»‹ç»-ç³»ç»Ÿç®¡ç†-SysVå…¼å®¹æ€§ä¸€èŠ‚ã€‚&lt;ul&gt;
&lt;li&gt;æ³¨ï¼š&lt;code&gt;service foobar status&lt;/code&gt;å°†è¿”å›systemctlç±»å‹çš„statuså†…å®¹ï¼Œä¸å†æ˜¯&lt;code&gt;foobar is runing .&lt;/code&gt;æ­¤ç±»è¾“å‡ºã€‚&lt;/li&gt;
&lt;li&gt;å»ºè®®ä½¿ç”¨systemctlå‘½ä»¤æˆ–serviceå‘½ä»¤ï¼Œä¸å»ºè®®ä½¿ç”¨&lt;code&gt;/etc/init.d/&amp;lt;service&amp;gt;&lt;/code&gt;ï¼Œå› ä¸ºåè€…æ— æ³•å¤„ç†sysv initæ–‡ä»¶è¢«ç§»é™¤çš„çŠ¶å†µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;service å•å…ƒæ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰é™„å¸¦ä»»ä½•ä¸Šä¸‹æ–‡ç¯å¢ƒ,ç”šè‡³æ²¡æœ‰è¿›è¡Œ $HOME ç›®å½•çš„è®¾ç½®ã€‚å¯¹è¿™äº›æœ‰ä¾èµ–çš„å¯åŠ¨è„šæœ¬å°†æ— æ³•æ­£å¸¸å·¥ä½œã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/etc/rc.local&lt;/code&gt;ä¾ç„¶å¯ç”¨ï¼Œè§&lt;code&gt;/lib/systemd/system/rc-local.service&lt;/code&gt; å•å…ƒæ–‡ä»¶ã€‚&lt;/li&gt;
&lt;li&gt;update-rc.d å‘½ä»¤ä¾æ—§å¯ç”¨ï¼Œä½†æ˜¯æ³¨æ„ï¼šstartä¸stopé€‰é¡¹ä¸å†è¢«æ”¯æŒã€‚æŸ¥çœ‹&lt;code&gt;/usr/sbin/update-rc.d&lt;/code&gt;æ–‡ä»¶ï¼Œå¯å‘ç°å…¶å¯¹/etc/init.d/çš„å¤„ç†éƒ¨åˆ†ä»¥åŠé’ˆå¯¹systemdçš„serviceçš„å¤„ç†éƒ¨åˆ†ã€‚&lt;ul&gt;
&lt;li&gt;&lt;code&gt;systemctl enable/disable&lt;/code&gt;å‘½ä»¤å®é™…ä¸Šè°ƒç”¨update-rc.då‘½ä»¤ã€‚è‹¥ä¸å­˜åœ¨serviceå•å…ƒæ–‡ä»¶ï¼Œå°†å¯¹&lt;code&gt;/etc/init.d/&amp;lt;service&amp;gt;&lt;/code&gt;ä¸‹çš„è„šæœ¬é“¾æ¥åˆ°&lt;code&gt;/etc/rcN.d/&lt;/code&gt;ç›®å½•ä¸‹ã€‚è‹¥æ˜¯serviceå•å…ƒå­˜åœ¨ï¼Œå°†ä¾ç…§å•å…ƒæ–‡ä»¶ä¸­[Install]ä¸­çš„å†…å®¹å°†å•å…ƒæ–‡ä»¶é“¾æ¥åˆ°å¯¹åº”çš„wantsæ–‡ä»¶å¤¹ä¸­ã€‚&lt;blockquote&gt;
&lt;p&gt;update-rc.d(8) should enable/disable systemd services in addition to creating the sysvinit links. update-rc.d is usually called from maintscripts, but enable/disable is typically used by the system administrator.
systemctl enable/disable should also call update-rc.d&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/systemd/Integration"&gt;systemd Integration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ³¨ï¼šupdate-rc.dä¸­ default ç­‰åŒäº"start 2 3 4 5 . stop 0 1 6 ."ï¼Œ&lt;code&gt;update-rc.d foobar defaults&lt;/code&gt; ï¼Œæ³¨æ„defaultæ˜¯å¦ä¸è„šæœ¬ä¸­LSBéƒ¨åˆ†æŒ‡å®šçš„Startä¸Stopå­˜åœ¨å†²çªã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼šsystemdä¸æ”¯æŒäº¤äº’å¼å¯åŠ¨è„šæœ¬ï¼Œä¾‹å¦‚Debianâ€˜s X-Interactive in the LSB headerã€‚&lt;/li&gt;
&lt;li&gt;debian testingä¸­çš„systemdçš„coredumpctlä¸å¯ç”¨ï¼Œæ‰“åŒ…æ—¶å€™&lt;code&gt;--disable-coredump&lt;/code&gt;,åŸå› ä¸æ˜ã€‚&lt;/li&gt;
&lt;li&gt;é»˜è®¤æƒ…å†µä¸‹systemdçš„æ—¥å¿—journalçš„ç£ç›˜å­˜å‚¨éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•ï¼Œå¦åˆ™é‡å¯å°†ä¸¢å¤±æ—¥å¿—è®°å½•ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†ä»‹ç»æ—¥å¿—ç®¡ç†-æ—¥å¿—çš„è®°å½•ç­‰-æ—¥å¿—å­˜å‚¨ä¸€èŠ‚ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;æœ¬èŠ‚å‚è€ƒé“¾æ¥&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;amp;px=MTYwMDQ"&gt;Systemd Is The Future Of Debian&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/Debate/initsystem/systemd"&gt;Debate initsystem systemd&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/systemd"&gt;Debian Wiki:systemd&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Clang&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;Clang support as a secondary compiler.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;goal:&lt;a href="https://wiki.debian.org/ReleaseGoals/clang-secondary-compiler"&gt;Clang as a second compiler&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸€æ–¹é¢ç”±äºClangç›¸å¯¹äºGCCæœ‰æ›´å¤šç‰¹æ€§ï¼ˆæ¨¡å—åŒ–è®¾è®¡ã€æ›´å¿«çš„ç¼–è¯‘é€Ÿåº¦ã€ç¼–è¯‘è¿‡ç¨‹å ç”¨å†…å­˜ä½ã€ç¼–è¯‘ä¸­é—´äº§ç‰©å’Œæœ€ç»ˆé“¾æ¥äº§ç‰©å¤§å¹…å‡å°‘ã€ç¼–è¯‘é”™è¯¯æç¤ºå‹å¥½ç­‰ç­‰ï¼‰ï¼Œå¦ä¸€æ–¹é¢ç”±äºClangç›®å‰å·²è¶³å¤Ÿç¨³å®šä¸ä¼˜ç§€ï¼Œæ‰€ä»¥ Debian 8æ”¯æŒClangä½œä¸ºè¾…åŠ©ç¼–è¯‘å™¨ã€‚&lt;/p&gt;
&lt;p&gt;Debian ä»“åº“ä¸­çš„è½¯ä»¶åŒ…æ­£è¢«é‡æ–°ç”¨Clangè¿›è¡Œç¼–è¯‘æ‰“åŒ…ï¼Œè¿›åº¦ä¸è¯¦æƒ…è¯·æŸ¥çœ‹ &lt;a href="http://clang.debian.net/"&gt;clang.debian.net&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://clang.debian.net/"&gt;clang.debian.net&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/llvm-clang"&gt;llvm-clang&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;amp;px=MTA2NjQ"&gt;LLVM's Clang Is Almost Good Enough For Debian&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;amp;px=MTI5ODc"&gt;Debian Is Still Being Made To Build With LLVM/Clang&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Piuparts clean archive&lt;/h3&gt;
&lt;p&gt;Piupartsæ˜¯ä¸€ä¸ªdebæ‰“åŒ…çš„è´¨é‡æ£€æµ‹å·¥å…·ï¼Œåœ¨debian 8ä¸­è¦æ±‚æ‰€æœ‰è½¯ä»¶åŒ…å¿…é¡»é€šè¿‡picpartsçš„ç›¸å…³æ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;Piupartsä»‹ç»ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;piuparts is a tool for automatic testing of whether a package can be installed, upgraded, and removed. Like [Lintian], it is useful to run in a centralized fashion, in addition to each package maintainer running it manually.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Debian 8éœ€è¦è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;All packages should pass the piuparts tests, IOW that installation (and upgrade) of a package (within the test setup on piuparts.d.o) works fine and also that it purges cleanly.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/piuparts"&gt;Debian wiki:piuparts&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://wiki.debian.org/ReleaseGoals/piuparts"&gt;ReleaseGoals piuparts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;UTF-8 support&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://wiki.debian.org/ReleaseGoals/utf-8"&gt;UTF-8 support&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;four sub-goals:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;all programs should, in their default configuration, accept UTF-8 input and pass it through uncorrupted. Having to manually specify encoding is acceptable only in a programmatic interface, GUI/std{in,out,err}/ command line/plain files should work with nothing but LC_CTYPE.  &lt;/li&gt;
&lt;li&gt;all GUI/curses/etc programs should be able to display UTF-8 output where appropriate&lt;/li&gt;
&lt;li&gt;all file names in source and binary packages must be valid UTF-8&lt;/li&gt;
&lt;li&gt;all text files should be encoded in UTF-8 &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;SELinux support&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://wiki.debian.org/ReleaseGoals/SELinux"&gt;Goalï¼š&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Allow the users to enable SELinux enforcing mode on their machine without too much hassle.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Improve the SELinux reference policy, this is currently being worked out with upstream.&lt;/li&gt;
&lt;li&gt;Be sure that when a init/maintainer script is creating a file/directory the label on disk is properly (re)set.&lt;/li&gt;
&lt;li&gt;Be sure that SELinux aware applications have SELinux support enabled and that's it's working properly&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;debain 8åªæ˜¯å°†æ”¹è¿›å¯¹SELinuxçš„æ”¯æŒï¼Œç›®æ ‡å¦‚ä¸Šã€‚
debian 8è¿˜ä¸ä¼šé»˜è®¤å¯ç”¨SELinuxï¼Œdebian testingä¸Šç›®å‰é»˜è®¤æœªå®‰è£…SELinuxç³»ç»Ÿæ‰€éœ€çš„è½¯ä»¶åŒ…ï¼ˆé™¤äº†libselinux1ï¼šSELinux runtime shared librariesï¼‰ã€‚&lt;/p&gt;
&lt;h3&gt;å…¶ä»–&lt;/h3&gt;
&lt;p&gt;è¯·å‚è€ƒ&lt;a href="https://wiki.debian.org/ReleaseGoals"&gt;Release Goals&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hardening of ELF binaries (carry over from Wheezy)&lt;/li&gt;
&lt;li&gt;Debian/rules to honor CC/CXX flags&lt;ul&gt;
&lt;li&gt;This goal aims to make sure that any package in the archive could be rebuild with the command CC=foo CXX=bar dpkg-buildpackage.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cross toolchains in the archive&lt;/li&gt;
&lt;li&gt;Make the base system cross-buildable&lt;/li&gt;
&lt;li&gt;æ³¨æ„ï¼šdebian testing é»˜è®¤å…³é—­rootç”¨æˆ·sshè¿œç¨‹ç™»å½•&lt;/li&gt;
&lt;li&gt;debian testingå®‰è£…æµç¨‹åŸºæœ¬æ— å˜åŒ–ã€‚è‹¥ä¸ä½¿ç”¨ç½‘ç»œæºï¼Œtaskelä»…æœ‰ä¸”é»˜è®¤é€‰ä¸­Debian desktop environmentä¸Standard systemd utilitiesï¼›è‹¥ä½¿ç”¨ç½‘ç»œæºï¼Œtaskelé»˜è®¤é€‰ä¸­Debiandesktop ã€print serverä¸standard systemd utilitiesã€‚&lt;/li&gt;
&lt;li&gt;æ³¨ï¼šç”±äºdebian jessieç›®å‰æœªå†»ç»“ï¼Œå…³äºè½¯ä»¶åŒ…ç‰ˆæœ¬å˜åŒ–çš„è°ƒæŸ¥æœªè¿›è¡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href="https://packages.debian.org/search?keywords=mysql-server"&gt;package mysql-server&lt;/a&gt;ï¼šwheezy(stable):5.5.38-0,jessie(testing):5.5.37-1, &lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;æœ¬èŠ‚å‚è€ƒé“¾æ¥&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://lists.debian.org/debian-devel-announce/2013/10/msg00004.html"&gt;Bits from the Release Team (Jessie freeze info)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;amp;px=MTQ4NTA"&gt;Debian 8.0 To Be Frozen, Features Announced&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Debian 8 å‡çº§æ³¨æ„äº‹é¡¹&lt;/h2&gt;
&lt;h3&gt;rc.localæ‹†åˆ†ä¸ºserviceå•å…ƒ&lt;/h3&gt;
&lt;p&gt;ç›®å‰&lt;code&gt;/etc/rc.local&lt;/code&gt;æ–‡ä»¶ä¾æ—§å¯ç”¨ï¼Œsystemdå­˜åœ¨é»˜è®¤çš„rc-local.serviceå•å…ƒã€‚&lt;/p&gt;
&lt;p&gt;å¾€rc.localæ–‡ä»¶ä¸­å†™å…¥å¤§é‡çš„å¯åŠ¨åˆå§‹åŒ–è¯­å¥ä¼šå¯¼è‡´rc.localéš¾ä»¥ç»´æŠ¤ä¸ç®¡ç†ã€‚å‚è€ƒsystemdé»˜è®¤æä¾›çš„rc-local.serviceå•å…ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†åŸæœ¬å†™å…¥çš„rc.localæ–‡ä»¶åˆç†çš„æ‹†åˆ†ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œ
ä¾‹å¦‚rc-route.localï¼Œrc-screensaveroff.localç­‰ï¼Œä¸rc.localåŒæ ·ï¼Œå°†è¿™äº›localæ–‡ä»¶&lt;code&gt;chmod +x&lt;/code&gt;ã€‚ç„¶ååœ¨&lt;code&gt;/etc/systemd/system&lt;/code&gt;ä¸‹åˆ›å»ºç±»ä¼¼&lt;code&gt;rc-local.service&lt;/code&gt;çš„å•å…ƒæ–‡ä»¶ï¼Œ
ä¾‹å¦‚&lt;code&gt;rc-route.service&lt;/code&gt;,&lt;code&gt;rc-screensaveoff.service&lt;/code&gt;ç­‰ï¼Œserviceæ–‡ä»¶çš„ç¼–å†™è¯·æŸ¥çœ‹ è¯¦ç»†ä»‹ç»--è¿›ç¨‹ç®¡ç†--æœåŠ¡è¿›ç¨‹ç®¡ç†ä¸€èŠ‚ï¼Œä»¥åŠå‚è€ƒ&lt;code&gt;rc-local.service&lt;/code&gt;æ–‡ä»¶ã€‚
ç¼–å†™å¥½serviceæ–‡ä»¶ä¹‹åï¼Œé‡è½½systemdè¿›ç¨‹ï¼Œç„¶å&lt;code&gt;systemctl enable&lt;/code&gt;è¿™äº›serviceå³å¯ï¼Œåç»­è‹¥éœ€è¦ç¦ç”¨æˆ–ä¿®æ”¹æŸäº›å¯åŠ¨è„šæœ¬ï¼Œåªéœ€é…ç½®å¯¹åº”å•å…ƒä»¥åŠè„šæœ¬å³å¯ã€‚&lt;/p&gt;
&lt;h3&gt;Debian testing  systemd-208-6 CONFFLAGS&lt;/h3&gt;
&lt;p&gt;è¯·å…³æ³¨systemdæºç åŒ…ä¸‹rulesæ–‡ä»¶ä¸­ disable çš„æ¨¡å—æˆ–åŠŸèƒ½ï¼Œä¾‹å¦‚ coredumpï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;...
CONFFLAGS = \
        --with-rootprefix= \
        --with-rootlibdir=/lib/$(DEB_HOST_MULTIARCH) \
        --with-sysvinit-path=/etc/init.d \
        --with-sysvrcnd-path=/etc \
        --with-firmware-path=/lib/firmware \
        --with-debug-shell=/bin/bash \
        --with-telinit=/lib/sysvinit/telinit \
        --enable-tcpwrap \
        --disable-coredump \
        --disable-efi \
        --disable-myhostname \
        --disable-vconsole \
        --disable-silent-rules
ifeq (,$(findstring stage1,$(DEB_BUILD_PROFILES)))
CONFFLAGS += --enable-libcryptsetup
endif

CONFFLAGS_deb = \
        --enable-selinux \
        --enable-introspection \
        --enable-gtk-doc
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="2014"></category><category term="Systemd"></category><category term="Debian"></category></entry><entry><title>Scrum åˆæ¢</title><link href="https://fangpsh.github.io/posts/2014/2014-08-20.html" rel="alternate"></link><published>2014-08-20T00:00:00+08:00</published><updated>2014-08-20T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2014-08-20:/posts/2014/2014-08-20.html</id><summary type="html">&lt;p&gt;&lt;img alt="scrum01" src="/assets/images/2023/20230307110136.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä¸‰æœˆä»½å‚åŠ è…¾è®¯å¹¿ç ”åˆ›æ–°ç­çš„æ—¶å€™ï¼Œåœ¨åå·¥å¤§å­¦åŸæ ¡åŒºä¸Šäº†ä¸€èŠ‚ä¸»é¢˜ä¸ºæ•æ·è¿­ä»£å¼€å‘çš„è¯¾ç¨‹ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ° Scrum ï¼Œå¹¿ç ”çš„å¯¼ â€¦&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="scrum01" src="/assets/images/2023/20230307110136.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ä¸‰æœˆä»½å‚åŠ è…¾è®¯å¹¿ç ”åˆ›æ–°ç­çš„æ—¶å€™ï¼Œåœ¨åå·¥å¤§å­¦åŸæ ¡åŒºä¸Šäº†ä¸€èŠ‚ä¸»é¢˜ä¸ºæ•æ·è¿­ä»£å¼€å‘çš„è¯¾ç¨‹ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦åˆ° Scrum ï¼Œå¹¿ç ”çš„å¯¼å¸ˆè®²çš„æŒºå¥½ï¼Œç”¨è§†é¢‘é…åˆè…¾è®¯å†…éƒ¨å®é™…æƒ…å†µä»‹ç»äº† Scrumã€‚å‰æ®µæ—¶é—´çœ‹ç¾å‰§ â€œSilicon Valley â€œ(ç¡…è°·)ï¼Œç¬¬ä¸€å­£çš„ç¬¬äº”é›†é‡Œé‡åˆ°äº† Scrumï¼ŒJared å»ºç«‹äº†ä¸€ä¸ªå«â€œäº‰çƒâ€çš„ç®¡ç†ä½“ç³»ã€‚&lt;/p&gt;
&lt;p&gt;å€Ÿç€ç¾å‰§çº¸ä¸Šè°ˆå…µçš„å­¦ä¹ ä¸‹Scrumã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="scrum02" src="/assets/images/2023/20230307110151.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Wikipediaçš„å®šä¹‰ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Scrumæ˜¯ä¸€ç§è¿­ä»£å¼å¢é‡è½¯ä»¶å¼€å‘è¿‡ç¨‹ï¼Œé€šå¸¸ç”¨äºæ•æ·è½¯ä»¶å¼€å‘ã€‚Scrumåœ¨è‹±è¯­é‡Œæ˜¯æ©„æ¦„çƒè¿åŠ¨ä¸­äº‰çƒçš„æ„æ€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸­æ–‡å¤ªç®€å•äº†ï¼Œçœ‹ä¸‹è‹±æ–‡çš„è§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Scrum is an iterative and incremental agile software development framework for managing product development. It defines â€œa flexible, holistic product development strategy where a development team works as a unit to reach a common goalâ€. It challenges assumptions of the â€œtraditional, sequential approachâ€ to product development. Scrum enables teams to self-organize by encouraging physical co-location or close online collaboration of all team members and daily face-to-face communication among all team members and disciplines in the project.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¥½å§ï¼Œè‹±æ–‡æœ‰ç‚¹å¤æ‚å’ŒæŠ½è±¡ï¼Œç®€å•æ¥è¯´äº‰çƒï¼ˆäº‰ä¸ªçƒå•Šï¼Œè¿™ç¿»è¯‘å®åœ¨å¤ªé€—äº†ï¼šPï¼‰æ˜¯ä¸€ä¸ªé€‚åˆå›¢é˜Ÿè¿›è¡Œæ•æ·è¿­ä»£å¼€å‘çš„æ¡†æ¶ã€‚åœ¨å‰§ä¸­Jaredæåˆ°è¦æ”¹å–„å›¢é˜Ÿçš„æ²Ÿé€šï¼ŒScrum æ­£æœ‰æ”¹å–„å›¢é˜Ÿæ²Ÿé€šçš„å¥½å¤„ï¼Œå¦å¤–æ›´é‡è¦çš„æ˜¯æé«˜å›¢é˜Ÿæ•ˆç‡ï¼Œå¯¹å›¢é˜Ÿæˆå‘˜æœ‰æ¿€åŠ±ä½œç”¨ç­‰ï¼Œå¯ä»¥æ›´å¥½çš„é€‚åº”éœ€æ±‚çš„å˜æ›´ã€‚&lt;/p&gt;
&lt;h3&gt;Sprint&lt;/h3&gt;
&lt;p&gt;Scrum ç”±ä¸€ç³»åˆ—çš„ Srpintï¼ˆå†²åˆºï¼‰ç»„æˆï¼Œåœ¨æ©„æ¦„çƒæ¯”èµ›ä¸­ä¹Ÿæ­£æ˜¯ç”±ä¸æ–­çš„å†²åˆºè¿›æ”»ä»¥è¾¾åˆ°èƒœåˆ©çš„ç›®æ ‡ï¼Œä¹Ÿæœ‰ç‚¹åƒæ¥åŠ›æ¯”èµ›ä¸­çš„æ¯æ®µèµ›ç¨‹ï¼Œè§ä¸‹å›¾ï¼ˆå›¾ç‰‡æ¥æºï¼šwikipediaï¼‰ï¼š
&lt;img alt="sprint" src="/assets/images/2023/20230307110237.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ç”±ä¸Šå›¾å¯ä»¥çœ‹å‡ºä¸€ä¸ªSprintæ˜¯30å¤©ï¼Œå®é™…ä¸Šä¸€èˆ¬æ˜¯ä¸€å‘¨åˆ°ä¸€ä¸ªæœˆï¼Œå…¸å‹çš„æ˜¯2å‘¨æ—¶é—´ã€‚ä¸€æ¬¡å†²åˆºçš„æ—¶é—´è™½ç„¶çŸ­ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªå†²åˆºå®Œæˆçš„æ—¶å€™éƒ½æ˜¯çœŸæ­£çš„ â€œå®Œæˆâ€ï¼Œå³é™¤äº†ç›¸å…³æ¨¡å—åŠŸèƒ½çš„å®Œæˆï¼Œç›¸å…³æ–‡æ¡£ä¸æµ‹è¯•å·¥ä½œä¹ŸåŒæœŸå®Œæˆã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªSprintç”±ä¸€ä¸ªSprint è®¡åˆ’ä¼šè®®è€Œå¼€å§‹ï¼Œç¡®å®šå†²åˆºçš„å·¥ä½œé‡ã€å®Œæˆæ—¥æœŸç­‰ã€‚ä¸Šå›¾ä¸­å°åœˆçš„24hæ˜¯æŒ‡æ¯æ—¥çš„ä¾‹ä¼šï¼ˆç«™ç«‹ä¼šè®®ï¼‰ï¼Œå³æ¯å¤©ä¸€æ¬¡å°å†²åˆºï¼Œå›é¡¾å’Œäº†è§£å›¢é˜Ÿæˆå‘˜å½“å¤©çš„å®Œæˆæƒ…å†µç­‰ã€‚å…³äºä¼šè®®çš„ç±»å‹å’Œç®€ä»‹åæ–‡ç»§ç»­ã€‚&lt;/p&gt;
&lt;p&gt;ç®¡ç†Scrumçš„è¿‡ç¨‹å¯ä»¥åœ¨ä»»åŠ¡æ¿ä¸Šä½¿ç”¨ä¾¿åˆ©è´´ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="scrum03" src="/assets/images/2023/20230307110248.jpg"&gt;&lt;/p&gt;
&lt;p&gt;çœ‹åˆ°è¿™ä¸ªä»»åŠ¡æ¿ï¼Œè®©æˆ‘æƒ³èµ·äº†æµè¡Œçš„å›¢é˜Ÿç®¡ç†å·¥å…·â€“Trelloï¼Œå¯ä»¥åœ¨Trelloä¸Šåº”ç”¨Scrumæ¡†æ¶,æŠŠTrelloçš„Boardå½“ä½œä»»åŠ¡æ¿ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="scrum04" src="/assets/images/2023/20230307110302.jpg"&gt;&lt;/p&gt;
&lt;h2&gt;Scrum ä¸»è¦åŒ…å« ä¸‰ä¸ªè§’è‰²ã€ä¸‰ä¸ªæ–‡æ¡£ã€å››ä¸ªä¼šè®®ã€‚&lt;/h2&gt;
&lt;h3&gt;è§’è‰²&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Scrumä¸»ç®¡&lt;/li&gt;
&lt;li&gt;äº§å“è´Ÿè´£äºº&lt;/li&gt;
&lt;li&gt;å¼€å‘å›¢é˜Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Scrumä¸»ç®¡&lt;/h4&gt;
&lt;p&gt;&lt;img alt="scrum05" src="/assets/images/2023/20230307110314.jpg"&gt;&lt;/p&gt;
&lt;p&gt;Scrum ä¸»ç®¡åƒæ˜¯çƒé˜Ÿä¸­çš„æ•™ç»ƒã€‚&lt;/p&gt;
&lt;p&gt;Scrum ä¸»ç®¡ä¸æ˜¯å›¢é˜Ÿé¢†å¯¼ï¼Œå³æ•™ç»ƒä¸æ˜¯ä¸€ä¸ªä¿±ä¹éƒ¨çš„ç®¡ç†é˜¶å±‚ä¸€æ ·ï¼ŒScrumä¸»è¦è´Ÿè´£æ¸…ç†å›¢é˜Ÿçš„éšœç¢ï¼Œä¿è¯å›¢é˜Ÿè¿›åº¦çš„æ¨èï¼Œä¸å—å¤–ç•Œå¹²æ‰°ã€‚ä¸»ç®¡ä¼šæ£€æŸ¥é¡¹ç›®çš„è¿›åº¦ï¼Œåè°ƒå›¢é˜Ÿå·¥ä½œç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h4&gt;äº§å“è´Ÿè´£äºº&lt;/h4&gt;
&lt;p&gt;&lt;img alt="scrum06" src="/assets/images/2023/20230307110335.jpg"&gt;&lt;/p&gt;
&lt;p&gt;äº§å“è´Ÿè´£äººç±»ä¼¼çƒé˜Ÿä¿±ä¹éƒ¨çš„ç»ç†ã€‚&lt;/p&gt;
&lt;p&gt;äº§å“è´Ÿè´£äººä¸»è¦è´Ÿè´£äº§å“åŠŸèƒ½çš„è®¾è®¡ã€å†³å®šä»»åŠ¡ä¼˜å…ˆçº§ã€å†³å®šäº§å“å‘å¸ƒæ—¥æœŸä¸åŠŸèƒ½ç­‰ç­‰ã€‚åœ¨å‰§ä¸­æ„Ÿè§‰ Richard æ›´åƒæ˜¯äº§å“è´Ÿè´£äººï¼Œä½†æ˜¯å…¶å®ä»–ä¹Ÿæ˜¯ä¸‹æ–‡è¯´åˆ°çš„å¼€å‘å›¢é˜Ÿçš„ä¸€å‘˜ã€‚Richard æ˜¯æ•´ä¸ªå›¢é˜Ÿçš„CEOï¼Œä»–å¯¹å›¢é˜Ÿçš„åŠŸèƒ½å’Œå„é¡¹ä¸šåŠ¡ä½œå‡ºæœ€ç»ˆå†³ç­–ã€‚&lt;/p&gt;
&lt;h4&gt;å¼€å‘å›¢é˜Ÿ&lt;/h4&gt;
&lt;p&gt;&lt;img alt="scrum07" src="/assets/images/2023/20230307110355.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¼€å‘å›¢é˜Ÿå°±åƒçƒé˜Ÿçš„æˆå‘˜ï¼Œä»–ä»¬è´Ÿè´£å®Œæˆæ•´ä¸ªæ¯”èµ›ï¼Œè´Ÿè´£æ‹¼æå’Œå†²åˆºã€‚&lt;/p&gt;
&lt;p&gt;å¼€å‘å›¢é˜Ÿï¼ˆè®¾è®¡ã€æµ‹è¯•ã€ç¼–ç ç­‰ï¼‰è´Ÿè´£å›¢é˜Ÿä¸»è¦çš„å¼€å‘ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å‰§ä¸­å°±æ˜¯ä¸Šå›¾ä¸‰è€…ä¸ºå¼€å‘äººå‘˜ï¼Œè´Ÿè´£ä¸åŒçš„éƒ¨åˆ†ï¼Œåè¾¹ä¸´æ—¶å‡ºç°è¿‡ä¸€ä¸ªè´Ÿè´£äº‘è®¡ç®—çš„å¤©æ‰é»‘å®¢å°å­©ï¼Œå°±å½“æ˜¯å¤–åŒ…äººå‘˜å§~ã€‚&lt;/p&gt;
&lt;h4&gt;å…¶ä»–&lt;/h4&gt;
&lt;p&gt;&lt;img alt="scrum08" src="/assets/images/2023/20230307110410.jpg"&gt;&lt;/p&gt;
&lt;p&gt;è‡³äºå‰§ä¸­è¿™ä¸ªäºŒè´§ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå½’ç±»ï¼Œä»–ä¸ºå›¢é˜Ÿæä¾›å­µåŒ–ç©ºé—´ï¼ˆå…è´¹ä½å®¿ï¼Œè·å–%10è‚¡ä»½ï¼‰ï¼Œä¸ºæƒ³äº§å“åç§°åƒå¤§é‡å¤§éº»ï¼Œä¸ºäº§å“logoè¯·è¡—å¤´æ¶‚é¸¦äººï¼Œå’Œå¤©ä½¿æŠ•èµ„è°ˆåˆ¤ï¼Œä¸Šå°åšäº§å“å±•ç¤ºç­‰ç­‰ï¼Œä»–ä»˜å‡ºæŒºå¤šçš„ï¼Œå¯æ˜¯è¿˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆå½’ç±»ï¼Œå½’ä¸ºå¼€å‘å›¢é˜Ÿæ„Ÿè§‰å¯¹ä¸èµ·å…¶ä»–é˜Ÿå‘˜ã€‚&lt;/p&gt;
&lt;h3&gt;æ–‡æ¡£&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;äº§å“backlog&lt;/li&gt;
&lt;li&gt;å†²åˆºbacklog&lt;/li&gt;
&lt;li&gt;ç‡ƒå°½å›¾&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;äº§å“backlog&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;äº§å“è®¢å•æ˜¯æ•´ä¸ªä¸“æ¡ˆçš„æ¦‚è¦æ–‡æ¡£ã€‚äº§å“è®¢å•åŒ…æ‹¬æ‰€æœ‰æ‰€éœ€ç‰¹æ€§çš„ç²—ç•¥çš„æè¿°ã€‚äº§å“è®¢å•æ˜¯å…³äºå°†è¦ç”Ÿäº§ä»€ä¹ˆæ ·çš„äº§å“ã€‚äº§å“è®¢å•æ˜¯å¼€æ”¾çš„ï¼Œæ¯ä¸ªäººéƒ½å¯ä»¥ç¼–è¾‘ã€‚äº§å“è®¢å•åŒ…æ‹¬ç²—ç•¥çš„ä¼°ç®—ï¼Œé€šå¸¸ä»¥å¤©ä¸ºå•ä½ã€‚ä¼°ç®—å°†å¸®åŠ©äº§å“è´Ÿè´£äººè¡¡é‡æ—¶ç¨‹è¡¨å’Œä¼˜å…ˆé¡ºåºï¼ˆä¾‹å¦‚ï¼Œå¦‚æœâ€å¢åŠ æ‹¼å†™æ£€æŸ¥â€ç‰¹æ€§çš„ä¼°è®¡éœ€è¦èŠ±3å¤©æˆ–3ä¸ªæœˆï¼Œå°†å½±å“äº§å“è´Ÿè´£äººå¯¹è¯¥ç‰¹æ€§çš„æ¸´æœ›ï¼‰ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;äº§å“backlogåŒ…å«ä¸€ä¸ªéœ€æ±‚åˆ—è¡¨ï¼Œä½¿ç”¨ç”¨æˆ·æ•…äº‹æ¥è¡¨ç¤ºbacklogæ¡ç›®ï¼Œäº§å“è´Ÿè´£äººå¯¹backlogæ¡ç›®æ’åˆ—ä¼˜å…ˆçº§ç­‰ã€‚&lt;/p&gt;
&lt;h4&gt;å†²åˆº backlog&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;å†²åˆºè®¢å•ï¼ˆsprint backlogï¼‰æ˜¯å¤§å¤§ç»†åŒ–äº†çš„æ–‡æ¡£ï¼ŒåŒ…å«å›¢é˜Ÿå¦‚ä½•å®ç°ä¸‹ä¸€ä¸ªå†²åˆºçš„éœ€æ±‚çš„ä¿¡æ¯ã€‚ä»»åŠ¡è¢«åˆ†è§£ä¸ºä»¥å°æ—¶ä¸ºå•ä½ï¼Œæ²¡æœ‰ä»»åŠ¡å¯ä»¥è¶…è¿‡16ä¸ªå°æ—¶ã€‚å¦‚æœä¸€ä¸ªä»»åŠ¡è¶…è¿‡16ä¸ªå°æ—¶ï¼Œé‚£ä¹ˆå®ƒå°±åº”è¯¥è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚å†²åˆºè®¢å•ä¸Šçš„ä»»åŠ¡ä¸ä¼šè¢«åˆ†æ´¾ï¼Œè€Œæ˜¯ç”±å›¢é˜Ÿæˆå‘˜ç­¾åè®¤é¢†ä»–ä»¬å–œçˆ±çš„ä»»åŠ¡ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;img alt="scrum09" src="/assets/images/2023/20230307110430.jpg"&gt;&lt;/p&gt;
&lt;h4&gt;ç‡ƒå°½å›¾&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;ä¸€ä¸ªå…¬å¼€å±•ç¤ºçš„å›¾è¡¨ï¼Œæ˜¾ç¤ºå½“å‰å†²åˆºä¸­æœªå®Œæˆçš„ä»»åŠ¡æ•°ç›®ï¼Œæˆ–åœ¨å†²åˆºè®¢å•ä¸Šæœªå®Œæˆçš„è®¢å•é¡¹çš„æ•°ç›®
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ä¸‹å›¾ ï¼ˆæºè‡ªï¼šwikipediaï¼‰ç›´è§‚çš„åæ˜ äº†å·¥ä½œé‡çš„æƒ…å†µï¼ŒXè½´æ˜¯æ—¶é—´ï¼ŒYè½´æ˜¯å‰©ä½™å·¥ä½œé‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img alt="scrum10" src="/assets/images/2023/20230307110447.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;ä¼šè®®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Sprint è®¡åˆ’ä¼šè®®&lt;/li&gt;
&lt;li&gt;Sprint æ¯æ—¥ä¼šè®®&lt;/li&gt;
&lt;li&gt;Sprint è¯„å®¡ä¼šè®®&lt;/li&gt;
&lt;li&gt;Sprint å›é¡¾ä¼šè®®&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Sprint è®¡åˆ’ä¼šè®®&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;è®¡åˆ’ä¼šè®®åœ¨Sprintå¼€å§‹å‰è¿›è¡Œï¼Œä¸»è¦è¿›è¡Œåˆ†æè¯„ä¼°äº§å“çš„Backlogï¼Œç¡®å®šç›®æ ‡ï¼Œåˆ›å»ºSprint Backlog ï¼Œå¯¹ä»»åŠ¡åˆ†ä¼˜å…ˆçº§ï¼Œå¯¹ä»»åŠ¡å·¥ä½œé‡åšä¼°ç®—ç¡®å®šæœ¬è½®Sprintå®Œæˆæ—¥æœŸç­‰ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h4&gt;Sprint æ¯æ—¥ï¼ˆç«™ç«‹ï¼‰ä¼šè®®&lt;/h4&gt;
&lt;p&gt;åœ¨å†²åˆºä¸­ï¼Œæ¯ä¸€å¤©éƒ½ä¼šä¸¾è¡Œé¡¹ç›®çŠ¶å†µä¼šè®®ï¼Œè¢«ç§°ä¸ºâ€œscrumâ€æˆ–â€œæ¯æ—¥ç«™ç«‹ä¼šè®®â€ã€‚æ¯æ—¥ç«™ç«‹ä¼šè®®æœ‰ä¸€äº›å…·ä½“çš„æŒ‡å¯¼åŸåˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼šè®®å‡†æ—¶å¼€å§‹ã€‚å¯¹äºè¿Ÿåˆ°è€…å›¢é˜Ÿå¸¸å¸¸ä¼šåˆ¶å®šæƒ©ç½šæªæ–½ï¼ˆä¾‹å¦‚ç½šæ¬¾ï¼Œåšä¿¯å§æ’‘ï¼Œåœ¨è„–å­ä¸ŠæŒ‚æ©¡èƒ¶é¸¡ç©å…·ï¼‰&lt;/li&gt;
&lt;li&gt;æ¬¢è¿æ‰€æœ‰äººå‚åŠ ï¼Œ&lt;/li&gt;
&lt;li&gt;ä¸è®ºå›¢é˜Ÿè§„æ¨¡å¤§å°ï¼Œä¼šè®®è¢«é™åˆ¶åœ¨15åˆ†é’Ÿã€‚&lt;/li&gt;
&lt;li&gt;æ‰€æœ‰å‡ºå¸­è€…éƒ½åº”ç«™ç«‹ã€‚ï¼ˆæœ‰åŠ©äºä¿æŒä¼šè®®ç®€çŸ­ï¼‰&lt;/li&gt;
&lt;li&gt;ä¼šè®®åº”åœ¨å›ºå®šåœ°ç‚¹å’Œæ¯å¤©çš„åŒä¸€æ—¶é—´ä¸¾è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ä¼šè®®ä¸Šï¼Œæ¯ä¸ªå›¢é˜Ÿæˆå‘˜éœ€è¦å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»Šå¤©ä½ å®Œæˆäº†é‚£äº›å·¥ä½œï¼Ÿ&lt;/li&gt;
&lt;li&gt;æ˜å¤©ä½ æ‰“ç®—åšä»€ä¹ˆï¼Ÿ&lt;/li&gt;
&lt;li&gt;å®Œæˆä½ çš„ç›®æ ‡æ˜¯å¦å­˜åœ¨ä»€ä¹ˆéšœç¢ï¼Ÿï¼ˆScrumä¸»ç®¡éœ€è¦è®°ä¸‹è¿™äº›éšœç¢ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="scrum11" src="/assets/images/2023/20230307110513.jpg"&gt;&lt;/p&gt;
&lt;h4&gt;Sprint è¯„å®¡ä¼šè®®&lt;/h4&gt;
&lt;p&gt;é¡¾åæ€æ„ï¼Œå³äº§å“è´Ÿè´£äººå¯¹äº§å“è¿›è¡Œè¯„å®¡ã€‚è¯„å®¡ä¼šè®®ä¸»è¦æ˜¯å°†äº§å“å±•ç¤ºç»™äº§å“è´Ÿè´£äººï¼Œå½“ç„¶ä¹Ÿå›¢é˜Ÿå…¶ä»–äººå‘˜ä¹Ÿå¯ä»¥å‚åŠ ã€‚&lt;/p&gt;
&lt;h4&gt;Sprint å›é¡¾ä¼šè®®&lt;/h4&gt;
&lt;p&gt;æ¯ä¸€ä¸ªå†²åˆºå®Œæˆåï¼Œéƒ½ä¼šä¸¾è¡Œä¸€æ¬¡å†²åˆºå›é¡¾ä¼šè®®ï¼Œåœ¨ä¼šè®®ä¸Šæ‰€æœ‰å›¢é˜Ÿæˆå‘˜éƒ½è¦åæ€è¿™ä¸ªå†²åˆºã€‚ä¸¾è¡Œå†²åˆºå›é¡¾ä¼šè®®æ˜¯ä¸ºäº†è¿›è¡ŒæŒç»­è¿‡ç¨‹æ”¹è¿›ã€‚ä¼šè®®çš„æ—¶é—´é™åˆ¶åœ¨4å°æ—¶ã€‚&lt;/p&gt;
&lt;h2&gt;æœ€åï¼š&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨ Scrumï¼ŒRichardçš„å›¢é˜Ÿæœ‰æ¡ä¸ç´Šçš„è¿›è¡Œç€Pied Piper çš„å¼€å‘ï¼ŒGilfoyleå’ŒDineshäº’ç›¸è¾ƒåŠ²ï¼Œâ€œäº‰çƒâ€äº‰å¾—ä¸äº¦ä¹ä¹ã€‚å½“ç„¶ç¬¬å…­é›†å¼€å¤´ Scrumå°±å‡ºç°äº†ç‚¹é—®é¢˜ï¼ŒRichardæä¸å®šäº‘è®¡ç®—éƒ¨åˆ†ï¼Œå¯¼è‡´å…¶ä»–å­ä»»åŠ¡å †ç§¯ï¼Œæ‰˜æ…¢äº†è¿›åº¦ï¼ˆåƒä¸€å¤§å¨å¤§ä¾¿å µä½äº†ä¸‹æ°´é“ï¼‰ï¼Œè¿™æ˜¯åè¯ã€‚  &lt;/p&gt;
&lt;p&gt;&lt;img alt="scrum_end" src="/assets/images/2023/20230307110529.jpg"&gt;&lt;/p&gt;
&lt;h3&gt;å‚è€ƒèµ„æ–™&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://en.wikipedia.org/wiki/Scrum_%28software_development%29"&gt;Scrum (software development&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://blog.csdn.net/kesalin/article/details/7055750"&gt;Scrum å­¦ä¹ ç¬”è®°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.ithome.com.tw/node/69366"&gt;æ¯å¤©ç”¨15åˆ†é’ŸæŒæ¡å›¢é˜Ÿè¿›åº¦&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.dotblogs.com.tw/greengem/archive/2011/05/08/24500.aspx"&gt;SCRUM åˆæ¢&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è§†é¢‘ï¼š &lt;a href="https://www.youtube.com/watch?v=XU0llRltyFM"&gt;Intro to Agile Scrum in Under 10 Minutes â€“ What is Scrum?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><category term="2014"></category><category term="scrum"></category></entry><entry><title>æ­å»ºæ ‘è“æ´¾é›†ç¾¤</title><link href="https://fangpsh.github.io/posts/2014/2014-01-12.html" rel="alternate"></link><published>2014-01-12T00:00:00+08:00</published><updated>2014-01-12T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2014-01-12:/posts/2014/2014-01-12.html</id><summary type="html">&lt;p&gt;&lt;img alt="Raspberry Pi Cluster" src="/assets/images/2023/20230306153041.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¤§ä¸‰ä¸Šå­¦æœŸï¼Œæœ‰å¹¸åœ¨å°é©¬å“¥çš„å¸®åŠ©ä¸‹ç”³è¯·åˆ°èµ„é‡‘æ­å»ºæ ‘è“æ´¾é›†ç¾¤ã€‚ç²—ç³™è®°å½•ä¸‹è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2&gt;åˆè¯†æ ‘è“æ´¾&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20140811213050/http://www.leiphone.com/raspberry-pi-hands-on.html"&gt;ã€Šæ ‘è“æ´¾ä¸Šæ‰‹æŠ¥å‘Šã€‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://zh.wikipedia.org/wiki/æ ‘è“æ´¾"&gt;Wikipedia:æ ‘è“æ´¾ â€¦&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="Raspberry Pi Cluster" src="/assets/images/2023/20230306153041.jpg"&gt;&lt;/p&gt;
&lt;p&gt;å¤§ä¸‰ä¸Šå­¦æœŸï¼Œæœ‰å¹¸åœ¨å°é©¬å“¥çš„å¸®åŠ©ä¸‹ç”³è¯·åˆ°èµ„é‡‘æ­å»ºæ ‘è“æ´¾é›†ç¾¤ã€‚ç²—ç³™è®°å½•ä¸‹è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h2&gt;åˆè¯†æ ‘è“æ´¾&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20140811213050/http://www.leiphone.com/raspberry-pi-hands-on.html"&gt;ã€Šæ ‘è“æ´¾ä¸Šæ‰‹æŠ¥å‘Šã€‹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://zh.wikipedia.org/wiki/æ ‘è“æ´¾"&gt;Wikipedia:æ ‘è“æ´¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.cnblogs.com/ma6174/archive/2013/01/25/2875617.html"&gt;Raspberry Piï¼ˆæ ‘è“æ´¾ï¼‰è¯•ç”¨å°è®°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20140819084154/http://digi.tech.qq.com/a/20120908/000285.htm"&gt; å»‰ä»·è¿·ä½ Linuxæœºå™¨Raspberry Piè¯¦è§£&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒæ ·ä¾‹
 -  &lt;a href="http://www.southampton.ac.uk/~sjc/raspberrypi/pi_supercomputer_southampton.htm"&gt;pi-supercomputer&lt;/a&gt;
       åŸºæœ¬è¿‡ç¨‹å¯å‚è€ƒæœ¬æ–‡æ¡£
 - &lt;a href="http://www.zdnet.com/build-your-own-supercomputer-out-of-raspberry-pi-boards-7000015831/"&gt;build-your-own-supercomputer-out-of-raspberry-pi-boards&lt;/a&gt;
 -  www.cl.cam.ac.uk/projects/raspberrypi/&lt;/p&gt;
&lt;h2&gt;ææ–™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ ‘è“æ´¾&lt;ul&gt;
&lt;li&gt;æ’æ’&lt;/li&gt;
&lt;li&gt;SDå¡&lt;/li&gt;
&lt;li&gt;USB_microçº¿ï¼ˆä¾›ç”µï¼‰&lt;/li&gt;
&lt;li&gt;USBé€‚é…å™¨ï¼ˆ5V/1Aï½2Aï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¸¦æºUSB-HUBï¼Œä»USBç©ºä¾›ç”µ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;äº¤æ¢æœºï¼Œè·¯ç”±å™¨&lt;/li&gt;
&lt;li&gt;ç½‘çº¿&lt;/li&gt;
&lt;li&gt;ä¹é«˜ç§¯æœ¨&lt;/li&gt;
&lt;li&gt;æ•£çƒ­ç”µé£æ‰‡ï¼ˆå¯åˆ©ç”¨æœºç®±é£æ‰‡è‡ªä¸»ç»„è£…ï¼‰&lt;/li&gt;
&lt;li&gt;æ•£çƒ­ç‰‡&lt;/li&gt;
&lt;li&gt;å¯¼çƒ­ç¡…èƒ¶&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯é€‰ï¼ˆä»¥ä¸‹åšè°ƒè¯•ä¹‹ç”¨ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;HDMI-VGAè½¬æ¢å™¨&lt;/li&gt;
&lt;li&gt;é”®ç›˜&lt;/li&gt;
&lt;li&gt;é¼ æ ‡&lt;/li&gt;
&lt;li&gt;æ˜¾ç¤ºå™¨&lt;/li&gt;
&lt;li&gt;PCæœº&lt;/li&gt;
&lt;li&gt;USB-TTLçº¿&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸Šææ–™æ ¹æ®å…·ä½“è°ƒæ•´æ•°é‡ã€‚&lt;/p&gt;
&lt;h2&gt;ç»„è£…&lt;/h2&gt;
&lt;p&gt;ç³»ç»Ÿåˆ·å†™&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€‰æ‹©çš„ç³»ç»Ÿéå¸¸å¤šï¼Œæœ‰Raspbianï¼ŒArchlinuxarmï¼ŒPidoraç­‰ç­‰ï¼ŒæŒ‰éœ€é€‰æ‹©ã€‚ åˆ·ç³»ç»Ÿï¼Œä¸»è¦æ˜¯å¾€SDå¡ä¸­å†™å…¥ç³»ç»Ÿï¼ŒLinuxä¸‹å¯ä»¥ä½¿ç”¨ddå‘½ä»¤ï¼Œwindowsä¸‹å¯ä»¥ä½¿ç”¨Win32DiskImagerã€‚ å¯ä»¥å…ˆåˆ·å†™ä¸€ä¸ªSDå¡ï¼Œç„¶åè¿›è¡Œå¸¸è§„é…ç½®å’Œè‡ªå®šä¹‰é…ç½®ï¼Œæå–é•œåƒï¼Œå†å†™äººå…¶ä»–SDå¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.raspberrypi.org/downloads"&gt;å®˜æ–¹ç³»ç»Ÿé•œåƒä¸‹è½½&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;~~&lt;a href="http://mirrors.ustc.edu.cn/raspberrypi/images/"&gt;ä¸­ç§‘å¤§åŠ é€Ÿé•œåƒ&lt;/a&gt;~~&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.raspberrypi.org/help/quick-start-guide/"&gt;Quick start guid&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://mall.egoman.com.cn/index.php?option=com_content&amp;amp;view=article&amp;amp;id=99:-lab1raspberrywindows-&amp;amp;catid=47:shiyongfangan-&amp;amp;Itemid=222"&gt;æµ™å¤§è¯¾ç¨‹ï¼š Lab1:åˆè§æ ‘è“æ´¾(Raspberry)(windowså¹³å°)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;(DDå‘½ä»¤ç¤ºä¾‹) &lt;a href="http://zhangshenjia.com/it/raspberry_pi/mac-raspbian"&gt;macä¸‹ç»™æ ‘è“æ´¾å®‰è£…raspbianç³»ç»Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;ç§¯æœ¨æ­å»º&lt;/h3&gt;
&lt;p&gt;å…·ä½“æŒ‰ç…§å®é™…æƒ…å†µæ­å»ºï¼Œæœ¬é¡¹ç›®æ–¹æ¡ˆä¸ºï¼Œ4å±‚ä¸ºä¸€ç»„ï¼Œä¸€å…±8ç»„ï¼Œä¸€å…±32ç‰‡æ ‘è“æ´¾ã€‚
ç»„ä¸ç»„ä¹‹é—´éœ€è¦é¢„ç•™ç»„å·¥çš„ç©ºé—´æ–¹ä¾¿é€šé£æ•£çƒ­ä¸çº¿æçš„æ”¾ç½®ã€‚&lt;/p&gt;
&lt;h3&gt;æ•£çƒ­æ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;ä¸€å®šè¦åŠ æ•£çƒ­ç‰‡ï¼ˆæ•£çƒ­ç‰‡å¾ˆä¾¿å®œï¼‰ï¼Œåœ¨ç»„è£…ç§¯æœ¨å‰å°†æ•£çƒ­ç‰‡ç”¨å¯¼çƒ­ç¡…èƒ¶è´´å¥½ã€‚ é£æ‰‡ä¹Ÿæ˜¯å¿…é¡»çš„ï¼Œå¦‚æœæ˜¯å¤¹æ‰‡ï¼Œå¯åœ¨é«˜å¤„æ‘‡å¤´å¹ã€‚
ç½‘ç»œæ‹“æ‰‘ç»“æ„&lt;/p&gt;
&lt;p&gt;è·¯ç”±å™¨ç”¨æ¥åˆ’åˆ†å­ç½‘ï¼ŒåŒæ—¶ä½œä¸ºDHCPæœåŠ¡å™¨ã€‚äº¤æ¢æœºä¸Šè¡Œç«¯å£æ¥è·¯ç”±å™¨LANå£ï¼Œæ ‘è“æ´¾æ¥äº¤æ¢æœºç«¯å£ã€‚æ ‘è“æ´¾é…ç½®å›ºå®šIPï¼Œæ–¹ä¾¿ç®¡ç†ã€‚
é…ç½®å›ºå®šIPï¼Œä»¥Raspbianï¼ˆdebainç³»ï¼‰ä¸ºä¾‹ï¼š ç¼–è¾‘ /etc/network/interfaces&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;auto eth0
#iface eth0 inet dhcp
iface eth0 inet static
        address 192.168.1.2 #ipåœ°å€
        netmask 255.255.255.0#æ©ç 
        gateway 192.168.1.1 #ç½‘å…³ï¼Œè·¯ç”±å™¨IP
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;é‡å¯ç½‘ç»œæœåŠ¡&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#rootç”¨æˆ·ï¼Œæˆ–è€…åŠ sudo
/etc/init.d/networking restart
OR
service networking restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å¦‚æœéœ€è¦è¿˜å¯é…ç½®DNSæœåŠ¡å™¨ã€‚
é…ç½®&lt;/p&gt;
&lt;p&gt;åœ¨ç®¡ç†çš„èŠ‚ç‚¹ç”Ÿæˆssh-keyï¼ŒæŠŠpublicåˆ†å‘åˆ°å®¢æˆ·æœºï¼Œæ·»åŠ ä¿¡ä»»ã€‚æ‰‹åŠ¨æ·»åŠ éå¸¸ç¹çï¼Œå¯ä»¥åœ¨å‰é¢ä¸€æ­¥ï¼Œåˆ·å†™ç³»ç»Ÿçš„æ—¶å€™åˆ·äººpublic-keyï¼Œæˆ–è€…ä½¿ç”¨ ssh-copy-id ä¸ºäº†ä½¿ç”¨sshæ–¹ä¾¿ï¼Œå¯ä»¥ä¿®æ”¹hostsï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;192.168.1.101 pi01
192.168.1.102 pi02
192.168.1.103 pi03
....
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;ç„¶å ssh pi[01~32]å³å¯. æˆ–è€…ç¼–å†™sshçš„configæ–‡ä»¶ï¼Œ
å‚è€ƒï¼šSimplify Your Life With an SSH Config File&lt;/p&gt;
&lt;p&gt;ç®¡ç†å·¥å…·(mssh,pssh,ansible..)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.fuzhijie.me/?p=443"&gt;ä¸¤æŠŠé›†ç¾¤ç®¡ç†åˆ©å™¨&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¨è: &lt;a href="http://kumu-linux.github.io/blog/2013/08/12/pssh/"&gt;psshä½¿ç”¨æ–¹æ³•&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¨è: &lt;a href="https://github.com/ajdecon/ansible-pi-cluster"&gt;ansible-pi-cluster&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#example
pssh -t 99999 -h pssh-rpis -P sudo aptitude update
pssh -t 99999 -h pssh-rpis -P sudo aptitude -y upgrade
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;éƒ¨ç½²ç›‘æ§ï¼ˆGanglia,berryioï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://ganglia.sourceforge.net/"&gt;Ganglia&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;æ¨èï¼š&lt;a href="https://web.archive.org/web/20131002064835/http://thinkinside.tk/2013/07/30/ganglia.html"&gt;ç”¨Gangliaç›‘æ§é›†ç¾¤çš„æ€§èƒ½&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20130429213141/http://www.elain.org/?p=359"&gt;gangliaç›‘æ§çš„æ­å»ºéƒ¨ç½²&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20130117170841/http://www.myraspberrypi.info/?p=329"&gt;Monitoring the super computer with Nagios&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å•ç‚¹ç›‘æ§ï¼š&lt;a href="https://github.com/NeonHorizon/berryio"&gt;berryio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;è¿˜æœ‰å…¶ä»–ç›‘æ§ç³»ç»Ÿï¼Œå¾ˆå¤šå¾ˆå¤šï¼šnagiosï¼Œmuninï¼Œmrtg,zabbix,webnms,opmanager,collectd,cactiâ€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;å¹¶è¡Œç¨‹åº&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="http://www.southampton.ac.uk/~sjc/raspberrypi/pi_supercomputer_southampton.htm"&gt;pi_supercomputer&lt;/a&gt;:â€Building MPI so we can run code on multiple nodesâ€œ éƒ¨åˆ†&lt;/li&gt;
&lt;li&gt;&lt;a href="http://www.mpich.org/"&gt;MPICH&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;è´Ÿè½½å‡è¡¡&lt;/h3&gt;
&lt;p&gt;ä¾‹å­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;[apache])(http://raspberrywebserver.com/raspberrypicluster/raspberry-pi-cluster.html)&lt;/li&gt;
&lt;li&gt;squid+haproxy+â€¦&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Hadoopé›†ç¾¤&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=""&gt;æ ‘è“æ´¾æ­å»ºhadoopé›†ç¾¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20140811213050/http://blog.csdn.net/hguisu/article/details/7237395"&gt;Hadoopé›†ç¾¤é…ç½®&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20140811213050/http://raspberrypicloud.wordpress.com/2013/04/25/getting-hadoop-to-run-on-the-raspberry-pi/"&gt;Getting hadoop to run on the Raspberry Pi&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç©ç©å°±å¥½ã€‚ã€‚&lt;/p&gt;
&lt;h3&gt;OpenStack Swift&lt;/h3&gt;
&lt;p&gt;&lt;a href="http://programmerthoughts.com/openstack/swift-on-pi"&gt;openstack/swift-on-pi&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;æŒ–çŸ¿&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨cgminerï¼Œå…·ä½“å¯å‚è€ƒ&lt;a href="https://web.archive.org/web/20150120064306/http://shumeipai.nxez.com/2013/11/26/use-raspberry-pi-cpu-without-mining-machine-mining-case.html"&gt;æ— çŸ¿æœºæƒ…å†µä¸‹ä½¿ç”¨æ ‘è“æ´¾CPUæŒ–çŸ¿&lt;/a&gt;
é€Ÿåº¦å°±ä¸è¯´äº†ï¼Œçº¯ç²¹æµªè´¹ç”µã€‚ã€‚&lt;/p&gt;
&lt;h3&gt;å…¶ä»–&lt;/h3&gt;
&lt;h4&gt;æ­å»ºRaspbiané•œåƒ&lt;/h4&gt;
&lt;p&gt;æ ‘è“æ´¾é›†ç¾¤ä½¿ç”¨çš„ç³»ç»Ÿä¸»è¦ä¸ºRaspbianï¼Œå½“è¿›è¡Œè½¯ä»¶åŒ…å®‰è£…æˆ–æ›´æ–°æ—¶ï¼Œå¦‚æœæœ‰æœ¬åœ°é•œåƒï¼Œå¯ä»¥å¤§å¤§åŠ å¿«é€Ÿåº¦ï¼ŒèŠ‚çœæ—¶é—´ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;Rsync:
rsync --archive --verbose --delete --delete-delay --delay-updates \
    archive.raspbian.org::archive /path/to/local/mirror
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;æ·»åŠ  crontable ï¼Œ è‡ªåŠ¨æ›´æ–°ã€‚
é…ç½® webserver æˆ– ftpserveræä¾›æœåŠ¡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="https://web.archive.org/web/20140920210652/http://www.raspbian.org/RaspbianMirrors"&gt;å®˜æ–¹é•œåƒåˆ—è¡¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;USB-TTLè¿æ¥æ ‘è“æ´¾&lt;/h4&gt;
&lt;p&gt;åœ¨ç¼ºå°‘å¤–æ¥æ˜¾ç¤ºå™¨æˆ–è€…SSHå‡ºç°æ•…éšœæ—¶ï¼Œåˆ©ç”¨TTLè¿å…¥æ ‘è“æ´¾æ¯”è¾ƒå¿«æ·ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è½¯ä»¶ï¼šputty,minicomâ€¦&lt;/li&gt;
&lt;li&gt;å·¥å…·ï¼šUSBè½¬TTLå°æ¿åŠ æœé‚¦çº¿ï¼Œæˆ–è€…ç›´æ¥ä¹°USBâ€“TTLçº¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­¥éª¤&lt;/p&gt;
&lt;p&gt;è¿æ¥ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;RX-TX
TX-RX
GND-GND
åˆ‡å‹¿å°†VCæ¥åˆ°GNDä¸Š
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;å…·ä½“GPIOå£å®šä¹‰è¯·æŸ¥çœ‹ &lt;a href="https://web.archive.org/web/20150108110105/http://www.raspicn.com/thread-76-1-1.html"&gt;æ ‘è“æ´¾ä¸Šæ‰‹å®æˆ˜ä¹‹é€šè¿‡TTLä¸²å£ç»ˆç«¯è¿æ¥RaspberryPi&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#minicom
sudo aptitude install minicom
minicom -D /dev/ttyUSB0 -b 115200 #æ³¢ç‰¹ç‡ä¸º115200
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href="https://web.archive.org/web/20140811213050/http://bbs.shumeipai.org/thread-95-1-1.html"&gt;è¶…çº§ç»ˆç«¯é€šè¿‡ä¸²å£ä¸æ ‘è“æ´¾ä¼ è¾“æ–‡ä»¶&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‚è€ƒ
 - &lt;a href="https://web.archive.org/web/20140811213050/http://elinux.org/RPi_Low-level_peripherals"&gt;RPi Low-level peripherals&lt;/a&gt;
 - &lt;a href="https://web.archive.org/web/20140809060304/http://shumeipai.nxez.com/"&gt;æ¨èæ ‘è“æ´¾DIYç¬”è®°&lt;/a&gt;
 - Dropbox: &lt;a href="https://www.dropbox.com/sh/9s66fyo8aib8s3c/Zdr6AofJ51"&gt;~~æ ‘è“æ´¾èµ„æ–™æ•´åˆå…±äº«~~&lt;/a&gt;&lt;/p&gt;</content><category term="2014"></category><category term="RaspberryPi"></category></entry><entry><title>æ­å»ºPyPIåŠRubyGemsé•œåƒ</title><link href="https://fangpsh.github.io/posts/2014/2014-01-02.html" rel="alternate"></link><published>2014-01-02T00:00:00+08:00</published><updated>2014-01-02T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2014-01-02:/posts/2014/2014-01-02.html</id><summary type="html">&lt;h2&gt;PyPI&lt;/h2&gt;
&lt;p&gt;æ¨èä½¿ç”¨bandersnatchæ­å»ºï¼Œbandersnatchæ˜¯åŸºäºPEP381çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œæ›´æ¨èå‰è€…ã€‚
bandersnatchçš„å®‰è£…é…ç½®çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥æå®šäº†ï¼Œè¿™é‡Œå¤§æ¦‚è¯´ä¸‹åŸºæœ¬æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡pipå’Œeasy_installå®‰è£…bandersnatchï¼Œæˆ–è€…ä¸‹è½½æºç ã€‚&lt;/li&gt;
&lt;li&gt;ä½ éœ€è¦ä¸€ä¸ªnginx,lighttpd,æˆ–apacheä¹‹ç±»çš„webserverï¼Œæ¨èå‰äºŒè€…é€‰å…¶ä¸€ã€‚é… â€¦&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;h2&gt;PyPI&lt;/h2&gt;
&lt;p&gt;æ¨èä½¿ç”¨bandersnatchæ­å»ºï¼Œbandersnatchæ˜¯åŸºäºPEP381çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œæ›´æ¨èå‰è€…ã€‚
bandersnatchçš„å®‰è£…é…ç½®çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥æå®šäº†ï¼Œè¿™é‡Œå¤§æ¦‚è¯´ä¸‹åŸºæœ¬æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡pipå’Œeasy_installå®‰è£…bandersnatchï¼Œæˆ–è€…ä¸‹è½½æºç ã€‚&lt;/li&gt;
&lt;li&gt;ä½ éœ€è¦ä¸€ä¸ªnginx,lighttpd,æˆ–apacheä¹‹ç±»çš„webserverï¼Œæ¨èå‰äºŒè€…é€‰å…¶ä¸€ã€‚é…ç½®å¥½webserverã€‚&lt;/li&gt;
&lt;li&gt;bandersnatch.confä½äº/etc/ä¸‹ï¼ˆå®‰è£…åå…ˆæ‰§è¡Œ bandersnatch mirror ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ï¼‰ï¼ŒæŒ‰éœ€ä¿®æ”¹è¯¥é…ç½®æ–‡ä»¶ï¼Œå¯¹åº”æ¡ç›®éƒ½æœ‰è¯´æ˜ï¼Œç®€å•ç¿»è¯‘å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;[mirror]
; åŒæ­¥å†…å®¹å­˜å‚¨çš„ç›®å½•ä½ç½®.
directory = /home/mirror/pypi

; å°†åŒæ­¥çš„ä¸Šæœ‰PyPIæœåŠ¡å™¨ï¼Œç¬¬ä¸€æ¬¡åŒæ­¥å¯ä»¥é€‰æ‹©æ¸…åï¼Œä¸­ç§‘å¤§ï¼Œä¸­å¤§ï¼Œè±†ç“£ç­‰å›½å†…æœåŠ¡å™¨.
; åæœŸçš„åŒæ­¥å†ä¿®æ”¹ä¸ºå®˜æ–¹æœåŠ¡å™¨ã€‚
;master = https://testpypi.python.org
;master = http://pypi.mirrors.ustc.edu.cn
;master = http://pypi.douban.com

master = https://pypi.python.org

;è¶…æ—¶è®¾ç½®
;The network socket timeout to use for all connections. This is set to a
; somewhat aggressively low value: rather fail quickly temporarily and re-run
; the client soon instead of having a process hang infinitely and have TCP not
; catching up for ages.
timeout = 10

; å¹¶è¡Œä¸‹è½½çš„çº¿ç¨‹æ•°é‡.
; å»ºè®®çš„çº¿ç¨‹è®¾ç½®:
; - ä¿æŒé»˜è®¤è®¾ç½®3,ä»¥é˜²æ­¢ä¸Šæ¸¸æœåŠ¡å™¨è¿‡è½½
; - æ•°æ®ä¸­å¿ƒçš„å®˜æ–¹æœåŠ¡å™¨å¯ä»¥è®¾ç½®ä¸º20
; - 50ä»¥ä¸Šçš„è®¾ç½®å¯èƒ½ä¸ç¨³å®šï¼Œå¹¶ä¼šè¢«bandersnatchç¦æ­¢
workers = 3

;å¿«é€ŸåŒæ­¥ä¸­é‡åˆ°é”™è¯¯æ˜¯å¦åœæ­¢åŒæ­¥ï¼Œå¦‚æœæ˜¯ï¼Œå°†å¯¼è‡´åŒæ­¥å¤±è´¥ã€‚
;ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶å€™å»ºè®®è®¾ç½®ä¸º falseï¼Œåç»­å¯æ›´æ”¹ä¸ºtrueã€‚
; å€¼ï¼š &amp;quot;true&amp;quot; or &amp;quot;false&amp;quot;.
stop-on-error = false

;æœ¬åœ°æœåŠ¡å™¨æ˜¯å¦åˆ é™¤ä¸Šæ¸¸æœåŠ¡å™¨å·²ç»åˆ é™¤çš„åŒ…ã€‚
; é‡è¦: å¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯ä½œä¸ºä¸€ä¸ªå®˜æ–¹é•œåƒæä¾›ç»™ç”¨æˆ·ï¼Œè¯·æ‰“å¼€è¯¥é€‰é¡¹ã€‚
delete-packages = true

[statistics]
; A glob pattern matching all access log files that should be processed to
; generate daily access statistics that will be aggregated on the master PyPI.
access-log-pattern = /var/log/nginx/*.pypi.python.org*access*
; vim: set ft=cfg:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;4.è®¾ç½®cronä»»åŠ¡ï¼Œè‡ªåŠ¨å®šæ—¶æ‰§è¡ŒåŒæ­¥å‘½ä»¤,å°†ä»»åŠ¡æ–‡ä»¶æ”¾åœ¨/etc/cron.dæ–‡ä»¶ä¸‹æ—¶ï¼Œæ³¨æ„å‘½åè§„åˆ™ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;LC_ALL=en_US.utf8
*/2 * * * * root bandersnatch mirror |&amp;amp; logger -t bandersnatch[mirror]
12 * * * * root bandersnatch update-stats |&amp;amp; logger -t bandersnatch[update-stats]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;5.å…³äºbandersnatchæ›´å¤šé…ç½®è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œå¦å¤–å¯ä»¥é…ç½®exim4å’Œç¼–å†™è„šæœ¬åˆ†ææ—¥è®°æ–‡ä»¶è¿›è¡Œç›‘æ§å’ŒæŠ¥è­¦ã€‚&lt;/p&gt;
&lt;h2&gt;RubyGems&lt;/h2&gt;
&lt;p&gt;RubyGemsçš„æ­å»ºï¼Œå¯å‚è€ƒRuby-Chinaä¸Šå¸–å­,æŒ‰ç…§huacnleeçš„æ­¥éª¤æ­å»ºå³å¯ï¼Œè¡¥å……å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ®è¯´RubyGemsä¼šæ ¹æ®ä¸­å›½ç”¨æˆ·çš„ipå°†è¯·æ±‚è‡ªåŠ¨è½¬ åˆ°æ—¥æœ¬çš„é•œåƒç«™,è¿™ä¸ªå¾ˆä¸é”™ï¼Œä½†æ˜¯æˆ‘è‡ªå·±è¯•ç”¨äº†å‡ æ¬¡éƒ½å¡ä½ä¸ä¼šè·³ï¼Œå›§ã€‚æ—¥æœ¬çš„æœåŠ¡å™¨åœ°å€æ˜¯ï¼šhttp://tokyo-m.rubygems.org ï¼Œæˆ‘æ›¾ç»ä¹Ÿå°†è¿™ä¸ªä½œä¸ºé•œåƒç«™çš„ä¸Šæ¸¸è¿›è¡ŒåŒæ­¥ï¼Œä½†æ˜¯æ—¥æœ¬è¿™ä¸ªæœåŠ¡å™¨ä¸ç¨³å®šï¼Œæ‰€ä»¥é€‰æ‹©åªèƒ½æ˜¯ä¸æ·˜å®é•œåƒæˆ–è€…å°†é•œåƒæœåŠ¡å™¨ä¸ŠFQï¼ˆproxychainsï¼Œvpnç­‰å·¥å…·ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é™¤äº†ä½¿ç”¨ä¸Šé¢çš„åŒæ­¥å·¥å…·æ­å»ºé•œåƒç«™ï¼Œä¹Ÿå¯é…ç½®åå‘ä»£ç†å¹¶cache.&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒæ­¥å¯è®¾ç½®ä¸Šæ¸¸ä¸ºæ·˜å®ï¼Œæ¸…åï¼Œä¸­å¤§ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æ˜¯æ­å»ºä¸€ä¸ªå…¬å…±çš„é•œåƒç«™æä¾›æœåŠ¡ï¼Œä¸å»ºè®®ä½¿ç”¨Geminabox ä¸­WEBrickä½œä¸ºwebserverï¼Œæ¢ç”¨nginxæˆ–è€…lighttpdå§ã€‚&lt;/li&gt;
&lt;li&gt;å°†åŒæ­¥å‘½ä»¤æ”¾å…¥/etc/cron.dæ—¶é™¤äº†è¦æ³¨æ„æ–‡ä»¶å‘½åæ–¹å¼è¿˜å¯èƒ½é‡åˆ°â€œrake aborted!â€ï¼Œè¿™è¡¨æ˜æ²¡è®¾ç½®PATHï¼Œå‚è€ƒå¦‚ä¸‹ï¼ˆè¯·æŒ‰ä½ çš„PATHè¿›è¡Œé…ç½®ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;#RUbygems
PATH=...#æŸ¥çœ‹PATHçš„å‘½ä»¤ï¼šecho $PATH
#è§£é‡Šï¼š10åˆ†é’Ÿä¸€æ¬¡ï¼Œé…ç½®flocké”ï¼Œæ‰§è¡Œrubygemsä¸­çš„åŒæ­¥ï¼Œæ—¥è®°æ ¼å¼è¾“å‡ºï¼Œé‚®ä»¶æŠ¥è­¦å‘½ä»¤ç­‰ã€‚
*/10 * * * * flock -xn /var/lock/mirror/rubygems.lock -c &amp;quot; bash /root/scripts/bin/rubygems &amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;6.æ³¨æ„éœ€è¦é…ç½®åŒæ­¥é”ã€‚å¯ç”¨ä¸Šä¾‹ä»£ç ä¸­çš„flockã€‚&lt;/p&gt;</content><category term="2014"></category><category term="pypi"></category><category term="rugygems"></category></entry><entry><title>æ­å»ºå¼€æºé•œåƒç«™</title><link href="https://fangpsh.github.io/posts/2014/2014-01-01.html" rel="alternate"></link><published>2014-01-01T00:00:00+08:00</published><updated>2014-01-01T00:00:00+08:00</updated><author><name>fangpsh</name></author><id>tag:fangpsh.github.io,2014-01-01:/posts/2014/2014-01-01.html</id><summary type="html">&lt;p&gt;&lt;img alt="SYSU Mirror" src="/assets/images/2023/20230306160359.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®2013 SFD å¹¿å·èšä¼šä¸Šçš„æ¼”è®²ã€Šç®€å•ä»‹ç»å¦‚ä½•æ­å»ºä¸€ä¸ªå¼€æºé•œåƒç«™ã€‹å¹»ç¯ç‰‡è¡¥å……æ•´ç†è€Œæˆã€‚
å†…å®¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®€ä»‹ä¸­å±±å¤§å­¦é•œåƒç«™&lt;/li&gt;
&lt;li&gt;æ­å»ºå¼€ â€¦&lt;/li&gt;&lt;/ol&gt;</summary><content type="html">&lt;p&gt;&lt;img alt="SYSU Mirror" src="/assets/images/2023/20230306160359.jpg"&gt;&lt;/p&gt;
&lt;p&gt;æ ¹æ®2013 SFD å¹¿å·èšä¼šä¸Šçš„æ¼”è®²ã€Šç®€å•ä»‹ç»å¦‚ä½•æ­å»ºä¸€ä¸ªå¼€æºé•œåƒç«™ã€‹å¹»ç¯ç‰‡è¡¥å……æ•´ç†è€Œæˆã€‚
å†…å®¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç®€ä»‹ä¸­å±±å¤§å­¦é•œåƒç«™&lt;/li&gt;
&lt;li&gt;æ­å»ºå¼€æºé•œåƒç«™æµç¨‹&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;ç®€ä»‹ä¸­å±±å¤§å­¦é•œåƒç«™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨ï¼š&lt;blockquote&gt;
&lt;p&gt;æˆ´å°”(dell ) PowerEdge1850 ,3.xGHz 4 cores CPU,8GB Memory,One 300GB Hard disk(default as raid 1,Space available 300GB),Bandwidth 100M(æ•™è‚²ç½‘,cernet),æœåŠ¡å™¨ç”¨å…‰çº¤è¿æ¥å­˜å‚¨,åˆ†é…äº†ä¸€ä¸ª1Tçš„å­˜å‚¨å·ç»™æœåŠ¡å™¨. Support:HTTP (Nginx) IPv4:202.116.65.189 (Unfortunately,No IPv6)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;Domain:mirror.sysu.edu.cn&lt;/li&gt;
&lt;li&gt;System:Debian Wheezy AMD64&lt;/li&gt;
&lt;li&gt;Team: åŒ¿åç•¥&lt;/li&gt;
&lt;li&gt;Thanks:ä¸­å±±å¤§å­¦ç½‘ç»œä¸ä¿¡æ¯æŠ€æœ¯ä¸­å¿ƒæä¾›çš„èµ„æºæ”¯æŒ&lt;/li&gt;
&lt;li&gt;æºåˆ—è¡¨:&lt;ul&gt;
&lt;li&gt;ArchLinux&lt;/li&gt;
&lt;li&gt;ArchLinuxARM&lt;/li&gt;
&lt;li&gt;Cygwin&lt;/li&gt;
&lt;li&gt;PyPI&lt;/li&gt;
&lt;li&gt;Raspbian&lt;/li&gt;
&lt;li&gt;RubyGems&lt;/li&gt;
&lt;li&gt;Slackware&lt;/li&gt;
&lt;li&gt;Others(æä¾›ç»™æ ¡å†…ç”¨æˆ·å’Œå‘¨è¾¹æ•™è‚²ç½‘ç”¨æˆ·çš„åŠ é€ŸæœåŠ¡,é™†ç»­æ·»åŠ æ–°å‡ºçš„å‘è¡Œç‰ˆç³»ç»Ÿé•œåƒç­‰)&lt;/li&gt;
&lt;li&gt;â€”â€”â€”â€”â€”â€”â€”-plan â€”â€”-2013-9-21â€”â€”â€”â€”â€”â€”â€“&lt;/li&gt;
&lt;li&gt;Ubuntu (æ ¡å†…ç”¨æˆ·éœ€æ±‚å¤§,å¸Œæœ›ç©ºé—´å¤Ÿçš„æ—¶å€™èƒ½åŠ ä¸Š,åŸå› ç¨åè¯´æ˜)&lt;/li&gt;
&lt;li&gt;npm (Come Soon)&lt;/li&gt;
&lt;li&gt;ä»–å°ä¼—çš„å‘è¡Œç‰ˆæˆ–ç”¨æˆ·æœ‰è¾ƒå¤§éœ€æ±‚çš„å‘è¡Œç‰ˆ(å‰ææ˜¯æœåŠ¡å™¨å­˜å‚¨ç©ºé—´å¤Ÿã€‚ã€‚å›§ã€‚æˆ‘ä»¬åªæœ‰1T)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ­å»ºå¼€æºé•œåƒç«™æµç¨‹&lt;/p&gt;
&lt;h2&gt;åŸºæœ¬æµç¨‹&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡å™¨&amp;amp;å¸¦å®½&amp;amp;å­˜å‚¨&lt;/li&gt;
&lt;li&gt;åŒæ­¥æºé€‰æ‹© ,æ¶æ„é€‰æ‹©&lt;/li&gt;
&lt;li&gt;æä¾›çš„æœåŠ¡:ftp | http | rsync 3.å®˜ç½‘è·å–åŒæ­¥æ–¹æ³•æˆ–å·¥å…·,æºåˆ—è¡¨(é€‰æ‹©ä¸Šæ¸¸æº)&lt;/li&gt;
&lt;li&gt;é…ç½®åŒæ­¥å·¥å…·&lt;/li&gt;
&lt;li&gt;å®šæ—¶åŒæ­¥ (crontable)&lt;/li&gt;
&lt;li&gt;å¤‡ä»½å·¥ä½œ,ç›‘æ§ä¸æŠ¥è­¦,æ—¥å¸¸ç»´æŠ¤,ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;æ–‡æ¡£ç¼–å†™(Wiki),Submit MirrorsList&lt;/li&gt;
&lt;li&gt;å…¶ä»–&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;0/8.æœåŠ¡å™¨&amp;amp;å¸¦å®½&amp;amp;å­˜å‚¨&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;æœåŠ¡å™¨: Linux ,maybe windows ?..orz&lt;/li&gt;
&lt;li&gt;å¸¦å®½: è¶Šå¤§è¶Šå¥½(ä¸Šè¡Œå¸¦å®½å¤ªå°æ— æ³•æä¾›æ›´å¥½çš„æœåŠ¡,ä¸‹è¡Œå¤ªå°æ— æ³•åŠæ—¶åŒæ­¥å®Œæ•´(æŒ‰ç½‘ç»œæƒ…å†µåˆ†æ—¶æ®µåŒæ­¥,åŒæ—¶å°½é‡é¿å¼€è´Ÿè½½é«˜å³°))ã€‚ å¦‚æœè¦å¯¹å¤–æœåŠ¡,éœ€è¦ä¸€ä¸ªå…¬ç½‘IP,æœ‰åŸŸåæ›´å¥½ã€‚&lt;/li&gt;
&lt;li&gt;å‚¨å­˜: è¶Šå¤§è¶Šå¥½(å¦‚æœæ˜¯å¯¹å¤–æä¾›å¤§é‡æœåŠ¡,å®¶ç”¨çš„ç¡¬ç›˜ä¼°è®¡æ’‘ä¸äº†ä¸€å¹´)ã€‚å¯è€ƒè™‘ç”¨SSDä½œä¸ºcacheã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1/8.åŒæ­¥æºé€‰æ‹© ,æ¶æ„é€‰æ‹©&lt;/h3&gt;
&lt;p&gt;åŒæ­¥æºé€‰æ‹©:&lt;/p&gt;
&lt;p&gt;æŒ‰éœ€æ±‚é€‰æ‹©éœ€è¦çš„å‘è¡Œç‰ˆ,ç¨³å®šæ€§ç¬¬ä¸€,å¤šæ ·æ€§ç¬¬äºŒ,æ»¡è¶³éœ€æ±‚å³å¯ã€‚åŒæ—¶ä¹Ÿè¦æ³¨æ„â€æ€§ä»·æ¯”â€œ(è‡ªç”¨é•œåƒæ— éœ€è€ƒè™‘),ä¾‹å¦‚ OpenBSDä¹‹ç±»çš„æ€§ä»·æ¯”å¯èƒ½å¾ˆä½ ,æ¶ˆè€—å¤§é‡çš„åŒæ­¥æµé‡å’Œç£ç›˜ç©ºé—´å¯èƒ½æ€§ä»·æ¯”ä¸æ˜¯å¾ˆå¤§,åŒæ—¶ä¾‹å¦‚å¤§å­¦ä¸­çš„é•œåƒç«™éœ€è¦ç½‘ç»œä¸­å¿ƒçš„æ”¯æŒ,æ‰€ä»¥éœ€è¦è€ƒè™‘åˆ°æ ¡å†…ç”¨æˆ·çš„æ”¯æŒå’Œçƒ­åº¦(å­¦ç”Ÿæ”¯æŒåº¦ä¸ å¤Ÿ,ncçš„æ”¯æŒå¯èƒ½ä¹Ÿä¼šä¸‹é™),åŒæ—¶æ ¡å†…æœ‰ä¸€å®šçƒ­åº¦æ‰å¥½ä¼ æ‰¿,æ‰€ä»¥å¦‚æœæ·»åŠ ç±»ä¼¼Ubuntuçš„å‘è¡Œç‰ˆâ€æ€§ä»·æ¯”â€œä¼šå¾ˆé«˜ã€‚
æ…é‡é€‰æ‹©ä¸Šçº¿çš„å‘è¡Œç‰ˆ(è‡ªèº«èµ„æºä¼°è®¡),ä¸Šçº¿å°½é‡ä¿æŒç¨³å®šã€‚åˆ‡å‹¿éšæ„æ›´æ¢æœåŠ¡ã€‚æ³¨æ„é¢„ç•™è¶³å¤Ÿç©ºé—´!&lt;/p&gt;
&lt;p&gt;æ„Ÿè°¢ä¸­å¤§IGIå¸ˆå…„ä»¥ä¸Šç»™å‡ºçš„å»ºè®®ã€‚æ¨è:&lt;a href="http://www.igigo.net/archives/65"&gt;ã€Šæ­å»ºlinux mirroré•œåƒã€‹&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ¶æ„é€‰æ‹©:&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå‘è¡Œç‰ˆå¯èƒ½ä¿æŠ¤å¤šç§æ¶æ„,(ä¾‹å¦‚debian :alphaã€amd64ã€armã€armelã€hppaã€hurd-i386ã€i386ã€ia64ã€m68kã€mipselã€mipsã€powerpcã€s390ã€sh and sparc,source,debianç°æœ‰oldstable,stable ,testing,unstable,è¿˜æœ‰experimentalç‰ˆæœ¬),æ‰€ä»¥éœ€è¦æŒ‰éœ€æ±‚é€‰æ‹©éœ€è¦åŒæ­¥çš„æ¶æ„(å› ä¸ºç£ç›˜ç©ºé—´ä¸æ˜¯æ— é™çš„),ä¸€èˆ¬æ¥è¯´å°±é€‰æ‹©i386,amd64,å¤–åŠ sourceã€‚&lt;/p&gt;
&lt;h3&gt;2/8.æä¾›çš„æœåŠ¡:ftp | http | rsync&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;FTP:vsftpd ?è¿˜æœ‰å¾ˆå¤š,ä¸å¤ªäº†è§£,å›§ã€‚&lt;/li&gt;
&lt;li&gt;HTTP:
Webserverå»ºè®®é€‰æ‹©nginxæˆ–lighttpd,å› ä¸ºé•œåƒåŒ…å«å¤§é‡çš„é™æ€æ–‡ä»¶,è¿™ä¸¤è€…æ®è¯´æ¯”Apacheæ›´æœ‰ä¼˜åŠ¿, è®°å¾—cn99æŒ‚æ‰å,å°†Apacheæ¢åˆ°nginxäº†?
å»ºè®® :nginxï¼Œ lighttpd&lt;/li&gt;
&lt;li&gt;Rsync:ä¸ºä¸‹æ¸¸æä¾›,ä¾‹å¦‚æ¸…å,ä¸­ç§‘å¤§æœ‰å¼€æ”¾æŸäº›å‘è¡Œç‰ˆ,å›½å†…æä¾›rsyncçš„é•œåƒç«™ä¸å¤š,ä¸»è¦æ˜¯æä¾›rsyncä¼šæœ‰å¾ˆé«˜çš„IOè´Ÿè½½,ä¸€èˆ¬æ‰¿å—ä¸èµ·ã€‚å¦‚æœæœ‰æ„æ„¿æä¾›rsync,googleå³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;3/8.å®˜ç½‘è·å–åŒæ­¥æ–¹æ³•æˆ–å·¥å…·,æºåˆ—è¡¨(é€‰æ‹©ä¸Šæ¸¸æº)&lt;/h3&gt;
&lt;p&gt;åŒæ­¥æ–¹æ³•æˆ–å·¥å…·:
ä¸€èˆ¬å°±æ˜¯Rsync,ç„¶åä»ä¸Šæ¸¸æ‹‰ä¸œè¥¿,å¯ä»¥è‡ªå·±å†™è„šæœ¬,ä¹Ÿå¯ä»¥ç”¨å®˜æ–¹æä¾›çš„å·¥å…·,ä¾‹å¦‚debiançš„ftpsyncç­‰ã€‚
åˆ‡å‹¿ä½¿ç”¨wget ç­‰å·¥å…·!ä¸èƒ½ä¿è¯æ–‡ä»¶linkç­‰å±æ€§,ä¹Ÿæ— æ³•åšåˆ°å¢é‡åŒæ­¥,æµªè´¹èµ„æº!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¸…åçš„åŒæ­¥è„šæœ¬:http://git.tuna.tsinghua.edu.cn/&lt;/li&gt;
&lt;li&gt;åŒ—äº¤Idealçš„Mirrorå·¥å…·:https://github.com/ideal/mirror&lt;blockquote&gt;
&lt;p&gt;(æ„Ÿè°¢idealæ›¾ç»æä¾›çš„å¸®åŠ©,æœ‰æ„æ„¿æ­å»ºé•œåƒç«™çš„åŒå­¦é‡åˆ° é—®é¢˜å¯åœ¨Twitterä¸Šæ‰¾åˆ°ä»–)Rubygems,PyPI,npmä¹Ÿæ˜¯åŒæ ·æ‰¾å¯»æˆ–è‡ªå·±ç¼–å†™åŒæ­¥è„šæœ¬åå·¥å…·,æˆ–åšåå‘ä»£ç†ã€‚é™¤äº†ä¸»åŠ¨æ‹‰çš„,è¿˜æœ‰æ˜¯å®˜æ–¹ä¸»é•œåƒæ¨é€åˆ°å®˜æ–¹å…¶ä»–é•œåƒ,ä¾‹å¦‚ArchlinuxARMã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;ubuntuè¿˜æœ‰ä¸ªåŒæ­¥å·¥å…· apt-mirror&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šæ¸¸æº:&lt;/p&gt;
&lt;p&gt;ä¸Šå‘è¡Œç‰ˆå®˜ç½‘è·å–MirrorsList,ç„¶åæ‰¾å¯»æä¾›rsyncæœåŠ¡çš„é•œåƒ,é€‰æ‹©ä¸Šæ¸¸æº,ä¸€èˆ¬é€‰æ‹©å›½å†…,æ—¥æœ¬,æ–°åŠ å¡,å°æ¹¾ç­‰äºšå¤ªåœ°åŒºçš„æºã€‚
æ³¨æ„:å®˜æ–¹rsyncå¯èƒ½åªå¯¹æŒ‡å®šIPå¼€æ”¾(è´Ÿè½½é—®é¢˜)&lt;/p&gt;
&lt;h3&gt;4/8.é…ç½®åŒæ­¥å·¥å…·&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå·±å†™åŒæ­¥è„šæœ¬ :&lt;ul&gt;
&lt;li&gt;å¤±è´¥é‚®ä»¶æŠ¥è­¦,åŒæ­¥é”æ§åˆ¶,ä¸¤æ­¥åŒæ­¥,å…¶ä»–rsyncå‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;Rsyncæ•™ç¨‹:è¯» igiçš„åŒæ­¥è„šæœ¬: http://www.igigo.net/archives/65&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŒæ­¥å·¥å…·:&lt;ul&gt;
&lt;li&gt;æ¸…åçš„åŒæ­¥è„šæœ¬:http://git.tuna.tsinghua.edu.cn/&lt;/li&gt;
&lt;li&gt;åŒ—äº¤Idealçš„Mirrorå·¥å…·:https://github.com/ideal/mirror/&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PyPI,Rubygems,npm:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯»Rubygemså’ŒPyPIåŒæ­¥ç®€å•æ•™ç¨‹ : http://fangpeishi.com/post/da-jian-pypiji-rubygemsjing-xiang&lt;/li&gt;
&lt;li&gt;è¯»npmåŒæ­¥æ•™ç¨‹ :http://maskray.me/blog/2012-11-21-tuna-npm-mirror&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ³¨æ„:
æ·»åŠ åŒæ­¥é”ï¼Œdebianç³»éœ€è¦ä¸¤æ­¥åŒæ­¥(å…ˆåŒæ­¥poolç›®å½•)ã€‚&lt;/p&gt;
&lt;h3&gt;5/8.å®šæ—¶åŒæ­¥ (crontable)&lt;/h3&gt;
&lt;p&gt;å®šæ—¶åŒæ­¥: æŠŠå†™å¥½çš„cronè„šæœ¬ä¸¢è¿› /etc/cron.d/
ã€Šå®šæ—¶è‡ªåŠ¨ä»»åŠ¡crontabä½¿ç”¨æ•™ç¨‹ã€‹
æ³¨æ„:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;/etc/cron.d the file names must conform to the filename requirements of run-parts: they must be entirely made up of letâ€ters, digits and can only contain the special signs underscores (â€˜â€˜) and hyphens (â€˜-â€™). Any file that does not conform to theserequirements will not be executed by run-parts. For example, any file containing dots will be ignored. This is done to prevent cron from running any of the files that are left by the Debian package management system when hanâ€ dling files in /etc/cron.d/ as configuration files (i.e. files ending in .dpkg-dist, .dpkg-orig, and .dpkg-new).
(ç‰¹æ®Šå­—ç¬¦åªå¯ä»¥ä½¿ç”¨â€™â€˜å’Œâ€™-â€™,å¦å¤–ä»¥â€™.â€™å¼€å¤´çš„æ–‡ä»¶ä¼šè¢«å¿½ç•¥)&lt;/li&gt;
&lt;li&gt;crontabè„šæœ¬ä¸­æ³¨æ„pathçš„é…ç½®,ä¾‹å¦‚ä½¿ç”¨rubygemsçš„åŒæ­¥å·¥å…·ç¢°åˆ°rake abortç­‰é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;6/8.å¤‡ä»½å·¥ä½œ,ç›‘æ§ä¸æŠ¥è­¦,æ—¥å¸¸ç»´æŠ¤,ä¼˜åŒ–&lt;/h3&gt;
&lt;p&gt;å¤‡ä»½:&lt;/p&gt;
&lt;p&gt;å½“é…ç½®æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶å€™åˆ©ç”¨è„šæœ¬å°†å…¶å¤‡ä»½åˆ°Dropbox.
ç›‘æ§ä¸æŠ¥è­¦:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨awkç­‰å·¥å…·å¯¹åŒæ­¥æ—¥è®°è¿›è¡Œåˆ†æã€‚&lt;/li&gt;
&lt;li&gt;é…ç½®é‚®ä»¶æœåŠ¡ç¨‹åº,ä¾‹å¦‚exim4,åœ¨ä¹‹å‰çš„è„šæœ¬ä¸­æ·»åŠ å‡ºç°å¼‚å¸¸æ—¶å€™å‘é‚®ä»¶ã€‚(ç§»åŠ¨139é‚®ç®±æœ‰çŸ­ä¿¡é€šçŸ¥åŠŸèƒ½)ã€‚&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²ç›‘æ§ç¨‹åº,ä¾‹å¦‚MUNIN,å¯¹ç£ç›˜æƒ…å†µ,ç½‘ç»œæƒ…å†µ,è´Ÿè½½æƒ…å†µç­‰è¿›è¡Œç›‘æ§,ä»¥å›¾è¡¨çš„å½¢å¼ç›´è§‚å‘ˆç°å‡ºæ¥ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ—¥å¸¸ç»´æŠ¤:&lt;/p&gt;
&lt;p&gt;å½“å‡ºç°åŒæ­¥å¼‚å¸¸å¤±è´¥æ—¶(ä¾‹å¦‚:ä¸Šæ¸¸downæ‰äº†,å’Œä¸Šæ¸¸çš„ç½‘ç»œå¼‚å¸¸äº†,ç£ç›˜å¼‚å¸¸ç­‰ç­‰),éœ€è¦æ›´æ¢ä¸Šæ¸¸æˆ–è€…å…¶ä»–æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;ä¼˜åŒ–:
ä¸»è¦æ˜¯é’ˆå¯¹é•œåƒç«™å¤§é‡çš„é™æ€æ–‡ä»¶è¿›è¡Œçš„ä¼˜åŒ–.ä»¥åŠè§‚å¯Ÿç›‘æ§å¯¹æµé‡å’Œè´Ÿè½½è¿›è¡Œåˆç†åˆ†é…ã€‚&lt;/p&gt;
&lt;h3&gt;7/8.æ–‡æ¡£ç¼–å†™(Wiki),Submit MirrorsList&lt;/h3&gt;
&lt;p&gt;æ–‡æ¡£ç¼–å†™:
ä¸€ä¸ªæ˜¯ä¸ºäº†å°†ç»éªŒç§¯ç´¯,æ–¹ä¾¿ä¼ æ‰¿,åŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿å…¶ä»–æ­å»ºé•œåƒç«™çš„æœ‹å‹ã€‚ä¾‹å¦‚å»ºä¸ªwikiã€‚&lt;/p&gt;
&lt;p&gt;Submit your mirror to mirrorslist:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å½“é•œåƒç«™è¶³å¤Ÿç¨³å®šæ—¶,å¯è€ƒè™‘æäº¤åˆ°å®˜æ–¹mirrorslist,è®©æ›´å¤šçš„æœ‹å‹çŸ¥é“,æœ‰å°å°çš„æˆå°±æ„Ÿä¹Ÿå®¹æ˜“é¼“åŠ±è‡ªèº«å’Œä¼ æ‰¿ã€‚å†…ç½‘çš„é•œåƒå¯åœ¨å†…éƒ¨äº¤æµå¹³å°å…¬å¼€åˆ†äº«ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æ˜¯æ ¡å›­é•œåƒç«™éœ€è¦æ³¨æ„å®£ä¼ ,ä»¥å¾—åˆ°æ›´å¤šå¸ˆç”Ÿçš„æ”¯æŒ,åŒæ—¶æ–¹ä¾¿ä¼ æ‰¿ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;8/8.å…¶ä»–&lt;/h3&gt;
&lt;p&gt;å¦‚æœæ˜¯åœ¨å¤§å­¦å†…è¦æ­å»ºä¸€ä¸ªé•œåƒç«™,éœ€è¦è·å–ç½‘ç»œä¸­å¿ƒçš„æ”¯æŒ,å¯èƒ½éœ€è¦:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€é¢—â€œè€â€å¿ƒ;&lt;/li&gt;
&lt;li&gt;æ³¨æ„ä¼ æ‰¿é—®é¢˜ (æ ¡å†…çƒ­åº¦å°†å½±å“ncå¯¹é•œåƒç«™çš„æ”¯æŒç¨‹åº¦,åšå¥½æ–‡æ¡£,å‘å±•å¥½å¸ˆå¼Ÿå¸ˆå¦¹,å¦‚æœæœ‰ä¸ªLinuxåä¼šå•¥çš„å¹³å°ç»„ç»‡æœ€å¥½ä¸è¿‡äº†);&lt;/li&gt;
&lt;li&gt;æ‰¾é è°±è€å¸ˆæ”¯æŒ(é•œåƒå¿«æ­»æ‰äº†çš„æ—¶å€™,è€å¸ˆå¯èƒ½èƒ½æ•‘æ´»å®ƒ),ç†Ÿæ‚‰ncé‡Œçš„è€å¸ˆæˆ–é¢†å¯¼(è§£å†³é—®é¢˜æ›´æ–¹ä¾¿),è®°å¾—é•œåƒç«™è¦å¸®åŠ©å®£ä¼ nc,è®°å¾—æ„Ÿè°¢æä¾›å¸®åŠ©çš„åŒå­¦,è€å¸ˆå’Œç»„ç»‡;&lt;/li&gt;
&lt;li&gt;ç¨³å®šä¸ºå…ˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæŠŠå®ƒå½“ä¸€ä¸ªæœåŠ¡äºåˆ«äººçš„äº‹æƒ…æ¥åšâ€œ -- ä¸­å¤§è½¯ä»¶å­¦é™¢Arberè€å¸ˆ&lt;/p&gt;
&lt;/blockquote&gt;</content><category term="2014"></category><category term="linux"></category></entry></feed>